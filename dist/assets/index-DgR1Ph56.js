function uA(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const o in i)if(o!=="default"&&!(o in n)){const c=Object.getOwnPropertyDescriptor(i,o);c&&Object.defineProperty(n,o,c.get?c:{enumerable:!0,get:()=>i[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(o){if(o.ep)return;o.ep=!0;const c=t(o);fetch(o.href,c)}})();function Rx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var vv={exports:{}},Cm={},xv={exports:{}},$n={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qw;function DI(){if(qw)return $n;qw=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),d=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),A=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),k=Symbol.iterator;function L(de){return de===null||typeof de!="object"?null:(de=k&&de[k]||de["@@iterator"],typeof de=="function"?de:null)}var z={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},q=Object.assign,Y={};function ne(de,De,ut){this.props=de,this.context=De,this.refs=Y,this.updater=ut||z}ne.prototype.isReactComponent={},ne.prototype.setState=function(de,De){if(typeof de!="object"&&typeof de!="function"&&de!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,de,De,"setState")},ne.prototype.forceUpdate=function(de){this.updater.enqueueForceUpdate(this,de,"forceUpdate")};function ue(){}ue.prototype=ne.prototype;function ve(de,De,ut){this.props=de,this.context=De,this.refs=Y,this.updater=ut||z}var se=ve.prototype=new ue;se.constructor=ve,q(se,ne.prototype),se.isPureReactComponent=!0;var Se=Array.isArray,Ne=Object.prototype.hasOwnProperty,nt={current:null},dt={key:!0,ref:!0,__self:!0,__source:!0};function gt(de,De,ut){var Et,It={},$t=null,Qt=null;if(De!=null)for(Et in De.ref!==void 0&&(Qt=De.ref),De.key!==void 0&&($t=""+De.key),De)Ne.call(De,Et)&&!dt.hasOwnProperty(Et)&&(It[Et]=De[Et]);var Ut=arguments.length-2;if(Ut===1)It.children=ut;else if(1<Ut){for(var an=Array(Ut),_n=0;_n<Ut;_n++)an[_n]=arguments[_n+2];It.children=an}if(de&&de.defaultProps)for(Et in Ut=de.defaultProps,Ut)It[Et]===void 0&&(It[Et]=Ut[Et]);return{$$typeof:n,type:de,key:$t,ref:Qt,props:It,_owner:nt.current}}function vt(de,De){return{$$typeof:n,type:de.type,key:De,ref:de.ref,props:de.props,_owner:de._owner}}function Ft(de){return typeof de=="object"&&de!==null&&de.$$typeof===n}function Wt(de){var De={"=":"=0",":":"=2"};return"$"+de.replace(/[=:]/g,function(ut){return De[ut]})}var pn=/\/+/g;function sn(de,De){return typeof de=="object"&&de!==null&&de.key!=null?Wt(""+de.key):De.toString(36)}function rn(de,De,ut,Et,It){var $t=typeof de;($t==="undefined"||$t==="boolean")&&(de=null);var Qt=!1;if(de===null)Qt=!0;else switch($t){case"string":case"number":Qt=!0;break;case"object":switch(de.$$typeof){case n:case e:Qt=!0}}if(Qt)return Qt=de,It=It(Qt),de=Et===""?"."+sn(Qt,0):Et,Se(It)?(ut="",de!=null&&(ut=de.replace(pn,"$&/")+"/"),rn(It,De,ut,"",function(_n){return _n})):It!=null&&(Ft(It)&&(It=vt(It,ut+(!It.key||Qt&&Qt.key===It.key?"":(""+It.key).replace(pn,"$&/")+"/")+de)),De.push(It)),1;if(Qt=0,Et=Et===""?".":Et+":",Se(de))for(var Ut=0;Ut<de.length;Ut++){$t=de[Ut];var an=Et+sn($t,Ut);Qt+=rn($t,De,ut,an,It)}else if(an=L(de),typeof an=="function")for(de=an.call(de),Ut=0;!($t=de.next()).done;)$t=$t.value,an=Et+sn($t,Ut++),Qt+=rn($t,De,ut,an,It);else if($t==="object")throw De=String(de),Error("Objects are not valid as a React child (found: "+(De==="[object Object]"?"object with keys {"+Object.keys(de).join(", ")+"}":De)+"). If you meant to render a collection of children, use an array instead.");return Qt}function kn(de,De,ut){if(de==null)return de;var Et=[],It=0;return rn(de,Et,"","",function($t){return De.call(ut,$t,It++)}),Et}function Pe(de){if(de._status===-1){var De=de._result;De=De(),De.then(function(ut){(de._status===0||de._status===-1)&&(de._status=1,de._result=ut)},function(ut){(de._status===0||de._status===-1)&&(de._status=2,de._result=ut)}),de._status===-1&&(de._status=0,de._result=De)}if(de._status===1)return de._result.default;throw de._result}var ke={current:null},ge={transition:null},Ue={ReactCurrentDispatcher:ke,ReactCurrentBatchConfig:ge,ReactCurrentOwner:nt};function $e(){throw Error("act(...) is not supported in production builds of React.")}return $n.Children={map:kn,forEach:function(de,De,ut){kn(de,function(){De.apply(this,arguments)},ut)},count:function(de){var De=0;return kn(de,function(){De++}),De},toArray:function(de){return kn(de,function(De){return De})||[]},only:function(de){if(!Ft(de))throw Error("React.Children.only expected to receive a single React element child.");return de}},$n.Component=ne,$n.Fragment=t,$n.Profiler=o,$n.PureComponent=ve,$n.StrictMode=i,$n.Suspense=v,$n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ue,$n.act=$e,$n.cloneElement=function(de,De,ut){if(de==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+de+".");var Et=q({},de.props),It=de.key,$t=de.ref,Qt=de._owner;if(De!=null){if(De.ref!==void 0&&($t=De.ref,Qt=nt.current),De.key!==void 0&&(It=""+De.key),de.type&&de.type.defaultProps)var Ut=de.type.defaultProps;for(an in De)Ne.call(De,an)&&!dt.hasOwnProperty(an)&&(Et[an]=De[an]===void 0&&Ut!==void 0?Ut[an]:De[an])}var an=arguments.length-2;if(an===1)Et.children=ut;else if(1<an){Ut=Array(an);for(var _n=0;_n<an;_n++)Ut[_n]=arguments[_n+2];Et.children=Ut}return{$$typeof:n,type:de.type,key:It,ref:$t,props:Et,_owner:Qt}},$n.createContext=function(de){return de={$$typeof:d,_currentValue:de,_currentValue2:de,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},de.Provider={$$typeof:c,_context:de},de.Consumer=de},$n.createElement=gt,$n.createFactory=function(de){var De=gt.bind(null,de);return De.type=de,De},$n.createRef=function(){return{current:null}},$n.forwardRef=function(de){return{$$typeof:a,render:de}},$n.isValidElement=Ft,$n.lazy=function(de){return{$$typeof:E,_payload:{_status:-1,_result:de},_init:Pe}},$n.memo=function(de,De){return{$$typeof:A,type:de,compare:De===void 0?null:De}},$n.startTransition=function(de){var De=ge.transition;ge.transition={};try{de()}finally{ge.transition=De}},$n.unstable_act=$e,$n.useCallback=function(de,De){return ke.current.useCallback(de,De)},$n.useContext=function(de){return ke.current.useContext(de)},$n.useDebugValue=function(){},$n.useDeferredValue=function(de){return ke.current.useDeferredValue(de)},$n.useEffect=function(de,De){return ke.current.useEffect(de,De)},$n.useId=function(){return ke.current.useId()},$n.useImperativeHandle=function(de,De,ut){return ke.current.useImperativeHandle(de,De,ut)},$n.useInsertionEffect=function(de,De){return ke.current.useInsertionEffect(de,De)},$n.useLayoutEffect=function(de,De){return ke.current.useLayoutEffect(de,De)},$n.useMemo=function(de,De){return ke.current.useMemo(de,De)},$n.useReducer=function(de,De,ut){return ke.current.useReducer(de,De,ut)},$n.useRef=function(de){return ke.current.useRef(de)},$n.useState=function(de){return ke.current.useState(de)},$n.useSyncExternalStore=function(de,De,ut){return ke.current.useSyncExternalStore(de,De,ut)},$n.useTransition=function(){return ke.current.useTransition()},$n.version="18.3.1",$n}var Gw;function kx(){return Gw||(Gw=1,xv.exports=DI()),xv.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yw;function OI(){if(Yw)return Cm;Yw=1;var n=kx(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(a,v,A){var E,k={},L=null,z=null;A!==void 0&&(L=""+A),v.key!==void 0&&(L=""+v.key),v.ref!==void 0&&(z=v.ref);for(E in v)i.call(v,E)&&!c.hasOwnProperty(E)&&(k[E]=v[E]);if(a&&a.defaultProps)for(E in v=a.defaultProps,v)k[E]===void 0&&(k[E]=v[E]);return{$$typeof:e,type:a,key:L,ref:z,props:k,_owner:o.current}}return Cm.Fragment=t,Cm.jsx=d,Cm.jsxs=d,Cm}var Kw;function LI(){return Kw||(Kw=1,vv.exports=OI()),vv.exports}var he=LI(),ye=kx();const Dd=Rx(ye),FI=uA({__proto__:null,default:Dd},[ye]);var s_={},bv={exports:{}},Eo={},wv={exports:{}},Tv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jw;function NI(){return Jw||(Jw=1,(function(n){function e(ge,Ue){var $e=ge.length;ge.push(Ue);e:for(;0<$e;){var de=$e-1>>>1,De=ge[de];if(0<o(De,Ue))ge[de]=Ue,ge[$e]=De,$e=de;else break e}}function t(ge){return ge.length===0?null:ge[0]}function i(ge){if(ge.length===0)return null;var Ue=ge[0],$e=ge.pop();if($e!==Ue){ge[0]=$e;e:for(var de=0,De=ge.length,ut=De>>>1;de<ut;){var Et=2*(de+1)-1,It=ge[Et],$t=Et+1,Qt=ge[$t];if(0>o(It,$e))$t<De&&0>o(Qt,It)?(ge[de]=Qt,ge[$t]=$e,de=$t):(ge[de]=It,ge[Et]=$e,de=Et);else if($t<De&&0>o(Qt,$e))ge[de]=Qt,ge[$t]=$e,de=$t;else break e}}return Ue}function o(ge,Ue){var $e=ge.sortIndex-Ue.sortIndex;return $e!==0?$e:ge.id-Ue.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;n.unstable_now=function(){return c.now()}}else{var d=Date,a=d.now();n.unstable_now=function(){return d.now()-a}}var v=[],A=[],E=1,k=null,L=3,z=!1,q=!1,Y=!1,ne=typeof setTimeout=="function"?setTimeout:null,ue=typeof clearTimeout=="function"?clearTimeout:null,ve=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function se(ge){for(var Ue=t(A);Ue!==null;){if(Ue.callback===null)i(A);else if(Ue.startTime<=ge)i(A),Ue.sortIndex=Ue.expirationTime,e(v,Ue);else break;Ue=t(A)}}function Se(ge){if(Y=!1,se(ge),!q)if(t(v)!==null)q=!0,Pe(Ne);else{var Ue=t(A);Ue!==null&&ke(Se,Ue.startTime-ge)}}function Ne(ge,Ue){q=!1,Y&&(Y=!1,ue(gt),gt=-1),z=!0;var $e=L;try{for(se(Ue),k=t(v);k!==null&&(!(k.expirationTime>Ue)||ge&&!Wt());){var de=k.callback;if(typeof de=="function"){k.callback=null,L=k.priorityLevel;var De=de(k.expirationTime<=Ue);Ue=n.unstable_now(),typeof De=="function"?k.callback=De:k===t(v)&&i(v),se(Ue)}else i(v);k=t(v)}if(k!==null)var ut=!0;else{var Et=t(A);Et!==null&&ke(Se,Et.startTime-Ue),ut=!1}return ut}finally{k=null,L=$e,z=!1}}var nt=!1,dt=null,gt=-1,vt=5,Ft=-1;function Wt(){return!(n.unstable_now()-Ft<vt)}function pn(){if(dt!==null){var ge=n.unstable_now();Ft=ge;var Ue=!0;try{Ue=dt(!0,ge)}finally{Ue?sn():(nt=!1,dt=null)}}else nt=!1}var sn;if(typeof ve=="function")sn=function(){ve(pn)};else if(typeof MessageChannel<"u"){var rn=new MessageChannel,kn=rn.port2;rn.port1.onmessage=pn,sn=function(){kn.postMessage(null)}}else sn=function(){ne(pn,0)};function Pe(ge){dt=ge,nt||(nt=!0,sn())}function ke(ge,Ue){gt=ne(function(){ge(n.unstable_now())},Ue)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ge){ge.callback=null},n.unstable_continueExecution=function(){q||z||(q=!0,Pe(Ne))},n.unstable_forceFrameRate=function(ge){0>ge||125<ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):vt=0<ge?Math.floor(1e3/ge):5},n.unstable_getCurrentPriorityLevel=function(){return L},n.unstable_getFirstCallbackNode=function(){return t(v)},n.unstable_next=function(ge){switch(L){case 1:case 2:case 3:var Ue=3;break;default:Ue=L}var $e=L;L=Ue;try{return ge()}finally{L=$e}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ge,Ue){switch(ge){case 1:case 2:case 3:case 4:case 5:break;default:ge=3}var $e=L;L=ge;try{return Ue()}finally{L=$e}},n.unstable_scheduleCallback=function(ge,Ue,$e){var de=n.unstable_now();switch(typeof $e=="object"&&$e!==null?($e=$e.delay,$e=typeof $e=="number"&&0<$e?de+$e:de):$e=de,ge){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=$e+De,ge={id:E++,callback:Ue,priorityLevel:ge,startTime:$e,expirationTime:De,sortIndex:-1},$e>de?(ge.sortIndex=$e,e(A,ge),t(v)===null&&ge===t(A)&&(Y?(ue(gt),gt=-1):Y=!0,ke(Se,$e-de))):(ge.sortIndex=De,e(v,ge),q||z||(q=!0,Pe(Ne))),ge},n.unstable_shouldYield=Wt,n.unstable_wrapCallback=function(ge){var Ue=L;return function(){var $e=L;L=Ue;try{return ge.apply(this,arguments)}finally{L=$e}}}})(Tv)),Tv}var Qw;function BI(){return Qw||(Qw=1,wv.exports=NI()),wv.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e1;function zI(){if(e1)return Eo;e1=1;var n=kx(),e=BI();function t(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,S=1;S<arguments.length;S++)g+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,o={};function c(f,g){d(f,g),d(f+"Capture",g)}function d(f,g){for(o[f]=g,f=0;f<g.length;f++)i.add(g[f])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,A=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,E={},k={};function L(f){return v.call(k,f)?!0:v.call(E,f)?!1:A.test(f)?k[f]=!0:(E[f]=!0,!1)}function z(f,g,S,I){if(S!==null&&S.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return I?!1:S!==null?!S.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function q(f,g,S,I){if(g===null||typeof g>"u"||z(f,g,S,I))return!0;if(I)return!1;if(S!==null)switch(S.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function Y(f,g,S,I,N,V,ee){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=I,this.attributeNamespace=N,this.mustUseProperty=S,this.propertyName=f,this.type=g,this.sanitizeURL=V,this.removeEmptyString=ee}var ne={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){ne[f]=new Y(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];ne[g]=new Y(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){ne[f]=new Y(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){ne[f]=new Y(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){ne[f]=new Y(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){ne[f]=new Y(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){ne[f]=new Y(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){ne[f]=new Y(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){ne[f]=new Y(f,5,!1,f.toLowerCase(),null,!1,!1)});var ue=/[\-:]([a-z])/g;function ve(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(ue,ve);ne[g]=new Y(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(ue,ve);ne[g]=new Y(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(ue,ve);ne[g]=new Y(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){ne[f]=new Y(f,1,!1,f.toLowerCase(),null,!1,!1)}),ne.xlinkHref=new Y("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){ne[f]=new Y(f,1,!1,f.toLowerCase(),null,!0,!0)});function se(f,g,S,I){var N=ne.hasOwnProperty(g)?ne[g]:null;(N!==null?N.type!==0:I||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(q(g,S,N,I)&&(S=null),I||N===null?L(g)&&(S===null?f.removeAttribute(g):f.setAttribute(g,""+S)):N.mustUseProperty?f[N.propertyName]=S===null?N.type===3?!1:"":S:(g=N.attributeName,I=N.attributeNamespace,S===null?f.removeAttribute(g):(N=N.type,S=N===3||N===4&&S===!0?"":""+S,I?f.setAttributeNS(I,g,S):f.setAttribute(g,S))))}var Se=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ne=Symbol.for("react.element"),nt=Symbol.for("react.portal"),dt=Symbol.for("react.fragment"),gt=Symbol.for("react.strict_mode"),vt=Symbol.for("react.profiler"),Ft=Symbol.for("react.provider"),Wt=Symbol.for("react.context"),pn=Symbol.for("react.forward_ref"),sn=Symbol.for("react.suspense"),rn=Symbol.for("react.suspense_list"),kn=Symbol.for("react.memo"),Pe=Symbol.for("react.lazy"),ke=Symbol.for("react.offscreen"),ge=Symbol.iterator;function Ue(f){return f===null||typeof f!="object"?null:(f=ge&&f[ge]||f["@@iterator"],typeof f=="function"?f:null)}var $e=Object.assign,de;function De(f){if(de===void 0)try{throw Error()}catch(S){var g=S.stack.trim().match(/\n( *(at )?)/);de=g&&g[1]||""}return`
`+de+f}var ut=!1;function Et(f,g){if(!f||ut)return"";ut=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(ot){var I=ot}Reflect.construct(f,[],g)}else{try{g.call()}catch(ot){I=ot}f.call(g.prototype)}else{try{throw Error()}catch(ot){I=ot}f()}}catch(ot){if(ot&&I&&typeof ot.stack=="string"){for(var N=ot.stack.split(`
`),V=I.stack.split(`
`),ee=N.length-1,Ee=V.length-1;1<=ee&&0<=Ee&&N[ee]!==V[Ee];)Ee--;for(;1<=ee&&0<=Ee;ee--,Ee--)if(N[ee]!==V[Ee]){if(ee!==1||Ee!==1)do if(ee--,Ee--,0>Ee||N[ee]!==V[Ee]){var Oe=`
`+N[ee].replace(" at new "," at ");return f.displayName&&Oe.includes("<anonymous>")&&(Oe=Oe.replace("<anonymous>",f.displayName)),Oe}while(1<=ee&&0<=Ee);break}}}finally{ut=!1,Error.prepareStackTrace=S}return(f=f?f.displayName||f.name:"")?De(f):""}function It(f){switch(f.tag){case 5:return De(f.type);case 16:return De("Lazy");case 13:return De("Suspense");case 19:return De("SuspenseList");case 0:case 2:case 15:return f=Et(f.type,!1),f;case 11:return f=Et(f.type.render,!1),f;case 1:return f=Et(f.type,!0),f;default:return""}}function $t(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case dt:return"Fragment";case nt:return"Portal";case vt:return"Profiler";case gt:return"StrictMode";case sn:return"Suspense";case rn:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case Wt:return(f.displayName||"Context")+".Consumer";case Ft:return(f._context.displayName||"Context")+".Provider";case pn:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case kn:return g=f.displayName||null,g!==null?g:$t(f.type)||"Memo";case Pe:g=f._payload,f=f._init;try{return $t(f(g))}catch{}}return null}function Qt(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $t(g);case 8:return g===gt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function Ut(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function an(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function _n(f){var g=an(f)?"checked":"value",S=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),I=""+f[g];if(!f.hasOwnProperty(g)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var N=S.get,V=S.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return N.call(this)},set:function(ee){I=""+ee,V.call(this,ee)}}),Object.defineProperty(f,g,{enumerable:S.enumerable}),{getValue:function(){return I},setValue:function(ee){I=""+ee},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function Gi(f){f._valueTracker||(f._valueTracker=_n(f))}function Ii(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var S=g.getValue(),I="";return f&&(I=an(f)?f.checked?"true":"false":f.value),f=I,f!==S?(g.setValue(f),!0):!1}function Hn(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function ri(f,g){var S=g.checked;return $e({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S??f._wrapperState.initialChecked})}function xt(f,g){var S=g.defaultValue==null?"":g.defaultValue,I=g.checked!=null?g.checked:g.defaultChecked;S=Ut(g.value!=null?g.value:S),f._wrapperState={initialChecked:I,initialValue:S,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Pt(f,g){g=g.checked,g!=null&&se(f,"checked",g,!1)}function Yt(f,g){Pt(f,g);var S=Ut(g.value),I=g.type;if(S!=null)I==="number"?(S===0&&f.value===""||f.value!=S)&&(f.value=""+S):f.value!==""+S&&(f.value=""+S);else if(I==="submit"||I==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?Nn(f,g.type,S):g.hasOwnProperty("defaultValue")&&Nn(f,g.type,Ut(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function Sn(f,g,S){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var I=g.type;if(!(I!=="submit"&&I!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,S||g===f.value||(f.value=g),f.defaultValue=g}S=f.name,S!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,S!==""&&(f.name=S)}function Nn(f,g,S){(g!=="number"||Hn(f.ownerDocument)!==f)&&(S==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+S&&(f.defaultValue=""+S))}var Yn=Array.isArray;function yi(f,g,S,I){if(f=f.options,g){g={};for(var N=0;N<S.length;N++)g["$"+S[N]]=!0;for(S=0;S<f.length;S++)N=g.hasOwnProperty("$"+f[S].value),f[S].selected!==N&&(f[S].selected=N),N&&I&&(f[S].defaultSelected=!0)}else{for(S=""+Ut(S),g=null,N=0;N<f.length;N++){if(f[N].value===S){f[N].selected=!0,I&&(f[N].defaultSelected=!0);return}g!==null||f[N].disabled||(g=f[N])}g!==null&&(g.selected=!0)}}function hs(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(t(91));return $e({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function Es(f,g){var S=g.value;if(S==null){if(S=g.children,g=g.defaultValue,S!=null){if(g!=null)throw Error(t(92));if(Yn(S)){if(1<S.length)throw Error(t(93));S=S[0]}g=S}g==null&&(g=""),S=g}f._wrapperState={initialValue:Ut(S)}}function ds(f,g){var S=Ut(g.value),I=Ut(g.defaultValue);S!=null&&(S=""+S,S!==f.value&&(f.value=S),g.defaultValue==null&&f.defaultValue!==S&&(f.defaultValue=S)),I!=null&&(f.defaultValue=""+I)}function Kr(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function Zs(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Jr(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?Zs(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var Ps,Le=(function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,S,I,N){MSApp.execUnsafeLocalFunction(function(){return f(g,S,I,N)})}:f})(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(Ps=Ps||document.createElement("div"),Ps.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Ps.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function K(f,g){if(g){var S=f.firstChild;if(S&&S===f.lastChild&&S.nodeType===3){S.nodeValue=g;return}}f.textContent=g}var J={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ie=["Webkit","ms","Moz","O"];Object.keys(J).forEach(function(f){ie.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),J[g]=J[f]})});function we(f,g,S){return g==null||typeof g=="boolean"||g===""?"":S||typeof g!="number"||g===0||J.hasOwnProperty(f)&&J[f]?(""+g).trim():g+"px"}function Ce(f,g){f=f.style;for(var S in g)if(g.hasOwnProperty(S)){var I=S.indexOf("--")===0,N=we(S,g[S],I);S==="float"&&(S="cssFloat"),I?f.setProperty(S,N):f[S]=N}}var Fe=$e({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ke(f,g){if(g){if(Fe[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(t(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(t(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(t(61))}if(g.style!=null&&typeof g.style!="object")throw Error(t(62))}}function ze(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rt=null;function mt(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var at=null,zt=null,Be=null;function un(f){if(f=Qa(f)){if(typeof at!="function")throw Error(t(280));var g=f.stateNode;g&&(g=nu(g),at(f.stateNode,f.type,g))}}function Dn(f){zt?Be?Be.push(f):Be=[f]:zt=f}function Xt(){if(zt){var f=zt,g=Be;if(Be=zt=null,un(f),g)for(f=0;f<g.length;f++)un(g[f])}}function yn(f,g){return f(g)}function ai(){}var Ei=!1;function $i(f,g,S){if(Ei)return f(g,S);Ei=!0;try{return yn(f,g,S)}finally{Ei=!1,(zt!==null||Be!==null)&&(ai(),Xt())}}function Pi(f,g){var S=f.stateNode;if(S===null)return null;var I=nu(S);if(I===null)return null;S=I[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(f=f.type,I=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!I;break e;default:f=!1}if(f)return null;if(S&&typeof S!="function")throw Error(t(231,g,typeof S));return S}var Li=!1;if(a)try{var Kn={};Object.defineProperty(Kn,"passive",{get:function(){Li=!0}}),window.addEventListener("test",Kn,Kn),window.removeEventListener("test",Kn,Kn)}catch{Li=!1}function Fi(f,g,S,I,N,V,ee,Ee,Oe){var ot=Array.prototype.slice.call(arguments,3);try{g.apply(S,ot)}catch(Tt){this.onError(Tt)}}var lt=!1,bi=null,xr=!1,Co=null,br={onError:function(f){lt=!0,bi=f}};function wt(f,g,S,I,N,V,ee,Ee,Oe){lt=!1,bi=null,Fi.apply(br,arguments)}function wn(f,g,S,I,N,V,ee,Ee,Oe){if(wt.apply(this,arguments),lt){if(lt){var ot=bi;lt=!1,bi=null}else throw Error(t(198));xr||(xr=!0,Co=ot)}}function mn(f){var g=f,S=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(S=g.return),f=g.return;while(f)}return g.tag===3?S:null}function tr(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function ta(f){if(mn(f)!==f)throw Error(t(188))}function na(f){var g=f.alternate;if(!g){if(g=mn(f),g===null)throw Error(t(188));return g!==f?null:f}for(var S=f,I=g;;){var N=S.return;if(N===null)break;var V=N.alternate;if(V===null){if(I=N.return,I!==null){S=I;continue}break}if(N.child===V.child){for(V=N.child;V;){if(V===S)return ta(N),f;if(V===I)return ta(N),g;V=V.sibling}throw Error(t(188))}if(S.return!==I.return)S=N,I=V;else{for(var ee=!1,Ee=N.child;Ee;){if(Ee===S){ee=!0,S=N,I=V;break}if(Ee===I){ee=!0,I=N,S=V;break}Ee=Ee.sibling}if(!ee){for(Ee=V.child;Ee;){if(Ee===S){ee=!0,S=V,I=N;break}if(Ee===I){ee=!0,I=V,S=N;break}Ee=Ee.sibling}if(!ee)throw Error(t(189))}}if(S.alternate!==I)throw Error(t(190))}if(S.tag!==3)throw Error(t(188));return S.stateNode.current===S?f:g}function vn(f){return f=na(f),f!==null?Mc(f):null}function Mc(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=Mc(f);if(g!==null)return g;f=f.sibling}return null}var Io=e.unstable_scheduleCallback,Rc=e.unstable_cancelCallback,ho=e.unstable_shouldYield,Il=e.unstable_requestPaint,Pn=e.unstable_now,Ru=e.unstable_getCurrentPriorityLevel,wr=e.unstable_ImmediatePriority,ei=e.unstable_UserBlockingPriority,kc=e.unstable_NormalPriority,Dc=e.unstable_LowPriority,ku=e.unstable_IdlePriority,Xs=null,dr=null;function Dh(f){if(dr&&typeof dr.onCommitFiberRoot=="function")try{dr.onCommitFiberRoot(Xs,f,void 0,(f.current.flags&128)===128)}catch{}}var Cs=Math.clz32?Math.clz32:Jd,Kd=Math.log,Ml=Math.LN2;function Jd(f){return f>>>=0,f===0?32:31-(Kd(f)/Ml|0)|0}var Du=64,Ou=4194304;function Oc(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Rl(f,g){var S=f.pendingLanes;if(S===0)return 0;var I=0,N=f.suspendedLanes,V=f.pingedLanes,ee=S&268435455;if(ee!==0){var Ee=ee&~N;Ee!==0?I=Oc(Ee):(V&=ee,V!==0&&(I=Oc(V)))}else ee=S&~N,ee!==0?I=Oc(ee):V!==0&&(I=Oc(V));if(I===0)return 0;if(g!==0&&g!==I&&(g&N)===0&&(N=I&-I,V=g&-g,N>=V||N===16&&(V&4194240)!==0))return g;if((I&4)!==0&&(I|=S&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=I;0<g;)S=31-Cs(g),N=1<<S,I|=f[S],g&=~N;return I}function kl(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Oh(f,g){for(var S=f.suspendedLanes,I=f.pingedLanes,N=f.expirationTimes,V=f.pendingLanes;0<V;){var ee=31-Cs(V),Ee=1<<ee,Oe=N[ee];Oe===-1?((Ee&S)===0||(Ee&I)!==0)&&(N[ee]=kl(Ee,g)):Oe<=g&&(f.expiredLanes|=Ee),V&=~Ee}}function Lc(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function Ba(){var f=Du;return Du<<=1,(Du&4194240)===0&&(Du=64),f}function Fc(f){for(var g=[],S=0;31>S;S++)g.push(f);return g}function za(f,g,S){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-Cs(g),f[g]=S}function Up(f,g){var S=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var I=f.eventTimes;for(f=f.expirationTimes;0<S;){var N=31-Cs(S),V=1<<N;g[N]=0,I[N]=-1,f[N]=-1,S&=~V}}function ia(f,g){var S=f.entangledLanes|=g;for(f=f.entanglements;S;){var I=31-Cs(S),N=1<<I;N&g|f[I]&g&&(f[I]|=g),S&=~N}}var Zn=0;function Is(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var Cn,Mo,Ro,fo,ra,An=!1,po=[],qs=null,Gs=null,Mi=null,Ri=new Map,Yi=new Map,li=[],si="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lh(f,g){switch(f){case"focusin":case"focusout":qs=null;break;case"dragenter":case"dragleave":Gs=null;break;case"mouseover":case"mouseout":Mi=null;break;case"pointerover":case"pointerout":Ri.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yi.delete(g.pointerId)}}function Ki(f,g,S,I,N,V){return f===null||f.nativeEvent!==V?(f={blockedOn:g,domEventName:S,eventSystemFlags:I,nativeEvent:V,targetContainers:[N]},g!==null&&(g=Qa(g),g!==null&&Mo(g)),f):(f.eventSystemFlags|=I,g=f.targetContainers,N!==null&&g.indexOf(N)===-1&&g.push(N),f)}function fs(f,g,S,I,N){switch(g){case"focusin":return qs=Ki(qs,f,g,S,I,N),!0;case"dragenter":return Gs=Ki(Gs,f,g,S,I,N),!0;case"mouseover":return Mi=Ki(Mi,f,g,S,I,N),!0;case"pointerover":var V=N.pointerId;return Ri.set(V,Ki(Ri.get(V)||null,f,g,S,I,N)),!0;case"gotpointercapture":return V=N.pointerId,Yi.set(V,Ki(Yi.get(V)||null,f,g,S,I,N)),!0}return!1}function fr(f){var g=to(f.target);if(g!==null){var S=mn(g);if(S!==null){if(g=S.tag,g===13){if(g=tr(S),g!==null){f.blockedOn=g,ra(f.priority,function(){Ro(S)});return}}else if(g===3&&S.stateNode.current.memoizedState.isDehydrated){f.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}f.blockedOn=null}function ti(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var S=oa(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(S===null){S=f.nativeEvent;var I=new S.constructor(S.type,S);rt=I,S.target.dispatchEvent(I),rt=null}else return g=Qa(S),g!==null&&Mo(g),f.blockedOn=S,!1;g.shift()}return!0}function sa(f,g,S){ti(f)&&S.delete(g)}function on(){An=!1,qs!==null&&ti(qs)&&(qs=null),Gs!==null&&ti(Gs)&&(Gs=null),Mi!==null&&ti(Mi)&&(Mi=null),Ri.forEach(sa),Yi.forEach(sa)}function hn(f,g){f.blockedOn===g&&(f.blockedOn=null,An||(An=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,on)))}function ps(f){function g(N){return hn(N,f)}if(0<po.length){hn(po[0],f);for(var S=1;S<po.length;S++){var I=po[S];I.blockedOn===f&&(I.blockedOn=null)}}for(qs!==null&&hn(qs,f),Gs!==null&&hn(Gs,f),Mi!==null&&hn(Mi,f),Ri.forEach(g),Yi.forEach(g),S=0;S<li.length;S++)I=li[S],I.blockedOn===f&&(I.blockedOn=null);for(;0<li.length&&(S=li[0],S.blockedOn===null);)fr(S),S.blockedOn===null&&li.shift()}var In=Se.ReactCurrentBatchConfig,Tr=!0;function mo(f,g,S,I){var N=Zn,V=In.transition;In.transition=null;try{Zn=1,Dl(f,g,S,I)}finally{Zn=N,In.transition=V}}function go(f,g,S,I){var N=Zn,V=In.transition;In.transition=null;try{Zn=4,Dl(f,g,S,I)}finally{Zn=N,In.transition=V}}function Dl(f,g,S,I){if(Tr){var N=oa(f,g,S,I);if(N===null)Xa(f,g,I,Ol,S),Lh(f,I);else if(fs(N,f,g,S,I))I.stopPropagation();else if(Lh(f,I),g&4&&-1<si.indexOf(f)){for(;N!==null;){var V=Qa(N);if(V!==null&&Cn(V),V=oa(f,g,S,I),V===null&&Xa(f,g,I,Ol,S),V===N)break;N=V}N!==null&&I.stopPropagation()}else Xa(f,g,I,null,S)}}var Ol=null;function oa(f,g,S,I){if(Ol=null,f=mt(I),f=to(f),f!==null)if(g=mn(f),g===null)f=null;else if(S=g.tag,S===13){if(f=tr(g),f!==null)return f;f=null}else if(S===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return Ol=f,null}function Ll(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ru()){case wr:return 1;case ei:return 4;case kc:case Dc:return 16;case ku:return 536870912;default:return 16}default:return 16}}var Ys=null,Fl=null,Ua=null;function Ms(){if(Ua)return Ua;var f,g=Fl,S=g.length,I,N="value"in Ys?Ys.value:Ys.textContent,V=N.length;for(f=0;f<S&&g[f]===N[f];f++);var ee=S-f;for(I=1;I<=ee&&g[S-I]===N[V-I];I++);return Ua=N.slice(f,1<I?1-I:void 0)}function Ni(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function ko(){return!0}function Nl(){return!1}function Ji(f){function g(S,I,N,V,ee){this._reactName=S,this._targetInst=N,this.type=I,this.nativeEvent=V,this.target=ee,this.currentTarget=null;for(var Ee in f)f.hasOwnProperty(Ee)&&(S=f[Ee],this[Ee]=S?S(V):V[Ee]);return this.isDefaultPrevented=(V.defaultPrevented!=null?V.defaultPrevented:V.returnValue===!1)?ko:Nl,this.isPropagationStopped=Nl,this}return $e(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=ko)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=ko)},persist:function(){},isPersistent:ko}),g}var ci={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Lu=Ji(ci),Do=$e({},ci,{view:0,detail:0}),Fh=Ji(Do),Nh,aa,Bi,la=$e({},Do,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bl,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Bi&&(Bi&&f.type==="mousemove"?(Nh=f.screenX-Bi.screenX,aa=f.screenY-Bi.screenY):aa=Nh=0,Bi=f),Nh)},movementY:function(f){return"movementY"in f?f.movementY:aa}}),Ks=Ji(la),Nc=$e({},la,{dataTransfer:0}),Bc=Ji(Nc),zc=$e({},Do,{relatedTarget:0}),nr=Ji(zc),Qd=$e({},ci,{animationName:0,elapsedTime:0,pseudoElement:0}),Fu=Ji(Qd),jp=$e({},ci,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Bh=Ji(jp),Vp=$e({},ci,{data:0}),ef=Ji(Vp),Nu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ja={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Uh(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=ja[f])?!!g[f]:!1}function Bl(){return Uh}var Js=$e({},Do,{key:function(f){if(f.key){var g=Nu[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=Ni(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?zh[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bl,charCode:function(f){return f.type==="keypress"?Ni(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Ni(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),$p=Ji(Js),Bu=$e({},la,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zl=Ji(Bu),Uc=$e({},Do,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bl}),Wp=Ji(Uc),zu=$e({},ci,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hp=Ji(zu),Va=$e({},la,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),tf=Ji(Va),jh=[9,13,27,32],Vh=a&&"CompositionEvent"in window,Ul=null;a&&"documentMode"in document&&(Ul=document.documentMode);var $h=a&&"TextEvent"in window&&!Ul,Wh=a&&(!Vh||Ul&&8<Ul&&11>=Ul),jc=" ",Hh=!1;function Zh(f,g){switch(f){case"keyup":return jh.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ca(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var ua=!1;function Xh(f,g){switch(f){case"compositionend":return ca(g);case"keypress":return g.which!==32?null:(Hh=!0,jc);case"textInput":return f=g.data,f===jc&&Hh?null:f;default:return null}}function Vc(f,g){if(ua)return f==="compositionend"||!Vh&&Zh(f,g)?(f=Ms(),Ua=Fl=Ys=null,ua=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Wh&&g.locale!=="ko"?null:g.data;default:return null}}var Zp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jl(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!Zp[f.type]:g==="textarea"}function qh(f,g,S,I){Dn(I),g=Kc(g,"onChange"),0<g.length&&(S=new Lu("onChange","change",null,S,I),f.push({event:S,listeners:g}))}var $c=null,Vl=null;function nf(f){af(f,0)}function $l(f){var g=el(f);if(Ii(g))return f}function Gh(f,g){if(f==="change")return g}var Yh=!1;if(a){var Wl;if(a){var Qs="oninput"in document;if(!Qs){var zn=document.createElement("div");zn.setAttribute("oninput","return;"),Qs=typeof zn.oninput=="function"}Wl=Qs}else Wl=!1;Yh=Wl&&(!document.documentMode||9<document.documentMode)}function Uu(){$c&&($c.detachEvent("onpropertychange",ju),Vl=$c=null)}function ju(f){if(f.propertyName==="value"&&$l(Vl)){var g=[];qh(g,Vl,f,mt(f)),$i(nf,g)}}function rf(f,g,S){f==="focusin"?(Uu(),$c=g,Vl=S,$c.attachEvent("onpropertychange",ju)):f==="focusout"&&Uu()}function Kh(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return $l(Vl)}function $a(f,g){if(f==="click")return $l(g)}function Jh(f,g){if(f==="input"||f==="change")return $l(g)}function Xp(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var eo=typeof Object.is=="function"?Object.is:Xp;function Wc(f,g){if(eo(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var S=Object.keys(f),I=Object.keys(g);if(S.length!==I.length)return!1;for(I=0;I<S.length;I++){var N=S[I];if(!v.call(g,N)||!eo(f[N],g[N]))return!1}return!0}function sf(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function Qh(f,g){var S=sf(f);f=0;for(var I;S;){if(S.nodeType===3){if(I=f+S.textContent.length,f<=g&&I>=g)return{node:S,offset:g-f};f=I}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=sf(S)}}function of(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?of(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function ed(){for(var f=window,g=Hn();g instanceof f.HTMLIFrameElement;){try{var S=typeof g.contentWindow.location.href=="string"}catch{S=!1}if(S)f=g.contentWindow;else break;g=Hn(f.document)}return g}function Hl(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function Vu(f){var g=ed(),S=f.focusedElem,I=f.selectionRange;if(g!==S&&S&&S.ownerDocument&&of(S.ownerDocument.documentElement,S)){if(I!==null&&Hl(S)){if(g=I.start,f=I.end,f===void 0&&(f=g),"selectionStart"in S)S.selectionStart=g,S.selectionEnd=Math.min(f,S.value.length);else if(f=(g=S.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var N=S.textContent.length,V=Math.min(I.start,N);I=I.end===void 0?V:Math.min(I.end,N),!f.extend&&V>I&&(N=I,I=V,V=N),N=Qh(S,V);var ee=Qh(S,I);N&&ee&&(f.rangeCount!==1||f.anchorNode!==N.node||f.anchorOffset!==N.offset||f.focusNode!==ee.node||f.focusOffset!==ee.offset)&&(g=g.createRange(),g.setStart(N.node,N.offset),f.removeAllRanges(),V>I?(f.addRange(g),f.extend(ee.node,ee.offset)):(g.setEnd(ee.node,ee.offset),f.addRange(g)))}}for(g=[],f=S;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<g.length;S++)f=g[S],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var $u=a&&"documentMode"in document&&11>=document.documentMode,ha=null,Oo=null,Lo=null,da=!1;function ms(f,g,S){var I=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;da||ha==null||ha!==Hn(I)||(I=ha,"selectionStart"in I&&Hl(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),Lo&&Wc(Lo,I)||(Lo=I,I=Kc(Oo,"onSelect"),0<I.length&&(g=new Lu("onSelect","select",null,g,S),f.push({event:g,listeners:I}),g.target=ha)))}function Hc(f,g){var S={};return S[f.toLowerCase()]=g.toLowerCase(),S["Webkit"+f]="webkit"+g,S["Moz"+f]="moz"+g,S}var Wa={animationend:Hc("Animation","AnimationEnd"),animationiteration:Hc("Animation","AnimationIteration"),animationstart:Hc("Animation","AnimationStart"),transitionend:Hc("Transition","TransitionEnd")},Zc={},fa={};a&&(fa=document.createElement("div").style,"AnimationEvent"in window||(delete Wa.animationend.animation,delete Wa.animationiteration.animation,delete Wa.animationstart.animation),"TransitionEvent"in window||delete Wa.transitionend.transition);function Ha(f){if(Zc[f])return Zc[f];if(!Wa[f])return f;var g=Wa[f],S;for(S in g)if(g.hasOwnProperty(S)&&S in fa)return Zc[f]=g[S];return f}var Xc=Ha("animationend"),Zl=Ha("animationiteration"),qc=Ha("animationstart"),td=Ha("transitionend"),Za=new Map,Fo="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function No(f,g){Za.set(f,g),c(g,[f])}for(var Gc=0;Gc<Fo.length;Gc++){var Mn=Fo[Gc],Yc=Mn.toLowerCase(),qp=Mn[0].toUpperCase()+Mn.slice(1);No(Yc,"on"+qp)}No(Xc,"onAnimationEnd"),No(Zl,"onAnimationIteration"),No(qc,"onAnimationStart"),No("dblclick","onDoubleClick"),No("focusin","onFocus"),No("focusout","onBlur"),No(td,"onTransitionEnd"),d("onMouseEnter",["mouseout","mouseover"]),d("onMouseLeave",["mouseout","mouseover"]),d("onPointerEnter",["pointerout","pointerover"]),d("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pa=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xl));function nd(f,g,S){var I=f.type||"unknown-event";f.currentTarget=S,wn(I,g,void 0,f),f.currentTarget=null}function af(f,g){g=(g&4)!==0;for(var S=0;S<f.length;S++){var I=f[S],N=I.event;I=I.listeners;e:{var V=void 0;if(g)for(var ee=I.length-1;0<=ee;ee--){var Ee=I[ee],Oe=Ee.instance,ot=Ee.currentTarget;if(Ee=Ee.listener,Oe!==V&&N.isPropagationStopped())break e;nd(N,Ee,ot),V=Oe}else for(ee=0;ee<I.length;ee++){if(Ee=I[ee],Oe=Ee.instance,ot=Ee.currentTarget,Ee=Ee.listener,Oe!==V&&N.isPropagationStopped())break e;nd(N,Ee,ot),V=Oe}}}if(xr)throw f=Co,xr=!1,Co=null,f}function fi(f,g){var S=g[tu];S===void 0&&(S=g[tu]=new Set);var I=f+"__bubble";S.has(I)||(Gl(g,f,2,!1),S.add(I))}function id(f,g,S){var I=0;g&&(I|=4),Gl(S,f,I,g)}var ql="_reactListening"+Math.random().toString(36).slice(2);function ma(f){if(!f[ql]){f[ql]=!0,i.forEach(function(S){S!=="selectionchange"&&(pa.has(S)||id(S,!1,f),id(S,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[ql]||(g[ql]=!0,id("selectionchange",!1,g))}}function Gl(f,g,S,I){switch(Ll(g)){case 1:var N=mo;break;case 4:N=go;break;default:N=Dl}S=N.bind(null,g,S,f),N=void 0,!Li||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(N=!0),I?N!==void 0?f.addEventListener(g,S,{capture:!0,passive:N}):f.addEventListener(g,S,!0):N!==void 0?f.addEventListener(g,S,{passive:N}):f.addEventListener(g,S,!1)}function Xa(f,g,S,I,N){var V=I;if((g&1)===0&&(g&2)===0&&I!==null)e:for(;;){if(I===null)return;var ee=I.tag;if(ee===3||ee===4){var Ee=I.stateNode.containerInfo;if(Ee===N||Ee.nodeType===8&&Ee.parentNode===N)break;if(ee===4)for(ee=I.return;ee!==null;){var Oe=ee.tag;if((Oe===3||Oe===4)&&(Oe=ee.stateNode.containerInfo,Oe===N||Oe.nodeType===8&&Oe.parentNode===N))return;ee=ee.return}for(;Ee!==null;){if(ee=to(Ee),ee===null)return;if(Oe=ee.tag,Oe===5||Oe===6){I=V=ee;continue e}Ee=Ee.parentNode}}I=I.return}$i(function(){var ot=V,Tt=mt(S),At=[];e:{var yt=Za.get(f);if(yt!==void 0){var Ht=Lu,Kt=f;switch(f){case"keypress":if(Ni(S)===0)break e;case"keydown":case"keyup":Ht=$p;break;case"focusin":Kt="focus",Ht=nr;break;case"focusout":Kt="blur",Ht=nr;break;case"beforeblur":case"afterblur":Ht=nr;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ht=Ks;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ht=Bc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ht=Wp;break;case Xc:case Zl:case qc:Ht=Fu;break;case td:Ht=Hp;break;case"scroll":Ht=Fh;break;case"wheel":Ht=tf;break;case"copy":case"cut":case"paste":Ht=Bh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ht=zl}var Jt=(g&4)!==0,Qi=!Jt&&f==="scroll",Qe=Jt?yt!==null?yt+"Capture":null:yt;Jt=[];for(var Ve=ot,it;Ve!==null;){it=Ve;var Lt=it.stateNode;if(it.tag===5&&Lt!==null&&(it=Lt,Qe!==null&&(Lt=Pi(Ve,Qe),Lt!=null&&Jt.push(qa(Ve,Lt,it)))),Qi)break;Ve=Ve.return}0<Jt.length&&(yt=new Ht(yt,Kt,null,S,Tt),At.push({event:yt,listeners:Jt}))}}if((g&7)===0){e:{if(yt=f==="mouseover"||f==="pointerover",Ht=f==="mouseout"||f==="pointerout",yt&&S!==rt&&(Kt=S.relatedTarget||S.fromElement)&&(to(Kt)||Kt[ks]))break e;if((Ht||yt)&&(yt=Tt.window===Tt?Tt:(yt=Tt.ownerDocument)?yt.defaultView||yt.parentWindow:window,Ht?(Kt=S.relatedTarget||S.toElement,Ht=ot,Kt=Kt?to(Kt):null,Kt!==null&&(Qi=mn(Kt),Kt!==Qi||Kt.tag!==5&&Kt.tag!==6)&&(Kt=null)):(Ht=null,Kt=ot),Ht!==Kt)){if(Jt=Ks,Lt="onMouseLeave",Qe="onMouseEnter",Ve="mouse",(f==="pointerout"||f==="pointerover")&&(Jt=zl,Lt="onPointerLeave",Qe="onPointerEnter",Ve="pointer"),Qi=Ht==null?yt:el(Ht),it=Kt==null?yt:el(Kt),yt=new Jt(Lt,Ve+"leave",Ht,S,Tt),yt.target=Qi,yt.relatedTarget=it,Lt=null,to(Tt)===ot&&(Jt=new Jt(Qe,Ve+"enter",Kt,S,Tt),Jt.target=it,Jt.relatedTarget=Qi,Lt=Jt),Qi=Lt,Ht&&Kt)t:{for(Jt=Ht,Qe=Kt,Ve=0,it=Jt;it;it=_o(it))Ve++;for(it=0,Lt=Qe;Lt;Lt=_o(Lt))it++;for(;0<Ve-it;)Jt=_o(Jt),Ve--;for(;0<it-Ve;)Qe=_o(Qe),it--;for(;Ve--;){if(Jt===Qe||Qe!==null&&Jt===Qe.alternate)break t;Jt=_o(Jt),Qe=_o(Qe)}Jt=null}else Jt=null;Ht!==null&&Yl(At,yt,Ht,Jt,!1),Kt!==null&&Qi!==null&&Yl(At,Qi,Kt,Jt,!0)}}e:{if(yt=ot?el(ot):window,Ht=yt.nodeName&&yt.nodeName.toLowerCase(),Ht==="select"||Ht==="input"&&yt.type==="file")var en=Gh;else if(jl(yt))if(Yh)en=Jh;else{en=Kh;var dn=rf}else(Ht=yt.nodeName)&&Ht.toLowerCase()==="input"&&(yt.type==="checkbox"||yt.type==="radio")&&(en=$a);if(en&&(en=en(f,ot))){qh(At,en,S,Tt);break e}dn&&dn(f,yt,ot),f==="focusout"&&(dn=yt._wrapperState)&&dn.controlled&&yt.type==="number"&&Nn(yt,"number",yt.value)}switch(dn=ot?el(ot):window,f){case"focusin":(jl(dn)||dn.contentEditable==="true")&&(ha=dn,Oo=ot,Lo=null);break;case"focusout":Lo=Oo=ha=null;break;case"mousedown":da=!0;break;case"contextmenu":case"mouseup":case"dragend":da=!1,ms(At,S,Tt);break;case"selectionchange":if($u)break;case"keydown":case"keyup":ms(At,S,Tt)}var nn;if(Vh)e:{switch(f){case"compositionstart":var cn="onCompositionStart";break e;case"compositionend":cn="onCompositionEnd";break e;case"compositionupdate":cn="onCompositionUpdate";break e}cn=void 0}else ua?Zh(f,S)&&(cn="onCompositionEnd"):f==="keydown"&&S.keyCode===229&&(cn="onCompositionStart");cn&&(Wh&&S.locale!=="ko"&&(ua||cn!=="onCompositionStart"?cn==="onCompositionEnd"&&ua&&(nn=Ms()):(Ys=Tt,Fl="value"in Ys?Ys.value:Ys.textContent,ua=!0)),dn=Kc(ot,cn),0<dn.length&&(cn=new ef(cn,f,null,S,Tt),At.push({event:cn,listeners:dn}),nn?cn.data=nn:(nn=ca(S),nn!==null&&(cn.data=nn)))),(nn=$h?Xh(f,S):Vc(f,S))&&(ot=Kc(ot,"onBeforeInput"),0<ot.length&&(Tt=new ef("onBeforeInput","beforeinput",null,S,Tt),At.push({event:Tt,listeners:ot}),Tt.data=nn))}af(At,g)})}function qa(f,g,S){return{instance:f,listener:g,currentTarget:S}}function Kc(f,g){for(var S=g+"Capture",I=[];f!==null;){var N=f,V=N.stateNode;N.tag===5&&V!==null&&(N=V,V=Pi(f,S),V!=null&&I.unshift(qa(f,V,N)),V=Pi(f,g),V!=null&&I.push(qa(f,V,N))),f=f.return}return I}function _o(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function Yl(f,g,S,I,N){for(var V=g._reactName,ee=[];S!==null&&S!==I;){var Ee=S,Oe=Ee.alternate,ot=Ee.stateNode;if(Oe!==null&&Oe===I)break;Ee.tag===5&&ot!==null&&(Ee=ot,N?(Oe=Pi(S,V),Oe!=null&&ee.unshift(qa(S,Oe,Ee))):N||(Oe=Pi(S,V),Oe!=null&&ee.push(qa(S,Oe,Ee)))),S=S.return}ee.length!==0&&f.push({event:g,listeners:ee})}var Jc=/\r\n?/g,Ga=/\u0000|\uFFFD/g;function Kl(f){return(typeof f=="string"?f:""+f).replace(Jc,`
`).replace(Ga,"")}function Jl(f,g,S){if(g=Kl(g),Kl(f)!==g&&S)throw Error(t(425))}function yo(){}var Qc=null,Ya=null;function Ql(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var eu=typeof setTimeout=="function"?setTimeout:void 0,lf=typeof clearTimeout=="function"?clearTimeout:void 0,rd=typeof Promise=="function"?Promise:void 0,Wu=typeof queueMicrotask=="function"?queueMicrotask:typeof rd<"u"?function(f){return rd.resolve(null).then(f).catch(sd)}:eu;function sd(f){setTimeout(function(){throw f})}function Hu(f,g){var S=g,I=0;do{var N=S.nextSibling;if(f.removeChild(S),N&&N.nodeType===8)if(S=N.data,S==="/$"){if(I===0){f.removeChild(N),ps(g);return}I--}else S!=="$"&&S!=="$?"&&S!=="$!"||I++;S=N}while(S);ps(g)}function vo(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function pi(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var S=f.data;if(S==="$"||S==="$!"||S==="$?"){if(g===0)return f;g--}else S==="/$"&&g++}f=f.previousSibling}return null}var Rs=Math.random().toString(36).slice(2),ki="__reactFiber$"+Rs,ga="__reactProps$"+Rs,ks="__reactContainer$"+Rs,tu="__reactEvents$"+Rs,Ka="__reactListeners$"+Rs,Ja="__reactHandles$"+Rs;function to(f){var g=f[ki];if(g)return g;for(var S=f.parentNode;S;){if(g=S[ks]||S[ki]){if(S=g.alternate,g.child!==null||S!==null&&S.child!==null)for(f=pi(f);f!==null;){if(S=f[ki])return S;f=pi(f)}return g}f=S,S=f.parentNode}return null}function Qa(f){return f=f[ki]||f[ks],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function el(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(t(33))}function nu(f){return f[ga]||null}var Zu=[],tl=-1;function gs(f){return{current:f}}function Un(f){0>tl||(f.current=Zu[tl],Zu[tl]=null,tl--)}function Ln(f,g){tl++,Zu[tl]=f.current,f.current=g}var _s={},ir=gs(_s),Fr=gs(!1),_a=_s;function no(f,g){var S=f.type.contextTypes;if(!S)return _s;var I=f.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===g)return I.__reactInternalMemoizedMaskedChildContext;var N={},V;for(V in S)N[V]=g[V];return I&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=N),N}function Sr(f){return f=f.childContextTypes,f!=null}function nl(){Un(Fr),Un(ir)}function iu(f,g,S){if(ir.current!==_s)throw Error(t(168));Ln(ir,g),Ln(Fr,S)}function ru(f,g,S){var I=f.stateNode;if(g=g.childContextTypes,typeof I.getChildContext!="function")return S;I=I.getChildContext();for(var N in I)if(!(N in g))throw Error(t(108,Qt(f)||"Unknown",N));return $e({},S,I)}function Nr(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||_s,_a=ir.current,Ln(ir,f),Ln(Fr,Fr.current),!0}function Ar(f,g,S){var I=f.stateNode;if(!I)throw Error(t(169));S?(f=ru(f,g,_a),I.__reactInternalMemoizedMergedChildContext=f,Un(Fr),Un(ir),Ln(ir,f)):Un(Fr),Ln(Fr,S)}var xo=null,Qr=!1,ya=!1;function ec(f){xo===null?xo=[f]:xo.push(f)}function Gp(f){Qr=!0,ec(f)}function va(){if(!ya&&xo!==null){ya=!0;var f=0,g=Zn;try{var S=xo;for(Zn=1;f<S.length;f++){var I=S[f];do I=I(!0);while(I!==null)}xo=null,Qr=!1}catch(N){throw xo!==null&&(xo=xo.slice(f+1)),Io(wr,va),N}finally{Zn=g,ya=!1}}return null}var Bo=[],il=0,bo=null,Br=0,Ct=[],es=0,wo=null,io=1,zr="";function Ds(f,g){Bo[il++]=Br,Bo[il++]=bo,bo=f,Br=g}function Xu(f,g,S){Ct[es++]=io,Ct[es++]=zr,Ct[es++]=wo,wo=f;var I=io;f=zr;var N=32-Cs(I)-1;I&=~(1<<N),S+=1;var V=32-Cs(g)+N;if(30<V){var ee=N-N%5;V=(I&(1<<ee)-1).toString(32),I>>=ee,N-=ee,io=1<<32-Cs(g)+N|S<<N|I,zr=V+f}else io=1<<V|S<<N|I,zr=f}function Rn(f){f.return!==null&&(Ds(f,1),Xu(f,1,0))}function su(f){for(;f===bo;)bo=Bo[--il],Bo[il]=null,Br=Bo[--il],Bo[il]=null;for(;f===wo;)wo=Ct[--es],Ct[es]=null,zr=Ct[--es],Ct[es]=null,io=Ct[--es],Ct[es]=null}var ts=null,Ur=null,vi=!1,Os=null;function od(f,g){var S=Ao(5,null,null,0);S.elementType="DELETED",S.stateNode=g,S.return=f,g=f.deletions,g===null?(f.deletions=[S],f.flags|=16):g.push(S)}function qu(f,g){switch(f.tag){case 5:var S=f.type;return g=g.nodeType!==1||S.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,ts=f,Ur=vo(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,ts=f,Ur=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(S=wo!==null?{id:io,overflow:zr}:null,f.memoizedState={dehydrated:g,treeContext:S,retryLane:1073741824},S=Ao(18,null,null,0),S.stateNode=g,S.return=f,f.child=S,ts=f,Ur=null,!0):!1;default:return!1}}function ou(f){return(f.mode&1)!==0&&(f.flags&128)===0}function Gu(f){if(vi){var g=Ur;if(g){var S=g;if(!qu(f,g)){if(ou(f))throw Error(t(418));g=vo(S.nextSibling);var I=ts;g&&qu(f,g)?od(I,S):(f.flags=f.flags&-4097|2,vi=!1,ts=f)}}else{if(ou(f))throw Error(t(418));f.flags=f.flags&-4097|2,vi=!1,ts=f}}}function Yu(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;ts=f}function au(f){if(f!==ts)return!1;if(!vi)return Yu(f),vi=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!Ql(f.type,f.memoizedProps)),g&&(g=Ur)){if(ou(f))throw lu(),Error(t(418));for(;g;)od(f,g),g=vo(g.nextSibling)}if(Yu(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(t(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var S=f.data;if(S==="/$"){if(g===0){Ur=vo(f.nextSibling);break e}g--}else S!=="$"&&S!=="$!"&&S!=="$?"||g++}f=f.nextSibling}Ur=null}}else Ur=ts?vo(f.stateNode.nextSibling):null;return!0}function lu(){for(var f=Ur;f;)f=vo(f.nextSibling)}function ys(){Ur=ts=null,vi=!1}function Xn(f){Os===null?Os=[f]:Os.push(f)}var Yp=Se.ReactCurrentBatchConfig;function xa(f,g,S){if(f=S.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(t(309));var I=S.stateNode}if(!I)throw Error(t(147,f));var N=I,V=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===V?g.ref:(g=function(ee){var Ee=N.refs;ee===null?delete Ee[V]:Ee[V]=ee},g._stringRef=V,g)}if(typeof f!="string")throw Error(t(284));if(!S._owner)throw Error(t(290,f))}return f}function rl(f,g){throw f=Object.prototype.toString.call(g),Error(t(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function Ku(f){var g=f._init;return g(f._payload)}function Ju(f){function g(Qe,Ve){if(f){var it=Qe.deletions;it===null?(Qe.deletions=[Ve],Qe.flags|=16):it.push(Ve)}}function S(Qe,Ve){if(!f)return null;for(;Ve!==null;)g(Qe,Ve),Ve=Ve.sibling;return null}function I(Qe,Ve){for(Qe=new Map;Ve!==null;)Ve.key!==null?Qe.set(Ve.key,Ve):Qe.set(Ve.index,Ve),Ve=Ve.sibling;return Qe}function N(Qe,Ve){return Qe=gc(Qe,Ve),Qe.index=0,Qe.sibling=null,Qe}function V(Qe,Ve,it){return Qe.index=it,f?(it=Qe.alternate,it!==null?(it=it.index,it<Ve?(Qe.flags|=2,Ve):it):(Qe.flags|=2,Ve)):(Qe.flags|=1048576,Ve)}function ee(Qe){return f&&Qe.alternate===null&&(Qe.flags|=2),Qe}function Ee(Qe,Ve,it,Lt){return Ve===null||Ve.tag!==6?(Ve=ym(it,Qe.mode,Lt),Ve.return=Qe,Ve):(Ve=N(Ve,it),Ve.return=Qe,Ve)}function Oe(Qe,Ve,it,Lt){var en=it.type;return en===dt?Tt(Qe,Ve,it.props.children,Lt,it.key):Ve!==null&&(Ve.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===Pe&&Ku(en)===Ve.type)?(Lt=N(Ve,it.props),Lt.ref=xa(Qe,Ve,it),Lt.return=Qe,Lt):(Lt=Df(it.type,it.key,it.props,null,Qe.mode,Lt),Lt.ref=xa(Qe,Ve,it),Lt.return=Qe,Lt)}function ot(Qe,Ve,it,Lt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==it.containerInfo||Ve.stateNode.implementation!==it.implementation?(Ve=xu(it,Qe.mode,Lt),Ve.return=Qe,Ve):(Ve=N(Ve,it.children||[]),Ve.return=Qe,Ve)}function Tt(Qe,Ve,it,Lt,en){return Ve===null||Ve.tag!==7?(Ve=_c(it,Qe.mode,Lt,en),Ve.return=Qe,Ve):(Ve=N(Ve,it),Ve.return=Qe,Ve)}function At(Qe,Ve,it){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=ym(""+Ve,Qe.mode,it),Ve.return=Qe,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case Ne:return it=Df(Ve.type,Ve.key,Ve.props,null,Qe.mode,it),it.ref=xa(Qe,null,Ve),it.return=Qe,it;case nt:return Ve=xu(Ve,Qe.mode,it),Ve.return=Qe,Ve;case Pe:var Lt=Ve._init;return At(Qe,Lt(Ve._payload),it)}if(Yn(Ve)||Ue(Ve))return Ve=_c(Ve,Qe.mode,it,null),Ve.return=Qe,Ve;rl(Qe,Ve)}return null}function yt(Qe,Ve,it,Lt){var en=Ve!==null?Ve.key:null;if(typeof it=="string"&&it!==""||typeof it=="number")return en!==null?null:Ee(Qe,Ve,""+it,Lt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case Ne:return it.key===en?Oe(Qe,Ve,it,Lt):null;case nt:return it.key===en?ot(Qe,Ve,it,Lt):null;case Pe:return en=it._init,yt(Qe,Ve,en(it._payload),Lt)}if(Yn(it)||Ue(it))return en!==null?null:Tt(Qe,Ve,it,Lt,null);rl(Qe,it)}return null}function Ht(Qe,Ve,it,Lt,en){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return Qe=Qe.get(it)||null,Ee(Ve,Qe,""+Lt,en);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case Ne:return Qe=Qe.get(Lt.key===null?it:Lt.key)||null,Oe(Ve,Qe,Lt,en);case nt:return Qe=Qe.get(Lt.key===null?it:Lt.key)||null,ot(Ve,Qe,Lt,en);case Pe:var dn=Lt._init;return Ht(Qe,Ve,it,dn(Lt._payload),en)}if(Yn(Lt)||Ue(Lt))return Qe=Qe.get(it)||null,Tt(Ve,Qe,Lt,en,null);rl(Ve,Lt)}return null}function Kt(Qe,Ve,it,Lt){for(var en=null,dn=null,nn=Ve,cn=Ve=0,gr=null;nn!==null&&cn<it.length;cn++){nn.index>cn?(gr=nn,nn=null):gr=nn.sibling;var Gn=yt(Qe,nn,it[cn],Lt);if(Gn===null){nn===null&&(nn=gr);break}f&&nn&&Gn.alternate===null&&g(Qe,nn),Ve=V(Gn,Ve,cn),dn===null?en=Gn:dn.sibling=Gn,dn=Gn,nn=gr}if(cn===it.length)return S(Qe,nn),vi&&Ds(Qe,cn),en;if(nn===null){for(;cn<it.length;cn++)nn=At(Qe,it[cn],Lt),nn!==null&&(Ve=V(nn,Ve,cn),dn===null?en=nn:dn.sibling=nn,dn=nn);return vi&&Ds(Qe,cn),en}for(nn=I(Qe,nn);cn<it.length;cn++)gr=Ht(nn,Qe,cn,it[cn],Lt),gr!==null&&(f&&gr.alternate!==null&&nn.delete(gr.key===null?cn:gr.key),Ve=V(gr,Ve,cn),dn===null?en=gr:dn.sibling=gr,dn=gr);return f&&nn.forEach(function(yc){return g(Qe,yc)}),vi&&Ds(Qe,cn),en}function Jt(Qe,Ve,it,Lt){var en=Ue(it);if(typeof en!="function")throw Error(t(150));if(it=en.call(it),it==null)throw Error(t(151));for(var dn=en=null,nn=Ve,cn=Ve=0,gr=null,Gn=it.next();nn!==null&&!Gn.done;cn++,Gn=it.next()){nn.index>cn?(gr=nn,nn=null):gr=nn.sibling;var yc=yt(Qe,nn,Gn.value,Lt);if(yc===null){nn===null&&(nn=gr);break}f&&nn&&yc.alternate===null&&g(Qe,nn),Ve=V(yc,Ve,cn),dn===null?en=yc:dn.sibling=yc,dn=yc,nn=gr}if(Gn.done)return S(Qe,nn),vi&&Ds(Qe,cn),en;if(nn===null){for(;!Gn.done;cn++,Gn=it.next())Gn=At(Qe,Gn.value,Lt),Gn!==null&&(Ve=V(Gn,Ve,cn),dn===null?en=Gn:dn.sibling=Gn,dn=Gn);return vi&&Ds(Qe,cn),en}for(nn=I(Qe,nn);!Gn.done;cn++,Gn=it.next())Gn=Ht(nn,Qe,cn,Gn.value,Lt),Gn!==null&&(f&&Gn.alternate!==null&&nn.delete(Gn.key===null?cn:Gn.key),Ve=V(Gn,Ve,cn),dn===null?en=Gn:dn.sibling=Gn,dn=Gn);return f&&nn.forEach(function(zf){return g(Qe,zf)}),vi&&Ds(Qe,cn),en}function Qi(Qe,Ve,it,Lt){if(typeof it=="object"&&it!==null&&it.type===dt&&it.key===null&&(it=it.props.children),typeof it=="object"&&it!==null){switch(it.$$typeof){case Ne:e:{for(var en=it.key,dn=Ve;dn!==null;){if(dn.key===en){if(en=it.type,en===dt){if(dn.tag===7){S(Qe,dn.sibling),Ve=N(dn,it.props.children),Ve.return=Qe,Qe=Ve;break e}}else if(dn.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===Pe&&Ku(en)===dn.type){S(Qe,dn.sibling),Ve=N(dn,it.props),Ve.ref=xa(Qe,dn,it),Ve.return=Qe,Qe=Ve;break e}S(Qe,dn);break}else g(Qe,dn);dn=dn.sibling}it.type===dt?(Ve=_c(it.props.children,Qe.mode,Lt,it.key),Ve.return=Qe,Qe=Ve):(Lt=Df(it.type,it.key,it.props,null,Qe.mode,Lt),Lt.ref=xa(Qe,Ve,it),Lt.return=Qe,Qe=Lt)}return ee(Qe);case nt:e:{for(dn=it.key;Ve!==null;){if(Ve.key===dn)if(Ve.tag===4&&Ve.stateNode.containerInfo===it.containerInfo&&Ve.stateNode.implementation===it.implementation){S(Qe,Ve.sibling),Ve=N(Ve,it.children||[]),Ve.return=Qe,Qe=Ve;break e}else{S(Qe,Ve);break}else g(Qe,Ve);Ve=Ve.sibling}Ve=xu(it,Qe.mode,Lt),Ve.return=Qe,Qe=Ve}return ee(Qe);case Pe:return dn=it._init,Qi(Qe,Ve,dn(it._payload),Lt)}if(Yn(it))return Kt(Qe,Ve,it,Lt);if(Ue(it))return Jt(Qe,Ve,it,Lt);rl(Qe,it)}return typeof it=="string"&&it!==""||typeof it=="number"?(it=""+it,Ve!==null&&Ve.tag===6?(S(Qe,Ve.sibling),Ve=N(Ve,it),Ve.return=Qe,Qe=Ve):(S(Qe,Ve),Ve=ym(it,Qe.mode,Lt),Ve.return=Qe,Qe=Ve),ee(Qe)):S(Qe,Ve)}return Qi}var sl=Ju(!0),cf=Ju(!1),vs=gs(null),ol=null,jt=null,qt=null;function al(){qt=jt=ol=null}function Qu(f){var g=vs.current;Un(vs),f._currentValue=g}function tc(f,g,S){for(;f!==null;){var I=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,I!==null&&(I.childLanes|=g)):I!==null&&(I.childLanes&g)!==g&&(I.childLanes|=g),f===S)break;f=f.return}}function zi(f,g){ol=f,qt=jt=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(or=!0),f.firstContext=null)}function xs(f){var g=f._currentValue;if(qt!==f)if(f={context:f,memoizedValue:g,next:null},jt===null){if(ol===null)throw Error(t(308));jt=f,ol.dependencies={lanes:0,firstContext:f}}else jt=jt.next=f;return g}var pr=null;function zo(f){pr===null?pr=[f]:pr.push(f)}function ll(f,g,S,I){var N=g.interleaved;return N===null?(S.next=S,zo(g)):(S.next=N.next,N.next=S),g.interleaved=S,Vn(f,I)}function Vn(f,g){f.lanes|=g;var S=f.alternate;for(S!==null&&(S.lanes|=g),S=f,f=f.return;f!==null;)f.childLanes|=g,S=f.alternate,S!==null&&(S.childLanes|=g),S=f,f=f.return;return S.tag===3?S.stateNode:null}var Jn=!1;function nc(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ic(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function jr(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function ns(f,g,S){var I=f.updateQueue;if(I===null)return null;if(I=I.shared,(jn&2)!==0){var N=I.pending;return N===null?g.next=g:(g.next=N.next,N.next=g),I.pending=g,Vn(f,S)}return N=I.interleaved,N===null?(g.next=g,zo(I)):(g.next=N.next,N.next=g),I.interleaved=g,Vn(f,S)}function rc(f,g,S){if(g=g.updateQueue,g!==null&&(g=g.shared,(S&4194240)!==0)){var I=g.lanes;I&=f.pendingLanes,S|=I,g.lanes=S,ia(f,S)}}function cu(f,g){var S=f.updateQueue,I=f.alternate;if(I!==null&&(I=I.updateQueue,S===I)){var N=null,V=null;if(S=S.firstBaseUpdate,S!==null){do{var ee={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};V===null?N=V=ee:V=V.next=ee,S=S.next}while(S!==null);V===null?N=V=g:V=V.next=g}else N=V=g;S={baseState:I.baseState,firstBaseUpdate:N,lastBaseUpdate:V,shared:I.shared,effects:I.effects},f.updateQueue=S;return}f=S.lastBaseUpdate,f===null?S.firstBaseUpdate=g:f.next=g,S.lastBaseUpdate=g}function Ls(f,g,S,I){var N=f.updateQueue;Jn=!1;var V=N.firstBaseUpdate,ee=N.lastBaseUpdate,Ee=N.shared.pending;if(Ee!==null){N.shared.pending=null;var Oe=Ee,ot=Oe.next;Oe.next=null,ee===null?V=ot:ee.next=ot,ee=Oe;var Tt=f.alternate;Tt!==null&&(Tt=Tt.updateQueue,Ee=Tt.lastBaseUpdate,Ee!==ee&&(Ee===null?Tt.firstBaseUpdate=ot:Ee.next=ot,Tt.lastBaseUpdate=Oe))}if(V!==null){var At=N.baseState;ee=0,Tt=ot=Oe=null,Ee=V;do{var yt=Ee.lane,Ht=Ee.eventTime;if((I&yt)===yt){Tt!==null&&(Tt=Tt.next={eventTime:Ht,lane:0,tag:Ee.tag,payload:Ee.payload,callback:Ee.callback,next:null});e:{var Kt=f,Jt=Ee;switch(yt=g,Ht=S,Jt.tag){case 1:if(Kt=Jt.payload,typeof Kt=="function"){At=Kt.call(Ht,At,yt);break e}At=Kt;break e;case 3:Kt.flags=Kt.flags&-65537|128;case 0:if(Kt=Jt.payload,yt=typeof Kt=="function"?Kt.call(Ht,At,yt):Kt,yt==null)break e;At=$e({},At,yt);break e;case 2:Jn=!0}}Ee.callback!==null&&Ee.lane!==0&&(f.flags|=64,yt=N.effects,yt===null?N.effects=[Ee]:yt.push(Ee))}else Ht={eventTime:Ht,lane:yt,tag:Ee.tag,payload:Ee.payload,callback:Ee.callback,next:null},Tt===null?(ot=Tt=Ht,Oe=At):Tt=Tt.next=Ht,ee|=yt;if(Ee=Ee.next,Ee===null){if(Ee=N.shared.pending,Ee===null)break;yt=Ee,Ee=yt.next,yt.next=null,N.lastBaseUpdate=yt,N.shared.pending=null}}while(!0);if(Tt===null&&(Oe=At),N.baseState=Oe,N.firstBaseUpdate=ot,N.lastBaseUpdate=Tt,g=N.shared.interleaved,g!==null){N=g;do ee|=N.lane,N=N.next;while(N!==g)}else V===null&&(N.shared.lanes=0);dc|=ee,f.lanes=ee,f.memoizedState=At}}function eh(f,g,S){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var I=f[g],N=I.callback;if(N!==null){if(I.callback=null,I=S,typeof N!="function")throw Error(t(191,N));N.call(I)}}}var cl={},bs=gs(cl),ul=gs(cl),x=gs(cl);function r(f){if(f===cl)throw Error(t(174));return f}function h(f,g){switch(Ln(x,g),Ln(ul,f),Ln(bs,cl),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Jr(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=Jr(g,f)}Un(bs),Ln(bs,g)}function m(){Un(bs),Un(ul),Un(x)}function y(f){r(x.current);var g=r(bs.current),S=Jr(g,f.type);g!==S&&(Ln(ul,f),Ln(bs,S))}function w(f){ul.current===f&&(Un(bs),Un(ul))}var P=gs(0);function R(f){for(var g=f;g!==null;){if(g.tag===13){var S=g.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var D=[];function B(){for(var f=0;f<D.length;f++)D[f]._workInProgressVersionPrimary=null;D.length=0}var U=Se.ReactCurrentDispatcher,W=Se.ReactCurrentBatchConfig,$=0,Z=null,Q=null,re=null,ae=!1,le=!1,pe=0,be=0;function fe(){throw Error(t(321))}function Ae(f,g){if(g===null)return!1;for(var S=0;S<g.length&&S<f.length;S++)if(!eo(f[S],g[S]))return!1;return!0}function Me(f,g,S,I,N,V){if($=V,Z=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,U.current=f===null||f.memoizedState===null?gi:th,f=S(I,N),le){V=0;do{if(le=!1,pe=0,25<=V)throw Error(t(301));V+=1,re=Q=null,g.updateQueue=null,U.current=uf,f=S(I,N)}while(le)}if(U.current=sr,g=Q!==null&&Q.next!==null,$=0,re=Q=Z=null,ae=!1,g)throw Error(t(300));return f}function xe(){var f=pe!==0;return pe=0,f}function Re(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return re===null?Z.memoizedState=re=f:re=re.next=f,re}function Ge(){if(Q===null){var f=Z.alternate;f=f!==null?f.memoizedState:null}else f=Q.next;var g=re===null?Z.memoizedState:re.next;if(g!==null)re=g,Q=f;else{if(f===null)throw Error(t(310));Q=f,f={memoizedState:Q.memoizedState,baseState:Q.baseState,baseQueue:Q.baseQueue,queue:Q.queue,next:null},re===null?Z.memoizedState=re=f:re=re.next=f}return re}function qe(f,g){return typeof g=="function"?g(f):g}function Ye(f){var g=Ge(),S=g.queue;if(S===null)throw Error(t(311));S.lastRenderedReducer=f;var I=Q,N=I.baseQueue,V=S.pending;if(V!==null){if(N!==null){var ee=N.next;N.next=V.next,V.next=ee}I.baseQueue=N=V,S.pending=null}if(N!==null){V=N.next,I=I.baseState;var Ee=ee=null,Oe=null,ot=V;do{var Tt=ot.lane;if(($&Tt)===Tt)Oe!==null&&(Oe=Oe.next={lane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),I=ot.hasEagerState?ot.eagerState:f(I,ot.action);else{var At={lane:Tt,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null};Oe===null?(Ee=Oe=At,ee=I):Oe=Oe.next=At,Z.lanes|=Tt,dc|=Tt}ot=ot.next}while(ot!==null&&ot!==V);Oe===null?ee=I:Oe.next=Ee,eo(I,g.memoizedState)||(or=!0),g.memoizedState=I,g.baseState=ee,g.baseQueue=Oe,S.lastRenderedState=I}if(f=S.interleaved,f!==null){N=f;do V=N.lane,Z.lanes|=V,dc|=V,N=N.next;while(N!==f)}else N===null&&(S.lanes=0);return[g.memoizedState,S.dispatch]}function tt(f){var g=Ge(),S=g.queue;if(S===null)throw Error(t(311));S.lastRenderedReducer=f;var I=S.dispatch,N=S.pending,V=g.memoizedState;if(N!==null){S.pending=null;var ee=N=N.next;do V=f(V,ee.action),ee=ee.next;while(ee!==N);eo(V,g.memoizedState)||(or=!0),g.memoizedState=V,g.baseQueue===null&&(g.baseState=V),S.lastRenderedState=V}return[V,I]}function bt(){}function _t(f,g){var S=Z,I=Ge(),N=g(),V=!eo(I.memoizedState,N);if(V&&(I.memoizedState=N,or=!0),I=I.queue,mi(xn.bind(null,S,I,f),[f]),I.getSnapshot!==g||V||re!==null&&re.memoizedState.tag&1){if(S.flags|=2048,ni(9,Bt.bind(null,S,I,N,g),void 0,null),Pr===null)throw Error(t(349));($&30)!==0||ht(S,g,N)}return N}function ht(f,g,S){f.flags|=16384,f={getSnapshot:g,value:S},g=Z.updateQueue,g===null?(g={lastEffect:null,stores:null},Z.updateQueue=g,g.stores=[f]):(S=g.stores,S===null?g.stores=[f]:S.push(f))}function Bt(f,g,S,I){g.value=S,g.getSnapshot=I,qn(g)&&ui(f)}function xn(f,g,S){return S(function(){qn(g)&&ui(f)})}function qn(f){var g=f.getSnapshot;f=f.value;try{var S=g();return!eo(f,S)}catch{return!0}}function ui(f){var g=Vn(f,1);g!==null&&Zo(g,f,1,-1)}function oi(f){var g=Re();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qe,lastRenderedState:f},g.queue=f,f=f.dispatch=jo.bind(null,Z,f),[g.memoizedState,f]}function ni(f,g,S,I){return f={tag:f,create:g,destroy:S,deps:I,next:null},g=Z.updateQueue,g===null?(g={lastEffect:null,stores:null},Z.updateQueue=g,g.lastEffect=f.next=f):(S=g.lastEffect,S===null?g.lastEffect=f.next=f:(I=S.next,S.next=f,f.next=I,g.lastEffect=f)),f}function hi(){return Ge().memoizedState}function Di(f,g,S,I){var N=Re();Z.flags|=f,N.memoizedState=ni(1|g,S,void 0,I===void 0?null:I)}function ii(f,g,S,I){var N=Ge();I=I===void 0?null:I;var V=void 0;if(Q!==null){var ee=Q.memoizedState;if(V=ee.destroy,I!==null&&Ae(I,ee.deps)){N.memoizedState=ni(g,S,V,I);return}}Z.flags|=f,N.memoizedState=ni(1|g,S,V,I)}function Qn(f,g){return Di(8390656,8,f,g)}function mi(f,g){return ii(2048,8,f,g)}function En(f,g){return ii(4,2,f,g)}function rr(f,g){return ii(4,4,f,g)}function To(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function ba(f,g,S){return S=S!=null?S.concat([f]):null,ii(4,4,To.bind(null,g,f),S)}function So(){}function wa(f,g){var S=Ge();g=g===void 0?null:g;var I=S.memoizedState;return I!==null&&g!==null&&Ae(g,I[1])?I[0]:(S.memoizedState=[f,g],f)}function sc(f,g){var S=Ge();g=g===void 0?null:g;var I=S.memoizedState;return I!==null&&g!==null&&Ae(g,I[1])?I[0]:(f=f(),S.memoizedState=[f,g],f)}function Uo(f,g,S){return($&21)===0?(f.baseState&&(f.baseState=!1,or=!0),f.memoizedState=S):(eo(S,g)||(S=Ba(),Z.lanes|=S,dc|=S,f.baseState=!0),g)}function hl(f,g){var S=Zn;Zn=S!==0&&4>S?S:4,f(!0);var I=W.transition;W.transition={};try{f(!1),g()}finally{Zn=S,W.transition=I}}function is(){return Ge().memoizedState}function Ta(f,g,S){var I=pc(f);if(S={lane:I,action:S,hasEagerState:!1,eagerState:null,next:null},Vo(f))Ui(g,S);else if(S=ll(f,g,S,I),S!==null){var N=ws();Zo(S,f,I,N),ji(S,g,I)}}function jo(f,g,S){var I=pc(f),N={lane:I,action:S,hasEagerState:!1,eagerState:null,next:null};if(Vo(f))Ui(g,N);else{var V=f.alternate;if(f.lanes===0&&(V===null||V.lanes===0)&&(V=g.lastRenderedReducer,V!==null))try{var ee=g.lastRenderedState,Ee=V(ee,S);if(N.hasEagerState=!0,N.eagerState=Ee,eo(Ee,ee)){var Oe=g.interleaved;Oe===null?(N.next=N,zo(g)):(N.next=Oe.next,Oe.next=N),g.interleaved=N;return}}catch{}finally{}S=ll(f,g,N,I),S!==null&&(N=ws(),Zo(S,f,I,N),ji(S,g,I))}}function Vo(f){var g=f.alternate;return f===Z||g!==null&&g===Z}function Ui(f,g){le=ae=!0;var S=f.pending;S===null?g.next=g:(g.next=S.next,S.next=g),f.pending=g}function ji(f,g,S){if((S&4194240)!==0){var I=g.lanes;I&=f.pendingLanes,S|=I,g.lanes=S,ia(f,S)}}var sr={readContext:xs,useCallback:fe,useContext:fe,useEffect:fe,useImperativeHandle:fe,useInsertionEffect:fe,useLayoutEffect:fe,useMemo:fe,useReducer:fe,useRef:fe,useState:fe,useDebugValue:fe,useDeferredValue:fe,useTransition:fe,useMutableSource:fe,useSyncExternalStore:fe,useId:fe,unstable_isNewReconciler:!1},gi={readContext:xs,useCallback:function(f,g){return Re().memoizedState=[f,g===void 0?null:g],f},useContext:xs,useEffect:Qn,useImperativeHandle:function(f,g,S){return S=S!=null?S.concat([f]):null,Di(4194308,4,To.bind(null,g,f),S)},useLayoutEffect:function(f,g){return Di(4194308,4,f,g)},useInsertionEffect:function(f,g){return Di(4,2,f,g)},useMemo:function(f,g){var S=Re();return g=g===void 0?null:g,f=f(),S.memoizedState=[f,g],f},useReducer:function(f,g,S){var I=Re();return g=S!==void 0?S(g):g,I.memoizedState=I.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},I.queue=f,f=f.dispatch=Ta.bind(null,Z,f),[I.memoizedState,f]},useRef:function(f){var g=Re();return f={current:f},g.memoizedState=f},useState:oi,useDebugValue:So,useDeferredValue:function(f){return Re().memoizedState=f},useTransition:function(){var f=oi(!1),g=f[0];return f=hl.bind(null,f[1]),Re().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,S){var I=Z,N=Re();if(vi){if(S===void 0)throw Error(t(407));S=S()}else{if(S=g(),Pr===null)throw Error(t(349));($&30)!==0||ht(I,g,S)}N.memoizedState=S;var V={value:S,getSnapshot:g};return N.queue=V,Qn(xn.bind(null,I,V,f),[f]),I.flags|=2048,ni(9,Bt.bind(null,I,V,S,g),void 0,null),S},useId:function(){var f=Re(),g=Pr.identifierPrefix;if(vi){var S=zr,I=io;S=(I&~(1<<32-Cs(I)-1)).toString(32)+S,g=":"+g+"R"+S,S=pe++,0<S&&(g+="H"+S.toString(32)),g+=":"}else S=be++,g=":"+g+"r"+S.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},th={readContext:xs,useCallback:wa,useContext:xs,useEffect:mi,useImperativeHandle:ba,useInsertionEffect:En,useLayoutEffect:rr,useMemo:sc,useReducer:Ye,useRef:hi,useState:function(){return Ye(qe)},useDebugValue:So,useDeferredValue:function(f){var g=Ge();return Uo(g,Q.memoizedState,f)},useTransition:function(){var f=Ye(qe)[0],g=Ge().memoizedState;return[f,g]},useMutableSource:bt,useSyncExternalStore:_t,useId:is,unstable_isNewReconciler:!1},uf={readContext:xs,useCallback:wa,useContext:xs,useEffect:mi,useImperativeHandle:ba,useInsertionEffect:En,useLayoutEffect:rr,useMemo:sc,useReducer:tt,useRef:hi,useState:function(){return tt(qe)},useDebugValue:So,useDeferredValue:function(f){var g=Ge();return Q===null?g.memoizedState=f:Uo(g,Q.memoizedState,f)},useTransition:function(){var f=tt(qe)[0],g=Ge().memoizedState;return[f,g]},useMutableSource:bt,useSyncExternalStore:_t,useId:is,unstable_isNewReconciler:!1};function Fs(f,g){if(f&&f.defaultProps){g=$e({},g),f=f.defaultProps;for(var S in f)g[S]===void 0&&(g[S]=f[S]);return g}return g}function ad(f,g,S,I){g=f.memoizedState,S=S(I,g),S=S==null?g:$e({},g,S),f.memoizedState=S,f.lanes===0&&(f.updateQueue.baseState=S)}var oc={isMounted:function(f){return(f=f._reactInternals)?mn(f)===f:!1},enqueueSetState:function(f,g,S){f=f._reactInternals;var I=ws(),N=pc(f),V=jr(I,N);V.payload=g,S!=null&&(V.callback=S),g=ns(f,V,N),g!==null&&(Zo(g,f,N,I),rc(g,f,N))},enqueueReplaceState:function(f,g,S){f=f._reactInternals;var I=ws(),N=pc(f),V=jr(I,N);V.tag=1,V.payload=g,S!=null&&(V.callback=S),g=ns(f,V,N),g!==null&&(Zo(g,f,N,I),rc(g,f,N))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var S=ws(),I=pc(f),N=jr(S,I);N.tag=2,g!=null&&(N.callback=g),g=ns(f,N,I),g!==null&&(Zo(g,f,I,S),rc(g,f,I))}};function ac(f,g,S,I,N,V,ee){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(I,V,ee):g.prototype&&g.prototype.isPureReactComponent?!Wc(S,I)||!Wc(N,V):!0}function rs(f,g,S){var I=!1,N=_s,V=g.contextType;return typeof V=="object"&&V!==null?V=xs(V):(N=Sr(g)?_a:ir.current,I=g.contextTypes,V=(I=I!=null)?no(f,N):_s),g=new g(S,V),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=oc,f.stateNode=g,g._reactInternals=f,I&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=N,f.__reactInternalMemoizedMaskedChildContext=V),g}function ro(f,g,S,I){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(S,I),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(S,I),g.state!==f&&oc.enqueueReplaceState(g,g.state,null)}function ss(f,g,S,I){var N=f.stateNode;N.props=S,N.state=f.memoizedState,N.refs={},nc(f);var V=g.contextType;typeof V=="object"&&V!==null?N.context=xs(V):(V=Sr(g)?_a:ir.current,N.context=no(f,V)),N.state=f.memoizedState,V=g.getDerivedStateFromProps,typeof V=="function"&&(ad(f,g,V,S),N.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(g=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),g!==N.state&&oc.enqueueReplaceState(N,N.state,null),Ls(f,S,N,I),N.state=f.memoizedState),typeof N.componentDidMount=="function"&&(f.flags|=4194308)}function os(f,g){try{var S="",I=g;do S+=It(I),I=I.return;while(I);var N=S}catch(V){N=`
Error generating stack: `+V.message+`
`+V.stack}return{value:f,source:g,stack:N,digest:null}}function lc(f,g,S){return{value:f,source:null,stack:S??null,digest:g??null}}function uu(f,g){try{console.error(g.value)}catch(S){setTimeout(function(){throw S})}}var nh=typeof WeakMap=="function"?WeakMap:Map;function cc(f,g,S){S=jr(-1,S),S.tag=3,S.payload={element:null};var I=g.value;return S.callback=function(){Sf||(Sf=!0,Af=I),uu(f,g)},S}function Eg(f,g,S){S=jr(-1,S),S.tag=3;var I=f.type.getDerivedStateFromError;if(typeof I=="function"){var N=g.value;S.payload=function(){return I(N)},S.callback=function(){uu(f,g)}}var V=f.stateNode;return V!==null&&typeof V.componentDidCatch=="function"&&(S.callback=function(){uu(f,g),typeof I!="function"&&(Bs===null?Bs=new Set([this]):Bs.add(this));var ee=g.stack;this.componentDidCatch(g.value,{componentStack:ee!==null?ee:""})}),S}function Kp(f,g,S){var I=f.pingCache;if(I===null){I=f.pingCache=new nh;var N=new Set;I.set(g,N)}else N=I.get(g),N===void 0&&(N=new Set,I.set(g,N));N.has(S)||(N.add(S),f=Wg.bind(null,f,g,S),g.then(f,f))}function hf(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function Jp(f,g,S,I,N){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(g=jr(-1,1),g.tag=2,ns(S,g,1))),S.lanes|=1),f):(f.flags|=65536,f.lanes=N,f)}var hu=Se.ReactCurrentOwner,or=!1;function as(f,g,S,I){g.child=f===null?cf(g,null,S,I):sl(g,f.child,S,I)}function Pg(f,g,S,I,N){S=S.render;var V=g.ref;return zi(g,N),I=Me(f,g,S,I,V,N),S=xe(),f!==null&&!or?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~N,Sa(f,g,N)):(vi&&S&&Rn(g),g.flags|=1,as(f,g,I,N),g.child)}function df(f,g,S,I,N){if(f===null){var V=S.type;return typeof V=="function"&&!kf(V)&&V.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(g.tag=15,g.type=V,Qp(f,g,V,I,N)):(f=Df(S.type,null,I,g,g.mode,N),f.ref=g.ref,f.return=g,g.child=f)}if(V=f.child,(f.lanes&N)===0){var ee=V.memoizedProps;if(S=S.compare,S=S!==null?S:Wc,S(ee,I)&&f.ref===g.ref)return Sa(f,g,N)}return g.flags|=1,f=gc(V,I),f.ref=g.ref,f.return=g,g.child=f}function Qp(f,g,S,I,N){if(f!==null){var V=f.memoizedProps;if(Wc(V,I)&&f.ref===g.ref)if(or=!1,g.pendingProps=I=V,(f.lanes&N)!==0)(f.flags&131072)!==0&&(or=!0);else return g.lanes=f.lanes,Sa(f,g,N)}return tm(f,g,S,I,N)}function ld(f,g,S){var I=g.pendingProps,N=I.children,V=f!==null?f.memoizedState:null;if(I.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ln(dl,Ns),Ns|=S;else{if((S&1073741824)===0)return f=V!==null?V.baseLanes|S:S,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,Ln(dl,Ns),Ns|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=V!==null?V.baseLanes:S,Ln(dl,Ns),Ns|=I}else V!==null?(I=V.baseLanes|S,g.memoizedState=null):I=S,Ln(dl,Ns),Ns|=I;return as(f,g,N,S),g.child}function em(f,g){var S=g.ref;(f===null&&S!==null||f!==null&&f.ref!==S)&&(g.flags|=512,g.flags|=2097152)}function tm(f,g,S,I,N){var V=Sr(S)?_a:ir.current;return V=no(g,V),zi(g,N),S=Me(f,g,S,I,V,N),I=xe(),f!==null&&!or?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~N,Sa(f,g,N)):(vi&&I&&Rn(g),g.flags|=1,as(f,g,S,N),g.child)}function ff(f,g,S,I,N){if(Sr(S)){var V=!0;Nr(g)}else V=!1;if(zi(g,N),g.stateNode===null)_f(f,g),rs(g,S,I),ss(g,S,I,N),I=!0;else if(f===null){var ee=g.stateNode,Ee=g.memoizedProps;ee.props=Ee;var Oe=ee.context,ot=S.contextType;typeof ot=="object"&&ot!==null?ot=xs(ot):(ot=Sr(S)?_a:ir.current,ot=no(g,ot));var Tt=S.getDerivedStateFromProps,At=typeof Tt=="function"||typeof ee.getSnapshotBeforeUpdate=="function";At||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(Ee!==I||Oe!==ot)&&ro(g,ee,I,ot),Jn=!1;var yt=g.memoizedState;ee.state=yt,Ls(g,I,ee,N),Oe=g.memoizedState,Ee!==I||yt!==Oe||Fr.current||Jn?(typeof Tt=="function"&&(ad(g,S,Tt,I),Oe=g.memoizedState),(Ee=Jn||ac(g,S,Ee,I,yt,Oe,ot))?(At||typeof ee.UNSAFE_componentWillMount!="function"&&typeof ee.componentWillMount!="function"||(typeof ee.componentWillMount=="function"&&ee.componentWillMount(),typeof ee.UNSAFE_componentWillMount=="function"&&ee.UNSAFE_componentWillMount()),typeof ee.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ee.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=I,g.memoizedState=Oe),ee.props=I,ee.state=Oe,ee.context=ot,I=Ee):(typeof ee.componentDidMount=="function"&&(g.flags|=4194308),I=!1)}else{ee=g.stateNode,ic(f,g),Ee=g.memoizedProps,ot=g.type===g.elementType?Ee:Fs(g.type,Ee),ee.props=ot,At=g.pendingProps,yt=ee.context,Oe=S.contextType,typeof Oe=="object"&&Oe!==null?Oe=xs(Oe):(Oe=Sr(S)?_a:ir.current,Oe=no(g,Oe));var Ht=S.getDerivedStateFromProps;(Tt=typeof Ht=="function"||typeof ee.getSnapshotBeforeUpdate=="function")||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(Ee!==At||yt!==Oe)&&ro(g,ee,I,Oe),Jn=!1,yt=g.memoizedState,ee.state=yt,Ls(g,I,ee,N);var Kt=g.memoizedState;Ee!==At||yt!==Kt||Fr.current||Jn?(typeof Ht=="function"&&(ad(g,S,Ht,I),Kt=g.memoizedState),(ot=Jn||ac(g,S,ot,I,yt,Kt,Oe)||!1)?(Tt||typeof ee.UNSAFE_componentWillUpdate!="function"&&typeof ee.componentWillUpdate!="function"||(typeof ee.componentWillUpdate=="function"&&ee.componentWillUpdate(I,Kt,Oe),typeof ee.UNSAFE_componentWillUpdate=="function"&&ee.UNSAFE_componentWillUpdate(I,Kt,Oe)),typeof ee.componentDidUpdate=="function"&&(g.flags|=4),typeof ee.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ee.componentDidUpdate!="function"||Ee===f.memoizedProps&&yt===f.memoizedState||(g.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||Ee===f.memoizedProps&&yt===f.memoizedState||(g.flags|=1024),g.memoizedProps=I,g.memoizedState=Kt),ee.props=I,ee.state=Kt,ee.context=Oe,I=ot):(typeof ee.componentDidUpdate!="function"||Ee===f.memoizedProps&&yt===f.memoizedState||(g.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||Ee===f.memoizedProps&&yt===f.memoizedState||(g.flags|=1024),I=!1)}return nm(f,g,S,I,V,N)}function nm(f,g,S,I,N,V){em(f,g);var ee=(g.flags&128)!==0;if(!I&&!ee)return N&&Ar(g,S,!1),Sa(f,g,V);I=g.stateNode,hu.current=g;var Ee=ee&&typeof S.getDerivedStateFromError!="function"?null:I.render();return g.flags|=1,f!==null&&ee?(g.child=sl(g,f.child,null,V),g.child=sl(g,null,Ee,V)):as(f,g,Ee,V),g.memoizedState=I.state,N&&Ar(g,S,!0),g.child}function pf(f){var g=f.stateNode;g.pendingContext?iu(f,g.pendingContext,g.pendingContext!==g.context):g.context&&iu(f,g.context,!1),h(f,g.containerInfo)}function im(f,g,S,I,N){return ys(),Xn(N),g.flags|=256,as(f,g,S,I),g.child}var mf={dehydrated:null,treeContext:null,retryLane:0};function uc(f){return{baseLanes:f,cachePool:null,transitions:null}}function Cg(f,g,S){var I=g.pendingProps,N=P.current,V=!1,ee=(g.flags&128)!==0,Ee;if((Ee=ee)||(Ee=f!==null&&f.memoizedState===null?!1:(N&2)!==0),Ee?(V=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(N|=1),Ln(P,N&1),f===null)return Gu(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ee=I.children,f=I.fallback,V?(I=g.mode,V=g.child,ee={mode:"hidden",children:ee},(I&1)===0&&V!==null?(V.childLanes=0,V.pendingProps=ee):V=Of(ee,I,0,null),f=_c(f,I,S,null),V.return=g,f.return=g,V.sibling=f,g.child=V,g.child.memoizedState=uc(S),g.memoizedState=mf,f):hc(g,ee));if(N=f.memoizedState,N!==null&&(Ee=N.dehydrated,Ee!==null))return gf(f,g,ee,I,Ee,N,S);if(V){V=I.fallback,ee=g.mode,N=f.child,Ee=N.sibling;var Oe={mode:"hidden",children:I.children};return(ee&1)===0&&g.child!==N?(I=g.child,I.childLanes=0,I.pendingProps=Oe,g.deletions=null):(I=gc(N,Oe),I.subtreeFlags=N.subtreeFlags&14680064),Ee!==null?V=gc(Ee,V):(V=_c(V,ee,S,null),V.flags|=2),V.return=g,I.return=g,I.sibling=V,g.child=I,I=V,V=g.child,ee=f.child.memoizedState,ee=ee===null?uc(S):{baseLanes:ee.baseLanes|S,cachePool:null,transitions:ee.transitions},V.memoizedState=ee,V.childLanes=f.childLanes&~S,g.memoizedState=mf,I}return V=f.child,f=V.sibling,I=gc(V,{mode:"visible",children:I.children}),(g.mode&1)===0&&(I.lanes=S),I.return=g,I.sibling=null,f!==null&&(S=g.deletions,S===null?(g.deletions=[f],g.flags|=16):S.push(f)),g.child=I,g.memoizedState=null,I}function hc(f,g){return g=Of({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function du(f,g,S,I){return I!==null&&Xn(I),sl(g,f.child,null,S),f=hc(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function gf(f,g,S,I,N,V,ee){if(S)return g.flags&256?(g.flags&=-257,I=lc(Error(t(422))),du(f,g,ee,I)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(V=I.fallback,N=g.mode,I=Of({mode:"visible",children:I.children},N,0,null),V=_c(V,N,ee,null),V.flags|=2,I.return=g,V.return=g,I.sibling=V,g.child=I,(g.mode&1)!==0&&sl(g,f.child,null,ee),g.child.memoizedState=uc(ee),g.memoizedState=mf,V);if((g.mode&1)===0)return du(f,g,ee,null);if(N.data==="$!"){if(I=N.nextSibling&&N.nextSibling.dataset,I)var Ee=I.dgst;return I=Ee,V=Error(t(419)),I=lc(V,I,void 0),du(f,g,ee,I)}if(Ee=(ee&f.childLanes)!==0,or||Ee){if(I=Pr,I!==null){switch(ee&-ee){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}N=(N&(I.suspendedLanes|ee))!==0?0:N,N!==0&&N!==V.retryLane&&(V.retryLane=N,Vn(f,N),Zo(I,f,N,-1))}return If(),I=lc(Error(t(421))),du(f,g,ee,I)}return N.data==="$?"?(g.flags|=128,g.child=f.child,g=Hg.bind(null,f),N._reactRetry=g,null):(f=V.treeContext,Ur=vo(N.nextSibling),ts=g,vi=!0,Os=null,f!==null&&(Ct[es++]=io,Ct[es++]=zr,Ct[es++]=wo,io=f.id,zr=f.overflow,wo=g),g=hc(g,I.children),g.flags|=4096,g)}function Ig(f,g,S){f.lanes|=g;var I=f.alternate;I!==null&&(I.lanes|=g),tc(f.return,g,S)}function rm(f,g,S,I,N){var V=f.memoizedState;V===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:I,tail:S,tailMode:N}:(V.isBackwards=g,V.rendering=null,V.renderingStartTime=0,V.last=I,V.tail=S,V.tailMode=N)}function Mg(f,g,S){var I=g.pendingProps,N=I.revealOrder,V=I.tail;if(as(f,g,I.children,S),I=P.current,(I&2)!==0)I=I&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&Ig(f,S,g);else if(f.tag===19)Ig(f,S,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}I&=1}if(Ln(P,I),(g.mode&1)===0)g.memoizedState=null;else switch(N){case"forwards":for(S=g.child,N=null;S!==null;)f=S.alternate,f!==null&&R(f)===null&&(N=S),S=S.sibling;S=N,S===null?(N=g.child,g.child=null):(N=S.sibling,S.sibling=null),rm(g,!1,N,S,V);break;case"backwards":for(S=null,N=g.child,g.child=null;N!==null;){if(f=N.alternate,f!==null&&R(f)===null){g.child=N;break}f=N.sibling,N.sibling=S,S=N,N=f}rm(g,!0,S,null,V);break;case"together":rm(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function _f(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function Sa(f,g,S){if(f!==null&&(g.dependencies=f.dependencies),dc|=g.lanes,(S&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(t(153));if(g.child!==null){for(f=g.child,S=gc(f,f.pendingProps),g.child=S,S.return=g;f.sibling!==null;)f=f.sibling,S=S.sibling=gc(f,f.pendingProps),S.return=g;S.sibling=null}return g.child}function sm(f,g,S){switch(g.tag){case 3:pf(g),ys();break;case 5:y(g);break;case 1:Sr(g.type)&&Nr(g);break;case 4:h(g,g.stateNode.containerInfo);break;case 10:var I=g.type._context,N=g.memoizedProps.value;Ln(vs,I._currentValue),I._currentValue=N;break;case 13:if(I=g.memoizedState,I!==null)return I.dehydrated!==null?(Ln(P,P.current&1),g.flags|=128,null):(S&g.child.childLanes)!==0?Cg(f,g,S):(Ln(P,P.current&1),f=Sa(f,g,S),f!==null?f.sibling:null);Ln(P,P.current&1);break;case 19:if(I=(S&g.childLanes)!==0,(f.flags&128)!==0){if(I)return Mg(f,g,S);g.flags|=128}if(N=g.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),Ln(P,P.current),I)break;return null;case 22:case 23:return g.lanes=0,ld(f,g,S)}return Sa(f,g,S)}var om,yf,Rg,kg;om=function(f,g){for(var S=g.child;S!==null;){if(S.tag===5||S.tag===6)f.appendChild(S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===g)break;for(;S.sibling===null;){if(S.return===null||S.return===g)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},yf=function(){},Rg=function(f,g,S,I){var N=f.memoizedProps;if(N!==I){f=g.stateNode,r(bs.current);var V=null;switch(S){case"input":N=ri(f,N),I=ri(f,I),V=[];break;case"select":N=$e({},N,{value:void 0}),I=$e({},I,{value:void 0}),V=[];break;case"textarea":N=hs(f,N),I=hs(f,I),V=[];break;default:typeof N.onClick!="function"&&typeof I.onClick=="function"&&(f.onclick=yo)}Ke(S,I);var ee;S=null;for(ot in N)if(!I.hasOwnProperty(ot)&&N.hasOwnProperty(ot)&&N[ot]!=null)if(ot==="style"){var Ee=N[ot];for(ee in Ee)Ee.hasOwnProperty(ee)&&(S||(S={}),S[ee]="")}else ot!=="dangerouslySetInnerHTML"&&ot!=="children"&&ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&ot!=="autoFocus"&&(o.hasOwnProperty(ot)?V||(V=[]):(V=V||[]).push(ot,null));for(ot in I){var Oe=I[ot];if(Ee=N?.[ot],I.hasOwnProperty(ot)&&Oe!==Ee&&(Oe!=null||Ee!=null))if(ot==="style")if(Ee){for(ee in Ee)!Ee.hasOwnProperty(ee)||Oe&&Oe.hasOwnProperty(ee)||(S||(S={}),S[ee]="");for(ee in Oe)Oe.hasOwnProperty(ee)&&Ee[ee]!==Oe[ee]&&(S||(S={}),S[ee]=Oe[ee])}else S||(V||(V=[]),V.push(ot,S)),S=Oe;else ot==="dangerouslySetInnerHTML"?(Oe=Oe?Oe.__html:void 0,Ee=Ee?Ee.__html:void 0,Oe!=null&&Ee!==Oe&&(V=V||[]).push(ot,Oe)):ot==="children"?typeof Oe!="string"&&typeof Oe!="number"||(V=V||[]).push(ot,""+Oe):ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&(o.hasOwnProperty(ot)?(Oe!=null&&ot==="onScroll"&&fi("scroll",f),V||Ee===Oe||(V=[])):(V=V||[]).push(ot,Oe))}S&&(V=V||[]).push("style",S);var ot=V;(g.updateQueue=ot)&&(g.flags|=4)}},kg=function(f,g,S,I){S!==I&&(g.flags|=4)};function ih(f,g){if(!vi)switch(f.tailMode){case"hidden":g=f.tail;for(var S=null;g!==null;)g.alternate!==null&&(S=g),g=g.sibling;S===null?f.tail=null:S.sibling=null;break;case"collapsed":S=f.tail;for(var I=null;S!==null;)S.alternate!==null&&(I=S),S=S.sibling;I===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:I.sibling=null}}function Vr(f){var g=f.alternate!==null&&f.alternate.child===f.child,S=0,I=0;if(g)for(var N=f.child;N!==null;)S|=N.lanes|N.childLanes,I|=N.subtreeFlags&14680064,I|=N.flags&14680064,N.return=f,N=N.sibling;else for(N=f.child;N!==null;)S|=N.lanes|N.childLanes,I|=N.subtreeFlags,I|=N.flags,N.return=f,N=N.sibling;return f.subtreeFlags|=I,f.childLanes=S,g}function Hy(f,g,S){var I=g.pendingProps;switch(su(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vr(g),null;case 1:return Sr(g.type)&&nl(),Vr(g),null;case 3:return I=g.stateNode,m(),Un(Fr),Un(ir),B(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(f===null||f.child===null)&&(au(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Os!==null&&(fm(Os),Os=null))),yf(f,g),Vr(g),null;case 5:w(g);var N=r(x.current);if(S=g.type,f!==null&&g.stateNode!=null)Rg(f,g,S,I,N),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!I){if(g.stateNode===null)throw Error(t(166));return Vr(g),null}if(f=r(bs.current),au(g)){I=g.stateNode,S=g.type;var V=g.memoizedProps;switch(I[ki]=g,I[ga]=V,f=(g.mode&1)!==0,S){case"dialog":fi("cancel",I),fi("close",I);break;case"iframe":case"object":case"embed":fi("load",I);break;case"video":case"audio":for(N=0;N<Xl.length;N++)fi(Xl[N],I);break;case"source":fi("error",I);break;case"img":case"image":case"link":fi("error",I),fi("load",I);break;case"details":fi("toggle",I);break;case"input":xt(I,V),fi("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!V.multiple},fi("invalid",I);break;case"textarea":Es(I,V),fi("invalid",I)}Ke(S,V),N=null;for(var ee in V)if(V.hasOwnProperty(ee)){var Ee=V[ee];ee==="children"?typeof Ee=="string"?I.textContent!==Ee&&(V.suppressHydrationWarning!==!0&&Jl(I.textContent,Ee,f),N=["children",Ee]):typeof Ee=="number"&&I.textContent!==""+Ee&&(V.suppressHydrationWarning!==!0&&Jl(I.textContent,Ee,f),N=["children",""+Ee]):o.hasOwnProperty(ee)&&Ee!=null&&ee==="onScroll"&&fi("scroll",I)}switch(S){case"input":Gi(I),Sn(I,V,!0);break;case"textarea":Gi(I),Kr(I);break;case"select":case"option":break;default:typeof V.onClick=="function"&&(I.onclick=yo)}I=N,g.updateQueue=I,I!==null&&(g.flags|=4)}else{ee=N.nodeType===9?N:N.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=Zs(S)),f==="http://www.w3.org/1999/xhtml"?S==="script"?(f=ee.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof I.is=="string"?f=ee.createElement(S,{is:I.is}):(f=ee.createElement(S),S==="select"&&(ee=f,I.multiple?ee.multiple=!0:I.size&&(ee.size=I.size))):f=ee.createElementNS(f,S),f[ki]=g,f[ga]=I,om(f,g,!1,!1),g.stateNode=f;e:{switch(ee=ze(S,I),S){case"dialog":fi("cancel",f),fi("close",f),N=I;break;case"iframe":case"object":case"embed":fi("load",f),N=I;break;case"video":case"audio":for(N=0;N<Xl.length;N++)fi(Xl[N],f);N=I;break;case"source":fi("error",f),N=I;break;case"img":case"image":case"link":fi("error",f),fi("load",f),N=I;break;case"details":fi("toggle",f),N=I;break;case"input":xt(f,I),N=ri(f,I),fi("invalid",f);break;case"option":N=I;break;case"select":f._wrapperState={wasMultiple:!!I.multiple},N=$e({},I,{value:void 0}),fi("invalid",f);break;case"textarea":Es(f,I),N=hs(f,I),fi("invalid",f);break;default:N=I}Ke(S,N),Ee=N;for(V in Ee)if(Ee.hasOwnProperty(V)){var Oe=Ee[V];V==="style"?Ce(f,Oe):V==="dangerouslySetInnerHTML"?(Oe=Oe?Oe.__html:void 0,Oe!=null&&Le(f,Oe)):V==="children"?typeof Oe=="string"?(S!=="textarea"||Oe!=="")&&K(f,Oe):typeof Oe=="number"&&K(f,""+Oe):V!=="suppressContentEditableWarning"&&V!=="suppressHydrationWarning"&&V!=="autoFocus"&&(o.hasOwnProperty(V)?Oe!=null&&V==="onScroll"&&fi("scroll",f):Oe!=null&&se(f,V,Oe,ee))}switch(S){case"input":Gi(f),Sn(f,I,!1);break;case"textarea":Gi(f),Kr(f);break;case"option":I.value!=null&&f.setAttribute("value",""+Ut(I.value));break;case"select":f.multiple=!!I.multiple,V=I.value,V!=null?yi(f,!!I.multiple,V,!1):I.defaultValue!=null&&yi(f,!!I.multiple,I.defaultValue,!0);break;default:typeof N.onClick=="function"&&(f.onclick=yo)}switch(S){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return Vr(g),null;case 6:if(f&&g.stateNode!=null)kg(f,g,f.memoizedProps,I);else{if(typeof I!="string"&&g.stateNode===null)throw Error(t(166));if(S=r(x.current),r(bs.current),au(g)){if(I=g.stateNode,S=g.memoizedProps,I[ki]=g,(V=I.nodeValue!==S)&&(f=ts,f!==null))switch(f.tag){case 3:Jl(I.nodeValue,S,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&Jl(I.nodeValue,S,(f.mode&1)!==0)}V&&(g.flags|=4)}else I=(S.nodeType===9?S:S.ownerDocument).createTextNode(I),I[ki]=g,g.stateNode=I}return Vr(g),null;case 13:if(Un(P),I=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(vi&&Ur!==null&&(g.mode&1)!==0&&(g.flags&128)===0)lu(),ys(),g.flags|=98560,V=!1;else if(V=au(g),I!==null&&I.dehydrated!==null){if(f===null){if(!V)throw Error(t(318));if(V=g.memoizedState,V=V!==null?V.dehydrated:null,!V)throw Error(t(317));V[ki]=g}else ys(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;Vr(g),V=!1}else Os!==null&&(fm(Os),Os=null),V=!0;if(!V)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=S,g):(I=I!==null,I!==(f!==null&&f.memoizedState!==null)&&I&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(P.current&1)!==0?Hi===0&&(Hi=3):If())),g.updateQueue!==null&&(g.flags|=4),Vr(g),null);case 4:return m(),yf(f,g),f===null&&ma(g.stateNode.containerInfo),Vr(g),null;case 10:return Qu(g.type._context),Vr(g),null;case 17:return Sr(g.type)&&nl(),Vr(g),null;case 19:if(Un(P),V=g.memoizedState,V===null)return Vr(g),null;if(I=(g.flags&128)!==0,ee=V.rendering,ee===null)if(I)ih(V,!1);else{if(Hi!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(ee=R(f),ee!==null){for(g.flags|=128,ih(V,!1),I=ee.updateQueue,I!==null&&(g.updateQueue=I,g.flags|=4),g.subtreeFlags=0,I=S,S=g.child;S!==null;)V=S,f=I,V.flags&=14680066,ee=V.alternate,ee===null?(V.childLanes=0,V.lanes=f,V.child=null,V.subtreeFlags=0,V.memoizedProps=null,V.memoizedState=null,V.updateQueue=null,V.dependencies=null,V.stateNode=null):(V.childLanes=ee.childLanes,V.lanes=ee.lanes,V.child=ee.child,V.subtreeFlags=0,V.deletions=null,V.memoizedProps=ee.memoizedProps,V.memoizedState=ee.memoizedState,V.updateQueue=ee.updateQueue,V.type=ee.type,f=ee.dependencies,V.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),S=S.sibling;return Ln(P,P.current&1|2),g.child}f=f.sibling}V.tail!==null&&Pn()>Ho&&(g.flags|=128,I=!0,ih(V,!1),g.lanes=4194304)}else{if(!I)if(f=R(ee),f!==null){if(g.flags|=128,I=!0,S=f.updateQueue,S!==null&&(g.updateQueue=S,g.flags|=4),ih(V,!0),V.tail===null&&V.tailMode==="hidden"&&!ee.alternate&&!vi)return Vr(g),null}else 2*Pn()-V.renderingStartTime>Ho&&S!==1073741824&&(g.flags|=128,I=!0,ih(V,!1),g.lanes=4194304);V.isBackwards?(ee.sibling=g.child,g.child=ee):(S=V.last,S!==null?S.sibling=ee:g.child=ee,V.last=ee)}return V.tail!==null?(g=V.tail,V.rendering=g,V.tail=g.sibling,V.renderingStartTime=Pn(),g.sibling=null,S=P.current,Ln(P,I?S&1|2:S&1),g):(Vr(g),null);case 22:case 23:return yu(),I=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==I&&(g.flags|=8192),I&&(g.mode&1)!==0?(Ns&1073741824)!==0&&(Vr(g),g.subtreeFlags&6&&(g.flags|=8192)):Vr(g),null;case 24:return null;case 25:return null}throw Error(t(156,g.tag))}function am(f,g){switch(su(g),g.tag){case 1:return Sr(g.type)&&nl(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return m(),Un(Fr),Un(ir),B(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return w(g),null;case 13:if(Un(P),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(t(340));ys()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return Un(P),null;case 4:return m(),null;case 10:return Qu(g.type._context),null;case 22:case 23:return yu(),null;case 24:return null;default:return null}}var cd=!1,Er=!1,ud=typeof WeakSet=="function"?WeakSet:Set,Nt=null;function fu(f,g){var S=f.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(I){Zi(f,g,I)}else S.current=null}function hd(f,g,S){try{S()}catch(I){Zi(f,g,I)}}var Dg=!1;function Og(f,g){if(Qc=Tr,f=ed(),Hl(f)){if("selectionStart"in f)var S={start:f.selectionStart,end:f.selectionEnd};else e:{S=(S=f.ownerDocument)&&S.defaultView||window;var I=S.getSelection&&S.getSelection();if(I&&I.rangeCount!==0){S=I.anchorNode;var N=I.anchorOffset,V=I.focusNode;I=I.focusOffset;try{S.nodeType,V.nodeType}catch{S=null;break e}var ee=0,Ee=-1,Oe=-1,ot=0,Tt=0,At=f,yt=null;t:for(;;){for(var Ht;At!==S||N!==0&&At.nodeType!==3||(Ee=ee+N),At!==V||I!==0&&At.nodeType!==3||(Oe=ee+I),At.nodeType===3&&(ee+=At.nodeValue.length),(Ht=At.firstChild)!==null;)yt=At,At=Ht;for(;;){if(At===f)break t;if(yt===S&&++ot===N&&(Ee=ee),yt===V&&++Tt===I&&(Oe=ee),(Ht=At.nextSibling)!==null)break;At=yt,yt=At.parentNode}At=Ht}S=Ee===-1||Oe===-1?null:{start:Ee,end:Oe}}else S=null}S=S||{start:0,end:0}}else S=null;for(Ya={focusedElem:f,selectionRange:S},Tr=!1,Nt=g;Nt!==null;)if(g=Nt,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,Nt=f;else for(;Nt!==null;){g=Nt;try{var Kt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Kt!==null){var Jt=Kt.memoizedProps,Qi=Kt.memoizedState,Qe=g.stateNode,Ve=Qe.getSnapshotBeforeUpdate(g.elementType===g.type?Jt:Fs(g.type,Jt),Qi);Qe.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var it=g.stateNode.containerInfo;it.nodeType===1?it.textContent="":it.nodeType===9&&it.documentElement&&it.removeChild(it.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Lt){Zi(g,g.return,Lt)}if(f=g.sibling,f!==null){f.return=g.return,Nt=f;break}Nt=g.return}return Kt=Dg,Dg=!1,Kt}function dd(f,g,S){var I=g.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var N=I=I.next;do{if((N.tag&f)===f){var V=N.destroy;N.destroy=void 0,V!==void 0&&hd(g,S,V)}N=N.next}while(N!==I)}}function vf(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var S=g=g.next;do{if((S.tag&f)===f){var I=S.create;S.destroy=I()}S=S.next}while(S!==g)}}function xf(f){var g=f.ref;if(g!==null){var S=f.stateNode;switch(f.tag){case 5:f=S;break;default:f=S}typeof g=="function"?g(f):g.current=f}}function Lg(f){var g=f.alternate;g!==null&&(f.alternate=null,Lg(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[ki],delete g[ga],delete g[tu],delete g[Ka],delete g[Ja])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function bf(f){return f.tag===5||f.tag===3||f.tag===4}function lm(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||bf(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function wf(f,g,S){var I=f.tag;if(I===5||I===6)f=f.stateNode,g?S.nodeType===8?S.parentNode.insertBefore(f,g):S.insertBefore(f,g):(S.nodeType===8?(g=S.parentNode,g.insertBefore(f,S)):(g=S,g.appendChild(f)),S=S._reactRootContainer,S!=null||g.onclick!==null||(g.onclick=yo));else if(I!==4&&(f=f.child,f!==null))for(wf(f,g,S),f=f.sibling;f!==null;)wf(f,g,S),f=f.sibling}function cm(f,g,S){var I=f.tag;if(I===5||I===6)f=f.stateNode,g?S.insertBefore(f,g):S.appendChild(f);else if(I!==4&&(f=f.child,f!==null))for(cm(f,g,S),f=f.sibling;f!==null;)cm(f,g,S),f=f.sibling}var $r=null,$o=!1;function Wo(f,g,S){for(S=S.child;S!==null;)Tf(f,g,S),S=S.sibling}function Tf(f,g,S){if(dr&&typeof dr.onCommitFiberUnmount=="function")try{dr.onCommitFiberUnmount(Xs,S)}catch{}switch(S.tag){case 5:Er||fu(S,g);case 6:var I=$r,N=$o;$r=null,Wo(f,g,S),$r=I,$o=N,$r!==null&&($o?(f=$r,S=S.stateNode,f.nodeType===8?f.parentNode.removeChild(S):f.removeChild(S)):$r.removeChild(S.stateNode));break;case 18:$r!==null&&($o?(f=$r,S=S.stateNode,f.nodeType===8?Hu(f.parentNode,S):f.nodeType===1&&Hu(f,S),ps(f)):Hu($r,S.stateNode));break;case 4:I=$r,N=$o,$r=S.stateNode.containerInfo,$o=!0,Wo(f,g,S),$r=I,$o=N;break;case 0:case 11:case 14:case 15:if(!Er&&(I=S.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){N=I=I.next;do{var V=N,ee=V.destroy;V=V.tag,ee!==void 0&&((V&2)!==0||(V&4)!==0)&&hd(S,g,ee),N=N.next}while(N!==I)}Wo(f,g,S);break;case 1:if(!Er&&(fu(S,g),I=S.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=S.memoizedProps,I.state=S.memoizedState,I.componentWillUnmount()}catch(Ee){Zi(S,g,Ee)}Wo(f,g,S);break;case 21:Wo(f,g,S);break;case 22:S.mode&1?(Er=(I=Er)||S.memoizedState!==null,Wo(f,g,S),Er=I):Wo(f,g,S);break;default:Wo(f,g,S)}}function um(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var S=f.stateNode;S===null&&(S=f.stateNode=new ud),g.forEach(function(I){var N=Zg.bind(null,f,I);S.has(I)||(S.add(I),I.then(N,N))})}}function Wr(f,g){var S=g.deletions;if(S!==null)for(var I=0;I<S.length;I++){var N=S[I];try{var V=f,ee=g,Ee=ee;e:for(;Ee!==null;){switch(Ee.tag){case 5:$r=Ee.stateNode,$o=!1;break e;case 3:$r=Ee.stateNode.containerInfo,$o=!0;break e;case 4:$r=Ee.stateNode.containerInfo,$o=!0;break e}Ee=Ee.return}if($r===null)throw Error(t(160));Tf(V,ee,N),$r=null,$o=!1;var Oe=N.alternate;Oe!==null&&(Oe.return=null),N.return=null}catch(ot){Zi(N,g,ot)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)rh(g,f),g=g.sibling}function rh(f,g){var S=f.alternate,I=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(Wr(g,f),Aa(f),I&4){try{dd(3,f,f.return),vf(3,f)}catch(Jt){Zi(f,f.return,Jt)}try{dd(5,f,f.return)}catch(Jt){Zi(f,f.return,Jt)}}break;case 1:Wr(g,f),Aa(f),I&512&&S!==null&&fu(S,S.return);break;case 5:if(Wr(g,f),Aa(f),I&512&&S!==null&&fu(S,S.return),f.flags&32){var N=f.stateNode;try{K(N,"")}catch(Jt){Zi(f,f.return,Jt)}}if(I&4&&(N=f.stateNode,N!=null)){var V=f.memoizedProps,ee=S!==null?S.memoizedProps:V,Ee=f.type,Oe=f.updateQueue;if(f.updateQueue=null,Oe!==null)try{Ee==="input"&&V.type==="radio"&&V.name!=null&&Pt(N,V),ze(Ee,ee);var ot=ze(Ee,V);for(ee=0;ee<Oe.length;ee+=2){var Tt=Oe[ee],At=Oe[ee+1];Tt==="style"?Ce(N,At):Tt==="dangerouslySetInnerHTML"?Le(N,At):Tt==="children"?K(N,At):se(N,Tt,At,ot)}switch(Ee){case"input":Yt(N,V);break;case"textarea":ds(N,V);break;case"select":var yt=N._wrapperState.wasMultiple;N._wrapperState.wasMultiple=!!V.multiple;var Ht=V.value;Ht!=null?yi(N,!!V.multiple,Ht,!1):yt!==!!V.multiple&&(V.defaultValue!=null?yi(N,!!V.multiple,V.defaultValue,!0):yi(N,!!V.multiple,V.multiple?[]:"",!1))}N[ga]=V}catch(Jt){Zi(f,f.return,Jt)}}break;case 6:if(Wr(g,f),Aa(f),I&4){if(f.stateNode===null)throw Error(t(162));N=f.stateNode,V=f.memoizedProps;try{N.nodeValue=V}catch(Jt){Zi(f,f.return,Jt)}}break;case 3:if(Wr(g,f),Aa(f),I&4&&S!==null&&S.memoizedState.isDehydrated)try{ps(g.containerInfo)}catch(Jt){Zi(f,f.return,Jt)}break;case 4:Wr(g,f),Aa(f);break;case 13:Wr(g,f),Aa(f),N=f.child,N.flags&8192&&(V=N.memoizedState!==null,N.stateNode.isHidden=V,!V||N.alternate!==null&&N.alternate.memoizedState!==null||(oh=Pn())),I&4&&um(f);break;case 22:if(Tt=S!==null&&S.memoizedState!==null,f.mode&1?(Er=(ot=Er)||Tt,Wr(g,f),Er=ot):Wr(g,f),Aa(f),I&8192){if(ot=f.memoizedState!==null,(f.stateNode.isHidden=ot)&&!Tt&&(f.mode&1)!==0)for(Nt=f,Tt=f.child;Tt!==null;){for(At=Nt=Tt;Nt!==null;){switch(yt=Nt,Ht=yt.child,yt.tag){case 0:case 11:case 14:case 15:dd(4,yt,yt.return);break;case 1:fu(yt,yt.return);var Kt=yt.stateNode;if(typeof Kt.componentWillUnmount=="function"){I=yt,S=yt.return;try{g=I,Kt.props=g.memoizedProps,Kt.state=g.memoizedState,Kt.componentWillUnmount()}catch(Jt){Zi(I,S,Jt)}}break;case 5:fu(yt,yt.return);break;case 22:if(yt.memoizedState!==null){Bg(At);continue}}Ht!==null?(Ht.return=yt,Nt=Ht):Bg(At)}Tt=Tt.sibling}e:for(Tt=null,At=f;;){if(At.tag===5){if(Tt===null){Tt=At;try{N=At.stateNode,ot?(V=N.style,typeof V.setProperty=="function"?V.setProperty("display","none","important"):V.display="none"):(Ee=At.stateNode,Oe=At.memoizedProps.style,ee=Oe!=null&&Oe.hasOwnProperty("display")?Oe.display:null,Ee.style.display=we("display",ee))}catch(Jt){Zi(f,f.return,Jt)}}}else if(At.tag===6){if(Tt===null)try{At.stateNode.nodeValue=ot?"":At.memoizedProps}catch(Jt){Zi(f,f.return,Jt)}}else if((At.tag!==22&&At.tag!==23||At.memoizedState===null||At===f)&&At.child!==null){At.child.return=At,At=At.child;continue}if(At===f)break e;for(;At.sibling===null;){if(At.return===null||At.return===f)break e;Tt===At&&(Tt=null),At=At.return}Tt===At&&(Tt=null),At.sibling.return=At.return,At=At.sibling}}break;case 19:Wr(g,f),Aa(f),I&4&&um(f);break;case 21:break;default:Wr(g,f),Aa(f)}}function Aa(f){var g=f.flags;if(g&2){try{e:{for(var S=f.return;S!==null;){if(bf(S)){var I=S;break e}S=S.return}throw Error(t(160))}switch(I.tag){case 5:var N=I.stateNode;I.flags&32&&(K(N,""),I.flags&=-33);var V=lm(f);cm(f,V,N);break;case 3:case 4:var ee=I.stateNode.containerInfo,Ee=lm(f);wf(f,Ee,ee);break;default:throw Error(t(161))}}catch(Oe){Zi(f,f.return,Oe)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function Zy(f,g,S){Nt=f,Fg(f)}function Fg(f,g,S){for(var I=(f.mode&1)!==0;Nt!==null;){var N=Nt,V=N.child;if(N.tag===22&&I){var ee=N.memoizedState!==null||cd;if(!ee){var Ee=N.alternate,Oe=Ee!==null&&Ee.memoizedState!==null||Er;Ee=cd;var ot=Er;if(cd=ee,(Er=Oe)&&!ot)for(Nt=N;Nt!==null;)ee=Nt,Oe=ee.child,ee.tag===22&&ee.memoizedState!==null?zg(N):Oe!==null?(Oe.return=ee,Nt=Oe):zg(N);for(;V!==null;)Nt=V,Fg(V),V=V.sibling;Nt=N,cd=Ee,Er=ot}Ng(f)}else(N.subtreeFlags&8772)!==0&&V!==null?(V.return=N,Nt=V):Ng(f)}}function Ng(f){for(;Nt!==null;){var g=Nt;if((g.flags&8772)!==0){var S=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:Er||vf(5,g);break;case 1:var I=g.stateNode;if(g.flags&4&&!Er)if(S===null)I.componentDidMount();else{var N=g.elementType===g.type?S.memoizedProps:Fs(g.type,S.memoizedProps);I.componentDidUpdate(N,S.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var V=g.updateQueue;V!==null&&eh(g,V,I);break;case 3:var ee=g.updateQueue;if(ee!==null){if(S=null,g.child!==null)switch(g.child.tag){case 5:S=g.child.stateNode;break;case 1:S=g.child.stateNode}eh(g,ee,S)}break;case 5:var Ee=g.stateNode;if(S===null&&g.flags&4){S=Ee;var Oe=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Oe.autoFocus&&S.focus();break;case"img":Oe.src&&(S.src=Oe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var ot=g.alternate;if(ot!==null){var Tt=ot.memoizedState;if(Tt!==null){var At=Tt.dehydrated;At!==null&&ps(At)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Er||g.flags&512&&xf(g)}catch(yt){Zi(g,g.return,yt)}}if(g===f){Nt=null;break}if(S=g.sibling,S!==null){S.return=g.return,Nt=S;break}Nt=g.return}}function Bg(f){for(;Nt!==null;){var g=Nt;if(g===f){Nt=null;break}var S=g.sibling;if(S!==null){S.return=g.return,Nt=S;break}Nt=g.return}}function zg(f){for(;Nt!==null;){var g=Nt;try{switch(g.tag){case 0:case 11:case 15:var S=g.return;try{vf(4,g)}catch(Oe){Zi(g,S,Oe)}break;case 1:var I=g.stateNode;if(typeof I.componentDidMount=="function"){var N=g.return;try{I.componentDidMount()}catch(Oe){Zi(g,N,Oe)}}var V=g.return;try{xf(g)}catch(Oe){Zi(g,V,Oe)}break;case 5:var ee=g.return;try{xf(g)}catch(Oe){Zi(g,ee,Oe)}}}catch(Oe){Zi(g,g.return,Oe)}if(g===f){Nt=null;break}var Ee=g.sibling;if(Ee!==null){Ee.return=g.return,Nt=Ee;break}Nt=g.return}}var Xy=Math.ceil,sh=Se.ReactCurrentDispatcher,hm=Se.ReactCurrentOwner,so=Se.ReactCurrentBatchConfig,jn=0,Pr=null,On=null,Wi=0,Ns=0,dl=gs(0),Hi=0,fl=null,dc=0,fd=0,pu=0,mu=null,mr=null,oh=0,Ho=1/0,oo=null,Sf=!1,Af=null,Bs=null,Ef=!1,pl=null,fc=0,gu=0,Pf=null,pd=-1,Cf=0;function ws(){return(jn&6)!==0?Pn():pd!==-1?pd:pd=Pn()}function pc(f){return(f.mode&1)===0?1:(jn&2)!==0&&Wi!==0?Wi&-Wi:Yp.transition!==null?(Cf===0&&(Cf=Ba()),Cf):(f=Zn,f!==0||(f=window.event,f=f===void 0?16:Ll(f.type)),f)}function Zo(f,g,S,I){if(50<gu)throw gu=0,Pf=null,Error(t(185));za(f,S,I),((jn&2)===0||f!==Pr)&&(f===Pr&&((jn&2)===0&&(fd|=S),Hi===4&&mc(f,Wi)),zs(f,I),S===1&&jn===0&&(g.mode&1)===0&&(Ho=Pn()+500,Qr&&va()))}function zs(f,g){var S=f.callbackNode;Oh(f,g);var I=Rl(f,f===Pr?Wi:0);if(I===0)S!==null&&Rc(S),f.callbackNode=null,f.callbackPriority=0;else if(g=I&-I,f.callbackPriority!==g){if(S!=null&&Rc(S),g===1)f.tag===0?Gp(pm.bind(null,f)):ec(pm.bind(null,f)),Wu(function(){(jn&6)===0&&va()}),S=null;else{switch(Is(I)){case 1:S=wr;break;case 4:S=ei;break;case 16:S=kc;break;case 536870912:S=ku;break;default:S=kc}S=Xg(S,_u.bind(null,f))}f.callbackPriority=g,f.callbackNode=S}}function _u(f,g){if(pd=-1,Cf=0,(jn&6)!==0)throw Error(t(327));var S=f.callbackNode;if(lh()&&f.callbackNode!==S)return null;var I=Rl(f,f===Pr?Wi:0);if(I===0)return null;if((I&30)!==0||(I&f.expiredLanes)!==0||g)g=md(f,I);else{g=I;var N=jn;jn|=2;var V=Vg();(Pr!==f||Wi!==g)&&(oo=null,Ho=Pn()+500,gl(f,g));do try{Gy();break}catch(Ee){jg(f,Ee)}while(!0);al(),sh.current=V,jn=N,On!==null?g=0:(Pr=null,Wi=0,g=Hi)}if(g!==0){if(g===2&&(N=Lc(f),N!==0&&(I=N,g=dm(f,N))),g===1)throw S=fl,gl(f,0),mc(f,I),zs(f,Pn()),S;if(g===6)mc(f,I);else{if(N=f.current.alternate,(I&30)===0&&!Ug(N)&&(g=md(f,I),g===2&&(V=Lc(f),V!==0&&(I=V,g=dm(f,V))),g===1))throw S=fl,gl(f,0),mc(f,I),zs(f,Pn()),S;switch(f.finishedWork=N,f.finishedLanes=I,g){case 0:case 1:throw Error(t(345));case 2:vu(f,mr,oo);break;case 3:if(mc(f,I),(I&130023424)===I&&(g=oh+500-Pn(),10<g)){if(Rl(f,0)!==0)break;if(N=f.suspendedLanes,(N&I)!==I){ws(),f.pingedLanes|=f.suspendedLanes&N;break}f.timeoutHandle=eu(vu.bind(null,f,mr,oo),g);break}vu(f,mr,oo);break;case 4:if(mc(f,I),(I&4194240)===I)break;for(g=f.eventTimes,N=-1;0<I;){var ee=31-Cs(I);V=1<<ee,ee=g[ee],ee>N&&(N=ee),I&=~V}if(I=N,I=Pn()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*Xy(I/1960))-I,10<I){f.timeoutHandle=eu(vu.bind(null,f,mr,oo),I);break}vu(f,mr,oo);break;case 5:vu(f,mr,oo);break;default:throw Error(t(329))}}}return zs(f,Pn()),f.callbackNode===S?_u.bind(null,f):null}function dm(f,g){var S=mu;return f.current.memoizedState.isDehydrated&&(gl(f,g).flags|=256),f=md(f,g),f!==2&&(g=mr,mr=S,g!==null&&fm(g)),f}function fm(f){mr===null?mr=f:mr.push.apply(mr,f)}function Ug(f){for(var g=f;;){if(g.flags&16384){var S=g.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var I=0;I<S.length;I++){var N=S[I],V=N.getSnapshot;N=N.value;try{if(!eo(V(),N))return!1}catch{return!1}}}if(S=g.child,g.subtreeFlags&16384&&S!==null)S.return=g,g=S;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function mc(f,g){for(g&=~pu,g&=~fd,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var S=31-Cs(g),I=1<<S;f[S]=-1,g&=~I}}function pm(f){if((jn&6)!==0)throw Error(t(327));lh();var g=Rl(f,0);if((g&1)===0)return zs(f,Pn()),null;var S=md(f,g);if(f.tag!==0&&S===2){var I=Lc(f);I!==0&&(g=I,S=dm(f,I))}if(S===1)throw S=fl,gl(f,0),mc(f,g),zs(f,Pn()),S;if(S===6)throw Error(t(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,vu(f,mr,oo),zs(f,Pn()),null}function mm(f,g){var S=jn;jn|=1;try{return f(g)}finally{jn=S,jn===0&&(Ho=Pn()+500,Qr&&va())}}function ml(f){pl!==null&&pl.tag===0&&(jn&6)===0&&lh();var g=jn;jn|=1;var S=so.transition,I=Zn;try{if(so.transition=null,Zn=1,f)return f()}finally{Zn=I,so.transition=S,jn=g,(jn&6)===0&&va()}}function yu(){Ns=dl.current,Un(dl)}function gl(f,g){f.finishedWork=null,f.finishedLanes=0;var S=f.timeoutHandle;if(S!==-1&&(f.timeoutHandle=-1,lf(S)),On!==null)for(S=On.return;S!==null;){var I=S;switch(su(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&nl();break;case 3:m(),Un(Fr),Un(ir),B();break;case 5:w(I);break;case 4:m();break;case 13:Un(P);break;case 19:Un(P);break;case 10:Qu(I.type._context);break;case 22:case 23:yu()}S=S.return}if(Pr=f,On=f=gc(f.current,null),Wi=Ns=g,Hi=0,fl=null,pu=fd=dc=0,mr=mu=null,pr!==null){for(g=0;g<pr.length;g++)if(S=pr[g],I=S.interleaved,I!==null){S.interleaved=null;var N=I.next,V=S.pending;if(V!==null){var ee=V.next;V.next=N,I.next=ee}S.pending=I}pr=null}return f}function jg(f,g){do{var S=On;try{if(al(),U.current=sr,ae){for(var I=Z.memoizedState;I!==null;){var N=I.queue;N!==null&&(N.pending=null),I=I.next}ae=!1}if($=0,re=Q=Z=null,le=!1,pe=0,hm.current=null,S===null||S.return===null){Hi=1,fl=g,On=null;break}e:{var V=f,ee=S.return,Ee=S,Oe=g;if(g=Wi,Ee.flags|=32768,Oe!==null&&typeof Oe=="object"&&typeof Oe.then=="function"){var ot=Oe,Tt=Ee,At=Tt.tag;if((Tt.mode&1)===0&&(At===0||At===11||At===15)){var yt=Tt.alternate;yt?(Tt.updateQueue=yt.updateQueue,Tt.memoizedState=yt.memoizedState,Tt.lanes=yt.lanes):(Tt.updateQueue=null,Tt.memoizedState=null)}var Ht=hf(ee);if(Ht!==null){Ht.flags&=-257,Jp(Ht,ee,Ee,V,g),Ht.mode&1&&Kp(V,ot,g),g=Ht,Oe=ot;var Kt=g.updateQueue;if(Kt===null){var Jt=new Set;Jt.add(Oe),g.updateQueue=Jt}else Kt.add(Oe);break e}else{if((g&1)===0){Kp(V,ot,g),If();break e}Oe=Error(t(426))}}else if(vi&&Ee.mode&1){var Qi=hf(ee);if(Qi!==null){(Qi.flags&65536)===0&&(Qi.flags|=256),Jp(Qi,ee,Ee,V,g),Xn(os(Oe,Ee));break e}}V=Oe=os(Oe,Ee),Hi!==4&&(Hi=2),mu===null?mu=[V]:mu.push(V),V=ee;do{switch(V.tag){case 3:V.flags|=65536,g&=-g,V.lanes|=g;var Qe=cc(V,Oe,g);cu(V,Qe);break e;case 1:Ee=Oe;var Ve=V.type,it=V.stateNode;if((V.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||it!==null&&typeof it.componentDidCatch=="function"&&(Bs===null||!Bs.has(it)))){V.flags|=65536,g&=-g,V.lanes|=g;var Lt=Eg(V,Ee,g);cu(V,Lt);break e}}V=V.return}while(V!==null)}gm(S)}catch(en){g=en,On===S&&S!==null&&(On=S=S.return);continue}break}while(!0)}function Vg(){var f=sh.current;return sh.current=sr,f===null?sr:f}function If(){(Hi===0||Hi===3||Hi===2)&&(Hi=4),Pr===null||(dc&268435455)===0&&(fd&268435455)===0||mc(Pr,Wi)}function md(f,g){var S=jn;jn|=2;var I=Vg();(Pr!==f||Wi!==g)&&(oo=null,gl(f,g));do try{qy();break}catch(N){jg(f,N)}while(!0);if(al(),jn=S,sh.current=I,On!==null)throw Error(t(261));return Pr=null,Wi=0,Hi}function qy(){for(;On!==null;)ah(On)}function Gy(){for(;On!==null&&!ho();)ah(On)}function ah(f){var g=_m(f.alternate,f,Ns);f.memoizedProps=f.pendingProps,g===null?gm(f):On=g,hm.current=null}function gm(f){var g=f;do{var S=g.alternate;if(f=g.return,(g.flags&32768)===0){if(S=Hy(S,g,Ns),S!==null){On=S;return}}else{if(S=am(S,g),S!==null){S.flags&=32767,On=S;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{Hi=6,On=null;return}}if(g=g.sibling,g!==null){On=g;return}On=g=f}while(g!==null);Hi===0&&(Hi=5)}function vu(f,g,S){var I=Zn,N=so.transition;try{so.transition=null,Zn=1,Yy(f,g,S,I)}finally{so.transition=N,Zn=I}return null}function Yy(f,g,S,I){do lh();while(pl!==null);if((jn&6)!==0)throw Error(t(327));S=f.finishedWork;var N=f.finishedLanes;if(S===null)return null;if(f.finishedWork=null,f.finishedLanes=0,S===f.current)throw Error(t(177));f.callbackNode=null,f.callbackPriority=0;var V=S.lanes|S.childLanes;if(Up(f,V),f===Pr&&(On=Pr=null,Wi=0),(S.subtreeFlags&2064)===0&&(S.flags&2064)===0||Ef||(Ef=!0,Xg(kc,function(){return lh(),null})),V=(S.flags&15990)!==0,(S.subtreeFlags&15990)!==0||V){V=so.transition,so.transition=null;var ee=Zn;Zn=1;var Ee=jn;jn|=4,hm.current=null,Og(f,S),rh(S,f),Vu(Ya),Tr=!!Qc,Ya=Qc=null,f.current=S,Zy(S),Il(),jn=Ee,Zn=ee,so.transition=V}else f.current=S;if(Ef&&(Ef=!1,pl=f,fc=N),V=f.pendingLanes,V===0&&(Bs=null),Dh(S.stateNode),zs(f,Pn()),g!==null)for(I=f.onRecoverableError,S=0;S<g.length;S++)N=g[S],I(N.value,{componentStack:N.stack,digest:N.digest});if(Sf)throw Sf=!1,f=Af,Af=null,f;return(fc&1)!==0&&f.tag!==0&&lh(),V=f.pendingLanes,(V&1)!==0?f===Pf?gu++:(gu=0,Pf=f):gu=0,va(),null}function lh(){if(pl!==null){var f=Is(fc),g=so.transition,S=Zn;try{if(so.transition=null,Zn=16>f?16:f,pl===null)var I=!1;else{if(f=pl,pl=null,fc=0,(jn&6)!==0)throw Error(t(331));var N=jn;for(jn|=4,Nt=f.current;Nt!==null;){var V=Nt,ee=V.child;if((Nt.flags&16)!==0){var Ee=V.deletions;if(Ee!==null){for(var Oe=0;Oe<Ee.length;Oe++){var ot=Ee[Oe];for(Nt=ot;Nt!==null;){var Tt=Nt;switch(Tt.tag){case 0:case 11:case 15:dd(8,Tt,V)}var At=Tt.child;if(At!==null)At.return=Tt,Nt=At;else for(;Nt!==null;){Tt=Nt;var yt=Tt.sibling,Ht=Tt.return;if(Lg(Tt),Tt===ot){Nt=null;break}if(yt!==null){yt.return=Ht,Nt=yt;break}Nt=Ht}}}var Kt=V.alternate;if(Kt!==null){var Jt=Kt.child;if(Jt!==null){Kt.child=null;do{var Qi=Jt.sibling;Jt.sibling=null,Jt=Qi}while(Jt!==null)}}Nt=V}}if((V.subtreeFlags&2064)!==0&&ee!==null)ee.return=V,Nt=ee;else e:for(;Nt!==null;){if(V=Nt,(V.flags&2048)!==0)switch(V.tag){case 0:case 11:case 15:dd(9,V,V.return)}var Qe=V.sibling;if(Qe!==null){Qe.return=V.return,Nt=Qe;break e}Nt=V.return}}var Ve=f.current;for(Nt=Ve;Nt!==null;){ee=Nt;var it=ee.child;if((ee.subtreeFlags&2064)!==0&&it!==null)it.return=ee,Nt=it;else e:for(ee=Ve;Nt!==null;){if(Ee=Nt,(Ee.flags&2048)!==0)try{switch(Ee.tag){case 0:case 11:case 15:vf(9,Ee)}}catch(en){Zi(Ee,Ee.return,en)}if(Ee===ee){Nt=null;break e}var Lt=Ee.sibling;if(Lt!==null){Lt.return=Ee.return,Nt=Lt;break e}Nt=Ee.return}}if(jn=N,va(),dr&&typeof dr.onPostCommitFiberRoot=="function")try{dr.onPostCommitFiberRoot(Xs,f)}catch{}I=!0}return I}finally{Zn=S,so.transition=g}}return!1}function $g(f,g,S){g=os(S,g),g=cc(f,g,1),f=ns(f,g,1),g=ws(),f!==null&&(za(f,1,g),zs(f,g))}function Zi(f,g,S){if(f.tag===3)$g(f,f,S);else for(;g!==null;){if(g.tag===3){$g(g,f,S);break}else if(g.tag===1){var I=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Bs===null||!Bs.has(I))){f=os(S,f),f=Eg(g,f,1),g=ns(g,f,1),f=ws(),g!==null&&(za(g,1,f),zs(g,f));break}}g=g.return}}function Wg(f,g,S){var I=f.pingCache;I!==null&&I.delete(g),g=ws(),f.pingedLanes|=f.suspendedLanes&S,Pr===f&&(Wi&S)===S&&(Hi===4||Hi===3&&(Wi&130023424)===Wi&&500>Pn()-oh?gl(f,0):pu|=S),zs(f,g)}function Mf(f,g){g===0&&((f.mode&1)===0?g=1:(g=Ou,Ou<<=1,(Ou&130023424)===0&&(Ou=4194304)));var S=ws();f=Vn(f,g),f!==null&&(za(f,g,S),zs(f,S))}function Hg(f){var g=f.memoizedState,S=0;g!==null&&(S=g.retryLane),Mf(f,S)}function Zg(f,g){var S=0;switch(f.tag){case 13:var I=f.stateNode,N=f.memoizedState;N!==null&&(S=N.retryLane);break;case 19:I=f.stateNode;break;default:throw Error(t(314))}I!==null&&I.delete(g),Mf(f,S)}var _m;_m=function(f,g,S){if(f!==null)if(f.memoizedProps!==g.pendingProps||Fr.current)or=!0;else{if((f.lanes&S)===0&&(g.flags&128)===0)return or=!1,sm(f,g,S);or=(f.flags&131072)!==0}else or=!1,vi&&(g.flags&1048576)!==0&&Xu(g,Br,g.index);switch(g.lanes=0,g.tag){case 2:var I=g.type;_f(f,g),f=g.pendingProps;var N=no(g,ir.current);zi(g,S),N=Me(null,g,I,f,N,S);var V=xe();return g.flags|=1,typeof N=="object"&&N!==null&&typeof N.render=="function"&&N.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Sr(I)?(V=!0,Nr(g)):V=!1,g.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,nc(g),N.updater=oc,g.stateNode=N,N._reactInternals=g,ss(g,I,f,S),g=nm(null,g,I,!0,V,S)):(g.tag=0,vi&&V&&Rn(g),as(null,g,N,S),g=g.child),g;case 16:I=g.elementType;e:{switch(_f(f,g),f=g.pendingProps,N=I._init,I=N(I._payload),g.type=I,N=g.tag=Ky(I),f=Fs(I,f),N){case 0:g=tm(null,g,I,f,S);break e;case 1:g=ff(null,g,I,f,S);break e;case 11:g=Pg(null,g,I,f,S);break e;case 14:g=df(null,g,I,Fs(I.type,f),S);break e}throw Error(t(306,I,""))}return g;case 0:return I=g.type,N=g.pendingProps,N=g.elementType===I?N:Fs(I,N),tm(f,g,I,N,S);case 1:return I=g.type,N=g.pendingProps,N=g.elementType===I?N:Fs(I,N),ff(f,g,I,N,S);case 3:e:{if(pf(g),f===null)throw Error(t(387));I=g.pendingProps,V=g.memoizedState,N=V.element,ic(f,g),Ls(g,I,null,S);var ee=g.memoizedState;if(I=ee.element,V.isDehydrated)if(V={element:I,isDehydrated:!1,cache:ee.cache,pendingSuspenseBoundaries:ee.pendingSuspenseBoundaries,transitions:ee.transitions},g.updateQueue.baseState=V,g.memoizedState=V,g.flags&256){N=os(Error(t(423)),g),g=im(f,g,I,S,N);break e}else if(I!==N){N=os(Error(t(424)),g),g=im(f,g,I,S,N);break e}else for(Ur=vo(g.stateNode.containerInfo.firstChild),ts=g,vi=!0,Os=null,S=cf(g,null,I,S),g.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(ys(),I===N){g=Sa(f,g,S);break e}as(f,g,I,S)}g=g.child}return g;case 5:return y(g),f===null&&Gu(g),I=g.type,N=g.pendingProps,V=f!==null?f.memoizedProps:null,ee=N.children,Ql(I,N)?ee=null:V!==null&&Ql(I,V)&&(g.flags|=32),em(f,g),as(f,g,ee,S),g.child;case 6:return f===null&&Gu(g),null;case 13:return Cg(f,g,S);case 4:return h(g,g.stateNode.containerInfo),I=g.pendingProps,f===null?g.child=sl(g,null,I,S):as(f,g,I,S),g.child;case 11:return I=g.type,N=g.pendingProps,N=g.elementType===I?N:Fs(I,N),Pg(f,g,I,N,S);case 7:return as(f,g,g.pendingProps,S),g.child;case 8:return as(f,g,g.pendingProps.children,S),g.child;case 12:return as(f,g,g.pendingProps.children,S),g.child;case 10:e:{if(I=g.type._context,N=g.pendingProps,V=g.memoizedProps,ee=N.value,Ln(vs,I._currentValue),I._currentValue=ee,V!==null)if(eo(V.value,ee)){if(V.children===N.children&&!Fr.current){g=Sa(f,g,S);break e}}else for(V=g.child,V!==null&&(V.return=g);V!==null;){var Ee=V.dependencies;if(Ee!==null){ee=V.child;for(var Oe=Ee.firstContext;Oe!==null;){if(Oe.context===I){if(V.tag===1){Oe=jr(-1,S&-S),Oe.tag=2;var ot=V.updateQueue;if(ot!==null){ot=ot.shared;var Tt=ot.pending;Tt===null?Oe.next=Oe:(Oe.next=Tt.next,Tt.next=Oe),ot.pending=Oe}}V.lanes|=S,Oe=V.alternate,Oe!==null&&(Oe.lanes|=S),tc(V.return,S,g),Ee.lanes|=S;break}Oe=Oe.next}}else if(V.tag===10)ee=V.type===g.type?null:V.child;else if(V.tag===18){if(ee=V.return,ee===null)throw Error(t(341));ee.lanes|=S,Ee=ee.alternate,Ee!==null&&(Ee.lanes|=S),tc(ee,S,g),ee=V.sibling}else ee=V.child;if(ee!==null)ee.return=V;else for(ee=V;ee!==null;){if(ee===g){ee=null;break}if(V=ee.sibling,V!==null){V.return=ee.return,ee=V;break}ee=ee.return}V=ee}as(f,g,N.children,S),g=g.child}return g;case 9:return N=g.type,I=g.pendingProps.children,zi(g,S),N=xs(N),I=I(N),g.flags|=1,as(f,g,I,S),g.child;case 14:return I=g.type,N=Fs(I,g.pendingProps),N=Fs(I.type,N),df(f,g,I,N,S);case 15:return Qp(f,g,g.type,g.pendingProps,S);case 17:return I=g.type,N=g.pendingProps,N=g.elementType===I?N:Fs(I,N),_f(f,g),g.tag=1,Sr(I)?(f=!0,Nr(g)):f=!1,zi(g,S),rs(g,I,N),ss(g,I,N,S),nm(null,g,I,!0,f,S);case 19:return Mg(f,g,S);case 22:return ld(f,g,S)}throw Error(t(156,g.tag))};function Xg(f,g){return Io(f,g)}function Rf(f,g,S,I){this.tag=f,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ao(f,g,S,I){return new Rf(f,g,S,I)}function kf(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Ky(f){if(typeof f=="function")return kf(f)?1:0;if(f!=null){if(f=f.$$typeof,f===pn)return 11;if(f===kn)return 14}return 2}function gc(f,g){var S=f.alternate;return S===null?(S=Ao(f.tag,g,f.key,f.mode),S.elementType=f.elementType,S.type=f.type,S.stateNode=f.stateNode,S.alternate=f,f.alternate=S):(S.pendingProps=g,S.type=f.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=f.flags&14680064,S.childLanes=f.childLanes,S.lanes=f.lanes,S.child=f.child,S.memoizedProps=f.memoizedProps,S.memoizedState=f.memoizedState,S.updateQueue=f.updateQueue,g=f.dependencies,S.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},S.sibling=f.sibling,S.index=f.index,S.ref=f.ref,S}function Df(f,g,S,I,N,V){var ee=2;if(I=f,typeof f=="function")kf(f)&&(ee=1);else if(typeof f=="string")ee=5;else e:switch(f){case dt:return _c(S.children,N,V,g);case gt:ee=8,N|=8;break;case vt:return f=Ao(12,S,g,N|2),f.elementType=vt,f.lanes=V,f;case sn:return f=Ao(13,S,g,N),f.elementType=sn,f.lanes=V,f;case rn:return f=Ao(19,S,g,N),f.elementType=rn,f.lanes=V,f;case ke:return Of(S,N,V,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case Ft:ee=10;break e;case Wt:ee=9;break e;case pn:ee=11;break e;case kn:ee=14;break e;case Pe:ee=16,I=null;break e}throw Error(t(130,f==null?f:typeof f,""))}return g=Ao(ee,S,g,N),g.elementType=f,g.type=I,g.lanes=V,g}function _c(f,g,S,I){return f=Ao(7,f,I,g),f.lanes=S,f}function Of(f,g,S,I){return f=Ao(22,f,I,g),f.elementType=ke,f.lanes=S,f.stateNode={isHidden:!1},f}function ym(f,g,S){return f=Ao(6,f,null,g),f.lanes=S,f}function xu(f,g,S){return g=Ao(4,f.children!==null?f.children:[],f.key,g),g.lanes=S,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function ar(f,g,S,I,N){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Fc(0),this.expirationTimes=Fc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fc(0),this.identifierPrefix=I,this.onRecoverableError=N,this.mutableSourceEagerHydrationData=null}function gd(f,g,S,I,N,V,ee,Ee,Oe){return f=new ar(f,g,S,Ee,Oe),g===1?(g=1,V===!0&&(g|=8)):g=0,V=Ao(3,null,null,g),f.current=V,V.stateNode=f,V.memoizedState={element:I,isDehydrated:S,cache:null,transitions:null,pendingSuspenseBoundaries:null},nc(V),f}function qg(f,g,S){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:nt,key:I==null?null:""+I,children:f,containerInfo:g,implementation:S}}function vm(f){if(!f)return _s;f=f._reactInternals;e:{if(mn(f)!==f||f.tag!==1)throw Error(t(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Sr(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(t(171))}if(f.tag===1){var S=f.type;if(Sr(S))return ru(f,S,g)}return g}function Lf(f,g,S,I,N,V,ee,Ee,Oe){return f=gd(S,I,!0,f,N,V,ee,Ee,Oe),f.context=vm(null),S=f.current,I=ws(),N=pc(S),V=jr(I,N),V.callback=g??null,ns(S,V,N),f.current.lanes=N,za(f,N,I),zs(f,I),f}function _l(f,g,S,I){var N=g.current,V=ws(),ee=pc(N);return S=vm(S),g.context===null?g.context=S:g.pendingContext=S,g=jr(V,ee),g.payload={element:f},I=I===void 0?null:I,I!==null&&(g.callback=I),f=ns(N,g,ee),f!==null&&(Zo(f,N,ee,V),rc(f,N,ee)),ee}function _d(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function Gg(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var S=f.retryLane;f.retryLane=S!==0&&S<g?S:g}}function xm(f,g){Gg(f,g),(f=f.alternate)&&Gg(f,g)}function Jy(){return null}var Yg=typeof reportError=="function"?reportError:function(f){console.error(f)};function bm(f){this._internalRoot=f}Ff.prototype.render=bm.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(t(409));_l(f,g,null,null)},Ff.prototype.unmount=bm.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;ml(function(){_l(null,f,null,null)}),g[ks]=null}};function Ff(f){this._internalRoot=f}Ff.prototype.unstable_scheduleHydration=function(f){if(f){var g=fo();f={blockedOn:null,target:f,priority:g};for(var S=0;S<li.length&&g!==0&&g<li[S].priority;S++);li.splice(S,0,f),S===0&&fr(f)}};function wm(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function Nf(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function Kg(){}function Qy(f,g,S,I,N){if(N){if(typeof I=="function"){var V=I;I=function(){var ot=_d(ee);V.call(ot)}}var ee=Lf(g,I,f,0,null,!1,!1,"",Kg);return f._reactRootContainer=ee,f[ks]=ee.current,ma(f.nodeType===8?f.parentNode:f),ml(),ee}for(;N=f.lastChild;)f.removeChild(N);if(typeof I=="function"){var Ee=I;I=function(){var ot=_d(Oe);Ee.call(ot)}}var Oe=gd(f,0,!1,null,null,!1,!1,"",Kg);return f._reactRootContainer=Oe,f[ks]=Oe.current,ma(f.nodeType===8?f.parentNode:f),ml(function(){_l(g,Oe,S,I)}),Oe}function Bf(f,g,S,I,N){var V=S._reactRootContainer;if(V){var ee=V;if(typeof N=="function"){var Ee=N;N=function(){var Oe=_d(ee);Ee.call(Oe)}}_l(g,ee,f,N)}else ee=Qy(S,g,f,N,I);return _d(ee)}Cn=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var S=Oc(g.pendingLanes);S!==0&&(ia(g,S|1),zs(g,Pn()),(jn&6)===0&&(Ho=Pn()+500,va()))}break;case 13:ml(function(){var I=Vn(f,1);if(I!==null){var N=ws();Zo(I,f,1,N)}}),xm(f,1)}},Mo=function(f){if(f.tag===13){var g=Vn(f,134217728);if(g!==null){var S=ws();Zo(g,f,134217728,S)}xm(f,134217728)}},Ro=function(f){if(f.tag===13){var g=pc(f),S=Vn(f,g);if(S!==null){var I=ws();Zo(S,f,g,I)}xm(f,g)}},fo=function(){return Zn},ra=function(f,g){var S=Zn;try{return Zn=f,g()}finally{Zn=S}},at=function(f,g,S){switch(g){case"input":if(Yt(f,S),g=S.name,S.type==="radio"&&g!=null){for(S=f;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<S.length;g++){var I=S[g];if(I!==f&&I.form===f.form){var N=nu(I);if(!N)throw Error(t(90));Ii(I),Yt(I,N)}}}break;case"textarea":ds(f,S);break;case"select":g=S.value,g!=null&&yi(f,!!S.multiple,g,!1)}},yn=mm,ai=ml;var ev={usingClientEntryPoint:!1,Events:[Qa,el,nu,Dn,Xt,mm]},ch={findFiberByHostInstance:to,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Tm={bundleType:ch.bundleType,version:ch.version,rendererPackageName:ch.rendererPackageName,rendererConfig:ch.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Se.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=vn(f),f===null?null:f.stateNode},findFiberByHostInstance:ch.findFiberByHostInstance||Jy,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yd.isDisabled&&yd.supportsFiber)try{Xs=yd.inject(Tm),dr=yd}catch{}}return Eo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ev,Eo.createPortal=function(f,g){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!wm(g))throw Error(t(200));return qg(f,g,null,S)},Eo.createRoot=function(f,g){if(!wm(f))throw Error(t(299));var S=!1,I="",N=Yg;return g!=null&&(g.unstable_strictMode===!0&&(S=!0),g.identifierPrefix!==void 0&&(I=g.identifierPrefix),g.onRecoverableError!==void 0&&(N=g.onRecoverableError)),g=gd(f,1,!1,null,null,S,!1,I,N),f[ks]=g.current,ma(f.nodeType===8?f.parentNode:f),new bm(g)},Eo.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(t(188)):(f=Object.keys(f).join(","),Error(t(268,f)));return f=vn(g),f=f===null?null:f.stateNode,f},Eo.flushSync=function(f){return ml(f)},Eo.hydrate=function(f,g,S){if(!Nf(g))throw Error(t(200));return Bf(null,f,g,!0,S)},Eo.hydrateRoot=function(f,g,S){if(!wm(f))throw Error(t(405));var I=S!=null&&S.hydratedSources||null,N=!1,V="",ee=Yg;if(S!=null&&(S.unstable_strictMode===!0&&(N=!0),S.identifierPrefix!==void 0&&(V=S.identifierPrefix),S.onRecoverableError!==void 0&&(ee=S.onRecoverableError)),g=Lf(g,null,f,1,S??null,N,!1,V,ee),f[ks]=g.current,ma(f),I)for(f=0;f<I.length;f++)S=I[f],N=S._getVersion,N=N(S._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[S,N]:g.mutableSourceEagerHydrationData.push(S,N);return new Ff(g)},Eo.render=function(f,g,S){if(!Nf(g))throw Error(t(200));return Bf(null,f,g,!1,S)},Eo.unmountComponentAtNode=function(f){if(!Nf(f))throw Error(t(40));return f._reactRootContainer?(ml(function(){Bf(null,null,f,!1,function(){f._reactRootContainer=null,f[ks]=null})}),!0):!1},Eo.unstable_batchedUpdates=mm,Eo.unstable_renderSubtreeIntoContainer=function(f,g,S,I){if(!Nf(S))throw Error(t(200));if(f==null||f._reactInternals===void 0)throw Error(t(38));return Bf(f,g,S,!1,I)},Eo.version="18.3.1-next-f1338f8080-20240426",Eo}var t1;function hA(){if(t1)return bv.exports;t1=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),bv.exports=zI(),bv.exports}var n1;function UI(){if(n1)return s_;n1=1;var n=hA();return s_.createRoot=n.createRoot,s_.hydrateRoot=n.hydrateRoot,s_}var jI=UI(),Dx=hA();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function eg(){return eg=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},eg.apply(this,arguments)}var vh;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(vh||(vh={}));const i1="popstate";function VI(n){n===void 0&&(n={});function e(i,o){let{pathname:c,search:d,hash:a}=i.location;return A0("",{pathname:c,search:d,hash:a},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function t(i,o){return typeof o=="string"?o:fA(o)}return WI(e,t,null,n)}function Yr(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function dA(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function $I(){return Math.random().toString(36).substr(2,8)}function r1(n,e){return{usr:n.state,key:n.key,idx:e}}function A0(n,e,t,i){return t===void 0&&(t=null),eg({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?kp(e):e,{state:t,key:e&&e.key||i||$I()})}function fA(n){let{pathname:e="/",search:t="",hash:i=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function kp(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substr(i),n=n.substr(0,i)),n&&(e.pathname=n)}return e}function WI(n,e,t,i){i===void 0&&(i={});let{window:o=document.defaultView,v5Compat:c=!1}=i,d=o.history,a=vh.Pop,v=null,A=E();A==null&&(A=0,d.replaceState(eg({},d.state,{idx:A}),""));function E(){return(d.state||{idx:null}).idx}function k(){a=vh.Pop;let ne=E(),ue=ne==null?null:ne-A;A=ne,v&&v({action:a,location:Y.location,delta:ue})}function L(ne,ue){a=vh.Push;let ve=A0(Y.location,ne,ue);A=E()+1;let se=r1(ve,A),Se=Y.createHref(ve);try{d.pushState(se,"",Se)}catch(Ne){if(Ne instanceof DOMException&&Ne.name==="DataCloneError")throw Ne;o.location.assign(Se)}c&&v&&v({action:a,location:Y.location,delta:1})}function z(ne,ue){a=vh.Replace;let ve=A0(Y.location,ne,ue);A=E();let se=r1(ve,A),Se=Y.createHref(ve);d.replaceState(se,"",Se),c&&v&&v({action:a,location:Y.location,delta:0})}function q(ne){let ue=o.location.origin!=="null"?o.location.origin:o.location.href,ve=typeof ne=="string"?ne:fA(ne);return ve=ve.replace(/ $/,"%20"),Yr(ue,"No window.location.(origin|href) available to create URL for href: "+ve),new URL(ve,ue)}let Y={get action(){return a},get location(){return n(o,d)},listen(ne){if(v)throw new Error("A history only accepts one active listener");return o.addEventListener(i1,k),v=ne,()=>{o.removeEventListener(i1,k),v=null}},createHref(ne){return e(o,ne)},createURL:q,encodeLocation(ne){let ue=q(ne);return{pathname:ue.pathname,search:ue.search,hash:ue.hash}},push:L,replace:z,go(ne){return d.go(ne)}};return Y}var s1;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(s1||(s1={}));function HI(n,e,t){return t===void 0&&(t="/"),ZI(n,e,t)}function ZI(n,e,t,i){let o=typeof e=="string"?kp(e):e,c=gA(o.pathname||"/",t);if(c==null)return null;let d=pA(n);XI(d);let a=null;for(let v=0;a==null&&v<d.length;++v){let A=sM(c);a=nM(d[v],A)}return a}function pA(n,e,t,i){e===void 0&&(e=[]),t===void 0&&(t=[]),i===void 0&&(i="");let o=(c,d,a)=>{let v={relativePath:a===void 0?c.path||"":a,caseSensitive:c.caseSensitive===!0,childrenIndex:d,route:c};v.relativePath.startsWith("/")&&(Yr(v.relativePath.startsWith(i),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(i.length));let A=Od([i,v.relativePath]),E=t.concat(v);c.children&&c.children.length>0&&(Yr(c.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+A+'".')),pA(c.children,e,E,A)),!(c.path==null&&!c.index)&&e.push({path:A,score:eM(A,c.index),routesMeta:E})};return n.forEach((c,d)=>{var a;if(c.path===""||!((a=c.path)!=null&&a.includes("?")))o(c,d);else for(let v of mA(c.path))o(c,d,v)}),e}function mA(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,o=t.endsWith("?"),c=t.replace(/\?$/,"");if(i.length===0)return o?[c,""]:[c];let d=mA(i.join("/")),a=[];return a.push(...d.map(v=>v===""?c:[c,v].join("/"))),o&&a.push(...d),a.map(v=>n.startsWith("/")&&v===""?"/":v)}function XI(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:tM(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}const qI=/^:[\w-]+$/,GI=3,YI=2,KI=1,JI=10,QI=-2,o1=n=>n==="*";function eM(n,e){let t=n.split("/"),i=t.length;return t.some(o1)&&(i+=QI),e&&(i+=YI),t.filter(o=>!o1(o)).reduce((o,c)=>o+(qI.test(c)?GI:c===""?KI:JI),i)}function tM(n,e){return n.length===e.length&&n.slice(0,-1).every((i,o)=>i===e[o])?n[n.length-1]-e[e.length-1]:0}function nM(n,e,t){let{routesMeta:i}=n,o={},c="/",d=[];for(let a=0;a<i.length;++a){let v=i[a],A=a===i.length-1,E=c==="/"?e:e.slice(c.length)||"/",k=iM({path:v.relativePath,caseSensitive:v.caseSensitive,end:A},E),L=v.route;if(!k)return null;Object.assign(o,k.params),d.push({params:o,pathname:Od([c,k.pathname]),pathnameBase:hM(Od([c,k.pathnameBase])),route:L}),k.pathnameBase!=="/"&&(c=Od([c,k.pathnameBase]))}return d}function iM(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=rM(n.path,n.caseSensitive,n.end),o=e.match(t);if(!o)return null;let c=o[0],d=c.replace(/(.)\/+$/,"$1"),a=o.slice(1);return{params:i.reduce((A,E,k)=>{let{paramName:L,isOptional:z}=E;if(L==="*"){let Y=a[k]||"";d=c.slice(0,c.length-Y.length).replace(/(.)\/+$/,"$1")}const q=a[k];return z&&!q?A[L]=void 0:A[L]=(q||"").replace(/%2F/g,"/"),A},{}),pathname:c,pathnameBase:d,pattern:n}}function rM(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),dA(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let i=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,a,v)=>(i.push({paramName:a,isOptional:v!=null}),v?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(i.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,e?void 0:"i"),i]}function sM(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return dA(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function gA(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function oM(n,e){e===void 0&&(e="/");let{pathname:t,search:i="",hash:o=""}=typeof n=="string"?kp(n):n;return{pathname:t?t.startsWith("/")?t:aM(t,e):e,search:dM(i),hash:fM(o)}}function aM(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?t.length>1&&t.pop():o!=="."&&t.push(o)}),t.length>1?t.join("/"):"/"}function Sv(n,e,t,i){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function lM(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function cM(n,e){let t=lM(n);return e?t.map((i,o)=>o===t.length-1?i.pathname:i.pathnameBase):t.map(i=>i.pathnameBase)}function uM(n,e,t,i){i===void 0&&(i=!1);let o;typeof n=="string"?o=kp(n):(o=eg({},n),Yr(!o.pathname||!o.pathname.includes("?"),Sv("?","pathname","search",o)),Yr(!o.pathname||!o.pathname.includes("#"),Sv("#","pathname","hash",o)),Yr(!o.search||!o.search.includes("#"),Sv("#","search","hash",o)));let c=n===""||o.pathname==="",d=c?"/":o.pathname,a;if(d==null)a=t;else{let k=e.length-1;if(!i&&d.startsWith("..")){let L=d.split("/");for(;L[0]==="..";)L.shift(),k-=1;o.pathname=L.join("/")}a=k>=0?e[k]:"/"}let v=oM(o,a),A=d&&d!=="/"&&d.endsWith("/"),E=(c||d===".")&&t.endsWith("/");return!v.pathname.endsWith("/")&&(A||E)&&(v.pathname+="/"),v}const Od=n=>n.join("/").replace(/\/\/+/g,"/"),hM=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),dM=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,fM=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function pM(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const _A=["post","put","patch","delete"];new Set(_A);const mM=["get",..._A];new Set(mM);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tg(){return tg=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},tg.apply(this,arguments)}const Ox=ye.createContext(null),gM=ye.createContext(null),by=ye.createContext(null),wy=ye.createContext(null),Dp=ye.createContext({outlet:null,matches:[],isDataRoute:!1}),yA=ye.createContext(null);function Ty(){return ye.useContext(wy)!=null}function vA(){return Ty()||Yr(!1),ye.useContext(wy).location}function xA(n){ye.useContext(by).static||ye.useLayoutEffect(n)}function _M(){let{isDataRoute:n}=ye.useContext(Dp);return n?MM():yM()}function yM(){Ty()||Yr(!1);let n=ye.useContext(Ox),{basename:e,future:t,navigator:i}=ye.useContext(by),{matches:o}=ye.useContext(Dp),{pathname:c}=vA(),d=JSON.stringify(cM(o,t.v7_relativeSplatPath)),a=ye.useRef(!1);return xA(()=>{a.current=!0}),ye.useCallback(function(A,E){if(E===void 0&&(E={}),!a.current)return;if(typeof A=="number"){i.go(A);return}let k=uM(A,JSON.parse(d),c,E.relative==="path");n==null&&e!=="/"&&(k.pathname=k.pathname==="/"?e:Od([e,k.pathname])),(E.replace?i.replace:i.push)(k,E.state,E)},[e,i,d,c,n])}function vM(n,e){return xM(n,e)}function xM(n,e,t,i){Ty()||Yr(!1);let{navigator:o}=ye.useContext(by),{matches:c}=ye.useContext(Dp),d=c[c.length-1],a=d?d.params:{};d&&d.pathname;let v=d?d.pathnameBase:"/";d&&d.route;let A=vA(),E;if(e){var k;let ne=typeof e=="string"?kp(e):e;v==="/"||(k=ne.pathname)!=null&&k.startsWith(v)||Yr(!1),E=ne}else E=A;let L=E.pathname||"/",z=L;if(v!=="/"){let ne=v.replace(/^\//,"").split("/");z="/"+L.replace(/^\//,"").split("/").slice(ne.length).join("/")}let q=HI(n,{pathname:z}),Y=AM(q&&q.map(ne=>Object.assign({},ne,{params:Object.assign({},a,ne.params),pathname:Od([v,o.encodeLocation?o.encodeLocation(ne.pathname).pathname:ne.pathname]),pathnameBase:ne.pathnameBase==="/"?v:Od([v,o.encodeLocation?o.encodeLocation(ne.pathnameBase).pathname:ne.pathnameBase])})),c,t,i);return e&&Y?ye.createElement(wy.Provider,{value:{location:tg({pathname:"/",search:"",hash:"",state:null,key:"default"},E),navigationType:vh.Pop}},Y):Y}function bM(){let n=IM(),e=pM(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ye.createElement(ye.Fragment,null,ye.createElement("h2",null,"Unexpected Application Error!"),ye.createElement("h3",{style:{fontStyle:"italic"}},e),t?ye.createElement("pre",{style:o},t):null,null)}const wM=ye.createElement(bM,null);class TM extends ye.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?ye.createElement(Dp.Provider,{value:this.props.routeContext},ye.createElement(yA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function SM(n){let{routeContext:e,match:t,children:i}=n,o=ye.useContext(Ox);return o&&o.static&&o.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=t.route.id),ye.createElement(Dp.Provider,{value:e},i)}function AM(n,e,t,i){var o;if(e===void 0&&(e=[]),t===void 0&&(t=null),i===void 0&&(i=null),n==null){var c;if(!t)return null;if(t.errors)n=t.matches;else if((c=i)!=null&&c.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let d=n,a=(o=t)==null?void 0:o.errors;if(a!=null){let E=d.findIndex(k=>k.route.id&&a?.[k.route.id]!==void 0);E>=0||Yr(!1),d=d.slice(0,Math.min(d.length,E+1))}let v=!1,A=-1;if(t&&i&&i.v7_partialHydration)for(let E=0;E<d.length;E++){let k=d[E];if((k.route.HydrateFallback||k.route.hydrateFallbackElement)&&(A=E),k.route.id){let{loaderData:L,errors:z}=t,q=k.route.loader&&L[k.route.id]===void 0&&(!z||z[k.route.id]===void 0);if(k.route.lazy||q){v=!0,A>=0?d=d.slice(0,A+1):d=[d[0]];break}}}return d.reduceRight((E,k,L)=>{let z,q=!1,Y=null,ne=null;t&&(z=a&&k.route.id?a[k.route.id]:void 0,Y=k.route.errorElement||wM,v&&(A<0&&L===0?(RM("route-fallback"),q=!0,ne=null):A===L&&(q=!0,ne=k.route.hydrateFallbackElement||null)));let ue=e.concat(d.slice(0,L+1)),ve=()=>{let se;return z?se=Y:q?se=ne:k.route.Component?se=ye.createElement(k.route.Component,null):k.route.element?se=k.route.element:se=E,ye.createElement(SM,{match:k,routeContext:{outlet:E,matches:ue,isDataRoute:t!=null},children:se})};return t&&(k.route.ErrorBoundary||k.route.errorElement||L===0)?ye.createElement(TM,{location:t.location,revalidation:t.revalidation,component:Y,error:z,children:ve(),routeContext:{outlet:null,matches:ue,isDataRoute:!0}}):ve()},null)}var bA=(function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n})(bA||{}),wA=(function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n})(wA||{});function EM(n){let e=ye.useContext(Ox);return e||Yr(!1),e}function PM(n){let e=ye.useContext(gM);return e||Yr(!1),e}function CM(n){let e=ye.useContext(Dp);return e||Yr(!1),e}function TA(n){let e=CM(),t=e.matches[e.matches.length-1];return t.route.id||Yr(!1),t.route.id}function IM(){var n;let e=ye.useContext(yA),t=PM(),i=TA();return e!==void 0?e:(n=t.errors)==null?void 0:n[i]}function MM(){let{router:n}=EM(bA.UseNavigateStable),e=TA(wA.UseNavigateStable),t=ye.useRef(!1);return xA(()=>{t.current=!0}),ye.useCallback(function(o,c){c===void 0&&(c={}),t.current&&(typeof o=="number"?n.navigate(o):n.navigate(o,tg({fromRouteId:e},c)))},[n,e])}const a1={};function RM(n,e,t){a1[n]||(a1[n]=!0)}function kM(n,e){n?.v7_startTransition,n?.v7_relativeSplatPath}function M_(n){Yr(!1)}function DM(n){let{basename:e="/",children:t=null,location:i,navigationType:o=vh.Pop,navigator:c,static:d=!1,future:a}=n;Ty()&&Yr(!1);let v=e.replace(/^\/*/,"/"),A=ye.useMemo(()=>({basename:v,navigator:c,static:d,future:tg({v7_relativeSplatPath:!1},a)}),[v,a,c,d]);typeof i=="string"&&(i=kp(i));let{pathname:E="/",search:k="",hash:L="",state:z=null,key:q="default"}=i,Y=ye.useMemo(()=>{let ne=gA(E,v);return ne==null?null:{location:{pathname:ne,search:k,hash:L,state:z,key:q},navigationType:o}},[v,E,k,L,z,q,o]);return Y==null?null:ye.createElement(by.Provider,{value:A},ye.createElement(wy.Provider,{children:t,value:Y}))}function OM(n){let{children:e,location:t}=n;return vM(E0(e),t)}new Promise(()=>{});function E0(n,e){e===void 0&&(e=[]);let t=[];return ye.Children.forEach(n,(i,o)=>{if(!ye.isValidElement(i))return;let c=[...e,o];if(i.type===ye.Fragment){t.push.apply(t,E0(i.props.children,c));return}i.type!==M_&&Yr(!1),!i.props.index||!i.props.children||Yr(!1);let d={id:i.props.id||c.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(d.children=E0(i.props.children,c)),t.push(d)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const LM="6";try{window.__reactRouterVersion=LM}catch{}const FM="startTransition",l1=FI[FM];function NM(n){let{basename:e,children:t,future:i,window:o}=n,c=ye.useRef();c.current==null&&(c.current=VI({window:o,v5Compat:!0}));let d=c.current,[a,v]=ye.useState({action:d.action,location:d.location}),{v7_startTransition:A}=i||{},E=ye.useCallback(k=>{A&&l1?l1(()=>v(k)):v(k)},[v,A]);return ye.useLayoutEffect(()=>d.listen(E),[d,E]),ye.useEffect(()=>kM(i),[i]),ye.createElement(DM,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:d,future:i})}var c1;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(c1||(c1={}));var u1;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(u1||(u1={}));const BM=()=>{const n=_M(),e=ye.useCallback(()=>{console.log("Stories button clicked"),n("/stories")},[n]),t=ye.useCallback(()=>{console.log("Simulator button clicked"),n("/simulator")},[n]),i=ye.useCallback(()=>{console.log("Games button clicked"),n("/games")},[n]);return{handleStoriesClick:e,handleSimulatorClick:t,handleGamesClick:i}},Lx=ye.createContext({});function Fx(n){const e=ye.useRef(null);return e.current===null&&(e.current=n()),e.current}const Nx=typeof window<"u",SA=Nx?ye.useLayoutEffect:ye.useEffect,Sy=ye.createContext(null);function Bx(n,e){n.indexOf(e)===-1&&n.push(e)}function zx(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const Eu=(n,e,t)=>t>e?e:t<n?n:t;let Ux=()=>{};const Pu={},AA=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function EA(n){return typeof n=="object"&&n!==null}const PA=n=>/^0[^.\s]+$/u.test(n);function jx(n){let e;return()=>(e===void 0&&(e=n()),e)}const Ma=n=>n,zM=(n,e)=>t=>e(n(t)),gg=(...n)=>n.reduce(zM),ng=(n,e,t)=>{const i=e-n;return i===0?1:(t-n)/i};class Vx{constructor(){this.subscriptions=[]}add(e){return Bx(this.subscriptions,e),()=>zx(this.subscriptions,e)}notify(e,t,i){const o=this.subscriptions.length;if(o)if(o===1)this.subscriptions[0](e,t,i);else for(let c=0;c<o;c++){const d=this.subscriptions[c];d&&d(e,t,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Ec=n=>n*1e3,Ca=n=>n/1e3;function CA(n,e){return e?n*(1e3/e):0}const IA=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,UM=1e-7,jM=12;function VM(n,e,t,i,o){let c,d,a=0;do d=e+(t-e)/2,c=IA(d,i,o)-n,c>0?t=d:e=d;while(Math.abs(c)>UM&&++a<jM);return d}function _g(n,e,t,i){if(n===e&&t===i)return Ma;const o=c=>VM(c,0,1,n,t);return c=>c===0||c===1?c:IA(o(c),e,i)}const MA=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,RA=n=>e=>1-n(1-e),kA=_g(.33,1.53,.69,.99),$x=RA(kA),DA=MA($x),OA=n=>(n*=2)<1?.5*$x(n):.5*(2-Math.pow(2,-10*(n-1))),Wx=n=>1-Math.sin(Math.acos(n)),LA=RA(Wx),FA=MA(Wx),$M=_g(.42,0,1,1),WM=_g(0,0,.58,1),NA=_g(.42,0,.58,1),HM=n=>Array.isArray(n)&&typeof n[0]!="number",BA=n=>Array.isArray(n)&&typeof n[0]=="number",ZM={linear:Ma,easeIn:$M,easeInOut:NA,easeOut:WM,circIn:Wx,circInOut:FA,circOut:LA,backIn:$x,backInOut:DA,backOut:kA,anticipate:OA},XM=n=>typeof n=="string",h1=n=>{if(BA(n)){Ux(n.length===4);const[e,t,i,o]=n;return _g(e,t,i,o)}else if(XM(n))return ZM[n];return n},o_=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function qM(n,e){let t=new Set,i=new Set,o=!1,c=!1;const d=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function v(E){d.has(E)&&(A.schedule(E),n()),E(a)}const A={schedule:(E,k=!1,L=!1)=>{const q=L&&o?t:i;return k&&d.add(E),q.has(E)||q.add(E),E},cancel:E=>{i.delete(E),d.delete(E)},process:E=>{if(a=E,o){c=!0;return}o=!0,[t,i]=[i,t],t.forEach(v),t.clear(),o=!1,c&&(c=!1,A.process(E))}};return A}const GM=40;function zA(n,e){let t=!1,i=!0;const o={delta:0,timestamp:0,isProcessing:!1},c=()=>t=!0,d=o_.reduce((se,Se)=>(se[Se]=qM(c),se),{}),{setup:a,read:v,resolveKeyframes:A,preUpdate:E,update:k,preRender:L,render:z,postRender:q}=d,Y=()=>{const se=Pu.useManualTiming?o.timestamp:performance.now();t=!1,Pu.useManualTiming||(o.delta=i?1e3/60:Math.max(Math.min(se-o.timestamp,GM),1)),o.timestamp=se,o.isProcessing=!0,a.process(o),v.process(o),A.process(o),E.process(o),k.process(o),L.process(o),z.process(o),q.process(o),o.isProcessing=!1,t&&e&&(i=!1,n(Y))},ne=()=>{t=!0,i=!0,o.isProcessing||n(Y)};return{schedule:o_.reduce((se,Se)=>{const Ne=d[Se];return se[Se]=(nt,dt=!1,gt=!1)=>(t||ne(),Ne.schedule(nt,dt,gt)),se},{}),cancel:se=>{for(let Se=0;Se<o_.length;Se++)d[o_[Se]].cancel(se)},state:o,steps:d}}const{schedule:Xi,cancel:Ph,state:Ss,steps:Av}=zA(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ma,!0);let R_;function YM(){R_=void 0}const Po={now:()=>(R_===void 0&&Po.set(Ss.isProcessing||Pu.useManualTiming?Ss.timestamp:performance.now()),R_),set:n=>{R_=n,queueMicrotask(YM)}},UA=n=>e=>typeof e=="string"&&e.startsWith(n),Hx=UA("--"),KM=UA("var(--"),Zx=n=>KM(n)?JM.test(n.split("/*")[0].trim()):!1,JM=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Op={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},ig={...Op,transform:n=>Eu(0,1,n)},a_={...Op,default:1},Vm=n=>Math.round(n*1e5)/1e5,Xx=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function QM(n){return n==null}const eR=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,qx=(n,e)=>t=>!!(typeof t=="string"&&eR.test(t)&&t.startsWith(n)||e&&!QM(t)&&Object.prototype.hasOwnProperty.call(t,e)),jA=(n,e,t)=>i=>{if(typeof i!="string")return i;const[o,c,d,a]=i.match(Xx);return{[n]:parseFloat(o),[e]:parseFloat(c),[t]:parseFloat(d),alpha:a!==void 0?parseFloat(a):1}},tR=n=>Eu(0,255,n),Ev={...Op,transform:n=>Math.round(tR(n))},Cd={test:qx("rgb","red"),parse:jA("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:i=1})=>"rgba("+Ev.transform(n)+", "+Ev.transform(e)+", "+Ev.transform(t)+", "+Vm(ig.transform(i))+")"};function nR(n){let e="",t="",i="",o="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),i=n.substring(5,7),o=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),i=n.substring(3,4),o=n.substring(4,5),e+=e,t+=t,i+=i,o+=o),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(i,16),alpha:o?parseInt(o,16)/255:1}}const P0={test:qx("#"),parse:nR,transform:Cd.transform},yg=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),mh=yg("deg"),Pc=yg("%"),Tn=yg("px"),iR=yg("vh"),rR=yg("vw"),d1={...Pc,parse:n=>Pc.parse(n)/100,transform:n=>Pc.transform(n*100)},np={test:qx("hsl","hue"),parse:jA("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:i=1})=>"hsla("+Math.round(n)+", "+Pc.transform(Vm(e))+", "+Pc.transform(Vm(t))+", "+Vm(ig.transform(i))+")"},Or={test:n=>Cd.test(n)||P0.test(n)||np.test(n),parse:n=>Cd.test(n)?Cd.parse(n):np.test(n)?np.parse(n):P0.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Cd.transform(n):np.transform(n),getAnimatableNone:n=>{const e=Or.parse(n);return e.alpha=0,Or.transform(e)}},sR=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function oR(n){return isNaN(n)&&typeof n=="string"&&(n.match(Xx)?.length||0)+(n.match(sR)?.length||0)>0}const VA="number",$A="color",aR="var",lR="var(",f1="${}",cR=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function rg(n){const e=n.toString(),t=[],i={color:[],number:[],var:[]},o=[];let c=0;const a=e.replace(cR,v=>(Or.test(v)?(i.color.push(c),o.push($A),t.push(Or.parse(v))):v.startsWith(lR)?(i.var.push(c),o.push(aR),t.push(v)):(i.number.push(c),o.push(VA),t.push(parseFloat(v))),++c,f1)).split(f1);return{values:t,split:a,indexes:i,types:o}}function WA(n){return rg(n).values}function HA(n){const{split:e,types:t}=rg(n),i=e.length;return o=>{let c="";for(let d=0;d<i;d++)if(c+=e[d],o[d]!==void 0){const a=t[d];a===VA?c+=Vm(o[d]):a===$A?c+=Or.transform(o[d]):c+=o[d]}return c}}const uR=n=>typeof n=="number"?0:Or.test(n)?Or.getAnimatableNone(n):n;function hR(n){const e=WA(n);return HA(n)(e.map(uR))}const Ch={test:oR,parse:WA,createTransformer:HA,getAnimatableNone:hR};function Pv(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function dR({hue:n,saturation:e,lightness:t,alpha:i}){n/=360,e/=100,t/=100;let o=0,c=0,d=0;if(!e)o=c=d=t;else{const a=t<.5?t*(1+e):t+e-t*e,v=2*t-a;o=Pv(v,a,n+1/3),c=Pv(v,a,n),d=Pv(v,a,n-1/3)}return{red:Math.round(o*255),green:Math.round(c*255),blue:Math.round(d*255),alpha:i}}function Z_(n,e){return t=>t>0?e:n}const er=(n,e,t)=>n+(e-n)*t,Cv=(n,e,t)=>{const i=n*n,o=t*(e*e-i)+i;return o<0?0:Math.sqrt(o)},fR=[P0,Cd,np],pR=n=>fR.find(e=>e.test(n));function p1(n){const e=pR(n);if(!e)return!1;let t=e.parse(n);return e===np&&(t=dR(t)),t}const m1=(n,e)=>{const t=p1(n),i=p1(e);if(!t||!i)return Z_(n,e);const o={...t};return c=>(o.red=Cv(t.red,i.red,c),o.green=Cv(t.green,i.green,c),o.blue=Cv(t.blue,i.blue,c),o.alpha=er(t.alpha,i.alpha,c),Cd.transform(o))},C0=new Set(["none","hidden"]);function mR(n,e){return C0.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function gR(n,e){return t=>er(n,e,t)}function Gx(n){return typeof n=="number"?gR:typeof n=="string"?Zx(n)?Z_:Or.test(n)?m1:vR:Array.isArray(n)?ZA:typeof n=="object"?Or.test(n)?m1:_R:Z_}function ZA(n,e){const t=[...n],i=t.length,o=n.map((c,d)=>Gx(c)(c,e[d]));return c=>{for(let d=0;d<i;d++)t[d]=o[d](c);return t}}function _R(n,e){const t={...n,...e},i={};for(const o in t)n[o]!==void 0&&e[o]!==void 0&&(i[o]=Gx(n[o])(n[o],e[o]));return o=>{for(const c in i)t[c]=i[c](o);return t}}function yR(n,e){const t=[],i={color:0,var:0,number:0};for(let o=0;o<e.values.length;o++){const c=e.types[o],d=n.indexes[c][i[c]],a=n.values[d]??0;t[o]=a,i[c]++}return t}const vR=(n,e)=>{const t=Ch.createTransformer(e),i=rg(n),o=rg(e);return i.indexes.var.length===o.indexes.var.length&&i.indexes.color.length===o.indexes.color.length&&i.indexes.number.length>=o.indexes.number.length?C0.has(n)&&!o.values.length||C0.has(e)&&!i.values.length?mR(n,e):gg(ZA(yR(i,o),o.values),t):Z_(n,e)};function XA(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?er(n,e,t):Gx(n)(n,e)}const xR=n=>{const e=({timestamp:t})=>n(t);return{start:(t=!0)=>Xi.update(e,t),stop:()=>Ph(e),now:()=>Ss.isProcessing?Ss.timestamp:Po.now()}},qA=(n,e,t=10)=>{let i="";const o=Math.max(Math.round(e/t),2);for(let c=0;c<o;c++)i+=Math.round(n(c/(o-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},X_=2e4;function Yx(n){let e=0;const t=50;let i=n.next(e);for(;!i.done&&e<X_;)e+=t,i=n.next(e);return e>=X_?1/0:e}function bR(n,e=100,t){const i=t({...n,keyframes:[0,e]}),o=Math.min(Yx(i),X_);return{type:"keyframes",ease:c=>i.next(o*c).value/e,duration:Ca(o)}}const wR=5;function GA(n,e,t){const i=Math.max(e-wR,0);return CA(t-n(i),e-i)}const ur={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Iv=.001;function TR({duration:n=ur.duration,bounce:e=ur.bounce,velocity:t=ur.velocity,mass:i=ur.mass}){let o,c,d=1-e;d=Eu(ur.minDamping,ur.maxDamping,d),n=Eu(ur.minDuration,ur.maxDuration,Ca(n)),d<1?(o=A=>{const E=A*d,k=E*n,L=E-t,z=I0(A,d),q=Math.exp(-k);return Iv-L/z*q},c=A=>{const k=A*d*n,L=k*t+t,z=Math.pow(d,2)*Math.pow(A,2)*n,q=Math.exp(-k),Y=I0(Math.pow(A,2),d);return(-o(A)+Iv>0?-1:1)*((L-z)*q)/Y}):(o=A=>{const E=Math.exp(-A*n),k=(A-t)*n+1;return-Iv+E*k},c=A=>{const E=Math.exp(-A*n),k=(t-A)*(n*n);return E*k});const a=5/n,v=AR(o,c,a);if(n=Ec(n),isNaN(v))return{stiffness:ur.stiffness,damping:ur.damping,duration:n};{const A=Math.pow(v,2)*i;return{stiffness:A,damping:d*2*Math.sqrt(i*A),duration:n}}}const SR=12;function AR(n,e,t){let i=t;for(let o=1;o<SR;o++)i=i-n(i)/e(i);return i}function I0(n,e){return n*Math.sqrt(1-e*e)}const ER=["duration","bounce"],PR=["stiffness","damping","mass"];function g1(n,e){return e.some(t=>n[t]!==void 0)}function CR(n){let e={velocity:ur.velocity,stiffness:ur.stiffness,damping:ur.damping,mass:ur.mass,isResolvedFromDuration:!1,...n};if(!g1(n,PR)&&g1(n,ER))if(n.visualDuration){const t=n.visualDuration,i=2*Math.PI/(t*1.2),o=i*i,c=2*Eu(.05,1,1-(n.bounce||0))*Math.sqrt(o);e={...e,mass:ur.mass,stiffness:o,damping:c}}else{const t=TR(n);e={...e,...t,mass:ur.mass},e.isResolvedFromDuration=!0}return e}function q_(n=ur.visualDuration,e=ur.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:i,restDelta:o}=t;const c=t.keyframes[0],d=t.keyframes[t.keyframes.length-1],a={done:!1,value:c},{stiffness:v,damping:A,mass:E,duration:k,velocity:L,isResolvedFromDuration:z}=CR({...t,velocity:-Ca(t.velocity||0)}),q=L||0,Y=A/(2*Math.sqrt(v*E)),ne=d-c,ue=Ca(Math.sqrt(v/E)),ve=Math.abs(ne)<5;i||(i=ve?ur.restSpeed.granular:ur.restSpeed.default),o||(o=ve?ur.restDelta.granular:ur.restDelta.default);let se;if(Y<1){const Ne=I0(ue,Y);se=nt=>{const dt=Math.exp(-Y*ue*nt);return d-dt*((q+Y*ue*ne)/Ne*Math.sin(Ne*nt)+ne*Math.cos(Ne*nt))}}else if(Y===1)se=Ne=>d-Math.exp(-ue*Ne)*(ne+(q+ue*ne)*Ne);else{const Ne=ue*Math.sqrt(Y*Y-1);se=nt=>{const dt=Math.exp(-Y*ue*nt),gt=Math.min(Ne*nt,300);return d-dt*((q+Y*ue*ne)*Math.sinh(gt)+Ne*ne*Math.cosh(gt))/Ne}}const Se={calculatedDuration:z&&k||null,next:Ne=>{const nt=se(Ne);if(z)a.done=Ne>=k;else{let dt=Ne===0?q:0;Y<1&&(dt=Ne===0?Ec(q):GA(se,Ne,nt));const gt=Math.abs(dt)<=i,vt=Math.abs(d-nt)<=o;a.done=gt&&vt}return a.value=a.done?d:nt,a},toString:()=>{const Ne=Math.min(Yx(Se),X_),nt=qA(dt=>Se.next(Ne*dt).value,Ne,30);return Ne+"ms "+nt},toTransition:()=>{}};return Se}q_.applyToOptions=n=>{const e=bR(n,100,q_);return n.ease=e.ease,n.duration=Ec(e.duration),n.type="keyframes",n};function M0({keyframes:n,velocity:e=0,power:t=.8,timeConstant:i=325,bounceDamping:o=10,bounceStiffness:c=500,modifyTarget:d,min:a,max:v,restDelta:A=.5,restSpeed:E}){const k=n[0],L={done:!1,value:k},z=gt=>a!==void 0&&gt<a||v!==void 0&&gt>v,q=gt=>a===void 0?v:v===void 0||Math.abs(a-gt)<Math.abs(v-gt)?a:v;let Y=t*e;const ne=k+Y,ue=d===void 0?ne:d(ne);ue!==ne&&(Y=ue-k);const ve=gt=>-Y*Math.exp(-gt/i),se=gt=>ue+ve(gt),Se=gt=>{const vt=ve(gt),Ft=se(gt);L.done=Math.abs(vt)<=A,L.value=L.done?ue:Ft};let Ne,nt;const dt=gt=>{z(L.value)&&(Ne=gt,nt=q_({keyframes:[L.value,q(L.value)],velocity:GA(se,gt,L.value),damping:o,stiffness:c,restDelta:A,restSpeed:E}))};return dt(0),{calculatedDuration:null,next:gt=>{let vt=!1;return!nt&&Ne===void 0&&(vt=!0,Se(gt),dt(gt)),Ne!==void 0&&gt>=Ne?nt.next(gt-Ne):(!vt&&Se(gt),L)}}}function IR(n,e,t){const i=[],o=t||Pu.mix||XA,c=n.length-1;for(let d=0;d<c;d++){let a=o(n[d],n[d+1]);if(e){const v=Array.isArray(e)?e[d]||Ma:e;a=gg(v,a)}i.push(a)}return i}function MR(n,e,{clamp:t=!0,ease:i,mixer:o}={}){const c=n.length;if(Ux(c===e.length),c===1)return()=>e[0];if(c===2&&e[0]===e[1])return()=>e[1];const d=n[0]===n[1];n[0]>n[c-1]&&(n=[...n].reverse(),e=[...e].reverse());const a=IR(e,i,o),v=a.length,A=E=>{if(d&&E<n[0])return e[0];let k=0;if(v>1)for(;k<n.length-2&&!(E<n[k+1]);k++);const L=ng(n[k],n[k+1],E);return a[k](L)};return t?E=>A(Eu(n[0],n[c-1],E)):A}function RR(n,e){const t=n[n.length-1];for(let i=1;i<=e;i++){const o=ng(0,e,i);n.push(er(t,1,o))}}function kR(n){const e=[0];return RR(e,n.length-1),e}function DR(n,e){return n.map(t=>t*e)}function OR(n,e){return n.map(()=>e||NA).splice(0,n.length-1)}function $m({duration:n=300,keyframes:e,times:t,ease:i="easeInOut"}){const o=HM(i)?i.map(h1):h1(i),c={done:!1,value:e[0]},d=DR(t&&t.length===e.length?t:kR(e),n),a=MR(d,e,{ease:Array.isArray(o)?o:OR(e,o)});return{calculatedDuration:n,next:v=>(c.value=a(v),c.done=v>=n,c)}}const LR=n=>n!==null;function Kx(n,{repeat:e,repeatType:t="loop"},i,o=1){const c=n.filter(LR),a=o<0||e&&t!=="loop"&&e%2===1?0:c.length-1;return!a||i===void 0?c[a]:i}const FR={decay:M0,inertia:M0,tween:$m,keyframes:$m,spring:q_};function YA(n){typeof n.type=="string"&&(n.type=FR[n.type])}class Jx{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const NR=n=>n/100;class Qx extends Jx{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==Po.now()&&this.tick(Po.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;YA(e);const{type:t=$m,repeat:i=0,repeatDelay:o=0,repeatType:c,velocity:d=0}=e;let{keyframes:a}=e;const v=t||$m;v!==$m&&typeof a[0]!="number"&&(this.mixKeyframes=gg(NR,XA(a[0],a[1])),a=[0,100]);const A=v({...e,keyframes:a});c==="mirror"&&(this.mirroredGenerator=v({...e,keyframes:[...a].reverse(),velocity:-d})),A.calculatedDuration===null&&(A.calculatedDuration=Yx(A));const{calculatedDuration:E}=A;this.calculatedDuration=E,this.resolvedDuration=E+o,this.totalDuration=this.resolvedDuration*(i+1)-o,this.generator=A}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:i,totalDuration:o,mixKeyframes:c,mirroredGenerator:d,resolvedDuration:a,calculatedDuration:v}=this;if(this.startTime===null)return i.next(0);const{delay:A=0,keyframes:E,repeat:k,repeatType:L,repeatDelay:z,type:q,onUpdate:Y,finalKeyframe:ne}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-o/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const ue=this.currentTime-A*(this.playbackSpeed>=0?1:-1),ve=this.playbackSpeed>=0?ue<0:ue>o;this.currentTime=Math.max(ue,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=o);let se=this.currentTime,Se=i;if(k){const gt=Math.min(this.currentTime,o)/a;let vt=Math.floor(gt),Ft=gt%1;!Ft&&gt>=1&&(Ft=1),Ft===1&&vt--,vt=Math.min(vt,k+1),!!(vt%2)&&(L==="reverse"?(Ft=1-Ft,z&&(Ft-=z/a)):L==="mirror"&&(Se=d)),se=Eu(0,1,Ft)*a}const Ne=ve?{done:!1,value:E[0]}:Se.next(se);c&&(Ne.value=c(Ne.value));let{done:nt}=Ne;!ve&&v!==null&&(nt=this.playbackSpeed>=0?this.currentTime>=o:this.currentTime<=0);const dt=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&nt);return dt&&q!==M0&&(Ne.value=Kx(E,this.options,ne,this.speed)),Y&&Y(Ne.value),dt&&this.finish(),Ne}then(e,t){return this.finished.then(e,t)}get duration(){return Ca(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ca(e)}get time(){return Ca(this.currentTime)}set time(e){e=Ec(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Po.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Ca(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=xR,startTime:t}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),this.options.onPlay?.();const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=t??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Po.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function BR(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const Id=n=>n*180/Math.PI,R0=n=>{const e=Id(Math.atan2(n[1],n[0]));return k0(e)},zR={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:R0,rotateZ:R0,skewX:n=>Id(Math.atan(n[1])),skewY:n=>Id(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},k0=n=>(n=n%360,n<0&&(n+=360),n),_1=R0,y1=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),v1=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),UR={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:y1,scaleY:v1,scale:n=>(y1(n)+v1(n))/2,rotateX:n=>k0(Id(Math.atan2(n[6],n[5]))),rotateY:n=>k0(Id(Math.atan2(-n[2],n[0]))),rotateZ:_1,rotate:_1,skewX:n=>Id(Math.atan(n[4])),skewY:n=>Id(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function D0(n){return n.includes("scale")?1:0}function O0(n,e){if(!n||n==="none")return D0(e);const t=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,o;if(t)i=UR,o=t;else{const a=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=zR,o=a}if(!o)return D0(e);const c=i[e],d=o[1].split(",").map(VR);return typeof c=="function"?c(d):d[c]}const jR=(n,e)=>{const{transform:t="none"}=getComputedStyle(n);return O0(t,e)};function VR(n){return parseFloat(n.trim())}const Lp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Fp=new Set(Lp),x1=n=>n===Op||n===Tn,$R=new Set(["x","y","z"]),WR=Lp.filter(n=>!$R.has(n));function HR(n){const e=[];return WR.forEach(t=>{const i=n.getValue(t);i!==void 0&&(e.push([t,i.get()]),i.set(t.startsWith("scale")?1:0))}),e}const Ld={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>O0(e,"x"),y:(n,{transform:e})=>O0(e,"y")};Ld.translateX=Ld.x;Ld.translateY=Ld.y;const Fd=new Set;let L0=!1,F0=!1,N0=!1;function KA(){if(F0){const n=Array.from(Fd).filter(i=>i.needsMeasurement),e=new Set(n.map(i=>i.element)),t=new Map;e.forEach(i=>{const o=HR(i);o.length&&(t.set(i,o),i.render())}),n.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const o=t.get(i);o&&o.forEach(([c,d])=>{i.getValue(c)?.set(d)})}),n.forEach(i=>i.measureEndState()),n.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}F0=!1,L0=!1,Fd.forEach(n=>n.complete(N0)),Fd.clear()}function JA(){Fd.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(F0=!0)})}function ZR(){N0=!0,JA(),KA(),N0=!1}class eb{constructor(e,t,i,o,c,d=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=i,this.motionValue=o,this.element=c,this.isAsync=d}scheduleResolve(){this.state="scheduled",this.isAsync?(Fd.add(this),L0||(L0=!0,Xi.read(JA),Xi.resolveKeyframes(KA))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:i,motionValue:o}=this;if(e[0]===null){const c=o?.get(),d=e[e.length-1];if(c!==void 0)e[0]=c;else if(i&&t){const a=i.readValue(t,d);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=d),o&&c===void 0&&o.set(e[0])}BR(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Fd.delete(this)}cancel(){this.state==="scheduled"&&(Fd.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const XR=n=>n.startsWith("--");function qR(n,e,t){XR(e)?n.style.setProperty(e,t):n.style[e]=t}const GR=jx(()=>window.ScrollTimeline!==void 0),YR={};function KR(n,e){const t=jx(n);return()=>YR[e]??t()}const QA=KR(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Lm=([n,e,t,i])=>`cubic-bezier(${n}, ${e}, ${t}, ${i})`,b1={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Lm([0,.65,.55,1]),circOut:Lm([.55,0,1,.45]),backIn:Lm([.31,.01,.66,-.59]),backOut:Lm([.33,1.53,.69,.99])};function eE(n,e){if(n)return typeof n=="function"?QA()?qA(n,e):"ease-out":BA(n)?Lm(n):Array.isArray(n)?n.map(t=>eE(t,e)||b1.easeOut):b1[n]}function JR(n,e,t,{delay:i=0,duration:o=300,repeat:c=0,repeatType:d="loop",ease:a="easeOut",times:v}={},A=void 0){const E={[e]:t};v&&(E.offset=v);const k=eE(a,o);Array.isArray(k)&&(E.easing=k);const L={delay:i,duration:o,easing:Array.isArray(k)?"linear":k,fill:"both",iterations:c+1,direction:d==="reverse"?"alternate":"normal"};return A&&(L.pseudoElement=A),n.animate(E,L)}function tE(n){return typeof n=="function"&&"applyToOptions"in n}function QR({type:n,...e}){return tE(n)&&QA()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class ek extends Jx{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:i,keyframes:o,pseudoElement:c,allowFlatten:d=!1,finalKeyframe:a,onComplete:v}=e;this.isPseudoElement=!!c,this.allowFlatten=d,this.options=e,Ux(typeof e.type!="string");const A=QR(e);this.animation=JR(t,i,o,A,c),A.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!c){const E=Kx(o,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(E):qR(t,i,E),this.animation.cancel()}v?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return Ca(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ca(e)}get time(){return Ca(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Ec(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&GR()?(this.animation.timeline=e,Ma):t(this)}}const nE={anticipate:OA,backInOut:DA,circInOut:FA};function tk(n){return n in nE}function nk(n){typeof n.ease=="string"&&tk(n.ease)&&(n.ease=nE[n.ease])}const w1=10;class ik extends ek{constructor(e){nk(e),YA(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:i,onComplete:o,element:c,...d}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const a=new Qx({...d,autoplay:!1}),v=Ec(this.finishedTime??this.time);t.setWithVelocity(a.sample(v-w1).value,a.sample(v).value,w1),a.stop()}}const T1=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Ch.test(n)||n==="0")&&!n.startsWith("url("));function rk(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function sk(n,e,t,i){const o=n[0];if(o===null)return!1;if(e==="display"||e==="visibility")return!0;const c=n[n.length-1],d=T1(o,e),a=T1(c,e);return!d||!a?!1:rk(n)||(t==="spring"||tE(t))&&i}function B0(n){n.duration=0,n.type="keyframes"}const ok=new Set(["opacity","clipPath","filter","transform"]),ak=jx(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function lk(n){const{motionValue:e,name:t,repeatDelay:i,repeatType:o,damping:c,type:d}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:A}=e.owner.getProps();return ak()&&t&&ok.has(t)&&(t!=="transform"||!A)&&!v&&!i&&o!=="mirror"&&c!==0&&d!=="inertia"}const ck=40;class uk extends Jx{constructor({autoplay:e=!0,delay:t=0,type:i="keyframes",repeat:o=0,repeatDelay:c=0,repeatType:d="loop",keyframes:a,name:v,motionValue:A,element:E,...k}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Po.now();const L={autoplay:e,delay:t,type:i,repeat:o,repeatDelay:c,repeatType:d,name:v,motionValue:A,element:E,...k},z=E?.KeyframeResolver||eb;this.keyframeResolver=new z(a,(q,Y,ne)=>this.onKeyframesResolved(q,Y,L,!ne),v,A,E),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,i,o){this.keyframeResolver=void 0;const{name:c,type:d,velocity:a,delay:v,isHandoff:A,onUpdate:E}=i;this.resolvedAt=Po.now(),sk(e,c,d,a)||((Pu.instantAnimations||!v)&&E?.(Kx(e,i,t)),e[0]=e[e.length-1],B0(i),i.repeat=0);const L={startTime:o?this.resolvedAt?this.resolvedAt-this.createdAt>ck?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...i,keyframes:e},z=!A&&lk(L)?new ik({...L,element:L.motionValue.owner.current}):new Qx(L);z.finished.then(()=>this.notifyFinished()).catch(Ma),this.pendingTimeline&&(this.stopTimeline=z.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=z}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),ZR()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const hk=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function dk(n){const e=hk.exec(n);if(!e)return[,];const[,t,i,o]=e;return[`--${t??i}`,o]}function iE(n,e,t=1){const[i,o]=dk(n);if(!i)return;const c=window.getComputedStyle(e).getPropertyValue(i);if(c){const d=c.trim();return AA(d)?parseFloat(d):d}return Zx(o)?iE(o,e,t+1):o}function tb(n,e){return n?.[e]??n?.default??n}const rE=new Set(["width","height","top","left","right","bottom",...Lp]),fk={test:n=>n==="auto",parse:n=>n},sE=n=>e=>e.test(n),oE=[Op,Tn,Pc,mh,rR,iR,fk],S1=n=>oE.find(sE(n));function pk(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||PA(n):!0}const mk=new Set(["brightness","contrast","saturate","opacity"]);function gk(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[i]=t.match(Xx)||[];if(!i)return n;const o=t.replace(i,"");let c=mk.has(e)?1:0;return i!==t&&(c*=100),e+"("+c+o+")"}const _k=/\b([a-z-]*)\(.*?\)/gu,z0={...Ch,getAnimatableNone:n=>{const e=n.match(_k);return e?e.map(gk).join(" "):n}},A1={...Op,transform:Math.round},yk={rotate:mh,rotateX:mh,rotateY:mh,rotateZ:mh,scale:a_,scaleX:a_,scaleY:a_,scaleZ:a_,skew:mh,skewX:mh,skewY:mh,distance:Tn,translateX:Tn,translateY:Tn,translateZ:Tn,x:Tn,y:Tn,z:Tn,perspective:Tn,transformPerspective:Tn,opacity:ig,originX:d1,originY:d1,originZ:Tn},nb={borderWidth:Tn,borderTopWidth:Tn,borderRightWidth:Tn,borderBottomWidth:Tn,borderLeftWidth:Tn,borderRadius:Tn,radius:Tn,borderTopLeftRadius:Tn,borderTopRightRadius:Tn,borderBottomRightRadius:Tn,borderBottomLeftRadius:Tn,width:Tn,maxWidth:Tn,height:Tn,maxHeight:Tn,top:Tn,right:Tn,bottom:Tn,left:Tn,padding:Tn,paddingTop:Tn,paddingRight:Tn,paddingBottom:Tn,paddingLeft:Tn,margin:Tn,marginTop:Tn,marginRight:Tn,marginBottom:Tn,marginLeft:Tn,backgroundPositionX:Tn,backgroundPositionY:Tn,...yk,zIndex:A1,fillOpacity:ig,strokeOpacity:ig,numOctaves:A1},vk={...nb,color:Or,backgroundColor:Or,outlineColor:Or,fill:Or,stroke:Or,borderColor:Or,borderTopColor:Or,borderRightColor:Or,borderBottomColor:Or,borderLeftColor:Or,filter:z0,WebkitFilter:z0},aE=n=>vk[n];function lE(n,e){let t=aE(n);return t!==z0&&(t=Ch),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const xk=new Set(["auto","none","0"]);function bk(n,e,t){let i=0,o;for(;i<n.length&&!o;){const c=n[i];typeof c=="string"&&!xk.has(c)&&rg(c).values.length&&(o=n[i]),i++}if(o&&t)for(const c of e)n[c]=lE(t,o)}class wk extends eb{constructor(e,t,i,o,c){super(e,t,i,o,c,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:i}=this;if(!t||!t.current)return;super.readKeyframes();for(let v=0;v<e.length;v++){let A=e[v];if(typeof A=="string"&&(A=A.trim(),Zx(A))){const E=iE(A,t.current);E!==void 0&&(e[v]=E),v===e.length-1&&(this.finalKeyframe=A)}}if(this.resolveNoneKeyframes(),!rE.has(i)||e.length!==2)return;const[o,c]=e,d=S1(o),a=S1(c);if(d!==a)if(x1(d)&&x1(a))for(let v=0;v<e.length;v++){const A=e[v];typeof A=="string"&&(e[v]=parseFloat(A))}else Ld[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,i=[];for(let o=0;o<e.length;o++)(e[o]===null||pk(e[o]))&&i.push(o);i.length&&bk(e,i,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ld[i](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const o=t[t.length-1];o!==void 0&&e.getValue(i,o).jump(o,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:i}=this;if(!e||!e.current)return;const o=e.getValue(t);o&&o.jump(this.measuredOrigin,!1);const c=i.length-1,d=i[c];i[c]=Ld[t](e.measureViewportBox(),window.getComputedStyle(e.current)),d!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=d),this.removedTransforms?.length&&this.removedTransforms.forEach(([a,v])=>{e.getValue(a).set(v)}),this.resolveNoneKeyframes()}}function Tk(n,e,t){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let i=document;const o=t?.[n]??i.querySelectorAll(n);return o?Array.from(o):[]}return Array.from(n)}const cE=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function uE(n){return EA(n)&&"offsetHeight"in n}const E1=30,Sk=n=>!isNaN(parseFloat(n));class Ak{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{const o=Po.now();if(this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const c of this.dependents)c.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Po.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=Sk(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Vx);const i=this.events[e].add(t);return e==="change"?()=>{i(),Xi.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,i){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Po.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>E1)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,E1);return CA(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function yp(n,e){return new Ak(n,e)}const{schedule:ib}=zA(queueMicrotask,!1),Sl={x:!1,y:!1};function hE(){return Sl.x||Sl.y}function Ek(n){return n==="x"||n==="y"?Sl[n]?null:(Sl[n]=!0,()=>{Sl[n]=!1}):Sl.x||Sl.y?null:(Sl.x=Sl.y=!0,()=>{Sl.x=Sl.y=!1})}function dE(n,e){const t=Tk(n),i=new AbortController,o={passive:!0,...e,signal:i.signal};return[t,o,()=>i.abort()]}function P1(n){return!(n.pointerType==="touch"||hE())}function Pk(n,e,t={}){const[i,o,c]=dE(n,t),d=a=>{if(!P1(a))return;const{target:v}=a,A=e(v,a);if(typeof A!="function"||!v)return;const E=k=>{P1(k)&&(A(k),v.removeEventListener("pointerleave",E))};v.addEventListener("pointerleave",E,o)};return i.forEach(a=>{a.addEventListener("pointerenter",d,o)}),c}const fE=(n,e)=>e?n===e?!0:fE(n,e.parentElement):!1,rb=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,Ck=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Ik(n){return Ck.has(n.tagName)||n.tabIndex!==-1}const k_=new WeakSet;function C1(n){return e=>{e.key==="Enter"&&n(e)}}function Mv(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const Mk=(n,e)=>{const t=n.currentTarget;if(!t)return;const i=C1(()=>{if(k_.has(t))return;Mv(t,"down");const o=C1(()=>{Mv(t,"up")}),c=()=>Mv(t,"cancel");t.addEventListener("keyup",o,e),t.addEventListener("blur",c,e)});t.addEventListener("keydown",i,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",i),e)};function I1(n){return rb(n)&&!hE()}function Rk(n,e,t={}){const[i,o,c]=dE(n,t),d=a=>{const v=a.currentTarget;if(!I1(a))return;k_.add(v);const A=e(v,a),E=(z,q)=>{window.removeEventListener("pointerup",k),window.removeEventListener("pointercancel",L),k_.has(v)&&k_.delete(v),I1(z)&&typeof A=="function"&&A(z,{success:q})},k=z=>{E(z,v===window||v===document||t.useGlobalTarget||fE(v,z.target))},L=z=>{E(z,!1)};window.addEventListener("pointerup",k,o),window.addEventListener("pointercancel",L,o)};return i.forEach(a=>{(t.useGlobalTarget?window:a).addEventListener("pointerdown",d,o),uE(a)&&(a.addEventListener("focus",A=>Mk(A,o)),!Ik(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),c}function pE(n){return EA(n)&&"ownerSVGElement"in n}function kk(n){return pE(n)&&n.tagName==="svg"}const Hs=n=>!!(n&&n.getVelocity),Dk=[...oE,Or,Ch],Ok=n=>Dk.find(sE(n)),sb=ye.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function M1(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function Lk(...n){return e=>{let t=!1;const i=n.map(o=>{const c=M1(o,e);return!t&&typeof c=="function"&&(t=!0),c});if(t)return()=>{for(let o=0;o<i.length;o++){const c=i[o];typeof c=="function"?c():M1(n[o],null)}}}}function Fk(...n){return ye.useCallback(Lk(...n),n)}class Nk extends ye.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const i=t.offsetParent,o=uE(i)&&i.offsetWidth||0,c=this.props.sizeRef.current;c.height=t.offsetHeight||0,c.width=t.offsetWidth||0,c.top=t.offsetTop,c.left=t.offsetLeft,c.right=o-c.width-c.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Bk({children:n,isPresent:e,anchorX:t,root:i}){const o=ye.useId(),c=ye.useRef(null),d=ye.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=ye.useContext(sb),v=Fk(c,n?.ref);return ye.useInsertionEffect(()=>{const{width:A,height:E,top:k,left:L,right:z}=d.current;if(e||!c.current||!A||!E)return;const q=t==="left"?`left: ${L}`:`right: ${z}`;c.current.dataset.motionPopId=o;const Y=document.createElement("style");a&&(Y.nonce=a);const ne=i??document.head;return ne.appendChild(Y),Y.sheet&&Y.sheet.insertRule(`
          [data-motion-pop-id="${o}"] {
            position: absolute !important;
            width: ${A}px !important;
            height: ${E}px !important;
            ${q}px !important;
            top: ${k}px !important;
          }
        `),()=>{ne.contains(Y)&&ne.removeChild(Y)}},[e]),he.jsx(Nk,{isPresent:e,childRef:c,sizeRef:d,children:ye.cloneElement(n,{ref:v})})}const zk=({children:n,initial:e,isPresent:t,onExitComplete:i,custom:o,presenceAffectsLayout:c,mode:d,anchorX:a,root:v})=>{const A=Fx(Uk),E=ye.useId();let k=!0,L=ye.useMemo(()=>(k=!1,{id:E,initial:e,isPresent:t,custom:o,onExitComplete:z=>{A.set(z,!0);for(const q of A.values())if(!q)return;i&&i()},register:z=>(A.set(z,!1),()=>A.delete(z))}),[t,A,i]);return c&&k&&(L={...L}),ye.useMemo(()=>{A.forEach((z,q)=>A.set(q,!1))},[t]),ye.useEffect(()=>{!t&&!A.size&&i&&i()},[t]),d==="popLayout"&&(n=he.jsx(Bk,{isPresent:t,anchorX:a,root:v,children:n})),he.jsx(Sy.Provider,{value:L,children:n})};function Uk(){return new Map}function mE(n=!0){const e=ye.useContext(Sy);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:i,register:o}=e,c=ye.useId();ye.useEffect(()=>{if(n)return o(c)},[n]);const d=ye.useCallback(()=>n&&i&&i(c),[c,i,n]);return!t&&i?[!1,d]:[!0]}const l_=n=>n.key||"";function R1(n){const e=[];return ye.Children.forEach(n,t=>{ye.isValidElement(t)&&e.push(t)}),e}const Ay=({children:n,custom:e,initial:t=!0,onExitComplete:i,presenceAffectsLayout:o=!0,mode:c="sync",propagate:d=!1,anchorX:a="left",root:v})=>{const[A,E]=mE(d),k=ye.useMemo(()=>R1(n),[n]),L=d&&!A?[]:k.map(l_),z=ye.useRef(!0),q=ye.useRef(k),Y=Fx(()=>new Map),[ne,ue]=ye.useState(k),[ve,se]=ye.useState(k);SA(()=>{z.current=!1,q.current=k;for(let nt=0;nt<ve.length;nt++){const dt=l_(ve[nt]);L.includes(dt)?Y.delete(dt):Y.get(dt)!==!0&&Y.set(dt,!1)}},[ve,L.length,L.join("-")]);const Se=[];if(k!==ne){let nt=[...k];for(let dt=0;dt<ve.length;dt++){const gt=ve[dt],vt=l_(gt);L.includes(vt)||(nt.splice(dt,0,gt),Se.push(gt))}return c==="wait"&&Se.length&&(nt=Se),se(R1(nt)),ue(k),null}const{forceRender:Ne}=ye.useContext(Lx);return he.jsx(he.Fragment,{children:ve.map(nt=>{const dt=l_(nt),gt=d&&!A?!1:k===ve||L.includes(dt),vt=()=>{if(Y.has(dt))Y.set(dt,!0);else return;let Ft=!0;Y.forEach(Wt=>{Wt||(Ft=!1)}),Ft&&(Ne?.(),se(q.current),d&&E?.(),i&&i())};return he.jsx(zk,{isPresent:gt,initial:!z.current||t?void 0:!1,custom:e,presenceAffectsLayout:o,mode:c,root:v,onExitComplete:gt?void 0:vt,anchorX:a,children:nt},dt)})})},gE=ye.createContext({strict:!1}),k1={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},vp={};for(const n in k1)vp[n]={isEnabled:e=>k1[n].some(t=>!!e[t])};function jk(n){for(const e in n)vp[e]={...vp[e],...n[e]}}const Vk=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function G_(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||Vk.has(n)}let _E=n=>!G_(n);function $k(n){typeof n=="function"&&(_E=e=>e.startsWith("on")?!G_(e):n(e))}try{$k(require("@emotion/is-prop-valid").default)}catch{}function Wk(n,e,t){const i={};for(const o in n)o==="values"&&typeof n.values=="object"||(_E(o)||t===!0&&G_(o)||!e&&!G_(o)||n.draggable&&o.startsWith("onDrag"))&&(i[o]=n[o]);return i}const Ey=ye.createContext({});function Py(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function sg(n){return typeof n=="string"||Array.isArray(n)}const ob=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ab=["initial",...ob];function Cy(n){return Py(n.animate)||ab.some(e=>sg(n[e]))}function yE(n){return!!(Cy(n)||n.variants)}function Hk(n,e){if(Cy(n)){const{initial:t,animate:i}=n;return{initial:t===!1||sg(t)?t:void 0,animate:sg(i)?i:void 0}}return n.inherit!==!1?e:{}}function Zk(n){const{initial:e,animate:t}=Hk(n,ye.useContext(Ey));return ye.useMemo(()=>({initial:e,animate:t}),[D1(e),D1(t)])}function D1(n){return Array.isArray(n)?n.join(" "):n}const og={};function Xk(n){for(const e in n)og[e]=n[e],Hx(e)&&(og[e].isCSSVariable=!0)}function vE(n,{layout:e,layoutId:t}){return Fp.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!og[n]||n==="opacity")}const qk={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Gk=Lp.length;function Yk(n,e,t){let i="",o=!0;for(let c=0;c<Gk;c++){const d=Lp[c],a=n[d];if(a===void 0)continue;let v=!0;if(typeof a=="number"?v=a===(d.startsWith("scale")?1:0):v=parseFloat(a)===0,!v||t){const A=cE(a,nb[d]);if(!v){o=!1;const E=qk[d]||d;i+=`${E}(${A}) `}t&&(e[d]=A)}}return i=i.trim(),t?i=t(e,o?"":i):o&&(i="none"),i}function lb(n,e,t){const{style:i,vars:o,transformOrigin:c}=n;let d=!1,a=!1;for(const v in e){const A=e[v];if(Fp.has(v)){d=!0;continue}else if(Hx(v)){o[v]=A;continue}else{const E=cE(A,nb[v]);v.startsWith("origin")?(a=!0,c[v]=E):i[v]=E}}if(e.transform||(d||t?i.transform=Yk(e,n.transform,t):i.transform&&(i.transform="none")),a){const{originX:v="50%",originY:A="50%",originZ:E=0}=c;i.transformOrigin=`${v} ${A} ${E}`}}const cb=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function xE(n,e,t){for(const i in e)!Hs(e[i])&&!vE(i,t)&&(n[i]=e[i])}function Kk({transformTemplate:n},e){return ye.useMemo(()=>{const t=cb();return lb(t,e,n),Object.assign({},t.vars,t.style)},[e])}function Jk(n,e){const t=n.style||{},i={};return xE(i,t,n),Object.assign(i,Kk(n,e)),i}function Qk(n,e){const t={},i=Jk(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=i,t}const eD={offset:"stroke-dashoffset",array:"stroke-dasharray"},tD={offset:"strokeDashoffset",array:"strokeDasharray"};function nD(n,e,t=1,i=0,o=!0){n.pathLength=1;const c=o?eD:tD;n[c.offset]=Tn.transform(-i);const d=Tn.transform(e),a=Tn.transform(t);n[c.array]=`${d} ${a}`}function bE(n,{attrX:e,attrY:t,attrScale:i,pathLength:o,pathSpacing:c=1,pathOffset:d=0,...a},v,A,E){if(lb(n,a,A),v){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:k,style:L}=n;k.transform&&(L.transform=k.transform,delete k.transform),(L.transform||k.transformOrigin)&&(L.transformOrigin=k.transformOrigin??"50% 50%",delete k.transformOrigin),L.transform&&(L.transformBox=E?.transformBox??"fill-box",delete k.transformBox),e!==void 0&&(k.x=e),t!==void 0&&(k.y=t),i!==void 0&&(k.scale=i),o!==void 0&&nD(k,o,c,d,!1)}const wE=()=>({...cb(),attrs:{}}),TE=n=>typeof n=="string"&&n.toLowerCase()==="svg";function iD(n,e,t,i){const o=ye.useMemo(()=>{const c=wE();return bE(c,e,TE(i),n.transformTemplate,n.style),{...c.attrs,style:{...c.style}}},[e]);if(n.style){const c={};xE(c,n.style,n),o.style={...c,...o.style}}return o}const rD=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ub(n){return typeof n!="string"||n.includes("-")?!1:!!(rD.indexOf(n)>-1||/[A-Z]/u.test(n))}function sD(n,e,t,{latestValues:i},o,c=!1){const a=(ub(n)?iD:Qk)(e,i,o,n),v=Wk(e,typeof n=="string",c),A=n!==ye.Fragment?{...v,...a,ref:t}:{},{children:E}=e,k=ye.useMemo(()=>Hs(E)?E.get():E,[E]);return ye.createElement(n,{...A,children:k})}function O1(n){const e=[{},{}];return n?.values.forEach((t,i)=>{e[0][i]=t.get(),e[1][i]=t.getVelocity()}),e}function hb(n,e,t,i){if(typeof e=="function"){const[o,c]=O1(i);e=e(t!==void 0?t:n.custom,o,c)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[o,c]=O1(i);e=e(t!==void 0?t:n.custom,o,c)}return e}function D_(n){return Hs(n)?n.get():n}function oD({scrapeMotionValuesFromProps:n,createRenderState:e},t,i,o){return{latestValues:aD(t,i,o,n),renderState:e()}}function aD(n,e,t,i){const o={},c=i(n,{});for(const L in c)o[L]=D_(c[L]);let{initial:d,animate:a}=n;const v=Cy(n),A=yE(n);e&&A&&!v&&n.inherit!==!1&&(d===void 0&&(d=e.initial),a===void 0&&(a=e.animate));let E=t?t.initial===!1:!1;E=E||d===!1;const k=E?a:d;if(k&&typeof k!="boolean"&&!Py(k)){const L=Array.isArray(k)?k:[k];for(let z=0;z<L.length;z++){const q=hb(n,L[z]);if(q){const{transitionEnd:Y,transition:ne,...ue}=q;for(const ve in ue){let se=ue[ve];if(Array.isArray(se)){const Se=E?se.length-1:0;se=se[Se]}se!==null&&(o[ve]=se)}for(const ve in Y)o[ve]=Y[ve]}}}return o}const SE=n=>(e,t)=>{const i=ye.useContext(Ey),o=ye.useContext(Sy),c=()=>oD(n,e,i,o);return t?c():Fx(c)};function db(n,e,t){const{style:i}=n,o={};for(const c in i)(Hs(i[c])||e.style&&Hs(e.style[c])||vE(c,n)||t?.getValue(c)?.liveStyle!==void 0)&&(o[c]=i[c]);return o}const lD=SE({scrapeMotionValuesFromProps:db,createRenderState:cb});function AE(n,e,t){const i=db(n,e,t);for(const o in n)if(Hs(n[o])||Hs(e[o])){const c=Lp.indexOf(o)!==-1?"attr"+o.charAt(0).toUpperCase()+o.substring(1):o;i[c]=n[o]}return i}const cD=SE({scrapeMotionValuesFromProps:AE,createRenderState:wE}),uD=Symbol.for("motionComponentSymbol");function ip(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function hD(n,e,t){return ye.useCallback(i=>{i&&n.onMount&&n.onMount(i),e&&(i?e.mount(i):e.unmount()),t&&(typeof t=="function"?t(i):ip(t)&&(t.current=i))},[e])}const fb=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),dD="framerAppearId",EE="data-"+fb(dD),PE=ye.createContext({});function fD(n,e,t,i,o){const{visualElement:c}=ye.useContext(Ey),d=ye.useContext(gE),a=ye.useContext(Sy),v=ye.useContext(sb).reducedMotion,A=ye.useRef(null);i=i||d.renderer,!A.current&&i&&(A.current=i(n,{visualState:e,parent:c,props:t,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:v}));const E=A.current,k=ye.useContext(PE);E&&!E.projection&&o&&(E.type==="html"||E.type==="svg")&&pD(A.current,t,o,k);const L=ye.useRef(!1);ye.useInsertionEffect(()=>{E&&L.current&&E.update(t,a)});const z=t[EE],q=ye.useRef(!!z&&!window.MotionHandoffIsComplete?.(z)&&window.MotionHasOptimisedAnimation?.(z));return SA(()=>{E&&(L.current=!0,window.MotionIsMounted=!0,E.updateFeatures(),E.scheduleRenderMicrotask(),q.current&&E.animationState&&E.animationState.animateChanges())}),ye.useEffect(()=>{E&&(!q.current&&E.animationState&&E.animationState.animateChanges(),q.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(z)}),q.current=!1),E.enteringChildren=void 0)}),E}function pD(n,e,t,i){const{layoutId:o,layout:c,drag:d,dragConstraints:a,layoutScroll:v,layoutRoot:A,layoutCrossfade:E}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:CE(n.parent)),n.projection.setOptions({layoutId:o,layout:c,alwaysMeasureLayout:!!d||a&&ip(a),visualElement:n,animationType:typeof c=="string"?c:"both",initialPromotionConfig:i,crossfade:E,layoutScroll:v,layoutRoot:A})}function CE(n){if(n)return n.options.allowProjection!==!1?n.projection:CE(n.parent)}function Rv(n,{forwardMotionProps:e=!1}={},t,i){t&&jk(t);const o=ub(n)?cD:lD;function c(a,v){let A;const E={...ye.useContext(sb),...a,layoutId:mD(a)},{isStatic:k}=E,L=Zk(a),z=o(a,k);if(!k&&Nx){gD();const q=_D(E);A=q.MeasureLayout,L.visualElement=fD(n,z,E,i,q.ProjectionNode)}return he.jsxs(Ey.Provider,{value:L,children:[A&&L.visualElement?he.jsx(A,{visualElement:L.visualElement,...E}):null,sD(n,a,hD(z,L.visualElement,v),z,k,e)]})}c.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const d=ye.forwardRef(c);return d[uD]=n,d}function mD({layoutId:n}){const e=ye.useContext(Lx).id;return e&&n!==void 0?e+"-"+n:n}function gD(n,e){ye.useContext(gE).strict}function _D(n){const{drag:e,layout:t}=vp;if(!e&&!t)return{};const i={...e,...t};return{MeasureLayout:e?.isEnabled(n)||t?.isEnabled(n)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function yD(n,e){if(typeof Proxy>"u")return Rv;const t=new Map,i=(c,d)=>Rv(c,d,n,e),o=(c,d)=>i(c,d);return new Proxy(o,{get:(c,d)=>d==="create"?i:(t.has(d)||t.set(d,Rv(d,void 0,n,e)),t.get(d))})}function IE({top:n,left:e,right:t,bottom:i}){return{x:{min:e,max:t},y:{min:n,max:i}}}function vD({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function xD(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),i=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:i.y,right:i.x}}function kv(n){return n===void 0||n===1}function U0({scale:n,scaleX:e,scaleY:t}){return!kv(n)||!kv(e)||!kv(t)}function Ed(n){return U0(n)||ME(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function ME(n){return L1(n.x)||L1(n.y)}function L1(n){return n&&n!=="0%"}function Y_(n,e,t){const i=n-t,o=e*i;return t+o}function F1(n,e,t,i,o){return o!==void 0&&(n=Y_(n,o,i)),Y_(n,t,i)+e}function j0(n,e=0,t=1,i,o){n.min=F1(n.min,e,t,i,o),n.max=F1(n.max,e,t,i,o)}function RE(n,{x:e,y:t}){j0(n.x,e.translate,e.scale,e.originPoint),j0(n.y,t.translate,t.scale,t.originPoint)}const N1=.999999999999,B1=1.0000000000001;function bD(n,e,t,i=!1){const o=t.length;if(!o)return;e.x=e.y=1;let c,d;for(let a=0;a<o;a++){c=t[a],d=c.projectionDelta;const{visualElement:v}=c.options;v&&v.props.style&&v.props.style.display==="contents"||(i&&c.options.layoutScroll&&c.scroll&&c!==c.root&&sp(n,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),d&&(e.x*=d.x.scale,e.y*=d.y.scale,RE(n,d)),i&&Ed(c.latestValues)&&sp(n,c.latestValues))}e.x<B1&&e.x>N1&&(e.x=1),e.y<B1&&e.y>N1&&(e.y=1)}function rp(n,e){n.min=n.min+e,n.max=n.max+e}function z1(n,e,t,i,o=.5){const c=er(n.min,n.max,o);j0(n,e,t,c,i)}function sp(n,e){z1(n.x,e.x,e.scaleX,e.scale,e.originX),z1(n.y,e.y,e.scaleY,e.scale,e.originY)}function kE(n,e){return IE(xD(n.getBoundingClientRect(),e))}function wD(n,e,t){const i=kE(n,t),{scroll:o}=e;return o&&(rp(i.x,o.offset.x),rp(i.y,o.offset.y)),i}const U1=()=>({translate:0,scale:1,origin:0,originPoint:0}),op=()=>({x:U1(),y:U1()}),j1=()=>({min:0,max:0}),vr=()=>({x:j1(),y:j1()}),V0={current:null},DE={current:!1};function TD(){if(DE.current=!0,!!Nx)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>V0.current=n.matches;n.addEventListener("change",e),e()}else V0.current=!1}const SD=new WeakMap;function AD(n,e,t){for(const i in e){const o=e[i],c=t[i];if(Hs(o))n.addValue(i,o);else if(Hs(c))n.addValue(i,yp(o,{owner:n}));else if(c!==o)if(n.hasValue(i)){const d=n.getValue(i);d.liveStyle===!0?d.jump(o):d.hasAnimated||d.set(o)}else{const d=n.getStaticValue(i);n.addValue(i,yp(d!==void 0?d:o,{owner:n}))}}for(const i in t)e[i]===void 0&&n.removeValue(i);return e}const V1=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class ED{scrapeMotionValuesFromProps(e,t,i){return{}}constructor({parent:e,props:t,presenceContext:i,reducedMotionConfig:o,blockInitialAnimation:c,visualState:d},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=eb,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=Po.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,Xi.render(this.render,!1,!0))};const{latestValues:v,renderState:A}=d;this.latestValues=v,this.baseTarget={...v},this.initialValues=t.initial?{...v}:{},this.renderState=A,this.parent=e,this.props=t,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=o,this.options=a,this.blockInitialAnimation=!!c,this.isControllingVariants=Cy(t),this.isVariantNode=yE(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:E,...k}=this.scrapeMotionValuesFromProps(t,{},this);for(const L in k){const z=k[L];v[L]!==void 0&&Hs(z)&&z.set(v[L])}}mount(e){this.current=e,SD.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,i)=>this.bindToMotionValue(i,t)),DE.current||TD(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:V0.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Ph(this.notifyUpdate),Ph(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=Fp.has(e);i&&this.onBindTransform&&this.onBindTransform();const o=t.on("change",d=>{this.latestValues[e]=d,this.props.onUpdate&&Xi.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let c;window.MotionCheckAppearSync&&(c=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{o(),c&&c(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in vp){const t=vp[e];if(!t)continue;const{isEnabled:i,Feature:o}=t;if(!this.features[e]&&o&&i(this.props)&&(this.features[e]=new o(this)),this.features[e]){const c=this.features[e];c.isMounted?c.update():(c.mount(),c.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):vr()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let i=0;i<V1.length;i++){const o=V1[i];this.propEventSubscriptions[o]&&(this.propEventSubscriptions[o](),delete this.propEventSubscriptions[o]);const c="on"+o,d=e[c];d&&(this.propEventSubscriptions[o]=this.on(o,d))}this.prevMotionValues=AD(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const i=this.values.get(e);t!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&t!==void 0&&(i=yp(t===null?void 0:t,{owner:this}),this.addValue(e,i)),i}readValue(e,t){let i=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return i!=null&&(typeof i=="string"&&(AA(i)||PA(i))?i=parseFloat(i):!Ok(i)&&Ch.test(t)&&(i=lE(e,t)),this.setBaseTarget(e,Hs(i)?i.get():i)),Hs(i)?i.get():i}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let i;if(typeof t=="string"||typeof t=="object"){const c=hb(this.props,t,this.presenceContext?.custom);c&&(i=c[e])}if(t&&i!==void 0)return i;const o=this.getBaseTargetFromProps(this.props,e);return o!==void 0&&!Hs(o)?o:this.initialValues[e]!==void 0&&i===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new Vx),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){ib.render(this.render)}}class OE extends ED{constructor(){super(...arguments),this.KeyframeResolver=wk}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:i}){delete t[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Hs(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function LE(n,{style:e,vars:t},i,o){const c=n.style;let d;for(d in e)c[d]=e[d];o?.applyProjectionStyles(c,i);for(d in t)c.setProperty(d,t[d])}function PD(n){return window.getComputedStyle(n)}class CD extends OE{constructor(){super(...arguments),this.type="html",this.renderInstance=LE}readValueFromInstance(e,t){if(Fp.has(t))return this.projection?.isProjecting?D0(t):jR(e,t);{const i=PD(e),o=(Hx(t)?i.getPropertyValue(t):i[t])||0;return typeof o=="string"?o.trim():o}}measureInstanceViewportBox(e,{transformPagePoint:t}){return kE(e,t)}build(e,t,i){lb(e,t,i.transformTemplate)}scrapeMotionValuesFromProps(e,t,i){return db(e,t,i)}}const FE=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function ID(n,e,t,i){LE(n,e,void 0,i);for(const o in e.attrs)n.setAttribute(FE.has(o)?o:fb(o),e.attrs[o])}class MD extends OE{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=vr}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Fp.has(t)){const i=aE(t);return i&&i.default||0}return t=FE.has(t)?t:fb(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,i){return AE(e,t,i)}build(e,t,i){bE(e,t,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(e,t,i,o){ID(e,t,i,o)}mount(e){this.isSVGTag=TE(e.tagName),super.mount(e)}}const RD=(n,e)=>ub(n)?new MD(e):new CD(e,{allowProjection:n!==ye.Fragment});function mp(n,e,t){const i=n.getProps();return hb(i,e,t!==void 0?t:i.custom,n)}const $0=n=>Array.isArray(n);function kD(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,yp(t))}function DD(n){return $0(n)?n[n.length-1]||0:n}function OD(n,e){const t=mp(n,e);let{transitionEnd:i={},transition:o={},...c}=t||{};c={...c,...i};for(const d in c){const a=DD(c[d]);kD(n,d,a)}}function LD(n){return!!(Hs(n)&&n.add)}function W0(n,e){const t=n.getValue("willChange");if(LD(t))return t.add(e);if(!t&&Pu.WillChange){const i=new Pu.WillChange("auto");n.addValue("willChange",i),i.add(e)}}function NE(n){return n.props[EE]}const FD=n=>n!==null;function ND(n,{repeat:e,repeatType:t="loop"},i){const o=n.filter(FD),c=e&&t!=="loop"&&e%2===1?0:o.length-1;return o[c]}const BD={type:"spring",stiffness:500,damping:25,restSpeed:10},zD=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),UD={type:"keyframes",duration:.8},jD={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},VD=(n,{keyframes:e})=>e.length>2?UD:Fp.has(n)?n.startsWith("scale")?zD(e[1]):BD:jD;function $D({when:n,delay:e,delayChildren:t,staggerChildren:i,staggerDirection:o,repeat:c,repeatType:d,repeatDelay:a,from:v,elapsed:A,...E}){return!!Object.keys(E).length}const pb=(n,e,t,i={},o,c)=>d=>{const a=tb(i,n)||{},v=a.delay||i.delay||0;let{elapsed:A=0}=i;A=A-Ec(v);const E={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-A,onUpdate:L=>{e.set(L),a.onUpdate&&a.onUpdate(L)},onComplete:()=>{d(),a.onComplete&&a.onComplete()},name:n,motionValue:e,element:c?void 0:o};$D(a)||Object.assign(E,VD(n,E)),E.duration&&(E.duration=Ec(E.duration)),E.repeatDelay&&(E.repeatDelay=Ec(E.repeatDelay)),E.from!==void 0&&(E.keyframes[0]=E.from);let k=!1;if((E.type===!1||E.duration===0&&!E.repeatDelay)&&(B0(E),E.delay===0&&(k=!0)),(Pu.instantAnimations||Pu.skipAnimations)&&(k=!0,B0(E),E.delay=0),E.allowFlatten=!a.type&&!a.ease,k&&!c&&e.get()!==void 0){const L=ND(E.keyframes,a);if(L!==void 0){Xi.update(()=>{E.onUpdate(L),E.onComplete()});return}}return a.isSync?new Qx(E):new uk(E)};function WD({protectedKeys:n,needsAnimating:e},t){const i=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,i}function BE(n,e,{delay:t=0,transitionOverride:i,type:o}={}){let{transition:c=n.getDefaultTransition(),transitionEnd:d,...a}=e;i&&(c=i);const v=[],A=o&&n.animationState&&n.animationState.getState()[o];for(const E in a){const k=n.getValue(E,n.latestValues[E]??null),L=a[E];if(L===void 0||A&&WD(A,E))continue;const z={delay:t,...tb(c||{},E)},q=k.get();if(q!==void 0&&!k.isAnimating&&!Array.isArray(L)&&L===q&&!z.velocity)continue;let Y=!1;if(window.MotionHandoffAnimation){const ue=NE(n);if(ue){const ve=window.MotionHandoffAnimation(ue,E,Xi);ve!==null&&(z.startTime=ve,Y=!0)}}W0(n,E),k.start(pb(E,k,L,n.shouldReduceMotion&&rE.has(E)?{type:!1}:z,n,Y));const ne=k.animation;ne&&v.push(ne)}return d&&Promise.all(v).then(()=>{Xi.update(()=>{d&&OD(n,d)})}),v}function zE(n,e,t,i=0,o=1){const c=Array.from(n).sort((A,E)=>A.sortNodePosition(E)).indexOf(e),d=n.size,a=(d-1)*i;return typeof t=="function"?t(c,d):o===1?c*i:a-c*i}function H0(n,e,t={}){const i=mp(n,e,t.type==="exit"?n.presenceContext?.custom:void 0);let{transition:o=n.getDefaultTransition()||{}}=i||{};t.transitionOverride&&(o=t.transitionOverride);const c=i?()=>Promise.all(BE(n,i,t)):()=>Promise.resolve(),d=n.variantChildren&&n.variantChildren.size?(v=0)=>{const{delayChildren:A=0,staggerChildren:E,staggerDirection:k}=o;return HD(n,e,v,A,E,k,t)}:()=>Promise.resolve(),{when:a}=o;if(a){const[v,A]=a==="beforeChildren"?[c,d]:[d,c];return v().then(()=>A())}else return Promise.all([c(),d(t.delay)])}function HD(n,e,t=0,i=0,o=0,c=1,d){const a=[];for(const v of n.variantChildren)v.notify("AnimationStart",e),a.push(H0(v,e,{...d,delay:t+(typeof i=="function"?0:i)+zE(n.variantChildren,v,i,o,c)}).then(()=>v.notify("AnimationComplete",e)));return Promise.all(a)}function ZD(n,e,t={}){n.notify("AnimationStart",e);let i;if(Array.isArray(e)){const o=e.map(c=>H0(n,c,t));i=Promise.all(o)}else if(typeof e=="string")i=H0(n,e,t);else{const o=typeof e=="function"?mp(n,e,t.custom):e;i=Promise.all(BE(n,o,t))}return i.then(()=>{n.notify("AnimationComplete",e)})}function UE(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let i=0;i<t;i++)if(e[i]!==n[i])return!1;return!0}const XD=ab.length;function jE(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?jE(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<XD;t++){const i=ab[t],o=n.props[i];(sg(o)||o===!1)&&(e[i]=o)}return e}const qD=[...ob].reverse(),GD=ob.length;function YD(n){return e=>Promise.all(e.map(({animation:t,options:i})=>ZD(n,t,i)))}function KD(n){let e=YD(n),t=$1(),i=!0;const o=v=>(A,E)=>{const k=mp(n,E,v==="exit"?n.presenceContext?.custom:void 0);if(k){const{transition:L,transitionEnd:z,...q}=k;A={...A,...q,...z}}return A};function c(v){e=v(n)}function d(v){const{props:A}=n,E=jE(n.parent)||{},k=[],L=new Set;let z={},q=1/0;for(let ne=0;ne<GD;ne++){const ue=qD[ne],ve=t[ue],se=A[ue]!==void 0?A[ue]:E[ue],Se=sg(se),Ne=ue===v?ve.isActive:null;Ne===!1&&(q=ne);let nt=se===E[ue]&&se!==A[ue]&&Se;if(nt&&i&&n.manuallyAnimateOnMount&&(nt=!1),ve.protectedKeys={...z},!ve.isActive&&Ne===null||!se&&!ve.prevProp||Py(se)||typeof se=="boolean")continue;const dt=JD(ve.prevProp,se);let gt=dt||ue===v&&ve.isActive&&!nt&&Se||ne>q&&Se,vt=!1;const Ft=Array.isArray(se)?se:[se];let Wt=Ft.reduce(o(ue),{});Ne===!1&&(Wt={});const{prevResolvedValues:pn={}}=ve,sn={...pn,...Wt},rn=ke=>{gt=!0,L.has(ke)&&(vt=!0,L.delete(ke)),ve.needsAnimating[ke]=!0;const ge=n.getValue(ke);ge&&(ge.liveStyle=!1)};for(const ke in sn){const ge=Wt[ke],Ue=pn[ke];if(z.hasOwnProperty(ke))continue;let $e=!1;$0(ge)&&$0(Ue)?$e=!UE(ge,Ue):$e=ge!==Ue,$e?ge!=null?rn(ke):L.add(ke):ge!==void 0&&L.has(ke)?rn(ke):ve.protectedKeys[ke]=!0}ve.prevProp=se,ve.prevResolvedValues=Wt,ve.isActive&&(z={...z,...Wt}),i&&n.blockInitialAnimation&&(gt=!1);const kn=nt&&dt;gt&&(!kn||vt)&&k.push(...Ft.map(ke=>{const ge={type:ue};if(typeof ke=="string"&&i&&!kn&&n.manuallyAnimateOnMount&&n.parent){const{parent:Ue}=n,$e=mp(Ue,ke);if(Ue.enteringChildren&&$e){const{delayChildren:de}=$e.transition||{};ge.delay=zE(Ue.enteringChildren,n,de)}}return{animation:ke,options:ge}}))}if(L.size){const ne={};if(typeof A.initial!="boolean"){const ue=mp(n,Array.isArray(A.initial)?A.initial[0]:A.initial);ue&&ue.transition&&(ne.transition=ue.transition)}L.forEach(ue=>{const ve=n.getBaseTarget(ue),se=n.getValue(ue);se&&(se.liveStyle=!0),ne[ue]=ve??null}),k.push({animation:ne})}let Y=!!k.length;return i&&(A.initial===!1||A.initial===A.animate)&&!n.manuallyAnimateOnMount&&(Y=!1),i=!1,Y?e(k):Promise.resolve()}function a(v,A){if(t[v].isActive===A)return Promise.resolve();n.variantChildren?.forEach(k=>k.animationState?.setActive(v,A)),t[v].isActive=A;const E=d(v);for(const k in t)t[k].protectedKeys={};return E}return{animateChanges:d,setActive:a,setAnimateFunction:c,getState:()=>t,reset:()=>{t=$1(),i=!0}}}function JD(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!UE(e,n):!1}function Td(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function $1(){return{animate:Td(!0),whileInView:Td(),whileHover:Td(),whileTap:Td(),whileDrag:Td(),whileFocus:Td(),exit:Td()}}class Rh{constructor(e){this.isMounted=!1,this.node=e}update(){}}class QD extends Rh{constructor(e){super(e),e.animationState||(e.animationState=KD(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Py(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let eO=0;class tO extends Rh{constructor(){super(...arguments),this.id=eO++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const o=this.node.animationState.setActive("exit",!e);t&&!e&&o.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const nO={animation:{Feature:QD},exit:{Feature:tO}};function ag(n,e,t,i={passive:!0}){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t)}function vg(n){return{point:{x:n.pageX,y:n.pageY}}}const iO=n=>e=>rb(e)&&n(e,vg(e));function Wm(n,e,t,i){return ag(n,e,iO(t),i)}const VE=1e-4,rO=1-VE,sO=1+VE,$E=.01,oO=0-$E,aO=0+$E;function uo(n){return n.max-n.min}function lO(n,e,t){return Math.abs(n-e)<=t}function W1(n,e,t,i=.5){n.origin=i,n.originPoint=er(e.min,e.max,n.origin),n.scale=uo(t)/uo(e),n.translate=er(t.min,t.max,n.origin)-n.originPoint,(n.scale>=rO&&n.scale<=sO||isNaN(n.scale))&&(n.scale=1),(n.translate>=oO&&n.translate<=aO||isNaN(n.translate))&&(n.translate=0)}function Hm(n,e,t,i){W1(n.x,e.x,t.x,i?i.originX:void 0),W1(n.y,e.y,t.y,i?i.originY:void 0)}function H1(n,e,t){n.min=t.min+e.min,n.max=n.min+uo(e)}function cO(n,e,t){H1(n.x,e.x,t.x),H1(n.y,e.y,t.y)}function Z1(n,e,t){n.min=e.min-t.min,n.max=n.min+uo(e)}function Zm(n,e,t){Z1(n.x,e.x,t.x),Z1(n.y,e.y,t.y)}function Pa(n){return[n("x"),n("y")]}const WE=({current:n})=>n?n.ownerDocument.defaultView:null,X1=(n,e)=>Math.abs(n-e);function uO(n,e){const t=X1(n.x,e.x),i=X1(n.y,e.y);return Math.sqrt(t**2+i**2)}class HE{constructor(e,t,{transformPagePoint:i,contextWindow:o=window,dragSnapToOrigin:c=!1,distanceThreshold:d=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=Ov(this.lastMoveEventInfo,this.history),z=this.startEvent!==null,q=uO(L.offset,{x:0,y:0})>=this.distanceThreshold;if(!z&&!q)return;const{point:Y}=L,{timestamp:ne}=Ss;this.history.push({...Y,timestamp:ne});const{onStart:ue,onMove:ve}=this.handlers;z||(ue&&ue(this.lastMoveEvent,L),this.startEvent=this.lastMoveEvent),ve&&ve(this.lastMoveEvent,L)},this.handlePointerMove=(L,z)=>{this.lastMoveEvent=L,this.lastMoveEventInfo=Dv(z,this.transformPagePoint),Xi.update(this.updatePoint,!0)},this.handlePointerUp=(L,z)=>{this.end();const{onEnd:q,onSessionEnd:Y,resumeAnimation:ne}=this.handlers;if(this.dragSnapToOrigin&&ne&&ne(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const ue=Ov(L.type==="pointercancel"?this.lastMoveEventInfo:Dv(z,this.transformPagePoint),this.history);this.startEvent&&q&&q(L,ue),Y&&Y(L,ue)},!rb(e))return;this.dragSnapToOrigin=c,this.handlers=t,this.transformPagePoint=i,this.distanceThreshold=d,this.contextWindow=o||window;const a=vg(e),v=Dv(a,this.transformPagePoint),{point:A}=v,{timestamp:E}=Ss;this.history=[{...A,timestamp:E}];const{onSessionStart:k}=t;k&&k(e,Ov(v,this.history)),this.removeListeners=gg(Wm(this.contextWindow,"pointermove",this.handlePointerMove),Wm(this.contextWindow,"pointerup",this.handlePointerUp),Wm(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ph(this.updatePoint)}}function Dv(n,e){return e?{point:e(n.point)}:n}function q1(n,e){return{x:n.x-e.x,y:n.y-e.y}}function Ov({point:n},e){return{point:n,delta:q1(n,ZE(e)),offset:q1(n,hO(e)),velocity:dO(e,.1)}}function hO(n){return n[0]}function ZE(n){return n[n.length-1]}function dO(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,i=null;const o=ZE(n);for(;t>=0&&(i=n[t],!(o.timestamp-i.timestamp>Ec(e)));)t--;if(!i)return{x:0,y:0};const c=Ca(o.timestamp-i.timestamp);if(c===0)return{x:0,y:0};const d={x:(o.x-i.x)/c,y:(o.y-i.y)/c};return d.x===1/0&&(d.x=0),d.y===1/0&&(d.y=0),d}function fO(n,{min:e,max:t},i){return e!==void 0&&n<e?n=i?er(e,n,i.min):Math.max(n,e):t!==void 0&&n>t&&(n=i?er(t,n,i.max):Math.min(n,t)),n}function G1(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function pO(n,{top:e,left:t,bottom:i,right:o}){return{x:G1(n.x,t,o),y:G1(n.y,e,i)}}function Y1(n,e){let t=e.min-n.min,i=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,i]=[i,t]),{min:t,max:i}}function mO(n,e){return{x:Y1(n.x,e.x),y:Y1(n.y,e.y)}}function gO(n,e){let t=.5;const i=uo(n),o=uo(e);return o>i?t=ng(e.min,e.max-i,n.min):i>o&&(t=ng(n.min,n.max-o,e.min)),Eu(0,1,t)}function _O(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const Z0=.35;function yO(n=Z0){return n===!1?n=0:n===!0&&(n=Z0),{x:K1(n,"left","right"),y:K1(n,"top","bottom")}}function K1(n,e,t){return{min:J1(n,e),max:J1(n,t)}}function J1(n,e){return typeof n=="number"?n:n[e]||0}const vO=new WeakMap;class xO{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=vr(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:i}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const c=k=>{const{dragSnapToOrigin:L}=this.getProps();L?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(vg(k).point)},d=(k,L)=>{const{drag:z,dragPropagation:q,onDragStart:Y}=this.getProps();if(z&&!q&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Ek(z),!this.openDragLock))return;this.latestPointerEvent=k,this.latestPanInfo=L,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Pa(ue=>{let ve=this.getAxisMotionValue(ue).get()||0;if(Pc.test(ve)){const{projection:se}=this.visualElement;if(se&&se.layout){const Se=se.layout.layoutBox[ue];Se&&(ve=uo(Se)*(parseFloat(ve)/100))}}this.originPoint[ue]=ve}),Y&&Xi.postRender(()=>Y(k,L)),W0(this.visualElement,"transform");const{animationState:ne}=this.visualElement;ne&&ne.setActive("whileDrag",!0)},a=(k,L)=>{this.latestPointerEvent=k,this.latestPanInfo=L;const{dragPropagation:z,dragDirectionLock:q,onDirectionLock:Y,onDrag:ne}=this.getProps();if(!z&&!this.openDragLock)return;const{offset:ue}=L;if(q&&this.currentDirection===null){this.currentDirection=bO(ue),this.currentDirection!==null&&Y&&Y(this.currentDirection);return}this.updateAxis("x",L.point,ue),this.updateAxis("y",L.point,ue),this.visualElement.render(),ne&&ne(k,L)},v=(k,L)=>{this.latestPointerEvent=k,this.latestPanInfo=L,this.stop(k,L),this.latestPointerEvent=null,this.latestPanInfo=null},A=()=>Pa(k=>this.getAnimationState(k)==="paused"&&this.getAxisMotionValue(k).animation?.play()),{dragSnapToOrigin:E}=this.getProps();this.panSession=new HE(e,{onSessionStart:c,onStart:d,onMove:a,onSessionEnd:v,resumeAnimation:A},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:E,distanceThreshold:i,contextWindow:WE(this.visualElement)})}stop(e,t){const i=e||this.latestPointerEvent,o=t||this.latestPanInfo,c=this.isDragging;if(this.cancel(),!c||!o||!i)return;const{velocity:d}=o;this.startAnimation(d);const{onDragEnd:a}=this.getProps();a&&Xi.postRender(()=>a(i,o))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,i){const{drag:o}=this.getProps();if(!i||!c_(e,o,this.currentDirection))return;const c=this.getAxisMotionValue(e);let d=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(d=fO(d,this.constraints[e],this.elastic[e])),c.set(d)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,o=this.constraints;e&&ip(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&i?this.constraints=pO(i.layoutBox,e):this.constraints=!1,this.elastic=yO(t),o!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Pa(c=>{this.constraints!==!1&&this.getAxisMotionValue(c)&&(this.constraints[c]=_O(i.layoutBox[c],this.constraints[c]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!ip(e))return!1;const i=e.current,{projection:o}=this.visualElement;if(!o||!o.layout)return!1;const c=wD(i,o.root,this.visualElement.getTransformPagePoint());let d=mO(o.layout.layoutBox,c);if(t){const a=t(vD(d));this.hasMutatedConstraints=!!a,a&&(d=IE(a))}return d}startAnimation(e){const{drag:t,dragMomentum:i,dragElastic:o,dragTransition:c,dragSnapToOrigin:d,onDragTransitionEnd:a}=this.getProps(),v=this.constraints||{},A=Pa(E=>{if(!c_(E,t,this.currentDirection))return;let k=v&&v[E]||{};d&&(k={min:0,max:0});const L=o?200:1e6,z=o?40:1e7,q={type:"inertia",velocity:i?e[E]:0,bounceStiffness:L,bounceDamping:z,timeConstant:750,restDelta:1,restSpeed:10,...c,...k};return this.startAxisValueAnimation(E,q)});return Promise.all(A).then(a)}startAxisValueAnimation(e,t){const i=this.getAxisMotionValue(e);return W0(this.visualElement,e),i.start(pb(e,i,0,t,this.visualElement,!1))}stopAnimation(){Pa(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Pa(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),o=i[t];return o||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){Pa(t=>{const{drag:i}=this.getProps();if(!c_(t,i,this.currentDirection))return;const{projection:o}=this.visualElement,c=this.getAxisMotionValue(t);if(o&&o.layout){const{min:d,max:a}=o.layout.layoutBox[t];c.set(e[t]-er(d,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:i}=this.visualElement;if(!ip(t)||!i||!this.constraints)return;this.stopAnimation();const o={x:0,y:0};Pa(d=>{const a=this.getAxisMotionValue(d);if(a&&this.constraints!==!1){const v=a.get();o[d]=gO({min:v,max:v},this.constraints[d])}});const{transformTemplate:c}=this.visualElement.getProps();this.visualElement.current.style.transform=c?c({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),Pa(d=>{if(!c_(d,e,null))return;const a=this.getAxisMotionValue(d),{min:v,max:A}=this.constraints[d];a.set(er(v,A,o[d]))})}addListeners(){if(!this.visualElement.current)return;vO.set(this.visualElement,this);const e=this.visualElement.current,t=Wm(e,"pointerdown",v=>{const{drag:A,dragListener:E=!0}=this.getProps();A&&E&&this.start(v)}),i=()=>{const{dragConstraints:v}=this.getProps();ip(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:o}=this.visualElement,c=o.addEventListener("measure",i);o&&!o.layout&&(o.root&&o.root.updateScroll(),o.updateLayout()),Xi.read(i);const d=ag(window,"resize",()=>this.scalePositionWithinConstraints()),a=o.addEventListener("didUpdate",(({delta:v,hasLayoutChanged:A})=>{this.isDragging&&A&&(Pa(E=>{const k=this.getAxisMotionValue(E);k&&(this.originPoint[E]+=v[E].translate,k.set(k.get()+v[E].translate))}),this.visualElement.render())}));return()=>{d(),t(),c(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:i=!1,dragPropagation:o=!1,dragConstraints:c=!1,dragElastic:d=Z0,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:i,dragPropagation:o,dragConstraints:c,dragElastic:d,dragMomentum:a}}}function c_(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function bO(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class wO extends Rh{constructor(e){super(e),this.removeGroupControls=Ma,this.removeListeners=Ma,this.controls=new xO(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ma}unmount(){this.removeGroupControls(),this.removeListeners()}}const Q1=n=>(e,t)=>{n&&Xi.postRender(()=>n(e,t))};class TO extends Rh{constructor(){super(...arguments),this.removePointerDownListener=Ma}onPointerDown(e){this.session=new HE(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:WE(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:i,onPanEnd:o}=this.node.getProps();return{onSessionStart:Q1(e),onStart:Q1(t),onMove:i,onEnd:(c,d)=>{delete this.session,o&&Xi.postRender(()=>o(c,d))}}}mount(){this.removePointerDownListener=Wm(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const O_={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function e2(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Im={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Tn.test(n))n=parseFloat(n);else return n;const t=e2(n,e.target.x),i=e2(n,e.target.y);return`${t}% ${i}%`}},SO={correct:(n,{treeScale:e,projectionDelta:t})=>{const i=n,o=Ch.parse(n);if(o.length>5)return i;const c=Ch.createTransformer(n),d=typeof o[0]!="number"?1:0,a=t.x.scale*e.x,v=t.y.scale*e.y;o[0+d]/=a,o[1+d]/=v;const A=er(a,v,.5);return typeof o[2+d]=="number"&&(o[2+d]/=A),typeof o[3+d]=="number"&&(o[3+d]/=A),c(o)}};let Lv=!1;class AO extends ye.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:i,layoutId:o}=this.props,{projection:c}=e;Xk(EO),c&&(t.group&&t.group.add(c),i&&i.register&&o&&i.register(c),Lv&&c.root.didUpdate(),c.addEventListener("animationComplete",()=>{this.safeToRemove()}),c.setOptions({...c.options,onExitComplete:()=>this.safeToRemove()})),O_.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:i,drag:o,isPresent:c}=this.props,{projection:d}=i;return d&&(d.isPresent=c,Lv=!0,o||e.layoutDependency!==t||t===void 0||e.isPresent!==c?d.willUpdate():this.safeToRemove(),e.isPresent!==c&&(c?d.promote():d.relegate()||Xi.postRender(()=>{const a=d.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),ib.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:i}=this.props,{projection:o}=e;Lv=!0,o&&(o.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(o),i&&i.deregister&&i.deregister(o))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function XE(n){const[e,t]=mE(),i=ye.useContext(Lx);return he.jsx(AO,{...n,layoutGroup:i,switchLayoutGroup:ye.useContext(PE),isPresent:e,safeToRemove:t})}const EO={borderRadius:{...Im,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Im,borderTopRightRadius:Im,borderBottomLeftRadius:Im,borderBottomRightRadius:Im,boxShadow:SO};function PO(n,e,t){const i=Hs(n)?n:yp(n);return i.start(pb("",i,e,t)),i.animation}const CO=(n,e)=>n.depth-e.depth;class IO{constructor(){this.children=[],this.isDirty=!1}add(e){Bx(this.children,e),this.isDirty=!0}remove(e){zx(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(CO),this.isDirty=!1,this.children.forEach(e)}}function MO(n,e){const t=Po.now(),i=({timestamp:o})=>{const c=o-t;c>=e&&(Ph(i),n(c-e))};return Xi.setup(i,!0),()=>Ph(i)}const qE=["TopLeft","TopRight","BottomLeft","BottomRight"],RO=qE.length,t2=n=>typeof n=="string"?parseFloat(n):n,n2=n=>typeof n=="number"||Tn.test(n);function kO(n,e,t,i,o,c){o?(n.opacity=er(0,t.opacity??1,DO(i)),n.opacityExit=er(e.opacity??1,0,OO(i))):c&&(n.opacity=er(e.opacity??1,t.opacity??1,i));for(let d=0;d<RO;d++){const a=`border${qE[d]}Radius`;let v=i2(e,a),A=i2(t,a);if(v===void 0&&A===void 0)continue;v||(v=0),A||(A=0),v===0||A===0||n2(v)===n2(A)?(n[a]=Math.max(er(t2(v),t2(A),i),0),(Pc.test(A)||Pc.test(v))&&(n[a]+="%")):n[a]=A}(e.rotate||t.rotate)&&(n.rotate=er(e.rotate||0,t.rotate||0,i))}function i2(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const DO=GE(0,.5,LA),OO=GE(.5,.95,Ma);function GE(n,e,t){return i=>i<n?0:i>e?1:t(ng(n,e,i))}function r2(n,e){n.min=e.min,n.max=e.max}function Ea(n,e){r2(n.x,e.x),r2(n.y,e.y)}function s2(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function o2(n,e,t,i,o){return n-=e,n=Y_(n,1/t,i),o!==void 0&&(n=Y_(n,1/o,i)),n}function LO(n,e=0,t=1,i=.5,o,c=n,d=n){if(Pc.test(e)&&(e=parseFloat(e),e=er(d.min,d.max,e/100)-d.min),typeof e!="number")return;let a=er(c.min,c.max,i);n===c&&(a-=e),n.min=o2(n.min,e,t,a,o),n.max=o2(n.max,e,t,a,o)}function a2(n,e,[t,i,o],c,d){LO(n,e[t],e[i],e[o],e.scale,c,d)}const FO=["x","scaleX","originX"],NO=["y","scaleY","originY"];function l2(n,e,t,i){a2(n.x,e,FO,t?t.x:void 0,i?i.x:void 0),a2(n.y,e,NO,t?t.y:void 0,i?i.y:void 0)}function c2(n){return n.translate===0&&n.scale===1}function YE(n){return c2(n.x)&&c2(n.y)}function u2(n,e){return n.min===e.min&&n.max===e.max}function BO(n,e){return u2(n.x,e.x)&&u2(n.y,e.y)}function h2(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function KE(n,e){return h2(n.x,e.x)&&h2(n.y,e.y)}function d2(n){return uo(n.x)/uo(n.y)}function f2(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class zO{constructor(){this.members=[]}add(e){Bx(this.members,e),e.scheduleRender()}remove(e){if(zx(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(o=>e===o);if(t===0)return!1;let i;for(let o=t;o>=0;o--){const c=this.members[o];if(c.isPresent!==!1){i=c;break}}return i?(this.promote(i),!0):!1}promote(e,t){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,t&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:o}=e.options;o===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:i}=e;t.onExitComplete&&t.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function UO(n,e,t){let i="";const o=n.x.translate/e.x,c=n.y.translate/e.y,d=t?.z||0;if((o||c||d)&&(i=`translate3d(${o}px, ${c}px, ${d}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:A,rotate:E,rotateX:k,rotateY:L,skewX:z,skewY:q}=t;A&&(i=`perspective(${A}px) ${i}`),E&&(i+=`rotate(${E}deg) `),k&&(i+=`rotateX(${k}deg) `),L&&(i+=`rotateY(${L}deg) `),z&&(i+=`skewX(${z}deg) `),q&&(i+=`skewY(${q}deg) `)}const a=n.x.scale*e.x,v=n.y.scale*e.y;return(a!==1||v!==1)&&(i+=`scale(${a}, ${v})`),i||"none"}const Fv=["","X","Y","Z"],jO=1e3;let VO=0;function Nv(n,e,t,i){const{latestValues:o}=e;o[n]&&(t[n]=o[n],e.setStaticValue(n,0),i&&(i[n]=0))}function JE(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=NE(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:o,layoutId:c}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",Xi,!(o||c))}const{parent:i}=n;i&&!i.hasCheckedOptimisedAppear&&JE(i)}function QE({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:i,resetTransform:o}){return class{constructor(d={},a=e?.()){this.id=VO++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(HO),this.nodes.forEach(GO),this.nodes.forEach(YO),this.nodes.forEach(ZO)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=d,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new IO)}addEventListener(d,a){return this.eventHandlers.has(d)||this.eventHandlers.set(d,new Vx),this.eventHandlers.get(d).add(a)}notifyListeners(d,...a){const v=this.eventHandlers.get(d);v&&v.notify(...a)}hasListeners(d){return this.eventHandlers.has(d)}mount(d){if(this.instance)return;this.isSVG=pE(d)&&!kk(d),this.instance=d;const{layoutId:a,layout:v,visualElement:A}=this.options;if(A&&!A.current&&A.mount(d),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(v||a)&&(this.isLayoutDirty=!0),n){let E,k=0;const L=()=>this.root.updateBlockedByResize=!1;Xi.read(()=>{k=window.innerWidth}),n(d,()=>{const z=window.innerWidth;z!==k&&(k=z,this.root.updateBlockedByResize=!0,E&&E(),E=MO(L,250),O_.hasAnimatedSinceResize&&(O_.hasAnimatedSinceResize=!1,this.nodes.forEach(g2)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&A&&(a||v)&&this.addEventListener("didUpdate",({delta:E,hasLayoutChanged:k,hasRelativeLayoutChanged:L,layout:z})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const q=this.options.transition||A.getDefaultTransition()||t4,{onLayoutAnimationStart:Y,onLayoutAnimationComplete:ne}=A.getProps(),ue=!this.targetLayout||!KE(this.targetLayout,z),ve=!k&&L;if(this.options.layoutRoot||this.resumeFrom||ve||k&&(ue||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const se={...tb(q,"layout"),onPlay:Y,onComplete:ne};(A.shouldReduceMotion||this.options.layoutRoot)&&(se.delay=0,se.type=!1),this.startAnimation(se),this.setAnimationOrigin(E,ve)}else k||g2(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=z})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const d=this.getStack();d&&d.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ph(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(KO),this.animationId++)}getTransformTemplate(){const{visualElement:d}=this.options;return d&&d.getProps().transformTemplate}willUpdate(d=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&JE(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let E=0;E<this.path.length;E++){const k=this.path[E];k.shouldResetTransform=!0,k.updateScroll("snapshot"),k.options.layoutRoot&&k.willUpdate(!1)}const{layoutId:a,layout:v}=this.options;if(a===void 0&&!v)return;const A=this.getTransformTemplate();this.prevTransformTemplateValue=A?A(this.latestValues,""):void 0,this.updateSnapshot(),d&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(p2);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(m2);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(qO),this.nodes.forEach($O),this.nodes.forEach(WO)):this.nodes.forEach(m2),this.clearAllSnapshots();const a=Po.now();Ss.delta=Eu(0,1e3/60,a-Ss.timestamp),Ss.timestamp=a,Ss.isProcessing=!0,Av.update.process(Ss),Av.preRender.process(Ss),Av.render.process(Ss),Ss.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,ib.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(XO),this.sharedNodes.forEach(JO)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Xi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Xi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!uo(this.snapshot.measuredBox.x)&&!uo(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const d=this.layout;this.layout=this.measure(!1),this.layoutCorrected=vr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,d?d.layoutBox:void 0)}updateScroll(d="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===d&&(a=!1),a&&this.instance){const v=i(this.instance);this.scroll={animationId:this.root.animationId,phase:d,isRoot:v,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!o)return;const d=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!YE(this.projectionDelta),v=this.getTransformTemplate(),A=v?v(this.latestValues,""):void 0,E=A!==this.prevTransformTemplateValue;d&&this.instance&&(a||Ed(this.latestValues)||E)&&(o(this.instance,A),this.shouldResetTransform=!1,this.scheduleRender())}measure(d=!0){const a=this.measurePageBox();let v=this.removeElementScroll(a);return d&&(v=this.removeTransform(v)),n4(v),{animationId:this.root.animationId,measuredBox:a,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:d}=this.options;if(!d)return vr();const a=d.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(i4))){const{scroll:A}=this.root;A&&(rp(a.x,A.offset.x),rp(a.y,A.offset.y))}return a}removeElementScroll(d){const a=vr();if(Ea(a,d),this.scroll?.wasRoot)return a;for(let v=0;v<this.path.length;v++){const A=this.path[v],{scroll:E,options:k}=A;A!==this.root&&E&&k.layoutScroll&&(E.wasRoot&&Ea(a,d),rp(a.x,E.offset.x),rp(a.y,E.offset.y))}return a}applyTransform(d,a=!1){const v=vr();Ea(v,d);for(let A=0;A<this.path.length;A++){const E=this.path[A];!a&&E.options.layoutScroll&&E.scroll&&E!==E.root&&sp(v,{x:-E.scroll.offset.x,y:-E.scroll.offset.y}),Ed(E.latestValues)&&sp(v,E.latestValues)}return Ed(this.latestValues)&&sp(v,this.latestValues),v}removeTransform(d){const a=vr();Ea(a,d);for(let v=0;v<this.path.length;v++){const A=this.path[v];if(!A.instance||!Ed(A.latestValues))continue;U0(A.latestValues)&&A.updateSnapshot();const E=vr(),k=A.measurePageBox();Ea(E,k),l2(a,A.latestValues,A.snapshot?A.snapshot.layoutBox:void 0,E)}return Ed(this.latestValues)&&l2(a,this.latestValues),a}setTargetDelta(d){this.targetDelta=d,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(d){this.options={...this.options,...d,crossfade:d.crossfade!==void 0?d.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ss.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(d=!1){const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const v=!!this.resumingFrom||this!==a;if(!(d||v&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:E,layoutId:k}=this.options;if(!(!this.layout||!(E||k))){if(this.resolvedRelativeTargetAt=Ss.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=vr(),this.relativeTargetOrigin=vr(),Zm(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),Ea(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=vr(),this.targetWithTransforms=vr()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),cO(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ea(this.target,this.layout.layoutBox),RE(this.target,this.targetDelta)):Ea(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=vr(),this.relativeTargetOrigin=vr(),Zm(this.relativeTargetOrigin,this.target,L.target),Ea(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||U0(this.parent.latestValues)||ME(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const d=this.getLead(),a=!!this.resumingFrom||this!==d;let v=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(v=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(v=!1),this.resolvedRelativeTargetAt===Ss.timestamp&&(v=!1),v)return;const{layout:A,layoutId:E}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(A||E))return;Ea(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,L=this.treeScale.y;bD(this.layoutCorrected,this.treeScale,this.path,a),d.layout&&!d.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(d.target=d.layout.layoutBox,d.targetWithTransforms=vr());const{target:z}=d;if(!z){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(s2(this.prevProjectionDelta.x,this.projectionDelta.x),s2(this.prevProjectionDelta.y,this.projectionDelta.y)),Hm(this.projectionDelta,this.layoutCorrected,z,this.latestValues),(this.treeScale.x!==k||this.treeScale.y!==L||!f2(this.projectionDelta.x,this.prevProjectionDelta.x)||!f2(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",z))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(d=!0){if(this.options.visualElement?.scheduleRender(),d){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=op(),this.projectionDelta=op(),this.projectionDeltaWithTransform=op()}setAnimationOrigin(d,a=!1){const v=this.snapshot,A=v?v.latestValues:{},E={...this.latestValues},k=op();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const L=vr(),z=v?v.source:void 0,q=this.layout?this.layout.source:void 0,Y=z!==q,ne=this.getStack(),ue=!ne||ne.members.length<=1,ve=!!(Y&&!ue&&this.options.crossfade===!0&&!this.path.some(e4));this.animationProgress=0;let se;this.mixTargetDelta=Se=>{const Ne=Se/1e3;_2(k.x,d.x,Ne),_2(k.y,d.y,Ne),this.setTargetDelta(k),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Zm(L,this.layout.layoutBox,this.relativeParent.layout.layoutBox),QO(this.relativeTarget,this.relativeTargetOrigin,L,Ne),se&&BO(this.relativeTarget,se)&&(this.isProjectionDirty=!1),se||(se=vr()),Ea(se,this.relativeTarget)),Y&&(this.animationValues=E,kO(E,A,this.latestValues,Ne,ve,ue)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Ne},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(d){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Ph(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Xi.update(()=>{O_.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=yp(0)),this.currentAnimation=PO(this.motionValue,[0,1e3],{...d,velocity:0,isSync:!0,onUpdate:a=>{this.mixTargetDelta(a),d.onUpdate&&d.onUpdate(a)},onStop:()=>{},onComplete:()=>{d.onComplete&&d.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const d=this.getStack();d&&d.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(jO),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const d=this.getLead();let{targetWithTransforms:a,target:v,layout:A,latestValues:E}=d;if(!(!a||!v||!A)){if(this!==d&&this.layout&&A&&eP(this.options.animationType,this.layout.layoutBox,A.layoutBox)){v=this.target||vr();const k=uo(this.layout.layoutBox.x);v.x.min=d.target.x.min,v.x.max=v.x.min+k;const L=uo(this.layout.layoutBox.y);v.y.min=d.target.y.min,v.y.max=v.y.min+L}Ea(a,v),sp(a,E),Hm(this.projectionDeltaWithTransform,this.layoutCorrected,a,E)}}registerSharedNode(d,a){this.sharedNodes.has(d)||this.sharedNodes.set(d,new zO),this.sharedNodes.get(d).add(a);const A=a.options.initialPromotionConfig;a.promote({transition:A?A.transition:void 0,preserveFollowOpacity:A&&A.shouldPreserveFollowOpacity?A.shouldPreserveFollowOpacity(a):void 0})}isLead(){const d=this.getStack();return d?d.lead===this:!0}getLead(){const{layoutId:d}=this.options;return d?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:d}=this.options;return d?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:d}=this.options;if(d)return this.root.sharedNodes.get(d)}promote({needsReset:d,transition:a,preserveFollowOpacity:v}={}){const A=this.getStack();A&&A.promote(this,v),d&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const d=this.getStack();return d?d.relegate(this):!1}resetSkewAndRotation(){const{visualElement:d}=this.options;if(!d)return;let a=!1;const{latestValues:v}=d;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(a=!0),!a)return;const A={};v.z&&Nv("z",d,A,this.animationValues);for(let E=0;E<Fv.length;E++)Nv(`rotate${Fv[E]}`,d,A,this.animationValues),Nv(`skew${Fv[E]}`,d,A,this.animationValues);d.render();for(const E in A)d.setStaticValue(E,A[E]),this.animationValues&&(this.animationValues[E]=A[E]);d.scheduleRender()}applyProjectionStyles(d,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){d.visibility="hidden";return}const v=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,d.visibility="",d.opacity="",d.pointerEvents=D_(a?.pointerEvents)||"",d.transform=v?v(this.latestValues,""):"none";return}const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){this.options.layoutId&&(d.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,d.pointerEvents=D_(a?.pointerEvents)||""),this.hasProjected&&!Ed(this.latestValues)&&(d.transform=v?v({},""):"none",this.hasProjected=!1);return}d.visibility="";const E=A.animationValues||A.latestValues;this.applyTransformsToTarget();let k=UO(this.projectionDeltaWithTransform,this.treeScale,E);v&&(k=v(E,k)),d.transform=k;const{x:L,y:z}=this.projectionDelta;d.transformOrigin=`${L.origin*100}% ${z.origin*100}% 0`,A.animationValues?d.opacity=A===this?E.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:E.opacityExit:d.opacity=A===this?E.opacity!==void 0?E.opacity:"":E.opacityExit!==void 0?E.opacityExit:0;for(const q in og){if(E[q]===void 0)continue;const{correct:Y,applyTo:ne,isCSSVariable:ue}=og[q],ve=k==="none"?E[q]:Y(E[q],A);if(ne){const se=ne.length;for(let Se=0;Se<se;Se++)d[ne[Se]]=ve}else ue?this.options.visualElement.renderState.vars[q]=ve:d[q]=ve}this.options.layoutId&&(d.pointerEvents=A===this?D_(a?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(d=>d.currentAnimation?.stop()),this.root.nodes.forEach(p2),this.root.sharedNodes.clear()}}}function $O(n){n.updateLayout()}function WO(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:i}=n.layout,{animationType:o}=n.options,c=e.source!==n.layout.source;o==="size"?Pa(E=>{const k=c?e.measuredBox[E]:e.layoutBox[E],L=uo(k);k.min=t[E].min,k.max=k.min+L}):eP(o,e.layoutBox,t)&&Pa(E=>{const k=c?e.measuredBox[E]:e.layoutBox[E],L=uo(t[E]);k.max=k.min+L,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[E].max=n.relativeTarget[E].min+L)});const d=op();Hm(d,t,e.layoutBox);const a=op();c?Hm(a,n.applyTransform(i,!0),e.measuredBox):Hm(a,t,e.layoutBox);const v=!YE(d);let A=!1;if(!n.resumeFrom){const E=n.getClosestProjectingParent();if(E&&!E.resumeFrom){const{snapshot:k,layout:L}=E;if(k&&L){const z=vr();Zm(z,e.layoutBox,k.layoutBox);const q=vr();Zm(q,t,L.layoutBox),KE(z,q)||(A=!0),E.options.layoutRoot&&(n.relativeTarget=q,n.relativeTargetOrigin=z,n.relativeParent=E)}}}n.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:a,layoutDelta:d,hasLayoutChanged:v,hasRelativeLayoutChanged:A})}else if(n.isLead()){const{onExitComplete:t}=n.options;t&&t()}n.options.transition=void 0}function HO(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function ZO(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function XO(n){n.clearSnapshot()}function p2(n){n.clearMeasurements()}function m2(n){n.isLayoutDirty=!1}function qO(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function g2(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function GO(n){n.resolveTargetDelta()}function YO(n){n.calcProjection()}function KO(n){n.resetSkewAndRotation()}function JO(n){n.removeLeadSnapshot()}function _2(n,e,t){n.translate=er(e.translate,0,t),n.scale=er(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function y2(n,e,t,i){n.min=er(e.min,t.min,i),n.max=er(e.max,t.max,i)}function QO(n,e,t,i){y2(n.x,e.x,t.x,i),y2(n.y,e.y,t.y,i)}function e4(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const t4={duration:.45,ease:[.4,0,.1,1]},v2=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),x2=v2("applewebkit/")&&!v2("chrome/")?Math.round:Ma;function b2(n){n.min=x2(n.min),n.max=x2(n.max)}function n4(n){b2(n.x),b2(n.y)}function eP(n,e,t){return n==="position"||n==="preserve-aspect"&&!lO(d2(e),d2(t),.2)}function i4(n){return n!==n.root&&n.scroll?.wasRoot}const r4=QE({attachResizeListener:(n,e)=>ag(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Bv={current:void 0},tP=QE({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!Bv.current){const n=new r4({});n.mount(window),n.setOptions({layoutScroll:!0}),Bv.current=n}return Bv.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),s4={pan:{Feature:TO},drag:{Feature:wO,ProjectionNode:tP,MeasureLayout:XE}};function w2(n,e,t){const{props:i}=n;n.animationState&&i.whileHover&&n.animationState.setActive("whileHover",t==="Start");const o="onHover"+t,c=i[o];c&&Xi.postRender(()=>c(e,vg(e)))}class o4 extends Rh{mount(){const{current:e}=this.node;e&&(this.unmount=Pk(e,(t,i)=>(w2(this.node,i,"Start"),o=>w2(this.node,o,"End"))))}unmount(){}}class a4 extends Rh{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=gg(ag(this.node.current,"focus",()=>this.onFocus()),ag(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function T2(n,e,t){const{props:i}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&i.whileTap&&n.animationState.setActive("whileTap",t==="Start");const o="onTap"+(t==="End"?"":t),c=i[o];c&&Xi.postRender(()=>c(e,vg(e)))}class l4 extends Rh{mount(){const{current:e}=this.node;e&&(this.unmount=Rk(e,(t,i)=>(T2(this.node,i,"Start"),(o,{success:c})=>T2(this.node,o,c?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const X0=new WeakMap,zv=new WeakMap,c4=n=>{const e=X0.get(n.target);e&&e(n)},u4=n=>{n.forEach(c4)};function h4({root:n,...e}){const t=n||document;zv.has(t)||zv.set(t,{});const i=zv.get(t),o=JSON.stringify(e);return i[o]||(i[o]=new IntersectionObserver(u4,{root:n,...e})),i[o]}function d4(n,e,t){const i=h4(e);return X0.set(n,t),i.observe(n),()=>{X0.delete(n),i.unobserve(n)}}const f4={some:0,all:1};class p4 extends Rh{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:i,amount:o="some",once:c}=e,d={root:t?t.current:void 0,rootMargin:i,threshold:typeof o=="number"?o:f4[o]},a=v=>{const{isIntersecting:A}=v;if(this.isInView===A||(this.isInView=A,c&&!A&&this.hasEnteredView))return;A&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",A);const{onViewportEnter:E,onViewportLeave:k}=this.node.getProps(),L=A?E:k;L&&L(v)};return d4(this.node.current,d,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(m4(e,t))&&this.startObserver()}unmount(){}}function m4({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const g4={inView:{Feature:p4},tap:{Feature:l4},focus:{Feature:a4},hover:{Feature:o4}},_4={layout:{ProjectionNode:tP,MeasureLayout:XE}},y4={...nO,...g4,...s4,..._4},fn=yD(y4,RD);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v4=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),x4=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,i)=>i?i.toUpperCase():t.toLowerCase()),S2=n=>{const e=x4(n);return e.charAt(0).toUpperCase()+e.slice(1)},nP=(...n)=>n.filter((e,t,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===t).join(" ").trim(),b4=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var w4={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T4=ye.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:i,className:o="",children:c,iconNode:d,...a},v)=>ye.createElement("svg",{ref:v,...w4,width:e,height:e,stroke:n,strokeWidth:i?Number(t)*24/Number(e):t,className:nP("lucide",o),...!c&&!b4(a)&&{"aria-hidden":"true"},...a},[...d.map(([A,E])=>ye.createElement(A,E)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=(n,e)=>{const t=ye.forwardRef(({className:i,...o},c)=>ye.createElement(T4,{ref:c,iconNode:e,className:nP(`lucide-${v4(S2(n))}`,`lucide-${n}`,i),...o}));return t.displayName=S2(n),t};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S4=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],iP=Fa("book-open",S4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A4=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],E4=Fa("brain",A4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P4=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],C4=Fa("chevron-down",P4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I4=[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17",key:"1tzkfa"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"14pb5j"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],M4=Fa("earth",I4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R4=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],k4=Fa("map",R4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D4=[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]],O4=Fa("notebook-pen",D4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L4=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],F4=Fa("triangle-alert",L4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N4=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],B4=Fa("users",N4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z4=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],U4=Fa("volume-2",z4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j4=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}]],V4=Fa("volume",j4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $4=[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]],W4=Fa("waves",$4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H4=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],rP=Fa("x",H4),ap={salinity:[[237,248,251],[204,236,230],[153,216,201],[102,194,164],[35,139,69]],topography:[[255,255,204],[255,237,160],[254,204,92],[253,141,60],[240,59,32]],biomass:[[255,245,240],[254,224,210],[252,187,161],[252,146,114],[215,48,31]],temperature:[[49,54,149],[69,117,180],[116,173,209],[171,217,233],[255,255,191],[254,153,41],[204,76,2]],currents:[[229,245,249],[153,216,201],[44,162,95],[0,109,44]],default:[[255,255,178],[254,204,92],[253,141,60],[240,59,32]],salinity_cb:[[68,1,84],[59,82,139],[33,145,140],[94,201,98],[253,231,37]],topography_cb:[[253,231,37],[94,201,98],[33,145,140],[59,82,139],[68,1,84]],biomass_cb:[[255,247,236],[254,196,79],[254,153,41],[217,95,14],[153,52,4]],temperature_cb:[[68,1,84],[59,82,139],[33,145,140],[94,201,98],[253,231,37],[254,153,41],[204,76,2]],currents_cb:[[253,231,37],[94,201,98],[33,145,140],[59,82,139]],default_cb:[[253,231,37],[254,204,92],[253,141,60],[240,59,32]]};function A2(n,e){const t=n.length,o=Math.max(0,Math.min(1,e))*(t-1),c=Math.floor(o),d=Math.min(t-1,Math.ceil(o)),a=o-c,v=n[c],A=n[d],E=Math.round(v[0]+(A[0]-v[0])*a),k=Math.round(v[1]+(A[1]-v[1])*a),L=Math.round(v[2]+(A[2]-v[2])*a);return[E,k,L]}const Z4=["Temperature","Salinity","Ocean Topography","Ocean Currents","Biomass"],sP=ye.createContext(void 0),X4=({children:n})=>{const[e,t]=ye.useState(Z4[0]),[i,o]=ye.useState(!1);return ye.useEffect(()=>{console.log("PaletteContext: selectedView changed to",e)},[e]),he.jsx(sP.Provider,{value:{selectedView:e,setSelectedView:t,colorblindMode:i,setColorblindMode:o},children:n})},Iy=()=>{const n=ye.useContext(sP);if(!n)throw new Error("usePalette must be used within PaletteProvider");return n},q4=({onModeChange:n})=>{const[e,t]=ye.useState("research"),i=()=>{const o=e==="research"?"student":"research";t(o),n?.(o)};return ye.useEffect(()=>{n?.(e)},[]),he.jsxs("div",{className:"flex items-center space-x-2 w-full justify-between",children:[he.jsxs("div",{className:"flex items-center space-x-2",children:[he.jsx("span",{className:"text-xl",children:""}),he.jsx("span",{className:"text-sm text-white",children:"Student Mode"})]}),he.jsx("button",{onClick:i,"aria-label":`Switch to ${e==="research"?"student":"research"} mode`,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors hover:opacity-80 focus:outline-none ${e==="student"?"bg-green-600":"bg-white/5"}`,children:he.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${e==="student"?"translate-x-6":"translate-x-1"}`})})]})},G4=({setMapMode:n,enabled:e,setEnabled:t,forcedOpen:i})=>{const[o,c]=ye.useState(!1);ye.useEffect(()=>{c(!!i)},[i]);const d={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0}},[a,v]=ye.useState([{name:"Temperature",icon:"",selected:!1,color:[255,0,0]},{name:"Salinity",icon:"",selected:!1,color:[0,0,255]},{name:"Ocean Topography",icon:"",selected:!1,color:[0,255,0]},{name:"Ocean Currents",icon:"",selected:!1,color:[255,255,0]},{name:"Biomass",icon:"",selected:!1,color:[255,165,0]}]),{setSelectedView:A,colorblindMode:E,setColorblindMode:k}=Iy(),L=q=>{const Y=a[q];A(Y.name),v(ne=>ne.map((ue,ve)=>({...ue,selected:ve===q})))},z=q=>{v(Y=>Y),n?.(q)};return he.jsxs("div",{className:"flex flex-col w-full",children:[he.jsxs("button",{onClick:()=>c(!o),className:"flex items-center justify-between gap-2 p-2 rounded-lg hover:bg-slate-800/60 transition-all",children:[he.jsxs("div",{className:"flex items-center gap-3",children:[he.jsx(k4,{size:20}),he.jsx("span",{className:"font-medium text-blue-100",children:"Shark Map"})]}),he.jsx(fn.div,{animate:{rotate:o?180:0},transition:{duration:.3},children:he.jsx(C4,{size:18})})]}),he.jsx(Ay,{children:o&&he.jsxs(fn.ul,{initial:"hidden",animate:"visible",exit:"hidden",variants:{visible:{opacity:1,height:"auto"},hidden:{opacity:0,height:0}},transition:{duration:.3},className:"ml-4 mt-3 grid grid-cols-2 gap-2 overflow-hidden",children:[he.jsx("div",{className:"col-span-2 mb-4",children:he.jsxs("div",{className:"flex flex-col gap-3",children:[he.jsx("div",{className:"flex items-center justify-between",children:he.jsx(q4,{onModeChange:z})}),he.jsx("div",{className:"flex w-full items-center justify-between",children:he.jsxs("div",{className:"flex justify-between w-full gap-3",children:[he.jsxs("div",{className:"flex items-center space-x-2",children:[he.jsx("span",{className:"text-2xl",children:""}),he.jsx("span",{className:"text-sm",children:"Aerosol"})]}),he.jsx("button",{"aria-pressed":!!e,onClick:()=>t?.(!e),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors hover:opacity-80 focus:outline-none ${e?"bg-green-600":"bg-white/5"}`,title:"Enable map features",children:he.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${e?"translate-x-6":"translate-x-1"}`})})]})}),he.jsx("div",{className:"flex w-full items-center justify-between",children:he.jsxs("div",{className:"flex justify-between w-full gap-3",children:[he.jsxs("div",{className:"flex items-center space-x-2",children:[he.jsx("span",{className:"text-2xl",children:""}),he.jsx("span",{className:"text-sm",children:"Colorblind"})]}),he.jsx("button",{"aria-pressed":!!E,onClick:()=>k?.(!E),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors hover:opacity-80 focus:outline-none ${E?"bg-green-600":"bg-white/5"}`,title:"Colorblind mode",children:he.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${E?"translate-x-5":"translate-x-0"}`})})]})})]})}),a.map((q,Y)=>he.jsxs(fn.li,{variants:d,initial:"hidden",animate:"visible",transition:{delay:Y*.05},onClick:()=>L(Y),className:`
                  cursor-pointer
                  flex flex-col items-center justify-center
                  p-4 rounded-xl border backdrop-blur-sm
                  transition-all duration-300
                  shadow-md
                  ${q.selected?"bg-blue-700 border-blue-500 text-white shadow-lg":"bg-slate-800/40 border-slate-700/50 text-blue-100 hover:bg-slate-700/60 hover:border-slate-600"}
                `,children:[q.icon&&he.jsx("span",{className:"text-3xl mb-2 opacity-90 drop-shadow-md",children:q.icon}),he.jsx("span",{className:`text-sm font-medium tracking-wide ${q.selected?"text-white":"text-blue-100/90"}`,children:q.name}),q.selected&&he.jsx(fn.div,{layoutId:"selectedIndicator",className:"mt-2 w-2.5 h-2.5 bg-blue-300 rounded-full shadow-inner"})]},Y))]})})]})},oP=ye.createContext(void 0),My=({children:n,initialSlide:e=0})=>{const t=ye.Children.toArray(n),i=t.length,[o,c]=ye.useState(e),A={currentSlide:o,totalSlides:i,nextSlide:()=>{c(E=>(E+1)%i)},prevSlide:()=>{c(E=>(E-1+i)%i)},goToSlide:E=>{E>=0&&E<i&&c(E)}};return he.jsx(oP.Provider,{value:A,children:t[o]})},Hd=()=>{const n=ye.useContext(oP);if(n===void 0)throw new Error("useSliderProvider must be used within a SliderProvider");return n},kh=()=>he.jsxs(fn.div,{className:"absolute inset-0 overflow-hidden",children:[he.jsx(fn.div,{className:"absolute inset-0 bg-gradient-to-br from-[#00111F] via-[#002B44] to-[#004B70] animate-gradient-move",style:{backgroundSize:"400% 400%",filter:"brightness(0.9)"}}),[...Array(25)].map((n,e)=>he.jsx(fn.div,{className:"absolute bg-blue-200 rounded-full opacity-10 blur-sm",style:{width:Math.random()*6+4,height:Math.random()*6+4,top:`${Math.random()*100}%`,left:`${Math.random()*100}%`},animate:{y:[0,-120,0],opacity:[.05,.3,.05]},transition:{duration:6+Math.random()*4,repeat:1/0,ease:"easeInOut"}},e))]}),Zd=({onClick:n,children:e})=>he.jsx(fn.button,{onClick:n,className:"px-8 py-3 rounded-full bg-blue-500/20 backdrop-blur-md border border-blue-400/40 text-blue-100 font-semibold text-lg hover:bg-blue-500/30 hover:scale-105 transition-all shadow-lg shadow-blue-900/40",initial:{opacity:.8,scale:.8},animate:{opacity:1,scale:[1,1.05,1]},transition:{duration:1.8,delay:1,repeat:1/0,repeatType:"mirror"},children:e}),aP=ye.createContext(void 0),Y4=({children:n})=>{const[e,t]=ye.useState(null),[i,o]=ye.useState(!1);ye.useEffect(()=>{const a=()=>{const v=window.speechSynthesis.getVoices();if(v.length>0){const A=v.find(E=>/Wavenet|Neural/i.test(E.name))||v.find(E=>/(Google UK English Female|Google US English|Microsoft Sonia Online|Microsoft Jenny)/i.test(E.name))||v.find(E=>E.lang.startsWith("en"))||v[0];t(A),console.log("Selected voice:",A?.name)}};a(),window.speechSynthesis.onvoiceschanged=a},[]);const c=(a,v)=>{if(i&&d(),!a.trim())return;const A=new SpeechSynthesisUtterance(a);if(v){const E=window.speechSynthesis.getVoices().find(k=>k.name===v);E&&(A.voice=E)}else e&&(A.voice=e);A.pitch=1,A.rate=1,A.volume=1,A.onstart=()=>{console.log("Speech started"),o(!0)},A.onend=()=>{console.log("Speech ended"),o(!1)},A.onerror=()=>{console.log("Speech error"),o(!1)},window.speechSynthesis.speak(A)},d=()=>{console.log("Speech stopped"),window.speechSynthesis.cancel(),o(!1)};return he.jsx(aP.Provider,{value:{play:c,stop:d,isPlaying:i},children:n})},K4=()=>{const n=ye.useContext(aP);if(!n)throw new Error("useSound must be used within a SoundProvider");return n},Np=({textToRead:n,textToShow:e,title:t,voiceName:i,hasBackground:o=!1})=>{const{play:c,stop:d,isPlaying:a}=K4(),v=()=>{console.log("isPlaying before toggle:",a),a?d():c(n,i)};ye.useEffect(()=>(n.trim()&&(console.log("Playing speech for text:",n),c(n,i)),()=>d()),[n,i]);const A={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.25,.46,.45,.94]}}},E={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.8,delay:.3,ease:[.25,.46,.45,.94]}}},k=he.jsxs(he.Fragment,{children:[he.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t&&he.jsx(fn.h3,{className:"text-xl font-semibold text-blue-100 drop-shadow-[0_0_8px_rgba(0,200,255,0.4)]",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:t}),he.jsx(fn.button,{onClick:v,className:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-500/20 border border-blue-400/30 text-blue-100 backdrop-blur-sm hover:bg-blue-500/30 hover:scale-110 transition-all shadow-[0_0_15px_rgba(0,150,255,0.3)]",whileTap:{scale:.9},initial:{opacity:0,rotate:-180},animate:{opacity:1,rotate:0},transition:{duration:.5,delay:.4},children:a?he.jsx(U4,{className:"w-5 h-5"}):he.jsx(V4,{className:"w-5 h-5"})})]}),he.jsx(fn.div,{className:"text-blue-100/90 leading-relaxed text-lg space-y-2",variants:E,initial:"hidden",animate:"visible",children:e||n})]});return o?he.jsxs(fn.div,{className:"relative backdrop-blur-md bg-white/10 border border-blue-400/30 rounded-2xl p-6 text-blue-100 shadow-[0_0_25px_rgba(0,100,255,0.15)]",variants:A,initial:"hidden",animate:"visible",whileHover:{scale:1.02,boxShadow:"0 0 40px rgba(0,150,255,0.25)",transition:{duration:.3}},children:[k,he.jsx(fn.div,{className:"absolute inset-0 rounded-2xl pointer-events-none",animate:{boxShadow:["0 0 25px rgba(0,100,255,0.1)","0 0 50px rgba(0,150,255,0.2)","0 0 25px rgba(0,100,255,0.1)"]},transition:{duration:4,repeat:1/0,repeatType:"mirror"}})]}):he.jsx("div",{className:"text-blue-100",children:k})},K_=({title:n,contents:e,children:t})=>{const[i,o]=ye.useState(!1);return he.jsxs("span",{className:"relative inline-block cursor-pointer text-blue-300 font-semibold hover:text-blue-100 transition-colors",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[t,he.jsx(Ay,{children:i&&he.jsxs(fn.div,{className:"absolute bottom-full left-0 mb-3 z-50 w-72 bg-white/10 backdrop-blur-md border border-blue-400/30 rounded-xl shadow-[0_0_25px_rgba(0,100,255,0.2)] p-3 max-h-96 overflow-y-auto",initial:{opacity:0,y:10,x:-10,scale:.95},animate:{opacity:1,y:0,x:0,scale:1},exit:{opacity:0,y:10,x:-10,scale:.95},transition:{duration:.25,ease:[.25,.46,.45,.94]},children:[n&&he.jsx("h3",{className:"text-blue-200 font-semibold text-base mb-3",children:n}),e?.map((c,d)=>he.jsxs("div",{className:"mb-3 last:mb-0",children:[c.image&&he.jsx(fn.img,{src:c.image,alt:"tooltip visual",className:"w-full object-cover rounded-lg mb-2",initial:{opacity:.7},animate:{opacity:1},transition:{duration:.3}}),c.text&&he.jsx(Np,{textToRead:c.text,textToShow:c.text,hasBackground:!1})]},d))]})})]})},J4=()=>{const{nextSlide:n}=Hd();return he.jsxs(fn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[he.jsx(kh,{}),he.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:he.jsxs(fn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:[he.jsx(fn.img,{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/f/f1/Whale_shark_Georgia_aquarium.jpg/1920px-Whale_shark_Georgia_aquarium.jpg",alt:"Shark",className:"mt-12 mb-8 h-64 md:h-80 object-cover rounded-lg shadow-lg mt-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:1.2,delay:.3}}),he.jsx(Np,{textToRead:"Sharks are a highly diverse group, comprising more than 500 species. They belong to the class Chondrichthyes, a group of fishes characterized by skeletons made primarily of cartilage. This class is divided into two subclasses: Elasmobranchii which includes sharks, skates, rays, and sawfishes and Holocephali, chimaeras, known informally as ghost sharks.",textToShow:he.jsxs(he.Fragment,{children:["Sharks are a highly diverse group, comprising more than 500 species. They belong to the class Chondrichthyes, a group of fishes characterized by skeletons made primarily of cartilage. This class is divided into two subclasses:"," ",he.jsx(K_,{title:"Elasmobranchii",contents:[{image:void 0,text:"Examples of animals that belong to the subclass *Elasmobranchii*, besides sharks, include rays, skates, and sawfishes."},{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/f/f5/Raya_pel%C3%A1gica_%28Pteroplatytrygon_violacea%29%2C_Cabo_de_Palos%2C_Espa%C3%B1a%2C_2022-07-16%2C_DD_69.jpg/1920px-Raya_pel%C3%A1gica_%28Pteroplatytrygon_violacea%29%2C_Cabo_de_Palos%2C_Espa%C3%B1a%2C_2022-07-16%2C_DD_69.jpg",text:"Rays are the largest group of cartilaginous fishes, with around 600 known species. Most of them live on the sea floor, although some inhabit the open ocean, and a few species can also be found in freshwater environments."},{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/Amblyraja_hyperborea1.jpg/960px-Amblyraja_hyperborea1.jpg",text:"Skates comprise about 150 species. They possess an electric organ in their tails that produces a weak shock, which researchers believe may play a role in reproduction."},{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Sawfish_Pristis_zijsron_Genova_Aquarium.jpg/1024px-Sawfish_Pristis_zijsron_Genova_Aquarium.jpg",text:"Sawfishes are a distinct group of cartilaginous fishes, characterized by a long snout lined with sharp teeth. Today, only five species remain, and all of them are critically endangered due to human activities."}],children:"Elasmobranchii"}),"(which includes sharks, skates, rays, and sawfishes) and"," ",he.jsx(K_,{title:"Holocephali",contents:[{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/32/Deep_sea_chimaera.jpg/330px-Deep_sea_chimaera.jpg",text:"Chimaeras are the only living representatives of the subclass *Holocephali*. Their lineage dates back nearly 400 million years. Today, about 50 species are known. They are characterized by bulky heads, long tapered tails, and can reach lengths of up to 150 cm. Chimaeras inhabit deep environments, often found at depths greater than 2,000 meters."}],children:"Holocephali"})," ","(chimaeras, known informally as ghost sharks)."]})})]})}),he.jsx("div",{className:"absolute bottom-8 right-8 flex justify-end z-20",children:he.jsx(Zd,{onClick:n,children:"Next"})})]})},Q4=()=>{const{prevSlide:n}=Hd();return he.jsxs(fn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[he.jsx(kh,{}),he.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:he.jsxs(fn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:[he.jsx(fn.img,{src:"https://freerangestock.com/sample/130101/shark-in-sea.jpg",alt:"Sharks in ocean",className:"w-full h-80 object-cover rounded-lg mb-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.3}}),he.jsx(Np,{textToRead:"Sharks inhabit a wide variety of environments, ranging from marine to freshwater ecosystems. Although they are often perceived as apex predators, their ecological diversity is much broader. Adult body sizes range from about 20 cm to over 18 m, allowing them to occupy distinct ecological niches. Consequently, their feeding strategies vary widely: some species are parasites, others are small predators feeding on invertebrates, while the largest species prey on marine mammals and large fishes.",textToShow:he.jsxs(he.Fragment,{children:["Sharks inhabit a wide variety of environments, ranging from marine to freshwater ecosystems. Although they are often perceived as"," ",he.jsx(K_,{title:"Apex Predator",contents:[{image:"https://upload.wikimedia.org/wikipedia/commons/5/56/White_shark.jpg",text:"Apex predators are animals that have no natural predators and occupy the highest position in the trophic chain. A well-known example is the great white shark (Carcharodon carcharias). By keeping populations of lower trophic levels under control (a process known as top-down regulation), apex predators prevent excessive population growth and thus contribute to maintaining ecological balance."}],children:"apex predators"}),", their ecological diversity is much broader. Adult body sizes range from about 20 cm to over 18 m, allowing them to occupy distinct"," ",he.jsx(K_,{title:"Ecological Niches",contents:[{image:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c2/Ifugao_-_2.jpg/1920px-Ifugao_-_2.jpg",text:"An ecological niche is defined as the set of roles and functions a species performs within its environment. It involves the interaction of abiotic conditions, ecological relationships, and the species' role, encompassing its distribution, sources of resources, and contributions to biodiversity and ecological stability."}],children:"ecological niches"}),". Consequently, their feeding strategies vary widely: some species are parasites, others are small predators feeding on invertebrates, while the largest species prey on marine mammals and large fishes."]})})]})}),he.jsx("div",{className:"bottom-8 left-0 right-0 flex w-full justify-between px-8 z-20 mb-8",children:he.jsx(Zd,{onClick:n,children:"Back"})})]})},eL=()=>he.jsxs(My,{children:[he.jsx(J4,{}),he.jsx(Q4,{})]}),tL=()=>{const{prevSlide:n}=Hd();return he.jsxs(fn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[he.jsx(kh,{}),he.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:he.jsxs(fn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:[he.jsx(fn.img,{src:"https://upload.wikimedia.org/wikipedia/commons/8/8a/Surfacing_great_white_shark.jpg",alt:"Sharks in ocean",className:"w-full h-72 object-cover rounded-lg mb-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.3}}),he.jsx(Np,{textToRead:`Sharks are apex predators that balance marine ecosystems by controlling \r
            fish populations and maintaining the delicate food chain that keeps our \r
            oceans healthy.`})]})}),he.jsx("div",{className:"bottom-8 left-0 right-0 flex w-full justify-end px-8 z-20 mb-8",children:he.jsx(Zd,{onClick:n,children:"Back"})})]})},nL=()=>he.jsx(My,{children:he.jsx(tL,{})}),iL=()=>{const{nextSlide:n}=Hd();return he.jsxs(fn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[he.jsx(kh,{}),he.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:he.jsxs(fn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:[he.jsx(fn.img,{src:"https://upload.wikimedia.org/wikipedia/commons/3/39/Tiger_shark.jpg",alt:"Sharks in ocean",className:"w-full h-56 object-cover rounded-lg mb-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.3}}),he.jsx(Np,{textToRead:"Beyond movies and folklore, sharks are vital actors in oceanic ecosystems. Some of these species, such as the Great White Shark and the Tiger Shark, are apex predators that play a crucial role as keystone species. A keystone species is define as an organism that has a disproportionately large effect on its environment relative to its abundance, essentially holding an ecosystem together. In other words, even with relatively low populations compared to other animals, keystone species play a critical role in regulating the populations of other species. Their disappearance can trigger a collapse in the food chain, causing significant imbalances in the ecosystem."})]})}),he.jsx("div",{className:"absolute bottom-8 right-8 flex justify-end z-20",children:he.jsx(Zd,{onClick:n,children:"Next"})})]})},rL=()=>{const{prevSlide:n}=Hd();return he.jsxs(fn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[he.jsx(kh,{}),he.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:he.jsx(fn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:he.jsx(fn.img,{src:"https://upload.wikimedia.org/wikipedia/commons/b/b8/Seagrass_trophic_facilitations.jpg",alt:"Sharks in ocean",className:"w-full object-cover rounded-lg mb-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.3}})})}),he.jsx("div",{className:"bottom-8 left-0 right-0 flex w-full justify-between px-8 z-20 mb-8",children:he.jsx(Zd,{onClick:n,children:"Back"})})]})},sL=()=>he.jsxs(My,{children:[he.jsx(iL,{}),he.jsx(rL,{})]}),oL=()=>{const{nextSlide:n}=Hd();return he.jsxs(fn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[he.jsx(kh,{}),he.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:he.jsxs(fn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:[he.jsx(fn.img,{src:"https://upload.wikimedia.org/wikipedia/commons/a/a1/Male_whale_shark_at_Georgia_Aquarium.jpg",alt:"Sharks in ocean",className:"w-full object-cover rounded-lg mb-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.3}}),he.jsx(Np,{textToRead:"More than 65% of shark species are in danger of extinction due to overfishing, habitat loss, ocean pollution and climate change. Considering their importance in our ecossystems, we must protect "})]})}),he.jsx("div",{className:"bottom-8 left-0 right-0 flex w-full justify-end px-8 z-20 mb-8",children:he.jsx(Zd,{onClick:n,children:"Next"})})]})},aL=()=>{const{prevSlide:n}=Hd();return he.jsxs(fn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[he.jsx(kh,{}),he.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:he.jsx(fn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:he.jsx(fn.img,{src:"src/assets/shark-importance.webp",alt:"Sharks in ocean",className:"w-full object-cover rounded-lg mb-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.3}})})}),he.jsx("div",{className:"bottom-8 left-0 right-0 flex w-full justify-between px-8 z-20 mb-8",children:he.jsx(Zd,{onClick:n,children:"Back"})})]})},lL=()=>he.jsxs(My,{children:[he.jsx(oL,{}),he.jsx(aL,{})]}),cL=n=>{const[e,t]=ye.useState(!1),[i,o]=ye.useState([{name:"What are Sharks",image:"https://upload.wikimedia.org/wikipedia/commons/5/56/White_shark.jpg",description:"Learn about shark biology, behavior, and characteristics.",selected:!1},{name:"Importance of Sharks as keystone species",image:"https://upload.wikimedia.org/wikipedia/commons/3/39/Tiger_shark.jpg",description:"Discover the importance of shark conservation efforts.",selected:!1},{name:"Sharks in the Food Chain",image:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Surfacing_great_white_shark.jpg/1024px-Surfacing_great_white_shark.jpg",description:"Explore sharks' crucial role in marine ecosystems.",selected:!1},{name:"Sharks are in Danger",image:"https://upload.wikimedia.org/wikipedia/commons/a/a1/Male_whale_shark_at_Georgia_Aquarium.jpg",description:"Learn about threats facing shark populations worldwide.",selected:!1}]),c=ye.useCallback(()=>{t(!e)},[e]),d=ye.useCallback(a=>{const v=i[a];switch(console.log(`${v.name} button clicked`),v.name){case"What are Sharks":n(he.jsx(eL,{}));break;case"Importance of Sharks as keystone species":n(he.jsx(sL,{}));break;case"Sharks in the Food Chain":n(he.jsx(nL,{}));break;case"Sharks are in Danger":n(he.jsx(lL,{}));break;default:n(he.jsx("div",{children:"Default Component"}))}o(A=>A.map((E,k)=>({...E,selected:k===a})))},[i,n]);return{handleStoriesClick:c,handleItemClick:d,openMenu:e,knowledgeOptions:i}},uL=({setChildren:n})=>{const{handleItemClick:e,knowledgeOptions:t}=cL(n),i=[iP,M4,W4,F4];return he.jsxs("div",{className:"relative min-h-screen flex flex-col",children:[he.jsx(kh,{}),he.jsxs("div",{className:"relative z-10 flex-1 p-10 flex flex-col",children:[he.jsx(fn.h2,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-5xl md:text-4xl font-bold text-center m-8 bg-gradient-to-r from-blue-100 via-white/80 to-teal-200 bg-clip-text text-transparent drop-shadow-xl",children:"What would you like to explore?"}),he.jsx("div",{className:"flex-1 flex items-center justify-center",children:he.jsx("div",{className:"w-full max-w-5xl grid grid-cols-1 md:grid-cols-2 gap-8",children:t.map((o,c)=>{const d=i[c%i.length];return he.jsxs(fn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:c*.1},whileHover:{y:-6},onClick:()=>e(c),className:`
                    relative cursor-pointer group overflow-hidden
                    rounded-2xl border backdrop-blur-md
                    transition-all duration-500 ease-out shadow-lg flex
                    min-h-[220px]
                    ${o.selected?"bg-cyan-500/20 border-cyan-300/40 shadow-cyan-500/30":"bg-white/5 border-white/10 hover:bg-white/10"}
                  `,children:[he.jsx(fn.div,{className:"w-1/2 h-full overflow-hidden",children:he.jsx(fn.img,{src:o.image||"/placeholder.jpg",alt:o.name,className:"object-cover w-full h-full brightness-75 group-hover:brightness-100 transition-all duration-700 ease-out",whileHover:{scale:1.1}})}),he.jsxs("div",{className:"w-1/2 p-6 flex flex-col justify-center",children:[he.jsx(d,{className:"w-8 h-8 text-cyan-300 mb-3 transition-all duration-300 group-hover:scale-110"}),he.jsx(fn.h3,{className:"text-xl font-semibold text-white mb-2",whileHover:{color:"#A5F3FC"},children:o.name}),he.jsx("p",{className:"text-sm text-white/70 leading-relaxed",children:o.description||"Dive into fascinating data stories about the deep sea, marine life, and more."})]}),o.selected&&he.jsx(fn.div,{layoutId:"selectedStoryGlow",className:"absolute inset-0 rounded-2xl border-2 border-cyan-300/60 shadow-[0_0_25px_rgba(34,211,238,0.3)] pointer-events-none"})]},c)})})})]})]})},E2=({setChildren:n})=>{const e=()=>{n(he.jsx(uL,{setChildren:n}))};return he.jsx("div",{className:"flex flex-col w-full",children:he.jsxs("button",{onClick:e,className:"flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800/60 transition-colors",children:[he.jsx(iP,{size:22,className:"text-neutral-100"}),he.jsx("span",{className:"font-semibold text-neutral-100 tracking-wide",children:"Knowledge Hub"})]})})},hL=()=>he.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-blue-800/40 cursor-pointer",children:[he.jsx(E4,{size:20}),he.jsx("span",{className:"font-medium",children:"How We Predict Shark Movement"})]}),gh=new Map;let Md=!1;function P2(n){Md=!!n}function qf(n){const{id:e,x:t,y:i,size:o=120,color:c="rgba(59,130,246,0.9)",duration:d=1.6,repeat:a="infinite"}=n,v=e??`${t}:${i}:${o}:${c}`;if(gh.has(v)){const Y=gh.get(v);try{const ue=Y.container.querySelector(".pulse-halo-ring");ue&&ue.parentElement&&ue.parentElement.removeChild(ue);const ve=document.createElement("div");ve.className="pulse-halo-ring",ve.style.boxShadow=`0 0 0 2px ${c}`,ve.style.animation=`pulse-halo-simple ${d}s 0s ${a}`;const se=document.createElement("div");se.className="pulse-halo-fill",se.style.background="rgba(255,255,255,0.04)",Y.container.appendChild(ve),Y.container.appendChild(se)}catch{}Y.refCount+=1;let ne=!1;return{destroy(){if(!ne&&(ne=!0,Y.refCount-=1,Y.refCount<=0)){try{Y.container.parentElement&&Y.container.parentElement.removeChild(Y.container)}catch{}gh.delete(v)}}}}const A=document.createElement("div");A.style.position="fixed",A.style.left=typeof t=="number"?`${t}px`:t,A.style.top=typeof i=="number"?`${i}px`:i,A.style.width=`${o}px`,A.style.height=`${o}px`,A.style.pointerEvents="none",A.style.transform="translate(-50%, -50%)",A.style.zIndex="3000";const E="pulse-halo-styles";if(!document.getElementById(E)){const Y=document.createElement("style");Y.id=E,Y.innerHTML=`
      @keyframes pulse-halo-simple {
        0% { transform: translate(-50%, -50%) scale(0.6); opacity: 0.9; }
        60% { transform: translate(-50%, -50%) scale(1.05); opacity: 0.38; }
        100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
      }
      .pulse-halo-ring {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 100%;
        height: 100%;
        border-radius: 9999px;
        transform-origin: center;
        background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.06), rgba(0,0,0,0));
        pointer-events: none;
      }
      .pulse-halo-fill {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 70%;
        height: 70%;
        transform: translate(-50%, -50%);
        border-radius: 9999px;
        pointer-events: none;
        mix-blend-mode: screen;
        filter: blur(6px);
        background: rgba(255,255,255,0.04);
      }
    `,document.head.appendChild(Y)}const k=document.createElement("div");k.className="pulse-halo-ring",k.style.boxShadow=`0 0 0 2px ${c}`,k.style.animation=`pulse-halo-simple ${d}s 0s ${a}`;const L=document.createElement("div");L.className="pulse-halo-fill",L.style.background="rgba(255,255,255,0.04)",A.appendChild(k),A.appendChild(L),document.body.appendChild(A);const z=Date.now();gh.set(v,{container:A,refCount:1,createdAt:z}),Md&&console.debug("[pulseHalo] create",{key:v,x:t,y:i,size:o,color:c,duration:d,now:z,stack:new Error().stack});let q=!1;return{destroy(){if(q)return;q=!0;const Y=gh.get(v);if(Y){if(Y.refCount-=1,Md&&console.debug("[pulseHalo] destroy called",{key:v,refCount:Y.refCount}),Y.refCount<=0){try{A.parentElement&&A.parentElement.removeChild(A)}catch{}gh.delete(v),Md&&console.debug("[pulseHalo] removed",{key:v})}}else{try{A.parentElement&&A.parentElement.removeChild(A)}catch{}Md&&console.debug("[pulseHalo] removed (no registry entry)",{key:v})}}}}function dL(){try{for(const[n,e]of Array.from(gh.entries())){try{e.container.parentElement&&e.container.parentElement.removeChild(e.container)}catch{}gh.delete(n),Md&&console.debug("[pulseHalo] clearAll removed",{key:n})}}catch(n){Md&&console.debug("[pulseHalo] clearAll error",n)}}const fL={"top-right":"top-4 right-4","top-left":"top-4 left-4","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4",center:"inset-0 flex items-center justify-center","center-left":"inset-y-0 left-4 flex items-center","center-right":"inset-y-0 right-4 flex items-center"};function pL({slides:n,onClose:e}){const[t,i]=ye.useState(0),o=n[t],c=ye.useContext(lP),[d,a]=ye.useState(null),v=ye.useRef(null),A=ye.useRef({});if(!o)return null;const E=o.position||"center",k=`fixed ${fL[E]}`;ye.useEffect(()=>{const z=document.createElement("div");return document.body.appendChild(z),a(z),()=>{try{document.body.removeChild(z)}catch{}a(null)}},[]);const L=he.jsx(Ay,{children:he.jsxs(he.Fragment,{children:[he.jsx(fn.div,{className:"fixed inset-0 bg-black/50 pointer-events-none",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}},"backdrop"),he.jsx("div",{className:`${k} pointer-events-none`,style:{zIndex:2e3},children:he.jsxs(fn.div,{initial:{opacity:0,y:8,scale:.995},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-8,scale:.995},transition:{duration:.28,ease:"easeOut"},className:"max-w-md w-full bg-white/5 backdrop-blur-md border border-white/10 rounded-lg p-4 text-white shadow-xl",style:{maxHeight:"70vh",overflow:"hidden",pointerEvents:"auto"},children:[he.jsxs("div",{className:"flex items-start justify-between gap-4",children:[he.jsxs("div",{className:"flex-1 min-w-0",children:[he.jsx("h3",{className:"text-lg font-semibold",children:o.title}),he.jsx("div",{className:"mt-2 text-md opacity-90 max-h-[55vh] overflow-auto",children:he.jsx("div",{style:{whiteSpace:"pre-wrap"},children:o.text})})]}),he.jsx("div",{className:"flex flex-col items-end gap-2",children:he.jsx("button",{"aria-label":"close slides",onClick:()=>{e?.()},className:"text-sm text-white/80 hover:text-white border border-white rounded-full",children:he.jsx(rP,{className:"w-5 h-5 "})})})]}),he.jsxs("div",{className:"flex items-center justify-between mt-4",children:[he.jsxs("div",{className:"flex gap-2",children:[he.jsx("button",{onClick:()=>i(z=>Math.max(0,z-1)),disabled:t===0,className:"px-3 py-1 rounded bg-white/6 disabled:opacity-40",children:"Back"}),he.jsx("button",{onClick:()=>i(z=>Math.min(n.length-1,z+1)),disabled:t===n.length-1,className:"px-3 py-1 rounded bg-white/6 disabled:opacity-40",children:"Next"})]}),he.jsx("div",{})]})]},"panel")})]})});return ye.useEffect(()=>{if(v.current){try{v.current()}catch{}v.current=null}try{dL()}catch{}if(o){if(c&&typeof c.openTab=="function"&&Object.prototype.hasOwnProperty.call(o,"sidebarTab"))try{console.debug("[Slides] requesting openTab",o.sidebarTab),c.openTab(o.sidebarTab)}catch{}if(o.action){const z=Date.now(),q=A.current[t]??0;if(z-q<500)return;A.current[t]=z;try{P2(!0);const Y=o.action();if(typeof Y=="function")v.current=Y;else if(Y!=null&&typeof Y.destroy=="function"){const ne=Y;v.current=()=>ne.destroy()}}catch(Y){console.debug("slide action error",Y)}finally{setTimeout(()=>P2(!1),1200)}}return()=>{if(v.current){try{v.current()}catch{}v.current=null}}}},[t,n]),d?Dx.createPortal(L,d):null}const mL=[{title:"Welcome",text:"We designed this tool to predict where it is most (and least) likely for sharks to be given a list of variables, including time period, ocean depth, and phytoplankton presence.",position:"center",sidebarTab:null},{title:"Introduction",text:`Shark Seer uses the XGBoost (eXtreme Gradient Boosting) machine learning algorithm to create a mathematical framework that uses publicly available data to predict the percentage chance of shark presence in regions of the Atlantic Ocean. It was trained on the following variables:

- Location (latitude and longitude)
- Ocean depth
- Time
- Phytoplankton
- Wave height, period, and direction
- Temperature
- Shark sightings

Take a look at our sources in the *NASA Space Apps Challenge website*.`,position:"center"},{title:"Inputs",text:"Our model receives as input a location, some depth, and some time period and outputs a probability of there being sharks in that location, in that depth and at that time. You can choose the time and depth with these scales.",position:"center-right",actionLabel:"Highlight toggle",action:()=>{const n=qf({id:"sharkmap-depth-range",x:"94%",y:"80%",size:140,color:"rgba(99,102,241,0.9)",duration:1.4}),e=qf({id:"sharkmap-year-range",x:"55%",y:"94%",size:140,color:"rgba(99,102,241,0.9)",duration:1.4});return[n,e]}},{title:"Prediction",text:"The output probability is presented on the map according to this scale.",position:"center-right"},{title:"Flags",text:"You can click on the heat spots of the map to receive detailed information about them.",position:"center-right"},{title:"Map Overlays",text:"You can overlay the map with the other variables we trained. Open the shark map tab and try clicking on the phytoplankton one!",position:"center-right",sidebarTab:"sharkmap",action:()=>qf({id:"sharkmap-accessibility-toggle",x:"5%",y:"8%",size:140,color:"rgba(99,102,241,0.9)",duration:1.4})},{title:"Map Overlays",text:"Notice how the map changes. This is due to the data from the overlay, whose scale is shown in the sidebar  in this case, phytoplankton presence.",position:"center-right",action:()=>qf({id:"sharkmap-accessibility-toggle",x:"5%",y:"8%",size:140,color:"rgba(99,102,241,0.9)",duration:1.4})},{title:"Options Menu",text:"In the Shark Mao section, you can also enable educational mode, colorblind mode, or aerosol mode. You can also restart this tutorial later if you need to.",position:"center-right",action:()=>qf({id:"sharkmap-accessibility-toggle",x:"5%",y:"8%",size:140,color:"rgba(99,102,241,0.9)",duration:1.4})},{title:"Our Tool",text:"This is the Our tool menu, with some information regarding our methodology. More information on the NASA Space Apps Challenge website.",position:"center-right",sidebarTab:null,action:()=>qf({id:"sharkmap-accessibility-toggle",x:"5%",y:"26%",size:140,color:"rgba(99,102,241,0.9)",duration:1.4})},{title:"End of the tutorial",text:"Thank you for using Shark Seer! We hope you find it useful and educational :)",position:"center"}],gL=()=>{const[n,e]=ye.useState(!1);return he.jsxs(he.Fragment,{children:[he.jsxs("div",{onClick:()=>e(!0),className:"flex items-center gap-3 p-2 rounded-lg hover:bg-blue-800/40 cursor-pointer",children:[he.jsx(O4,{size:20}),he.jsx("span",{className:"font-medium",children:"Tutorial"})]}),n&&he.jsx(pL,{slides:mL,onClose:()=>e(!1)})]})},_L=()=>he.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-blue-800/40 cursor-pointer",children:[he.jsx(B4,{size:20}),he.jsx("span",{className:"font-medium",children:"Meet the Team"})]}),lP=ye.createContext({openTab:()=>{}}),yL=({children:n})=>{const[e,t]=ye.useState("research"),[i,o]=ye.useState(!1),c=n&&Dd.Children.map(n,k=>Dd.isValidElement(k)?Dd.cloneElement(k,{mapMode:e,enabled:i,setEnabled:o}):k),[d,a]=ye.useState(null),[v,A]=ye.useState(null),E=k=>{console.debug("[Sidebar] openTab",k),a(k==="knowledgehub"?he.jsx(E2,{setChildren:a}):null),A(k)};return he.jsx(lP.Provider,{value:{openTab:E},children:he.jsxs("div",{className:"flex",children:[he.jsxs("aside",{className:"w-72 h-screen bg-gradient-to-b from-blue-900 to-blue-950 text-white flex flex-col items-start p-4 shadow-2xl relative overflow-hidden overflow-y-auto",children:[he.jsxs("div",{className:"flex flex-row h-fit justify-center items-center gap-3",children:[he.jsx("img",{src:"/public/sharko.png",alt:"Sharko, the Shark Seet",className:"w-20 h-20 self-center"}),he.jsx("h1",{className:"font-bold text-3xl bg-gradient-to-r from-blue-100 via-cyan-300 to-blue-200 bg-clip-text text-transparent drop-shadow-[0_0_25px_rgba(59,130,246,0.3)] flex items-center h-14",children:"Shark Seer"})]}),he.jsxs("nav",{className:"flex flex-col gap-3 w-full text-sm mt-6",children:[he.jsx("div",{onClick:()=>a(null),children:he.jsx(G4,{setMapMode:t,enabled:i,setEnabled:o,forcedOpen:v==="sharkmap"})}),he.jsx(E2,{setChildren:a}),he.jsx("div",{onClick:()=>a(null),children:he.jsx(hL,{})}),he.jsx("div",{onClick:()=>a(null),children:he.jsx(gL,{})}),he.jsx("div",{onClick:()=>a(null),children:he.jsx(_L,{})})]}),he.jsx(fn.div,{className:"absolute bottom-0 left-0 w-full h-40 bg-blue-700/30 blur-3xl rounded-t-full pointer-events-none",animate:{y:[0,-10,0],opacity:[.5,.7,.5]},transition:{duration:6,repeat:1/0}})]}),he.jsx("div",{className:"flex-1 bg-black min-h-screen",children:he.jsx(Ay,{mode:"wait",children:he.jsx(fn.div,{className:"w-full h-full",initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.22,ease:"easeOut"},children:d??c},d?"panel-custom":"panel-default")})})]})})};var L_={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.8.0/LICENSE.txt
 */var vL=L_.exports,C2;function xL(){return C2||(C2=1,(function(n,e){(function(t,i){n.exports=i()})(vL,(function(){var t={},i={};function o(d,a,v){if(i[d]=v,d==="index"){var A="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",E={};return i.shared(E),i.index(t,E),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([A],{type:"text/javascript"}))),t}}o("shared",["exports"],(function(d){function a(u,s,l,p){return new(l||(l=Promise))((function(_,b){function T(O){try{M(p.next(O))}catch(F){b(F)}}function C(O){try{M(p.throw(O))}catch(F){b(F)}}function M(O){var F;O.done?_(O.value):(F=O.value,F instanceof l?F:new l((function(j){j(F)}))).then(T,C)}M((p=p.apply(u,s||[])).next())}))}function v(u,s){this.x=u,this.y=s}function A(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var E,k;typeof SuppressedError=="function"&&SuppressedError,v.prototype={clone(){return new v(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,s){return this.clone()._rotateAround(u,s)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const s=u.x-this.x,l=u.y-this.y;return s*s+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,s){return Math.atan2(this.x*s-this.y*u,this.x*u+this.y*s)},_matMult(u){const s=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=s,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const s=Math.cos(u),l=Math.sin(u),p=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=p,this},_rotateAround(u,s){const l=Math.cos(u),p=Math.sin(u),_=s.y+p*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-p*(this.y-s.y),this.y=_,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:v},v.convert=function(u){if(u instanceof v)return u;if(Array.isArray(u))return new v(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new v(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};var L=(function(){if(k)return E;function u(s,l,p,_){this.cx=3*s,this.bx=3*(p-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(_-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=p,this.p2y=_}return k=1,E=u,u.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(l===void 0&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var p=s,_=0;_<8;_++){var b=this.sampleCurveX(p)-s;if(Math.abs(b)<l)return p;var T=this.sampleCurveDerivativeX(p);if(Math.abs(T)<1e-6)break;p-=b/T}var C=0,M=1;for(p=s,_=0;_<20&&(b=this.sampleCurveX(p),!(Math.abs(b-s)<l));_++)s>b?C=p:M=p,p=.5*(M-C)+C;return p},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},E})(),z=A(L);let q,Y;function ne(){return q==null&&(q=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),q}function ue(){if(Y==null&&(Y=!1,ne())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let p=0;p<25;p++){const _=4*p;s.fillStyle=`rgb(${_},${_+1},${_+2})`,s.fillRect(p%5,Math.floor(p/5),1,1)}const l=s.getImageData(0,0,5,5).data;for(let p=0;p<100;p++)if(p%4!=3&&l[p]!==p){Y=!0;break}}}return Y||!1}var ve=1e-6,se=typeof Float32Array<"u"?Float32Array:Array;function Se(){var u=new se(9);return se!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function Ne(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function nt(){var u=new se(3);return se!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function dt(u){var s=u[0],l=u[1],p=u[2];return Math.sqrt(s*s+l*l+p*p)}function gt(u,s,l){var p=new se(3);return p[0]=u,p[1]=s,p[2]=l,p}function vt(u,s,l){return u[0]=s[0]+l[0],u[1]=s[1]+l[1],u[2]=s[2]+l[2],u}function Ft(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u[2]=s[2]*l,u}function Wt(u,s,l){var p=s[0],_=s[1],b=s[2],T=l[0],C=l[1],M=l[2];return u[0]=_*M-b*C,u[1]=b*T-p*M,u[2]=p*C-_*T,u}var pn,sn=dt;function rn(u,s,l){var p=s[0],_=s[1],b=s[2],T=s[3];return u[0]=l[0]*p+l[4]*_+l[8]*b+l[12]*T,u[1]=l[1]*p+l[5]*_+l[9]*b+l[13]*T,u[2]=l[2]*p+l[6]*_+l[10]*b+l[14]*T,u[3]=l[3]*p+l[7]*_+l[11]*b+l[15]*T,u}function kn(){var u=new se(4);return se!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Pe(u,s,l,p){var _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",b=Math.PI/360;s*=b,p*=b,l*=b;var T=Math.sin(s),C=Math.cos(s),M=Math.sin(l),O=Math.cos(l),F=Math.sin(p),j=Math.cos(p);switch(_){case"xyz":u[0]=T*O*j+C*M*F,u[1]=C*M*j-T*O*F,u[2]=C*O*F+T*M*j,u[3]=C*O*j-T*M*F;break;case"xzy":u[0]=T*O*j-C*M*F,u[1]=C*M*j-T*O*F,u[2]=C*O*F+T*M*j,u[3]=C*O*j+T*M*F;break;case"yxz":u[0]=T*O*j+C*M*F,u[1]=C*M*j-T*O*F,u[2]=C*O*F-T*M*j,u[3]=C*O*j+T*M*F;break;case"yzx":u[0]=T*O*j+C*M*F,u[1]=C*M*j+T*O*F,u[2]=C*O*F-T*M*j,u[3]=C*O*j-T*M*F;break;case"zxy":u[0]=T*O*j-C*M*F,u[1]=C*M*j+T*O*F,u[2]=C*O*F+T*M*j,u[3]=C*O*j-T*M*F;break;case"zyx":u[0]=T*O*j-C*M*F,u[1]=C*M*j+T*O*F,u[2]=C*O*F-T*M*j,u[3]=C*O*j+T*M*F;break;default:throw new Error("Unknown angle order "+_)}return u}function ke(){var u=new se(2);return se!=Float32Array&&(u[0]=0,u[1]=0),u}function ge(u,s){var l=new se(2);return l[0]=u,l[1]=s,l}nt(),pn=new se(4),se!=Float32Array&&(pn[0]=0,pn[1]=0,pn[2]=0,pn[3]=0),nt(),gt(1,0,0),gt(0,1,0),kn(),kn(),Se(),ke();const Ue=8192;function $e(u,s,l){return s*(Ue/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}function de(u,s){return(u%s+s)%s}function De(u,s,l){return u*(1-l)+s*l}function ut(u){if(u<=0)return 0;if(u>=1)return 1;const s=u*u,l=s*u;return 4*(u<.5?l:3*(u-s)+l-.75)}function Et(u,s,l,p){const _=new z(u,s,l,p);return b=>_.solve(b)}const It=Et(.25,.1,.25,1);function $t(u,s,l){return Math.min(l,Math.max(s,u))}function Qt(u,s,l){const p=l-s,_=((u-s)%p+p)%p+s;return _===s?l:_}function Ut(u,...s){for(const l of s)for(const p in l)u[p]=l[p];return u}let an=1;function _n(u,s,l){const p={};for(const _ in u)p[_]=s.call(this,u[_],_,u);return p}function Gi(u,s,l){const p={};for(const _ in u)s.call(this,u[_],_,u)&&(p[_]=u[_]);return p}function Ii(u){return Array.isArray(u)?u.map(Ii):typeof u=="object"&&u?_n(u,Ii):u}const Hn={};function ri(u){Hn[u]||(typeof console<"u"&&console.warn(u),Hn[u]=!0)}function xt(u,s,l){return(l.y-u.y)*(s.x-u.x)>(s.y-u.y)*(l.x-u.x)}function Pt(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let Yt=null;function Sn(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Nn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Yn(u,s,l,p,_){return a(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(u,{timestamp:0});try{const T=b?.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const C=T.startsWith("BGR"),M=new Uint8ClampedArray(p*_*4);if(yield b.copyTo(M,(function(O,F,j,H,X){const G=4*Math.max(-F,0),te=(Math.max(0,j)-j)*H*4+G,oe=4*H,me=Math.max(0,F),je=Math.max(0,j);return{rect:{x:me,y:je,width:Math.min(O.width,F+H)-me,height:Math.min(O.height,j+X)-je},layout:[{offset:te,stride:oe}]}})(u,s,l,p,_)),C)for(let O=0;O<M.length;O+=4){const F=M[O];M[O]=M[O+2],M[O+2]=F}return M}finally{b.close()}}))}let yi,hs;function Es(u,s,l,p){return u.addEventListener(s,l,p),{unsubscribe:()=>{u.removeEventListener(s,l,p)}}}function ds(u){return u*Math.PI/180}function Kr(u){return u/Math.PI*180}const Zs={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Jr={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ps="AbortError";function Le(){return new Error(Ps)}const K={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function J(u){return K.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const ie="global-dispatcher";class we extends Error{constructor(s,l,p,_){super(`AJAXError: ${l} (${s}): ${p}`),this.status=s,this.statusText=l,this.url=p,this.body=_}}const Ce=()=>Pt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Fe=function(u,s){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const p=J(u.url);if(p)return p(u,s);if(Pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:ie},s)}if(!(/^file:/.test(l=u.url)||/^file:/.test(Ce())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(p,_){return a(this,void 0,void 0,(function*(){const b=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:Ce(),signal:_.signal});let T,C;p.type!=="json"||b.headers.has("Accept")||b.headers.set("Accept","application/json");try{T=yield fetch(b)}catch(O){throw new we(0,O.message,p.url,new Blob)}if(!T.ok){const O=yield T.blob();throw new we(T.status,T.statusText,p.url,O)}C=p.type==="arrayBuffer"||p.type==="image"?T.arrayBuffer():p.type==="json"?T.json():T.text();const M=yield C;if(_.signal.aborted)throw Le();return{data:M,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}}))})(u,s);if(Pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:ie},s)}var l;return(function(p,_){return new Promise(((b,T)=>{var C;const M=new XMLHttpRequest;M.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(M.responseType="arraybuffer");for(const O in p.headers)M.setRequestHeader(O,p.headers[O]);p.type==="json"&&(M.responseType="text",!((C=p.headers)===null||C===void 0)&&C.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=p.credentials==="include",M.onerror=()=>{T(new Error(M.statusText))},M.onload=()=>{if(!_.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let O=M.response;if(p.type==="json")try{O=JSON.parse(M.response)}catch(F){return void T(F)}b({data:O,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const O=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});T(new we(M.status,M.statusText,p.url,O))}},_.signal.addEventListener("abort",(()=>{M.abort(),T(Le())})),M.send(p.body)}))})(u,s)};function Ke(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const s=new URL(u),l=window.location;return s.protocol===l.protocol&&s.host===l.host}function ze(u,s,l){l[u]&&l[u].indexOf(s)!==-1||(l[u]=l[u]||[],l[u].push(s))}function rt(u,s,l){if(l&&l[u]){const p=l[u].indexOf(s);p!==-1&&l[u].splice(p,1)}}class mt{constructor(s,l={}){Ut(this,l),this.type=s}}class at extends mt{constructor(s,l={}){super("error",Ut({error:s},l))}}class zt{on(s,l){return this._listeners=this._listeners||{},ze(s,l,this._listeners),{unsubscribe:()=>{this.off(s,l)}}}off(s,l){return rt(s,l,this._listeners),rt(s,l,this._oneTimeListeners),this}once(s,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},ze(s,l,this._oneTimeListeners),this):new Promise((p=>this.once(s,p)))}fire(s,l){typeof s=="string"&&(s=new mt(s,l||{}));const p=s.type;if(this.listens(p)){s.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const C of _)C.call(this,s);const b=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const C of b)rt(p,C,this._oneTimeListeners),C.call(this,s);const T=this._eventedParent;T&&(Ut(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(s))}else s instanceof at&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,l){return this._eventedParent=s,this._eventedParentData=l,this}}var Be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const un=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Dn(u,s){const l={};for(const p in u)p!=="ref"&&(l[p]=u[p]);return un.forEach((p=>{p in s&&(l[p]=s[p])})),l}function Xt(u,s){if(Array.isArray(u)){if(!Array.isArray(s)||u.length!==s.length)return!1;for(let l=0;l<u.length;l++)if(!Xt(u[l],s[l]))return!1;return!0}if(typeof u=="object"&&u!==null&&s!==null){if(typeof s!="object"||Object.keys(u).length!==Object.keys(s).length)return!1;for(const l in u)if(!Xt(u[l],s[l]))return!1;return!0}return u===s}function yn(u,s){u.push(s)}function ai(u,s,l){yn(l,{command:"addSource",args:[u,s[u]]})}function Ei(u,s,l){yn(s,{command:"removeSource",args:[u]}),l[u]=!0}function $i(u,s,l,p){Ei(u,l,p),ai(u,s,l)}function Pi(u,s,l){let p;for(p in u[l])if(Object.prototype.hasOwnProperty.call(u[l],p)&&p!=="data"&&!Xt(u[l][p],s[l][p]))return!1;for(p in s[l])if(Object.prototype.hasOwnProperty.call(s[l],p)&&p!=="data"&&!Xt(u[l][p],s[l][p]))return!1;return!0}function Li(u,s,l,p,_,b){u=u||{},s=s||{};for(const T in u)Object.prototype.hasOwnProperty.call(u,T)&&(Xt(u[T],s[T])||l.push({command:b,args:[p,T,s[T],_]}));for(const T in s)Object.prototype.hasOwnProperty.call(s,T)&&!Object.prototype.hasOwnProperty.call(u,T)&&(Xt(u[T],s[T])||l.push({command:b,args:[p,T,s[T],_]}))}function Kn(u){return u.id}function Fi(u,s){return u[s.id]=s,u}class lt{constructor(s,l,p,_){this.message=(s?`${s}: `:"")+p,_&&(this.identifier=_),l!=null&&l.__line__&&(this.line=l.__line__)}}function bi(u,...s){for(const l of s)for(const p in l)u[p]=l[p];return u}class xr extends Error{constructor(s,l){super(l),this.message=l,this.key=s}}class Co{constructor(s,l=[]){this.parent=s,this.bindings={};for(const[p,_]of l)this.bindings[p]=_}concat(s){return new Co(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const br={kind:"null"},wt={kind:"number"},wn={kind:"string"},mn={kind:"boolean"},tr={kind:"color"},ta={kind:"projectionDefinition"},na={kind:"object"},vn={kind:"value"},Mc={kind:"collator"},Io={kind:"formatted"},Rc={kind:"padding"},ho={kind:"colorArray"},Il={kind:"numberArray"},Pn={kind:"resolvedImage"},Ru={kind:"variableAnchorOffsetCollection"};function wr(u,s){return{kind:"array",itemType:u,N:s}}function ei(u){if(u.kind==="array"){const s=ei(u.itemType);return typeof u.N=="number"?`array<${s}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${s}>`}return u.kind}const kc=[br,wt,wn,mn,tr,ta,Io,na,wr(vn),Rc,Il,ho,Pn,Ru];function Dc(u,s){if(s.kind==="error")return null;if(u.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Dc(u.itemType,s.itemType))&&(typeof u.N!="number"||u.N===s.N))return null}else{if(u.kind===s.kind)return null;if(u.kind==="value"){for(const l of kc)if(!Dc(l,s))return null}}return`Expected ${ei(u)} but found ${ei(s)} instead.`}function ku(u,s){return s.some((l=>l.kind===u.kind))}function Xs(u,s){return s.some((l=>l==="null"?u===null:l==="array"?Array.isArray(u):l==="object"?u&&!Array.isArray(u)&&typeof u=="object":l===typeof u))}function dr(u,s){return u.kind==="array"&&s.kind==="array"?u.itemType.kind===s.itemType.kind&&typeof u.N=="number":u.kind===s.kind}const Dh=.96422,Cs=.82521,Kd=4/29,Ml=6/29,Jd=3*Ml*Ml,Du=Ml*Ml*Ml,Ou=Math.PI/180,Oc=180/Math.PI;function Rl(u){return(u%=360)<0&&(u+=360),u}function kl([u,s,l,p]){let _,b;const T=Lc((.2225045*(u=Oh(u))+.7168786*(s=Oh(s))+.0606169*(l=Oh(l)))/1);u===s&&s===l?_=b=T:(_=Lc((.4360747*u+.3850649*s+.1430804*l)/Dh),b=Lc((.0139322*u+.0971045*s+.7141733*l)/Cs));const C=116*T-16;return[C<0?0:C,500*(_-T),200*(T-b),p]}function Oh(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Lc(u){return u>Du?Math.pow(u,1/3):u/Jd+Kd}function Ba([u,s,l,p]){let _=(u+16)/116,b=isNaN(s)?_:_+s/500,T=isNaN(l)?_:_-l/200;return _=1*za(_),b=Dh*za(b),T=Cs*za(T),[Fc(3.1338561*b-1.6168667*_-.4906146*T),Fc(-.9787684*b+1.9161415*_+.033454*T),Fc(.0719453*b-.2289914*_+1.4052427*T),p]}function Fc(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function za(u){return u>Ml?u*u*u:Jd*(u-Kd)}const Up=Object.hasOwn||function(u,s){return Object.prototype.hasOwnProperty.call(u,s)};function ia(u,s){return Up(u,s)?u[s]:void 0}function Zn(u){return parseInt(u.padEnd(2,u),16)/255}function Is(u,s){return Cn(s?u/100:u,0,1)}function Cn(u,s,l){return Math.min(Math.max(s,u),l)}function Mo(u){return!u.some(Number.isNaN)}const Ro={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function fo(u,s,l){return u+l*(s-u)}function ra(u,s,l){return u.map(((p,_)=>fo(p,s[_],l)))}class An{constructor(s,l,p,_=1,b=!0){this.r=s,this.g=l,this.b=p,this.a=_,b||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[s,l,p,_]))}static parse(s){if(s instanceof An)return s;if(typeof s!="string")return;const l=(function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=ia(Ro,p);if(_){const[T,C,M]=_;return[T/255,C/255,M/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const T=p.length<6?1:2;let C=1;return[Zn(p.slice(C,C+=T)),Zn(p.slice(C,C+=T)),Zn(p.slice(C,C+=T)),Zn(p.slice(C,C+T)||"ff")]}if(p.startsWith("rgb")){const T=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[C,M,O,F,j,H,X,G,te,oe,me,je]=T,Te=[F||" ",X||" ",oe].join("");if(Te==="  "||Te==="  /"||Te===",,"||Te===",,,"){const Ie=[O,H,te].join(""),Je=Ie==="%%%"?100:Ie===""?255:0;if(Je){const st=[Cn(+M/Je,0,1),Cn(+j/Je,0,1),Cn(+G/Je,0,1),me?Is(+me,je):1];if(Mo(st))return st}}return}}const b=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[T,C,M,O,F,j,H,X,G]=b,te=[M||" ",F||" ",H].join("");if(te==="  "||te==="  /"||te===",,"||te===",,,"){const oe=[+C,Cn(+O,0,100),Cn(+j,0,100),X?Is(+X,G):1];if(Mo(oe))return(function([me,je,Te,Ie]){function Je(st){const ft=(st+me/30)%12,Ot=je*Math.min(Te,1-Te);return Te-Ot*Math.max(-1,Math.min(ft-3,9-ft,1))}return me=Rl(me),je/=100,Te/=100,[Je(0),Je(8),Je(4),Ie]})(oe)}}})(s);return l?new An(...l,!1):void 0}get rgb(){const{r:s,g:l,b:p,a:_}=this,b=_||1/0;return this.overwriteGetter("rgb",[s/b,l/b,p/b,_])}get hcl(){return this.overwriteGetter("hcl",(function(s){const[l,p,_,b]=kl(s),T=Math.sqrt(p*p+_*_);return[Math.round(1e4*T)?Rl(Math.atan2(_,p)*Oc):NaN,T,l,b]})(this.rgb))}get lab(){return this.overwriteGetter("lab",kl(this.rgb))}overwriteGetter(s,l){return Object.defineProperty(this,s,{value:l}),l}toString(){const[s,l,p,_]=this.rgb;return`rgba(${[s,l,p].map((b=>Math.round(255*b))).join(",")},${_})`}static interpolate(s,l,p,_="rgb"){switch(_){case"rgb":{const[b,T,C,M]=ra(s.rgb,l.rgb,p);return new An(b,T,C,M,!1)}case"hcl":{const[b,T,C,M]=s.hcl,[O,F,j,H]=l.hcl;let X,G;if(isNaN(b)||isNaN(O))isNaN(b)?isNaN(O)?X=NaN:(X=O,C!==1&&C!==0||(G=F)):(X=b,j!==1&&j!==0||(G=T));else{let Te=O-b;O>b&&Te>180?Te-=360:O<b&&b-O>180&&(Te+=360),X=b+p*Te}const[te,oe,me,je]=(function([Te,Ie,Je,st]){return Te=isNaN(Te)?0:Te*Ou,Ba([Je,Math.cos(Te)*Ie,Math.sin(Te)*Ie,st])})([X,G??fo(T,F,p),fo(C,j,p),fo(M,H,p)]);return new An(te,oe,me,je,!1)}case"lab":{const[b,T,C,M]=Ba(ra(s.lab,l.lab,p));return new An(b,T,C,M,!1)}}}}An.black=new An(0,0,0,1),An.white=new An(1,1,1,1),An.transparent=new An(0,0,0,0),An.red=new An(1,0,0,1);class po{constructor(s,l,p){this.sensitivity=s?l?"variant":"case":l?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,l){return this.collator.compare(s,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const qs=["bottom","center","top"];class Gs{constructor(s,l,p,_,b,T){this.text=s,this.image=l,this.scale=p,this.fontStack=_,this.textColor=b,this.verticalAlign=T}}class Mi{constructor(s){this.sections=s}static fromString(s){return new Mi([new Gs(s,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((s=>s.text.length!==0||s.image&&s.image.name.length!==0))}static factory(s){return s instanceof Mi?s:Mi.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map((s=>s.text)).join("")}}class Ri{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Ri)return s;if(typeof s=="number")return new Ri([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const l of s)if(typeof l!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new Ri(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,p){return new Ri(ra(s.values,l.values,p))}}class Yi{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Yi)return s;if(typeof s=="number")return new Yi([s]);if(Array.isArray(s)){for(const l of s)if(typeof l!="number")return;return new Yi(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,p){return new Yi(ra(s.values,l.values,p))}}class li{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof li)return s;if(typeof s=="string"){const p=An.parse(s);return p?new li([p]):void 0}if(!Array.isArray(s))return;const l=[];for(const p of s){if(typeof p!="string")return;const _=An.parse(p);if(!_)return;l.push(_)}return new li(l)}toString(){return JSON.stringify(this.values)}static interpolate(s,l,p,_="rgb"){const b=[];if(s.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${s.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let T=0;T<s.values.length;T++)b.push(An.interpolate(s.values[T],l.values[T],p,_));return new li(b)}}class si extends Error{constructor(s){super(s),this.name="RuntimeError"}toJSON(){return this.message}}const Lh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ki{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Ki)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let l=0;l<s.length;l+=2){const p=s[l],_=s[l+1];if(typeof p!="string"||!Lh.has(p)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Ki(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,p){const _=s.values,b=l.values;if(_.length!==b.length)throw new si(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${l.toString()}`);const T=[];for(let C=0;C<_.length;C+=2){if(_[C]!==b[C])throw new si(`Cannot interpolate values containing mismatched anchors. from[${C}]: ${_[C]}, to[${C}]: ${b[C]}`);T.push(_[C]);const[M,O]=_[C+1],[F,j]=b[C+1];T.push([fo(M,F,p),fo(O,j,p)])}return new Ki(T)}}class fs{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new fs({name:s,available:!1}):null}}class fr{constructor(s,l,p){this.from=s,this.to=l,this.transition=p}static interpolate(s,l,p){return new fr(s,l,p)}static parse(s){return s instanceof fr?s:Array.isArray(s)&&s.length===3&&typeof s[0]=="string"&&typeof s[1]=="string"&&typeof s[2]=="number"?new fr(s[0],s[1],s[2]):typeof s=="object"&&typeof s.from=="string"&&typeof s.to=="string"&&typeof s.transition=="number"?new fr(s.from,s.to,s.transition):typeof s=="string"?new fr(s,s,1):void 0}}function ti(u,s,l,p){return typeof u=="number"&&u>=0&&u<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,s,l,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,s,l,p]:[u,s,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sa(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof fr||u instanceof An||u instanceof po||u instanceof Mi||u instanceof Ri||u instanceof Yi||u instanceof li||u instanceof Ki||u instanceof fs)return!0;if(Array.isArray(u)){for(const s of u)if(!sa(s))return!1;return!0}if(typeof u=="object"){for(const s in u)if(!sa(u[s]))return!1;return!0}return!1}function on(u){if(u===null)return br;if(typeof u=="string")return wn;if(typeof u=="boolean")return mn;if(typeof u=="number")return wt;if(u instanceof An)return tr;if(u instanceof fr)return ta;if(u instanceof po)return Mc;if(u instanceof Mi)return Io;if(u instanceof Ri)return Rc;if(u instanceof Yi)return Il;if(u instanceof li)return ho;if(u instanceof Ki)return Ru;if(u instanceof fs)return Pn;if(Array.isArray(u)){const s=u.length;let l;for(const p of u){const _=on(p);if(l){if(l===_)continue;l=vn;break}l=_}return wr(l||vn,s)}return na}function hn(u){const s=typeof u;return u===null?"":s==="string"||s==="number"||s==="boolean"?String(u):u instanceof An||u instanceof fr||u instanceof Mi||u instanceof Ri||u instanceof Yi||u instanceof li||u instanceof Ki||u instanceof fs?u.toString():JSON.stringify(u)}class ps{constructor(s,l){this.type=s,this.value=l}static parse(s,l){if(s.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!sa(s[1]))return l.error("invalid value");const p=s[1];let _=on(p);const b=l.expectedType;return _.kind!=="array"||_.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(_=b),new ps(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const In={string:wn,number:wt,boolean:mn,object:na};class Tr{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let p,_=1;const b=s[0];if(b==="array"){let C,M;if(s.length>2){const O=s[1];if(typeof O!="string"||!(O in In)||O==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);C=In[O],_++}else C=vn;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=s[2],_++}p=wr(C,M)}else{if(!In[b])throw new Error(`Types doesn't contain name = ${b}`);p=In[b]}const T=[];for(;_<s.length;_++){const C=l.parse(s[_],_,vn);if(!C)return null;T.push(C)}return new Tr(p,T)}evaluate(s){for(let l=0;l<this.args.length;l++){const p=this.args[l].evaluate(s);if(!Dc(this.type,on(p)))return p;if(l===this.args.length-1)throw new si(`Expected value to be of type ${ei(this.type)}, but found ${ei(on(p))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every((s=>s.outputDefined()))}}const mo={"to-boolean":mn,"to-color":tr,"to-number":wt,"to-string":wn};class go{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const p=s[0];if(!mo[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&s.length!==2)return l.error("Expected one argument.");const _=mo[p],b=[];for(let T=1;T<s.length;T++){const C=l.parse(s[T],T,vn);if(!C)return null;b.push(C)}return new go(_,b)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let l,p;for(const _ of this.args){if(l=_.evaluate(s),p=null,l instanceof An)return l;if(typeof l=="string"){const b=s.parseColor(l);if(b)return b}else if(Array.isArray(l)&&(p=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:ti(l[0],l[1],l[2],l[3]),!p))return new An(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new si(p||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const p of this.args){l=p.evaluate(s);const _=Ri.parse(l);if(_)return _}throw new si(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(const p of this.args){l=p.evaluate(s);const _=Yi.parse(l);if(_)return _}throw new si(`Could not parse numberArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(const p of this.args){l=p.evaluate(s);const _=li.parse(l);if(_)return _}throw new si(`Could not parse colorArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const p of this.args){l=p.evaluate(s);const _=Ki.parse(l);if(_)return _}throw new si(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const p of this.args){if(l=p.evaluate(s),l===null)return 0;const _=Number(l);if(!isNaN(_))return _}throw new si(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Mi.fromString(hn(this.args[0].evaluate(s)));case"resolvedImage":return fs.fromString(hn(this.args[0].evaluate(s)));case"projectionDefinition":return this.args[0].evaluate(s);default:return hn(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every((s=>s.outputDefined()))}}const Dl=["Unknown","Point","LineString","Polygon"];class Ol{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Dl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let l=this._parseColorCache.get(s);return l||(l=An.parse(s),this._parseColorCache.set(s,l)),l}}class oa{constructor(s,l,p=[],_,b=new Co,T=[]){this.registry=s,this.path=p,this.key=p.map((C=>`[${C}]`)).join(""),this.scope=b,this.errors=T,this.expectedType=_,this._isConstant=l}parse(s,l,p,_,b={}){return l?this.concat(l,p,_)._parse(s,b):this._parse(s,b)}_parse(s,l){function p(_,b,T){return T==="assert"?new Tr(b,[_]):T==="coerce"?new go(b,[_]):_}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=s[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[_];if(b){let T=b.parse(s,this);if(!T)return null;if(this.expectedType){const C=this.expectedType,M=T.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||M.kind!=="value"){if(C.kind==="projectionDefinition"&&["string","array"].includes(M.kind)||["color","formatted","resolvedImage"].includes(C.kind)&&["value","string"].includes(M.kind)||["padding","numberArray"].includes(C.kind)&&["value","number","array"].includes(M.kind)||C.kind==="colorArray"&&["value","string","array"].includes(M.kind)||C.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(M.kind))T=p(T,C,l.typeAnnotation||"coerce");else if(this.checkSubtype(C,M))return null}else T=p(T,C,l.typeAnnotation||"assert")}if(!(T instanceof ps)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const C=new Ol;try{T=new ps(T.type,T.evaluate(C))}catch(M){return this.error(M.message),null}}return T}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,l,p){const _=typeof s=="number"?this.path.concat(s):this.path,b=p?this.scope.concat(p):this.scope;return new oa(this.registry,this._isConstant,_,l||null,b,this.errors)}error(s,...l){const p=`${this.key}${l.map((_=>`[${_}]`)).join("")}`;this.errors.push(new xr(p,s))}checkSubtype(s,l){const p=Dc(s,l);return p&&this.error(p),p}}class Ll{constructor(s,l){this.type=l.type,this.bindings=[].concat(s),this.result=l}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const l of this.bindings)s(l[1]);s(this.result)}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const p=[];for(let b=1;b<s.length-1;b+=2){const T=s[b];if(typeof T!="string")return l.error(`Expected string, but found ${typeof T} instead.`,b);if(/[^a-zA-Z0-9_]/.test(T))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);const C=l.parse(s[b+1],b+1);if(!C)return null;p.push([T,C])}const _=l.parse(s[s.length-1],s.length-1,l.expectedType,p);return _?new Ll(p,_):null}outputDefined(){return this.result.outputDefined()}}class Ys{constructor(s,l){this.type=l.type,this.name=s,this.boundExpression=l}static parse(s,l){if(s.length!==2||typeof s[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const p=s[1];return l.scope.has(p)?new Ys(p,l.scope.get(p)):l.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Fl{constructor(s,l,p){this.type=s,this.index=l,this.input=p}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const p=l.parse(s[1],1,wt),_=l.parse(s[2],2,wr(l.expectedType||vn));return p&&_?new Fl(_.type.itemType,p,_):null}evaluate(s){const l=this.index.evaluate(s),p=this.input.evaluate(s);if(l<0)throw new si(`Array index out of bounds: ${l} < 0.`);if(l>=p.length)throw new si(`Array index out of bounds: ${l} > ${p.length-1}.`);if(l!==Math.floor(l))throw new si(`Array index must be an integer, but found ${l} instead.`);return p[l]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class Ua{constructor(s,l){this.type=mn,this.needle=s,this.haystack=l}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const p=l.parse(s[1],1,vn),_=l.parse(s[2],2,vn);return p&&_?ku(p.type,[mn,wn,wt,br,vn])?new Ua(p,_):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ei(p.type)} instead`):null}evaluate(s){const l=this.needle.evaluate(s),p=this.haystack.evaluate(s);if(!p)return!1;if(!Xs(l,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${ei(on(l))} instead.`);if(!Xs(p,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${ei(on(p))} instead.`);return p.indexOf(l)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Ms{constructor(s,l,p){this.type=wt,this.needle=s,this.haystack=l,this.fromIndex=p}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${s.length-1} instead.`);const p=l.parse(s[1],1,vn),_=l.parse(s[2],2,vn);if(!p||!_)return null;if(!ku(p.type,[mn,wn,wt,br,vn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ei(p.type)} instead`);if(s.length===4){const b=l.parse(s[3],3,wt);return b?new Ms(p,_,b):null}return new Ms(p,_)}evaluate(s){const l=this.needle.evaluate(s),p=this.haystack.evaluate(s);if(!Xs(l,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${ei(on(l))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(s)),Xs(p,["string"])){const b=p.indexOf(l,_);return b===-1?-1:[...p.slice(0,b)].length}if(Xs(p,["array"]))return p.indexOf(l,_);throw new si(`Expected second argument to be of type array or string, but found ${ei(on(p))} instead.`)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Ni{constructor(s,l,p,_,b,T){this.inputType=s,this.type=l,this.input=p,this.cases=_,this.outputs=b,this.otherwise=T}static parse(s,l){if(s.length<5)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return l.error("Expected an even number of arguments.");let p,_;l.expectedType&&l.expectedType.kind!=="value"&&(_=l.expectedType);const b={},T=[];for(let O=2;O<s.length-1;O+=2){let F=s[O];const j=s[O+1];Array.isArray(F)||(F=[F]);const H=l.concat(O);if(F.length===0)return H.error("Expected at least one branch label.");for(const G of F){if(typeof G!="number"&&typeof G!="string")return H.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return H.error("Numeric branch labels must be integer values.");if(p){if(H.checkSubtype(p,on(G)))return null}else p=on(G);if(b[String(G)]!==void 0)return H.error("Branch labels must be unique.");b[String(G)]=T.length}const X=l.parse(j,O,_);if(!X)return null;_=_||X.type,T.push(X)}const C=l.parse(s[1],1,vn);if(!C)return null;const M=l.parse(s[s.length-1],s.length-1,_);return M?C.type.kind!=="value"&&l.concat(1).checkSubtype(p,C.type)?null:new Ni(p,_,C,b,T,M):null}evaluate(s){const l=this.input.evaluate(s);return(on(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every((s=>s.outputDefined()))&&this.otherwise.outputDefined()}}class ko{constructor(s,l,p){this.type=s,this.branches=l,this.otherwise=p}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return l.error("Expected an odd number of arguments.");let p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const _=[];for(let T=1;T<s.length-1;T+=2){const C=l.parse(s[T],T,mn);if(!C)return null;const M=l.parse(s[T+1],T+1,p);if(!M)return null;_.push([C,M]),p=p||M.type}const b=l.parse(s[s.length-1],s.length-1,p);if(!b)return null;if(!p)throw new Error("Can't infer output type");return new ko(p,_,b)}evaluate(s){for(const[l,p]of this.branches)if(l.evaluate(s))return p.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[l,p]of this.branches)s(l),s(p);s(this.otherwise)}outputDefined(){return this.branches.every((([s,l])=>l.outputDefined()))&&this.otherwise.outputDefined()}}class Nl{constructor(s,l,p,_){this.type=s,this.input=l,this.beginIndex=p,this.endIndex=_}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${s.length-1} instead.`);const p=l.parse(s[1],1,vn),_=l.parse(s[2],2,wt);if(!p||!_)return null;if(!ku(p.type,[wr(vn),wn,vn]))return l.error(`Expected first argument to be of type array or string, but found ${ei(p.type)} instead`);if(s.length===4){const b=l.parse(s[3],3,wt);return b?new Nl(p.type,p,_,b):null}return new Nl(p.type,p,_)}evaluate(s){const l=this.input.evaluate(s),p=this.beginIndex.evaluate(s);let _;if(this.endIndex&&(_=this.endIndex.evaluate(s)),Xs(l,["string"]))return[...l].slice(p,_).join("");if(Xs(l,["array"]))return l.slice(p,_);throw new si(`Expected first argument to be of type array or string, but found ${ei(on(l))} instead.`)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Ji(u,s){const l=u.length-1;let p,_,b=0,T=l,C=0;for(;b<=T;)if(C=Math.floor((b+T)/2),p=u[C],_=u[C+1],p<=s){if(C===l||s<_)return C;b=C+1}else{if(!(p>s))throw new si("Input is not a number.");T=C-1}return 0}class ci{constructor(s,l,p){this.type=s,this.input=l,this.labels=[],this.outputs=[];for(const[_,b]of p)this.labels.push(_),this.outputs.push(b)}static parse(s,l){if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");const p=l.parse(s[1],1,wt);if(!p)return null;const _=[];let b=null;l.expectedType&&l.expectedType.kind!=="value"&&(b=l.expectedType);for(let T=1;T<s.length;T+=2){const C=T===1?-1/0:s[T],M=s[T+1],O=T,F=T+1;if(typeof C!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(_.length&&_[_.length-1][0]>=C)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const j=l.parse(M,F,b);if(!j)return null;b=b||j.type,_.push([C,j])}return new ci(b,p,_)}evaluate(s){const l=this.labels,p=this.outputs;if(l.length===1)return p[0].evaluate(s);const _=this.input.evaluate(s);if(_<=l[0])return p[0].evaluate(s);const b=l.length;return _>=l[b-1]?p[b-1].evaluate(s):p[Ji(l,_)].evaluate(s)}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every((s=>s.outputDefined()))}}function Lu(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Do,Fh,Nh=(function(){if(Fh)return Do;function u(s,l,p,_){this.cx=3*s,this.bx=3*(p-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(_-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=p,this.p2y=_}return Fh=1,Do=u,u.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(l===void 0&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var p=s,_=0;_<8;_++){var b=this.sampleCurveX(p)-s;if(Math.abs(b)<l)return p;var T=this.sampleCurveDerivativeX(p);if(Math.abs(T)<1e-6)break;p-=b/T}var C=0,M=1;for(p=s,_=0;_<20&&(b=this.sampleCurveX(p),!(Math.abs(b-s)<l));_++)s>b?C=p:M=p,p=.5*(M-C)+C;return p},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},Do})(),aa=Lu(Nh);class Bi{constructor(s,l,p,_,b){this.type=s,this.operator=l,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[T,C]of b)this.labels.push(T),this.outputs.push(C)}static interpolationFactor(s,l,p,_){let b=0;if(s.name==="exponential")b=la(l,s.base,p,_);else if(s.name==="linear")b=la(l,1,p,_);else if(s.name==="cubic-bezier"){const T=s.controlPoints;b=new aa(T[0],T[1],T[2],T[3]).solve(la(l,1,p,_))}return b}static parse(s,l){let[p,_,b,...T]=s;if(!Array.isArray(_)||_.length===0)return l.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const O=_[1];if(typeof O!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:O}}else{if(_[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const O=_.slice(1);if(O.length!==4||O.some((F=>typeof F!="number"||F<0||F>1)))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:O}}}if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(b=l.parse(b,2,wt),!b)return null;const C=[];let M=null;p!=="interpolate-hcl"&&p!=="interpolate-lab"||l.expectedType==ho?l.expectedType&&l.expectedType.kind!=="value"&&(M=l.expectedType):M=tr;for(let O=0;O<T.length;O+=2){const F=T[O],j=T[O+1],H=O+3,X=O+4;if(typeof F!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(C.length&&C[C.length-1][0]>=F)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const G=l.parse(j,X,M);if(!G)return null;M=M||G.type,C.push([F,G])}return dr(M,wt)||dr(M,ta)||dr(M,tr)||dr(M,Rc)||dr(M,Il)||dr(M,ho)||dr(M,Ru)||dr(M,wr(wt))?new Bi(M,p,_,b,C):l.error(`Type ${ei(M)} is not interpolatable.`)}evaluate(s){const l=this.labels,p=this.outputs;if(l.length===1)return p[0].evaluate(s);const _=this.input.evaluate(s);if(_<=l[0])return p[0].evaluate(s);const b=l.length;if(_>=l[b-1])return p[b-1].evaluate(s);const T=Ji(l,_),C=Bi.interpolationFactor(this.interpolation,_,l[T],l[T+1]),M=p[T].evaluate(s),O=p[T+1].evaluate(s);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return fo(M,O,C);case"color":return An.interpolate(M,O,C);case"padding":return Ri.interpolate(M,O,C);case"colorArray":return li.interpolate(M,O,C);case"numberArray":return Yi.interpolate(M,O,C);case"variableAnchorOffsetCollection":return Ki.interpolate(M,O,C);case"array":return ra(M,O,C);case"projectionDefinition":return fr.interpolate(M,O,C)}case"interpolate-hcl":switch(this.type.kind){case"color":return An.interpolate(M,O,C,"hcl");case"colorArray":return li.interpolate(M,O,C,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return An.interpolate(M,O,C,"lab");case"colorArray":return li.interpolate(M,O,C,"lab")}}}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every((s=>s.outputDefined()))}}function la(u,s,l,p){const _=p-l,b=u-l;return _===0?0:s===1?b/_:(Math.pow(s,b)-1)/(Math.pow(s,_)-1)}const Ks={color:An.interpolate,number:fo,padding:Ri.interpolate,numberArray:Yi.interpolate,colorArray:li.interpolate,variableAnchorOffsetCollection:Ki.interpolate,array:ra};class Nc{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let p=null;const _=l.expectedType;_&&_.kind!=="value"&&(p=_);const b=[];for(const C of s.slice(1)){const M=l.parse(C,1+b.length,p,void 0,{typeAnnotation:"omit"});if(!M)return null;p=p||M.type,b.push(M)}if(!p)throw new Error("No output type");const T=_&&b.some((C=>Dc(_,C.type)));return new Nc(T?vn:p,b)}evaluate(s){let l,p=null,_=0;for(const b of this.args)if(_++,p=b.evaluate(s),p&&p instanceof fs&&!p.available&&(l||(l=p.name),p=null,_===this.args.length&&(p=l)),p!==null)break;return p}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every((s=>s.outputDefined()))}}function Bc(u,s){return u==="=="||u==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function zc(u,s,l,p){return p.compare(s,l)===0}function nr(u,s,l){const p=u!=="=="&&u!=="!=";return class cP{constructor(b,T,C){this.type=mn,this.lhs=b,this.rhs=T,this.collator=C,this.hasUntypedArgument=b.type.kind==="value"||T.type.kind==="value"}static parse(b,T){if(b.length!==3&&b.length!==4)return T.error("Expected two or three arguments.");const C=b[0];let M=T.parse(b[1],1,vn);if(!M)return null;if(!Bc(C,M.type))return T.concat(1).error(`"${C}" comparisons are not supported for type '${ei(M.type)}'.`);let O=T.parse(b[2],2,vn);if(!O)return null;if(!Bc(C,O.type))return T.concat(2).error(`"${C}" comparisons are not supported for type '${ei(O.type)}'.`);if(M.type.kind!==O.type.kind&&M.type.kind!=="value"&&O.type.kind!=="value")return T.error(`Cannot compare types '${ei(M.type)}' and '${ei(O.type)}'.`);p&&(M.type.kind==="value"&&O.type.kind!=="value"?M=new Tr(O.type,[M]):M.type.kind!=="value"&&O.type.kind==="value"&&(O=new Tr(M.type,[O])));let F=null;if(b.length===4){if(M.type.kind!=="string"&&O.type.kind!=="string"&&M.type.kind!=="value"&&O.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(F=T.parse(b[3],3,Mc),!F)return null}return new cP(M,O,F)}evaluate(b){const T=this.lhs.evaluate(b),C=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){const M=on(T),O=on(C);if(M.kind!==O.kind||M.kind!=="string"&&M.kind!=="number")throw new si(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${M.kind}, ${O.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const M=on(T),O=on(C);if(M.kind!=="string"||O.kind!=="string")return s(b,T,C)}return this.collator?l(b,T,C,this.collator.evaluate(b)):s(b,T,C)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const Qd=nr("==",(function(u,s,l){return s===l}),zc),Fu=nr("!=",(function(u,s,l){return s!==l}),(function(u,s,l,p){return!zc(0,s,l,p)})),jp=nr("<",(function(u,s,l){return s<l}),(function(u,s,l,p){return p.compare(s,l)<0})),Bh=nr(">",(function(u,s,l){return s>l}),(function(u,s,l,p){return p.compare(s,l)>0})),Vp=nr("<=",(function(u,s,l){return s<=l}),(function(u,s,l,p){return p.compare(s,l)<=0})),ef=nr(">=",(function(u,s,l){return s>=l}),(function(u,s,l,p){return p.compare(s,l)>=0}));class Nu{constructor(s,l,p){this.type=Mc,this.locale=p,this.caseSensitive=s,this.diacriticSensitive=l}static parse(s,l){if(s.length!==2)return l.error("Expected one argument.");const p=s[1];if(typeof p!="object"||Array.isArray(p))return l.error("Collator options argument must be an object.");const _=l.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,mn);if(!_)return null;const b=l.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,mn);if(!b)return null;let T=null;return p.locale&&(T=l.parse(p.locale,1,wn),!T)?null:new Nu(_,b,T)}evaluate(s){return new po(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}class zh{constructor(s,l,p,_,b){this.type=wn,this.number=s,this.locale=l,this.currency=p,this.minFractionDigits=_,this.maxFractionDigits=b}static parse(s,l){if(s.length!==3)return l.error("Expected two arguments.");const p=l.parse(s[1],1,wt);if(!p)return null;const _=s[2];if(typeof _!="object"||Array.isArray(_))return l.error("NumberFormat options argument must be an object.");let b=null;if(_.locale&&(b=l.parse(_.locale,1,wn),!b))return null;let T=null;if(_.currency&&(T=l.parse(_.currency,1,wn),!T))return null;let C=null;if(_["min-fraction-digits"]&&(C=l.parse(_["min-fraction-digits"],1,wt),!C))return null;let M=null;return _["max-fraction-digits"]&&(M=l.parse(_["max-fraction-digits"],1,wt),!M)?null:new zh(p,b,T,C,M)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class ja{constructor(s){this.type=Io,this.sections=s}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const p=s[1];if(!Array.isArray(p)&&typeof p=="object")return l.error("First argument must be an image or text section.");const _=[];let b=!1;for(let T=1;T<=s.length-1;++T){const C=s[T];if(b&&typeof C=="object"&&!Array.isArray(C)){b=!1;let M=null;if(C["font-scale"]&&(M=l.parse(C["font-scale"],1,wt),!M))return null;let O=null;if(C["text-font"]&&(O=l.parse(C["text-font"],1,wr(wn)),!O))return null;let F=null;if(C["text-color"]&&(F=l.parse(C["text-color"],1,tr),!F))return null;let j=null;if(C["vertical-align"]){if(typeof C["vertical-align"]=="string"&&!qs.includes(C["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${C["vertical-align"]}' instead.`);if(j=l.parse(C["vertical-align"],1,wn),!j)return null}const H=_[_.length-1];H.scale=M,H.font=O,H.textColor=F,H.verticalAlign=j}else{const M=l.parse(s[T],1,vn);if(!M)return null;const O=M.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,_.push({content:M,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ja(_)}evaluate(s){return new Mi(this.sections.map((l=>{const p=l.content.evaluate(s);return on(p)===Pn?new Gs("",p,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(s):null):new Gs(hn(p),null,l.scale?l.scale.evaluate(s):null,l.font?l.font.evaluate(s).join(","):null,l.textColor?l.textColor.evaluate(s):null,l.verticalAlign?l.verticalAlign.evaluate(s):null)})))}eachChild(s){for(const l of this.sections)s(l.content),l.scale&&s(l.scale),l.font&&s(l.font),l.textColor&&s(l.textColor),l.verticalAlign&&s(l.verticalAlign)}outputDefined(){return!1}}class Uh{constructor(s){this.type=Pn,this.input=s}static parse(s,l){if(s.length!==2)return l.error("Expected two arguments.");const p=l.parse(s[1],1,wn);return p?new Uh(p):l.error("No image name provided.")}evaluate(s){const l=this.input.evaluate(s),p=fs.fromString(l);return p&&s.availableImages&&(p.available=s.availableImages.indexOf(l)>-1),p}eachChild(s){s(this.input)}outputDefined(){return!1}}class Bl{constructor(s){this.type=wt,this.input=s}static parse(s,l){if(s.length!==2)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);const p=l.parse(s[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${ei(p.type)} instead.`):new Bl(p):null}evaluate(s){const l=this.input.evaluate(s);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new si(`Expected value to be of type string or array, but found ${ei(on(l))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const Js=8192;function $p(u,s){const l=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(l*_*Js),Math.round(p*_*Js)]}function Bu(u,s){const l=Math.pow(2,s.z);return[(_=(u[0]/Js+s.x)/l,360*_-180),(p=(u[1]/Js+s.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,_}function zl(u,s){u[0]=Math.min(u[0],s[0]),u[1]=Math.min(u[1],s[1]),u[2]=Math.max(u[2],s[0]),u[3]=Math.max(u[3],s[1])}function Uc(u,s){return!(u[0]<=s[0]||u[2]>=s[2]||u[1]<=s[1]||u[3]>=s[3])}function Wp(u,s,l){const p=u[0]-s[0],_=u[1]-s[1],b=u[0]-l[0],T=u[1]-l[1];return p*T-b*_==0&&p*b<=0&&_*T<=0}function zu(u,s,l,p){return(_=[p[0]-l[0],p[1]-l[1]])[0]*(b=[s[0]-u[0],s[1]-u[1]])[1]-_[1]*b[0]!=0&&!(!Ul(u,s,l,p)||!Ul(l,p,u,s));var _,b}function Hp(u,s,l){for(const p of l)for(let _=0;_<p.length-1;++_)if(zu(u,s,p[_],p[_+1]))return!0;return!1}function Va(u,s,l=!1){let p=!1;for(const C of s)for(let M=0;M<C.length-1;M++){if(Wp(u,C[M],C[M+1]))return l;(b=C[M])[1]>(_=u)[1]!=(T=C[M+1])[1]>_[1]&&_[0]<(T[0]-b[0])*(_[1]-b[1])/(T[1]-b[1])+b[0]&&(p=!p)}var _,b,T;return p}function tf(u,s){for(const l of s)if(Va(u,l))return!0;return!1}function jh(u,s){for(const l of u)if(!Va(l,s))return!1;for(let l=0;l<u.length-1;++l)if(Hp(u[l],u[l+1],s))return!1;return!0}function Vh(u,s){for(const l of s)if(jh(u,l))return!0;return!1}function Ul(u,s,l,p){const _=p[0]-l[0],b=p[1]-l[1],T=(u[0]-l[0])*b-_*(u[1]-l[1]),C=(s[0]-l[0])*b-_*(s[1]-l[1]);return T>0&&C<0||T<0&&C>0}function $h(u,s,l){const p=[];for(let _=0;_<u.length;_++){const b=[];for(let T=0;T<u[_].length;T++){const C=$p(u[_][T],l);zl(s,C),b.push(C)}p.push(b)}return p}function Wh(u,s,l){const p=[];for(let _=0;_<u.length;_++){const b=$h(u[_],s,l);p.push(b)}return p}function jc(u,s,l,p){if(u[0]<l[0]||u[0]>l[2]){const _=.5*p;let b=u[0]-l[0]>_?-p:l[0]-u[0]>_?p:0;b===0&&(b=u[0]-l[2]>_?-p:l[2]-u[0]>_?p:0),u[0]+=b}zl(s,u)}function Hh(u,s,l,p){const _=Math.pow(2,p.z)*Js,b=[p.x*Js,p.y*Js],T=[];for(const C of u)for(const M of C){const O=[M.x+b[0],M.y+b[1]];jc(O,s,l,_),T.push(O)}return T}function Zh(u,s,l,p){const _=Math.pow(2,p.z)*Js,b=[p.x*Js,p.y*Js],T=[];for(const M of u){const O=[];for(const F of M){const j=[F.x+b[0],F.y+b[1]];zl(s,j),O.push(j)}T.push(O)}if(s[2]-s[0]<=_/2){(C=s)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const M of T)for(const O of M)jc(O,s,l,_)}var C;return T}class ca{constructor(s,l){this.type=mn,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(sa(s[1])){const p=s[1];if(p.type==="FeatureCollection"){const _=[];for(const b of p.features){const{type:T,coordinates:C}=b.geometry;T==="Polygon"&&_.push(C),T==="MultiPolygon"&&_.push(...C)}if(_.length)return new ca(p,{type:"MultiPolygon",coordinates:_})}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ca(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ca(p,p)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return(function(l,p){const _=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],T=l.canonicalID();if(p.type==="Polygon"){const C=$h(p.coordinates,b,T),M=Hh(l.geometry(),_,b,T);if(!Uc(_,b))return!1;for(const O of M)if(!Va(O,C))return!1}if(p.type==="MultiPolygon"){const C=Wh(p.coordinates,b,T),M=Hh(l.geometry(),_,b,T);if(!Uc(_,b))return!1;for(const O of M)if(!tf(O,C))return!1}return!0})(s,this.geometries);if(s.geometryType()==="LineString")return(function(l,p){const _=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],T=l.canonicalID();if(p.type==="Polygon"){const C=$h(p.coordinates,b,T),M=Zh(l.geometry(),_,b,T);if(!Uc(_,b))return!1;for(const O of M)if(!jh(O,C))return!1}if(p.type==="MultiPolygon"){const C=Wh(p.coordinates,b,T),M=Zh(l.geometry(),_,b,T);if(!Uc(_,b))return!1;for(const O of M)if(!Vh(O,C))return!1}return!0})(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ua=class{constructor(u=[],s=(l,p)=>l<p?-1:l>p?1:0){if(this.data=u,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(this.length===0)return;const u=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:s,compare:l}=this,p=s[u];for(;u>0;){const _=u-1>>1,b=s[_];if(l(p,b)>=0)break;s[u]=b,u=_}s[u]=p}_down(u){const{data:s,compare:l}=this,p=this.length>>1,_=s[u];for(;u<p;){let b=1+(u<<1);const T=b+1;if(T<this.length&&l(s[T],s[b])<0&&(b=T),l(s[b],_)>=0)break;s[u]=s[b],u=b}s[u]=_}};function Xh(u,s,l=0,p=u.length-1,_=Zp){for(;p>l;){if(p-l>600){const M=p-l+1,O=s-l+1,F=Math.log(M),j=.5*Math.exp(2*F/3),H=.5*Math.sqrt(F*j*(M-j)/M)*(O-M/2<0?-1:1);Xh(u,s,Math.max(l,Math.floor(s-O*j/M+H)),Math.min(p,Math.floor(s+(M-O)*j/M+H)),_)}const b=u[s];let T=l,C=p;for(Vc(u,l,s),_(u[p],b)>0&&Vc(u,l,p);T<C;){for(Vc(u,T,C),T++,C--;_(u[T],b)<0;)T++;for(;_(u[C],b)>0;)C--}_(u[l],b)===0?Vc(u,l,C):(C++,Vc(u,C,p)),C<=s&&(l=C+1),s<=C&&(p=C-1)}}function Vc(u,s,l){const p=u[s];u[s]=u[l],u[l]=p}function Zp(u,s){return u<s?-1:u>s?1:0}function jl(u,s){if(u.length<=1)return[u];const l=[];let p,_;for(const b of u){const T=$c(b);T!==0&&(b.area=Math.abs(T),_===void 0&&(_=T<0),_===T<0?(p&&l.push(p),p=[b]):p.push(b))}if(p&&l.push(p),s>1)for(let b=0;b<l.length;b++)l[b].length<=s||(Xh(l[b],s,1,l[b].length-1,qh),l[b]=l[b].slice(0,s));return l}function qh(u,s){return s.area-u.area}function $c(u){let s=0;for(let l,p,_=0,b=u.length,T=b-1;_<b;T=_++)l=u[_],p=u[T],s+=(p.x-l.x)*(l.y+p.y);return s}const Vl=1/298.257223563,nf=Vl*(2-Vl),$l=Math.PI/180;class Gh{constructor(s){const l=6378.137*$l*1e3,p=Math.cos(s*$l),_=1/(1-nf*(1-p*p)),b=Math.sqrt(_);this.kx=l*b*p,this.ky=l*b*_*(1-nf)}distance(s,l){const p=this.wrap(s[0]-l[0])*this.kx,_=(s[1]-l[1])*this.ky;return Math.sqrt(p*p+_*_)}pointOnLine(s,l){let p,_,b,T,C=1/0;for(let M=0;M<s.length-1;M++){let O=s[M][0],F=s[M][1],j=this.wrap(s[M+1][0]-O)*this.kx,H=(s[M+1][1]-F)*this.ky,X=0;j===0&&H===0||(X=(this.wrap(l[0]-O)*this.kx*j+(l[1]-F)*this.ky*H)/(j*j+H*H),X>1?(O=s[M+1][0],F=s[M+1][1]):X>0&&(O+=j/this.kx*X,F+=H/this.ky*X)),j=this.wrap(l[0]-O)*this.kx,H=(l[1]-F)*this.ky;const G=j*j+H*H;G<C&&(C=G,p=O,_=F,b=M,T=X)}return{point:[p,_],index:b,t:Math.max(0,Math.min(1,T))}}wrap(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}}function Yh(u,s){return s[0]-u[0]}function Wl(u){return u[1]-u[0]+1}function Qs(u,s){return u[1]>=u[0]&&u[1]<s}function zn(u,s){if(u[0]>u[1])return[null,null];const l=Wl(u);if(s){if(l===2)return[u,null];const _=Math.floor(l/2);return[[u[0],u[0]+_],[u[0]+_,u[1]]]}if(l===1)return[u,null];const p=Math.floor(l/2)-1;return[[u[0],u[0]+p],[u[0]+p+1,u[1]]]}function Uu(u,s){if(!Qs(s,u.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let p=s[0];p<=s[1];++p)zl(l,u[p]);return l}function ju(u){const s=[1/0,1/0,-1/0,-1/0];for(const l of u)for(const p of l)zl(s,p);return s}function rf(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function Kh(u,s,l){if(!rf(u)||!rf(s))return NaN;let p=0,_=0;return u[2]<s[0]&&(p=s[0]-u[2]),u[0]>s[2]&&(p=u[0]-s[2]),u[1]>s[3]&&(_=u[1]-s[3]),u[3]<s[1]&&(_=s[1]-u[3]),l.distance([0,0],[p,_])}function $a(u,s,l){const p=l.pointOnLine(s,u);return l.distance(u,p.point)}function Jh(u,s,l,p,_){const b=Math.min($a(u,[l,p],_),$a(s,[l,p],_)),T=Math.min($a(l,[u,s],_),$a(p,[u,s],_));return Math.min(b,T)}function Xp(u,s,l,p,_){if(!Qs(s,u.length)||!Qs(p,l.length))return 1/0;let b=1/0;for(let T=s[0];T<s[1];++T){const C=u[T],M=u[T+1];for(let O=p[0];O<p[1];++O){const F=l[O],j=l[O+1];if(zu(C,M,F,j))return 0;b=Math.min(b,Jh(C,M,F,j,_))}}return b}function eo(u,s,l,p,_){if(!Qs(s,u.length)||!Qs(p,l.length))return NaN;let b=1/0;for(let T=s[0];T<=s[1];++T)for(let C=p[0];C<=p[1];++C)if(b=Math.min(b,_.distance(u[T],l[C])),b===0)return b;return b}function Wc(u,s,l){if(Va(u,s,!0))return 0;let p=1/0;for(const _ of s){const b=_[0],T=_[_.length-1];if(b!==T&&(p=Math.min(p,$a(u,[T,b],l)),p===0))return p;const C=l.pointOnLine(_,u);if(p=Math.min(p,l.distance(u,C.point)),p===0)return p}return p}function sf(u,s,l,p){if(!Qs(s,u.length))return NaN;for(let b=s[0];b<=s[1];++b)if(Va(u[b],l,!0))return 0;let _=1/0;for(let b=s[0];b<s[1];++b){const T=u[b],C=u[b+1];for(const M of l)for(let O=0,F=M.length,j=F-1;O<F;j=O++){const H=M[j],X=M[O];if(zu(T,C,H,X))return 0;_=Math.min(_,Jh(T,C,H,X,p))}}return _}function Qh(u,s){for(const l of u)for(const p of l)if(Va(p,s,!0))return!0;return!1}function of(u,s,l,p=1/0){const _=ju(u),b=ju(s);if(p!==1/0&&Kh(_,b,l)>=p)return p;if(Uc(_,b)){if(Qh(u,s))return 0}else if(Qh(s,u))return 0;let T=1/0;for(const C of u)for(let M=0,O=C.length,F=O-1;M<O;F=M++){const j=C[F],H=C[M];for(const X of s)for(let G=0,te=X.length,oe=te-1;G<te;oe=G++){const me=X[oe],je=X[G];if(zu(j,H,me,je))return 0;T=Math.min(T,Jh(j,H,me,je,l))}}return T}function ed(u,s,l,p,_,b){if(!b)return;const T=Kh(Uu(p,b),_,l);T<s&&u.push([T,b,[0,0]])}function Hl(u,s,l,p,_,b,T){if(!b||!T)return;const C=Kh(Uu(p,b),Uu(_,T),l);C<s&&u.push([C,b,T])}function Vu(u,s,l,p,_=1/0){let b=Math.min(p.distance(u[0],l[0][0]),_);if(b===0)return b;const T=new ua([[0,[0,u.length-1],[0,0]]],Yh),C=ju(l);for(;T.length>0;){const M=T.pop();if(M[0]>=b)continue;const O=M[1],F=s?50:100;if(Wl(O)<=F){if(!Qs(O,u.length))return NaN;if(s){const j=sf(u,O,l,p);if(isNaN(j)||j===0)return j;b=Math.min(b,j)}else for(let j=O[0];j<=O[1];++j){const H=Wc(u[j],l,p);if(b=Math.min(b,H),b===0)return 0}}else{const j=zn(O,s);ed(T,b,p,u,C,j[0]),ed(T,b,p,u,C,j[1])}}return b}function $u(u,s,l,p,_,b=1/0){let T=Math.min(b,_.distance(u[0],l[0]));if(T===0)return T;const C=new ua([[0,[0,u.length-1],[0,l.length-1]]],Yh);for(;C.length>0;){const M=C.pop();if(M[0]>=T)continue;const O=M[1],F=M[2],j=s?50:100,H=p?50:100;if(Wl(O)<=j&&Wl(F)<=H){if(!Qs(O,u.length)&&Qs(F,l.length))return NaN;let X;if(s&&p)X=Xp(u,O,l,F,_),T=Math.min(T,X);else if(s&&!p){const G=u.slice(O[0],O[1]+1);for(let te=F[0];te<=F[1];++te)if(X=$a(l[te],G,_),T=Math.min(T,X),T===0)return T}else if(!s&&p){const G=l.slice(F[0],F[1]+1);for(let te=O[0];te<=O[1];++te)if(X=$a(u[te],G,_),T=Math.min(T,X),T===0)return T}else X=eo(u,O,l,F,_),T=Math.min(T,X)}else{const X=zn(O,s),G=zn(F,p);Hl(C,T,_,u,l,X[0],G[0]),Hl(C,T,_,u,l,X[0],G[1]),Hl(C,T,_,u,l,X[1],G[0]),Hl(C,T,_,u,l,X[1],G[1])}}return T}function ha(u){return u.type==="MultiPolygon"?u.coordinates.map((s=>({type:"Polygon",coordinates:s}))):u.type==="MultiLineString"?u.coordinates.map((s=>({type:"LineString",coordinates:s}))):u.type==="MultiPoint"?u.coordinates.map((s=>({type:"Point",coordinates:s}))):[u]}class Oo{constructor(s,l){this.type=wt,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${s.length-1} instead.`);if(sa(s[1])){const p=s[1];if(p.type==="FeatureCollection")return new Oo(p,p.features.map((_=>ha(_.geometry))).flat());if(p.type==="Feature")return new Oo(p,ha(p.geometry));if("type"in p&&"coordinates"in p)return new Oo(p,ha(p))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return(function(l,p){const _=l.geometry(),b=_.flat().map((M=>Bu([M.x,M.y],l.canonical)));if(_.length===0)return NaN;const T=new Gh(b[0][1]);let C=1/0;for(const M of p){switch(M.type){case"Point":C=Math.min(C,$u(b,!1,[M.coordinates],!1,T,C));break;case"LineString":C=Math.min(C,$u(b,!1,M.coordinates,!0,T,C));break;case"Polygon":C=Math.min(C,Vu(b,!1,M.coordinates,T,C))}if(C===0)return C}return C})(s,this.geometries);if(s.geometryType()==="LineString")return(function(l,p){const _=l.geometry(),b=_.flat().map((M=>Bu([M.x,M.y],l.canonical)));if(_.length===0)return NaN;const T=new Gh(b[0][1]);let C=1/0;for(const M of p){switch(M.type){case"Point":C=Math.min(C,$u(b,!0,[M.coordinates],!1,T,C));break;case"LineString":C=Math.min(C,$u(b,!0,M.coordinates,!0,T,C));break;case"Polygon":C=Math.min(C,Vu(b,!0,M.coordinates,T,C))}if(C===0)return C}return C})(s,this.geometries);if(s.geometryType()==="Polygon")return(function(l,p){const _=l.geometry();if(_.length===0||_[0].length===0)return NaN;const b=jl(_,0).map((M=>M.map((O=>O.map((F=>Bu([F.x,F.y],l.canonical))))))),T=new Gh(b[0][0][0][1]);let C=1/0;for(const M of p)for(const O of b){switch(M.type){case"Point":C=Math.min(C,Vu([M.coordinates],!1,O,T,C));break;case"LineString":C=Math.min(C,Vu(M.coordinates,!0,O,T,C));break;case"Polygon":C=Math.min(C,of(O,M.coordinates,T,C))}if(C===0)return C}return C})(s,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Lo{constructor(s){this.type=vn,this.key=s}static parse(s,l){if(s.length!==2)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);const p=s[1];return p==null?l.error("Global state property must be defined."):typeof p!="string"?l.error(`Global state property must be string, but found ${typeof s[1]} instead.`):new Lo(p)}evaluate(s){var l;const p=(l=s.globals)===null||l===void 0?void 0:l.globalState;return p&&Object.keys(p).length!==0?ia(p,this.key):null}eachChild(){}outputDefined(){return!1}}const da={"==":Qd,"!=":Fu,">":Bh,"<":jp,">=":ef,"<=":Vp,array:Tr,at:Fl,boolean:Tr,case:ko,coalesce:Nc,collator:Nu,format:ja,image:Uh,in:Ua,"index-of":Ms,interpolate:Bi,"interpolate-hcl":Bi,"interpolate-lab":Bi,length:Bl,let:Ll,literal:ps,match:Ni,number:Tr,"number-format":zh,object:Tr,slice:Nl,step:ci,string:Tr,"to-boolean":go,"to-color":go,"to-number":go,"to-string":go,var:Ys,within:ca,distance:Oo,"global-state":Lo};class ms{constructor(s,l,p,_){this.name=s,this.type=l,this._evaluate=p,this.args=_}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,l){const p=s[0],_=ms.definitions[p];if(!_)return l.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(_)?_[0]:_.type,T=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,C=T.filter((([O])=>!Array.isArray(O)||O.length===s.length-1));let M=null;for(const[O,F]of C){M=new oa(l.registry,Ha,l.path,null,l.scope);const j=[];let H=!1;for(let X=1;X<s.length;X++){const G=s[X],te=Array.isArray(O)?O[X-1]:O.type,oe=M.parse(G,1+j.length,te);if(!oe){H=!0;break}j.push(oe)}if(!H)if(Array.isArray(O)&&O.length!==j.length)M.error(`Expected ${O.length} arguments, but found ${j.length} instead.`);else{for(let X=0;X<j.length;X++){const G=Array.isArray(O)?O[X]:O.type,te=j[X];M.concat(X+1).checkSubtype(G,te.type)}if(M.errors.length===0)return new ms(p,b,F,j)}}if(C.length===1)l.errors.push(...M.errors);else{const O=(C.length?C:T).map((([j])=>{return H=j,Array.isArray(H)?`(${H.map(ei).join(", ")})`:`(${ei(H.type)}...)`;var H})).join(" | "),F=[];for(let j=1;j<s.length;j++){const H=l.parse(s[j],1+F.length);if(!H)return null;F.push(ei(H.type))}l.error(`Expected arguments of type ${O}, but found (${F.join(", ")}) instead.`)}return null}static register(s,l){ms.definitions=l;for(const p in l)s[p]=ms}}function Hc(u,[s,l,p,_]){s=s.evaluate(u),l=l.evaluate(u),p=p.evaluate(u);const b=_?_.evaluate(u):1,T=ti(s,l,p,b);if(T)throw new si(T);return new An(s/255,l/255,p/255,b,!1)}function Wa(u,s){return u in s}function Zc(u,s){const l=s[u];return l===void 0?null:l}function fa(u){return{type:u}}function Ha(u){if(u instanceof Ys)return Ha(u.boundExpression);if(u instanceof ms&&u.name==="error"||u instanceof Nu||u instanceof ca||u instanceof Oo||u instanceof Lo)return!1;const s=u instanceof go||u instanceof Tr;let l=!0;return u.eachChild((p=>{l=s?l&&Ha(p):l&&p instanceof ps})),!!l&&Xc(u)&&qc(u,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Xc(u){if(u instanceof ms&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof ca||u instanceof Oo)return!1;let s=!0;return u.eachChild((l=>{s&&!Xc(l)&&(s=!1)})),s}function Zl(u){if(u instanceof ms&&u.name==="feature-state")return!1;let s=!0;return u.eachChild((l=>{s&&!Zl(l)&&(s=!1)})),s}function qc(u,s){if(u instanceof ms&&s.indexOf(u.name)>=0)return!1;let l=!0;return u.eachChild((p=>{l&&!qc(p,s)&&(l=!1)})),l}function td(u){return{result:"success",value:u}}function Za(u){return{result:"error",value:u}}function Fo(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function No(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Gc(u){return!!u.expression&&u.expression.interpolated}function Mn(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Yc(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)&&on(u)===na}function qp(u){return u}function Xl(u,s){const l=u.stops&&typeof u.stops[0][0]=="object",p=l||!(l||u.property!==void 0),_=u.type||(Gc(s)?"exponential":"interval"),b=(function(F){switch(F.type){case"color":return An.parse;case"padding":return Ri.parse;case"numberArray":return Yi.parse;case"colorArray":return li.parse;default:return null}})(s);if(b&&((u=bi({},u)).stops&&(u.stops=u.stops.map((F=>[F[0],b(F[1])]))),u.default=b(u.default?u.default:s.default)),u.colorSpace&&(T=u.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var T;const C=(function(F){switch(F){case"exponential":return fi;case"interval":return af;case"categorical":return nd;case"identity":return id;default:throw new Error(`Unknown function type "${F}"`)}})(_);let M,O;if(_==="categorical"){M=Object.create(null);for(const F of u.stops)M[F[0]]=F[1];O=typeof u.stops[0][0]}if(l){const F={},j=[];for(let G=0;G<u.stops.length;G++){const te=u.stops[G],oe=te[0].zoom;F[oe]===void 0&&(F[oe]={zoom:oe,type:u.type,property:u.property,default:u.default,stops:[]},j.push(oe)),F[oe].stops.push([te[0].value,te[1]])}const H=[];for(const G of j)H.push([F[G].zoom,Xl(F[G],s)]);const X={name:"linear"};return{kind:"composite",interpolationType:X,interpolationFactor:Bi.interpolationFactor.bind(void 0,X),zoomStops:H.map((G=>G[0])),evaluate:({zoom:G},te)=>fi({stops:H,base:u.base},s,G).evaluate(G,te)}}if(p){const F=_==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:Bi.interpolationFactor.bind(void 0,F),zoomStops:u.stops.map((j=>j[0])),evaluate:({zoom:j})=>C(u,s,j,M,O)}}return{kind:"source",evaluate(F,j){const H=j&&j.properties?j.properties[u.property]:void 0;return H===void 0?pa(u.default,s.default):C(u,s,H,M,O)}}}function pa(u,s,l){return u!==void 0?u:s!==void 0?s:l!==void 0?l:void 0}function nd(u,s,l,p,_){return pa(typeof l===_?p[l]:void 0,u.default,s.default)}function af(u,s,l){if(Mn(l)!=="number")return pa(u.default,s.default);const p=u.stops.length;if(p===1||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[p-1][0])return u.stops[p-1][1];const _=Ji(u.stops.map((b=>b[0])),l);return u.stops[_][1]}function fi(u,s,l){const p=u.base!==void 0?u.base:1;if(Mn(l)!=="number")return pa(u.default,s.default);const _=u.stops.length;if(_===1||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[_-1][0])return u.stops[_-1][1];const b=Ji(u.stops.map((F=>F[0])),l),T=(function(F,j,H,X){const G=X-H,te=F-H;return G===0?0:j===1?te/G:(Math.pow(j,te)-1)/(Math.pow(j,G)-1)})(l,p,u.stops[b][0],u.stops[b+1][0]),C=u.stops[b][1],M=u.stops[b+1][1],O=Ks[s.type]||qp;return typeof C.evaluate=="function"?{evaluate(...F){const j=C.evaluate.apply(void 0,F),H=M.evaluate.apply(void 0,F);if(j!==void 0&&H!==void 0)return O(j,H,T,u.colorSpace)}}:O(C,M,T,u.colorSpace)}function id(u,s,l){switch(s.type){case"color":l=An.parse(l);break;case"formatted":l=Mi.fromString(l.toString());break;case"resolvedImage":l=fs.fromString(l.toString());break;case"padding":l=Ri.parse(l);break;case"colorArray":l=li.parse(l);break;case"numberArray":l=Yi.parse(l);break;default:Mn(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0)}return pa(l,u.default,s.default)}ms.register(da,{error:[{kind:"error"},[wn],(u,[s])=>{throw new si(s.evaluate(u))}],typeof:[wn,[vn],(u,[s])=>ei(on(s.evaluate(u)))],"to-rgba":[wr(wt,4),[tr],(u,[s])=>{const[l,p,_,b]=s.evaluate(u).rgb;return[255*l,255*p,255*_,b]}],rgb:[tr,[wt,wt,wt],Hc],rgba:[tr,[wt,wt,wt,wt],Hc],has:{type:mn,overloads:[[[wn],(u,[s])=>Wa(s.evaluate(u),u.properties())],[[wn,na],(u,[s,l])=>Wa(s.evaluate(u),l.evaluate(u))]]},get:{type:vn,overloads:[[[wn],(u,[s])=>Zc(s.evaluate(u),u.properties())],[[wn,na],(u,[s,l])=>Zc(s.evaluate(u),l.evaluate(u))]]},"feature-state":[vn,[wn],(u,[s])=>Zc(s.evaluate(u),u.featureState||{})],properties:[na,[],u=>u.properties()],"geometry-type":[wn,[],u=>u.geometryType()],id:[vn,[],u=>u.id()],zoom:[wt,[],u=>u.globals.zoom],"heatmap-density":[wt,[],u=>u.globals.heatmapDensity||0],elevation:[wt,[],u=>u.globals.elevation||0],"line-progress":[wt,[],u=>u.globals.lineProgress||0],accumulated:[vn,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[wt,fa(wt),(u,s)=>{let l=0;for(const p of s)l+=p.evaluate(u);return l}],"*":[wt,fa(wt),(u,s)=>{let l=1;for(const p of s)l*=p.evaluate(u);return l}],"-":{type:wt,overloads:[[[wt,wt],(u,[s,l])=>s.evaluate(u)-l.evaluate(u)],[[wt],(u,[s])=>-s.evaluate(u)]]},"/":[wt,[wt,wt],(u,[s,l])=>s.evaluate(u)/l.evaluate(u)],"%":[wt,[wt,wt],(u,[s,l])=>s.evaluate(u)%l.evaluate(u)],ln2:[wt,[],()=>Math.LN2],pi:[wt,[],()=>Math.PI],e:[wt,[],()=>Math.E],"^":[wt,[wt,wt],(u,[s,l])=>Math.pow(s.evaluate(u),l.evaluate(u))],sqrt:[wt,[wt],(u,[s])=>Math.sqrt(s.evaluate(u))],log10:[wt,[wt],(u,[s])=>Math.log(s.evaluate(u))/Math.LN10],ln:[wt,[wt],(u,[s])=>Math.log(s.evaluate(u))],log2:[wt,[wt],(u,[s])=>Math.log(s.evaluate(u))/Math.LN2],sin:[wt,[wt],(u,[s])=>Math.sin(s.evaluate(u))],cos:[wt,[wt],(u,[s])=>Math.cos(s.evaluate(u))],tan:[wt,[wt],(u,[s])=>Math.tan(s.evaluate(u))],asin:[wt,[wt],(u,[s])=>Math.asin(s.evaluate(u))],acos:[wt,[wt],(u,[s])=>Math.acos(s.evaluate(u))],atan:[wt,[wt],(u,[s])=>Math.atan(s.evaluate(u))],min:[wt,fa(wt),(u,s)=>Math.min(...s.map((l=>l.evaluate(u))))],max:[wt,fa(wt),(u,s)=>Math.max(...s.map((l=>l.evaluate(u))))],abs:[wt,[wt],(u,[s])=>Math.abs(s.evaluate(u))],round:[wt,[wt],(u,[s])=>{const l=s.evaluate(u);return l<0?-Math.round(-l):Math.round(l)}],floor:[wt,[wt],(u,[s])=>Math.floor(s.evaluate(u))],ceil:[wt,[wt],(u,[s])=>Math.ceil(s.evaluate(u))],"filter-==":[mn,[wn,vn],(u,[s,l])=>u.properties()[s.value]===l.value],"filter-id-==":[mn,[vn],(u,[s])=>u.id()===s.value],"filter-type-==":[mn,[wn],(u,[s])=>u.geometryType()===s.value],"filter-<":[mn,[wn,vn],(u,[s,l])=>{const p=u.properties()[s.value],_=l.value;return typeof p==typeof _&&p<_}],"filter-id-<":[mn,[vn],(u,[s])=>{const l=u.id(),p=s.value;return typeof l==typeof p&&l<p}],"filter->":[mn,[wn,vn],(u,[s,l])=>{const p=u.properties()[s.value],_=l.value;return typeof p==typeof _&&p>_}],"filter-id->":[mn,[vn],(u,[s])=>{const l=u.id(),p=s.value;return typeof l==typeof p&&l>p}],"filter-<=":[mn,[wn,vn],(u,[s,l])=>{const p=u.properties()[s.value],_=l.value;return typeof p==typeof _&&p<=_}],"filter-id-<=":[mn,[vn],(u,[s])=>{const l=u.id(),p=s.value;return typeof l==typeof p&&l<=p}],"filter->=":[mn,[wn,vn],(u,[s,l])=>{const p=u.properties()[s.value],_=l.value;return typeof p==typeof _&&p>=_}],"filter-id->=":[mn,[vn],(u,[s])=>{const l=u.id(),p=s.value;return typeof l==typeof p&&l>=p}],"filter-has":[mn,[vn],(u,[s])=>s.value in u.properties()],"filter-has-id":[mn,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[mn,[wr(wn)],(u,[s])=>s.value.indexOf(u.geometryType())>=0],"filter-id-in":[mn,[wr(vn)],(u,[s])=>s.value.indexOf(u.id())>=0],"filter-in-small":[mn,[wn,wr(vn)],(u,[s,l])=>l.value.indexOf(u.properties()[s.value])>=0],"filter-in-large":[mn,[wn,wr(vn)],(u,[s,l])=>(function(p,_,b,T){for(;b<=T;){const C=b+T>>1;if(_[C]===p)return!0;_[C]>p?T=C-1:b=C+1}return!1})(u.properties()[s.value],l.value,0,l.value.length-1)],all:{type:mn,overloads:[[[mn,mn],(u,[s,l])=>s.evaluate(u)&&l.evaluate(u)],[fa(mn),(u,s)=>{for(const l of s)if(!l.evaluate(u))return!1;return!0}]]},any:{type:mn,overloads:[[[mn,mn],(u,[s,l])=>s.evaluate(u)||l.evaluate(u)],[fa(mn),(u,s)=>{for(const l of s)if(l.evaluate(u))return!0;return!1}]]},"!":[mn,[mn],(u,[s])=>!s.evaluate(u)],"is-supported-script":[mn,[wn],(u,[s])=>{const l=u.globals&&u.globals.isSupportedScript;return!l||l(s.evaluate(u))}],upcase:[wn,[wn],(u,[s])=>s.evaluate(u).toUpperCase()],downcase:[wn,[wn],(u,[s])=>s.evaluate(u).toLowerCase()],concat:[wn,fa(vn),(u,s)=>s.map((l=>hn(l.evaluate(u)))).join("")],"resolved-locale":[wn,[Mc],(u,[s])=>s.evaluate(u).resolvedLocale()]});class ql{constructor(s,l,p){this.expression=s,this._warningHistory={},this._evaluator=new Ol,this._defaultValue=l?(function(_){if(_.type==="color"&&Yc(_.default))return new An(0,0,0,0);switch(_.type){case"color":return An.parse(_.default)||null;case"padding":return Ri.parse(_.default)||null;case"numberArray":return Yi.parse(_.default)||null;case"colorArray":return li.parse(_.default)||null;case"variableAnchorOffsetCollection":return Ki.parse(_.default)||null;case"projectionDefinition":return fr.parse(_.default)||null;default:return _.default===void 0?null:_.default}})(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this._globalState=p}evaluateWithoutErrorHandling(s,l,p,_,b,T){return this._globalState&&(s=Ga(s,this._globalState)),this._evaluator.globals=s,this._evaluator.feature=l,this._evaluator.featureState=p,this._evaluator.canonical=_,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(s,l,p,_,b,T){this._globalState&&(s=Ga(s,this._globalState)),this._evaluator.globals=s,this._evaluator.feature=l||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=T||null;try{const C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new si(`Expected value to be one of ${Object.keys(this._enumValues).map((M=>JSON.stringify(M))).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}}function ma(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in da}function Gl(u,s,l){const p=new oa(da,Ha,[],s?(function(b){const T={color:tr,string:wn,number:wt,enum:wn,boolean:mn,formatted:Io,padding:Rc,numberArray:Il,colorArray:ho,projectionDefinition:ta,resolvedImage:Pn,variableAnchorOffsetCollection:Ru};return b.type==="array"?wr(T[b.value]||vn,b.length):T[b.type]})(s):void 0),_=p.parse(u,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?td(new ql(_,s,l)):Za(p.errors)}class Xa{constructor(s,l,p){this.kind=s,this._styleExpression=l,this.isStateDependent=s!=="constant"&&!Zl(l.expression),this.globalStateRefs=Jc(l.expression),this._globalState=p}evaluateWithoutErrorHandling(s,l,p,_,b,T){return this._globalState&&(s=Ga(s,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(s,l,p,_,b,T)}evaluate(s,l,p,_,b,T){return this._globalState&&(s=Ga(s,this._globalState)),this._styleExpression.evaluate(s,l,p,_,b,T)}}class qa{constructor(s,l,p,_,b){this.kind=s,this.zoomStops=p,this._styleExpression=l,this.isStateDependent=s!=="camera"&&!Zl(l.expression),this.globalStateRefs=Jc(l.expression),this.interpolationType=_,this._globalState=b}evaluateWithoutErrorHandling(s,l,p,_,b,T){return this._globalState&&(s=Ga(s,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(s,l,p,_,b,T)}evaluate(s,l,p,_,b,T){return this._globalState&&(s=Ga(s,this._globalState)),this._styleExpression.evaluate(s,l,p,_,b,T)}interpolationFactor(s,l,p){return this.interpolationType?Bi.interpolationFactor(this.interpolationType,s,l,p):0}}function Kc(u,s,l){const p=Gl(u,s,l);if(p.result==="error")return p;const _=p.value.expression,b=Xc(_);if(!b&&!Fo(s))return Za([new xr("","data expressions not supported")]);const T=qc(_,["zoom"]);if(!T&&!No(s))return Za([new xr("","zoom expressions not supported")]);const C=Yl(_);return C||T?C instanceof xr?Za([C]):C instanceof Bi&&!Gc(s)?Za([new xr("",'"interpolate" expressions cannot be used with this property')]):td(C?new qa(b?"camera":"composite",p.value,C.labels,C instanceof Bi?C.interpolation:void 0,l):new Xa(b?"constant":"source",p.value,l)):Za([new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _o{constructor(s,l){this._parameters=s,this._specification=l,bi(this,Xl(this._parameters,this._specification))}static deserialize(s){return new _o(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Yl(u){let s=null;if(u instanceof Ll)s=Yl(u.result);else if(u instanceof Nc){for(const l of u.args)if(s=Yl(l),s)break}else(u instanceof ci||u instanceof Bi)&&u.input instanceof ms&&u.input.name==="zoom"&&(s=u);return s instanceof xr||u.eachChild((l=>{const p=Yl(l);p instanceof xr?s=p:!s&&p?s=new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&p&&s!==p&&(s=new xr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),s}function Jc(u,s=new Set){return u instanceof Lo&&s.add(u.key),u.eachChild((l=>{Jc(l,s)})),s}function Ga(u,s){const{zoom:l,heatmapDensity:p,elevation:_,lineProgress:b,isSupportedScript:T,accumulated:C}=u??{};return{zoom:l,heatmapDensity:p,elevation:_,lineProgress:b,isSupportedScript:T,accumulated:C,globalState:s}}function Kl(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const s of u.slice(1))if(!Kl(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Jl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function yo(u,s){if(u==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Kl(u)||(u=Ql(u));const l=Gl(u,Jl,s);if(l.result==="error")throw new Error(l.value.map((p=>`${p.key}: ${p.message}`)).join(", "));return{filter:(p,_,b)=>l.value.evaluate(p,_,{},b),needGeometry:Ya(u),getGlobalStateRefs:()=>Jc(l.value.expression)}}function Qc(u,s){return u<s?-1:u>s?1:0}function Ya(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let s=1;s<u.length;s++)if(Ya(u[s]))return!0;return!1}function Ql(u){if(!u)return!0;const s=u[0];return u.length<=1?s!=="any":s==="=="?eu(u[1],u[2],"=="):s==="!="?Wu(eu(u[1],u[2],"==")):s==="<"||s===">"||s==="<="||s===">="?eu(u[1],u[2],s):s==="any"?(l=u.slice(1),["any"].concat(l.map(Ql))):s==="all"?["all"].concat(u.slice(1).map(Ql)):s==="none"?["all"].concat(u.slice(1).map(Ql).map(Wu)):s==="in"?lf(u[1],u.slice(2)):s==="!in"?Wu(lf(u[1],u.slice(2))):s==="has"?rd(u[1]):s!=="!has"||Wu(rd(u[1]));var l}function eu(u,s,l){switch(u){case"$type":return[`filter-type-${l}`,s];case"$id":return[`filter-id-${l}`,s];default:return[`filter-${l}`,u,s]}}function lf(u,s){if(s.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some((l=>typeof l!=typeof s[0]))?["filter-in-large",u,["literal",s.sort(Qc)]]:["filter-in-small",u,["literal",s]]}}function rd(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Wu(u){return["!",u]}function sd(u){const s=typeof u;if(s==="number"||s==="boolean"||s==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let _="[";for(const b of u)_+=`${sd(b)},`;return`${_}]`}const l=Object.keys(u).sort();let p="{";for(let _=0;_<l.length;_++)p+=`${JSON.stringify(l[_])}:${sd(u[l[_]])},`;return`${p}}`}function Hu(u){let s="";for(const l of un)s+=`/${sd(u[l])}`;return s}function vo(u){const s=u.value;return s?[new lt(u.key,s,"constants have been deprecated as of v8")]:[]}function pi(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Rs(u){if(Array.isArray(u))return u.map(Rs);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const s={};for(const l in u)s[l]=Rs(u[l]);return s}return pi(u)}function ki(u){const s=u.key,l=u.value,p=u.valueSpec||{},_=u.objectElementValidators||{},b=u.style,T=u.styleSpec,C=u.validateSpec;let M=[];const O=Mn(l);if(O!=="object")return[new lt(s,l,`object expected, ${O} found`)];for(const F in l){const j=F.split(".")[0],H=ia(p,j)||p["*"];let X;if(ia(_,j))X=_[j];else if(ia(p,j))X=C;else if(_["*"])X=_["*"];else{if(!p["*"]){M.push(new lt(s,l[F],`unknown property "${F}"`));continue}X=C}M=M.concat(X({key:(s&&`${s}.`)+F,value:l[F],valueSpec:H,style:b,styleSpec:T,object:l,objectKey:F,validateSpec:C},l))}for(const F in p)_[F]||p[F].required&&p[F].default===void 0&&l[F]===void 0&&M.push(new lt(s,l,`missing required property "${F}"`));return M}function ga(u){const s=u.value,l=u.valueSpec,p=u.style,_=u.styleSpec,b=u.key,T=u.arrayElementValidator||u.validateSpec;if(Mn(s)!=="array")return[new lt(b,s,`array expected, ${Mn(s)} found`)];if(l.length&&s.length!==l.length)return[new lt(b,s,`array length ${l.length} expected, length ${s.length} found`)];if(l["min-length"]&&s.length<l["min-length"])return[new lt(b,s,`array length at least ${l["min-length"]} expected, length ${s.length} found`)];let C={type:l.value,values:l.values};_.$version<7&&(C.function=l.function),Mn(l.value)==="object"&&(C=l.value);let M=[];for(let O=0;O<s.length;O++)M=M.concat(T({array:s,arrayIndex:O,value:s[O],valueSpec:C,validateSpec:u.validateSpec,style:p,styleSpec:_,key:`${b}[${O}]`}));return M}function ks(u){const s=u.key,l=u.value,p=u.valueSpec;let _=Mn(l);return _==="number"&&l!=l&&(_="NaN"),_!=="number"?[new lt(s,l,`number expected, ${_} found`)]:"minimum"in p&&l<p.minimum?[new lt(s,l,`${l} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&l>p.maximum?[new lt(s,l,`${l} is greater than the maximum value ${p.maximum}`)]:[]}function tu(u){const s=u.valueSpec,l=pi(u.value.type);let p,_,b,T={};const C=l!=="categorical"&&u.value.property===void 0,M=!C,O=Mn(u.value.stops)==="array"&&Mn(u.value.stops[0])==="array"&&Mn(u.value.stops[0][0])==="object",F=ki({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(X){if(l==="identity")return[new lt(X.key,X.value,'identity function may not have a "stops" property')];let G=[];const te=X.value;return G=G.concat(ga({key:X.key,value:te,valueSpec:X.valueSpec,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:j})),Mn(te)==="array"&&te.length===0&&G.push(new lt(X.key,te,"array must have at least one stop")),G},default:function(X){return X.validateSpec({key:X.key,value:X.value,valueSpec:s,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec})}}});return l==="identity"&&C&&F.push(new lt(u.key,u.value,'missing required property "property"')),l==="identity"||u.value.stops||F.push(new lt(u.key,u.value,'missing required property "stops"')),l==="exponential"&&u.valueSpec.expression&&!Gc(u.valueSpec)&&F.push(new lt(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(M&&!Fo(u.valueSpec)?F.push(new lt(u.key,u.value,"property functions not supported")):C&&!No(u.valueSpec)&&F.push(new lt(u.key,u.value,"zoom functions not supported"))),l!=="categorical"&&!O||u.value.property!==void 0||F.push(new lt(u.key,u.value,'"property" property is required')),F;function j(X){let G=[];const te=X.value,oe=X.key;if(Mn(te)!=="array")return[new lt(oe,te,`array expected, ${Mn(te)} found`)];if(te.length!==2)return[new lt(oe,te,`array length 2 expected, length ${te.length} found`)];if(O){if(Mn(te[0])!=="object")return[new lt(oe,te,`object expected, ${Mn(te[0])} found`)];if(te[0].zoom===void 0)return[new lt(oe,te,"object stop key must have zoom")];if(te[0].value===void 0)return[new lt(oe,te,"object stop key must have value")];if(b&&b>pi(te[0].zoom))return[new lt(oe,te[0].zoom,"stop zoom values must appear in ascending order")];pi(te[0].zoom)!==b&&(b=pi(te[0].zoom),_=void 0,T={}),G=G.concat(ki({key:`${oe}[0]`,value:te[0],valueSpec:{zoom:{}},validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:ks,value:H}}))}else G=G.concat(H({key:`${oe}[0]`,value:te[0],validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec},te));return ma(Rs(te[1]))?G.concat([new lt(`${oe}[1]`,te[1],"expressions are not allowed in function stops.")]):G.concat(X.validateSpec({key:`${oe}[1]`,value:te[1],valueSpec:s,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec}))}function H(X,G){const te=Mn(X.value),oe=pi(X.value),me=X.value!==null?X.value:G;if(p){if(te!==p)return[new lt(X.key,me,`${te} stop domain type must match previous stop domain type ${p}`)]}else p=te;if(te!=="number"&&te!=="string"&&te!=="boolean")return[new lt(X.key,me,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&l!=="categorical"){let je=`number expected, ${te} found`;return Fo(s)&&l===void 0&&(je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(X.key,me,je)]}return l!=="categorical"||te!=="number"||isFinite(oe)&&Math.floor(oe)===oe?l!=="categorical"&&te==="number"&&_!==void 0&&oe<_?[new lt(X.key,me,"stop domain values must appear in ascending order")]:(_=oe,l==="categorical"&&oe in T?[new lt(X.key,me,"stop domain values must be unique")]:(T[oe]=!0,[])):[new lt(X.key,me,`integer expected, found ${oe}`)]}}function Ka(u){const s=(u.expressionContext==="property"?Kc:Gl)(Rs(u.value),u.valueSpec);if(s.result==="error")return s.value.map((p=>new lt(`${u.key}${p.key}`,u.value,p.message)));const l=s.value.expression||s.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!l.outputDefined())return[new lt(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!Zl(l))return[new lt(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!Zl(l))return[new lt(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!qc(l,["zoom","feature-state"]))return[new lt(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Xc(l))return[new lt(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ja(u){const s=u.key,l=u.value,p=Mn(l);return p!=="string"?[new lt(s,l,`color expected, ${p} found`)]:An.parse(String(l))?[]:[new lt(s,l,`color expected, "${l}" found`)]}function to(u){const s=u.key,l=u.value,p=u.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(pi(l))===-1&&_.push(new lt(s,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(pi(l))===-1&&_.push(new lt(s,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),_}function Qa(u){return Kl(Rs(u.value))?Ka(bi({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):el(u)}function el(u){const s=u.value,l=u.key;if(Mn(s)!=="array")return[new lt(l,s,`array expected, ${Mn(s)} found`)];const p=u.styleSpec;let _,b=[];if(s.length<1)return[new lt(l,s,"filter array must have at least 1 element")];switch(b=b.concat(to({key:`${l}[0]`,value:s[0],valueSpec:p.filter_operator,style:u.style,styleSpec:u.styleSpec})),pi(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&pi(s[1])==="$type"&&b.push(new lt(l,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&b.push(new lt(l,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(_=Mn(s[1]),_!=="string"&&b.push(new lt(`${l}[1]`,s[1],`string expected, ${_} found`)));for(let T=2;T<s.length;T++)_=Mn(s[T]),pi(s[1])==="$type"?b=b.concat(to({key:`${l}[${T}]`,value:s[T],valueSpec:p.geometry_type,style:u.style,styleSpec:u.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&b.push(new lt(`${l}[${T}]`,s[T],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let T=1;T<s.length;T++)b=b.concat(el({key:`${l}[${T}]`,value:s[T],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":_=Mn(s[1]),s.length!==2?b.push(new lt(l,s,`filter array for "${s[0]}" operator must have 2 elements`)):_!=="string"&&b.push(new lt(`${l}[1]`,s[1],`string expected, ${_} found`))}return b}function nu(u,s){const l=u.key,p=u.validateSpec,_=u.style,b=u.styleSpec,T=u.value,C=u.objectKey,M=b[`${s}_${u.layerType}`];if(!M)return[];const O=C.match(/^(.*)-transition$/);if(s==="paint"&&O&&M[O[1]]&&M[O[1]].transition)return p({key:l,value:T,valueSpec:b.transition,style:_,styleSpec:b});const F=u.valueSpec||M[C];if(!F)return[new lt(l,T,`unknown property "${C}"`)];let j;if(Mn(T)==="string"&&Fo(F)&&!F.tokens&&(j=/^{([^}]+)}$/.exec(T)))return[new lt(l,T,`"${C}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const H=[];return u.layerType==="symbol"&&(C==="text-field"&&_&&!_.glyphs&&H.push(new lt(l,T,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&Yc(Rs(T))&&pi(T.type)==="identity"&&H.push(new lt(l,T,'"text-font" does not support identity functions'))),H.concat(p({key:u.key,value:T,valueSpec:F,style:_,styleSpec:b,expressionContext:"property",propertyType:s,propertyKey:C}))}function Zu(u){return nu(u,"paint")}function tl(u){return nu(u,"layout")}function gs(u){let s=[];const l=u.value,p=u.key,_=u.style,b=u.styleSpec;if(Mn(l)!=="object")return[new lt(p,l,`object expected, ${Mn(l)} found`)];l.type||l.ref||s.push(new lt(p,l,'either "type" or "ref" is required'));let T=pi(l.type);const C=pi(l.ref);if(l.id){const M=pi(l.id);for(let O=0;O<u.arrayIndex;O++){const F=_.layers[O];pi(F.id)===M&&s.push(new lt(p,l.id,`duplicate layer id "${l.id}", previously used at line ${F.id.__line__}`))}}if("ref"in l){let M;["type","source","source-layer","filter","layout"].forEach((O=>{O in l&&s.push(new lt(p,l[O],`"${O}" is prohibited for ref layers`))})),_.layers.forEach((O=>{pi(O.id)===C&&(M=O)})),M?M.ref?s.push(new lt(p,l.ref,"ref cannot reference another ref layer")):T=pi(M.type):s.push(new lt(p,l.ref,`ref layer "${C}" not found`))}else if(T!=="background")if(l.source){const M=_.sources&&_.sources[l.source],O=M&&pi(M.type);M?O==="vector"&&T==="raster"?s.push(new lt(p,l.source,`layer "${l.id}" requires a raster source`)):O!=="raster-dem"&&T==="hillshade"||O!=="raster-dem"&&T==="color-relief"?s.push(new lt(p,l.source,`layer "${l.id}" requires a raster-dem source`)):O==="raster"&&T!=="raster"?s.push(new lt(p,l.source,`layer "${l.id}" requires a vector source`)):O!=="vector"||l["source-layer"]?O==="raster-dem"&&T!=="hillshade"&&T!=="color-relief"?s.push(new lt(p,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):T!=="line"||!l.paint||!l.paint["line-gradient"]||O==="geojson"&&M.lineMetrics||s.push(new lt(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new lt(p,l,`layer "${l.id}" must specify a "source-layer"`)):s.push(new lt(p,l.source,`source "${l.source}" not found`))}else s.push(new lt(p,l,'missing required property "source"'));return s=s.concat(ki({key:p,value:l,valueSpec:b.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${p}.type`,value:l.type,valueSpec:b.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:l,objectKey:"type"}),filter:Qa,layout:M=>ki({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":O=>tl(bi({layerType:T},O))}}),paint:M=>ki({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":O=>Zu(bi({layerType:T},O))}})}})),s}function Un(u){const s=u.value,l=u.key,p=Mn(s);return p!=="string"?[new lt(l,s,`string expected, ${p} found`)]:[]}const Ln={promoteId:function({key:u,value:s}){if(Mn(s)==="string")return Un({key:u,value:s});{const l=[];for(const p in s)l.push(...Un({key:`${u}.${p}`,value:s[p]}));return l}}};function _s(u){const s=u.value,l=u.key,p=u.styleSpec,_=u.style,b=u.validateSpec;if(!s.type)return[new lt(l,s,'"type" is required')];const T=pi(s.type);let C;switch(T){case"vector":case"raster":return C=ki({key:l,value:s,valueSpec:p[`source_${T.replace("-","_")}`],style:u.style,styleSpec:p,objectElementValidators:Ln,validateSpec:b}),C;case"raster-dem":return C=(function(M){var O;const F=(O=M.sourceName)!==null&&O!==void 0?O:"",j=M.value,H=M.styleSpec,X=H.source_raster_dem,G=M.style;let te=[];const oe=Mn(j);if(j===void 0)return te;if(oe!=="object")return te.push(new lt("source_raster_dem",j,`object expected, ${oe} found`)),te;const me=pi(j.encoding)==="custom",je=["redFactor","greenFactor","blueFactor","baseShift"],Te=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const Ie in j)!me&&je.includes(Ie)?te.push(new lt(Ie,j[Ie],`In "${F}": "${Ie}" is only valid when "encoding" is set to "custom". ${Te} encoding found`)):X[Ie]?te=te.concat(M.validateSpec({key:Ie,value:j[Ie],valueSpec:X[Ie],validateSpec:M.validateSpec,style:G,styleSpec:H})):te.push(new lt(Ie,j[Ie],`unknown property "${Ie}"`));return te})({sourceName:l,value:s,style:u.style,styleSpec:p,validateSpec:b}),C;case"geojson":if(C=ki({key:l,value:s,valueSpec:p.source_geojson,style:_,styleSpec:p,validateSpec:b,objectElementValidators:Ln}),s.cluster)for(const M in s.clusterProperties){const[O,F]=s.clusterProperties[M],j=typeof O=="string"?[O,["accumulated"],["get",M]]:O;C.push(...Ka({key:`${l}.${M}.map`,value:F,expressionContext:"cluster-map"})),C.push(...Ka({key:`${l}.${M}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return C;case"video":return ki({key:l,value:s,valueSpec:p.source_video,style:_,validateSpec:b,styleSpec:p});case"image":return ki({key:l,value:s,valueSpec:p.source_image,style:_,validateSpec:b,styleSpec:p});case"canvas":return[new lt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return to({key:`${l}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ir(u){const s=u.value,l=u.styleSpec,p=l.light,_=u.style;let b=[];const T=Mn(s);if(s===void 0)return b;if(T!=="object")return b=b.concat([new lt("light",s,`object expected, ${T} found`)]),b;for(const C in s){const M=C.match(/^(.*)-transition$/);b=b.concat(M&&p[M[1]]&&p[M[1]].transition?u.validateSpec({key:C,value:s[C],valueSpec:l.transition,validateSpec:u.validateSpec,style:_,styleSpec:l}):p[C]?u.validateSpec({key:C,value:s[C],valueSpec:p[C],validateSpec:u.validateSpec,style:_,styleSpec:l}):[new lt(C,s[C],`unknown property "${C}"`)])}return b}function Fr(u){const s=u.value,l=u.styleSpec,p=l.sky,_=u.style,b=Mn(s);if(s===void 0)return[];if(b!=="object")return[new lt("sky",s,`object expected, ${b} found`)];let T=[];for(const C in s)T=T.concat(p[C]?u.validateSpec({key:C,value:s[C],valueSpec:p[C],style:_,styleSpec:l}):[new lt(C,s[C],`unknown property "${C}"`)]);return T}function _a(u){const s=u.value,l=u.styleSpec,p=l.terrain,_=u.style;let b=[];const T=Mn(s);if(s===void 0)return b;if(T!=="object")return b=b.concat([new lt("terrain",s,`object expected, ${T} found`)]),b;for(const C in s)b=b.concat(p[C]?u.validateSpec({key:C,value:s[C],valueSpec:p[C],validateSpec:u.validateSpec,style:_,styleSpec:l}):[new lt(C,s[C],`unknown property "${C}"`)]);return b}function no(u){let s=[];const l=u.value,p=u.key;if(Array.isArray(l)){const _=[],b=[];for(const T in l)l[T].id&&_.includes(l[T].id)&&s.push(new lt(p,l,`all the sprites' ids must be unique, but ${l[T].id} is duplicated`)),_.push(l[T].id),l[T].url&&b.includes(l[T].url)&&s.push(new lt(p,l,`all the sprites' URLs must be unique, but ${l[T].url} is duplicated`)),b.push(l[T].url),s=s.concat(ki({key:`${p}[${T}]`,value:l[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return s}return Un({key:p,value:l})}function Sr(u){return s=u.value,s&&s.constructor===Object?[]:[new lt(u.key,u.value,`object expected, ${Mn(u.value)} found`)];var s}const nl={"*":()=>[],array:ga,boolean:function(u){const s=u.value,l=u.key,p=Mn(s);return p!=="boolean"?[new lt(l,s,`boolean expected, ${p} found`)]:[]},number:ks,color:Ja,constants:vo,enum:to,filter:Qa,function:tu,layer:gs,object:ki,source:_s,light:ir,sky:Fr,terrain:_a,projection:function(u){const s=u.value,l=u.styleSpec,p=l.projection,_=u.style,b=Mn(s);if(s===void 0)return[];if(b!=="object")return[new lt("projection",s,`object expected, ${b} found`)];let T=[];for(const C in s)T=T.concat(p[C]?u.validateSpec({key:C,value:s[C],valueSpec:p[C],style:_,styleSpec:l}):[new lt(C,s[C],`unknown property "${C}"`)]);return T},projectionDefinition:function(u){const s=u.key;let l=u.value;l=l instanceof String?l.valueOf():l;const p=Mn(l);return p!=="array"||(function(_){return Array.isArray(_)&&_.length===3&&typeof _[0]=="string"&&typeof _[1]=="string"&&typeof _[2]=="number"})(l)||(function(_){return!!["interpolate","step","literal"].includes(_[0])})(l)?["array","string"].includes(p)?[]:[new lt(s,l,`projection expected, invalid type "${p}" found`)]:[new lt(s,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]},string:Un,formatted:function(u){return Un(u).length===0?[]:Ka(u)},resolvedImage:function(u){return Un(u).length===0?[]:Ka(u)},padding:function(u){const s=u.key,l=u.value;if(Mn(l)==="array"){if(l.length<1||l.length>4)return[new lt(s,l,`padding requires 1 to 4 values; ${l.length} values found`)];const p={type:"number"};let _=[];for(let b=0;b<l.length;b++)_=_.concat(u.validateSpec({key:`${s}[${b}]`,value:l[b],validateSpec:u.validateSpec,valueSpec:p}));return _}return ks({key:s,value:l,valueSpec:{}})},numberArray:function(u){const s=u.key,l=u.value;if(Mn(l)==="array"){const p={type:"number"};if(l.length<1)return[new lt(s,l,"array length at least 1 expected, length 0 found")];let _=[];for(let b=0;b<l.length;b++)_=_.concat(u.validateSpec({key:`${s}[${b}]`,value:l[b],validateSpec:u.validateSpec,valueSpec:p}));return _}return ks({key:s,value:l,valueSpec:{}})},colorArray:function(u){const s=u.key,l=u.value;if(Mn(l)==="array"){if(l.length<1)return[new lt(s,l,"array length at least 1 expected, length 0 found")];let p=[];for(let _=0;_<l.length;_++)p=p.concat(Ja({key:`${s}[${_}]`,value:l[_]}));return p}return Ja({key:s,value:l})},variableAnchorOffsetCollection:function(u){const s=u.key,l=u.value,p=Mn(l),_=u.styleSpec;if(p!=="array"||l.length<1||l.length%2!=0)return[new lt(s,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let T=0;T<l.length;T+=2)b=b.concat(to({key:`${s}[${T}]`,value:l[T],valueSpec:_.layout_symbol["text-anchor"]})),b=b.concat(ga({key:`${s}[${T+1}]`,value:l[T+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:_}));return b},sprite:no,state:Sr};function iu(u){const s=u.value,l=u.valueSpec,p=u.styleSpec;return u.validateSpec=iu,l.expression&&Yc(pi(s))?tu(u):l.expression&&ma(Rs(s))?Ka(u):l.type&&nl[l.type]?nl[l.type](u):ki(bi({},u,{valueSpec:l.type?p[l.type]:l}))}function ru(u){const s=u.value,l=u.key,p=Un(u);return p.length||(s.indexOf("{fontstack}")===-1&&p.push(new lt(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&p.push(new lt(l,s,'"glyphs" url must include a "{range}" token'))),p}function Nr(u,s=Be){let l=[];return l=l.concat(iu({key:"",value:u,valueSpec:s.$root,styleSpec:s,style:u,validateSpec:iu,objectElementValidators:{glyphs:ru,"*":()=>[]}})),u.constants&&(l=l.concat(vo({key:"constants",value:u.constants}))),xo(l)}function Ar(u){return function(s){return u(Object.assign({},s,{validateSpec:iu}))}}function xo(u){return[].concat(u).sort(((s,l)=>s.line-l.line))}function Qr(u){return function(...s){return xo(u.apply(this,s))}}Nr.source=Qr(Ar(_s)),Nr.sprite=Qr(Ar(no)),Nr.glyphs=Qr(Ar(ru)),Nr.light=Qr(Ar(ir)),Nr.sky=Qr(Ar(Fr)),Nr.terrain=Qr(Ar(_a)),Nr.state=Qr(Ar(Sr)),Nr.layer=Qr(Ar(gs)),Nr.filter=Qr(Ar(Qa)),Nr.paintProperty=Qr(Ar(Zu)),Nr.layoutProperty=Qr(Ar(tl));const ya=Nr,ec=ya.light,Gp=ya.sky,va=ya.paintProperty,Bo=ya.layoutProperty;function il(u,s){let l=!1;if(s&&s.length)for(const p of s)u.fire(new at(new Error(p.message))),l=!0;return l}class bo{constructor(s,l,p){const _=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const T=new Int32Array(this.arrayBuffer);s=T[0],this.d=(l=T[1])+2*(p=T[2]);for(let M=0;M<this.d*this.d;M++){const O=T[3+M],F=T[3+M+1];_.push(O===F?null:T.subarray(O,F))}const C=T[3+_.length+1];this.keys=T.subarray(T[3+_.length],C),this.bboxes=T.subarray(C),this.insert=this._insertReadonly}else{this.d=l+2*p;for(let T=0;T<this.d*this.d;T++)_.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=s,this.padding=p,this.scale=l/s,this.uid=0;const b=p/l*s;this.min=-b,this.max=s+b}insert(s,l,p,_,b){this._forEachCell(l,p,_,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,l,p,_,b,T){this.cells[b].push(T)}query(s,l,p,_,b){const T=this.min,C=this.max;if(s<=T&&l<=T&&C<=p&&C<=_&&!b)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(s,l,p,_,this._queryCell,M,{},b),M}}_queryCell(s,l,p,_,b,T,C,M){const O=this.cells[b];if(O!==null){const F=this.keys,j=this.bboxes;for(let H=0;H<O.length;H++){const X=O[H];if(C[X]===void 0){const G=4*X;(M?M(j[G+0],j[G+1],j[G+2],j[G+3]):s<=j[G+2]&&l<=j[G+3]&&p>=j[G+0]&&_>=j[G+1])?(C[X]=!0,T.push(F[X])):C[X]=!1}}}}_forEachCell(s,l,p,_,b,T,C,M){const O=this._convertToCellCoord(s),F=this._convertToCellCoord(l),j=this._convertToCellCoord(p),H=this._convertToCellCoord(_);for(let X=O;X<=j;X++)for(let G=F;G<=H;G++){const te=this.d*G+X;if((!M||M(this._convertFromCellCoord(X),this._convertFromCellCoord(G),this._convertFromCellCoord(X+1),this._convertFromCellCoord(G+1)))&&b.call(this,s,l,p,_,te,T,C,M))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,l=3+this.cells.length+1+1;let p=0;for(let T=0;T<this.cells.length;T++)p+=this.cells[T].length;const _=new Int32Array(l+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let b=l;for(let T=0;T<s.length;T++){const C=s[T];_[3+T]=b,_.set(C,b),b+=C.length}return _[3+s.length]=b,_.set(this.keys,b),b+=this.keys.length,_[3+s.length+1]=b,_.set(this.bboxes,b),b+=this.bboxes.length,_.buffer}static serialize(s,l){const p=s.toArrayBuffer();return l&&l.push(p),{buffer:p}}static deserialize(s){return new bo(s.buffer)}}const Br={};function Ct(u,s,l={}){if(Br[u])throw new Error(`${u} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:u,writeable:!1}),Br[u]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}Ct("Object",Object),Ct("Set",Set),Ct("TransferableGridIndex",bo),Ct("Color",An),Ct("Error",Error),Ct("AJAXError",we),Ct("ResolvedImage",fs),Ct("StylePropertyFunction",_o),Ct("StyleExpression",ql,{omit:["_evaluator"]}),Ct("ZoomDependentExpression",qa),Ct("ZoomConstantExpression",Xa),Ct("CompoundExpression",ms,{omit:["_evaluate"]});for(const u in da)da[u]._classRegistryKey||Ct(`Expression_${u}`,da[u]);function es(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function wo(u){return u.$name||u.constructor._classRegistryKey}function io(u){return!(function(s){if(s===null||typeof s!="object")return!1;const l=wo(s);return!(!l||l==="Object")})(u)&&(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||es(u)||Sn(u)||ArrayBuffer.isView(u)||u instanceof ImageData)}function zr(u,s){if(io(u))return(es(u)||Sn(u))&&s&&s.push(u),ArrayBuffer.isView(u)&&s&&s.push(u.buffer),u instanceof ImageData&&s&&s.push(u.data.buffer),u;if(Array.isArray(u)){const b=[];for(const T of u)b.push(zr(T,s));return b}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);const l=wo(u);if(!l)throw new Error(`can't serialize object of unregistered class ${u.constructor.name}`);if(!Br[l])throw new Error(`${l} is not registered.`);const{klass:p}=Br[l],_=p.serialize?p.serialize(u,s):{};if(p.serialize){if(s&&_===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in u){if(!u.hasOwnProperty(b)||Br[l].omit.indexOf(b)>=0)continue;const T=u[b];_[b]=Br[l].shallow.indexOf(b)>=0?T:zr(T,s)}u instanceof Error&&(_.message=u.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(_.$name=l),_}function Ds(u){if(io(u))return u;if(Array.isArray(u))return u.map(Ds);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);const s=wo(u)||"Object";if(!Br[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:l}=Br[s];if(!l)throw new Error(`can't deserialize unregistered class ${s}`);if(l.deserialize)return l.deserialize(u);const p=Object.create(l.prototype);for(const _ of Object.keys(u)){if(_==="$name")continue;const b=u[_];p[_]=Br[s].shallow.indexOf(_)>=0?b:Ds(b)}return p}class Xu{constructor(){this.first=!0}update(s,l){const p=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=l),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=p,!0))}}const Rn={"Latin-1 Supplement":u=>u>=128&&u<=255,"Hangul Jamo":u=>u>=4352&&u<=4607,Khmer:u=>u>=6016&&u<=6143,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Kanbun:u=>u>=12688&&u<=12703,"CJK Strokes":u=>u>=12736&&u<=12783,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Hangul Syllables":u=>u>=44032&&u<=55215,"Private Use Area":u=>u>=57344&&u<=63743,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function su(u){for(const s of u)if(qu(s.charCodeAt(0)))return!0;return!1}function ts(u){for(const s of u)if(!Os(s.charCodeAt(0)))return!1;return!0}function Ur(u){const s=u.map((l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}})).filter((l=>l));return new RegExp(s.join("|"),"u")}const vi=Ur(["Arab","Dupl","Mong","Ougr","Syrc"]);function Os(u){return!vi.test(String.fromCodePoint(u))}const od=Ur(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function qu(u){return!(u!==746&&u!==747&&(u<4352||!(Rn["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Rn["CJK Compatibility"](u)||Rn["CJK Strokes"](u)||!(!Rn["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Rn["Enclosed CJK Letters and Months"](u)||Rn["Ideographic Description Characters"](u)||Rn.Kanbun(u)||Rn.Katakana(u)&&u!==12540||!(!Rn["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Rn["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Rn["Vertical Forms"](u)||Rn["Yijing Hexagram Symbols"](u)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(u))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(u))||od.test(String.fromCodePoint(u)))))}function ou(u){return!(qu(u)||(function(s){return!!(Rn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Rn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Rn["Letterlike Symbols"](s)||Rn["Number Forms"](s)||Rn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Rn["Control Pictures"](s)&&s!==9251||Rn["Optical Character Recognition"](s)||Rn["Enclosed Alphanumerics"](s)||Rn["Geometric Shapes"](s)||Rn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Rn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Rn["CJK Symbols and Punctuation"](s)||Rn.Katakana(s)||Rn["Private Use Area"](s)||Rn["CJK Compatibility Forms"](s)||Rn["Small Form Variants"](s)||Rn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)})(u))}const Gu=Ur(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Yu(u){return Gu.test(String.fromCodePoint(u))}function au(u,s){return!(!s&&Yu(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Rn.Khmer(u))}function lu(u){for(const s of u)if(Yu(s.charCodeAt(0)))return!0;return!1}const ys=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){if(ys.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(u,s){return a(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(u.pluginStatus!=="loading")return this.setState(u),u;const l=u.pluginURL,p=new Promise((b=>{this.loadScriptResolve=b}));s(l);const _=new Promise((b=>setTimeout((()=>b()),this.TIMEOUT)));if(yield Promise.race([p,_]),this.isParsed()){const b={pluginStatus:"loaded",pluginURL:l};return this.setState(b),b}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${l}`)}))}};class Xn{constructor(s,l){this.isSupportedScript=Yp,this.zoom=s,l?(this.now=l.now||0,this.fadeDuration=l.fadeDuration||0,this.zoomHistory=l.zoomHistory||new Xu,this.transition=l.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Xu,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,l=s-Math.floor(s),p=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*l}}}function Yp(u){return(function(s,l){for(const p of s)if(!au(p.charCodeAt(0),l))return!1;return!0})(u,ys.getRTLTextPluginStatus()==="loaded")}class xa{constructor(s,l,p){this.property=s,this.value=l,this.expression=(function(_,b,T){if(Yc(_))return new _o(_,b);if(ma(_)){const C=Kc(_,b,T);if(C.result==="error")throw new Error(C.value.map((M=>`${M.key}: ${M.message}`)).join(", "));return C.value}{let C=_;return b.type==="color"&&typeof _=="string"?C=An.parse(_):b.type!=="padding"||typeof _!="number"&&!Array.isArray(_)?b.type!=="numberArray"||typeof _!="number"&&!Array.isArray(_)?b.type!=="colorArray"||typeof _!="string"&&!Array.isArray(_)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(_)?C=Ki.parse(_):b.type==="projectionDefinition"&&typeof _=="string"&&(C=fr.parse(_)):C=li.parse(_):C=Yi.parse(_):C=Ri.parse(_),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>C}}})(l===void 0?s.specification.default:l,s.specification,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(s,l,p){return this.property.possiblyEvaluate(this,s,l,p)}}class rl{constructor(s,l){this.property=s,this.value=new xa(s,void 0,l)}transitioned(s,l){return new Ju(this.property,this.value,l,Ut({},s.transition,this.transition),s.now)}untransitioned(){return new Ju(this.property,this.value,null,{},0)}}class Ku{constructor(s,l){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._globalState=l}getValue(s){return Ii(this._values[s].value.value)}setValue(s,l){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new rl(this._values[s].property,this._globalState)),this._values[s].value=new xa(this._values[s].property,l===null?void 0:Ii(l),this._globalState)}getTransition(s){return Ii(this._values[s].transition)}setTransition(s,l){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new rl(this._values[s].property,this._globalState)),this._values[s].transition=Ii(l)||void 0}serialize(){const s={};for(const l of Object.keys(this._values)){const p=this.getValue(l);p!==void 0&&(s[l]=p);const _=this.getTransition(l);_!==void 0&&(s[`${l}-transition`]=_)}return s}transitioned(s,l){const p=new sl(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(s,l._values[_]);return p}untransitioned(){const s=new sl(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].untransitioned();return s}}class Ju{constructor(s,l,p,_,b){this.property=s,this.value=l,this.begin=b+_.delay||0,this.end=this.begin+_.duration||0,s.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(s,l,p){const _=s.now||0,b=this.value.possiblyEvaluate(s,l,p),T=this.prior;if(T){if(_>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(_<this.begin)return T.possiblyEvaluate(s,l,p);{const C=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(s,l,p),b,ut(C))}}return b}}class sl{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,l,p){const _=new ol(this._properties);for(const b of Object.keys(this._values))_._values[b]=this._values[b].possiblyEvaluate(s,l,p);return _}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class cf{constructor(s,l){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._globalState=l}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Ii(this._values[s].value)}setValue(s,l){this._values[s]=new xa(this._values[s].property,l===null?void 0:Ii(l),this._globalState)}serialize(){const s={};for(const l of Object.keys(this._values)){const p=this.getValue(l);p!==void 0&&(s[l]=p)}return s}possiblyEvaluate(s,l,p){const _=new ol(this._properties);for(const b of Object.keys(this._values))_._values[b]=this._values[b].possiblyEvaluate(s,l,p);return _}}class vs{constructor(s,l,p){this.property=s,this.value=l,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,l,p,_){return this.property.evaluate(this.value,this.parameters,s,l,p,_)}}class ol{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class jt{constructor(s){this.specification=s}possiblyEvaluate(s,l){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(l)}interpolate(s,l,p){const _=Ks[this.specification.type];return _?_(s,l,p):s}}class qt{constructor(s,l){this.specification=s,this.overrides=l}possiblyEvaluate(s,l,p,_){return new vs(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(l,null,{},p,_)}:s.expression,l)}interpolate(s,l,p){if(s.value.kind!=="constant"||l.value.kind!=="constant")return s;if(s.value.value===void 0||l.value.value===void 0)return new vs(this,{kind:"constant",value:void 0},s.parameters);const _=Ks[this.specification.type];if(_){const b=_(s.value.value,l.value.value,p);return new vs(this,{kind:"constant",value:b},s.parameters)}return s}evaluate(s,l,p,_,b,T){return s.kind==="constant"?s.value:s.evaluate(l,p,_,b,T)}}class al extends qt{possiblyEvaluate(s,l,p,_){if(s.value===void 0)return new vs(this,{kind:"constant",value:void 0},l);if(s.expression.kind==="constant"){const b=s.expression.evaluate(l,null,{},p,_),T=s.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,C=this._calculate(T,T,T,l);return new vs(this,{kind:"constant",value:C},l)}if(s.expression.kind==="camera"){const b=this._calculate(s.expression.evaluate({zoom:l.zoom-1}),s.expression.evaluate({zoom:l.zoom}),s.expression.evaluate({zoom:l.zoom+1}),l);return new vs(this,{kind:"constant",value:b},l)}return new vs(this,s.expression,l)}evaluate(s,l,p,_,b,T){if(s.kind==="source"){const C=s.evaluate(l,p,_,b,T);return this._calculate(C,C,C,l)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(l.zoom)-1},p,_),s.evaluate({zoom:Math.floor(l.zoom)},p,_),s.evaluate({zoom:Math.floor(l.zoom)+1},p,_),l):s.value}_calculate(s,l,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:p,to:l}}interpolate(s){return s}}class Qu{constructor(s){this.specification=s}possiblyEvaluate(s,l,p,_){if(s.value!==void 0){if(s.expression.kind==="constant"){const b=s.expression.evaluate(l,null,{},p,_);return this._calculate(b,b,b,l)}return this._calculate(s.expression.evaluate(new Xn(Math.floor(l.zoom-1),l)),s.expression.evaluate(new Xn(Math.floor(l.zoom),l)),s.expression.evaluate(new Xn(Math.floor(l.zoom+1),l)),l)}}_calculate(s,l,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:p,to:l}}interpolate(s){return s}}class tc{constructor(s){this.specification=s}possiblyEvaluate(s,l,p,_){return!!s.expression.evaluate(l,null,{},p,_)}interpolate(){return!1}}class zi{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in s){const p=s[l];p.specification.overridable&&this.overridableProperties.push(l);const _=this.defaultPropertyValues[l]=new xa(p,void 0,void 0),b=this.defaultTransitionablePropertyValues[l]=new rl(p,void 0);this.defaultTransitioningPropertyValues[l]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=_.possiblyEvaluate({})}}}Ct("DataDrivenProperty",qt),Ct("DataConstantProperty",jt),Ct("CrossFadedDataDrivenProperty",al),Ct("CrossFadedProperty",Qu),Ct("ColorRampProperty",tc);const xs="-transition";class pr extends zt{constructor(s,l,p){if(super(),this.id=s.id,this.type=s.type,this._globalState=p,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter,this._featureFilter=yo(s.filter,p)),l.layout&&(this._unevaluatedLayout=new cf(l.layout,p)),l.paint)){this._transitionablePaint=new Ku(l.paint,p);for(const _ in s.paint)this.setPaintProperty(_,s.paint[_],{validate:!1});for(const _ in s.layout)this.setLayoutProperty(_,s.layout[_],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ol(l.paint)}}setFilter(s){this.filter=s,this._featureFilter=yo(s,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}getLayoutAffectingGlobalStateRefs(){const s=new Set;if(this._unevaluatedLayout)for(const l in this._unevaluatedLayout._values){const p=this._unevaluatedLayout._values[l];for(const _ of p.getGlobalStateRefs())s.add(_)}for(const l of this._featureFilter.getGlobalStateRefs())s.add(l);return s}getPaintAffectingGlobalStateRefs(){var s;const l=new globalThis.Map;if(this._transitionablePaint)for(const p in this._transitionablePaint._values){const _=this._transitionablePaint._values[p].value;for(const b of _.getGlobalStateRefs()){const T=(s=l.get(b))!==null&&s!==void 0?s:[];T.push({name:p,value:_.value}),l.set(b,T)}}return l}setLayoutProperty(s,l,p={}){l!=null&&this._validate(Bo,`layers.${this.id}.layout.${s}`,s,l,p)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,l):this.visibility=l)}getPaintProperty(s){return s.endsWith(xs)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,l,p={}){if(l!=null&&this._validate(va,`layers.${this.id}.paint.${s}`,s,l,p))return!1;if(s.endsWith(xs))return this._transitionablePaint.setTransition(s.slice(0,-11),l||void 0),!1;{const _=this._transitionablePaint._values[s],b=_.property.specification["property-type"]==="cross-faded-data-driven",T=_.value.isDataDriven(),C=_.value;this._transitionablePaint.setValue(s,l),this._handleSpecialPaintPropertyUpdate(s);const M=this._transitionablePaint._values[s].value;return M.isDataDriven()||T||b||this._handleOverridablePaintPropertyUpdate(s,C,M)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,l,p){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,l){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,l)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Gi(s,((l,p)=>!(l===void 0||p==="layout"&&!Object.keys(l).length||p==="paint"&&!Object.keys(l).length)))}_validate(s,l,p,_,b={}){return(!b||b.validate!==!1)&&il(this,s.call(ya,{key:l,layerType:this.type,objectKey:p,value:_,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const l=this.paint.get(s);if(l instanceof vs&&Fo(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const zo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ll{constructor(s,l){this._structArray=s,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Vn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,l){return s._trim(),l&&(s.isTransferred=!0,l.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const l=Object.create(this.prototype);return l.arrayBuffer=s.arrayBuffer,l.length=s.length,l.capacity=s.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Jn(u,s=1){let l=0,p=0;return{members:u.map((_=>{const b=zo[_.type].BYTES_PER_ELEMENT,T=l=nc(l,Math.max(s,b)),C=_.components||1;return p=Math.max(p,b),l+=b*C,{name:_.name,type:_.type,components:C,offset:T}})),size:nc(l,Math.max(p,s)),alignment:s}}function nc(u,s){return Math.ceil(u/s)*s}class ic extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l){const p=this.length;return this.resize(p+1),this.emplace(p,s,l)}emplace(s,l,p){const _=2*s;return this.int16[_+0]=l,this.int16[_+1]=p,s}}ic.prototype.bytesPerElement=4,Ct("StructArrayLayout2i4",ic);class jr extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,l,p)}emplace(s,l,p,_){const b=3*s;return this.int16[b+0]=l,this.int16[b+1]=p,this.int16[b+2]=_,s}}jr.prototype.bytesPerElement=6,Ct("StructArrayLayout3i6",jr);class ns extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,s,l,p,_)}emplace(s,l,p,_,b){const T=4*s;return this.int16[T+0]=l,this.int16[T+1]=p,this.int16[T+2]=_,this.int16[T+3]=b,s}}ns.prototype.bytesPerElement=8,Ct("StructArrayLayout4i8",ns);class rc extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T){const C=this.length;return this.resize(C+1),this.emplace(C,s,l,p,_,b,T)}emplace(s,l,p,_,b,T,C){const M=6*s;return this.int16[M+0]=l,this.int16[M+1]=p,this.int16[M+2]=_,this.int16[M+3]=b,this.int16[M+4]=T,this.int16[M+5]=C,s}}rc.prototype.bytesPerElement=12,Ct("StructArrayLayout2i4i12",rc);class cu extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T){const C=this.length;return this.resize(C+1),this.emplace(C,s,l,p,_,b,T)}emplace(s,l,p,_,b,T,C){const M=4*s,O=8*s;return this.int16[M+0]=l,this.int16[M+1]=p,this.uint8[O+4]=_,this.uint8[O+5]=b,this.uint8[O+6]=T,this.uint8[O+7]=C,s}}cu.prototype.bytesPerElement=8,Ct("StructArrayLayout2i4ub8",cu);class Ls extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l){const p=this.length;return this.resize(p+1),this.emplace(p,s,l)}emplace(s,l,p){const _=2*s;return this.float32[_+0]=l,this.float32[_+1]=p,s}}Ls.prototype.bytesPerElement=8,Ct("StructArrayLayout2f8",Ls);class eh extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M,O,F){const j=this.length;return this.resize(j+1),this.emplace(j,s,l,p,_,b,T,C,M,O,F)}emplace(s,l,p,_,b,T,C,M,O,F,j){const H=10*s;return this.uint16[H+0]=l,this.uint16[H+1]=p,this.uint16[H+2]=_,this.uint16[H+3]=b,this.uint16[H+4]=T,this.uint16[H+5]=C,this.uint16[H+6]=M,this.uint16[H+7]=O,this.uint16[H+8]=F,this.uint16[H+9]=j,s}}eh.prototype.bytesPerElement=20,Ct("StructArrayLayout10ui20",eh);class cl extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M){const O=this.length;return this.resize(O+1),this.emplace(O,s,l,p,_,b,T,C,M)}emplace(s,l,p,_,b,T,C,M,O){const F=8*s;return this.uint16[F+0]=l,this.uint16[F+1]=p,this.uint16[F+2]=_,this.uint16[F+3]=b,this.uint16[F+4]=T,this.uint16[F+5]=C,this.uint16[F+6]=M,this.uint16[F+7]=O,s}}cl.prototype.bytesPerElement=16,Ct("StructArrayLayout8ui16",cl);class bs extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M,O,F,j,H){const X=this.length;return this.resize(X+1),this.emplace(X,s,l,p,_,b,T,C,M,O,F,j,H)}emplace(s,l,p,_,b,T,C,M,O,F,j,H,X){const G=12*s;return this.int16[G+0]=l,this.int16[G+1]=p,this.int16[G+2]=_,this.int16[G+3]=b,this.uint16[G+4]=T,this.uint16[G+5]=C,this.uint16[G+6]=M,this.uint16[G+7]=O,this.int16[G+8]=F,this.int16[G+9]=j,this.int16[G+10]=H,this.int16[G+11]=X,s}}bs.prototype.bytesPerElement=24,Ct("StructArrayLayout4i4ui4i24",bs);class ul extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,l,p)}emplace(s,l,p,_){const b=3*s;return this.float32[b+0]=l,this.float32[b+1]=p,this.float32[b+2]=_,s}}ul.prototype.bytesPerElement=12,Ct("StructArrayLayout3f12",ul);class x extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint32[1*s+0]=l,s}}x.prototype.bytesPerElement=4,Ct("StructArrayLayout1ul4",x);class r extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M,O){const F=this.length;return this.resize(F+1),this.emplace(F,s,l,p,_,b,T,C,M,O)}emplace(s,l,p,_,b,T,C,M,O,F){const j=10*s,H=5*s;return this.int16[j+0]=l,this.int16[j+1]=p,this.int16[j+2]=_,this.int16[j+3]=b,this.int16[j+4]=T,this.int16[j+5]=C,this.uint32[H+3]=M,this.uint16[j+8]=O,this.uint16[j+9]=F,s}}r.prototype.bytesPerElement=20,Ct("StructArrayLayout6i1ul2ui20",r);class h extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T){const C=this.length;return this.resize(C+1),this.emplace(C,s,l,p,_,b,T)}emplace(s,l,p,_,b,T,C){const M=6*s;return this.int16[M+0]=l,this.int16[M+1]=p,this.int16[M+2]=_,this.int16[M+3]=b,this.int16[M+4]=T,this.int16[M+5]=C,s}}h.prototype.bytesPerElement=12,Ct("StructArrayLayout2i2i2i12",h);class m extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,s,l,p,_,b)}emplace(s,l,p,_,b,T){const C=4*s,M=8*s;return this.float32[C+0]=l,this.float32[C+1]=p,this.float32[C+2]=_,this.int16[M+6]=b,this.int16[M+7]=T,s}}m.prototype.bytesPerElement=16,Ct("StructArrayLayout2f1f2i16",m);class y extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T){const C=this.length;return this.resize(C+1),this.emplace(C,s,l,p,_,b,T)}emplace(s,l,p,_,b,T,C){const M=16*s,O=4*s,F=8*s;return this.uint8[M+0]=l,this.uint8[M+1]=p,this.float32[O+1]=_,this.float32[O+2]=b,this.int16[F+6]=T,this.int16[F+7]=C,s}}y.prototype.bytesPerElement=16,Ct("StructArrayLayout2ub2f2i16",y);class w extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,l,p)}emplace(s,l,p,_){const b=3*s;return this.uint16[b+0]=l,this.uint16[b+1]=p,this.uint16[b+2]=_,s}}w.prototype.bytesPerElement=6,Ct("StructArrayLayout3ui6",w);class P extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M,O,F,j,H,X,G,te,oe,me){const je=this.length;return this.resize(je+1),this.emplace(je,s,l,p,_,b,T,C,M,O,F,j,H,X,G,te,oe,me)}emplace(s,l,p,_,b,T,C,M,O,F,j,H,X,G,te,oe,me,je){const Te=24*s,Ie=12*s,Je=48*s;return this.int16[Te+0]=l,this.int16[Te+1]=p,this.uint16[Te+2]=_,this.uint16[Te+3]=b,this.uint32[Ie+2]=T,this.uint32[Ie+3]=C,this.uint32[Ie+4]=M,this.uint16[Te+10]=O,this.uint16[Te+11]=F,this.uint16[Te+12]=j,this.float32[Ie+7]=H,this.float32[Ie+8]=X,this.uint8[Je+36]=G,this.uint8[Je+37]=te,this.uint8[Je+38]=oe,this.uint32[Ie+10]=me,this.int16[Te+22]=je,s}}P.prototype.bytesPerElement=48,Ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",P);class R extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M,O,F,j,H,X,G,te,oe,me,je,Te,Ie,Je,st,ft,Ot,St,Rt,Gt,Mt){const kt=this.length;return this.resize(kt+1),this.emplace(kt,s,l,p,_,b,T,C,M,O,F,j,H,X,G,te,oe,me,je,Te,Ie,Je,st,ft,Ot,St,Rt,Gt,Mt)}emplace(s,l,p,_,b,T,C,M,O,F,j,H,X,G,te,oe,me,je,Te,Ie,Je,st,ft,Ot,St,Rt,Gt,Mt,kt){const ct=32*s,ln=16*s;return this.int16[ct+0]=l,this.int16[ct+1]=p,this.int16[ct+2]=_,this.int16[ct+3]=b,this.int16[ct+4]=T,this.int16[ct+5]=C,this.int16[ct+6]=M,this.int16[ct+7]=O,this.uint16[ct+8]=F,this.uint16[ct+9]=j,this.uint16[ct+10]=H,this.uint16[ct+11]=X,this.uint16[ct+12]=G,this.uint16[ct+13]=te,this.uint16[ct+14]=oe,this.uint16[ct+15]=me,this.uint16[ct+16]=je,this.uint16[ct+17]=Te,this.uint16[ct+18]=Ie,this.uint16[ct+19]=Je,this.uint16[ct+20]=st,this.uint16[ct+21]=ft,this.uint16[ct+22]=Ot,this.uint32[ln+12]=St,this.float32[ln+13]=Rt,this.float32[ln+14]=Gt,this.uint16[ct+30]=Mt,this.uint16[ct+31]=kt,s}}R.prototype.bytesPerElement=64,Ct("StructArrayLayout8i15ui1ul2f2ui64",R);class D extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.float32[1*s+0]=l,s}}D.prototype.bytesPerElement=4,Ct("StructArrayLayout1f4",D);class B extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,l,p)}emplace(s,l,p,_){const b=3*s;return this.uint16[6*s+0]=l,this.float32[b+1]=p,this.float32[b+2]=_,s}}B.prototype.bytesPerElement=12,Ct("StructArrayLayout1ui2f12",B);class U extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,l,p)}emplace(s,l,p,_){const b=4*s;return this.uint32[2*s+0]=l,this.uint16[b+2]=p,this.uint16[b+3]=_,s}}U.prototype.bytesPerElement=8,Ct("StructArrayLayout1ul2ui8",U);class W extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l){const p=this.length;return this.resize(p+1),this.emplace(p,s,l)}emplace(s,l,p){const _=2*s;return this.uint16[_+0]=l,this.uint16[_+1]=p,s}}W.prototype.bytesPerElement=4,Ct("StructArrayLayout2ui4",W);class $ extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint16[1*s+0]=l,s}}$.prototype.bytesPerElement=2,Ct("StructArrayLayout1ui2",$);class Z extends Vn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,s,l,p,_)}emplace(s,l,p,_,b){const T=4*s;return this.float32[T+0]=l,this.float32[T+1]=p,this.float32[T+2]=_,this.float32[T+3]=b,s}}Z.prototype.bytesPerElement=16,Ct("StructArrayLayout4f16",Z);class Q extends ll{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new v(this.anchorPointX,this.anchorPointY)}}Q.prototype.size=20;class re extends r{get(s){return new Q(this,s)}}Ct("CollisionBoxArray",re);class ae extends ll{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ae.prototype.size=48;class le extends P{get(s){return new ae(this,s)}}Ct("PlacedSymbolArray",le);class pe extends ll{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}pe.prototype.size=64;class be extends R{get(s){return new pe(this,s)}}Ct("SymbolInstanceArray",be);class fe extends D{getoffsetX(s){return this.float32[1*s+0]}}Ct("GlyphOffsetArray",fe);class Ae extends jr{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}Ct("SymbolLineVertexArray",Ae);class Me extends ll{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Me.prototype.size=12;class xe extends B{get(s){return new Me(this,s)}}Ct("TextAnchorOffsetArray",xe);class Re extends ll{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Re.prototype.size=8;class Ge extends U{get(s){return new Re(this,s)}}Ct("FeatureIndexArray",Ge);class qe extends ic{}class Ye extends ic{}class tt extends ic{}class bt extends rc{}class _t extends cu{}class ht extends Ls{}class Bt extends eh{}class xn extends cl{}class qn extends bs{}class ui extends ul{}class oi extends x{}class ni extends h{}class hi extends y{}class Di extends w{}class ii extends W{}const Qn=Jn([{name:"a_pos",components:2,type:"Int16"}],4),{members:mi}=Qn;class En{constructor(s=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=s}prepareSegment(s,l,p,_){const b=this.segments[this.segments.length-1];return s>En.MAX_VERTEX_ARRAY_LENGTH&&ri(`Max vertices per segment is ${En.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${En.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!b||b.vertexLength+s>En.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==_?this.createNewSegment(l,p,_):b}createNewSegment(s,l,p){const _={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(_.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(_),_}getOrCreateLatestSegment(s,l,p){return this.prepareSegment(0,s,l,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const s of this.segments)for(const l in s.vaos)s.vaos[l].destroy()}static simpleSegment(s,l,p,_){return new En([{vertexOffset:s,primitiveOffset:l,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function rr(u,s){return 256*(u=$t(Math.floor(u),0,255))+$t(Math.floor(s),0,255)}En.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct("SegmentVector",En);const To=Jn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ba=Jn([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var So,wa,sc,Uo={exports:{}},hl={exports:{}},is={exports:{}},Ta=(function(){if(sc)return Uo.exports;sc=1;var u=(So||(So=1,hl.exports=function(l,p){var _,b,T,C,M,O,F,j;for(b=l.length-(_=3&l.length),T=p,M=3432918353,O=461845907,j=0;j<b;)F=255&l.charCodeAt(j)|(255&l.charCodeAt(++j))<<8|(255&l.charCodeAt(++j))<<16|(255&l.charCodeAt(++j))<<24,++j,T=27492+(65535&(C=5*(65535&(T=(T^=F=(65535&(F=(F=(65535&F)*M+(((F>>>16)*M&65535)<<16)&4294967295)<<15|F>>>17))*O+(((F>>>16)*O&65535)<<16)&4294967295)<<13|T>>>19))+((5*(T>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(F=0,_){case 3:F^=(255&l.charCodeAt(j+2))<<16;case 2:F^=(255&l.charCodeAt(j+1))<<8;case 1:T^=F=(65535&(F=(F=(65535&(F^=255&l.charCodeAt(j)))*M+(((F>>>16)*M&65535)<<16)&4294967295)<<15|F>>>17))*O+(((F>>>16)*O&65535)<<16)&4294967295}return T^=l.length,T=2246822507*(65535&(T^=T>>>16))+((2246822507*(T>>>16)&65535)<<16)&4294967295,T=3266489909*(65535&(T^=T>>>13))+((3266489909*(T>>>16)&65535)<<16)&4294967295,(T^=T>>>16)>>>0}),hl.exports),s=(wa||(wa=1,is.exports=function(l,p){for(var _,b=l.length,T=p^b,C=0;b>=4;)_=1540483477*(65535&(_=255&l.charCodeAt(C)|(255&l.charCodeAt(++C))<<8|(255&l.charCodeAt(++C))<<16|(255&l.charCodeAt(++C))<<24))+((1540483477*(_>>>16)&65535)<<16),T=1540483477*(65535&T)+((1540483477*(T>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),b-=4,++C;switch(b){case 3:T^=(255&l.charCodeAt(C+2))<<16;case 2:T^=(255&l.charCodeAt(C+1))<<8;case 1:T=1540483477*(65535&(T^=255&l.charCodeAt(C)))+((1540483477*(T>>>16)&65535)<<16)}return T=1540483477*(65535&(T^=T>>>13))+((1540483477*(T>>>16)&65535)<<16),(T^=T>>>15)>>>0}),is.exports);return Uo.exports=u,Uo.exports.murmur3=u,Uo.exports.murmur2=s,Uo.exports})(),jo=A(Ta);class Vo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,l,p,_){this.ids.push(Ui(s)),this.positions.push(l,p,_)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Ui(s);let p=0,_=this.ids.length-1;for(;p<_;){const T=p+_>>1;this.ids[T]>=l?_=T:p=T+1}const b=[];for(;this.ids[p]===l;)b.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return b}static serialize(s,l){const p=new Float64Array(s.ids),_=new Uint32Array(s.positions);return ji(p,_,0,p.length-1),l&&l.push(p.buffer,_.buffer),{ids:p,positions:_}}static deserialize(s){const l=new Vo;return l.ids=s.ids,l.positions=s.positions,l.indexed=!0,l}}function Ui(u){const s=+u;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:jo(String(u))}function ji(u,s,l,p){for(;l<p;){const _=u[l+p>>1];let b=l-1,T=p+1;for(;;){do b++;while(u[b]<_);do T--;while(u[T]>_);if(b>=T)break;sr(u,b,T),sr(s,3*b,3*T),sr(s,3*b+1,3*T+1),sr(s,3*b+2,3*T+2)}T-l<p-T?(ji(u,s,l,T),l=T+1):(ji(u,s,T+1,p),p=T)}}function sr(u,s,l){const p=u[s];u[s]=u[l],u[l]=p}Ct("FeaturePositionMap",Vo);class gi{constructor(s,l){this.gl=s.gl,this.location=l}}class th extends gi{constructor(s,l){super(s,l),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class uf extends gi{constructor(s,l){super(s,l),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class Fs extends gi{constructor(s,l){super(s,l),this.current=An.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const ad=new Float32Array(16);function oc(u){return[rr(255*u.r,255*u.g),rr(255*u.b,255*u.a)]}class ac{constructor(s,l,p){this.value=s,this.uniformNames=l.map((_=>`u_${_}`)),this.type=p}setUniform(s,l,p){s.set(p.constantOr(this.value))}getBinding(s,l,p){return this.type==="color"?new Fs(s,l):new th(s,l)}}class rs{constructor(s,l){this.uniformNames=l.map((p=>`u_${p}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=s.tlbr}setConstantDashPositions(s,l){this.dashTo=[0,s.y,s.height,s.width],this.dashFrom=[0,l.y,l.height,l.width]}setUniform(s,l,p,_){let b=null;_==="u_pattern_to"?b=this.patternTo:_==="u_pattern_from"?b=this.patternFrom:_==="u_dasharray_to"?b=this.dashTo:_==="u_dasharray_from"?b=this.dashFrom:_==="u_pixel_ratio_to"?b=this.pixelRatioTo:_==="u_pixel_ratio_from"&&(b=this.pixelRatioFrom),b!==null&&s.set(b)}getBinding(s,l,p){return p.substr(0,9)==="u_pattern"||p.substr(0,12)==="u_dasharray_"?new uf(s,l):new th(s,l)}}class ro{constructor(s,l,p,_){this.expression=s,this.type=p,this.maxValue=0,this.paintVertexAttributes=l.map((b=>({name:`a_${b}`,type:"Float32",components:p==="color"?2:1,offset:0}))),this.paintVertexArray=new _}populatePaintArray(s,l,p){const _=this.paintVertexArray.length,b=this.expression.evaluate(new Xn(0,p),l,{},p.canonical,[],p.formattedSection);this.paintVertexArray.resize(s),this._setPaintValue(_,s,b)}updatePaintArray(s,l,p,_,b){const T=this.expression.evaluate(new Xn(0,b),p,_);this._setPaintValue(s,l,T)}_setPaintValue(s,l,p){if(this.type==="color"){const _=oc(p);for(let b=s;b<l;b++)this.paintVertexArray.emplace(b,_[0],_[1])}else{for(let _=s;_<l;_++)this.paintVertexArray.emplace(_,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ss{constructor(s,l,p,_,b,T){this.expression=s,this.uniformNames=l.map((C=>`u_${C}_t`)),this.type=p,this.useIntegerZoom=_,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=l.map((C=>({name:`a_${C}`,type:"Float32",components:p==="color"?4:2,offset:0}))),this.paintVertexArray=new T}populatePaintArray(s,l,p){const _=this.expression.evaluate(new Xn(this.zoom,p),l,{},p.canonical,[],p.formattedSection),b=this.expression.evaluate(new Xn(this.zoom+1,p),l,{},p.canonical,[],p.formattedSection),T=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(T,s,_,b)}updatePaintArray(s,l,p,_,b){const T=this.expression.evaluate(new Xn(this.zoom,b),p,_),C=this.expression.evaluate(new Xn(this.zoom+1,b),p,_);this._setPaintValue(s,l,T,C)}_setPaintValue(s,l,p,_){if(this.type==="color"){const b=oc(p),T=oc(_);for(let C=s;C<l;C++)this.paintVertexArray.emplace(C,b[0],b[1],T[0],T[1])}else{for(let b=s;b<l;b++)this.paintVertexArray.emplace(b,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,l){const p=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,_=$t(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);s.set(_)}getBinding(s,l,p){return new th(s,l)}}class os{constructor(s,l,p,_,b,T){this.expression=s,this.type=l,this.useIntegerZoom=p,this.zoom=_,this.layerId=T,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(s,l,p){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(_,s,this.getPositionIds(l),p)}updatePaintArray(s,l,p,_,b){this._setPaintValues(s,l,this.getPositionIds(p),b)}_setPaintValues(s,l,p,_){const b=this.getPositions(_);if(!b||!p)return;const T=b[p.min],C=b[p.mid],M=b[p.max];if(T&&C&&M)for(let O=s;O<l;O++)this.emplace(this.zoomInPaintVertexArray,O,C,T),this.emplace(this.zoomOutPaintVertexArray,O,C,M)}upload(s){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const l=this.getVertexAttributes();this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,l,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,l,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class lc extends os{getPositions(s){return s.imagePositions}getPositionIds(s){return s.patterns&&s.patterns[this.layerId]}getVertexAttributes(){return To.members}emplace(s,l,p,_){s.emplace(l,p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],_.tlbr[0],_.tlbr[1],_.tlbr[2],_.tlbr[3],p.pixelRatio,_.pixelRatio)}}class uu extends os{getPositions(s){return s.dashPositions}getPositionIds(s){return s.dashes&&s.dashes[this.layerId]}getVertexAttributes(){return ba.members}emplace(s,l,p,_){s.emplace(l,0,p.y,p.height,p.width,0,_.y,_.height,_.width)}}class nh{constructor(s,l,p){this.binders={},this._buffers=[];const _=[];for(const b in s.paint._values){if(!p(b))continue;const T=s.paint.get(b);if(!(T instanceof vs&&Fo(T.property.specification)))continue;const C=Eg(b,s.type),M=T.value,O=T.property.specification.type,F=T.property.useIntegerZoom,j=T.property.specification["property-type"],H=j==="cross-faded"||j==="cross-faded-data-driven";if(M.kind==="constant")this.binders[b]=H?new rs(M.value,C):new ac(M.value,C,O),_.push(`/u_${b}`);else if(M.kind==="source"||H){const X=Kp(b,O,"source");this.binders[b]=H?b==="line-dasharray"?new uu(M,O,F,l,X,s.id):new lc(M,O,F,l,X,s.id):new ro(M,C,O,X),_.push(`/a_${b}`)}else{const X=Kp(b,O,"composite");this.binders[b]=new ss(M,C,O,F,l,X),_.push(`/z_${b}`)}}this.cacheKey=_.sort().join("")}getMaxValue(s){const l=this.binders[s];return l instanceof ro||l instanceof ss?l.maxValue:0}populatePaintArrays(s,l,p){for(const _ in this.binders){const b=this.binders[_];(b instanceof ro||b instanceof ss||b instanceof os)&&b.populatePaintArray(s,l,p)}}setConstantPatternPositions(s,l){for(const p in this.binders){const _=this.binders[p];_ instanceof rs&&_.setConstantPatternPositions(s,l)}}setConstantDashPositions(s,l){for(const p in this.binders){const _=this.binders[p];_ instanceof rs&&_.setConstantDashPositions(s,l)}}updatePaintArrays(s,l,p,_,b){let T=!1;for(const C in s){const M=l.getPositions(C);for(const O of M){const F=p.feature(O.index);for(const j in this.binders){const H=this.binders[j];if((H instanceof ro||H instanceof ss||H instanceof os)&&H.expression.isStateDependent===!0){const X=_.paint.get(j);H.expression=X.value,H.updatePaintArray(O.start,O.end,F,s[C],b),T=!0}}}}return T}defines(){const s=[];for(const l in this.binders){const p=this.binders[l];(p instanceof ac||p instanceof rs)&&s.push(...p.uniformNames.map((_=>`#define HAS_UNIFORM_${_}`)))}return s}getBinderAttributes(){const s=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof ro||p instanceof ss)for(let _=0;_<p.paintVertexAttributes.length;_++)s.push(p.paintVertexAttributes[_].name);else if(p instanceof os){const _=p.getVertexAttributes();for(const b of _)s.push(b.name)}}return s}getBinderUniforms(){const s=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof ac||p instanceof rs||p instanceof ss)for(const _ of p.uniformNames)s.push(_)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,l){const p=[];for(const _ in this.binders){const b=this.binders[_];if(b instanceof ac||b instanceof rs||b instanceof ss){for(const T of b.uniformNames)if(l[T]){const C=b.getBinding(s,l[T],T);p.push({name:T,property:_,binding:C})}}}return p}setUniforms(s,l,p,_){for(const{name:b,property:T,binding:C}of l)this.binders[T].setUniform(C,_,p.get(T),b)}updatePaintBuffers(s){this._buffers=[];for(const l in this.binders){const p=this.binders[l];if(s&&p instanceof os){const _=s.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(p instanceof ro||p instanceof ss)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(s){for(const l in this.binders){const p=this.binders[l];(p instanceof ro||p instanceof ss||p instanceof os)&&p.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const l=this.binders[s];(l instanceof ro||l instanceof ss||l instanceof os)&&l.destroy()}}}class cc{constructor(s,l,p=()=>!0){this.programConfigurations={};for(const _ of s)this.programConfigurations[_.id]=new nh(_,l,p);this.needsUpload=!1,this._featureMap=new Vo,this._bufferOffset=0}populatePaintArrays(s,l,p,_){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(s,l,_);l.id!==void 0&&this._featureMap.add(l.id,p,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,l,p,_){for(const b of p)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(s,this._featureMap,l,b,_)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function Eg(u,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${s}-`,"").replace(/-/g,"_")]}function Kp(u,s,l){const p={color:{source:Ls,composite:Z},number:{source:D,composite:Ls}},_=(function(b){return{"line-pattern":{source:Bt,composite:Bt},"fill-pattern":{source:Bt,composite:Bt},"fill-extrusion-pattern":{source:Bt,composite:Bt},"line-dasharray":{source:xn,composite:xn}}[b]})(u);return _&&_[l]||p[s][l]}Ct("ConstantBinder",ac),Ct("CrossFadedConstantBinder",rs),Ct("SourceExpressionBinder",ro),Ct("CrossFadedPatternBinder",lc),Ct("CrossFadedDasharrayBinder",uu),Ct("CompositeExpressionBinder",ss),Ct("ProgramConfiguration",nh,{omit:["_buffers"]}),Ct("ProgramConfigurationSet",cc);const hf=Math.pow(2,14)-1,Jp=-hf-1;function hu(u){const s=Ue/u.extent,l=u.loadGeometry();for(let p=0;p<l.length;p++){const _=l[p];for(let b=0;b<_.length;b++){const T=_[b],C=Math.round(T.x*s),M=Math.round(T.y*s);T.x=$t(C,Jp,hf),T.y=$t(M,Jp,hf),(C<T.x||C>T.x+1||M<T.y||M>T.y+1)&&ri("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function or(u,s){return{type:u.type,id:u.id,properties:u.properties,geometry:s?hu(u):[]}}const as=-32768;function Pg(u,s,l,p,_){u.emplaceBack(as+8*s+p,as+8*l+_)}class df{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=s.index,this.hasDependencies=!1,this.layoutVertexArray=new Ye,this.indexArray=new Di,this.segments=new En,this.programConfigurations=new cc(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(s,l,p){const _=this.layers[0],b=[];let T=null,C=!1,M=_.type==="heatmap";if(_.type==="circle"){const F=_;T=F.layout.get("circle-sort-key"),C=!T.isConstant(),M=M||F.paint.get("circle-pitch-alignment")==="map"}const O=M?l.subdivisionGranularity.circle:1;for(const{feature:F,id:j,index:H,sourceLayerIndex:X}of s){const G=this.layers[0]._featureFilter.needGeometry,te=or(F,G);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom),te,p))continue;const oe=C?T.evaluate(te,{},p):void 0,me={id:j,properties:F.properties,type:F.type,sourceLayerIndex:X,index:H,geometry:G?te.geometry:hu(F),patterns:{},sortKey:oe};b.push(me)}C&&b.sort(((F,j)=>F.sortKey-j.sortKey));for(const F of b){const{geometry:j,index:H,sourceLayerIndex:X}=F,G=s[H].feature;this.addFeature(F,j,H,p,O),l.featureIndex.insert(G,j,H,X,this.index)}}update(s,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:p})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,mi),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,l,p,_,b=1){let T;switch(b){case 1:T=[0,7];break;case 3:T=[0,2,5,7];break;case 5:T=[0,1,3,4,6,7];break;case 7:T=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${b}; valid values are 1, 3, 5, 7.`)}const C=T.length;for(const M of l)for(const O of M){const F=O.x,j=O.y;if(F<0||F>=Ue||j<0||j>=Ue)continue;const H=this.segments.prepareSegment(C*C,this.layoutVertexArray,this.indexArray,s.sortKey),X=H.vertexLength;for(let G=0;G<C;G++)for(let te=0;te<C;te++)Pg(this.layoutVertexArray,F,j,T[te],T[G]);for(let G=0;G<C-1;G++)for(let te=0;te<C-1;te++){const oe=X+G*C+te,me=X+(G+1)*C+te;this.indexArray.emplaceBack(oe,me+1,oe+1),this.indexArray.emplaceBack(oe,me,me+1)}H.vertexLength+=C*C,H.primitiveLength+=(C-1)*(C-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,{imagePositions:{},canonical:_})}}function Qp(u,s){for(let l=0;l<u.length;l++)if(uc(s,u[l]))return!0;for(let l=0;l<s.length;l++)if(uc(u,s[l]))return!0;return!!ff(u,s)}function ld(u,s,l){return!!uc(u,s)||!!pf(s,u,l)}function em(u,s){if(u.length===1)return mf(s,u[0]);for(let l=0;l<s.length;l++){const p=s[l];for(let _=0;_<p.length;_++)if(uc(u,p[_]))return!0}for(let l=0;l<u.length;l++)if(mf(s,u[l]))return!0;for(let l=0;l<s.length;l++)if(ff(u,s[l]))return!0;return!1}function tm(u,s,l){if(u.length>1){if(ff(u,s))return!0;for(let p=0;p<s.length;p++)if(pf(s[p],u,l))return!0}for(let p=0;p<u.length;p++)if(pf(u[p],s,l))return!0;return!1}function ff(u,s){if(u.length===0||s.length===0)return!1;for(let l=0;l<u.length-1;l++){const p=u[l],_=u[l+1];for(let b=0;b<s.length-1;b++)if(nm(p,_,s[b],s[b+1]))return!0}return!1}function nm(u,s,l,p){return xt(u,l,p)!==xt(s,l,p)&&xt(u,s,l)!==xt(u,s,p)}function pf(u,s,l){const p=l*l;if(s.length===1)return u.distSqr(s[0])<p;for(let _=1;_<s.length;_++)if(im(u,s[_-1],s[_])<p)return!0;return!1}function im(u,s,l){const p=s.distSqr(l);if(p===0)return u.distSqr(s);const _=((u.x-s.x)*(l.x-s.x)+(u.y-s.y)*(l.y-s.y))/p;return u.distSqr(_<0?s:_>1?l:l.sub(s)._mult(_)._add(s))}function mf(u,s){let l,p,_,b=!1;for(let T=0;T<u.length;T++){l=u[T];for(let C=0,M=l.length-1;C<l.length;M=C++)p=l[C],_=l[M],p.y>s.y!=_.y>s.y&&s.x<(_.x-p.x)*(s.y-p.y)/(_.y-p.y)+p.x&&(b=!b)}return b}function uc(u,s){let l=!1;for(let p=0,_=u.length-1;p<u.length;_=p++){const b=u[p],T=u[_];b.y>s.y!=T.y>s.y&&s.x<(T.x-b.x)*(s.y-b.y)/(T.y-b.y)+b.x&&(l=!l)}return l}function Cg(u,s,l){const p=l[0],_=l[2];if(u.x<p.x&&s.x<p.x||u.x>_.x&&s.x>_.x||u.y<p.y&&s.y<p.y||u.y>_.y&&s.y>_.y)return!1;const b=xt(u,s,l[0]);return b!==xt(u,s,l[1])||b!==xt(u,s,l[2])||b!==xt(u,s,l[3])}function hc(u,s,l){const p=s.paint.get(u).value;return p.kind==="constant"?p.value:l.programConfigurations.get(s.id).getMaxValue(u)}function du(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function gf(u,s,l,p,_){if(!s[0]&&!s[1])return u;const b=v.convert(s)._mult(_);l==="viewport"&&b._rotate(-p);const T=[];for(let C=0;C<u.length;C++)T.push(u[C].sub(b));return T}function Ig({queryGeometry:u,size:s},l){return ld(u,l,s)}function rm({queryGeometry:u,size:s,transform:l,unwrappedTileID:p,getElevation:_},b){return ld(u,b,s*(l.projectTileCoordinates(b.x,b.y,p,_).signedDistanceFromCamera/l.cameraToCenterDistance))}function Mg({queryGeometry:u,size:s,transform:l,unwrappedTileID:p,getElevation:_},b){const T=l.projectTileCoordinates(b.x,b.y,p,_).signedDistanceFromCamera,C=s*(l.cameraToCenterDistance/T);return ld(u,sm(b,l,p,_),C)}function _f({queryGeometry:u,size:s,transform:l,unwrappedTileID:p,getElevation:_},b){return ld(u,sm(b,l,p,_),s)}function Sa({queryGeometry:u,size:s,transform:l,unwrappedTileID:p,getElevation:_,pitchAlignment:b="map",pitchScale:T="map"},C){const M=b==="map"?T==="map"?Ig:rm:T==="map"?Mg:_f,O={queryGeometry:u,size:s,transform:l,unwrappedTileID:p,getElevation:_};for(const F of C)for(const j of F)if(M(O,j))return!0;return!1}function sm(u,s,l,p){const _=s.projectTileCoordinates(u.x,u.y,l,p).point;return new v((.5*_.x+.5)*s.width,(.5*-_.y+.5)*s.height)}let om,yf;Ct("CircleBucket",df,{omit:["layers"]});var Rg={get paint(){return yf=yf||new zi({"circle-radius":new qt(Be.paint_circle["circle-radius"]),"circle-color":new qt(Be.paint_circle["circle-color"]),"circle-blur":new qt(Be.paint_circle["circle-blur"]),"circle-opacity":new qt(Be.paint_circle["circle-opacity"]),"circle-translate":new jt(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qt(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qt(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qt(Be.paint_circle["circle-stroke-opacity"])})},get layout(){return om=om||new zi({"circle-sort-key":new qt(Be.layout_circle["circle-sort-key"])})}};class kg extends pr{constructor(s,l){super(s,Rg,l)}createBucket(s){return new df(s)}queryRadius(s){const l=s;return hc("circle-radius",this,l)+hc("circle-stroke-width",this,l)+du(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:p,geometry:_,transform:b,pixelsToTileUnits:T,unwrappedTileID:C,getElevation:M}){const O=gf(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-b.bearingInRadians,T),F=this.paint.get("circle-radius").evaluate(l,p)+this.paint.get("circle-stroke-width").evaluate(l,p),j=this.paint.get("circle-pitch-scale"),H=this.paint.get("circle-pitch-alignment");let X,G;return H==="map"?(X=O,G=F*T):(X=(function(te,oe,me,je){return te.map((Te=>sm(Te,oe,me,je)))})(O,b,C,M),G=F),Sa({queryGeometry:X,size:G,transform:b,unwrappedTileID:C,getElevation:M,pitchAlignment:H,pitchScale:j},_)}}class ih extends df{}let Vr;Ct("HeatmapBucket",ih,{omit:["layers"]});var Hy={get paint(){return Vr=Vr||new zi({"heatmap-radius":new qt(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qt(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tc(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(Be.paint_heatmap["heatmap-opacity"])})}};function am(u,{width:s,height:l},p,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==s*l*p)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${s*l*p}`)}else _=new Uint8Array(s*l*p);return u.width=s,u.height=l,u.data=_,u}function cd(u,{width:s,height:l},p){if(s===u.width&&l===u.height)return;const _=am({},{width:s,height:l},p);Er(u,_,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,s),height:Math.min(u.height,l)},p),u.width=s,u.height=l,u.data=_.data}function Er(u,s,l,p,_,b){if(_.width===0||_.height===0)return s;if(_.width>u.width||_.height>u.height||l.x>u.width-_.width||l.y>u.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||p.x>s.width-_.width||p.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const T=u.data,C=s.data;if(T===C)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<_.height;M++){const O=((l.y+M)*u.width+l.x)*b,F=((p.y+M)*s.width+p.x)*b;for(let j=0;j<_.width*b;j++)C[F+j]=T[O+j]}return s}class ud{constructor(s,l){am(this,s,1,l)}resize(s){cd(this,s,1)}clone(){return new ud({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,p,_,b){Er(s,l,p,_,b,1)}}class Nt{constructor(s,l){am(this,s,4,l)}resize(s){cd(this,s,4)}replace(s,l){l?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Nt({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,p,_,b){Er(s,l,p,_,b,4)}setPixel(s,l,p){const _=4*(s*this.width+l);this.data[_+0]=Math.round(255*p.r/p.a),this.data[_+1]=Math.round(255*p.g/p.a),this.data[_+2]=Math.round(255*p.b/p.a),this.data[_+3]=Math.round(255*p.a)}}function fu(u){const s={},l=u.resolution||256,p=u.clips?u.clips.length:1,_=u.image||new Nt({width:l,height:p});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const b=(T,C,M)=>{s[u.evaluationKey]=M;const O=u.expression.evaluate(s);_.setPixel(T/4/l,C/4,O)};if(u.clips)for(let T=0,C=0;T<p;++T,C+=4*l)for(let M=0,O=0;M<l;M++,O+=4){const F=M/(l-1),{start:j,end:H}=u.clips[T];b(C,O,j*(1-F)+H*F)}else for(let T=0,C=0;T<l;T++,C+=4)b(0,C,T/(l-1));return _}Ct("AlphaImage",ud),Ct("RGBAImage",Nt);const hd="big-fb";class Dg extends pr{createBucket(s){return new ih(s)}constructor(s,l){super(s,Hy,l),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(hd)&&this.heatmapFbos.delete(hd)}queryRadius(s){return hc("heatmap-radius",this,s)}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:p,geometry:_,transform:b,pixelsToTileUnits:T,unwrappedTileID:C,getElevation:M}){return Sa({queryGeometry:s,size:this.paint.get("heatmap-radius").evaluate(l,p)*T,transform:b,unwrappedTileID:C,getElevation:M},_)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Og;var dd={get paint(){return Og=Og||new zi({"hillshade-illumination-direction":new jt(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new jt(Be.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new jt(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(Be.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new jt(Be.paint_hillshade["hillshade-method"])})}};class vf extends pr{constructor(s,l){super(s,dd,l),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let s=this.paint.get("hillshade-illumination-direction").values,l=this.paint.get("hillshade-illumination-altitude").values,p=this.paint.get("hillshade-highlight-color").values,_=this.paint.get("hillshade-shadow-color").values;const b=Math.max(s.length,l.length,p.length,_.length);s=s.concat(Array(b-s.length).fill(s.at(-1))),l=l.concat(Array(b-l.length).fill(l.at(-1))),p=p.concat(Array(b-p.length).fill(p.at(-1))),_=_.concat(Array(b-_.length).fill(_.at(-1)));const T=l.map(ds);return{directionRadians:s.map(ds),altitudeRadians:T,shadowColor:_,highlightColor:p}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let xf;var Lg={get paint(){return xf=xf||new zi({"color-relief-opacity":new jt(Be["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new tc(Be["paint_color-relief"]["color-relief-color"])})}};class bf{constructor(s,l,p,_){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(l,_)}update(s,l,p){const{width:_,height:b}=s,T=!(this.size&&this.size[0]===_&&this.size[1]===b||p),{context:C}=this,{gl:M}=C;if(this.useMipmap=!!(l&&l.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!l||l.premultiply!==!1)),T)this.size=[_,b],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||Sn(s)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,s):M.texImage2D(M.TEXTURE_2D,0,this.format,_,b,0,this.format,M.UNSIGNED_BYTE,s.data);else{const{x:O,y:F}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||Sn(s)?M.texSubImage2D(M.TEXTURE_2D,0,O,F,M.RGBA,M.UNSIGNED_BYTE,s):M.texSubImage2D(M.TEXTURE_2D,0,O,F,_,b,M.RGBA,M.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D),C.pixelStoreUnpackFlipY.setDefault(),C.pixelStoreUnpack.setDefault(),C.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(s,l,p){const{context:_}=this,{gl:b}=_;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),s!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||s),this.filter=s),l!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,l),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class lm{constructor(s,l,p,_=1,b=1,T=1,C=0){if(this.uid=s,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void ri(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const M=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=b,this.blueFactor=T,this.baseShift=C;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<M;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(M,O)]=this.data[this._idx(M-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,M)]=this.data[this._idx(O,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<M;O++)for(let F=0;F<M;F++){const j=this.get(O,F);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(s,l){const p=new Uint8Array(this.data.buffer),_=4*this._idx(s,l);return this.unpack(p[_],p[_+1],p[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,l){if(s<-1||s>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(s+1)}unpack(s,l,p){return s*this.redFactor+l*this.greenFactor+p*this.blueFactor-this.baseShift}pack(s){return wf(s,this.getUnpackVector())}getPixels(){return new Nt({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,l,p){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let _=l*this.dim,b=l*this.dim+this.dim,T=p*this.dim,C=p*this.dim+this.dim;switch(l){case-1:_=b-1;break;case 1:b=_+1}switch(p){case-1:T=C-1;break;case 1:C=T+1}const M=-l*this.dim,O=-p*this.dim;for(let F=T;F<C;F++)for(let j=_;j<b;j++)this.data[this._idx(j,F)]=s.data[this._idx(j+M,F+O)]}}function wf(u,s){const l=s[0],p=s[1],_=s[2],b=s[3],T=Math.min(l,p,_),C=Math.round((u+b)/T);return{r:Math.floor(C*T/l)%256,g:Math.floor(C*T/p)%256,b:Math.floor(C*T/_)%256}}Ct("DEMData",lm);class cm extends pr{constructor(s,l){super(s,Lg,l)}_createColorRamp(s){const l={elevationStops:[],colorStops:[]},p=this._transitionablePaint._values["color-relief-color"].value.expression;if(p instanceof Xa&&p._styleExpression.expression instanceof Bi){this.colorRampExpression=p;const T=p._styleExpression.expression;l.elevationStops=T.labels,l.colorStops=[];for(const C of l.elevationStops)l.colorStops.push(T.evaluate({globals:{elevation:C}}))}if(l.elevationStops.length<1&&(l.elevationStops=[0],l.colorStops=[An.transparent]),l.elevationStops.length<2&&(l.elevationStops.push(l.elevationStops[0]+1),l.colorStops.push(l.colorStops[0])),l.elevationStops.length<=s)return l;const _={elevationStops:[],colorStops:[]},b=(l.elevationStops.length-1)/(s-1);for(let T=0;T<l.elevationStops.length-.5;T+=b)_.elevationStops.push(l.elevationStops[Math.round(T)]),_.colorStops.push(l.colorStops[Math.round(T)]);return ri(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),_}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(s,l,p){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const _=this._createColorRamp(l),b=new Nt({width:_.colorStops.length,height:1}),T=new Nt({width:_.colorStops.length,height:1});for(let C=0;C<_.elevationStops.length;C++){const M=wf(_.elevationStops[C],p);T.setPixel(0,C,new An(M.r/255,M.g/255,M.b/255,1)),b.setPixel(0,C,_.colorStops[C])}return this.colorRampTextures={elevationTexture:new bf(s,T,s.gl.RGBA),colorTexture:new bf(s,b,s.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const $r=Jn([{name:"a_pos",components:2,type:"Int16"}],4),{members:$o}=$r;function Wo(u,s,l){const p=l.patternDependencies;let _=!1;for(const b of s){const T=b.paint.get(`${u}-pattern`);T.isConstant()||(_=!0);const C=T.constantOr(null);C&&(_=!0,p[C.to]=!0,p[C.from]=!0)}return _}function Tf(u,s,l,p,_){const{zoom:b}=p,T=_.patternDependencies;for(const C of s){const M=C.paint.get(`${u}-pattern`).value;if(M.kind!=="constant"){let O=M.evaluate({zoom:b-1},l,{},_.availableImages),F=M.evaluate({zoom:b},l,{},_.availableImages),j=M.evaluate({zoom:b+1},l,{},_.availableImages);O=O&&O.name?O.name:O,F=F&&F.name?F.name:F,j=j&&j.name?j.name:j,T[O]=!0,T[F]=!0,T[j]=!0,l.patterns[C.id]={min:O,mid:F,max:j}}}return l}function um(u,s,l,p,_){let b;if(_===(function(T,C,M,O){let F=0;for(let j=C,H=M-O;j<M;j+=O)F+=(T[H]-T[j])*(T[j+1]+T[H+1]),H=j;return F})(u,s,l,p)>0)for(let T=s;T<l;T+=p)b=fd(T/p|0,u[T],u[T+1],b);else for(let T=l-p;T>=s;T-=p)b=fd(T/p|0,u[T],u[T+1],b);return b&&Wi(b,b.next)&&(pu(b),b=b.next),b}function Wr(u,s){if(!u)return u;s||(s=u);let l,p=u;do if(l=!1,p.steiner||!Wi(p,p.next)&&On(p.prev,p,p.next)!==0)p=p.next;else{if(pu(p),p=s=p.prev,p===p.next)break;l=!0}while(l||p!==s);return s}function rh(u,s,l,p,_,b,T){if(!u)return;!T&&b&&(function(M,O,F,j){let H=M;do H.z===0&&(H.z=sh(H.x,H.y,O,F,j)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==M);H.prevZ.nextZ=null,H.prevZ=null,(function(X){let G,te=1;do{let oe,me=X;X=null;let je=null;for(G=0;me;){G++;let Te=me,Ie=0;for(let st=0;st<te&&(Ie++,Te=Te.nextZ,Te);st++);let Je=te;for(;Ie>0||Je>0&&Te;)Ie!==0&&(Je===0||!Te||me.z<=Te.z)?(oe=me,me=me.nextZ,Ie--):(oe=Te,Te=Te.nextZ,Je--),je?je.nextZ=oe:X=oe,oe.prevZ=je,je=oe;me=Te}je.nextZ=null,te*=2}while(G>1)})(H)})(u,p,_,b);let C=u;for(;u.prev!==u.next;){const M=u.prev,O=u.next;if(b?Zy(u,p,_,b):Aa(u))s.push(M.i,u.i,O.i),pu(u),u=O.next,C=O.next;else if((u=O)===C){T?T===1?rh(u=Fg(Wr(u),s),s,l,p,_,b,2):T===2&&Ng(u,s,l,p,_,b):rh(Wr(u),s,l,p,_,b,1);break}}}function Aa(u){const s=u.prev,l=u,p=u.next;if(On(s,l,p)>=0)return!1;const _=s.x,b=l.x,T=p.x,C=s.y,M=l.y,O=p.y,F=Math.min(_,b,T),j=Math.min(C,M,O),H=Math.max(_,b,T),X=Math.max(C,M,O);let G=p.next;for(;G!==s;){if(G.x>=F&&G.x<=H&&G.y>=j&&G.y<=X&&jn(_,C,b,M,T,O,G.x,G.y)&&On(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function Zy(u,s,l,p){const _=u.prev,b=u,T=u.next;if(On(_,b,T)>=0)return!1;const C=_.x,M=b.x,O=T.x,F=_.y,j=b.y,H=T.y,X=Math.min(C,M,O),G=Math.min(F,j,H),te=Math.max(C,M,O),oe=Math.max(F,j,H),me=sh(X,G,s,l,p),je=sh(te,oe,s,l,p);let Te=u.prevZ,Ie=u.nextZ;for(;Te&&Te.z>=me&&Ie&&Ie.z<=je;){if(Te.x>=X&&Te.x<=te&&Te.y>=G&&Te.y<=oe&&Te!==_&&Te!==T&&jn(C,F,M,j,O,H,Te.x,Te.y)&&On(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Ie.x>=X&&Ie.x<=te&&Ie.y>=G&&Ie.y<=oe&&Ie!==_&&Ie!==T&&jn(C,F,M,j,O,H,Ie.x,Ie.y)&&On(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;Te&&Te.z>=me;){if(Te.x>=X&&Te.x<=te&&Te.y>=G&&Te.y<=oe&&Te!==_&&Te!==T&&jn(C,F,M,j,O,H,Te.x,Te.y)&&On(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Ie&&Ie.z<=je;){if(Ie.x>=X&&Ie.x<=te&&Ie.y>=G&&Ie.y<=oe&&Ie!==_&&Ie!==T&&jn(C,F,M,j,O,H,Ie.x,Ie.y)&&On(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function Fg(u,s){let l=u;do{const p=l.prev,_=l.next.next;!Wi(p,_)&&Ns(p,l,l.next,_)&&fl(p,_)&&fl(_,p)&&(s.push(p.i,l.i,_.i),pu(l),pu(l.next),l=u=_),l=l.next}while(l!==u);return Wr(l)}function Ng(u,s,l,p,_,b){let T=u;do{let C=T.next.next;for(;C!==T.prev;){if(T.i!==C.i&&Pr(T,C)){let M=dc(T,C);return T=Wr(T,T.next),M=Wr(M,M.next),rh(T,s,l,p,_,b,0),void rh(M,s,l,p,_,b,0)}C=C.next}T=T.next}while(T!==u)}function Bg(u,s){let l=u.x-s.x;return l===0&&(l=u.y-s.y,l===0)&&(l=(u.next.y-u.y)/(u.next.x-u.x)-(s.next.y-s.y)/(s.next.x-s.x)),l}function zg(u,s){const l=(function(_,b){let T=b;const C=_.x,M=_.y;let O,F=-1/0;if(Wi(_,T))return T;do{if(Wi(_,T.next))return T.next;if(M<=T.y&&M>=T.next.y&&T.next.y!==T.y){const te=T.x+(M-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(te<=C&&te>F&&(F=te,O=T.x<T.next.x?T:T.next,te===C))return O}T=T.next}while(T!==b);if(!O)return null;const j=O,H=O.x,X=O.y;let G=1/0;T=O;do{if(C>=T.x&&T.x>=H&&C!==T.x&&so(M<X?C:F,M,H,X,M<X?F:C,M,T.x,T.y)){const te=Math.abs(M-T.y)/(C-T.x);fl(T,_)&&(te<G||te===G&&(T.x>O.x||T.x===O.x&&Xy(O,T)))&&(O=T,G=te)}T=T.next}while(T!==j);return O})(u,s);if(!l)return s;const p=dc(l,u);return Wr(p,p.next),Wr(l,l.next)}function Xy(u,s){return On(u.prev,u,s.prev)<0&&On(s.next,u,u.next)<0}function sh(u,s,l,p,_){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-l)*_|0)|u<<8))|u<<4))|u<<2))|u<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-p)*_|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function hm(u){let s=u,l=u;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==u);return l}function so(u,s,l,p,_,b,T,C){return(_-T)*(s-C)>=(u-T)*(b-C)&&(u-T)*(p-C)>=(l-T)*(s-C)&&(l-T)*(b-C)>=(_-T)*(p-C)}function jn(u,s,l,p,_,b,T,C){return!(u===T&&s===C)&&so(u,s,l,p,_,b,T,C)}function Pr(u,s){return u.next.i!==s.i&&u.prev.i!==s.i&&!(function(l,p){let _=l;do{if(_.i!==l.i&&_.next.i!==l.i&&_.i!==p.i&&_.next.i!==p.i&&Ns(_,_.next,l,p))return!0;_=_.next}while(_!==l);return!1})(u,s)&&(fl(u,s)&&fl(s,u)&&(function(l,p){let _=l,b=!1;const T=(l.x+p.x)/2,C=(l.y+p.y)/2;do _.y>C!=_.next.y>C&&_.next.y!==_.y&&T<(_.next.x-_.x)*(C-_.y)/(_.next.y-_.y)+_.x&&(b=!b),_=_.next;while(_!==l);return b})(u,s)&&(On(u.prev,u,s.prev)||On(u,s.prev,s))||Wi(u,s)&&On(u.prev,u,u.next)>0&&On(s.prev,s,s.next)>0)}function On(u,s,l){return(s.y-u.y)*(l.x-s.x)-(s.x-u.x)*(l.y-s.y)}function Wi(u,s){return u.x===s.x&&u.y===s.y}function Ns(u,s,l,p){const _=Hi(On(u,s,l)),b=Hi(On(u,s,p)),T=Hi(On(l,p,u)),C=Hi(On(l,p,s));return _!==b&&T!==C||!(_!==0||!dl(u,l,s))||!(b!==0||!dl(u,p,s))||!(T!==0||!dl(l,u,p))||!(C!==0||!dl(l,s,p))}function dl(u,s,l){return s.x<=Math.max(u.x,l.x)&&s.x>=Math.min(u.x,l.x)&&s.y<=Math.max(u.y,l.y)&&s.y>=Math.min(u.y,l.y)}function Hi(u){return u>0?1:u<0?-1:0}function fl(u,s){return On(u.prev,u,u.next)<0?On(u,s,u.next)>=0&&On(u,u.prev,s)>=0:On(u,s,u.prev)<0||On(u,u.next,s)<0}function dc(u,s){const l=mu(u.i,u.x,u.y),p=mu(s.i,s.x,s.y),_=u.next,b=s.prev;return u.next=s,s.prev=u,l.next=_,_.prev=l,p.next=l,l.prev=p,b.next=p,p.prev=b,p}function fd(u,s,l,p){const _=mu(u,s,l);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function pu(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function mu(u,s,l){return{i:u,x:s,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class mr{constructor(s,l){if(l>s)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=s,this._minGranularity=l}getGranularityForZoomLevel(s){return Math.max(Math.floor(this._baseZoomGranularity/(1<<s)),this._minGranularity,1)}}class oh{constructor(s){this.fill=s.fill,this.line=s.line,this.tile=s.tile,this.stencil=s.stencil,this.circle=s.circle}}oh.noSubdivision=new oh({fill:new mr(0,0),line:new mr(0,0),tile:new mr(0,0),stencil:new mr(0,0),circle:1}),Ct("SubdivisionGranularityExpression",mr),Ct("SubdivisionGranularitySetting",oh);const Ho=-32768,oo=32767;class Sf{constructor(s,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=s,this._granularityCellSize=Ue/s,this._canonical=l}_getKey(s,l){return(s+=32768)<<16|l+32768}_vertexToIndex(s,l){if(s<-32768||l<-32768||s>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(s),_=0|Math.round(l),b=this._getKey(p,_);if(this._vertexDictionary.has(b))return this._vertexDictionary.get(b);const T=this._vertexBuffer.length/2;return this._vertexDictionary.set(b,T),this._vertexBuffer.push(p,_),T}_subdivideTrianglesScanline(s){if(this._granularity<2)return(function(_,b){const T=[];for(let C=0;C<b.length;C+=3){const M=b[C],O=b[C+1],F=b[C+2],j=_[2*M],H=_[2*M+1];(_[2*O]-j)*(_[2*F+1]-H)-(_[2*O+1]-H)*(_[2*F]-j)>0?(T.push(M),T.push(F),T.push(O)):(T.push(M),T.push(O),T.push(F))}return T})(this._vertexBuffer,s);const l=[],p=s.length;for(let _=0;_<p;_+=3){const b=[s[_+0],s[_+1],s[_+2]],T=[this._vertexBuffer[2*s[_+0]+0],this._vertexBuffer[2*s[_+0]+1],this._vertexBuffer[2*s[_+1]+0],this._vertexBuffer[2*s[_+1]+1],this._vertexBuffer[2*s[_+2]+0],this._vertexBuffer[2*s[_+2]+1]];let C=1/0,M=1/0,O=-1/0,F=-1/0;for(let te=0;te<3;te++){const oe=T[2*te],me=T[2*te+1];C=Math.min(C,oe),O=Math.max(O,oe),M=Math.min(M,me),F=Math.max(F,me)}if(C===O||M===F)continue;const j=Math.floor(C/this._granularityCellSize),H=Math.ceil(O/this._granularityCellSize),X=Math.floor(M/this._granularityCellSize),G=Math.ceil(F/this._granularityCellSize);if(j!==H||X!==G)for(let te=X;te<G;te++){const oe=this._scanlineGenerateVertexRingForCellRow(te,T,b);Ef(this._vertexBuffer,oe,l)}else l.push(...b)}return l}_scanlineGenerateVertexRingForCellRow(s,l,p){const _=s*this._granularityCellSize,b=_+this._granularityCellSize,T=[];for(let C=0;C<3;C++){const M=l[2*C],O=l[2*C+1],F=l[2*(C+1)%6],j=l[(2*(C+1)+1)%6],H=l[2*(C+2)%6],X=l[(2*(C+2)+1)%6],G=F-M,te=j-O,oe=G===0,me=te===0,je=(_-O)/te,Te=(b-O)/te,Ie=Math.min(je,Te),Je=Math.max(je,Te);if(!me&&(Ie>=1||Je<=0)||me&&(O<_||O>b)){j>=_&&j<=b&&T.push(p[(C+1)%3]);continue}!me&&Ie>0&&T.push(this._vertexToIndex(M+G*Ie,O+te*Ie));const st=M+G*Math.max(Ie,0),ft=M+G*Math.min(Je,1);oe||this._generateIntraEdgeVertices(T,M,O,F,j,st,ft),!me&&Je<1&&T.push(this._vertexToIndex(M+G*Je,O+te*Je)),(me||j>=_&&j<=b)&&T.push(p[(C+1)%3]),!me&&(j<=_||j>=b)&&this._generateInterEdgeVertices(T,M,O,F,j,H,X,ft,_,b)}return T}_generateIntraEdgeVertices(s,l,p,_,b,T,C){const M=_-l,O=b-p,F=O===0,j=F?Math.min(l,_):Math.min(T,C),H=F?Math.max(l,_):Math.max(T,C),X=Math.floor(j/this._granularityCellSize)+1,G=Math.ceil(H/this._granularityCellSize)-1;if(F?l<_:T<C)for(let te=X;te<=G;te++){const oe=te*this._granularityCellSize;s.push(this._vertexToIndex(oe,p+O*(oe-l)/M))}else for(let te=G;te>=X;te--){const oe=te*this._granularityCellSize;s.push(this._vertexToIndex(oe,p+O*(oe-l)/M))}}_generateInterEdgeVertices(s,l,p,_,b,T,C,M,O,F){const j=b-p,H=T-_,X=C-b,G=(O-b)/X,te=(F-b)/X,oe=Math.min(G,te),me=Math.max(G,te),je=_+H*oe;let Te=Math.floor(Math.min(je,M)/this._granularityCellSize)+1,Ie=Math.ceil(Math.max(je,M)/this._granularityCellSize)-1,Je=M<je;const st=X===0;if(st&&(C===O||C===F))return;if(st||oe>=1||me<=0){const Ot=p-C,St=T+(l-T)*Math.min((O-C)/Ot,(F-C)/Ot);Te=Math.floor(Math.min(St,M)/this._granularityCellSize)+1,Ie=Math.ceil(Math.max(St,M)/this._granularityCellSize)-1,Je=M<St}const ft=j>0?F:O;if(Je)for(let Ot=Te;Ot<=Ie;Ot++)s.push(this._vertexToIndex(Ot*this._granularityCellSize,ft));else for(let Ot=Ie;Ot>=Te;Ot--)s.push(this._vertexToIndex(Ot*this._granularityCellSize,ft))}_generateOutline(s){const l=[];for(const p of s){const _=Bs(p,this._granularity,!0),b=this._pointArrayToIndices(_),T=[];for(let C=1;C<b.length;C++)T.push(b[C-1]),T.push(b[C]);l.push(T)}return l}_handlePoles(s){let l=!1,p=!1;this._canonical&&(this._canonical.y===0&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(l||p)&&this._fillPoles(s,l,p)}_ensureNoPoleVertices(){const s=this._vertexBuffer;for(let l=0;l<s.length;l+=2){const p=s[l+1];p===Ho&&(s[l+1]=-32767),p===oo&&(s[l+1]=32766)}}_generatePoleQuad(s,l,p,_,b,T){_>b!=(T===Ho)?(s.push(l),s.push(p),s.push(this._vertexToIndex(_,T)),s.push(p),s.push(this._vertexToIndex(b,T)),s.push(this._vertexToIndex(_,T))):(s.push(p),s.push(l),s.push(this._vertexToIndex(_,T)),s.push(this._vertexToIndex(b,T)),s.push(p),s.push(this._vertexToIndex(_,T)))}_fillPoles(s,l,p){const _=this._vertexBuffer,b=Ue,T=s.length;for(let C=2;C<T;C+=3){const M=s[C-2],O=s[C-1],F=s[C],j=_[2*M],H=_[2*M+1],X=_[2*O],G=_[2*O+1],te=_[2*F],oe=_[2*F+1];l&&(H===0&&G===0&&this._generatePoleQuad(s,M,O,j,X,Ho),G===0&&oe===0&&this._generatePoleQuad(s,O,F,X,te,Ho),oe===0&&H===0&&this._generatePoleQuad(s,F,M,te,j,Ho)),p&&(H===b&&G===b&&this._generatePoleQuad(s,M,O,j,X,oo),G===b&&oe===b&&this._generatePoleQuad(s,O,F,X,te,oo),oe===b&&H===b&&this._generatePoleQuad(s,F,M,te,j,oo))}}_initializeVertices(s){for(let l=0;l<s.length;l+=2)this._vertexToIndex(s[l],s[l+1])}subdividePolygonInternal(s,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:_}=(function(C){const M=[],O=[];for(const F of C)if(F.length!==0){F!==C[0]&&M.push(O.length/2);for(let j=0;j<F.length;j++)O.push(F[j].x),O.push(F[j].y)}return{flattened:O,holeIndices:M}})(s);let b;this._initializeVertices(p);try{const C=(function(O,F,j=2){const H=F&&F.length,X=H?F[0]*j:O.length;let G=um(O,0,X,j,!0);const te=[];if(!G||G.next===G.prev)return te;let oe,me,je;if(H&&(G=(function(Te,Ie,Je,st){const ft=[];for(let Ot=0,St=Ie.length;Ot<St;Ot++){const Rt=um(Te,Ie[Ot]*st,Ot<St-1?Ie[Ot+1]*st:Te.length,st,!1);Rt===Rt.next&&(Rt.steiner=!0),ft.push(hm(Rt))}ft.sort(Bg);for(let Ot=0;Ot<ft.length;Ot++)Je=zg(ft[Ot],Je);return Je})(O,F,G,j)),O.length>80*j){oe=O[0],me=O[1];let Te=oe,Ie=me;for(let Je=j;Je<X;Je+=j){const st=O[Je],ft=O[Je+1];st<oe&&(oe=st),ft<me&&(me=ft),st>Te&&(Te=st),ft>Ie&&(Ie=ft)}je=Math.max(Te-oe,Ie-me),je=je!==0?32767/je:0}return rh(G,te,j,oe,me,je,0),te})(p,_),M=this._convertIndices(p,C);b=this._subdivideTrianglesScanline(M)}catch(C){console.error(C)}let T=[];return l&&(T=this._generateOutline(s)),this._ensureNoPoleVertices(),this._handlePoles(b),{verticesFlattened:this._vertexBuffer,indicesTriangles:b,indicesLineList:T}}_convertIndices(s,l){const p=[];for(let _=0;_<l.length;_++)p.push(this._vertexToIndex(s[2*l[_]],s[2*l[_]+1]));return p}_pointArrayToIndices(s){const l=[];for(let p=0;p<s.length;p++){const _=s[p];l.push(this._vertexToIndex(_.x,_.y))}return l}}function Af(u,s,l,p=!0){return new Sf(l,s).subdividePolygonInternal(u,p)}function Bs(u,s,l=!1){if(!u||u.length<1)return[];if(u.length<2)return[];const p=u[0],_=u[u.length-1],b=l&&(p.x!==_.x||p.y!==_.y);if(s<2)return b?[...u,u[0]]:[...u];const T=Math.floor(Ue/s),C=[];C.push(new v(u[0].x,u[0].y));const M=u.length,O=b?M:M-1;for(let F=0;F<O;F++){const j=u[F],H=F<M-1?u[F+1]:u[0],X=j.x,G=j.y,te=H.x,oe=H.y,me=X!==te,je=G!==oe;if(!me&&!je)continue;const Te=te-X,Ie=oe-G,Je=Math.abs(Te),st=Math.abs(Ie);let ft=X,Ot=G;for(;;){const Rt=Te>0?(Math.floor(ft/T)+1)*T:(Math.ceil(ft/T)-1)*T,Gt=Ie>0?(Math.floor(Ot/T)+1)*T:(Math.ceil(Ot/T)-1)*T,Mt=Math.abs(ft-Rt),kt=Math.abs(Ot-Gt),ct=Math.abs(ft-te),ln=Math.abs(Ot-oe),gn=me?Mt/Je:Number.POSITIVE_INFINITY,tn=je?kt/st:Number.POSITIVE_INFINITY;if((ct<=Mt||!me)&&(ln<=kt||!je))break;if(gn<tn&&me||!je){ft=Rt,Ot+=Ie*gn;const Zt=new v(ft,Math.round(Ot));C[C.length-1].x===Zt.x&&C[C.length-1].y===Zt.y||C.push(Zt)}else{ft+=Te*tn,Ot=Gt;const Zt=new v(Math.round(ft),Ot);C[C.length-1].x===Zt.x&&C[C.length-1].y===Zt.y||C.push(Zt)}}const St=new v(te,oe);C[C.length-1].x===St.x&&C[C.length-1].y===St.y||C.push(St)}return C}function Ef(u,s,l){if(s.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,_=u[2*s[0]];for(let M=1;M<s.length;M++){const O=u[2*s[M]];O<_&&(_=O,p=M)}const b=s.length;let T=p,C=(T+1)%b;for(;;){const M=T-1>=0?T-1:b-1,O=(C+1)%b,F=u[2*s[M]],j=u[2*s[O]],H=u[2*s[T]],X=u[2*s[T]+1],G=u[2*s[C]+1];let te=!1;if(F<j)te=!0;else if(F>j)te=!1;else{const oe=G-X,me=-(u[2*s[C]]-H),je=X<G?1:-1;((F-H)*oe+(u[2*s[M]+1]-X)*me)*je>((j-H)*oe+(u[2*s[O]+1]-X)*me)*je&&(te=!0)}if(te){const oe=s[M],me=s[T],je=s[C];oe!==me&&oe!==je&&me!==je&&l.push(je,me,oe),T--,T<0&&(T=b-1)}else{const oe=s[O],me=s[T],je=s[C];oe!==me&&oe!==je&&me!==je&&l.push(je,me,oe),C++,C>=b&&(C=0)}if(M===O)break}}function pl(u,s,l,p,_,b,T,C,M){const O=_.length/2,F=T&&C&&M;if(O<En.MAX_VERTEX_ARRAY_LENGTH){const j=s.prepareSegment(O,l,p),H=j.vertexLength;for(let te=0;te<b.length;te+=3)p.emplaceBack(H+b[te],H+b[te+1],H+b[te+2]);let X,G;j.vertexLength+=O,j.primitiveLength+=b.length/3,F&&(G=T.prepareSegment(O,l,C),X=G.vertexLength,G.vertexLength+=O);for(let te=0;te<_.length;te+=2)u(_[te],_[te+1]);if(F)for(let te=0;te<M.length;te++){const oe=M[te];for(let me=1;me<oe.length;me+=2)C.emplaceBack(X+oe[me-1],X+oe[me]);G.primitiveLength+=oe.length/2}}else(function(j,H,X,G,te,oe){const me=[];for(let st=0;st<G.length/2;st++)me.push(-1);const je={count:0};let Te=0,Ie=j.getOrCreateLatestSegment(H,X),Je=Ie.vertexLength;for(let st=2;st<te.length;st+=3){const ft=te[st-2],Ot=te[st-1],St=te[st];let Rt=me[ft]<Te,Gt=me[Ot]<Te,Mt=me[St]<Te;Ie.vertexLength+((Rt?1:0)+(Gt?1:0)+(Mt?1:0))>En.MAX_VERTEX_ARRAY_LENGTH&&(Ie=j.createNewSegment(H,X),Te=je.count,Rt=!0,Gt=!0,Mt=!0,Je=0);const kt=fc(me,G,oe,je,ft,Rt,Ie),ct=fc(me,G,oe,je,Ot,Gt,Ie),ln=fc(me,G,oe,je,St,Mt,Ie);X.emplaceBack(Je+kt-Te,Je+ct-Te,Je+ln-Te),Ie.primitiveLength++}})(s,l,p,_,b,u),F&&(function(j,H,X,G,te,oe){const me=[];for(let st=0;st<G.length/2;st++)me.push(-1);const je={count:0};let Te=0,Ie=j.getOrCreateLatestSegment(H,X),Je=Ie.vertexLength;for(let st=0;st<te.length;st++){const ft=te[st];for(let Ot=1;Ot<te[st].length;Ot+=2){const St=ft[Ot-1],Rt=ft[Ot];let Gt=me[St]<Te,Mt=me[Rt]<Te;Ie.vertexLength+((Gt?1:0)+(Mt?1:0))>En.MAX_VERTEX_ARRAY_LENGTH&&(Ie=j.createNewSegment(H,X),Te=je.count,Gt=!0,Mt=!0,Je=0);const kt=fc(me,G,oe,je,St,Gt,Ie),ct=fc(me,G,oe,je,Rt,Mt,Ie);X.emplaceBack(Je+kt-Te,Je+ct-Te),Ie.primitiveLength++}}})(T,l,C,_,M,u),s.forceNewSegmentOnNextPrepare(),T?.forceNewSegmentOnNextPrepare()}function fc(u,s,l,p,_,b,T){if(b){const C=p.count;return l(s[2*_],s[2*_+1]),u[_]=p.count,p.count++,T.vertexLength++,C}return u[_]}class gu{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=s.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new tt,this.indexArray=new Di,this.indexArray2=new ii,this.programConfigurations=new cc(s.layers,s.zoom),this.segments=new En,this.segments2=new En,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(s,l,p){this.hasDependencies=Wo("fill",this.layers,l);const _=this.layers[0].layout.get("fill-sort-key"),b=!_.isConstant(),T=[];for(const{feature:C,id:M,index:O,sourceLayerIndex:F}of s){const j=this.layers[0]._featureFilter.needGeometry,H=or(C,j);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom),H,p))continue;const X=b?_.evaluate(H,{},p,l.availableImages):void 0,G={id:M,properties:C.properties,type:C.type,sourceLayerIndex:F,index:O,geometry:j?H.geometry:hu(C),patterns:{},sortKey:X};T.push(G)}b&&T.sort(((C,M)=>C.sortKey-M.sortKey));for(const C of T){const{geometry:M,index:O,sourceLayerIndex:F}=C;if(this.hasDependencies){const j=Tf("fill",this.layers,C,{zoom:this.zoom},l);this.patternFeatures.push(j)}else this.addFeature(C,M,O,p,{},l.subdivisionGranularity);l.featureIndex.insert(s[O].feature,M,O,F,this.index)}}update(s,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:p})}addFeatures(s,l,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,l,p,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,$o),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,l,p,_,b,T){for(const C of jl(l,500)){const M=Af(C,_,T.fill.getGranularityForZoomLevel(_.z)),O=this.layoutVertexArray;pl(((F,j)=>{O.emplaceBack(F,j)}),this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles,this.segments2,this.indexArray2,M.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,{imagePositions:b,canonical:_})}}let Pf,pd;Ct("FillBucket",gu,{omit:["layers","patternFeatures"]});var Cf={get paint(){return pd=pd||new zi({"fill-antialias":new jt(Be.paint_fill["fill-antialias"]),"fill-opacity":new qt(Be.paint_fill["fill-opacity"]),"fill-color":new qt(Be.paint_fill["fill-color"]),"fill-outline-color":new qt(Be.paint_fill["fill-outline-color"]),"fill-translate":new jt(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new al(Be.paint_fill["fill-pattern"])})},get layout(){return Pf=Pf||new zi({"fill-sort-key":new qt(Be.layout_fill["fill-sort-key"])})}};class ws extends pr{constructor(s,l){super(s,Cf,l)}recalculate(s,l){super.recalculate(s,l);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new gu(s)}queryRadius(){return du(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:s,geometry:l,transform:p,pixelsToTileUnits:_}){return em(gf(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,_),l)}isTileClipped(){return!0}}const pc=Jn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Zo=Jn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:zs}=pc;class _u{constructor(s,l,p,_,b){this.properties={},this.extent=p,this.type=0,this.id=void 0,this._pbf=s,this._geometry=-1,this._keys=_,this._values=b,s.readFields(dm,this,l)}loadGeometry(){const s=this._pbf;s.pos=this._geometry;const l=s.readVarint()+s.pos,p=[];let _,b=1,T=0,C=0,M=0;for(;s.pos<l;){if(T<=0){const O=s.readVarint();b=7&O,T=O>>3}if(T--,b===1||b===2)C+=s.readSVarint(),M+=s.readSVarint(),b===1&&(_&&p.push(_),_=[]),_&&_.push(new v(C,M));else{if(b!==7)throw new Error(`unknown command ${b}`);_&&_.push(_[0].clone())}}return _&&p.push(_),p}bbox(){const s=this._pbf;s.pos=this._geometry;const l=s.readVarint()+s.pos;let p=1,_=0,b=0,T=0,C=1/0,M=-1/0,O=1/0,F=-1/0;for(;s.pos<l;){if(_<=0){const j=s.readVarint();p=7&j,_=j>>3}if(_--,p===1||p===2)b+=s.readSVarint(),T+=s.readSVarint(),b<C&&(C=b),b>M&&(M=b),T<O&&(O=T),T>F&&(F=T);else if(p!==7)throw new Error(`unknown command ${p}`)}return[C,O,M,F]}toGeoJSON(s,l,p){const _=this.extent*Math.pow(2,p),b=this.extent*s,T=this.extent*l,C=this.loadGeometry();function M(H){return[360*(H.x+b)/_-180,360/Math.PI*Math.atan(Math.exp((1-2*(H.y+T)/_)*Math.PI))-90]}function O(H){return H.map(M)}let F;if(this.type===1){const H=[];for(const G of C)H.push(G[0]);const X=O(H);F=H.length===1?{type:"Point",coordinates:X[0]}:{type:"MultiPoint",coordinates:X}}else if(this.type===2){const H=C.map(O);F=H.length===1?{type:"LineString",coordinates:H[0]}:{type:"MultiLineString",coordinates:H}}else{if(this.type!==3)throw new Error("unknown feature type");{const H=(function(G){const te=G.length;if(te<=1)return[G];const oe=[];let me,je;for(let Te=0;Te<te;Te++){const Ie=fm(G[Te]);Ie!==0&&(je===void 0&&(je=Ie<0),je===Ie<0?(me&&oe.push(me),me=[G[Te]]):me&&me.push(G[Te]))}return me&&oe.push(me),oe})(C),X=[];for(const G of H)X.push(G.map(O));F=X.length===1?{type:"Polygon",coordinates:X[0]}:{type:"MultiPolygon",coordinates:X}}}const j={type:"Feature",geometry:F,properties:this.properties};return this.id!=null&&(j.id=this.id),j}}function dm(u,s,l){u===1?s.id=l.readVarint():u===2?(function(p,_){const b=p.readVarint()+p.pos;for(;p.pos<b;){const T=_._keys[p.readVarint()],C=_._values[p.readVarint()];_.properties[T]=C}})(l,s):u===3?s.type=l.readVarint():u===4&&(s._geometry=l.pos)}function fm(u){let s=0;for(let l,p,_=0,b=u.length,T=b-1;_<b;T=_++)l=u[_],p=u[T],s+=(p.x-l.x)*(l.y+p.y);return s}_u.types=["Unknown","Point","LineString","Polygon"];class Ug{constructor(s,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(mc,this,l),this.length=this._features.length}feature(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];const l=this._pbf.readVarint()+this._pbf.pos;return new _u(this._pbf,l,this.extent,this._keys,this._values)}}function mc(u,s,l){u===15?s.version=l.readVarint():u===1?s.name=l.readString():u===5?s.extent=l.readVarint():u===2?s._features.push(l.pos):u===3?s._keys.push(l.readString()):u===4&&s._values.push((function(p){let _=null;const b=p.readVarint()+p.pos;for(;p.pos<b;){const T=p.readVarint()>>3;_=T===1?p.readString():T===2?p.readFloat():T===3?p.readDouble():T===4?p.readVarint64():T===5?p.readVarint():T===6?p.readSVarint():T===7?p.readBoolean():null}if(_==null)throw new Error("unknown feature value");return _})(l))}class pm{constructor(s,l){this.layers=s.readFields(mm,{},l)}}function mm(u,s,l){if(u===3){const p=new Ug(l,l.readVarint()+l.pos);p.length&&(s[p.name]=p)}}const ml=Math.pow(2,13);function yu(u,s,l,p,_,b,T,C){u.emplaceBack(s,l,2*Math.floor(p*ml)+T,_*ml*2,b*ml*2,Math.round(C))}class gl{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=s.index,this.hasDependencies=!1,this.layoutVertexArray=new bt,this.centroidVertexArray=new qe,this.indexArray=new Di,this.programConfigurations=new cc(s.layers,s.zoom),this.segments=new En,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(s,l,p){this.features=[],this.hasDependencies=Wo("fill-extrusion",this.layers,l);for(const{feature:_,id:b,index:T,sourceLayerIndex:C}of s){const M=this.layers[0]._featureFilter.needGeometry,O=or(_,M);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom),O,p))continue;const F={id:b,sourceLayerIndex:C,index:T,geometry:M?O.geometry:hu(_),properties:_.properties,type:_.type,patterns:{}};this.hasDependencies?this.features.push(Tf("fill-extrusion",this.layers,F,{zoom:this.zoom},l)):this.addFeature(F,F.geometry,T,p,{},l.subdivisionGranularity),l.featureIndex.insert(_,F.geometry,T,C,this.index,!0)}}addFeatures(s,l,p){for(const _ of this.features){const{geometry:b}=_;this.addFeature(_,b,_.index,l,p,s.subdivisionGranularity)}}update(s,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:p})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,zs),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,Zo.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,l,p,_,b,T){for(const C of jl(l,500)){const M={x:0,y:0,sampleCount:0},O=this.layoutVertexArray.length;this.processPolygon(M,_,s,C,T);const F=this.layoutVertexArray.length-O,j=Math.floor(M.x/M.sampleCount),H=Math.floor(M.y/M.sampleCount);for(let X=0;X<F;X++)this.centroidVertexArray.emplaceBack(j,H)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,{imagePositions:b,canonical:_})}processPolygon(s,l,p,_,b){if(_.length<1||If(_[0]))return;for(const j of _)j.length!==0&&jg(s,j);const T={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},C=b.fill.getGranularityForZoomLevel(l.z),M=_u.types[p.type]==="Polygon";for(const j of _){if(j.length===0||If(j))continue;const H=Bs(j,C,M);this._generateSideFaces(H,T)}if(!M)return;const O=Af(_,l,C,!1),F=this.layoutVertexArray;pl(((j,H)=>{yu(F,j,H,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,O.verticesFlattened,O.indicesTriangles)}_generateSideFaces(s,l){let p=0;for(let _=1;_<s.length;_++){const b=s[_],T=s[_-1];if(Vg(b,T))continue;l.segment.vertexLength+4>En.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const C=b.sub(T)._perp()._unit(),M=T.dist(b);p+M>32768&&(p=0),yu(this.layoutVertexArray,b.x,b.y,C.x,C.y,0,0,p),yu(this.layoutVertexArray,b.x,b.y,C.x,C.y,0,1,p),p+=M,yu(this.layoutVertexArray,T.x,T.y,C.x,C.y,0,0,p),yu(this.layoutVertexArray,T.x,T.y,C.x,C.y,0,1,p);const O=l.segment.vertexLength;this.indexArray.emplaceBack(O,O+2,O+1),this.indexArray.emplaceBack(O+1,O+2,O+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function jg(u,s){for(let l=0;l<s.length;l++){const p=s[l];l===s.length-1&&s[0].x===p.x&&s[0].y===p.y||(u.x+=p.x,u.y+=p.y,u.sampleCount++)}}function Vg(u,s){return u.x===s.x&&(u.x<0||u.x>Ue)||u.y===s.y&&(u.y<0||u.y>Ue)}function If(u){return u.every((s=>s.x<0))||u.every((s=>s.x>Ue))||u.every((s=>s.y<0))||u.every((s=>s.y>Ue))}let md;Ct("FillExtrusionBucket",gl,{omit:["layers","features"]});var qy={get paint(){return md=md||new zi({"fill-extrusion-opacity":new jt(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qt(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new al(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qt(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qt(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Gy extends pr{constructor(s,l){super(s,qy,l)}createBucket(s){return new gl(s)}queryRadius(){return du(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:p,geometry:_,transform:b,pixelsToTileUnits:T,pixelPosMatrix:C}){const M=gf(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-b.bearingInRadians,T),O=this.paint.get("fill-extrusion-height").evaluate(l,p),F=this.paint.get("fill-extrusion-base").evaluate(l,p),j=(function(X,G){const te=[];for(const oe of X){const me=[oe.x,oe.y,0,1];rn(me,me,G),te.push(new v(me[0]/me[3],me[1]/me[3]))}return te})(M,C),H=(function(X,G,te,oe){const me=[],je=[],Te=oe[8]*G,Ie=oe[9]*G,Je=oe[10]*G,st=oe[11]*G,ft=oe[8]*te,Ot=oe[9]*te,St=oe[10]*te,Rt=oe[11]*te;for(const Gt of X){const Mt=[],kt=[];for(const ct of Gt){const ln=ct.x,gn=ct.y,tn=oe[0]*ln+oe[4]*gn+oe[12],Zt=oe[1]*ln+oe[5]*gn+oe[13],Bn=oe[2]*ln+oe[6]*gn+oe[14],Vi=oe[3]*ln+oe[7]*gn+oe[15],_r=Bn+Je,cs=Vi+st,qo=tn+ft,ao=Zt+Ot,Hr=Bn+St,Oi=Vi+Rt,Cr=new v((tn+Te)/cs,(Zt+Ie)/cs);Cr.z=_r/cs,Mt.push(Cr);const Zr=new v(qo/Oi,ao/Oi);Zr.z=Hr/Oi,kt.push(Zr)}me.push(Mt),je.push(kt)}return[me,je]})(_,F,O,C);return(function(X,G,te){let oe=1/0;em(te,G)&&(oe=gm(te,G[0]));for(let me=0;me<G.length;me++){const je=G[me],Te=X[me];for(let Ie=0;Ie<je.length-1;Ie++){const Je=je[Ie],st=[Je,je[Ie+1],Te[Ie+1],Te[Ie],Je];Qp(te,st)&&(oe=Math.min(oe,gm(te,st)))}}return oe!==1/0&&oe})(H[0],H[1],j)}}function ah(u,s){return u.x*s.x+u.y*s.y}function gm(u,s){if(u.length===1){let l=0;const p=s[l++];let _;for(;!_||p.equals(_);)if(_=s[l++],!_)return 1/0;for(;l<s.length;l++){const b=s[l],T=u[0],C=_.sub(p),M=b.sub(p),O=T.sub(p),F=ah(C,C),j=ah(C,M),H=ah(M,M),X=ah(O,C),G=ah(O,M),te=F*H-j*j,oe=(H*X-j*G)/te,me=(F*G-j*X)/te,je=p.z*(1-oe-me)+_.z*oe+b.z*me;if(isFinite(je))return je}return 1/0}{let l=1/0;for(const p of s)l=Math.min(l,p.z);return l}}const vu=Jn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Yy}=vu,lh=Jn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:$g}=lh,Zi=Math.cos(Math.PI/180*37.5),Wg=Math.pow(2,14)/.5;class Mf{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=s.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((l=>{this.gradients[l.id]={}})),this.layoutVertexArray=new _t,this.layoutVertexArray2=new ht,this.indexArray=new Di,this.programConfigurations=new cc(s.layers,s.zoom),this.segments=new En,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(s,l,p){this.hasDependencies=Wo("line",this.layers,l)||this.hasLineDasharray(this.layers);const _=this.layers[0].layout.get("line-sort-key"),b=!_.isConstant(),T=[];for(const{feature:C,id:M,index:O,sourceLayerIndex:F}of s){const j=this.layers[0]._featureFilter.needGeometry,H=or(C,j);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom),H,p))continue;const X=b?_.evaluate(H,{},p):void 0,G={id:M,properties:C.properties,type:C.type,sourceLayerIndex:F,index:O,geometry:j?H.geometry:hu(C),patterns:{},dashes:{},sortKey:X};T.push(G)}b&&T.sort(((C,M)=>C.sortKey-M.sortKey));for(const C of T){const{geometry:M,index:O,sourceLayerIndex:F}=C;this.hasDependencies?(Wo("line",this.layers,l)?Tf("line",this.layers,C,{zoom:this.zoom},l):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,C,this.zoom,l),this.patternFeatures.push(C)):this.addFeature(C,M,O,p,{},{},l.subdivisionGranularity),l.featureIndex.insert(s[O].feature,M,O,F,this.index)}}update(s,l,p,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:p,dashPositions:_})}addFeatures(s,l,p,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,p,_,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,$g)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Yy),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,l,p,_,b,T,C){const M=this.layers[0].layout,O=M.get("line-join").evaluate(s,{}),F=M.get("line-cap"),j=M.get("line-miter-limit"),H=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const X of l)this.addLine(X,s,O,F,j,H,_,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,{imagePositions:b,dashPositions:T,canonical:_})}addLine(s,l,p,_,b,T,C,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,s=Bs(s,C?M.line.getGranularityForZoomLevel(C.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Te=0;Te<s.length-1;Te++)this.totalDistance+=s[Te].dist(s[Te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const O=_u.types[l.type]==="Polygon";let F=s.length;for(;F>=2&&s[F-1].equals(s[F-2]);)F--;let j=0;for(;j<F-1&&s[j].equals(s[j+1]);)j++;if(F<(O?3:2))return;p==="bevel"&&(b=1.05);const H=this.overscaling<=16?122880/(512*this.overscaling):0,X=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let G,te,oe,me,je;this.e1=this.e2=-1,O&&(G=s[F-2],je=s[j].sub(G)._unit()._perp());for(let Te=j;Te<F;Te++){if(oe=Te===F-1?O?s[j+1]:void 0:s[Te+1],oe&&s[Te].equals(oe))continue;je&&(me=je),G&&(te=G),G=s[Te],je=oe?oe.sub(G)._unit()._perp():me,me=me||je;let Ie=me.add(je);Ie.x===0&&Ie.y===0||Ie._unit();const Je=me.x*je.x+me.y*je.y,st=Ie.x*je.x+Ie.y*je.y,ft=st!==0?1/st:1/0,Ot=2*Math.sqrt(2-2*st),St=st<Zi&&te&&oe,Rt=me.x*je.y-me.y*je.x>0;if(St&&Te>j){const kt=G.dist(te);if(kt>2*H){const ct=G.sub(G.sub(te)._mult(H/kt)._round());this.updateDistance(te,ct),this.addCurrentVertex(ct,me,0,0,X),te=ct}}const Gt=te&&oe;let Mt=Gt?p:O?"butt":_;if(Gt&&Mt==="round"&&(ft<T?Mt="miter":ft<=2&&(Mt="fakeround")),Mt==="miter"&&ft>b&&(Mt="bevel"),Mt==="bevel"&&(ft>2&&(Mt="flipbevel"),ft<b&&(Mt="miter")),te&&this.updateDistance(te,G),Mt==="miter")Ie._mult(ft),this.addCurrentVertex(G,Ie,0,0,X);else if(Mt==="flipbevel"){if(ft>100)Ie=je.mult(-1);else{const kt=ft*me.add(je).mag()/me.sub(je).mag();Ie._perp()._mult(kt*(Rt?-1:1))}this.addCurrentVertex(G,Ie,0,0,X),this.addCurrentVertex(G,Ie.mult(-1),0,0,X)}else if(Mt==="bevel"||Mt==="fakeround"){const kt=-Math.sqrt(ft*ft-1),ct=Rt?kt:0,ln=Rt?0:kt;if(te&&this.addCurrentVertex(G,me,ct,ln,X),Mt==="fakeround"){const gn=Math.round(180*Ot/Math.PI/20);for(let tn=1;tn<gn;tn++){let Zt=tn/gn;if(Zt!==.5){const Vi=Zt-.5;Zt+=Zt*Vi*(Zt-1)*((1.0904+Je*(Je*(3.55645-1.43519*Je)-3.2452))*Vi*Vi+(.848013+Je*(.215638*Je-1.06021)))}const Bn=je.sub(me)._mult(Zt)._add(me)._unit()._mult(Rt?-1:1);this.addHalfVertex(G,Bn.x,Bn.y,!1,Rt,0,X)}}oe&&this.addCurrentVertex(G,je,-ct,-ln,X)}else if(Mt==="butt")this.addCurrentVertex(G,Ie,0,0,X);else if(Mt==="square"){const kt=te?1:-1;this.addCurrentVertex(G,Ie,kt,kt,X)}else Mt==="round"&&(te&&(this.addCurrentVertex(G,me,0,0,X),this.addCurrentVertex(G,me,1,1,X,!0)),oe&&(this.addCurrentVertex(G,je,-1,-1,X,!0),this.addCurrentVertex(G,je,0,0,X)));if(St&&Te<F-1){const kt=G.dist(oe);if(kt>2*H){const ct=G.add(oe.sub(G)._mult(H/kt)._round());this.updateDistance(G,ct),this.addCurrentVertex(ct,je,0,0,X),G=ct}}}}addCurrentVertex(s,l,p,_,b,T=!1){const C=l.y*_-l.x,M=-l.y-l.x*_;this.addHalfVertex(s,l.x+l.y*p,l.y-l.x*p,T,!1,p,b),this.addHalfVertex(s,C,M,T,!0,-_,b),this.distance>Wg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,l,p,_,b,T))}addHalfVertex({x:s,y:l},p,_,b,T,C,M){const O=.5*(this.lineClips?this.scaledDistance*(Wg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(b?1:0),(l<<1)+(T?1:0),Math.round(63*p)+128,Math.round(63*_)+128,1+(C===0?0:C<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const F=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,F,this.e2),M.primitiveLength++),T?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,l){this.distance+=s.dist(l),this.updateScaledDistance()}hasLineDasharray(s){for(const l of s){const p=l.paint.get("line-dasharray");if(p&&!p.isConstant())return!0}return!1}addLineDashDependencies(s,l,p,_){for(const b of s){const T=b.paint.get("line-dasharray");if(!T||T.value.kind==="constant")continue;const C=b.layout.get("line-cap")==="round",M={dasharray:T.value.evaluate({zoom:p-1},l,{}),round:C},O={dasharray:T.value.evaluate({zoom:p},l,{}),round:C},F={dasharray:T.value.evaluate({zoom:p+1},l,{}),round:C},j=`${M.dasharray.join(",")},${M.round}`,H=`${O.dasharray.join(",")},${O.round}`,X=`${F.dasharray.join(",")},${F.round}`;_.dashDependencies[j]=M,_.dashDependencies[H]=O,_.dashDependencies[X]=F,l.dashes[b.id]={min:j,mid:H,max:X}}}}let Hg,Zg;Ct("LineBucket",Mf,{omit:["layers","patternFeatures"]});var _m={get paint(){return Zg=Zg||new zi({"line-opacity":new qt(Be.paint_line["line-opacity"]),"line-color":new qt(Be.paint_line["line-color"]),"line-translate":new jt(Be.paint_line["line-translate"]),"line-translate-anchor":new jt(Be.paint_line["line-translate-anchor"]),"line-width":new qt(Be.paint_line["line-width"]),"line-gap-width":new qt(Be.paint_line["line-gap-width"]),"line-offset":new qt(Be.paint_line["line-offset"]),"line-blur":new qt(Be.paint_line["line-blur"]),"line-dasharray":new al(Be.paint_line["line-dasharray"]),"line-pattern":new al(Be.paint_line["line-pattern"]),"line-gradient":new tc(Be.paint_line["line-gradient"])})},get layout(){return Hg=Hg||new zi({"line-cap":new jt(Be.layout_line["line-cap"]),"line-join":new qt(Be.layout_line["line-join"]),"line-miter-limit":new jt(Be.layout_line["line-miter-limit"]),"line-round-limit":new jt(Be.layout_line["line-round-limit"]),"line-sort-key":new qt(Be.layout_line["line-sort-key"])})}};class Xg extends qt{possiblyEvaluate(s,l){return l=new Xn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(s,l)}evaluate(s,l,p,_){return l=Ut({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(s,l,p,_)}}let Rf;class Ao extends pr{constructor(s,l){super(s,_m,l),this.gradientVersion=0,Rf||(Rf=new Xg(_m.paint.properties["line-width"].specification),Rf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!(function(p){return p._styleExpression!==void 0})(l)&&l._styleExpression.expression instanceof ci,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,l){super.recalculate(s,l),this.paint._values["line-floorwidth"]=Rf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Mf(s)}queryRadius(s){const l=s,p=kf(hc("line-width",this,l),hc("line-gap-width",this,l)),_=hc("line-offset",this,l);return p/2+Math.abs(_)+du(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:p,geometry:_,transform:b,pixelsToTileUnits:T}){const C=gf(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-b.bearingInRadians,T),M=T/2*kf(this.paint.get("line-width").evaluate(l,p),this.paint.get("line-gap-width").evaluate(l,p)),O=this.paint.get("line-offset").evaluate(l,p);return O&&(_=(function(F,j){const H=[];for(let X=0;X<F.length;X++){const G=F[X],te=[];for(let oe=0;oe<G.length;oe++){const me=G[oe-1],je=G[oe],Te=G[oe+1],Ie=oe===0?new v(0,0):je.sub(me)._unit()._perp(),Je=oe===G.length-1?new v(0,0):Te.sub(je)._unit()._perp(),st=Ie._add(Je)._unit(),ft=st.x*Je.x+st.y*Je.y;ft!==0&&st._mult(1/ft),te.push(st._mult(j)._add(je))}H.push(te)}return H})(_,O*T)),(function(F,j,H){for(let X=0;X<j.length;X++){const G=j[X];if(F.length>=3){for(let te=0;te<G.length;te++)if(uc(F,G[te]))return!0}if(tm(F,G,H))return!0}return!1})(C,_,M)}isTileClipped(){return!0}}function kf(u,s){return s>0?s+2*u:u}const Ky=Jn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gc=Jn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Jn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Df=Jn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Jn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _c=Jn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Of=Jn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ym(u,s,l){return u.sections.forEach((p=>{p.text=(function(_,b,T){const C=b.layout.get("text-transform").evaluate(T,{});return C==="uppercase"?_=_.toLocaleUpperCase():C==="lowercase"&&(_=_.toLocaleLowerCase()),ys.applyArabicShaping&&(_=ys.applyArabicShaping(_)),_})(p.text,s,l)})),u}Jn([{name:"triangle",components:3,type:"Uint16"}]),Jn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Jn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Jn([{type:"Float32",name:"offsetX"}]),Jn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Jn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const xu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ar=24;const gd=4294967296,qg=1/gd,vm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Lf{constructor(s=new Uint8Array(16)){this.buf=ArrayBuffer.isView(s)?s:new Uint8Array(s),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(s,l,p=this.length){for(;this.pos<p;){const _=this.readVarint(),b=_>>3,T=this.pos;this.type=7&_,s(b,l,this),this.pos===T&&this.skip(_)}return l}readMessage(s,l){return this.readFields(s,l,this.readVarint()+this.pos)}readFixed32(){const s=this.dataView.getUint32(this.pos,!0);return this.pos+=4,s}readSFixed32(){const s=this.dataView.getInt32(this.pos,!0);return this.pos+=4,s}readFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*gd;return this.pos+=8,s}readSFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*gd;return this.pos+=8,s}readFloat(){const s=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,s}readDouble(){const s=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,s}readVarint(s){const l=this.buf;let p,_;return _=l[this.pos++],p=127&_,_<128?p:(_=l[this.pos++],p|=(127&_)<<7,_<128?p:(_=l[this.pos++],p|=(127&_)<<14,_<128?p:(_=l[this.pos++],p|=(127&_)<<21,_<128?p:(_=l[this.pos],p|=(15&_)<<28,(function(b,T,C){const M=C.buf;let O,F;if(F=M[C.pos++],O=(112&F)>>4,F<128||(F=M[C.pos++],O|=(127&F)<<3,F<128)||(F=M[C.pos++],O|=(127&F)<<10,F<128)||(F=M[C.pos++],O|=(127&F)<<17,F<128)||(F=M[C.pos++],O|=(127&F)<<24,F<128)||(F=M[C.pos++],O|=(1&F)<<31,F<128))return _l(b,O,T);throw new Error("Expected varint not more than 10 bytes")})(p,s,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const s=this.readVarint();return s%2==1?(s+1)/-2:s/2}readBoolean(){return!!this.readVarint()}readString(){const s=this.readVarint()+this.pos,l=this.pos;return this.pos=s,s-l>=12&&vm?vm.decode(this.buf.subarray(l,s)):(function(p,_,b){let T="",C=_;for(;C<b;){const M=p[C];let O,F,j,H=null,X=M>239?4:M>223?3:M>191?2:1;if(C+X>b)break;X===1?M<128&&(H=M):X===2?(O=p[C+1],(192&O)==128&&(H=(31&M)<<6|63&O,H<=127&&(H=null))):X===3?(O=p[C+1],F=p[C+2],(192&O)==128&&(192&F)==128&&(H=(15&M)<<12|(63&O)<<6|63&F,(H<=2047||H>=55296&&H<=57343)&&(H=null))):X===4&&(O=p[C+1],F=p[C+2],j=p[C+3],(192&O)==128&&(192&F)==128&&(192&j)==128&&(H=(15&M)<<18|(63&O)<<12|(63&F)<<6|63&j,(H<=65535||H>=1114112)&&(H=null))),H===null?(H=65533,X=1):H>65535&&(H-=65536,T+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),T+=String.fromCharCode(H),C+=X}return T})(this.buf,l,s)}readBytes(){const s=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,s);return this.pos=s,l}readPackedVarint(s=[],l){const p=this.readPackedEnd();for(;this.pos<p;)s.push(this.readVarint(l));return s}readPackedSVarint(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSVarint());return s}readPackedBoolean(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readBoolean());return s}readPackedFloat(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFloat());return s}readPackedDouble(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readDouble());return s}readPackedFixed32(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFixed32());return s}readPackedSFixed32(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSFixed32());return s}readPackedFixed64(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFixed64());return s}readPackedSFixed64(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSFixed64());return s}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(s){const l=7&s;if(l===0)for(;this.buf[this.pos++]>127;);else if(l===2)this.pos=this.readVarint()+this.pos;else if(l===5)this.pos+=4;else{if(l!==1)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(s,l){this.writeVarint(s<<3|l)}realloc(s){let l=this.length||16;for(;l<this.pos+s;)l*=2;if(l!==this.length){const p=new Uint8Array(l);p.set(this.buf),this.buf=p,this.dataView=new DataView(p.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeSFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*qg),!0),this.pos+=8}writeSFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*qg),!0),this.pos+=8}writeVarint(s){(s=+s||0)>268435455||s<0?(function(l,p){let _,b;if(l>=0?(_=l%4294967296|0,b=l/4294967296|0):(_=~(-l%4294967296),b=~(-l/4294967296),4294967295^_?_=_+1|0:(_=0,b=b+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),(function(T,C,M){M.buf[M.pos++]=127&T|128,T>>>=7,M.buf[M.pos++]=127&T|128,T>>>=7,M.buf[M.pos++]=127&T|128,T>>>=7,M.buf[M.pos++]=127&T|128,M.buf[M.pos]=127&(T>>>=7)})(_,0,p),(function(T,C){const M=(7&T)<<4;C.buf[C.pos++]|=M|((T>>>=3)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T)))))})(b,p)})(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))}writeSVarint(s){this.writeVarint(s<0?2*-s-1:2*s)}writeBoolean(s){this.writeVarint(+s)}writeString(s){s=String(s),this.realloc(4*s.length),this.pos++;const l=this.pos;this.pos=(function(_,b,T){for(let C,M,O=0;O<b.length;O++){if(C=b.charCodeAt(O),C>55295&&C<57344){if(!M){C>56319||O+1===b.length?(_[T++]=239,_[T++]=191,_[T++]=189):M=C;continue}if(C<56320){_[T++]=239,_[T++]=191,_[T++]=189,M=C;continue}C=M-55296<<10|C-56320|65536,M=null}else M&&(_[T++]=239,_[T++]=191,_[T++]=189,M=null);C<128?_[T++]=C:(C<2048?_[T++]=C>>6|192:(C<65536?_[T++]=C>>12|224:(_[T++]=C>>18|240,_[T++]=C>>12&63|128),_[T++]=C>>6&63|128),_[T++]=63&C|128)}return T})(this.buf,s,this.pos);const p=this.pos-l;p>=128&&_d(l,p,this),this.pos=l-1,this.writeVarint(p),this.pos+=p}writeFloat(s){this.realloc(4),this.dataView.setFloat32(this.pos,s,!0),this.pos+=4}writeDouble(s){this.realloc(8),this.dataView.setFloat64(this.pos,s,!0),this.pos+=8}writeBytes(s){const l=s.length;this.writeVarint(l),this.realloc(l);for(let p=0;p<l;p++)this.buf[this.pos++]=s[p]}writeRawMessage(s,l){this.pos++;const p=this.pos;s(l,this);const _=this.pos-p;_>=128&&_d(p,_,this),this.pos=p-1,this.writeVarint(_),this.pos+=_}writeMessage(s,l,p){this.writeTag(s,2),this.writeRawMessage(l,p)}writePackedVarint(s,l){l.length&&this.writeMessage(s,Gg,l)}writePackedSVarint(s,l){l.length&&this.writeMessage(s,xm,l)}writePackedBoolean(s,l){l.length&&this.writeMessage(s,bm,l)}writePackedFloat(s,l){l.length&&this.writeMessage(s,Jy,l)}writePackedDouble(s,l){l.length&&this.writeMessage(s,Yg,l)}writePackedFixed32(s,l){l.length&&this.writeMessage(s,Ff,l)}writePackedSFixed32(s,l){l.length&&this.writeMessage(s,wm,l)}writePackedFixed64(s,l){l.length&&this.writeMessage(s,Nf,l)}writePackedSFixed64(s,l){l.length&&this.writeMessage(s,Kg,l)}writeBytesField(s,l){this.writeTag(s,2),this.writeBytes(l)}writeFixed32Field(s,l){this.writeTag(s,5),this.writeFixed32(l)}writeSFixed32Field(s,l){this.writeTag(s,5),this.writeSFixed32(l)}writeFixed64Field(s,l){this.writeTag(s,1),this.writeFixed64(l)}writeSFixed64Field(s,l){this.writeTag(s,1),this.writeSFixed64(l)}writeVarintField(s,l){this.writeTag(s,0),this.writeVarint(l)}writeSVarintField(s,l){this.writeTag(s,0),this.writeSVarint(l)}writeStringField(s,l){this.writeTag(s,2),this.writeString(l)}writeFloatField(s,l){this.writeTag(s,5),this.writeFloat(l)}writeDoubleField(s,l){this.writeTag(s,1),this.writeDouble(l)}writeBooleanField(s,l){this.writeVarintField(s,+l)}}function _l(u,s,l){return l?4294967296*s+(u>>>0):4294967296*(s>>>0)+(u>>>0)}function _d(u,s,l){const p=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(p);for(let _=l.pos-1;_>=u;_--)l.buf[_+p]=l.buf[_]}function Gg(u,s){for(let l=0;l<u.length;l++)s.writeVarint(u[l])}function xm(u,s){for(let l=0;l<u.length;l++)s.writeSVarint(u[l])}function Jy(u,s){for(let l=0;l<u.length;l++)s.writeFloat(u[l])}function Yg(u,s){for(let l=0;l<u.length;l++)s.writeDouble(u[l])}function bm(u,s){for(let l=0;l<u.length;l++)s.writeBoolean(u[l])}function Ff(u,s){for(let l=0;l<u.length;l++)s.writeFixed32(u[l])}function wm(u,s){for(let l=0;l<u.length;l++)s.writeSFixed32(u[l])}function Nf(u,s){for(let l=0;l<u.length;l++)s.writeFixed64(u[l])}function Kg(u,s){for(let l=0;l<u.length;l++)s.writeSFixed64(u[l])}function Qy(u,s,l){u===1&&l.readMessage(Bf,s)}function Bf(u,s,l){if(u===3){const{id:p,bitmap:_,width:b,height:T,left:C,top:M,advance:O}=l.readMessage(ev,{});s.push({id:p,bitmap:new ud({width:b+6,height:T+6},_),metrics:{width:b,height:T,left:C,top:M,advance:O}})}}function ev(u,s,l){u===1?s.id=l.readVarint():u===2?s.bitmap=l.readBytes():u===3?s.width=l.readVarint():u===4?s.height=l.readVarint():u===5?s.left=l.readSVarint():u===6?s.top=l.readSVarint():u===7&&(s.advance=l.readVarint())}function ch(u){let s=0,l=0;for(const T of u)s+=T.w*T.h,l=Math.max(l,T.w);u.sort(((T,C)=>C.h-T.h));const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}];let _=0,b=0;for(const T of u)for(let C=p.length-1;C>=0;C--){const M=p[C];if(!(T.w>M.w||T.h>M.h)){if(T.x=M.x,T.y=M.y,b=Math.max(b,T.y+T.h),_=Math.max(_,T.x+T.w),T.w===M.w&&T.h===M.h){const O=p.pop();O&&C<p.length&&(p[C]=O)}else T.h===M.h?(M.x+=T.w,M.w-=T.w):T.w===M.w?(M.y+=T.h,M.h-=T.h):(p.push({x:M.x+T.w,y:M.y,w:M.w-T.w,h:T.h}),M.y+=T.h,M.h-=T.h);break}}return{w:_,h:b,fill:s/(_*b)||0}}class Tm{constructor(s,{pixelRatio:l,version:p,stretchX:_,stretchY:b,content:T,textFitWidth:C,textFitHeight:M}){this.paddedRect=s,this.pixelRatio=l,this.stretchX=_,this.stretchY=b,this.content=T,this.version=p,this.textFitWidth=C,this.textFitHeight=M}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class yd{constructor(s,l){const p={},_={};this.haveRenderCallbacks=[];const b=[];this.addImages(s,p,b),this.addImages(l,_,b);const{w:T,h:C}=ch(b),M=new Nt({width:T||1,height:C||1});for(const O in s){const F=s[O],j=p[O].paddedRect;Nt.copy(F.data,M,{x:0,y:0},{x:j.x+1,y:j.y+1},F.data)}for(const O in l){const F=l[O],j=_[O].paddedRect,H=j.x+1,X=j.y+1,G=F.data.width,te=F.data.height;Nt.copy(F.data,M,{x:0,y:0},{x:H,y:X},F.data),Nt.copy(F.data,M,{x:0,y:te-1},{x:H,y:X-1},{width:G,height:1}),Nt.copy(F.data,M,{x:0,y:0},{x:H,y:X+te},{width:G,height:1}),Nt.copy(F.data,M,{x:G-1,y:0},{x:H-1,y:X},{width:1,height:te}),Nt.copy(F.data,M,{x:0,y:0},{x:H+G,y:X},{width:1,height:te})}this.image=M,this.iconPositions=p,this.patternPositions=_}addImages(s,l,p){for(const _ in s){const b=s[_],T={x:0,y:0,w:b.data.width+2,h:b.data.height+2};p.push(T),l[_]=new Tm(T,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(s,l){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in s.updatedImages)this.patchUpdatedImage(this.iconPositions[p],s.getImage(p),l),this.patchUpdatedImage(this.patternPositions[p],s.getImage(p),l)}patchUpdatedImage(s,l,p){if(!s||!l||s.version===l.version)return;s.version=l.version;const[_,b]=s.tl;p.update(l.data,void 0,{x:_,y:b})}}var f;Ct("ImagePosition",Tm),Ct("ImageAtlas",yd),d.ao=void 0,(f=d.ao||(d.ao={}))[f.none=0]="none",f[f.horizontal=1]="horizontal",f[f.vertical=2]="vertical",f[f.horizontalOnly=3]="horizontalOnly";class g{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(s,l,p){const _=new g;return _.scale=s||1,_.fontStack=l,_.verticalAlign=p||"bottom",_}static forImage(s,l){const p=new g;return p.imageName=s,p.verticalAlign=l||"bottom",p}}class S{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,l){const p=new S;for(let _=0;_<s.sections.length;_++){const b=s.sections[_];b.image?p.addImageSection(b):p.addTextSection(b,l)}return p}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=(function(s){let l="";for(let p=0;p<s.length;p++){const _=s.charCodeAt(p+1)||null,b=s.charCodeAt(p-1)||null;l+=_&&ou(_)&&!xu[s[p+1]]||b&&ou(b)&&!xu[s[p-1]]||!xu[s[p]]?s[p]:xu[s[p]]}return l})(this.text)}trim(){let s=0;for(let p=0;p<this.text.length&&N[this.text.charCodeAt(p)];p++)s++;let l=this.text.length;for(let p=this.text.length-1;p>=0&&p>=s&&N[this.text.charCodeAt(p)];p--)l--;this.text=this.text.substring(s,l),this.sectionIndex=this.sectionIndex.slice(s,l)}substring(s,l){const p=new S;return p.text=this.text.substring(s,l),p.sectionIndex=this.sectionIndex.slice(s,l),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((s,l)=>Math.max(s,this.sections[l].scale)),0)}getMaxImageSize(s){let l=0,p=0;for(let _=0;_<this.length();_++){const b=this.getSection(_);if(b.imageName){const T=s[b.imageName];if(!T)continue;const C=T.displaySize;l=Math.max(l,C[0]),p=Math.max(p,C[1])}}return{maxImageWidth:l,maxImageHeight:p}}addTextSection(s,l){this.text+=s.text,this.sections.push(g.forText(s.scale,s.fontStack||l,s.verticalAlign));const p=this.sections.length-1;for(let _=0;_<s.text.length;++_)this.sectionIndex.push(p)}addImageSection(s){const l=s.image?s.image.name:"";if(l.length===0)return void ri("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(g.forImage(l,s.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):ri("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function I(u,s,l,p,_,b,T,C,M,O,F,j,H,X,G){const te=S.fromFeature(u,_);let oe;j===d.ao.vertical&&te.verticalizePunctuation();const{processBidirectionalText:me,processStyledBidirectionalText:je}=ys;if(me&&te.sections.length===1){oe=[];const Je=me(te.toString(),yt(te,O,b,s,p,X));for(const st of Je){const ft=new S;ft.text=st,ft.sections=te.sections;for(let Ot=0;Ot<st.length;Ot++)ft.sectionIndex.push(0);oe.push(ft)}}else if(je){oe=[];const Je=je(te.text,te.sectionIndex,yt(te,O,b,s,p,X));for(const st of Je){const ft=new S;ft.text=st[0],ft.sectionIndex=st[1],ft.sections=te.sections,oe.push(ft)}}else oe=(function(Je,st){const ft=[],Ot=Je.text;let St=0;for(const Rt of st)ft.push(Je.substring(St,Rt)),St=Rt;return St<Ot.length&&ft.push(Je.substring(St,Ot.length)),ft})(te,yt(te,O,b,s,p,X));const Te=[],Ie={positionedLines:Te,text:te.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:j,iconsInText:!1,verticalizable:!1};return(function(Je,st,ft,Ot,St,Rt,Gt,Mt,kt,ct,ln,gn){let tn=0,Zt=0,Bn=0,Vi=0;const _r=Mt==="right"?1:Mt==="left"?0:.5,cs=ar/gn;let qo=0;for(const Oi of St){Oi.trim();const Cr=Oi.getMaxScale(),Zr={positionedGlyphs:[],lineOffset:0};Je.positionedLines[qo]=Zr;const Xr=Zr.positionedGlyphs;let Us=0;if(!Oi.length()){Zt+=Rt,++qo;continue}const Go=Kt(Ot,Oi,cs);for(let lo=0;lo<Oi.length();lo++){const yr=Oi.getSection(lo),Mr=Oi.getSectionIndex(lo),Rr=Oi.getCharCode(lo),lr=Qi(kt,ln,Rr);let wi;if(yr.imageName){if(Je.iconsInText=!0,yr.scale=yr.scale*cs,wi=Ve(yr,lr,Cr,Go,Ot),!wi)continue;Us=Math.max(Us,wi.imageOffset)}else if(wi=Qe(yr,Rr,lr,Go,st,ft),!wi)continue;const{rect:yl,metrics:$f,baselineOffset:vl}=wi;Xr.push({glyph:Rr,imageName:yr.imageName,x:tn,y:Zt+vl+-17,vertical:lr,scale:yr.scale,fontStack:yr.fontStack,sectionIndex:Mr,metrics:$f,rect:yl}),lr?(Je.verticalizable=!0,tn+=(yr.imageName?$f.advance:ar)*yr.scale+ct):tn+=$f.advance*yr.scale+ct}Xr.length!==0&&(Bn=Math.max(tn-ct,Bn),it(Xr,0,Xr.length-1,_r)),tn=0,Zr.lineOffset=Math.max(Us,(Cr-1)*ar);const Ir=Rt*Cr+Us;Zt+=Ir,Vi=Math.max(Ir,Vi),++qo}const{horizontalAlign:ao,verticalAlign:Hr}=Ht(Gt);(function(Oi,Cr,Zr,Xr,Us,Go,Ir,lo,yr){const Mr=(Cr-Zr)*Us;let Rr=0;Rr=Go!==Ir?-lo*Xr- -17:-Xr*yr*Ir+.5*Ir;for(const lr of Oi)for(const wi of lr.positionedGlyphs)wi.x+=Mr,wi.y+=Rr})(Je.positionedLines,_r,ao,Hr,Bn,Vi,Rt,Zt,St.length),Je.top+=-Hr*Zt,Je.bottom=Je.top+Zt,Je.left+=-ao*Bn,Je.right=Je.left+Bn})(Ie,s,l,p,oe,T,C,M,j,O,H,G),!(function(Je){for(const st of Je)if(st.positionedGlyphs.length!==0)return!1;return!0})(Te)&&Ie}const N={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},V={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ee={40:!0};function Ee(u,s,l,p,_,b){if(s.imageName){const T=p[s.imageName];return T?T.displaySize[0]*s.scale*ar/b+_:0}{const T=l[s.fontStack],C=T&&T[u];return C?C.metrics.advance*s.scale+_:0}}function Oe(u,s,l,p){const _=Math.pow(u-s,2);return p?u<s?_/2:2*_:_+Math.abs(l)*l}function ot(u,s,l){let p=0;return u===10&&(p-=1e4),l&&(p+=150),u!==40&&u!==65288||(p+=50),s!==41&&s!==65289||(p+=50),p}function Tt(u,s,l,p,_,b){let T=null,C=Oe(s,l,_,b);for(const M of p){const O=Oe(s-M.x,l,_,b)+M.badness;O<=C&&(T=M,C=O)}return{index:u,x:s,priorBreak:T,badness:C}}function At(u){return u?At(u.priorBreak).concat(u.index):[]}function yt(u,s,l,p,_,b){if(!u)return[];const T=[],C=(function(j,H,X,G,te,oe){let me=0;for(let je=0;je<j.length();je++){const Te=j.getSection(je);me+=Ee(j.getCharCode(je),Te,G,te,H,oe)}return me/Math.max(1,Math.ceil(me/X))})(u,s,l,p,_,b),M=u.text.indexOf("")>=0;let O=0;for(let j=0;j<u.length();j++){const H=u.getSection(j),X=u.getCharCode(j);if(N[X]||(O+=Ee(X,H,p,_,s,b)),j<u.length()-1){const G=!((F=X)<11904)&&(!!Rn["CJK Compatibility Forms"](F)||!!Rn["CJK Compatibility"](F)||!!Rn["CJK Strokes"](F)||!!Rn["CJK Symbols and Punctuation"](F)||!!Rn["Enclosed CJK Letters and Months"](F)||!!Rn["Halfwidth and Fullwidth Forms"](F)||!!Rn["Ideographic Description Characters"](F)||!!Rn["Vertical Forms"](F)||od.test(String.fromCodePoint(F)));(V[X]||G||H.imageName||j!==u.length()-2&&ee[u.getCharCode(j+1)])&&T.push(Tt(j+1,O,C,T,ot(X,u.getCharCode(j+1),G&&M),!1))}}var F;return At(Tt(u.length(),O,C,T,0,!0))}function Ht(u){let s=.5,l=.5;switch(u){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function Kt(u,s,l){const p=s.getMaxScale()*ar,{maxImageWidth:_,maxImageHeight:b}=s.getMaxImageSize(u),T=Math.max(p,b*l);return{verticalLineContentWidth:Math.max(p,_*l),horizontalLineContentHeight:T}}function Jt(u){switch(u){case"top":return 0;case"center":return .5;default:return 1}}function Qi(u,s,l){return!(u===d.ao.horizontal||!s&&!qu(l)||s&&(N[l]||(p=l,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function Qe(u,s,l,p,_,b){const T=b[u.fontStack],C=(function(O,F,j,H){if(O&&O.rect)return O;const X=F[j.fontStack],G=X&&X[H];return G?{rect:null,metrics:G.metrics}:null})(T&&T[s],_,u,s);if(C===null)return null;let M;if(l)M=p.verticalLineContentWidth-u.scale*ar;else{const O=Jt(u.verticalAlign);M=(p.horizontalLineContentHeight-u.scale*ar)*O}return{rect:C.rect,metrics:C.metrics,baselineOffset:M}}function Ve(u,s,l,p,_){const b=_[u.imageName];if(!b)return null;const T=b.paddedRect,C=b.displaySize,M={width:C[0],height:C[1],left:1,top:-3,advance:s?C[1]:C[0]};let O;if(s)O=p.verticalLineContentWidth-C[1]*u.scale;else{const F=Jt(u.verticalAlign);O=(p.horizontalLineContentHeight-C[1]*u.scale)*F}return{rect:T,metrics:M,baselineOffset:O,imageOffset:(s?C[0]:C[1])*u.scale-ar*l}}function it(u,s,l,p){if(p===0)return;const _=u[l],b=(u[l].x+_.metrics.advance*_.scale)*p;for(let T=s;T<=l;T++)u[T].x-=b}function Lt(u,s,l){const{horizontalAlign:p,verticalAlign:_}=Ht(l),b=s[0]-u.displaySize[0]*p,T=s[1]-u.displaySize[1]*_;return{image:u,top:T,bottom:T+u.displaySize[1],left:b,right:b+u.displaySize[0]}}function en(u){var s,l;let p=u.left,_=u.top,b=u.right-p,T=u.bottom-_;const C=(s=u.image.textFitWidth)!==null&&s!==void 0?s:"stretchOrShrink",M=(l=u.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",O=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(M==="proportional"){if(C==="stretchOnly"&&b/T<O||C==="proportional"){const F=Math.ceil(T*O);p*=F/b,b=F}}else if(C==="proportional"&&M==="stretchOnly"&&O!==0&&b/T>O){const F=Math.ceil(b/O);_*=F/T,T=F}return{x1:p,y1:_,x2:p+b,y2:_+T}}function dn(u,s,l,p,_,b){const T=u.image;let C;if(T.content){const oe=T.content,me=T.pixelRatio||1;C=[oe[0]/me,oe[1]/me,T.displaySize[0]-oe[2]/me,T.displaySize[1]-oe[3]/me]}const M=s.left*b,O=s.right*b;let F,j,H,X;l==="width"||l==="both"?(X=_[0]+M-p[3],j=_[0]+O+p[1]):(X=_[0]+(M+O-T.displaySize[0])/2,j=X+T.displaySize[0]);const G=s.top*b,te=s.bottom*b;return l==="height"||l==="both"?(F=_[1]+G-p[0],H=_[1]+te+p[2]):(F=_[1]+(G+te-T.displaySize[1])/2,H=F+T.displaySize[1]),{image:T,top:F,right:j,bottom:H,left:X,collisionPadding:C}}const nn=128,cn=32640;function gr(u,s){const{expression:l}=s;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Xn(u+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=l;let b=0;for(;b<p.length&&p[b]<=u;)b++;b=Math.max(0,b-1);let T=b;for(;T<p.length&&p[T]<u+1;)T++;T=Math.min(p.length-1,T);const C=p[b],M=p[T];return l.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:M,interpolationType:_}:{kind:"camera",minZoom:C,maxZoom:M,minSize:l.evaluate(new Xn(C)),maxSize:l.evaluate(new Xn(M)),interpolationType:_}}}function Gn(u,s,l){let p="never";const _=u.get(s);return _?p=_:u.get(l)&&(p="always"),p}const yc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zf(u,s,l,p,_,b,T,C,M,O,F,j,H){const X=C?Math.min(cn,Math.round(C[0])):0,G=C?Math.min(cn,Math.round(C[1])):0;u.emplaceBack(s,l,Math.round(32*p),Math.round(32*_),b,T,(X<<1)+(M?1:0),G,16*O,16*F,256*j,256*H)}function tv(u,s,l){u.emplaceBack(s.x,s.y,l),u.emplaceBack(s.x,s.y,l),u.emplaceBack(s.x,s.y,l),u.emplaceBack(s.x,s.y,l)}function rI(u){for(const s of u.sections)if(lu(s.text))return!0;return!1}class nv{constructor(s){this.layoutVertexArray=new qn,this.indexArray=new Di,this.programConfigurations=s,this.segments=new En,this.dynamicLayoutVertexArray=new ui,this.opacityVertexArray=new oi,this.hasVisibleVertices=!1,this.placedSymbolArray=new le}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,l,p,_){this.isEmpty()||(p&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Ky.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,gc.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,yc,!0),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ct("SymbolBuffers",nv);class iv{constructor(s,l,p){this.layoutVertexArray=new s,this.layoutAttributes=l,this.indexArray=new p,this.segments=new En,this.collisionVertexArray=new hi}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Df.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ct("CollisionBuffers",iv);class Uf{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map((T=>T.id)),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gr(this.zoom,l["text-size"]),this.iconSizeData=gr(this.zoom,l["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),b=p.get("symbol-z-order");this.canOverlap=Gn(p,"text-overlap","text-allow-overlap")!=="never"||Gn(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map((T=>d.ao[T]))),this.stateDependentLayerIds=this.layers.filter((T=>T.isStateDependent())).map((T=>T.id)),this.sourceID=s.sourceID}createArrays(){this.text=new nv(new cc(this.layers,this.zoom,(s=>/^text/.test(s)))),this.icon=new nv(new cc(this.layers,this.zoom,(s=>/^icon/.test(s)))),this.glyphOffsetArray=new fe,this.lineVertexArray=new Ae,this.symbolInstances=new be,this.textAnchorOffsets=new xe}calculateGlyphDependencies(s,l,p,_,b){for(let T=0;T<s.length;T++)if(l[s.charCodeAt(T)]=!0,(p||_)&&b){const C=xu[s.charAt(T)];C&&(l[C.charCodeAt(0)]=!0)}}populate(s,l,p){const _=this.layers[0],b=_.layout,T=b.get("text-font"),C=b.get("text-field"),M=b.get("icon-image"),O=(C.value.kind!=="constant"||C.value.value instanceof Mi&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),F=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,j=b.get("symbol-sort-key");if(this.features=[],!O&&!F)return;const H=l.iconDependencies,X=l.glyphDependencies,G=l.availableImages,te=new Xn(this.zoom);for(const{feature:oe,id:me,index:je,sourceLayerIndex:Te}of s){const Ie=_._featureFilter.needGeometry,Je=or(oe,Ie);if(!_._featureFilter.filter(te,Je,p))continue;let st,ft;if(Ie||(Je.geometry=hu(oe)),O){const St=_.getValueAndResolveTokens("text-field",Je,p,G),Rt=Mi.factory(St),Gt=this.hasRTLText=this.hasRTLText||rI(Rt);(!Gt||ys.getRTLTextPluginStatus()==="unavailable"||Gt&&ys.isParsed())&&(st=ym(Rt,_,Je))}if(F){const St=_.getValueAndResolveTokens("icon-image",Je,p,G);ft=St instanceof fs?St:fs.fromString(St)}if(!st&&!ft)continue;const Ot=this.sortFeaturesByKey?j.evaluate(Je,{},p):void 0;if(this.features.push({id:me,text:st,icon:ft,index:je,sourceLayerIndex:Te,geometry:Je.geometry,properties:oe.properties,type:_u.types[oe.type],sortKey:Ot}),ft&&(H[ft.name]=!0),st){const St=T.evaluate(Je,{},p).join(","),Rt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ao.vertical)>=0;for(const Gt of st.sections)if(Gt.image)H[Gt.image.name]=!0;else{const Mt=su(st.toString()),kt=Gt.fontStack||St,ct=X[kt]=X[kt]||{};this.calculateGlyphDependencies(Gt.text,ct,Rt,this.allowVerticalPlacement,Mt)}}}b.get("symbol-placement")==="line"&&(this.features=(function(oe){const me={},je={},Te=[];let Ie=0;function Je(St){Te.push(oe[St]),Ie++}function st(St,Rt,Gt){const Mt=je[St];return delete je[St],je[Rt]=Mt,Te[Mt].geometry[0].pop(),Te[Mt].geometry[0]=Te[Mt].geometry[0].concat(Gt[0]),Mt}function ft(St,Rt,Gt){const Mt=me[Rt];return delete me[Rt],me[St]=Mt,Te[Mt].geometry[0].shift(),Te[Mt].geometry[0]=Gt[0].concat(Te[Mt].geometry[0]),Mt}function Ot(St,Rt,Gt){const Mt=Gt?Rt[0][Rt[0].length-1]:Rt[0][0];return`${St}:${Mt.x}:${Mt.y}`}for(let St=0;St<oe.length;St++){const Rt=oe[St],Gt=Rt.geometry,Mt=Rt.text?Rt.text.toString():null;if(!Mt){Je(St);continue}const kt=Ot(Mt,Gt),ct=Ot(Mt,Gt,!0);if(kt in je&&ct in me&&je[kt]!==me[ct]){const ln=ft(kt,ct,Gt),gn=st(kt,ct,Te[ln].geometry);delete me[kt],delete je[ct],je[Ot(Mt,Te[gn].geometry,!0)]=gn,Te[ln].geometry=null}else kt in je?st(kt,ct,Gt):ct in me?ft(kt,ct,Gt):(Je(St),me[kt]=Ie-1,je[ct]=Ie-1)}return Te.filter((St=>St.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((oe,me)=>oe.sortKey-me.sortKey))}update(s,l,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,l,this.layers,{imagePositions:p}),this.icon.programConfigurations.updatePaintArrays(s,l,this.layers,{imagePositions:p}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,l){const p=this.lineVertexArray.length;if(s.segment!==void 0){let _=s.dist(l[s.segment+1]),b=s.dist(l[s.segment]);const T={};for(let C=s.segment+1;C<l.length;C++)T[C]={x:l[C].x,y:l[C].y,tileUnitDistanceFromAnchor:_},C<l.length-1&&(_+=l[C+1].dist(l[C]));for(let C=s.segment||0;C>=0;C--)T[C]={x:l[C].x,y:l[C].y,tileUnitDistanceFromAnchor:b},C>0&&(b+=l[C-1].dist(l[C]));for(let C=0;C<l.length;C++){const M=T[C];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(s,l,p,_,b,T,C,M,O,F,j,H){const X=s.indexArray,G=s.layoutVertexArray,te=s.segments.prepareSegment(4*l.length,G,X,this.canOverlap?T.sortKey:void 0),oe=this.glyphOffsetArray.length,me=te.vertexLength,je=this.allowVerticalPlacement&&C===d.ao.vertical?Math.PI/2:0,Te=T.text&&T.text.sections;for(let Ie=0;Ie<l.length;Ie++){const{tl:Je,tr:st,bl:ft,br:Ot,tex:St,pixelOffsetTL:Rt,pixelOffsetBR:Gt,minFontScaleX:Mt,minFontScaleY:kt,glyphOffset:ct,isSDF:ln,sectionIndex:gn}=l[Ie],tn=te.vertexLength,Zt=ct[1];zf(G,M.x,M.y,Je.x,Zt+Je.y,St.x,St.y,p,ln,Rt.x,Rt.y,Mt,kt),zf(G,M.x,M.y,st.x,Zt+st.y,St.x+St.w,St.y,p,ln,Gt.x,Rt.y,Mt,kt),zf(G,M.x,M.y,ft.x,Zt+ft.y,St.x,St.y+St.h,p,ln,Rt.x,Gt.y,Mt,kt),zf(G,M.x,M.y,Ot.x,Zt+Ot.y,St.x+St.w,St.y+St.h,p,ln,Gt.x,Gt.y,Mt,kt),tv(s.dynamicLayoutVertexArray,M,je),X.emplaceBack(tn,tn+2,tn+1),X.emplaceBack(tn+1,tn+2,tn+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),Ie!==l.length-1&&gn===l[Ie+1].sectionIndex||s.programConfigurations.populatePaintArrays(G.length,T,T.index,{imagePositions:{},canonical:H,formattedSection:Te&&Te[gn]})}s.placedSymbolArray.emplaceBack(M.x,M.y,oe,this.glyphOffsetArray.length-oe,me,O,F,M.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],C,0,!1,0,j)}_addCollisionDebugVertex(s,l,p,_,b,T){return l.emplaceBack(0,0),s.emplaceBack(p.x,p.y,_,b,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(s,l,p,_,b,T,C){const M=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),O=M.vertexLength,F=b.layoutVertexArray,j=b.collisionVertexArray,H=C.anchorX,X=C.anchorY;this._addCollisionDebugVertex(F,j,T,H,X,new v(s,l)),this._addCollisionDebugVertex(F,j,T,H,X,new v(p,l)),this._addCollisionDebugVertex(F,j,T,H,X,new v(p,_)),this._addCollisionDebugVertex(F,j,T,H,X,new v(s,_)),M.vertexLength+=4;const G=b.indexArray;G.emplaceBack(O,O+1),G.emplaceBack(O+1,O+2),G.emplaceBack(O+2,O+3),G.emplaceBack(O+3,O),M.primitiveLength+=4}addDebugCollisionBoxes(s,l,p,_){for(let b=s;b<l;b++){const T=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,_?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new iv(ni,_c.members,ii),this.iconCollisionBox=new iv(ni,_c.members,ii);for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(s,l,p,_,b,T,C,M,O){const F={};for(let j=l;j<p;j++){const H=s.get(j);F.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.textFeatureIndex=H.featureIndex;break}for(let j=_;j<b;j++){const H=s.get(j);F.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.verticalTextFeatureIndex=H.featureIndex;break}for(let j=T;j<C;j++){const H=s.get(j);F.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.iconFeatureIndex=H.featureIndex;break}for(let j=M;j<O;j++){const H=s.get(j);F.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.verticalIconFeatureIndex=H.featureIndex;break}return F}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const p=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,l){const p=s.placedSymbolArray.get(l),_=p.vertexStartIndex+4*p.numGlyphs;for(let b=p.vertexStartIndex;b<_;b+=4)s.indexArray.emplaceBack(b,b+2,b+1),s.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(s),p=Math.cos(s),_=[],b=[],T=[];for(let C=0;C<this.symbolInstances.length;++C){T.push(C);const M=this.symbolInstances.get(C);_.push(0|Math.round(l*M.anchorX+p*M.anchorY)),b.push(M.featureIndex)}return T.sort(((C,M)=>_[C]-_[M]||b[M]-b[C])),T}addToSortKeyRanges(s,l){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===l?p.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const p=this.symbolInstances.get(l);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(((_,b,T)=>{_>=0&&T.indexOf(_)===b&&this.addIndicesForPlacedSymbol(this.text,_)})),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let cw,uw;Ct("SymbolBucket",Uf,{omit:["layers","collisionBoxArray","features","compareText"]}),Uf.MAX_GLYPHS=65535,Uf.addDynamicAttributes=tv;var rv={get paint(){return uw=uw||new zi({"icon-opacity":new qt(Be.paint_symbol["icon-opacity"]),"icon-color":new qt(Be.paint_symbol["icon-color"]),"icon-halo-color":new qt(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new qt(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qt(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new qt(Be.paint_symbol["text-opacity"]),"text-color":new qt(Be.paint_symbol["text-color"],{runtimeType:tr,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new qt(Be.paint_symbol["text-halo-color"]),"text-halo-width":new qt(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new qt(Be.paint_symbol["text-halo-blur"]),"text-translate":new jt(Be.paint_symbol["text-translate"]),"text-translate-anchor":new jt(Be.paint_symbol["text-translate-anchor"])})},get layout(){return cw=cw||new zi({"symbol-placement":new jt(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qt(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jt(Be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new jt(Be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new jt(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new qt(Be.layout_symbol["icon-size"]),"icon-text-fit":new jt(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jt(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new qt(Be.layout_symbol["icon-image"]),"icon-rotate":new qt(Be.layout_symbol["icon-rotate"]),"icon-padding":new qt(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new qt(Be.layout_symbol["icon-offset"]),"icon-anchor":new qt(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(Be.layout_symbol["text-rotation-alignment"]),"text-field":new qt(Be.layout_symbol["text-field"]),"text-font":new qt(Be.layout_symbol["text-font"]),"text-size":new qt(Be.layout_symbol["text-size"]),"text-max-width":new qt(Be.layout_symbol["text-max-width"]),"text-line-height":new jt(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new qt(Be.layout_symbol["text-letter-spacing"]),"text-justify":new qt(Be.layout_symbol["text-justify"]),"text-radial-offset":new qt(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(Be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new qt(Be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new qt(Be.layout_symbol["text-anchor"]),"text-max-angle":new jt(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(Be.layout_symbol["text-writing-mode"]),"text-rotate":new qt(Be.layout_symbol["text-rotate"]),"text-padding":new jt(Be.layout_symbol["text-padding"]),"text-keep-upright":new jt(Be.layout_symbol["text-keep-upright"]),"text-transform":new qt(Be.layout_symbol["text-transform"]),"text-offset":new qt(Be.layout_symbol["text-offset"]),"text-allow-overlap":new jt(Be.layout_symbol["text-allow-overlap"]),"text-overlap":new jt(Be.layout_symbol["text-overlap"]),"text-ignore-placement":new jt(Be.layout_symbol["text-ignore-placement"]),"text-optional":new jt(Be.layout_symbol["text-optional"])})}};class hw{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:br,this.defaultValue=s}evaluate(s){if(s.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(s.formattedSection))return l.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ct("FormatSectionOverride",hw,{omit:["defaultValue"]});class Jg extends pr{constructor(s,l){super(s,rv,l)}recalculate(s,l){if(super.recalculate(s,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const b of p)_.indexOf(b)<0&&_.push(b);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,l,p,_){const b=this.layout.get(s).evaluate(l,{},p,_),T=this._unevaluatedLayout._values[s];return T.isDataDriven()||ma(T.value)||!b?b:(function(C,M){return M.replace(/{([^{}]+)}/g,((O,F)=>C&&F in C?String(C[F]):""))})(l.properties,b)}createBucket(s){return new Uf(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of rv.paint.overridableProperties){if(!Jg.hasPaintOverride(this.layout,s))continue;const l=this.paint.get(s),p=new hw(l),_=new ql(p,l.property.specification);let b=null;b=l.value.kind==="constant"||l.value.kind==="source"?new Xa("source",_):new qa("composite",_,l.value.zoomStops),this.paint._values[s]=new vs(l.property,b,l.parameters)}}_handleOverridablePaintPropertyUpdate(s,l,p){return!(!this.layout||l.isDataDriven()||p.isDataDriven())&&Jg.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,l){const p=s.get("text-field"),_=rv.paint.properties[l];let b=!1;const T=C=>{for(const M of C)if(_.overrides&&_.overrides.hasOverride(M))return void(b=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Mi)T(p.value.value.sections);else if(p.value.kind==="source"||p.value.kind==="composite"){const C=O=>{b||(O instanceof ps&&on(O.value)===Io?T(O.value.sections):O instanceof ja?T(O.sections):O.eachChild(C))},M=p.value;M._styleExpression&&C(M._styleExpression.expression)}return b}}let dw;var sI={get paint(){return dw=dw||new zi({"background-color":new jt(Be.paint_background["background-color"]),"background-pattern":new Qu(Be.paint_background["background-pattern"]),"background-opacity":new jt(Be.paint_background["background-opacity"])})}};class oI extends pr{constructor(s,l){super(s,sI,l)}}let fw;var aI={get paint(){return fw=fw||new zi({"raster-opacity":new jt(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new jt(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(Be.paint_raster["raster-saturation"]),"raster-contrast":new jt(Be.paint_raster["raster-contrast"]),"raster-resampling":new jt(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(Be.paint_raster["raster-fade-duration"])})}};class lI extends pr{constructor(s,l){super(s,aI,l)}}class cI extends pr{constructor(s,l){super(s,{},l),this.onAdd=p=>{this.implementation.onAdd&&this.implementation.onAdd(p,p.painter.context.gl)},this.onRemove=p=>{this.implementation.onRemove&&this.implementation.onRemove(p,p.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class uI{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const hI={once:!0},sv=63710088e-1;class uh{constructor(s,l){if(isNaN(s)||isNaN(l))throw new Error(`Invalid LngLat object: (${s}, ${l})`);if(this.lng=+s,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new uh(Qt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const l=Math.PI/180,p=this.lat*l,_=s.lat*l,b=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((s.lng-this.lng)*l);return sv*Math.acos(Math.min(b,1))}static convert(s){if(s instanceof uh)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new uh(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new uh(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const pw=2*Math.PI*sv;function mw(u){return pw*Math.cos(u*Math.PI/180)}function gw(u){return(180+u)/360}function _w(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function yw(u,s){return u/mw(s)}function ov(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function vw(u,s){return u*mw(ov(s))}class Sm{constructor(s,l,p=0){this.x=+s,this.y=+l,this.z=+p}static fromLngLat(s,l=0){const p=uh.convert(s);return new Sm(gw(p.lng),_w(p.lat),yw(l,p.lat))}toLngLat(){return new uh(360*this.x-180,ov(this.y))}toAltitude(){return vw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/pw*(s=ov(this.y),1/Math.cos(s*Math.PI/180));var s}}function xw(u,s,l){var p=2*Math.PI*6378137/256/Math.pow(2,l);return[u*p-2*Math.PI*6378137/2,s*p-2*Math.PI*6378137/2]}class av{constructor(s,l,p){if(!(function(_,b,T){return!(_<0||_>25||T<0||T>=Math.pow(2,_)||b<0||b>=Math.pow(2,_))})(s,l,p))throw new Error(`x=${l}, y=${p}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=l,this.y=p,this.key=jf(0,s,s,l,p)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,l,p){const _=(T=this.y,C=this.z,M=xw(256*(b=this.x),256*(T=Math.pow(2,C)-T-1),C),O=xw(256*(b+1),256*(T+1),C),M[0]+","+M[1]+","+O[0]+","+O[1]);var b,T,C,M,O;const F=(function(j,H,X){let G,te="";for(let oe=j;oe>0;oe--)G=1<<oe-1,te+=(H&G?1:0)+(X&G?2:0);return te})(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,_)}isChildOf(s){const l=this.z-s.z;return l>0&&s.x===this.x>>l&&s.y===this.y>>l}getTilePoint(s){const l=Math.pow(2,this.z);return new v((s.x*l-this.x)*Ue,(s.y*l-this.y)*Ue)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bw{constructor(s,l){this.wrap=s,this.canonical=l,this.key=jf(s,l.z,l.z,l.x,l.y)}}class Xo{constructor(s,l,p,_,b){if(this.terrainRttPosMatrix32f=null,s<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${p}`);this.overscaledZ=s,this.wrap=l,this.canonical=new av(p,+_,+b),this.key=jf(l,s,p,_,b)}clone(){return new Xo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-s;return s>this.canonical.z?new Xo(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xo(s,this.wrap,s,this.canonical.x>>l,this.canonical.y>>l)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(s,l){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-s;return s>this.canonical.z?jf(this.wrap*+l,s,this.canonical.z,this.canonical.x,this.canonical.y):jf(this.wrap*+l,s,s,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(s){if(s.wrap!==this.wrap||this.overscaledZ-s.overscaledZ<=0)return!1;if(s.overscaledZ===0)return this.overscaledZ>0;const l=this.canonical.z-s.canonical.z;return!(l<0)&&s.canonical.x===this.canonical.x>>l&&s.canonical.y===this.canonical.y>>l}children(s){if(this.overscaledZ>=s)return[new Xo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new Xo(l,this.wrap,l,p,_),new Xo(l,this.wrap,l,p+1,_),new Xo(l,this.wrap,l,p,_+1),new Xo(l,this.wrap,l,p+1,_+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Xo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Xo(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new Sm(s.x-this.wrap,s.y))}}function jf(u,s,l,p,_){(u*=2)<0&&(u=-1*u-1);const b=1<<l;return(b*b*u+b*_+p).toString(36)+l.toString(36)+s.toString(36)}function Am(u,s){return s?u.properties[s]:u.id}Ct("CanonicalTileID",av),Ct("OverscaledTileID",Xo,{omit:["terrainRttPosMatrix32f"]});class vd{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(s){return this.minX=Math.min(this.minX,s.x),this.minY=Math.min(this.minY,s.y),this.maxX=Math.max(this.maxX,s.x),this.maxY=Math.max(this.maxY,s.y),this}expandBy(s){return this.minX-=s,this.minY-=s,this.maxX+=s,this.maxY+=s,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(s){return this.expandBy(-s)}map(s){const l=new vd;return l.extend(s(new v(this.minX,this.minY))),l.extend(s(new v(this.maxX,this.minY))),l.extend(s(new v(this.minX,this.maxY))),l.extend(s(new v(this.maxX,this.maxY))),l}static fromPoints(s){const l=new vd;for(const p of s)l.extend(p);return l}contains(s){return s.x>=this.minX&&s.x<=this.maxX&&s.y>=this.minY&&s.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(s){return!this.empty()&&!s.empty()&&s.minX>=this.minX&&s.maxX<=this.maxX&&s.minY>=this.minY&&s.maxY<=this.maxY}intersects(s){return!this.empty()&&!s.empty()&&s.minX<=this.maxX&&s.maxX>=this.minX&&s.minY<=this.maxY&&s.maxY>=this.minY}}class ww{constructor(s){this._stringToNumber={},this._numberToString=[];for(let l=0;l<s.length;l++){const p=s[l];this._stringToNumber[p]=l,this._numberToString[l]=p}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class Tw{constructor(s,l,p,_,b){this.type="Feature",this._vectorTileFeature=s,s._z=l,s._x=p,s._y=_,this.properties=s.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(s[l]=this[l]);return s}}class Sw{constructor(s,l){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new bo(Ue,16,0),this.grid3D=new bo(Ue,16,0),this.featureIndexArray=new Ge,this.promoteId=l}insert(s,l,p,_,b,T){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,b);const M=T?this.grid3D:this.grid;for(let O=0;O<l.length;O++){const F=l[O],j=[1/0,1/0,-1/0,-1/0];for(let H=0;H<F.length;H++){const X=F[H];j[0]=Math.min(j[0],X.x),j[1]=Math.min(j[1],X.y),j[2]=Math.max(j[2],X.x),j[3]=Math.max(j[3],X.y)}j[0]<Ue&&j[1]<Ue&&j[2]>=0&&j[3]>=0&&M.insert(C,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new pm(new Lf(this.rawTileData)).layers,this.sourceLayerCoder=new ww(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,l,p,_){this.loadVTLayers();const b=s.params,T=Ue/s.tileSize/s.scale,C=yo(b.filter,b.globalState),M=s.queryGeometry,O=s.queryPadding*T,F=vd.fromPoints(M),j=this.grid.query(F.minX-O,F.minY-O,F.maxX+O,F.maxY+O),H=vd.fromPoints(s.cameraQueryGeometry).expandBy(O),X=this.grid3D.query(H.minX,H.minY,H.maxX,H.maxY,((oe,me,je,Te)=>(function(Ie,Je,st,ft,Ot){for(const Rt of Ie)if(Je<=Rt.x&&st<=Rt.y&&ft>=Rt.x&&Ot>=Rt.y)return!0;const St=[new v(Je,st),new v(Je,Ot),new v(ft,Ot),new v(ft,st)];if(Ie.length>2){for(const Rt of St)if(uc(Ie,Rt))return!0}for(let Rt=0;Rt<Ie.length-1;Rt++)if(Cg(Ie[Rt],Ie[Rt+1],St))return!0;return!1})(s.cameraQueryGeometry,oe-O,me-O,je+O,Te+O)));for(const oe of X)j.push(oe);j.sort(dI);const G={};let te;for(let oe=0;oe<j.length;oe++){const me=j[oe];if(me===te)continue;te=me;const je=this.featureIndexArray.get(me);let Te=null;this.loadMatchingFeature(G,je.bucketIndex,je.sourceLayerIndex,je.featureIndex,C,b.layers,b.availableImages,l,p,_,((Ie,Je,st)=>(Te||(Te=hu(Ie)),Je.queryIntersectsFeature({queryGeometry:M,feature:Ie,featureState:st,geometry:Te,zoom:this.z,transform:s.transform,pixelsToTileUnits:T,pixelPosMatrix:s.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:s.getElevation}))))}return G}loadMatchingFeature(s,l,p,_,b,T,C,M,O,F,j){const H=this.bucketLayerIDs[l];if(T&&!H.some((oe=>T.has(oe))))return;const X=this.sourceLayerCoder.decode(p),G=this.vtLayers[X].feature(_);if(b.needGeometry){const oe=or(G,!0);if(!b.filter(new Xn(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!b.filter(new Xn(this.tileID.overscaledZ),G))return;const te=this.getId(G,X);for(let oe=0;oe<H.length;oe++){const me=H[oe];if(T&&!T.has(me))continue;const je=M[me];if(!je)continue;let Te={};te&&F&&(Te=F.getState(je.sourceLayer||"_geojsonTileLayer",te));const Ie=Ut({},O[me]);Ie.paint=Aw(Ie.paint,je.paint,G,Te,C),Ie.layout=Aw(Ie.layout,je.layout,G,Te,C);const Je=!j||j(G,je,Te);if(!Je)continue;const st=new Tw(G,this.z,this.x,this.y,te);st.layer=Ie;let ft=s[me];ft===void 0&&(ft=s[me]=[]),ft.push({featureIndex:_,feature:st,intersectionZ:Je})}}lookupSymbolFeatures(s,l,p,_,b,T,C,M){const O={};this.loadVTLayers();const F=yo(b.filterSpec,b.globalState);for(const j of s)this.loadMatchingFeature(O,p,_,j,F,T,C,M,l);return O}hasLayer(s){for(const l of this.bucketLayerIDs)for(const p of l)if(s===p)return!0;return!1}getId(s,l){var p;let _=s.id;return this.promoteId&&(_=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof _=="boolean"&&(_=Number(_)),_===void 0&&(!((p=s.properties)===null||p===void 0)&&p.cluster)&&this.promoteId&&(_=Number(s.properties.cluster_id))),_}}function Aw(u,s,l,p,_){return _n(u,((b,T)=>{const C=s instanceof ol?s.get(T):null;return C&&C.evaluate?C.evaluate(l,p,_):C}))}function dI(u,s){return s-u}function Ew(u,s,l,p,_){const b=[];for(let T=0;T<u.length;T++){const C=u[T];let M;for(let O=0;O<C.length-1;O++){let F=C[O],j=C[O+1];F.x<s&&j.x<s||(F.x<s?F=new v(s,F.y+(s-F.x)/(j.x-F.x)*(j.y-F.y))._round():j.x<s&&(j=new v(s,F.y+(s-F.x)/(j.x-F.x)*(j.y-F.y))._round()),F.y<l&&j.y<l||(F.y<l?F=new v(F.x+(l-F.y)/(j.y-F.y)*(j.x-F.x),l)._round():j.y<l&&(j=new v(F.x+(l-F.y)/(j.y-F.y)*(j.x-F.x),l)._round()),F.x>=p&&j.x>=p||(F.x>=p?F=new v(p,F.y+(p-F.x)/(j.x-F.x)*(j.y-F.y))._round():j.x>=p&&(j=new v(p,F.y+(p-F.x)/(j.x-F.x)*(j.y-F.y))._round()),F.y>=_&&j.y>=_||(F.y>=_?F=new v(F.x+(_-F.y)/(j.y-F.y)*(j.x-F.x),_)._round():j.y>=_&&(j=new v(F.x+(_-F.y)/(j.y-F.y)*(j.x-F.x),_)._round()),M&&F.equals(M[M.length-1])||(M=[F],b.push(M)),M.push(j)))))}}return b}Ct("FeatureIndex",Sw,{omit:["rawTileData","sourceLayerCoder"]});class hh extends v{constructor(s,l,p,_){super(s,l),this.angle=p,_!==void 0&&(this.segment=_)}clone(){return new hh(this.x,this.y,this.angle,this.segment)}}function Pw(u,s,l,p,_){if(s.segment===void 0||l===0)return!0;let b=s,T=s.segment+1,C=0;for(;C>-l/2;){if(T--,T<0)return!1;C-=u[T].dist(b),b=u[T]}C+=u[T].dist(u[T+1]),T++;const M=[];let O=0;for(;C<l/2;){const F=u[T],j=u[T+1];if(!j)return!1;let H=u[T-1].angleTo(F)-F.angleTo(j);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:C,angleDelta:H}),O+=H;C-M[0].distance>p;)O-=M.shift().angleDelta;if(O>_)return!1;T++,C+=F.dist(j)}return!0}function Cw(u){let s=0;for(let l=0;l<u.length-1;l++)s+=u[l].dist(u[l+1]);return s}function Iw(u,s,l){return u?.6*s*l:0}function Mw(u,s){return Math.max(u?u.right-u.left:0,s?s.right-s.left:0)}function fI(u,s,l,p,_,b){const T=Iw(l,_,b),C=Mw(l,p)*b;let M=0;const O=Cw(u)/2;for(let F=0;F<u.length-1;F++){const j=u[F],H=u[F+1],X=j.dist(H);if(M+X>O){const G=(O-M)/X,te=Ks.number(j.x,H.x,G),oe=Ks.number(j.y,H.y,G),me=new hh(te,oe,H.angleTo(j),F);return me._round(),!T||Pw(u,me,C,T,s)?me:void 0}M+=X}}function pI(u,s,l,p,_,b,T,C,M){const O=Iw(p,b,T),F=Mw(p,_),j=F*T,H=u[0].x===0||u[0].x===M||u[0].y===0||u[0].y===M;return s-j<s/4&&(s=j+s/4),Rw(u,H?s/2*C%s:(F/2+2*b)*T*C%s,s,O,l,j,H,!1,M)}function Rw(u,s,l,p,_,b,T,C,M){const O=b/2,F=Cw(u);let j=0,H=s-l,X=[];for(let G=0;G<u.length-1;G++){const te=u[G],oe=u[G+1],me=te.dist(oe),je=oe.angleTo(te);for(;H+l<j+me;){H+=l;const Te=(H-j)/me,Ie=Ks.number(te.x,oe.x,Te),Je=Ks.number(te.y,oe.y,Te);if(Ie>=0&&Ie<M&&Je>=0&&Je<M&&H-O>=0&&H+O<=F){const st=new hh(Ie,Je,je,G);st._round(),p&&!Pw(u,st,b,p,_)||X.push(st)}}j+=me}return C||X.length||T||(X=Rw(u,j/2,l,p,_,b,T,!0,M)),X}function kw(u,s,l,p){const _=[],b=u.image,T=b.pixelRatio,C=b.paddedRect.w-2,M=b.paddedRect.h-2;let O={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const F=b.stretchX||[[0,C]],j=b.stretchY||[[0,M]],H=(ct,ln)=>ct+ln[1]-ln[0],X=F.reduce(H,0),G=j.reduce(H,0),te=C-X,oe=M-G;let me=0,je=X,Te=0,Ie=G,Je=0,st=te,ft=0,Ot=oe;if(b.content&&p){const ct=b.content,ln=ct[2]-ct[0],gn=ct[3]-ct[1];(b.textFitWidth||b.textFitHeight)&&(O=en(u)),me=Qg(F,0,ct[0]),Te=Qg(j,0,ct[1]),je=Qg(F,ct[0],ct[2]),Ie=Qg(j,ct[1],ct[3]),Je=ct[0]-me,ft=ct[1]-Te,st=ln-je,Ot=gn-Ie}const St=O.x1,Rt=O.y1,Gt=O.x2-St,Mt=O.y2-Rt,kt=(ct,ln,gn,tn)=>{const Zt=e_(ct.stretch-me,je,Gt,St),Bn=t_(ct.fixed-Je,st,ct.stretch,X),Vi=e_(ln.stretch-Te,Ie,Mt,Rt),_r=t_(ln.fixed-ft,Ot,ln.stretch,G),cs=e_(gn.stretch-me,je,Gt,St),qo=t_(gn.fixed-Je,st,gn.stretch,X),ao=e_(tn.stretch-Te,Ie,Mt,Rt),Hr=t_(tn.fixed-ft,Ot,tn.stretch,G),Oi=new v(Zt,Vi),Cr=new v(cs,Vi),Zr=new v(cs,ao),Xr=new v(Zt,ao),Us=new v(Bn/T,_r/T),Go=new v(qo/T,Hr/T),Ir=s*Math.PI/180;if(Ir){const Mr=Math.sin(Ir),Rr=Math.cos(Ir),lr=[Rr,-Mr,Mr,Rr];Oi._matMult(lr),Cr._matMult(lr),Xr._matMult(lr),Zr._matMult(lr)}const lo=ct.stretch+ct.fixed,yr=ln.stretch+ln.fixed;return{tl:Oi,tr:Cr,bl:Xr,br:Zr,tex:{x:b.paddedRect.x+1+lo,y:b.paddedRect.y+1+yr,w:gn.stretch+gn.fixed-lo,h:tn.stretch+tn.fixed-yr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Us,pixelOffsetBR:Go,minFontScaleX:st/T/Gt,minFontScaleY:Ot/T/Mt,isSDF:l}};if(p&&(b.stretchX||b.stretchY)){const ct=Dw(F,te,X),ln=Dw(j,oe,G);for(let gn=0;gn<ct.length-1;gn++){const tn=ct[gn],Zt=ct[gn+1];for(let Bn=0;Bn<ln.length-1;Bn++)_.push(kt(tn,ln[Bn],Zt,ln[Bn+1]))}}else _.push(kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:M+1}));return _}function Qg(u,s,l){let p=0;for(const _ of u)p+=Math.max(s,Math.min(l,_[1]))-Math.max(s,Math.min(l,_[0]));return p}function Dw(u,s,l){const p=[{fixed:-1,stretch:0}];for(const[_,b]of u){const T=p[p.length-1];p.push({fixed:_-T.stretch,stretch:T.stretch}),p.push({fixed:_-T.stretch,stretch:T.stretch+(b-_)})}return p.push({fixed:s+1,stretch:l}),p}function e_(u,s,l,p){return u/s*l+p}function t_(u,s,l,p){return u-s*l/p}Ct("Anchor",hh);class n_{constructor(s,l,p,_,b,T,C,M,O,F){var j;if(this.boxStartIndex=s.length,O){let H=T.top,X=T.bottom;const G=T.collisionPadding;G&&(H-=G[1],X+=G[3]);let te=X-H;te>0&&(te=Math.max(10,te),this.circleDiameter=te)}else{const H=!((j=T.image)===null||j===void 0)&&j.content&&(T.image.textFitWidth||T.image.textFitHeight)?en(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};H.y1=H.y1*C-M[0],H.y2=H.y2*C+M[2],H.x1=H.x1*C-M[3],H.x2=H.x2*C+M[1];const X=T.collisionPadding;if(X&&(H.x1-=X[0]*C,H.y1-=X[1]*C,H.x2+=X[2]*C,H.y2+=X[3]*C),F){const G=new v(H.x1,H.y1),te=new v(H.x2,H.y1),oe=new v(H.x1,H.y2),me=new v(H.x2,H.y2),je=F*Math.PI/180;G._rotate(je),te._rotate(je),oe._rotate(je),me._rotate(je),H.x1=Math.min(G.x,te.x,oe.x,me.x),H.x2=Math.max(G.x,te.x,oe.x,me.x),H.y1=Math.min(G.y,te.y,oe.y,me.y),H.y2=Math.max(G.y,te.y,oe.y,me.y)}s.emplaceBack(l.x,l.y,H.x1,H.y1,H.x2,H.y2,p,_,b)}this.boxEndIndex=s.length}}class mI{constructor(s=[],l=(p,_)=>p<_?-1:p>_?1:0){if(this.data=s,this.length=this.data.length,this.compare=l,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:l,compare:p}=this,_=l[s];for(;s>0;){const b=s-1>>1,T=l[b];if(p(_,T)>=0)break;l[s]=T,s=b}l[s]=_}_down(s){const{data:l,compare:p}=this,_=this.length>>1,b=l[s];for(;s<_;){let T=1+(s<<1);const C=T+1;if(C<this.length&&p(l[C],l[T])<0&&(T=C),p(l[T],b)>=0)break;l[s]=l[T],s=T}l[s]=b}}function gI(u,s=1,l=!1){const p=vd.fromPoints(u[0]),_=Math.min(p.width(),p.height());let b=_/2;const T=new mI([],_I),{minX:C,minY:M,maxX:O,maxY:F}=p;if(_===0)return new v(C,M);for(let X=C;X<O;X+=_)for(let G=M;G<F;G+=_)T.push(new Vf(X+b,G+b,b,u));let j=(function(X){let G=0,te=0,oe=0;const me=X[0];for(let je=0,Te=me.length,Ie=Te-1;je<Te;Ie=je++){const Je=me[je],st=me[Ie],ft=Je.x*st.y-st.x*Je.y;te+=(Je.x+st.x)*ft,oe+=(Je.y+st.y)*ft,G+=3*ft}return new Vf(te/G,oe/G,0,X)})(u),H=T.length;for(;T.length;){const X=T.pop();(X.d>j.d||!j.d)&&(j=X,l&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,H)),X.max-j.d<=s||(b=X.h/2,T.push(new Vf(X.p.x-b,X.p.y-b,b,u)),T.push(new Vf(X.p.x+b,X.p.y-b,b,u)),T.push(new Vf(X.p.x-b,X.p.y+b,b,u)),T.push(new Vf(X.p.x+b,X.p.y+b,b,u)),H+=4)}return l&&(console.log(`num probes: ${H}`),console.log(`best distance: ${j.d}`)),j.p}function _I(u,s){return s.max-u.max}function Vf(u,s,l,p){this.p=new v(u,s),this.h=l,this.d=(function(_,b){let T=!1,C=1/0;for(let M=0;M<b.length;M++){const O=b[M];for(let F=0,j=O.length,H=j-1;F<j;H=F++){const X=O[F],G=O[H];X.y>_.y!=G.y>_.y&&_.x<(G.x-X.x)*(_.y-X.y)/(G.y-X.y)+X.x&&(T=!T),C=Math.min(C,im(_,X,G))}}return(T?1:-1)*Math.sqrt(C)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}var ls;d.aE=void 0,(ls=d.aE||(d.aE={}))[ls.center=1]="center",ls[ls.left=2]="left",ls[ls.right=3]="right",ls[ls.top=4]="top",ls[ls.bottom=5]="bottom",ls[ls["top-left"]=6]="top-left",ls[ls["top-right"]=7]="top-right",ls[ls["bottom-left"]=8]="bottom-left",ls[ls["bottom-right"]=9]="bottom-right";const lv=Number.POSITIVE_INFINITY;function Ow(u,s){return s[1]!==lv?(function(l,p,_){let b=0,T=0;switch(p=Math.abs(p),_=Math.abs(_),l){case"top-right":case"top-left":case"top":T=_-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-_}switch(l){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,T]})(u,s[0],s[1]):(function(l,p){let _=0,b=0;p<0&&(p=0);const T=p/Math.SQRT2;switch(l){case"top-right":case"top-left":b=T-7;break;case"bottom-right":case"bottom-left":b=7-T;break;case"bottom":b=7-p;break;case"top":b=p-7}switch(l){case"top-right":case"bottom-right":_=-T;break;case"top-left":case"bottom-left":_=T;break;case"left":_=p;break;case"right":_=-p}return[_,b]})(u,s[0])}function Lw(u,s,l){var p;const _=u.layout,b=(p=_.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(s,{},l);if(b){const C=b.values,M=[];for(let O=0;O<C.length;O+=2){const F=M[O]=C[O],j=C[O+1].map((H=>H*ar));F.startsWith("top")?j[1]-=7:F.startsWith("bottom")&&(j[1]+=7),M[O+1]=j}return new Ki(M)}const T=_.get("text-variable-anchor");if(T){let C;C=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(s,{},l)*ar,lv]:_.get("text-offset").evaluate(s,{},l).map((O=>O*ar));const M=[];for(const O of T)M.push(O,Ow(O,C));return new Ki(M)}return null}function cv(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yI(u,s,l,p,_,b,T,C,M,O,F,j){let H=b.textMaxSize.evaluate(s,{});H===void 0&&(H=T);const X=u.layers[0].layout,G=X.get("icon-offset").evaluate(s,{},F),te=Nw(l.horizontal),oe=T/24,me=u.tilePixelRatio*oe,je=u.tilePixelRatio*H/24,Te=u.tilePixelRatio*C,Ie=u.tilePixelRatio*X.get("symbol-spacing"),Je=X.get("text-padding")*u.tilePixelRatio,st=(function(gn,tn,Zt,Bn=1){const Vi=gn.get("icon-padding").evaluate(tn,{},Zt),_r=Vi&&Vi.values;return[_r[0]*Bn,_r[1]*Bn,_r[2]*Bn,_r[3]*Bn]})(X,s,F,u.tilePixelRatio),ft=X.get("text-max-angle")/180*Math.PI,Ot=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",St=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",Rt=X.get("symbol-placement"),Gt=Ie/2,Mt=X.get("icon-text-fit");let kt;p&&Mt!=="none"&&(u.allowVerticalPlacement&&l.vertical&&(kt=dn(p,l.vertical,Mt,X.get("icon-text-fit-padding"),G,oe)),te&&(p=dn(p,te,Mt,X.get("icon-text-fit-padding"),G,oe)));const ct=F?j.line.getGranularityForZoomLevel(F.z):1,ln=(gn,tn)=>{tn.x<0||tn.x>=Ue||tn.y<0||tn.y>=Ue||(function(Zt,Bn,Vi,_r,cs,qo,ao,Hr,Oi,Cr,Zr,Xr,Us,Go,Ir,lo,yr,Mr,Rr,lr,wi,yl,$f,vl,bI){const Wf=Zt.addToLineVertexArray(Bn,Vi);let xd,Hf,Zf,Xf,jw=0,Vw=0,$w=0,Ww=0,_v=-1,yv=-1;const bu={};let Hw=jo("");if(Zt.allowVerticalPlacement&&_r.vertical){const Ts=Hr.layout.get("text-rotate").evaluate(wi,{},vl)+90;Zf=new n_(Oi,Bn,Cr,Zr,Xr,_r.vertical,Us,Go,Ir,Ts),ao&&(Xf=new n_(Oi,Bn,Cr,Zr,Xr,ao,yr,Mr,Ir,Ts))}if(cs){const Ts=Hr.layout.get("icon-rotate").evaluate(wi,{}),Yo=Hr.layout.get("icon-text-fit")!=="none",bd=kw(cs,Ts,$f,Yo),bl=ao?kw(ao,Ts,$f,Yo):void 0;Hf=new n_(Oi,Bn,Cr,Zr,Xr,cs,yr,Mr,!1,Ts),jw=4*bd.length;const wd=Zt.iconSizeData;let vc=null;wd.kind==="source"?(vc=[nn*Hr.layout.get("icon-size").evaluate(wi,{})],vc[0]>cn&&ri(`${Zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):wd.kind==="composite"&&(vc=[nn*yl.compositeIconSizes[0].evaluate(wi,{},vl),nn*yl.compositeIconSizes[1].evaluate(wi,{},vl)],(vc[0]>cn||vc[1]>cn)&&ri(`${Zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Zt.addSymbols(Zt.icon,bd,vc,lr,Rr,wi,d.ao.none,Bn,Wf.lineStartIndex,Wf.lineLength,-1,vl),_v=Zt.icon.placedSymbolArray.length-1,bl&&(Vw=4*bl.length,Zt.addSymbols(Zt.icon,bl,vc,lr,Rr,wi,d.ao.vertical,Bn,Wf.lineStartIndex,Wf.lineLength,-1,vl),yv=Zt.icon.placedSymbolArray.length-1)}const Zw=Object.keys(_r.horizontal);for(const Ts of Zw){const Yo=_r.horizontal[Ts];if(!xd){Hw=jo(Yo.text);const bl=Hr.layout.get("text-rotate").evaluate(wi,{},vl);xd=new n_(Oi,Bn,Cr,Zr,Xr,Yo,Us,Go,Ir,bl)}const bd=Yo.positionedLines.length===1;if($w+=Fw(Zt,Bn,Yo,qo,Hr,Ir,wi,lo,Wf,_r.vertical?d.ao.horizontal:d.ao.horizontalOnly,bd?Zw:[Ts],bu,_v,yl,vl),bd)break}_r.vertical&&(Ww+=Fw(Zt,Bn,_r.vertical,qo,Hr,Ir,wi,lo,Wf,d.ao.vertical,["vertical"],bu,yv,yl,vl));const wI=xd?xd.boxStartIndex:Zt.collisionBoxArray.length,TI=xd?xd.boxEndIndex:Zt.collisionBoxArray.length,SI=Zf?Zf.boxStartIndex:Zt.collisionBoxArray.length,AI=Zf?Zf.boxEndIndex:Zt.collisionBoxArray.length,EI=Hf?Hf.boxStartIndex:Zt.collisionBoxArray.length,PI=Hf?Hf.boxEndIndex:Zt.collisionBoxArray.length,CI=Xf?Xf.boxStartIndex:Zt.collisionBoxArray.length,II=Xf?Xf.boxEndIndex:Zt.collisionBoxArray.length;let xl=-1;const r_=(Ts,Yo)=>Ts&&Ts.circleDiameter?Math.max(Ts.circleDiameter,Yo):Yo;xl=r_(xd,xl),xl=r_(Zf,xl),xl=r_(Hf,xl),xl=r_(Xf,xl);const Xw=xl>-1?1:0;Xw&&(xl*=bI/ar),Zt.glyphOffsetArray.length>=Uf.MAX_GLYPHS&&ri("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wi.sortKey!==void 0&&Zt.addToSortKeyRanges(Zt.symbolInstances.length,wi.sortKey);const MI=Lw(Hr,wi,vl),[RI,kI]=(function(Ts,Yo){const bd=Ts.length,bl=Yo?.values;if(bl?.length>0)for(let wd=0;wd<bl.length;wd+=2){const vc=bl[wd+1];Ts.emplaceBack(d.aE[bl[wd]],vc[0],vc[1])}return[bd,Ts.length]})(Zt.textAnchorOffsets,MI);Zt.symbolInstances.emplaceBack(Bn.x,Bn.y,bu.right>=0?bu.right:-1,bu.center>=0?bu.center:-1,bu.left>=0?bu.left:-1,bu.vertical||-1,_v,yv,Hw,wI,TI,SI,AI,EI,PI,CI,II,Cr,$w,Ww,jw,Vw,Xw,0,Us,xl,RI,kI)})(u,tn,gn,l,p,_,kt,u.layers[0],u.collisionBoxArray,s.index,s.sourceLayerIndex,u.index,me,[Je,Je,Je,Je],Ot,M,Te,st,St,G,s,b,O,F,T)};if(Rt==="line")for(const gn of Ew(s.geometry,0,0,Ue,Ue)){const tn=Bs(gn,ct),Zt=pI(tn,Ie,ft,l.vertical||te,p,24,je,u.overscaling,Ue);for(const Bn of Zt)te&&vI(u,te.text,Gt,Bn)||ln(tn,Bn)}else if(Rt==="line-center"){for(const gn of s.geometry)if(gn.length>1){const tn=Bs(gn,ct),Zt=fI(tn,ft,l.vertical||te,p,24,je);Zt&&ln(tn,Zt)}}else if(s.type==="Polygon")for(const gn of jl(s.geometry,0)){const tn=gI(gn,16);ln(Bs(gn[0],ct,!0),new hh(tn.x,tn.y,0))}else if(s.type==="LineString")for(const gn of s.geometry){const tn=Bs(gn,ct);ln(tn,new hh(tn[0].x,tn[0].y,0))}else if(s.type==="Point")for(const gn of s.geometry)for(const tn of gn)ln([tn],new hh(tn.x,tn.y,0))}function Fw(u,s,l,p,_,b,T,C,M,O,F,j,H,X,G){const te=(function(je,Te,Ie,Je,st,ft,Ot,St){const Rt=Je.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,Gt=[];for(const Mt of Te.positionedLines)for(const kt of Mt.positionedGlyphs){if(!kt.rect)continue;const ct=kt.rect||{};let ln=4,gn=!0,tn=1,Zt=0;const Bn=(st||St)&&kt.vertical,Vi=kt.metrics.advance*kt.scale/2;if(St&&Te.verticalizable&&(Zt=Mt.lineOffset/2-(kt.imageName?-(ar-kt.metrics.width*kt.scale)/2:(kt.scale-1)*ar)),kt.imageName){const Mr=Ot[kt.imageName];gn=Mr.sdf,tn=Mr.pixelRatio,ln=1/tn}const _r=st?[kt.x+Vi,kt.y]:[0,0];let cs=st?[0,0]:[kt.x+Vi+Ie[0],kt.y+Ie[1]-Zt],qo=[0,0];Bn&&(qo=cs,cs=[0,0]);const ao=kt.metrics.isDoubleResolution?2:1,Hr=(kt.metrics.left-ln)*kt.scale-Vi+cs[0],Oi=(-kt.metrics.top-ln)*kt.scale+cs[1],Cr=Hr+ct.w/ao*kt.scale/tn,Zr=Oi+ct.h/ao*kt.scale/tn,Xr=new v(Hr,Oi),Us=new v(Cr,Oi),Go=new v(Hr,Zr),Ir=new v(Cr,Zr);if(Bn){const Mr=new v(-Vi,Vi- -17),Rr=-Math.PI/2,lr=12-Vi,wi=new v(22-lr,-(kt.imageName?lr:0)),yl=new v(...qo);Xr._rotateAround(Rr,Mr)._add(wi)._add(yl),Us._rotateAround(Rr,Mr)._add(wi)._add(yl),Go._rotateAround(Rr,Mr)._add(wi)._add(yl),Ir._rotateAround(Rr,Mr)._add(wi)._add(yl)}if(Rt){const Mr=Math.sin(Rt),Rr=Math.cos(Rt),lr=[Rr,-Mr,Mr,Rr];Xr._matMult(lr),Us._matMult(lr),Go._matMult(lr),Ir._matMult(lr)}const lo=new v(0,0),yr=new v(0,0);Gt.push({tl:Xr,tr:Us,bl:Go,br:Ir,tex:ct,writingMode:Te.writingMode,glyphOffset:_r,sectionIndex:kt.sectionIndex,isSDF:gn,pixelOffsetTL:lo,pixelOffsetBR:yr,minFontScaleX:0,minFontScaleY:0})}return Gt})(0,l,C,_,b,T,p,u.allowVerticalPlacement),oe=u.textSizeData;let me=null;oe.kind==="source"?(me=[nn*_.layout.get("text-size").evaluate(T,{})],me[0]>cn&&ri(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(me=[nn*X.compositeTextSizes[0].evaluate(T,{},G),nn*X.compositeTextSizes[1].evaluate(T,{},G)],(me[0]>cn||me[1]>cn)&&ri(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),u.addSymbols(u.text,te,me,C,b,T,O,s,M.lineStartIndex,M.lineLength,H,G);for(const je of F)j[je]=u.text.placedSymbolArray.length-1;return 4*te.length}function Nw(u){for(const s in u)return u[s];return null}function vI(u,s,l,p){const _=u.compareText;if(s in _){const b=_[s];for(let T=b.length-1;T>=0;T--)if(p.dist(b[T])<l)return!0}else _[s]=[];return _[s].push(p),!1}const Bw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uv{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,p]=new Uint8Array(s,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const b=Bw[15&p];if(!b)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(s,2,1),[C]=new Uint32Array(s,4,1);return new uv(C,T,b,s)}constructor(s,l=64,p=Float64Array,_){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=p,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const b=Bw.indexOf(this.ArrayType),T=2*s*this.ArrayType.BYTES_PER_ELEMENT,C=s*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-C%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+C+M,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+T+C+M),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+C+M,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=s)}add(s,l){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=s,this.coords[this._pos++]=l,p}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return hv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,l,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:T,nodeSize:C}=this,M=[0,b.length-1,0],O=[];for(;M.length;){const F=M.pop()||0,j=M.pop()||0,H=M.pop()||0;if(j-H<=C){for(let oe=H;oe<=j;oe++){const me=T[2*oe],je=T[2*oe+1];me>=s&&me<=p&&je>=l&&je<=_&&O.push(b[oe])}continue}const X=H+j>>1,G=T[2*X],te=T[2*X+1];G>=s&&G<=p&&te>=l&&te<=_&&O.push(b[X]),(F===0?s<=G:l<=te)&&(M.push(H),M.push(X-1),M.push(1-F)),(F===0?p>=G:_>=te)&&(M.push(X+1),M.push(j),M.push(1-F))}return O}within(s,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:T}=this,C=[0,_.length-1,0],M=[],O=p*p;for(;C.length;){const F=C.pop()||0,j=C.pop()||0,H=C.pop()||0;if(j-H<=T){for(let oe=H;oe<=j;oe++)Uw(b[2*oe],b[2*oe+1],s,l)<=O&&M.push(_[oe]);continue}const X=H+j>>1,G=b[2*X],te=b[2*X+1];Uw(G,te,s,l)<=O&&M.push(_[X]),(F===0?s-p<=G:l-p<=te)&&(C.push(H),C.push(X-1),C.push(1-F)),(F===0?s+p>=G:l+p>=te)&&(C.push(X+1),C.push(j),C.push(1-F))}return M}}function hv(u,s,l,p,_,b){if(_-p<=l)return;const T=p+_>>1;zw(u,s,T,p,_,b),hv(u,s,l,p,T-1,1-b),hv(u,s,l,T+1,_,1-b)}function zw(u,s,l,p,_,b){for(;_>p;){if(_-p>600){const O=_-p+1,F=l-p+1,j=Math.log(O),H=.5*Math.exp(2*j/3),X=.5*Math.sqrt(j*H*(O-H)/O)*(F-O/2<0?-1:1);zw(u,s,l,Math.max(p,Math.floor(l-F*H/O+X)),Math.min(_,Math.floor(l+(O-F)*H/O+X)),b)}const T=s[2*l+b];let C=p,M=_;for(Em(u,s,p,l),s[2*_+b]>T&&Em(u,s,p,_);C<M;){for(Em(u,s,C,M),C++,M--;s[2*C+b]<T;)C++;for(;s[2*M+b]>T;)M--}s[2*p+b]===T?Em(u,s,p,M):(M++,Em(u,s,M,_)),M<=l&&(p=M+1),l<=M&&(_=M-1)}}function Em(u,s,l,p){dv(u,l,p),dv(s,2*l,2*p),dv(s,2*l+1,2*p+1)}function dv(u,s,l){const p=u[s];u[s]=u[l],u[l]=p}function Uw(u,s,l,p){const _=u-l,b=s-p;return _*_+b*b}var fv;d.cx=void 0,(fv=d.cx||(d.cx={})).create="create",fv.load="load",fv.fullLoad="fullLoad";let i_=null,Pm=[];const pv=1e3/60,mv="loadTime",gv="fullLoadTime",xI={mark(u){performance.mark(u)},frame(u){const s=u;i_!=null&&Pm.push(s-i_),i_=s},clearMetrics(){i_=null,Pm=[],performance.clearMeasures(mv),performance.clearMeasures(gv);for(const u in d.cx)performance.clearMarks(d.cx[u])},getPerformanceMetrics(){performance.measure(mv,d.cx.create,d.cx.load),performance.measure(gv,d.cx.create,d.cx.fullLoad);const u=performance.getEntriesByName(mv)[0].duration,s=performance.getEntriesByName(gv)[0].duration,l=Pm.length,p=1/(Pm.reduce(((b,T)=>b+T),0)/l/1e3),_=Pm.filter((b=>b>pv)).reduce(((b,T)=>b+(T-pv)/pv),0);return{loadTime:u,fullLoadTime:s,fps:p,percentDroppedFrames:_/(l+_)*100,totalFrames:l}}};d.$=Ue,d.A=se,d.B=function([u,s,l]){return s+=90,s*=Math.PI/180,l*=Math.PI/180,{x:u*Math.cos(s)*Math.sin(l),y:u*Math.sin(s)*Math.sin(l),z:u*Math.cos(l)}},d.C=Ks,d.D=jt,d.E=zt,d.F=Xn,d.G=Gp,d.H=function(u){if(Yt==null){const s=u.navigator?u.navigator.userAgent:null;Yt=!!u.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Yt},d.I=Tm,d.J=class{constructor(u,s){this.target=u,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new uI((()=>this.process())),this.subscription=Es(this.target,"message",(l=>this.receive(l)),!1),this.globalScope=Pt(self)?u:window}registerMessageHandler(u,s){this.messageHandlers[u]=s}sendAsync(u,s){return new Promise(((l,p)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10),b=s?Es(s.signal,"abort",(()=>{b?.unsubscribe(),delete this.resolveRejects[_];const M={id:_,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)}),hI):null;this.resolveRejects[_]={resolve:M=>{b?.unsubscribe(),l(M)},reject:M=>{b?.unsubscribe(),p(M)}};const T=[],C=Object.assign(Object.assign({},u),{id:_,sourceMapId:this.mapId,origin:location.origin,data:zr(u.data,T)});this.target.postMessage(C,{transfer:T})}))}receive(u){const s=u.data,l=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!=="resource://android"&&location.origin!=="resource://android"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[l];const p=this.abortControllers[l];return delete this.abortControllers[l],void(p&&p.abort())}if(Pt(self)||s.mustQueue)return this.tasks[l]=s,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,s)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),s=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(u,s)}processTask(u,s){return a(this,void 0,void 0,(function*(){if(s.type==="<response>"){const _=this.resolveRejects[u];return delete this.resolveRejects[u],_?void(s.error?_.reject(Ds(s.error)):_.resolve(Ds(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=Ds(s.data),p=new AbortController;this.abortControllers[u]=p;try{const _=yield this.messageHandlers[s.type](s.sourceMapId,l,p);this.completeTask(u,null,_)}catch(_){this.completeTask(u,_)}}))}completeTask(u,s,l){const p=[];delete this.abortControllers[u];const _={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?zr(s):null,data:zr(l,p)};this.target.postMessage(_,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.K=ie,d.L=function(){var u=new se(16);return se!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},d.M=function(u,s,l){var p,_,b,T,C,M,O,F,j,H,X,G,te=l[0],oe=l[1],me=l[2];return s===u?(u[12]=s[0]*te+s[4]*oe+s[8]*me+s[12],u[13]=s[1]*te+s[5]*oe+s[9]*me+s[13],u[14]=s[2]*te+s[6]*oe+s[10]*me+s[14],u[15]=s[3]*te+s[7]*oe+s[11]*me+s[15]):(_=s[1],b=s[2],T=s[3],C=s[4],M=s[5],O=s[6],F=s[7],j=s[8],H=s[9],X=s[10],G=s[11],u[0]=p=s[0],u[1]=_,u[2]=b,u[3]=T,u[4]=C,u[5]=M,u[6]=O,u[7]=F,u[8]=j,u[9]=H,u[10]=X,u[11]=G,u[12]=p*te+C*oe+j*me+s[12],u[13]=_*te+M*oe+H*me+s[13],u[14]=b*te+O*oe+X*me+s[14],u[15]=T*te+F*oe+G*me+s[15]),u},d.N=function(u,s,l){var p=l[0],_=l[1],b=l[2];return u[0]=s[0]*p,u[1]=s[1]*p,u[2]=s[2]*p,u[3]=s[3]*p,u[4]=s[4]*_,u[5]=s[5]*_,u[6]=s[6]*_,u[7]=s[7]*_,u[8]=s[8]*b,u[9]=s[9]*b,u[10]=s[10]*b,u[11]=s[11]*b,u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},d.O=function(u,s,l){var p=s[0],_=s[1],b=s[2],T=s[3],C=s[4],M=s[5],O=s[6],F=s[7],j=s[8],H=s[9],X=s[10],G=s[11],te=s[12],oe=s[13],me=s[14],je=s[15],Te=l[0],Ie=l[1],Je=l[2],st=l[3];return u[0]=Te*p+Ie*C+Je*j+st*te,u[1]=Te*_+Ie*M+Je*H+st*oe,u[2]=Te*b+Ie*O+Je*X+st*me,u[3]=Te*T+Ie*F+Je*G+st*je,u[4]=(Te=l[4])*p+(Ie=l[5])*C+(Je=l[6])*j+(st=l[7])*te,u[5]=Te*_+Ie*M+Je*H+st*oe,u[6]=Te*b+Ie*O+Je*X+st*me,u[7]=Te*T+Ie*F+Je*G+st*je,u[8]=(Te=l[8])*p+(Ie=l[9])*C+(Je=l[10])*j+(st=l[11])*te,u[9]=Te*_+Ie*M+Je*H+st*oe,u[10]=Te*b+Ie*O+Je*X+st*me,u[11]=Te*T+Ie*F+Je*G+st*je,u[12]=(Te=l[12])*p+(Ie=l[13])*C+(Je=l[14])*j+(st=l[15])*te,u[13]=Te*_+Ie*M+Je*H+st*oe,u[14]=Te*b+Ie*O+Je*X+st*me,u[15]=Te*T+Ie*F+Je*G+st*je,u},d.P=v,d.Q=function(u,s){const l={};for(let p=0;p<s.length;p++){const _=s[p];_ in u&&(l[_]=u[_])}return l},d.R=Nt,d.S=uh,d.T=bf,d.U=_w,d.V=gw,d.W=ne,d.X=ue,d.Y=Yn,d.Z=Xo,d._=a,d.a=K,d.a$=sn,d.a0=function(u,s){var l,p,_,b,T;if(!u)return s??{};if(!s)return u;let C=Object.assign({},u);if(s.removeAll&&(C={removeAll:!0}),s.remove){const M=new Set(s.remove);C.add&&(C.add=C.add.filter((F=>!M.has(F.id)))),C.update&&(C.update=C.update.filter((F=>!M.has(F.id))));const O=new Set(((l=u.add)!==null&&l!==void 0?l:[]).map((F=>F.id)));s.remove=s.remove.filter((F=>!O.has(F)))}if(s.remove){const M=new Set(C.remove?C.remove.concat(s.remove):s.remove);C.remove=Array.from(M.values())}if(s.add){const M=C.add?C.add.concat(s.add):s.add,O=new Map(M.map((F=>[F.id,F])));C.add=Array.from(O.values())}if(s.update){const M=new Map((p=C.update)===null||p===void 0?void 0:p.map((O=>[O.id,O])));for(const O of s.update){const F=(_=M.get(O.id))!==null&&_!==void 0?_:{id:O.id};O.newGeometry&&(F.newGeometry=O.newGeometry),O.addOrUpdateProperties&&(F.addOrUpdateProperties=((b=F.addOrUpdateProperties)!==null&&b!==void 0?b:[]).concat(O.addOrUpdateProperties)),O.removeProperties&&(F.removeProperties=((T=F.removeProperties)!==null&&T!==void 0?T:[]).concat(O.removeProperties)),O.removeAllProperties&&(F.removeAllProperties=!0),M.set(O.id,F)}C.update=Array.from(M.values())}return C.remove&&C.add&&(C.remove=C.remove.filter((M=>C.add.findIndex((O=>O.id===M))===-1))),C},d.a1=Sm,d.a2=vd,d.a3=25,d.a4=av,d.a5=u=>{const s=window.document.createElement("video");return s.muted=!0,new Promise((l=>{s.onloadstart=()=>{l(s)};for(const p of u){const _=window.document.createElement("source");Ke(p)||(s.crossOrigin="Anonymous"),_.src=p,s.appendChild(_)}}))},d.a6=lt,d.a7=function(){return an++},d.a8=re,d.a9=Uf,d.aA=function(u){let s=1/0,l=1/0,p=-1/0,_=-1/0;for(const b of u)s=Math.min(s,b.x),l=Math.min(l,b.y),p=Math.max(p,b.x),_=Math.max(_,b.y);return[s,l,p,_]},d.aB=ar,d.aC=$e,d.aD=function(u,s,l,p,_=!1){if(!l[0]&&!l[1])return[0,0];const b=_?p==="map"?-u.bearingInRadians:0:p==="viewport"?u.bearingInRadians:0;if(b){const T=Math.sin(b),C=Math.cos(b);l=[l[0]*C-l[1]*T,l[0]*T+l[1]*C]}return[_?l[0]:$e(s,l[0],u.zoom),_?l[1]:$e(s,l[1],u.zoom)]},d.aF=Gn,d.aG=cv,d.aH=Ht,d.aI=uv,d.aJ=Jn,d.aK=oh,d.aL=qe,d.aM=En,d.aN=Di,d.aO=Qt,d.aP=Kr,d.aQ=vw,d.aR=Ft,d.aS=vt,d.aT=function(u){var s=new se(3);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s},d.aU=function(u,s,l){return u[0]=s[0]-l[0],u[1]=s[1]-l[1],u[2]=s[2]-l[2],u},d.aV=function(u,s){var l=s[0],p=s[1],_=s[2],b=l*l+p*p+_*_;return b>0&&(b=1/Math.sqrt(b)),u[0]=s[0]*b,u[1]=s[1]*b,u[2]=s[2]*b,u},d.aW=Wt,d.aX=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]},d.aY=function(u,s,l){return u[0]=s[0]*l[0],u[1]=s[1]*l[1],u[2]=s[2]*l[2],u[3]=s[3]*l[3],u},d.aZ=dt,d.a_=function(u,s,l){const p=s[0]*l[0]+s[1]*l[1]+s[2]*l[2];return p===0?null:(-(u[0]*l[0]+u[1]*l[1]+u[2]*l[2])-l[3])/p},d.aa=yo,d.ab=or,d.ac=Tw,d.ad=function(u){const s={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((l,p,_,b)=>{const T=_||b;return s[p]=!T||T.toLowerCase(),""})),s["max-age"]){const l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s},d.ae=ds,d.af=function(u){return Math.pow(2,u)},d.ag=Ne,d.ah=$t,d.ai=85.051129,d.aj=yw,d.ak=function(u){return Math.log(u)/Math.LN2},d.al=function(u){var s=u[0],l=u[1];return s*s+l*l},d.am=function(u,s){const l=[];for(const p in u)p in s||l.push(p);return l},d.an=function(u,s){let l=0,p=0;if(u.kind==="constant")p=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:_,minZoom:b,maxZoom:T}=u,C=_?$t(Bi.interpolationFactor(_,s,b,T),0,1):0;u.kind==="camera"?p=Ks.number(u.minSize,u.maxSize,C):l=C}return{uSizeT:l,uSize:p}},d.ap=function(u,{uSize:s,uSizeT:l},{lowerSize:p,upperSize:_}){return u.kind==="source"?p/nn:u.kind==="composite"?Ks.number(p/nn,_/nn,l):s},d.aq=function(u,s){var l=s[0],p=s[1],_=s[2],b=s[3],T=s[4],C=s[5],M=s[6],O=s[7],F=s[8],j=s[9],H=s[10],X=s[11],G=s[12],te=s[13],oe=s[14],me=s[15],je=l*C-p*T,Te=l*M-_*T,Ie=l*O-b*T,Je=p*M-_*C,st=p*O-b*C,ft=_*O-b*M,Ot=F*te-j*G,St=F*oe-H*G,Rt=F*me-X*G,Gt=j*oe-H*te,Mt=j*me-X*te,kt=H*me-X*oe,ct=je*kt-Te*Mt+Ie*Gt+Je*Rt-st*St+ft*Ot;return ct?(u[0]=(C*kt-M*Mt+O*Gt)*(ct=1/ct),u[1]=(_*Mt-p*kt-b*Gt)*ct,u[2]=(te*ft-oe*st+me*Je)*ct,u[3]=(H*st-j*ft-X*Je)*ct,u[4]=(M*Rt-T*kt-O*St)*ct,u[5]=(l*kt-_*Rt+b*St)*ct,u[6]=(oe*Ie-G*ft-me*Te)*ct,u[7]=(F*ft-H*Ie+X*Te)*ct,u[8]=(T*Mt-C*Rt+O*Ot)*ct,u[9]=(p*Rt-l*Mt-b*Ot)*ct,u[10]=(G*st-te*Ie+me*je)*ct,u[11]=(j*Ie-F*st-X*je)*ct,u[12]=(C*St-T*Gt-M*Ot)*ct,u[13]=(l*Gt-p*St+_*Ot)*ct,u[14]=(te*Te-G*Je-oe*je)*ct,u[15]=(F*Je-j*Te+H*je)*ct,u):null},d.ar=ke,d.as=function(u){var s=u[0],l=u[1];return Math.sqrt(s*s+l*l)},d.at=function(u){return u[0]=0,u[1]=0,u},d.au=function(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u},d.av=tv,d.aw=rn,d.ax=function(u,s,l,p){const _=s.y-u.y,b=s.x-u.x,T=p.y-l.y,C=p.x-l.x,M=T*b-C*_;if(M===0)return null;const O=(C*(u.y-l.y)-T*(u.x-l.x))/M;return new v(u.x+O*b,u.y+O*_)},d.ay=Ew,d.az=Qp,d.b=Sn,d.b$=class extends m{},d.b0=function(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u[2]=s[2]*l,u[3]=s[3]*l,u},d.b1=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]+u[3]},d.b2=bw,d.b3=jf,d.b4=function(u,s,l,p,_){var b=1/Math.tan(s/2);if(u[0]=b/l,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=b,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,_!=null&&_!==1/0){var T=1/(p-_);u[10]=(_+p)*T,u[14]=2*_*p*T}else u[10]=-1,u[14]=-2*p;return u},d.b5=function(u){var s=new se(16);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[4]=u[4],s[5]=u[5],s[6]=u[6],s[7]=u[7],s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},d.b6=function(u,s,l){var p=Math.sin(l),_=Math.cos(l),b=s[0],T=s[1],C=s[2],M=s[3],O=s[4],F=s[5],j=s[6],H=s[7];return s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=b*_+O*p,u[1]=T*_+F*p,u[2]=C*_+j*p,u[3]=M*_+H*p,u[4]=O*_-b*p,u[5]=F*_-T*p,u[6]=j*_-C*p,u[7]=H*_-M*p,u},d.b7=function(u,s,l){var p=Math.sin(l),_=Math.cos(l),b=s[4],T=s[5],C=s[6],M=s[7],O=s[8],F=s[9],j=s[10],H=s[11];return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[4]=b*_+O*p,u[5]=T*_+F*p,u[6]=C*_+j*p,u[7]=M*_+H*p,u[8]=O*_-b*p,u[9]=F*_-T*p,u[10]=j*_-C*p,u[11]=H*_-M*p,u},d.b8=function(){const u=new Float32Array(16);return Ne(u),u},d.b9=function(){const u=new Float64Array(16);return Ne(u),u},d.bA=function(u,s){const l=de(u,360),p=de(s,360),_=p-l,b=p>l?_-360:_+360;return Math.abs(_)<Math.abs(b)?_:b},d.bB=function(u){return u[0]=0,u[1]=0,u[2]=0,u},d.bC=function(u,s,l,p){const _=Math.sqrt(u*u+s*s),b=Math.sqrt(l*l+p*p);u/=_,s/=_,l/=b,p/=b;const T=Math.acos(u*l+s*p);return-s*l+u*p>0?T:-T},d.bD=function(u,s){const l=de(u,2*Math.PI),p=de(s,2*Math.PI);return Math.min(Math.abs(l-p),Math.abs(l-p+2*Math.PI),Math.abs(l-p-2*Math.PI))},d.bE=function(){const u={},s=Be.$version;for(const l in Be.$root){const p=Be.$root[l];if(p.required){let _=null;_=l==="version"?s:p.type==="array"?[]:{},_!=null&&(u[l]=_)}}return u},d.bF=Xu,d.bG=Ce,d.bH=function u(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(let p=0;p<s.length;p++)if(!u(s[p],l[p]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(const p in s)if(!u(s[p],l[p]))return!1;return!0}return s===l},d.bI=function(u){u=u.slice();const s=Object.create(null);for(let l=0;l<u.length;l++)s[u[l].id]=u[l];for(let l=0;l<u.length;l++)"ref"in u[l]&&(u[l]=Dn(u[l],s[u[l].ref]));return u},d.bJ=function(u,s){if(u.type==="custom")return new cI(u,s);switch(u.type){case"background":return new oI(u,s);case"circle":return new kg(u,s);case"color-relief":return new cm(u,s);case"fill":return new ws(u,s);case"fill-extrusion":return new Gy(u,s);case"heatmap":return new Dg(u,s);case"hillshade":return new vf(u,s);case"line":return new Ao(u,s);case"raster":return new lI(u,s);case"symbol":return new Jg(u,s)}},d.bK=Ii,d.bL=function(u,s){if(!u)return[{command:"setStyle",args:[s]}];let l=[];try{if(!Xt(u.version,s.version))return[{command:"setStyle",args:[s]}];Xt(u.center,s.center)||l.push({command:"setCenter",args:[s.center]}),Xt(u.state,s.state)||l.push({command:"setGlobalState",args:[s.state]}),Xt(u.centerAltitude,s.centerAltitude)||l.push({command:"setCenterAltitude",args:[s.centerAltitude]}),Xt(u.zoom,s.zoom)||l.push({command:"setZoom",args:[s.zoom]}),Xt(u.bearing,s.bearing)||l.push({command:"setBearing",args:[s.bearing]}),Xt(u.pitch,s.pitch)||l.push({command:"setPitch",args:[s.pitch]}),Xt(u.roll,s.roll)||l.push({command:"setRoll",args:[s.roll]}),Xt(u.sprite,s.sprite)||l.push({command:"setSprite",args:[s.sprite]}),Xt(u.glyphs,s.glyphs)||l.push({command:"setGlyphs",args:[s.glyphs]}),Xt(u.transition,s.transition)||l.push({command:"setTransition",args:[s.transition]}),Xt(u.light,s.light)||l.push({command:"setLight",args:[s.light]}),Xt(u.terrain,s.terrain)||l.push({command:"setTerrain",args:[s.terrain]}),Xt(u.sky,s.sky)||l.push({command:"setSky",args:[s.sky]}),Xt(u.projection,s.projection)||l.push({command:"setProjection",args:[s.projection]});const p={},_=[];(function(T,C,M,O){let F;for(F in C=C||{},T=T||{})Object.prototype.hasOwnProperty.call(T,F)&&(Object.prototype.hasOwnProperty.call(C,F)||Ei(F,M,O));for(F in C)Object.prototype.hasOwnProperty.call(C,F)&&(Object.prototype.hasOwnProperty.call(T,F)?Xt(T[F],C[F])||(T[F].type==="geojson"&&C[F].type==="geojson"&&Pi(T,C,F)?yn(M,{command:"setGeoJSONSourceData",args:[F,C[F].data]}):$i(F,C,M,O)):ai(F,C,M))})(u.sources,s.sources,_,p);const b=[];u.layers&&u.layers.forEach((T=>{"source"in T&&p[T.source]?l.push({command:"removeLayer",args:[T.id]}):b.push(T)})),l=l.concat(_),(function(T,C,M){C=C||[];const O=(T=T||[]).map(Kn),F=C.map(Kn),j=T.reduce(Fi,{}),H=C.reduce(Fi,{}),X=O.slice(),G=Object.create(null);let te,oe,me,je,Te;for(let Ie=0,Je=0;Ie<O.length;Ie++)te=O[Ie],Object.prototype.hasOwnProperty.call(H,te)?Je++:(yn(M,{command:"removeLayer",args:[te]}),X.splice(X.indexOf(te,Je),1));for(let Ie=0,Je=0;Ie<F.length;Ie++)te=F[F.length-1-Ie],X[X.length-1-Ie]!==te&&(Object.prototype.hasOwnProperty.call(j,te)?(yn(M,{command:"removeLayer",args:[te]}),X.splice(X.lastIndexOf(te,X.length-Je),1)):Je++,je=X[X.length-Ie],yn(M,{command:"addLayer",args:[H[te],je]}),X.splice(X.length-Ie,0,te),G[te]=!0);for(let Ie=0;Ie<F.length;Ie++)if(te=F[Ie],oe=j[te],me=H[te],!G[te]&&!Xt(oe,me))if(Xt(oe.source,me.source)&&Xt(oe["source-layer"],me["source-layer"])&&Xt(oe.type,me.type)){for(Te in Li(oe.layout,me.layout,M,te,null,"setLayoutProperty"),Li(oe.paint,me.paint,M,te,null,"setPaintProperty"),Xt(oe.filter,me.filter)||yn(M,{command:"setFilter",args:[te,me.filter]}),Xt(oe.minzoom,me.minzoom)&&Xt(oe.maxzoom,me.maxzoom)||yn(M,{command:"setLayerZoomRange",args:[te,me.minzoom,me.maxzoom]}),oe)Object.prototype.hasOwnProperty.call(oe,Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?Li(oe[Te],me[Te],M,te,Te.slice(6),"setPaintProperty"):Xt(oe[Te],me[Te])||yn(M,{command:"setLayerProperty",args:[te,Te,me[Te]]}));for(Te in me)Object.prototype.hasOwnProperty.call(me,Te)&&!Object.prototype.hasOwnProperty.call(oe,Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?Li(oe[Te],me[Te],M,te,Te.slice(6),"setPaintProperty"):Xt(oe[Te],me[Te])||yn(M,{command:"setLayerProperty",args:[te,Te,me[Te]]}))}else yn(M,{command:"removeLayer",args:[te]}),je=X[X.lastIndexOf(te)+1],yn(M,{command:"addLayer",args:[me,je]})})(b,s.layers,l)}catch(p){console.warn("Unable to compute style diff:",p),l=[{command:"setStyle",args:[s]}]}return l},d.bM=function(u){const s=[],l=u.id;return l===void 0&&s.push({message:`layers.${l}: missing required property "id"`}),u.render===void 0&&s.push({message:`layers.${l}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&s.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),s},d.bN=_n,d.bO=Gi,d.bP=class extends gi{constructor(u,s){super(u,s),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},d.bQ=Fs,d.bR=class extends gi{constructor(u,s){super(u,s),this.current=ad}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let s=1;s<16;s++)if(u[s]!==this.current[s]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},d.bS=uf,d.bT=class extends gi{constructor(u,s){super(u,s),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},d.bU=class extends gi{constructor(u,s){super(u,s),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},d.bV=Se,d.bW=function(u,s){var l=Math.sin(s),p=Math.cos(s);return u[0]=p,u[1]=l,u[2]=0,u[3]=-l,u[4]=p,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},d.bX=function(u,s,l){var p=s[0],_=s[1],b=s[2];return u[0]=p*l[0]+_*l[3]+b*l[6],u[1]=p*l[1]+_*l[4]+b*l[7],u[2]=p*l[2]+_*l[5]+b*l[8],u},d.bY=function(u,s,l,p,_,b,T){var C=1/(s-l),M=1/(p-_),O=1/(b-T);return u[0]=-2*C,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*M,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*O,u[11]=0,u[12]=(s+l)*C,u[13]=(_+p)*M,u[14]=(T+b)*O,u[15]=1,u},d.bZ=class extends gi{constructor(u,s){super(u,s),this.current=new Array}set(u){if(u!=this.current){this.current=u;const s=new Float32Array(4*u.length);for(let l=0;l<u.length;l++)s[4*l]=u[l].r,s[4*l+1]=u[l].g,s[4*l+2]=u[l].b,s[4*l+3]=u[l].a;this.gl.uniform4fv(this.location,s)}}},d.b_=class extends gi{constructor(u,s){super(u,s),this.current=new Array}set(u){if(u!=this.current){this.current=u;const s=new Float32Array(u);this.gl.uniform1fv(this.location,s)}}},d.ba=function(){return new Float64Array(16)},d.bb=function(u,s,l){const p=new Float64Array(4);return Pe(p,u,s-90,l),p},d.bc=function(u,s,l,p){var _,b,T,C,M,O=s[0],F=s[1],j=s[2],H=s[3],X=l[0],G=l[1],te=l[2],oe=l[3];return(b=O*X+F*G+j*te+H*oe)<0&&(b=-b,X=-X,G=-G,te=-te,oe=-oe),1-b>ve?(_=Math.acos(b),T=Math.sin(_),C=Math.sin((1-p)*_)/T,M=Math.sin(p*_)/T):(C=1-p,M=p),u[0]=C*O+M*X,u[1]=C*F+M*G,u[2]=C*j+M*te,u[3]=C*H+M*oe,u},d.bd=function(u){const s=new Float64Array(9);var l,p,_,b,T,C,M,O,F,j,H,X,G,te,oe,me,je,Te;j=(_=(p=u)[0])*(M=_+_),H=(b=p[1])*M,G=(T=p[2])*M,te=T*(O=b+b),me=(C=p[3])*M,je=C*O,Te=C*(F=T+T),(l=s)[0]=1-(X=b*O)-(oe=T*F),l[3]=H-Te,l[6]=G+je,l[1]=H+Te,l[4]=1-j-oe,l[7]=te-me,l[2]=G-je,l[5]=te+me,l[8]=1-j-X;const Ie=Kr(-Math.asin($t(s[2],-1,1)));let Je,st;return Math.hypot(s[5],s[8])<.001?(Je=0,st=-Kr(Math.atan2(s[3],s[4]))):(Je=Kr(s[5]===0&&s[8]===0?0:Math.atan2(s[5],s[8])),st=Kr(s[1]===0&&s[0]===0?0:Math.atan2(s[1],s[0]))),{roll:Je,pitch:Ie+90,bearing:st}},d.be=function(u,s){return u.roll==s.roll&&u.pitch==s.pitch&&u.bearing==s.bearing},d.bf=An,d.bg=th,d.bh=Ho,d.bi=oo,d.bj=mr,d.bk=De,d.bl=ut,d.bm=fr,d.bn=function(u,s,l,p,_){return De(p,_,$t((u-s)/(l-s),0,1))},d.bo=de,d.bp=function(){return new Float64Array(3)},d.bq=function(u,s,l,p){return u[0]=s[0]+l[0]*p,u[1]=s[1]+l[1]*p,u[2]=s[2]+l[2]*p,u},d.br=Pe,d.bs=function(u,s,l){var p=l[0],_=l[1],b=l[2],T=l[3],C=s[0],M=s[1],O=s[2],F=_*O-b*M,j=b*C-p*O,H=p*M-_*C;return u[0]=C+T*(F+=F)+_*(H+=H)-b*(j+=j),u[1]=M+T*j+b*F-p*H,u[2]=O+T*H+p*j-_*F,u},d.bt=function(u,s,l){const p=(_=[u[0],u[1],u[2],s[0],s[1],s[2],l[0],l[1],l[2]])[0]*((F=_[8])*(T=_[4])-(C=_[5])*(O=_[7]))+_[1]*(-F*(b=_[3])+C*(M=_[6]))+_[2]*(O*b-T*M);var _,b,T,C,M,O,F;if(p===0)return null;const j=Wt([],[s[0],s[1],s[2]],[l[0],l[1],l[2]]),H=Wt([],[l[0],l[1],l[2]],[u[0],u[1],u[2]]),X=Wt([],[u[0],u[1],u[2]],[s[0],s[1],s[2]]),G=Ft([],j,-u[3]);return vt(G,G,Ft([],H,-s[3])),vt(G,G,Ft([],X,-l[3])),Ft(G,G,1/p),G},d.bu=sv,d.bv=function(){return new Float64Array(4)},d.bw=function(u,s,l,p){var _=[],b=[];return _[0]=s[0]-l[0],_[1]=s[1]-l[1],_[2]=s[2]-l[2],b[0]=_[0]*Math.cos(p)-_[1]*Math.sin(p),b[1]=_[0]*Math.sin(p)+_[1]*Math.cos(p),b[2]=_[2],u[0]=b[0]+l[0],u[1]=b[1]+l[1],u[2]=b[2]+l[2],u},d.bx=function(u,s,l,p){var _=[],b=[];return _[0]=s[0]-l[0],_[1]=s[1]-l[1],_[2]=s[2]-l[2],b[0]=_[0],b[1]=_[1]*Math.cos(p)-_[2]*Math.sin(p),b[2]=_[1]*Math.sin(p)+_[2]*Math.cos(p),u[0]=b[0]+l[0],u[1]=b[1]+l[1],u[2]=b[2]+l[2],u},d.by=function(u,s,l,p){var _=[],b=[];return _[0]=s[0]-l[0],_[1]=s[1]-l[1],_[2]=s[2]-l[2],b[0]=_[2]*Math.sin(p)+_[0]*Math.cos(p),b[1]=_[1],b[2]=_[2]*Math.cos(p)-_[0]*Math.sin(p),u[0]=b[0]+l[0],u[1]=b[1]+l[1],u[2]=b[2]+l[2],u},d.bz=function(u,s,l){var p=Math.sin(l),_=Math.cos(l),b=s[0],T=s[1],C=s[2],M=s[3],O=s[8],F=s[9],j=s[10],H=s[11];return s!==u&&(u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=b*_-O*p,u[1]=T*_-F*p,u[2]=C*_-j*p,u[3]=M*_-H*p,u[8]=b*p+O*_,u[9]=T*p+F*_,u[10]=C*p+j*_,u[11]=M*p+H*_,u},d.c=Le,d.c0=Of,d.c1=class extends w{},d.c2=hd,d.c3=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},d.c4=fu,d.c5=function(u,s,l){var p=s[0],_=s[1],b=s[2],T=l[3]*p+l[7]*_+l[11]*b+l[15];return u[0]=(l[0]*p+l[4]*_+l[8]*b+l[12])/(T=T||1),u[1]=(l[1]*p+l[5]*_+l[9]*b+l[13])/T,u[2]=(l[2]*p+l[6]*_+l[10]*b+l[14])/T,u},d.c6=class extends ns{},d.c7=class extends ${},d.c8=function(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]&&u[3]===s[3]&&u[4]===s[4]&&u[5]===s[5]&&u[6]===s[6]&&u[7]===s[7]&&u[8]===s[8]&&u[9]===s[9]&&u[10]===s[10]&&u[11]===s[11]&&u[12]===s[12]&&u[13]===s[13]&&u[14]===s[14]&&u[15]===s[15]},d.c9=function(u,s){var l=u[0],p=u[1],_=u[2],b=u[3],T=u[4],C=u[5],M=u[6],O=u[7],F=u[8],j=u[9],H=u[10],X=u[11],G=u[12],te=u[13],oe=u[14],me=u[15],je=s[0],Te=s[1],Ie=s[2],Je=s[3],st=s[4],ft=s[5],Ot=s[6],St=s[7],Rt=s[8],Gt=s[9],Mt=s[10],kt=s[11],ct=s[12],ln=s[13],gn=s[14],tn=s[15];return Math.abs(l-je)<=ve*Math.max(1,Math.abs(l),Math.abs(je))&&Math.abs(p-Te)<=ve*Math.max(1,Math.abs(p),Math.abs(Te))&&Math.abs(_-Ie)<=ve*Math.max(1,Math.abs(_),Math.abs(Ie))&&Math.abs(b-Je)<=ve*Math.max(1,Math.abs(b),Math.abs(Je))&&Math.abs(T-st)<=ve*Math.max(1,Math.abs(T),Math.abs(st))&&Math.abs(C-ft)<=ve*Math.max(1,Math.abs(C),Math.abs(ft))&&Math.abs(M-Ot)<=ve*Math.max(1,Math.abs(M),Math.abs(Ot))&&Math.abs(O-St)<=ve*Math.max(1,Math.abs(O),Math.abs(St))&&Math.abs(F-Rt)<=ve*Math.max(1,Math.abs(F),Math.abs(Rt))&&Math.abs(j-Gt)<=ve*Math.max(1,Math.abs(j),Math.abs(Gt))&&Math.abs(H-Mt)<=ve*Math.max(1,Math.abs(H),Math.abs(Mt))&&Math.abs(X-kt)<=ve*Math.max(1,Math.abs(X),Math.abs(kt))&&Math.abs(G-ct)<=ve*Math.max(1,Math.abs(G),Math.abs(ct))&&Math.abs(te-ln)<=ve*Math.max(1,Math.abs(te),Math.abs(ln))&&Math.abs(oe-gn)<=ve*Math.max(1,Math.abs(oe),Math.abs(gn))&&Math.abs(me-tn)<=ve*Math.max(1,Math.abs(me),Math.abs(tn))},d.cA=function(u,s){K.REGISTERED_PROTOCOLS[u]=s},d.cB=function(u){delete K.REGISTERED_PROTOCOLS[u]},d.cC=function(u,s){const l={};for(let _=0;_<u.length;_++){const b=s&&s[u[_].id]||Hu(u[_]);s&&(s[u[_].id]=b);let T=l[b];T||(T=l[b]=[]),T.push(u[_])}const p=[];for(const _ in l)p.push(l[_]);return p},d.cD=Ct,d.cE=ww,d.cF=Sw,d.cG=yd,d.cH=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=Ue/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const s=u.bucket.layers[0],l=s.layout,p=s._unevaluatedLayout._values,_={layoutIconSize:p["icon-size"].possiblyEvaluate(new Xn(u.bucket.zoom+1),u.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Xn(u.bucket.zoom+1),u.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Xn(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:F}=u.bucket.textSizeData;_.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Xn(O),u.canonical),p["text-size"].possiblyEvaluate(new Xn(F),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:F}=u.bucket.iconSizeData;_.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Xn(O),u.canonical),p["icon-size"].possiblyEvaluate(new Xn(F),u.canonical)]}const b=l.get("text-line-height")*ar,T=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",C=l.get("text-keep-upright"),M=l.get("text-size");for(const O of u.bucket.features){const F=l.get("text-font").evaluate(O,{},u.canonical).join(","),j=M.evaluate(O,{},u.canonical),H=_.layoutTextSize.evaluate(O,{},u.canonical),X=_.layoutIconSize.evaluate(O,{},u.canonical),G={horizontal:{},vertical:void 0},te=O.text;let oe,me=[0,0];if(te){const Ie=te.toString(),Je=l.get("text-letter-spacing").evaluate(O,{},u.canonical)*ar,st=ts(Ie)?Je:0,ft=l.get("text-anchor").evaluate(O,{},u.canonical),Ot=Lw(s,O,u.canonical);if(!Ot){const Mt=l.get("text-radial-offset").evaluate(O,{},u.canonical);me=Mt?Ow(ft,[Mt*ar,lv]):l.get("text-offset").evaluate(O,{},u.canonical).map((kt=>kt*ar))}let St=T?"center":l.get("text-justify").evaluate(O,{},u.canonical);const Rt=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(O,{},u.canonical)*ar:1/0,Gt=()=>{u.bucket.allowVerticalPlacement&&su(Ie)&&(G.vertical=I(te,u.glyphMap,u.glyphPositions,u.imagePositions,F,Rt,b,ft,"left",st,me,d.ao.vertical,!0,H,j))};if(!T&&Ot){const Mt=new Set;if(St==="auto")for(let ct=0;ct<Ot.values.length;ct+=2)Mt.add(cv(Ot.values[ct]));else Mt.add(St);let kt=!1;for(const ct of Mt)if(!G.horizontal[ct])if(kt)G.horizontal[ct]=G.horizontal[0];else{const ln=I(te,u.glyphMap,u.glyphPositions,u.imagePositions,F,Rt,b,"center",ct,st,me,d.ao.horizontal,!1,H,j);ln&&(G.horizontal[ct]=ln,kt=ln.positionedLines.length===1)}Gt()}else{St==="auto"&&(St=cv(ft));const Mt=I(te,u.glyphMap,u.glyphPositions,u.imagePositions,F,Rt,b,ft,St,st,me,d.ao.horizontal,!1,H,j);Mt&&(G.horizontal[St]=Mt),Gt(),su(Ie)&&T&&C&&(G.vertical=I(te,u.glyphMap,u.glyphPositions,u.imagePositions,F,Rt,b,ft,St,st,me,d.ao.vertical,!1,H,j))}}let je=!1;if(O.icon&&O.icon.name){const Ie=u.imageMap[O.icon.name];Ie&&(oe=Lt(u.imagePositions[O.icon.name],l.get("icon-offset").evaluate(O,{},u.canonical),l.get("icon-anchor").evaluate(O,{},u.canonical)),je=!!Ie.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=je:u.bucket.sdfIcons!==je&&ri("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ie.pixelRatio!==u.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Te=Nw(G.horizontal)||G.vertical;u.bucket.iconsInText=!!Te&&Te.iconsInText,(Te||oe)&&yI(u.bucket,O,G,oe,u.imageMap,_,H,X,me,je,u.canonical,u.subdivisionGranularity)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},d.cI=gu,d.cJ=gl,d.cK=Mf,d.cL=pm,d.cM=Lf,d.cN=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},d.cO=function(u,s,l,p,_){return a(this,void 0,void 0,(function*(){if(ue())try{return yield Yn(u,s,l,p,_)}catch{}return(function(b,T,C,M,O){const F=b.width,j=b.height;yi&&hs||(yi=new OffscreenCanvas(F,j),hs=yi.getContext("2d",{willReadFrequently:!0})),yi.width=F,yi.height=j,hs.drawImage(b,0,0,F,j);const H=hs.getImageData(T,C,M,O);return hs.clearRect(0,0,F,j),H.data})(u,s,l,p,_)}))},d.cP=lm,d.cQ=A,d.cR=Ug,d.cS=_u,d.cT=Gl,d.cU=function(u,s){const l=new Map;if(u!=null)if(u.type==="Feature")l.set(Am(u,s),u);else for(const p of u.features)l.set(Am(p,s),p);return l},d.cV=function(u,s){if(u==null)return!0;if(u.type==="Feature")return Am(u,s)!=null;if(u.type==="FeatureCollection"){const l=new Set;for(const p of u.features){const _=Am(p,s);if(_==null||l.has(_))return!1;l.add(_)}return!0}return!1},d.cW=function(u,s,l){var p,_,b,T;if(s.removeAll&&u.clear(),s.remove)for(const C of s.remove)u.delete(C);if(s.add)for(const C of s.add){const M=Am(C,l);M!=null&&u.set(M,C)}if(s.update)for(const C of s.update){let M=u.get(C.id);if(M==null)continue;const O=!C.removeAllProperties&&(((p=C.removeProperties)===null||p===void 0?void 0:p.length)>0||((_=C.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0);if((C.newGeometry||C.removeAllProperties||O)&&(M=Object.assign({},M),u.set(C.id,M),O&&(M.properties=Object.assign({},M.properties))),C.newGeometry&&(M.geometry=C.newGeometry),C.removeAllProperties)M.properties={};else if(((b=C.removeProperties)===null||b===void 0?void 0:b.length)>0)for(const F of C.removeProperties)Object.prototype.hasOwnProperty.call(M.properties,F)&&delete M.properties[F];if(((T=C.addOrUpdateProperties)===null||T===void 0?void 0:T.length)>0)for(const{key:F,value:j}of C.addOrUpdateProperties)M.properties[F]=j}},d.cX=ys,d.ca=function(u,s){return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},d.cb=u=>u.type==="symbol",d.cc=u=>u.type==="circle",d.cd=u=>u.type==="heatmap",d.ce=u=>u.type==="line",d.cf=u=>u.type==="fill",d.cg=u=>u.type==="fill-extrusion",d.ch=u=>u.type==="hillshade",d.ci=u=>u.type==="color-relief",d.cj=u=>u.type==="raster",d.ck=u=>u.type==="background",d.cl=u=>u.type==="custom",d.cm=Et,d.cn=function(u,s,l){const p=ge(s.x-l.x,s.y-l.y),_=ge(u.x-l.x,u.y-l.y);var b,T;return Kr(Math.atan2(p[0]*_[1]-p[1]*_[0],(b=p)[0]*(T=_)[0]+b[1]*T[1]))},d.co=It,d.cp=function(u,s){return Jr[s]&&(u instanceof MouseEvent||u instanceof WheelEvent)},d.cq=function(u,s){return Zs[s]&&"touches"in u},d.cr=function(u){return Zs[u]||Jr[u]},d.cs=function(u,s,l){var p=s[0],_=s[1];return u[0]=l[0]*p+l[4]*_+l[12],u[1]=l[1]*p+l[5]*_+l[13],u},d.ct=function(u,s){const{x:l,y:p}=Sm.fromLngLat(s);return!(u<0||u>25||p<0||p>=1||l<0||l>=1)},d.cu=function(u,s){return u[0]=s[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=s[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=s[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},d.cv=class extends jr{},d.cw=xI,d.cy=function(u){return u.message===Ps},d.cz=we,d.d=Ke,d.e=Ut,d.f=u=>a(void 0,void 0,void 0,(function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(s)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),d.g=J,d.h=u=>new Promise(((s,l)=>{const p=new Image;p.onload=()=>{s(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame((()=>{p.src=Nn}))},p.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(u)],{type:"image/png"});p.src=u.byteLength?URL.createObjectURL(_):Nn})),d.i=Pt,d.j=(u,s)=>Fe(Ut(u,{type:"json"}),s),d.k=at,d.l=mt,d.m=Fe,d.n=(u,s)=>Fe(Ut(u,{type:"arrayBuffer"}),s),d.o=function(u){return new Lf(u).readFields(Qy,[])},d.p=ch,d.q=ud,d.r=zi,d.s=Es,d.t=Ku,d.u=Rn,d.v=Be,d.w=ri,d.x=ec,d.y=il,d.z=ya})),o("worker",["./shared"],(function(d){class a{constructor(K,J){this.keyCache={},K&&this.replace(K,J)}replace(K,J){this._layerConfigs={},this._layers={},this.update(K,[],J)}update(K,J,ie){for(const Ce of K){this._layerConfigs[Ce.id]=Ce;const Fe=this._layers[Ce.id]=d.bJ(Ce,ie);Fe._featureFilter=d.aa(Fe.filter,ie),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id]}for(const Ce of J)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const we=d.cC(Object.values(this._layerConfigs),this.keyCache);for(const Ce of we){const Fe=Ce.map((zt=>this._layers[zt.id])),Ke=Fe[0];if(Ke.visibility==="none")continue;const ze=Ke.source||"";let rt=this.familiesBySource[ze];rt||(rt=this.familiesBySource[ze]={});const mt=Ke.sourceLayer||"_geojsonTileLayer";let at=rt[mt];at||(at=rt[mt]=[]),at.push(Fe)}}}class v{constructor(K){const J={},ie=[];for(const Ke in K){const ze=K[Ke],rt=J[Ke]={};for(const mt in ze){const at=ze[+mt];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const zt={x:0,y:0,w:at.bitmap.width+2,h:at.bitmap.height+2};ie.push(zt),rt[mt]={rect:zt,metrics:at.metrics}}}const{w:we,h:Ce}=d.p(ie),Fe=new d.q({width:we||1,height:Ce||1});for(const Ke in K){const ze=K[Ke];for(const rt in ze){const mt=ze[+rt];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;const at=J[Ke][rt].rect;d.q.copy(mt.bitmap,Fe,{x:0,y:0},{x:at.x+1,y:at.y+1},mt.bitmap)}}this.image=Fe,this.positions=J}}d.cD("GlyphAtlas",v);class A{constructor(K){this.tileID=new d.Z(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.uid=K.uid,this.zoom=K.zoom,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.returnDependencies=!!K.returnDependencies,this.promoteId=K.promoteId,this.inFlightDependencies=[]}parse(K,J,ie,we,Ce){return d._(this,void 0,void 0,(function*(){this.status="parsing",this.data=K,this.collisionBoxArray=new d.a8;const Fe=new d.cE(Object.keys(K.layers).sort()),Ke=new d.cF(this.tileID,this.promoteId);Ke.bucketLayerIDs=[];const ze={},rt={featureIndex:Ke,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ie,subdivisionGranularity:Ce},mt=J.familiesBySource[this.source];for(const lt in mt){const bi=K.layers[lt];if(!bi)continue;bi.version===1&&d.w(`Vector tile source "${this.source}" layer "${lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xr=Fe.encode(lt),Co=[];for(let br=0;br<bi.length;br++){const wt=bi.feature(br),wn=Ke.getId(wt,lt);Co.push({feature:wt,id:wn,index:br,sourceLayerIndex:xr})}for(const br of mt[lt]){const wt=br[0];wt.source!==this.source&&d.w(`layer.source = ${wt.source} does not equal this.source = ${this.source}`),wt.minzoom&&this.zoom<Math.floor(wt.minzoom)||wt.maxzoom&&this.zoom>=wt.maxzoom||wt.visibility!=="none"&&(E(br,this.zoom,ie),(ze[wt.id]=wt.createBucket({index:Ke.bucketLayerIDs.length,layers:br,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xr,sourceID:this.source})).populate(Co,rt,this.tileID.canonical),Ke.bucketLayerIDs.push(br.map((wn=>wn.id))))}}const at=d.bN(rt.glyphDependencies,(lt=>Object.keys(lt).map(Number)));this.inFlightDependencies.forEach((lt=>lt?.abort())),this.inFlightDependencies=[];let zt=Promise.resolve({});if(Object.keys(at).length){const lt=new AbortController;this.inFlightDependencies.push(lt),zt=we.sendAsync({type:"GG",data:{stacks:at,source:this.source,tileID:this.tileID,type:"glyphs"}},lt)}const Be=Object.keys(rt.iconDependencies);let un=Promise.resolve({});if(Be.length){const lt=new AbortController;this.inFlightDependencies.push(lt),un=we.sendAsync({type:"GI",data:{icons:Be,source:this.source,tileID:this.tileID,type:"icons"}},lt)}const Dn=Object.keys(rt.patternDependencies);let Xt=Promise.resolve({});if(Dn.length){const lt=new AbortController;this.inFlightDependencies.push(lt),Xt=we.sendAsync({type:"GI",data:{icons:Dn,source:this.source,tileID:this.tileID,type:"patterns"}},lt)}const yn=rt.dashDependencies;let ai=Promise.resolve({});if(Object.keys(yn).length){const lt=new AbortController;this.inFlightDependencies.push(lt),ai=we.sendAsync({type:"GDA",data:{dashes:yn}},lt)}const[Ei,$i,Pi,Li]=yield Promise.all([zt,un,Xt,ai]),Kn=new v(Ei),Fi=new d.cG($i,Pi);for(const lt in ze){const bi=ze[lt];bi instanceof d.a9?(E(bi.layers,this.zoom,ie),d.cH({bucket:bi,glyphMap:Ei,glyphPositions:Kn.positions,imageMap:$i,imagePositions:Fi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:rt.subdivisionGranularity})):bi.hasDependencies&&(bi instanceof d.cI||bi instanceof d.cJ||bi instanceof d.cK)&&(E(bi.layers,this.zoom,ie),bi.addFeatures(rt,this.tileID.canonical,Fi.patternPositions,Li))}return this.status="done",{buckets:Object.values(ze).filter((lt=>!lt.isEmpty())),featureIndex:Ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Kn.image,imageAtlas:Fi,dashPositions:Li,glyphMap:this.returnDependencies?Ei:null,iconMap:this.returnDependencies?$i:null,glyphPositions:this.returnDependencies?Kn.positions:null}}))}}function E(Le,K,J){const ie=new d.F(K);for(const we of Le)we.recalculate(ie,J)}class k{constructor(K,J,ie){this.actor=K,this.layerIndex=J,this.availableImages=ie,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(K,J){return d._(this,void 0,void 0,(function*(){const ie=yield d.n(K.request,J);try{return{vectorTile:new d.cL(new d.cM(ie.data)),rawData:ie.data,cacheControl:ie.cacheControl,expires:ie.expires}}catch(we){const Ce=new Uint8Array(ie.data);let Fe=`Unable to parse the tile at ${K.request.url}, `;throw Fe+=Ce[0]===31&&Ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${we.message}`,new Error(Fe)}}))}loadTile(K){return d._(this,void 0,void 0,(function*(){const J=K.uid,ie=!!(K&&K.request&&K.request.collectResourceTiming)&&new d.cN(K.request),we=new A(K);this.loading[J]=we;const Ce=new AbortController;we.abort=Ce;try{const Fe=yield this.loadVectorTile(K,Ce);if(delete this.loading[J],!Fe)return null;const Ke=Fe.rawData,ze={};Fe.expires&&(ze.expires=Fe.expires),Fe.cacheControl&&(ze.cacheControl=Fe.cacheControl);const rt={};if(ie){const at=ie.finish();at&&(rt.resourceTiming=JSON.parse(JSON.stringify(at)))}we.vectorTile=Fe.vectorTile;const mt=we.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);this.loaded[J]=we,this.fetching[J]={rawTileData:Ke,cacheControl:ze,resourceTiming:rt};try{const at=yield mt;return d.e({rawTileData:Ke.slice(0)},at,ze,rt)}finally{delete this.fetching[J]}}catch(Fe){throw delete this.loading[J],we.status="done",this.loaded[J]=we,Fe}}))}reloadTile(K){return d._(this,void 0,void 0,(function*(){const J=K.uid;if(!this.loaded||!this.loaded[J])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ie=this.loaded[J];if(ie.showCollisionBoxes=K.showCollisionBoxes,ie.status==="parsing"){const we=yield ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);let Ce;if(this.fetching[J]){const{rawTileData:Fe,cacheControl:Ke,resourceTiming:ze}=this.fetching[J];delete this.fetching[J],Ce=d.e({rawTileData:Fe.slice(0)},we,Ke,ze)}else Ce=we;return Ce}if(ie.status==="done"&&ie.vectorTile)return ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity)}))}abortTile(K){return d._(this,void 0,void 0,(function*(){const J=this.loading,ie=K.uid;J&&J[ie]&&J[ie].abort&&(J[ie].abort.abort(),delete J[ie])}))}removeTile(K){return d._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[K.uid]&&delete this.loaded[K.uid]}))}}class L{constructor(){this.loaded={}}loadTile(K){return d._(this,void 0,void 0,(function*(){const{uid:J,encoding:ie,rawImageData:we,redFactor:Ce,greenFactor:Fe,blueFactor:Ke,baseShift:ze}=K,rt=we.width+2,mt=we.height+2,at=d.b(we)?new d.R({width:rt,height:mt},yield d.cO(we,-1,-1,rt,mt)):we,zt=new d.cP(J,at,ie,Ce,Fe,Ke,ze);return this.loaded=this.loaded||{},this.loaded[J]=zt,zt}))}removeTile(K){const J=this.loaded,ie=K.uid;J&&J[ie]&&delete J[ie]}}var z,q,Y=(function(){if(q)return z;function Le(J,ie){if(J.length!==0){K(J[0],ie);for(var we=1;we<J.length;we++)K(J[we],!ie)}}function K(J,ie){for(var we=0,Ce=0,Fe=0,Ke=J.length,ze=Ke-1;Fe<Ke;ze=Fe++){var rt=(J[Fe][0]-J[ze][0])*(J[ze][1]+J[Fe][1]),mt=we+rt;Ce+=Math.abs(we)>=Math.abs(rt)?we-mt+rt:rt-mt+we,we=mt}we+Ce>=0!=!!ie&&J.reverse()}return q=1,z=function J(ie,we){var Ce,Fe=ie&&ie.type;if(Fe==="FeatureCollection")for(Ce=0;Ce<ie.features.length;Ce++)J(ie.features[Ce],we);else if(Fe==="GeometryCollection")for(Ce=0;Ce<ie.geometries.length;Ce++)J(ie.geometries[Ce],we);else if(Fe==="Feature")J(ie.geometry,we);else if(Fe==="Polygon")Le(ie.coordinates,we);else if(Fe==="MultiPolygon")for(Ce=0;Ce<ie.coordinates.length;Ce++)Le(ie.coordinates[Ce],we);return ie}})(),ne=d.cQ(Y);class ue extends d.cS{constructor(K,J){super(new d.cM,0,J,[],[]),this.feature=K,this.type=K.type,this.properties=K.tags?K.tags:{},"id"in K&&(typeof K.id=="string"?this.id=parseInt(K.id,10):typeof K.id!="number"||isNaN(K.id)||(this.id=K.id))}loadGeometry(){const K=[],J=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const ie of J){const we=[];for(const Ce of ie)we.push(new d.P(Ce[0],Ce[1]));K.push(we)}return K}}class ve extends d.cR{constructor(K,J){super(new d.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=J?J.version:1,this.extent=J?J.extent:4096,this.length=K.length,this.features=K}feature(K){return new ue(this.features[K],this.extent)}}function se(Le,K){K.writeVarintField(15,Le.version||1),K.writeStringField(1,Le.name||""),K.writeVarintField(5,Le.extent||4096);const J={keys:[],values:[],keycache:{},valuecache:{}};for(let Ce=0;Ce<Le.length;Ce++)J.feature=Le.feature(Ce),K.writeMessage(2,Se,J);const ie=J.keys;for(const Ce of ie)K.writeStringField(3,Ce);const we=J.values;for(const Ce of we)K.writeMessage(4,vt,Ce)}function Se(Le,K){if(!Le.feature)return;const J=Le.feature;J.id!==void 0&&K.writeVarintField(1,J.id),K.writeMessage(2,Ne,Le),K.writeVarintField(3,J.type),K.writeMessage(4,gt,J)}function Ne(Le,K){for(const J in Le.feature?.properties){let ie=Le.feature.properties[J],we=Le.keycache[J];if(ie===null)continue;we===void 0&&(Le.keys.push(J),we=Le.keys.length-1,Le.keycache[J]=we),K.writeVarint(we),typeof ie!="string"&&typeof ie!="boolean"&&typeof ie!="number"&&(ie=JSON.stringify(ie));const Ce=typeof ie+":"+ie;let Fe=Le.valuecache[Ce];Fe===void 0&&(Le.values.push(ie),Fe=Le.values.length-1,Le.valuecache[Ce]=Fe),K.writeVarint(Fe)}}function nt(Le,K){return(K<<3)+(7&Le)}function dt(Le){return Le<<1^Le>>31}function gt(Le,K){const J=Le.loadGeometry(),ie=Le.type;let we=0,Ce=0;for(const Fe of J){let Ke=1;ie===1&&(Ke=Fe.length),K.writeVarint(nt(1,Ke));const ze=ie===3?Fe.length-1:Fe.length;for(let rt=0;rt<ze;rt++){rt===1&&ie!==1&&K.writeVarint(nt(2,ze-1));const mt=Fe[rt].x-we,at=Fe[rt].y-Ce;K.writeVarint(dt(mt)),K.writeVarint(dt(at)),we+=mt,Ce+=at}Le.type===3&&K.writeVarint(nt(7,1))}}function vt(Le,K){const J=typeof Le;J==="string"?K.writeStringField(1,Le):J==="boolean"?K.writeBooleanField(7,Le):J==="number"&&(Le%1!=0?K.writeDoubleField(3,Le):Le<0?K.writeSVarintField(6,Le):K.writeVarintField(5,Le))}const Ft={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Le=>Le},Wt=Math.fround||(pn=new Float32Array(1),Le=>(pn[0]=+Le,pn[0]));var pn;class sn{constructor(K){this.options=Object.assign(Object.create(Ft),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:J,minZoom:ie,maxZoom:we}=this.options;J&&console.time("total time");const Ce=`prepare ${K.length} points`;J&&console.time(Ce),this.points=K;const Fe=[];for(let ze=0;ze<K.length;ze++){const rt=K[ze];if(!rt.geometry)continue;const[mt,at]=rt.geometry.coordinates,zt=Wt(Pe(mt)),Be=Wt(ke(at));Fe.push(zt,Be,1/0,ze,-1,1),this.options.reduce&&Fe.push(0)}let Ke=this.trees[we+1]=this._createTree(Fe);J&&console.timeEnd(Ce);for(let ze=we;ze>=ie;ze--){const rt=+Date.now();Ke=this.trees[ze]=this._createTree(this._cluster(Ke,ze)),J&&console.log("z%d: %d clusters in %dms",ze,Ke.numItems,+Date.now()-rt)}return J&&console.timeEnd("total time"),this}getClusters(K,J){let ie=((K[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,K[1]));let Ce=K[2]===180?180:((K[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)ie=-180,Ce=180;else if(ie>Ce){const at=this.getClusters([ie,we,180,Fe],J),zt=this.getClusters([-180,we,Ce,Fe],J);return at.concat(zt)}const Ke=this.trees[this._limitZoom(J)],ze=Ke.range(Pe(ie),ke(Fe),Pe(Ce),ke(we)),rt=Ke.data,mt=[];for(const at of ze){const zt=this.stride*at;mt.push(rt[zt+5]>1?rn(rt,zt,this.clusterProps):this.points[rt[zt+3]])}return mt}getChildren(K){const J=this._getOriginId(K),ie=this._getOriginZoom(K),we="No cluster with the specified id.",Ce=this.trees[ie];if(!Ce)throw new Error(we);const Fe=Ce.data;if(J*this.stride>=Fe.length)throw new Error(we);const Ke=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),ze=Ce.within(Fe[J*this.stride],Fe[J*this.stride+1],Ke),rt=[];for(const mt of ze){const at=mt*this.stride;Fe[at+4]===K&&rt.push(Fe[at+5]>1?rn(Fe,at,this.clusterProps):this.points[Fe[at+3]])}if(rt.length===0)throw new Error(we);return rt}getLeaves(K,J,ie){const we=[];return this._appendLeaves(we,K,J=J||10,ie=ie||0,0),we}getTile(K,J,ie){const we=this.trees[this._limitZoom(K)],Ce=Math.pow(2,K),{extent:Fe,radius:Ke}=this.options,ze=Ke/Fe,rt=(ie-ze)/Ce,mt=(ie+1+ze)/Ce,at={features:[]};return this._addTileFeatures(we.range((J-ze)/Ce,rt,(J+1+ze)/Ce,mt),we.data,J,ie,Ce,at),J===0&&this._addTileFeatures(we.range(1-ze/Ce,rt,1,mt),we.data,Ce,ie,Ce,at),J===Ce-1&&this._addTileFeatures(we.range(0,rt,ze/Ce,mt),we.data,-1,ie,Ce,at),at.features.length?at:null}getClusterExpansionZoom(K){let J=this._getOriginZoom(K)-1;for(;J<=this.options.maxZoom;){const ie=this.getChildren(K);if(J++,ie.length!==1)break;K=ie[0].properties.cluster_id}return J}_appendLeaves(K,J,ie,we,Ce){const Fe=this.getChildren(J);for(const Ke of Fe){const ze=Ke.properties;if(ze&&ze.cluster?Ce+ze.point_count<=we?Ce+=ze.point_count:Ce=this._appendLeaves(K,ze.cluster_id,ie,we,Ce):Ce<we?Ce++:K.push(Ke),K.length===ie)break}return Ce}_createTree(K){const J=new d.aI(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<K.length;ie+=this.stride)J.add(K[ie],K[ie+1]);return J.finish(),J.data=K,J}_addTileFeatures(K,J,ie,we,Ce,Fe){for(const Ke of K){const ze=Ke*this.stride,rt=J[ze+5]>1;let mt,at,zt;if(rt)mt=kn(J,ze,this.clusterProps),at=J[ze],zt=J[ze+1];else{const Dn=this.points[J[ze+3]];mt=Dn.properties;const[Xt,yn]=Dn.geometry.coordinates;at=Pe(Xt),zt=ke(yn)}const Be={type:1,geometry:[[Math.round(this.options.extent*(at*Ce-ie)),Math.round(this.options.extent*(zt*Ce-we))]],tags:mt};let un;un=rt||this.options.generateId?J[ze+3]:this.points[J[ze+3]].id,un!==void 0&&(Be.id=un),Fe.features.push(Be)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,J){const{radius:ie,extent:we,reduce:Ce,minPoints:Fe}=this.options,Ke=ie/(we*Math.pow(2,J)),ze=K.data,rt=[],mt=this.stride;for(let at=0;at<ze.length;at+=mt){if(ze[at+2]<=J)continue;ze[at+2]=J;const zt=ze[at],Be=ze[at+1],un=K.within(ze[at],ze[at+1],Ke),Dn=ze[at+5];let Xt=Dn;for(const yn of un){const ai=yn*mt;ze[ai+2]>J&&(Xt+=ze[ai+5])}if(Xt>Dn&&Xt>=Fe){let yn,ai=zt*Dn,Ei=Be*Dn,$i=-1;const Pi=(at/mt<<5)+(J+1)+this.points.length;for(const Li of un){const Kn=Li*mt;if(ze[Kn+2]<=J)continue;ze[Kn+2]=J;const Fi=ze[Kn+5];ai+=ze[Kn]*Fi,Ei+=ze[Kn+1]*Fi,ze[Kn+4]=Pi,Ce&&(yn||(yn=this._map(ze,at,!0),$i=this.clusterProps.length,this.clusterProps.push(yn)),Ce(yn,this._map(ze,Kn)))}ze[at+4]=Pi,rt.push(ai/Xt,Ei/Xt,1/0,Pi,-1,Xt),Ce&&rt.push($i)}else{for(let yn=0;yn<mt;yn++)rt.push(ze[at+yn]);if(Xt>1)for(const yn of un){const ai=yn*mt;if(!(ze[ai+2]<=J)){ze[ai+2]=J;for(let Ei=0;Ei<mt;Ei++)rt.push(ze[ai+Ei])}}}}return rt}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,J,ie){if(K[J+5]>1){const Fe=this.clusterProps[K[J+6]];return ie?Object.assign({},Fe):Fe}const we=this.points[K[J+3]].properties,Ce=this.options.map(we);return ie&&Ce===we?Object.assign({},Ce):Ce}}function rn(Le,K,J){return{type:"Feature",id:Le[K+3],properties:kn(Le,K,J),geometry:{type:"Point",coordinates:[(ie=Le[K],360*(ie-.5)),ge(Le[K+1])]}};var ie}function kn(Le,K,J){const ie=Le[K+5],we=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,Ce=Le[K+6],Fe=Ce===-1?{}:Object.assign({},J[Ce]);return Object.assign(Fe,{cluster:!0,cluster_id:Le[K+3],point_count:ie,point_count_abbreviated:we})}function Pe(Le){return Le/360+.5}function ke(Le){const K=Math.sin(Le*Math.PI/180),J=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return J<0?0:J>1?1:J}function ge(Le){const K=(180-360*Le)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function Ue(Le,K,J,ie){let we=ie;const Ce=K+(J-K>>1);let Fe,Ke=J-K;const ze=Le[K],rt=Le[K+1],mt=Le[J],at=Le[J+1];for(let zt=K+3;zt<J;zt+=3){const Be=$e(Le[zt],Le[zt+1],ze,rt,mt,at);if(Be>we)Fe=zt,we=Be;else if(Be===we){const un=Math.abs(zt-Ce);un<Ke&&(Fe=zt,Ke=un)}}we>ie&&(Fe-K>3&&Ue(Le,K,Fe,ie),Le[Fe+2]=we,J-Fe>3&&Ue(Le,Fe,J,ie))}function $e(Le,K,J,ie,we,Ce){let Fe=we-J,Ke=Ce-ie;if(Fe!==0||Ke!==0){const ze=((Le-J)*Fe+(K-ie)*Ke)/(Fe*Fe+Ke*Ke);ze>1?(J=we,ie=Ce):ze>0&&(J+=Fe*ze,ie+=Ke*ze)}return Fe=Le-J,Ke=K-ie,Fe*Fe+Ke*Ke}function de(Le,K,J,ie){const we={id:Le??null,type:K,geometry:J,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(K==="Point"||K==="MultiPoint"||K==="LineString")De(we,J);else if(K==="Polygon")De(we,J[0]);else if(K==="MultiLineString")for(const Ce of J)De(we,Ce);else if(K==="MultiPolygon")for(const Ce of J)De(we,Ce[0]);return we}function De(Le,K){for(let J=0;J<K.length;J+=3)Le.minX=Math.min(Le.minX,K[J]),Le.minY=Math.min(Le.minY,K[J+1]),Le.maxX=Math.max(Le.maxX,K[J]),Le.maxY=Math.max(Le.maxY,K[J+1])}function ut(Le,K,J,ie){if(!K.geometry)return;const we=K.geometry.coordinates;if(we&&we.length===0)return;const Ce=K.geometry.type,Fe=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let Ke=[],ze=K.id;if(J.promoteId?ze=K.properties[J.promoteId]:J.generateId&&(ze=ie||0),Ce==="Point")Et(we,Ke);else if(Ce==="MultiPoint")for(const rt of we)Et(rt,Ke);else if(Ce==="LineString")It(we,Ke,Fe,!1);else if(Ce==="MultiLineString"){if(J.lineMetrics){for(const rt of we)Ke=[],It(rt,Ke,Fe,!1),Le.push(de(ze,"LineString",Ke,K.properties));return}$t(we,Ke,Fe,!1)}else if(Ce==="Polygon")$t(we,Ke,Fe,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const rt of K.geometry.geometries)ut(Le,{id:ze,geometry:rt,properties:K.properties},J,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const rt of we){const mt=[];$t(rt,mt,Fe,!0),Ke.push(mt)}}Le.push(de(ze,Ce,Ke,K.properties))}function Et(Le,K){K.push(Qt(Le[0]),Ut(Le[1]),0)}function It(Le,K,J,ie){let we,Ce,Fe=0;for(let ze=0;ze<Le.length;ze++){const rt=Qt(Le[ze][0]),mt=Ut(Le[ze][1]);K.push(rt,mt,0),ze>0&&(Fe+=ie?(we*mt-rt*Ce)/2:Math.sqrt(Math.pow(rt-we,2)+Math.pow(mt-Ce,2))),we=rt,Ce=mt}const Ke=K.length-3;K[2]=1,Ue(K,0,Ke,J),K[Ke+2]=1,K.size=Math.abs(Fe),K.start=0,K.end=K.size}function $t(Le,K,J,ie){for(let we=0;we<Le.length;we++){const Ce=[];It(Le[we],Ce,J,ie),K.push(Ce)}}function Qt(Le){return Le/360+.5}function Ut(Le){const K=Math.sin(Le*Math.PI/180),J=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return J<0?0:J>1?1:J}function an(Le,K,J,ie,we,Ce,Fe,Ke){if(ie/=K,Ce>=(J/=K)&&Fe<ie)return Le;if(Fe<J||Ce>=ie)return null;const ze=[];for(const rt of Le){const mt=rt.geometry;let at=rt.type;const zt=we===0?rt.minX:rt.minY,Be=we===0?rt.maxX:rt.maxY;if(zt>=J&&Be<ie){ze.push(rt);continue}if(Be<J||zt>=ie)continue;let un=[];if(at==="Point"||at==="MultiPoint")_n(mt,un,J,ie,we);else if(at==="LineString")Gi(mt,un,J,ie,we,!1,Ke.lineMetrics);else if(at==="MultiLineString")Hn(mt,un,J,ie,we,!1);else if(at==="Polygon")Hn(mt,un,J,ie,we,!0);else if(at==="MultiPolygon")for(const Dn of mt){const Xt=[];Hn(Dn,Xt,J,ie,we,!0),Xt.length&&un.push(Xt)}if(un.length){if(Ke.lineMetrics&&at==="LineString"){for(const Dn of un)ze.push(de(rt.id,at,Dn,rt.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(un.length===1?(at="LineString",un=un[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=un.length===3?"Point":"MultiPoint"),ze.push(de(rt.id,at,un,rt.tags))}}return ze.length?ze:null}function _n(Le,K,J,ie,we){for(let Ce=0;Ce<Le.length;Ce+=3){const Fe=Le[Ce+we];Fe>=J&&Fe<=ie&&ri(K,Le[Ce],Le[Ce+1],Le[Ce+2])}}function Gi(Le,K,J,ie,we,Ce,Fe){let Ke=Ii(Le);const ze=we===0?xt:Pt;let rt,mt,at=Le.start;for(let Xt=0;Xt<Le.length-3;Xt+=3){const yn=Le[Xt],ai=Le[Xt+1],Ei=Le[Xt+2],$i=Le[Xt+3],Pi=Le[Xt+4],Li=we===0?yn:ai,Kn=we===0?$i:Pi;let Fi=!1;Fe&&(rt=Math.sqrt(Math.pow(yn-$i,2)+Math.pow(ai-Pi,2))),Li<J?Kn>J&&(mt=ze(Ke,yn,ai,$i,Pi,J),Fe&&(Ke.start=at+rt*mt)):Li>ie?Kn<ie&&(mt=ze(Ke,yn,ai,$i,Pi,ie),Fe&&(Ke.start=at+rt*mt)):ri(Ke,yn,ai,Ei),Kn<J&&Li>=J&&(mt=ze(Ke,yn,ai,$i,Pi,J),Fi=!0),Kn>ie&&Li<=ie&&(mt=ze(Ke,yn,ai,$i,Pi,ie),Fi=!0),!Ce&&Fi&&(Fe&&(Ke.end=at+rt*mt),K.push(Ke),Ke=Ii(Le)),Fe&&(at+=rt)}let zt=Le.length-3;const Be=Le[zt],un=Le[zt+1],Dn=we===0?Be:un;Dn>=J&&Dn<=ie&&ri(Ke,Be,un,Le[zt+2]),zt=Ke.length-3,Ce&&zt>=3&&(Ke[zt]!==Ke[0]||Ke[zt+1]!==Ke[1])&&ri(Ke,Ke[0],Ke[1],Ke[2]),Ke.length&&K.push(Ke)}function Ii(Le){const K=[];return K.size=Le.size,K.start=Le.start,K.end=Le.end,K}function Hn(Le,K,J,ie,we,Ce){for(const Fe of Le)Gi(Fe,K,J,ie,we,Ce,!1)}function ri(Le,K,J,ie){Le.push(K,J,ie)}function xt(Le,K,J,ie,we,Ce){const Fe=(Ce-K)/(ie-K);return ri(Le,Ce,J+(we-J)*Fe,1),Fe}function Pt(Le,K,J,ie,we,Ce){const Fe=(Ce-J)/(we-J);return ri(Le,K+(ie-K)*Fe,Ce,1),Fe}function Yt(Le,K){const J=[];for(let ie=0;ie<Le.length;ie++){const we=Le[ie],Ce=we.type;let Fe;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")Fe=Sn(we.geometry,K);else if(Ce==="MultiLineString"||Ce==="Polygon"){Fe=[];for(const Ke of we.geometry)Fe.push(Sn(Ke,K))}else if(Ce==="MultiPolygon"){Fe=[];for(const Ke of we.geometry){const ze=[];for(const rt of Ke)ze.push(Sn(rt,K));Fe.push(ze)}}J.push(de(we.id,Ce,Fe,we.tags))}return J}function Sn(Le,K){const J=[];J.size=Le.size,Le.start!==void 0&&(J.start=Le.start,J.end=Le.end);for(let ie=0;ie<Le.length;ie+=3)J.push(Le[ie]+K,Le[ie+1],Le[ie+2]);return J}function Nn(Le,K){if(Le.transformed)return Le;const J=1<<Le.z,ie=Le.x,we=Le.y;for(const Ce of Le.features){const Fe=Ce.geometry,Ke=Ce.type;if(Ce.geometry=[],Ke===1)for(let ze=0;ze<Fe.length;ze+=2)Ce.geometry.push(Yn(Fe[ze],Fe[ze+1],K,J,ie,we));else for(let ze=0;ze<Fe.length;ze++){const rt=[];for(let mt=0;mt<Fe[ze].length;mt+=2)rt.push(Yn(Fe[ze][mt],Fe[ze][mt+1],K,J,ie,we));Ce.geometry.push(rt)}}return Le.transformed=!0,Le}function Yn(Le,K,J,ie,we,Ce){return[Math.round(J*(Le*ie-we)),Math.round(J*(K*ie-Ce))]}function yi(Le,K,J,ie,we){const Ce=K===we.maxZoom?0:we.tolerance/((1<<K)*we.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:Le.length,source:null,x:J,y:ie,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ke of Le)hs(Fe,Ke,Ce,we);return Fe}function hs(Le,K,J,ie){const we=K.geometry,Ce=K.type,Fe=[];if(Le.minX=Math.min(Le.minX,K.minX),Le.minY=Math.min(Le.minY,K.minY),Le.maxX=Math.max(Le.maxX,K.maxX),Le.maxY=Math.max(Le.maxY,K.maxY),Ce==="Point"||Ce==="MultiPoint")for(let Ke=0;Ke<we.length;Ke+=3)Fe.push(we[Ke],we[Ke+1]),Le.numPoints++,Le.numSimplified++;else if(Ce==="LineString")Es(Fe,we,Le,J,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let Ke=0;Ke<we.length;Ke++)Es(Fe,we[Ke],Le,J,Ce==="Polygon",Ke===0);else if(Ce==="MultiPolygon")for(let Ke=0;Ke<we.length;Ke++){const ze=we[Ke];for(let rt=0;rt<ze.length;rt++)Es(Fe,ze[rt],Le,J,!0,rt===0)}if(Fe.length){let Ke=K.tags||null;if(Ce==="LineString"&&ie.lineMetrics){Ke={};for(const rt in K.tags)Ke[rt]=K.tags[rt];Ke.mapbox_clip_start=we.start/we.size,Ke.mapbox_clip_end=we.end/we.size}const ze={geometry:Fe,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Ke};K.id!==null&&(ze.id=K.id),Le.features.push(ze)}}function Es(Le,K,J,ie,we,Ce){const Fe=ie*ie;if(ie>0&&K.size<(we?Fe:ie))return void(J.numPoints+=K.length/3);const Ke=[];for(let ze=0;ze<K.length;ze+=3)(ie===0||K[ze+2]>Fe)&&(J.numSimplified++,Ke.push(K[ze],K[ze+1])),J.numPoints++;we&&(function(ze,rt){let mt=0;for(let at=0,zt=ze.length,Be=zt-2;at<zt;Be=at,at+=2)mt+=(ze[at]-ze[Be])*(ze[at+1]+ze[Be+1]);if(mt>0===rt)for(let at=0,zt=ze.length;at<zt/2;at+=2){const Be=ze[at],un=ze[at+1];ze[at]=ze[zt-2-at],ze[at+1]=ze[zt-1-at],ze[zt-2-at]=Be,ze[zt-1-at]=un}})(Ke,Ce),Le.push(Ke)}const ds={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Kr{constructor(K,J){const ie=(J=this.options=(function(Ce,Fe){for(const Ke in Fe)Ce[Ke]=Fe[Ke];return Ce})(Object.create(ds),J)).debug;if(ie&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let we=(function(Ce,Fe){const Ke=[];if(Ce.type==="FeatureCollection")for(let ze=0;ze<Ce.features.length;ze++)ut(Ke,Ce.features[ze],Fe,ze);else ut(Ke,Ce.type==="Feature"?Ce:{geometry:Ce},Fe);return Ke})(K,J);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),we=(function(Ce,Fe){const Ke=Fe.buffer/Fe.extent;let ze=Ce;const rt=an(Ce,1,-1-Ke,Ke,0,-1,2,Fe),mt=an(Ce,1,1-Ke,2+Ke,0,-1,2,Fe);return(rt||mt)&&(ze=an(Ce,1,-Ke,1+Ke,0,-1,2,Fe)||[],rt&&(ze=Yt(rt,1).concat(ze)),mt&&(ze=ze.concat(Yt(mt,-1)))),ze})(we,J),we.length&&this.splitTile(we,0,0,0),ie&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(K,J,ie,we,Ce,Fe,Ke){const ze=[K,J,ie,we],rt=this.options,mt=rt.debug;for(;ze.length;){we=ze.pop(),ie=ze.pop(),J=ze.pop(),K=ze.pop();const at=1<<J,zt=Zs(J,ie,we);let Be=this.tiles[zt];if(!Be&&(mt>1&&console.time("creation"),Be=this.tiles[zt]=yi(K,J,ie,we,rt),this.tileCoords.push({z:J,x:ie,y:we}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,ie,we,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));const Fi=`z${J}`;this.stats[Fi]=(this.stats[Fi]||0)+1,this.total++}if(Be.source=K,Ce==null){if(J===rt.indexMaxZoom||Be.numPoints<=rt.indexMaxPoints)continue}else{if(J===rt.maxZoom||J===Ce)continue;if(Ce!=null){const Fi=Ce-J;if(ie!==Fe>>Fi||we!==Ke>>Fi)continue}}if(Be.source=null,K.length===0)continue;mt>1&&console.time("clipping");const un=.5*rt.buffer/rt.extent,Dn=.5-un,Xt=.5+un,yn=1+un;let ai=null,Ei=null,$i=null,Pi=null,Li=an(K,at,ie-un,ie+Xt,0,Be.minX,Be.maxX,rt),Kn=an(K,at,ie+Dn,ie+yn,0,Be.minX,Be.maxX,rt);K=null,Li&&(ai=an(Li,at,we-un,we+Xt,1,Be.minY,Be.maxY,rt),Ei=an(Li,at,we+Dn,we+yn,1,Be.minY,Be.maxY,rt),Li=null),Kn&&($i=an(Kn,at,we-un,we+Xt,1,Be.minY,Be.maxY,rt),Pi=an(Kn,at,we+Dn,we+yn,1,Be.minY,Be.maxY,rt),Kn=null),mt>1&&console.timeEnd("clipping"),ze.push(ai||[],J+1,2*ie,2*we),ze.push(Ei||[],J+1,2*ie,2*we+1),ze.push($i||[],J+1,2*ie+1,2*we),ze.push(Pi||[],J+1,2*ie+1,2*we+1)}}getTile(K,J,ie){K=+K,J=+J,ie=+ie;const we=this.options,{extent:Ce,debug:Fe}=we;if(K<0||K>24)return null;const Ke=1<<K,ze=Zs(K,J=J+Ke&Ke-1,ie);if(this.tiles[ze])return Nn(this.tiles[ze],Ce);Fe>1&&console.log("drilling down to z%d-%d-%d",K,J,ie);let rt,mt=K,at=J,zt=ie;for(;!rt&&mt>0;)mt--,at>>=1,zt>>=1,rt=this.tiles[Zs(mt,at,zt)];return rt&&rt.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",mt,at,zt),console.time("drilling down")),this.splitTile(rt.source,mt,at,zt,K,J,ie),Fe>1&&console.timeEnd("drilling down"),this.tiles[ze]?Nn(this.tiles[ze],Ce):null):null}}function Zs(Le,K,J){return 32*((1<<Le)*J+K)+Le}class Jr extends k{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(K,J){return d._(this,void 0,void 0,(function*(){const ie=K.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const we=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!we)return null;const Ce=new ve(we.features,{version:2,extent:d.$});let Fe=(function(Ke){const ze=new d.cM;return(function(rt,mt){for(const at in rt.layers)mt.writeMessage(3,se,rt.layers[at])})(Ke,ze),ze.finish()})(Ce);return Fe.byteOffset===0&&Fe.byteLength===Fe.buffer.byteLength||(Fe=new Uint8Array(Fe)),{vectorTile:Ce,rawData:Fe.buffer}}))}loadData(K){return d._(this,void 0,void 0,(function*(){var J;(J=this._pendingRequest)===null||J===void 0||J.abort();const ie=!!(K&&K.request&&K.request.collectResourceTiming)&&new d.cN(K.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(K,this._pendingRequest);const we=yield this._pendingData;this._geoJSONIndex=K.cluster?new sn((function({superclusterOptions:Fe,clusterProperties:Ke}){if(!Ke||!Fe)return Fe;const ze={},rt={},mt={accumulated:null,zoom:0},at={properties:null},zt=Object.keys(Ke);for(const Be of zt){const[un,Dn]=Ke[Be],Xt=d.cT(Dn),yn=d.cT(typeof un=="string"?[un,["accumulated"],["get",Be]]:un);ze[Be]=Xt.value,rt[Be]=yn.value}return Fe.map=Be=>{at.properties=Be;const un={};for(const Dn of zt)un[Dn]=ze[Dn].evaluate(mt,at);return un},Fe.reduce=(Be,un)=>{at.properties=un;for(const Dn of zt)mt.accumulated=Be[Dn],Be[Dn]=rt[Dn].evaluate(mt,at)},Fe})(K)).load(we.features):(function(Fe,Ke){return new Kr(Fe,Ke)})(we,K.geojsonVtOptions),this.loaded={};const Ce={data:we};if(ie){const Fe=ie.finish();Fe&&(Ce.resourceTiming={},Ce.resourceTiming[K.source]=JSON.parse(JSON.stringify(Fe)))}return Ce}catch(we){if(delete this._pendingRequest,d.cy(we))return{abandoned:!0};throw we}}))}getData(){return d._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(K){const J=this.loaded;return J&&J[K.uid]?super.reloadTile(K):this.loadTile(K)}loadAndProcessGeoJSON(K,J){return d._(this,void 0,void 0,(function*(){let ie=yield this.loadGeoJSON(K,J);if(delete this._pendingRequest,typeof ie!="object")throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(ne(ie,!0),K.filter){const we=d.cT(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(we.result==="error")throw new Error(we.value.map((Fe=>`${Fe.key}: ${Fe.message}`)).join(", "));ie={type:"FeatureCollection",features:ie.features.filter((Fe=>we.value.evaluate({zoom:0},Fe)))}}return ie}))}loadGeoJSON(K,J){return d._(this,void 0,void 0,(function*(){const{promoteId:ie}=K;if(K.request){const we=yield d.j(K.request,J);return this._dataUpdateable=d.cV(we.data,ie)?d.cU(we.data,ie):void 0,we.data}if(typeof K.data=="string")try{const we=JSON.parse(K.data);return this._dataUpdateable=d.cV(we,ie)?d.cU(we,ie):void 0,we}catch{throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`)}if(!K.dataDiff)throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${K.source}`);return d.cW(this._dataUpdateable,K.dataDiff,ie),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(K){return d._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(K){return this._geoJSONIndex.getClusterExpansionZoom(K.clusterId)}getClusterChildren(K){return this._geoJSONIndex.getChildren(K.clusterId)}getClusterLeaves(K){return this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset)}}class Ps{constructor(K){this.self=K,this.actor=new d.J(K),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(J,ie)=>{if(this.externalWorkerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.externalWorkerSourceTypes[J]=ie},this.self.addProtocol=d.cA,this.self.removeProtocol=d.cB,this.self.registerRTLTextPlugin=J=>{d.cX.setMethods(J)},this.actor.registerMessageHandler("LDT",((J,ie)=>this._getDEMWorkerSource(J,ie.source).loadTile(ie))),this.actor.registerMessageHandler("RDT",((J,ie)=>d._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(J,ie.source).removeTile(ie)})))),this.actor.registerMessageHandler("GCEZ",((J,ie)=>d._(this,void 0,void 0,(function*(){return this._getWorkerSource(J,ie.type,ie.source).getClusterExpansionZoom(ie)})))),this.actor.registerMessageHandler("GCC",((J,ie)=>d._(this,void 0,void 0,(function*(){return this._getWorkerSource(J,ie.type,ie.source).getClusterChildren(ie)})))),this.actor.registerMessageHandler("GCL",((J,ie)=>d._(this,void 0,void 0,(function*(){return this._getWorkerSource(J,ie.type,ie.source).getClusterLeaves(ie)})))),this.actor.registerMessageHandler("LD",((J,ie)=>this._getWorkerSource(J,ie.type,ie.source).loadData(ie))),this.actor.registerMessageHandler("GD",((J,ie)=>this._getWorkerSource(J,ie.type,ie.source).getData())),this.actor.registerMessageHandler("LT",((J,ie)=>this._getWorkerSource(J,ie.type,ie.source).loadTile(ie))),this.actor.registerMessageHandler("RT",((J,ie)=>this._getWorkerSource(J,ie.type,ie.source).reloadTile(ie))),this.actor.registerMessageHandler("AT",((J,ie)=>this._getWorkerSource(J,ie.type,ie.source).abortTile(ie))),this.actor.registerMessageHandler("RMT",((J,ie)=>this._getWorkerSource(J,ie.type,ie.source).removeTile(ie))),this.actor.registerMessageHandler("RS",((J,ie)=>d._(this,void 0,void 0,(function*(){if(!this.workerSources[J]||!this.workerSources[J][ie.type]||!this.workerSources[J][ie.type][ie.source])return;const we=this.workerSources[J][ie.type][ie.source];delete this.workerSources[J][ie.type][ie.source],we.removeSource!==void 0&&we.removeSource(ie)})))),this.actor.registerMessageHandler("RM",(J=>d._(this,void 0,void 0,(function*(){delete this.layerIndexes[J],delete this.availableImages[J],delete this.workerSources[J],delete this.demWorkerSources[J],this.globalStates.delete(J)})))),this.actor.registerMessageHandler("SR",((J,ie)=>d._(this,void 0,void 0,(function*(){this.referrer=ie})))),this.actor.registerMessageHandler("SRPS",((J,ie)=>this._syncRTLPluginState(J,ie))),this.actor.registerMessageHandler("IS",((J,ie)=>d._(this,void 0,void 0,(function*(){this.self.importScripts(ie)})))),this.actor.registerMessageHandler("SI",((J,ie)=>this._setImages(J,ie))),this.actor.registerMessageHandler("UL",((J,ie)=>d._(this,void 0,void 0,(function*(){this._getLayerIndex(J).update(ie.layers,ie.removedIds,this._getGlobalState(J))})))),this.actor.registerMessageHandler("UGS",((J,ie)=>d._(this,void 0,void 0,(function*(){const we=this._getGlobalState(J);for(const Ce in ie)we[Ce]=ie[Ce]})))),this.actor.registerMessageHandler("SL",((J,ie)=>d._(this,void 0,void 0,(function*(){this._getLayerIndex(J).replace(ie,this._getGlobalState(J))}))))}_getGlobalState(K){let J=this.globalStates.get(K);return J||(J={},this.globalStates.set(K,J)),J}_setImages(K,J){return d._(this,void 0,void 0,(function*(){this.availableImages[K]=J;for(const ie in this.workerSources[K]){const we=this.workerSources[K][ie];for(const Ce in we)we[Ce].availableImages=J}}))}_syncRTLPluginState(K,J){return d._(this,void 0,void 0,(function*(){return yield d.cX.syncState(J,this.self.importScripts)}))}_getAvailableImages(K){let J=this.availableImages[K];return J||(J=[]),J}_getLayerIndex(K){let J=this.layerIndexes[K];return J||(J=this.layerIndexes[K]=new a),J}_getWorkerSource(K,J,ie){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][J]||(this.workerSources[K][J]={}),!this.workerSources[K][J][ie]){const we={sendAsync:(Ce,Fe)=>(Ce.targetMapId=K,this.actor.sendAsync(Ce,Fe))};switch(J){case"vector":this.workerSources[K][J][ie]=new k(we,this._getLayerIndex(K),this._getAvailableImages(K));break;case"geojson":this.workerSources[K][J][ie]=new Jr(we,this._getLayerIndex(K),this._getAvailableImages(K));break;default:this.workerSources[K][J][ie]=new this.externalWorkerSourceTypes[J](we,this._getLayerIndex(K),this._getAvailableImages(K))}}return this.workerSources[K][J][ie]}_getDEMWorkerSource(K,J){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][J]||(this.demWorkerSources[K][J]=new L),this.demWorkerSources[K][J]}}return d.i(self)&&(self.worker=new Ps(self)),Ps})),o("index",["exports","./shared"],(function(d,a){var v="5.8.0";function A(){var x=new a.A(4);return a.A!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}let E,k;const L={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(x,r,h){const m=requestAnimationFrame((w=>{y(),r(w)})),{unsubscribe:y}=a.s(x.signal,"abort",(()=>{y(),cancelAnimationFrame(m),h(a.c())}),!1)},frameAsync(x){return new Promise(((r,h)=>{this.frame(x,r,h)}))},getImageData(x,r=0){return this.getImageCanvasContext(x).getImageData(-r,-r,x.width+2*r,x.height+2*r)},getImageCanvasContext(x){const r=window.document.createElement("canvas"),h=r.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return r.width=x.width,r.height=x.height,h.drawImage(x,0,0,x.width,x.height),h},resolveURL:x=>(E||(E=document.createElement("a")),E.href=x,E.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class z{static testProp(r){if(!z.docStyle)return r[0];for(let h=0;h<r.length;h++)if(r[h]in z.docStyle)return r[h];return r[0]}static create(r,h,m){const y=window.document.createElement(r);return h!==void 0&&(y.className=h),m&&m.appendChild(y),y}static createNS(r,h){return window.document.createElementNS(r,h)}static disableDrag(){z.docStyle&&z.selectProp&&(z.userSelect=z.docStyle[z.selectProp],z.docStyle[z.selectProp]="none")}static enableDrag(){z.docStyle&&z.selectProp&&(z.docStyle[z.selectProp]=z.userSelect)}static setTransform(r,h){r.style[z.transformProp]=h}static addEventListener(r,h,m,y={}){r.addEventListener(h,m,"passive"in y?y:y.capture)}static removeEventListener(r,h,m,y={}){r.removeEventListener(h,m,"passive"in y?y:y.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",z.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",z.suppressClickInternal,!0)}),0)}static getScale(r){const h=r.getBoundingClientRect();return{x:h.width/r.offsetWidth||1,y:h.height/r.offsetHeight||1,boundingClientRect:h}}static getPoint(r,h,m){const y=h.boundingClientRect;return new a.P((m.clientX-y.left)/h.x-r.clientLeft,(m.clientY-y.top)/h.y-r.clientTop)}static mousePos(r,h){const m=z.getScale(r);return z.getPoint(r,m,h)}static touchPos(r,h){const m=[],y=z.getScale(r);for(let w=0;w<h.length;w++)m.push(z.getPoint(r,y,h[w]));return m}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}static sanitize(r){const h=new DOMParser().parseFromString(r,"text/html").body||document.createElement("body"),m=h.querySelectorAll("script");for(const y of m)y.remove();return z.clean(h),h.innerHTML}static isPossiblyDangerous(r,h){const m=h.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(r)||!m.includes("javascript:")&&!m.includes("data:"))||!!r.startsWith("on")||void 0}static clean(r){const h=r.children;for(const m of h)z.removeAttributes(m),z.clean(m)}static removeAttributes(r){for(const{name:h,value:m}of r.attributes)z.isPossiblyDangerous(h,m)&&r.removeAttribute(h)}}z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,z.selectProp=z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),z.transformProp=z.testProp(["transform","WebkitTransform"]);const q={supported:!1,testSupport:function(x){!ue&&ne&&(ve?se(x):Y=x)}};let Y,ne,ue=!1,ve=!1;function se(x){const r=x.createTexture();x.bindTexture(x.TEXTURE_2D,r);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,ne),x.isContextLost())return;q.supported=!0}catch{}x.deleteTexture(r),ue=!0}var Se;typeof document<"u"&&(ne=document.createElement("img"),ne.onload=()=>{Y&&se(Y),Y=null,ve=!0},ne.onerror=()=>{ue=!0,Y=null},ne.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(x){let r,h,m,y;x.resetRequestQueue=()=>{r=[],h=0,m=0,y={}},x.addThrottleControl=D=>{const B=m++;return y[B]=D,B},x.removeThrottleControl=D=>{delete y[D],P()},x.getImage=(D,B,U=!0)=>new Promise(((W,$)=>{q.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),a.e(D,{type:"image"}),r.push({abortController:B,requestParameters:D,supportImageRefresh:U,state:"queued",onError:Z=>{$(Z)},onSuccess:Z=>{W(Z)}}),P()}));const w=D=>a._(this,void 0,void 0,(function*(){D.state="running";const{requestParameters:B,supportImageRefresh:U,onError:W,onSuccess:$,abortController:Z}=D,Q=U===!1&&!a.i(self)&&!a.g(B.url)&&(!B.headers||Object.keys(B.headers).reduce(((le,pe)=>le&&pe==="accept"),!0));h++;const re=Q?R(B,Z):a.m(B,Z);try{const le=yield re;delete D.abortController,D.state="completed",le.data instanceof HTMLImageElement||a.b(le.data)?$(le):le.data&&$({data:yield(ae=le.data,typeof createImageBitmap=="function"?a.f(ae):a.h(ae)),cacheControl:le.cacheControl,expires:le.expires})}catch(le){delete D.abortController,W(le)}finally{h--,P()}var ae})),P=()=>{const D=(()=>{for(const B of Object.keys(y))if(y[B]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let B=h;B<D&&r.length>0;B++){const U=r.shift();U.abortController.signal.aborted?B--:w(U)}},R=(D,B)=>new Promise(((U,W)=>{const $=new Image,Z=D.url,Q=D.credentials;Q&&Q==="include"?$.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!a.d(Z))&&($.crossOrigin="anonymous"),B.signal.addEventListener("abort",(()=>{$.src="",W(a.c())})),$.fetchPriority="high",$.onload=()=>{$.onerror=$.onload=null,U({data:$})},$.onerror=()=>{$.onerror=$.onload=null,B.signal.aborted||W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},$.src=Z}))})(Se||(Se={})),Se.resetRequestQueue();class Ne{constructor(r){this._transformRequestFn=r??null}transformRequest(r,h){return this._transformRequestFn&&this._transformRequestFn(r,h)||{url:r}}setTransformRequest(r){this._transformRequestFn=r}}function nt(x){const r=[];if(typeof x=="string")r.push({id:"default",url:x});else if(x&&x.length>0){const h=[];for(const{id:m,url:y}of x){const w=`${m}${y}`;h.indexOf(w)===-1&&(h.push(w),r.push({id:m,url:y}))}}return r}function dt(x,r,h){try{const m=new URL(x);return m.pathname+=`${r}${h}`,m.toString()}catch{throw new Error(`Invalid sprite URL "${x}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function gt(x){const{userImage:r}=x;return!!(r&&r.render&&r.render())&&(x.data.replace(new Uint8Array(r.data.buffer)),!0)}class vt extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:h,promiseResolve:m}of this.requestors)m(this._getImagesForIds(h));this.requestors=[]}}getImage(r){const h=this.images[r];if(h&&!h.data&&h.spriteData){const m=h.spriteData;h.data=new a.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),h.spriteData=null}return h}addImage(r,h){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,h)&&(this.images[r]=h)}_validate(r,h){let m=!0;const y=h.data||h.spriteData;return this._validateStretch(h.stretchX,y&&y.width)||(this.fire(new a.k(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(h.stretchY,y&&y.height)||(this.fire(new a.k(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(h.content,h)||(this.fire(new a.k(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,h){if(!r)return!0;let m=0;for(const y of r){if(y[0]<m||y[1]<y[0]||h<y[1])return!1;m=y[1]}return!0}_validateContent(r,h){if(!r)return!0;if(r.length!==4)return!1;const m=h.spriteData,y=m&&m.width||h.data.width,w=m&&m.height||h.data.height;return!(r[0]<0||y<r[0]||r[1]<0||w<r[1]||r[2]<0||y<r[2]||r[3]<0||w<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,h,m=!0){const y=this.getImage(r);if(m&&(y.data.width!==h.data.width||y.data.height!==h.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=y.version+1,this.images[r]=h,this.updatedImages[r]=!0}removeImage(r){const h=this.images[r];delete this.images[r],delete this.patterns[r],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise(((h,m)=>{let y=!0;if(!this.isLoaded())for(const w of r)this.images[w]||(y=!1);this.isLoaded()||y?h(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:h})}))}_getImagesForIds(r){const h={};for(const m of r){let y=this.getImage(m);y||(this.fire(new a.l("styleimagemissing",{id:m})),y=this.getImage(m)),y?h[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:a.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:r,height:h}=this.atlasImage;return{width:r,height:h}}getPattern(r){const h=this.patterns[r],m=this.getImage(r);if(!m)return null;if(h&&h.position.version===m.version)return h.position;if(h)h.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},w=new a.I(y,m);this.patterns[r]={bin:y,position:w}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const h=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.T(r,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const w in this.patterns)r.push(this.patterns[w].bin);const{w:h,h:m}=a.p(r),y=this.atlasImage;y.resize({width:h||1,height:m||1});for(const w in this.patterns){const{bin:P}=this.patterns[w],R=P.x+1,D=P.y+1,B=this.getImage(w).data,U=B.width,W=B.height;a.R.copy(B,y,{x:0,y:0},{x:R,y:D},{width:U,height:W}),a.R.copy(B,y,{x:0,y:W-1},{x:R,y:D-1},{width:U,height:1}),a.R.copy(B,y,{x:0,y:0},{x:R,y:D+W},{width:U,height:1}),a.R.copy(B,y,{x:U-1,y:0},{x:R-1,y:D},{width:1,height:W}),a.R.copy(B,y,{x:0,y:0},{x:R+U,y:D},{width:1,height:W})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const h of r){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const m=this.getImage(h);m||a.w(`Image with ID: "${h}" was not found`),gt(m)&&this.updateImage(h,m)}}}const Ft=1e20;function Wt(x,r,h,m,y,w,P,R,D){for(let B=r;B<r+m;B++)pn(x,h*w+B,w,y,P,R,D);for(let B=h;B<h+y;B++)pn(x,B*w+r,1,m,P,R,D)}function pn(x,r,h,m,y,w,P){w[0]=0,P[0]=-Ft,P[1]=Ft,y[0]=x[r];for(let R=1,D=0,B=0;R<m;R++){y[R]=x[r+R*h];const U=R*R;do{const W=w[D];B=(y[R]-y[W]+U-W*W)/(R-W)/2}while(B<=P[D]&&--D>-1);D++,w[D]=R,P[D]=B,P[D+1]=Ft}for(let R=0,D=0;R<m;R++){for(;P[D+1]<R;)D++;const B=w[D],U=R-B;x[r+R*h]=y[B]+U*U}}class sn{constructor(r,h,m){this.requestManager=r,this.localIdeographFontFamily=h,this.entries={},this.lang=m}setURL(r){this.url=r}getGlyphs(r){return a._(this,void 0,void 0,(function*(){const h=[];for(const w in r)for(const P of r[w])h.push(this._getAndCacheGlyphsPromise(w,P));const m=yield Promise.all(h),y={};for(const{stack:w,id:P,glyph:R}of m)y[w]||(y[w]={}),y[w][P]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return y}))}_getAndCacheGlyphsPromise(r,h){return a._(this,void 0,void 0,(function*(){let m=this.entries[r];m||(m=this.entries[r]={glyphs:{},requests:{},ranges:{}});let y=m.glyphs[h];if(y!==void 0)return{stack:r,id:h,glyph:y};if(y=this._tinySDF(m,r,h),y)return m.glyphs[h]=y,{stack:r,id:h,glyph:y};const w=Math.floor(h/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[w])return{stack:r,id:h,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[w]){const R=sn.loadGlyphRange(r,w,this.url,this.requestManager);m.requests[w]=R}const P=yield m.requests[w];for(const R in P)this._doesCharSupportLocalGlyph(+R)||(m.glyphs[+R]=P[+R]);return m.ranges[w]=!0,{stack:r,id:h,glyph:P[h]||null}}))}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(r))||a.u["CJK Unified Ideographs"](r)||a.u["Hangul Syllables"](r)||a.u.Hiragana(r)||a.u.Katakana(r)||a.u["CJK Symbols and Punctuation"](r)||a.u["Halfwidth and Fullwidth Forms"](r))}_tinySDF(r,h,m){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(m))return;let w=r.tinySDF;if(!w){let R="400";/bold/i.test(h)?R="900":/medium/i.test(h)?R="500":/light/i.test(h)&&(R="200"),w=r.tinySDF=new sn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:y,fontWeight:R})}const P=w.draw(String.fromCharCode(m));return{id:m,bitmap:new a.q({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}sn.loadGlyphRange=function(x,r,h,m){return a._(this,void 0,void 0,(function*(){const y=256*r,w=y+255,P=m.transformRequest(h.replace("{fontstack}",x).replace("{range}",`${y}-${w}`),"Glyphs"),R=yield a.n(P,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${r}, ${y}-${w}`);const D={};for(const B of a.o(R.data))D[B.id]=B;return D}))},sn.TinySDF=class{constructor({fontSize:x=24,buffer:r=3,radius:h=8,cutoff:m=.25,fontFamily:y="sans-serif",fontWeight:w="normal",fontStyle:P="normal",lang:R=null}={}){this.buffer=r,this.cutoff=m,this.radius=h,this.lang=R;const D=this.size=x+4*r,B=this._createCanvas(D),U=this.ctx=B.getContext("2d",{willReadFrequently:!0});U.font=`${P} ${w} ${x}px ${y}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(x){const r=document.createElement("canvas");return r.width=r.height=x,r}draw(x){const{width:r,actualBoundingBoxAscent:h,actualBoundingBoxDescent:m,actualBoundingBoxLeft:y,actualBoundingBoxRight:w}=this.ctx.measureText(x),P=Math.ceil(h),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-y))),D=Math.min(this.size-this.buffer,P+Math.ceil(m)),B=R+2*this.buffer,U=D+2*this.buffer,W=Math.max(B*U,0),$=new Uint8ClampedArray(W),Z={data:$,width:B,height:U,glyphWidth:R,glyphHeight:D,glyphTop:P,glyphLeft:0,glyphAdvance:r};if(R===0||D===0)return Z;const{ctx:Q,buffer:re,gridInner:ae,gridOuter:le}=this;this.lang&&(Q.lang=this.lang),Q.clearRect(re,re,R,D),Q.fillText(x,re,re+P);const pe=Q.getImageData(re,re,R,D);le.fill(Ft,0,W),ae.fill(0,0,W);for(let be=0;be<D;be++)for(let fe=0;fe<R;fe++){const Ae=pe.data[4*(be*R+fe)+3]/255;if(Ae===0)continue;const Me=(be+re)*B+fe+re;if(Ae===1)le[Me]=0,ae[Me]=Ft;else{const xe=.5-Ae;le[Me]=xe>0?xe*xe:0,ae[Me]=xe<0?xe*xe:0}}Wt(le,0,0,B,U,B,this.f,this.v,this.z),Wt(ae,re,re,R,D,B,this.f,this.v,this.z);for(let be=0;be<W;be++){const fe=Math.sqrt(le[be])-Math.sqrt(ae[be]);$[be]=Math.round(255-255*(fe/this.radius+this.cutoff))}return Z}};class rn{constructor(){this.specification=a.v.light.position}possiblyEvaluate(r,h){return a.B(r.expression.evaluate(h))}interpolate(r,h,m){return{x:a.C.number(r.x,h.x,m),y:a.C.number(r.y,h.y,m),z:a.C.number(r.z,h.z,m)}}}let kn;class Pe extends a.E{constructor(r){super(),kn=kn||new a.r({anchor:new a.D(a.v.light.anchor),position:new rn,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.t(kn,void 0),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,h={}){if(!this._validate(a.x,r,h))for(const m in r){const y=r[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,m){return(!m||m.validate!==!1)&&a.y(this,r.call(a.z,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const ke=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class ge extends a.E{constructor(r){super(),this._transitionable=new a.t(ke,void 0),this.setSky(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0))}setSky(r,h={}){if(!this._validate(a.G,r,h)){r||(r={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in r){const y=r[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,m={}){return m?.validate!==!1&&a.y(this,r.call(a.z,a.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(r){return r<60?0:r<70?(r-60)/10:1}}class Ue{constructor(r,h){this.width=r,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,h){const m=r.join(",")+String(h);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(r,h)),this.dashEntry[m]}getDashRanges(r,h,m){const y=[];let w=r.length%2==1?-r[r.length-1]*m:0,P=r[0]*m,R=!0;y.push({left:w,right:P,isDash:R,zeroLength:r[0]===0});let D=r[0];for(let B=1;B<r.length;B++){R=!R;const U=r[B];w=D*m,D+=U,P=D*m,y.push({left:w,right:P,isDash:R,zeroLength:U===0})}return y}addRoundDash(r,h,m){const y=h/2;for(let w=-m;w<=m;w++){const P=this.width*(this.nextRow+m+w);let R=0,D=r[R];for(let B=0;B<this.width;B++){B/D.right>1&&(D=r[++R]);const U=Math.abs(B-D.left),W=Math.abs(B-D.right),$=Math.min(U,W);let Z;const Q=w/m*(y+1);if(D.isDash){const re=y-Math.abs(Q);Z=Math.sqrt($*$+re*re)}else Z=y-Math.sqrt($*$+Q*Q);this.data[P+B]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(r){for(let R=r.length-1;R>=0;--R){const D=r[R],B=r[R+1];D.zeroLength?r.splice(R,1):B&&B.isDash===D.isDash&&(B.left=D.left,r.splice(R,1))}const h=r[0],m=r[r.length-1];h.isDash===m.isDash&&(h.left=m.left-this.width,m.right=h.right+this.width);const y=this.width*this.nextRow;let w=0,P=r[w];for(let R=0;R<this.width;R++){R/P.right>1&&(P=r[++w]);const D=Math.abs(R-P.left),B=Math.abs(R-P.right),U=Math.min(D,B);this.data[y+R]=Math.max(0,Math.min(255,(P.isDash?U:-U)+128))}}addDash(r,h){const m=h?7:0,y=2*m+1;if(this.nextRow+y>this.height)return a.w("LineAtlas out of space"),null;let w=0;for(let R=0;R<r.length;R++)w+=r[R];if(w!==0){const R=this.width/w,D=this.getDashRanges(r,this.width,R);h?this.addRoundDash(D,R,m):this.addRegularDash(D)}const P={y:this.nextRow+m,height:2*m,width:w};return this.nextRow+=y,this.dirty=!0,P}bind(r){const h=r.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const $e="maplibre_preloaded_worker_pool";class de{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<de.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach((h=>{h.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[$e]}numActive(){return Object.keys(this.active).length}}const De=Math.floor(L.hardwareConcurrency/2);let ut,Et;function It(){return ut||(ut=new de),ut}de.workerCount=a.H(globalThis)?Math.max(Math.min(De,3),1):1;class $t{constructor(r,h){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=h;const m=this.workerPool.acquire(h);for(let y=0;y<m.length;y++){const w=new a.J(m[y],h);w.name=`Worker ${y}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,h){const m=[];for(const y of this.actors)m.push(y.sendAsync({type:r,data:h}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach((h=>{h.remove()})),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,h){for(const m of this.actors)m.registerMessageHandler(r,h)}}function Qt(){return Et||(Et=new $t(It(),a.K),Et.registerMessageHandler("GR",((x,r,h)=>a.m(r,h)))),Et}function Ut(x,r){const h=a.L();return a.M(h,h,[1,1,0]),a.N(h,h,[.5*x.width,.5*x.height,1]),x.calculatePosMatrix?a.O(h,h,x.calculatePosMatrix(r.toUnwrapped())):h}function an(x,r,h,m,y,w,P){var R;const D=(function($,Z,Q){if($)for(const re of $){const ae=Z[re];if(ae&&ae.source===Q&&ae.type==="fill-extrusion")return!0}else for(const re in Z){const ae=Z[re];if(ae.source===Q&&ae.type==="fill-extrusion")return!0}return!1})((R=y?.layers)!==null&&R!==void 0?R:null,r,x.id),B=w.maxPitchScaleFactor(),U=x.tilesIn(m,B,D);U.sort(_n);const W=[];for(const $ of U)W.push({wrappedTileID:$.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(r,h,x._state,$.queryGeometry,$.cameraQueryGeometry,$.scale,y,w,B,Ut(x.transform,$.tileID),P?(Z,Q)=>P($.tileID,Z,Q):void 0)});return(function($,Z){for(const Q in $)for(const re of $[Q])Gi(re,Z);return $})((function($){const Z={},Q={};for(const re of $){const ae=re.queryResults,le=re.wrappedTileID,pe=Q[le]=Q[le]||{};for(const be in ae){const fe=ae[be],Ae=pe[be]=pe[be]||{},Me=Z[be]=Z[be]||[];for(const xe of fe)Ae[xe.featureIndex]||(Ae[xe.featureIndex]=!0,Me.push(xe))}}return Z})(W),x)}function _n(x,r){const h=x.tileID,m=r.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}function Gi(x,r){const h=x.feature,m=r.getFeatureState(h.layer["source-layer"],h.id);h.source=h.layer.source,h.layer["source-layer"]&&(h.sourceLayer=h.layer["source-layer"]),h.state=m}function Ii(x,r,h){return a._(this,void 0,void 0,(function*(){let m=x;if(x.url?m=(yield a.j(r.transformRequest(x.url,"Source"),h)).data:yield L.frameAsync(h),!m)return null;const y=a.Q(a.e(m,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(y.vectorLayerIds=m.vector_layers.map((w=>w.id))),y}))}class Hn{constructor(r,h){r&&(h?this.setSouthWest(r).setNorthEast(h):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof a.S?new a.S(r.lng,r.lat):a.S.convert(r),this}setSouthWest(r){return this._sw=r instanceof a.S?new a.S(r.lng,r.lat):a.S.convert(r),this}extend(r){const h=this._sw,m=this._ne;let y,w;if(r instanceof a.S)y=r,w=r;else{if(!(r instanceof Hn))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Hn.convert(r)):this.extend(a.S.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(a.S.convert(r)):this;if(y=r._sw,w=r._ne,!y||!w)return this}return h||m?(h.lng=Math.min(y.lng,h.lng),h.lat=Math.min(y.lat,h.lat),m.lng=Math.max(w.lng,m.lng),m.lat=Math.max(w.lat,m.lat)):(this._sw=new a.S(y.lng,y.lat),this._ne=new a.S(w.lng,w.lat)),this}getCenter(){return new a.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.S(this.getWest(),this.getNorth())}getSouthEast(){return new a.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:h,lat:m}=a.S.convert(r);let y=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&y}static convert(r){return r instanceof Hn?r:r&&new Hn(r)}static fromLngLat(r,h=0){const m=360*h/40075017,y=m/Math.cos(Math.PI/180*r.lat);return new Hn(new a.S(r.lng-y,r.lat-m),new a.S(r.lng+y,r.lat+m))}adjustAntiMeridian(){const r=new a.S(this._sw.lng,this._sw.lat),h=new a.S(this._ne.lng,this._ne.lat);return new Hn(r,r.lng>h.lng?new a.S(h.lng+360,h.lat):h)}}class ri{constructor(r,h,m){this.bounds=Hn.convert(this.validateBounds(r)),this.minzoom=h||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const h=Math.pow(2,r.z),m=Math.floor(a.V(this.bounds.getWest())*h),y=Math.floor(a.U(this.bounds.getNorth())*h),w=Math.ceil(a.V(this.bounds.getEast())*h),P=Math.ceil(a.U(this.bounds.getSouth())*h);return r.x>=m&&r.x<w&&r.y>=y&&r.y<P}}class xt extends a.E{constructor(r,h,m,y){if(super(),this.id=r,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.Q(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ii(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r&&(a.e(this,r),r.bounds&&(this.tileBounds=new ri(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,this.fire(new a.k(r))}}))}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty((()=>{this._options.tiles=r})),this}setUrl(r){return this.setSourceProperty((()=>{this.url=r,this._options.url=r})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(r){return a._(this,void 0,void 0,(function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(h,"Tile"),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};m.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise(((w,P)=>{r.reloadPromise={resolve:w,reject:P}}))}else r.actor=this.dispatcher.getActor(),y="LT";r.abortController=new AbortController;try{const w=yield r.actor.sendAsync({type:y,data:m},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,w)}catch(w){if(delete r.abortController,r.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(r,null)}}))}_afterTileLoadWorkerResponse(r,h){if(h&&h.resourceTiming&&(r.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&r.setExpiryData(h),r.loadVectorData(h,this.map.painter),r.reloadPromise){const m=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(m.resolve).catch(m.reject)}}abortTile(r){return a._(this,void 0,void 0,(function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"AT",data:{uid:r.uid,type:this.type,source:this.id}}))}))}unloadTile(r){return a._(this,void 0,void 0,(function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Pt extends a.E{constructor(r,h,m,y){super(),this.id=r,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.Q(h,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,(function*(r=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const h=yield Ii(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,h&&(a.e(this,h),h.bounds&&(this.tileBounds=new ri(h.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:r})))}catch(h){this._tileJSONRequest=null,this._loaded=!0,this.fire(new a.k(h))}}))}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load(!0)}setTiles(r){return this.setSourceProperty((()=>{this._options.tiles=r})),this}setUrl(r){return this.setSourceProperty((()=>{this.url=r,this._options.url=r})),this}serialize(){return a.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return a._(this,void 0,void 0,(function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{const m=yield Se.getImage(this.map._requestManager.transformRequest(h,"Tile"),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&r.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const y=this.map.painter.context,w=y.gl,P=m.data;r.texture=this.map.painter.getTileTexture(P.width),r.texture?r.texture.update(P,{useMipmap:!0}):(r.texture=new a.T(y,P,w.RGBA,{useMipmap:!0}),r.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),r.state="loaded"}}catch(m){if(delete r.abortController,r.aborted)r.state="unloaded";else if(m)throw r.state="errored",m}}))}abortTile(r){return a._(this,void 0,void 0,(function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)}))}unloadTile(r){return a._(this,void 0,void 0,(function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)}))}hasTransition(){return!1}}class Yt extends Pt{constructor(r,h,m,y){super(r,h,m,y),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(r){return a._(this,void 0,void 0,(function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(h,"Tile");r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{const y=yield Se.getImage(m,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(y&&y.data){const w=y.data;this.map._refreshExpiredTiles&&(y.cacheControl||y.expires)&&r.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const P=a.b(w)&&a.W()?w:yield this.readImageNow(w),R={type:this.type,uid:r.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();const D=yield r.actor.sendAsync({type:"LDT",data:R});r.dem=D,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(y){if(delete r.abortController,r.aborted)r.state="unloaded";else if(y)throw r.state="errored",y}}))}readImageNow(r){return a._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&a.X()){const h=r.width+2,m=r.height+2;try{return new a.R({width:h,height:m},yield a.Y(r,-1,-1,h,m))}catch{}}return L.getImageData(r,1)}))}_getNeighboringTiles(r){const h=r.canonical,m=Math.pow(2,h.z),y=(h.x-1+m)%m,w=h.x===0?r.wrap-1:r.wrap,P=(h.x+1+m)%m,R=h.x+1===m?r.wrap+1:r.wrap,D={};return D[new a.Z(r.overscaledZ,w,h.z,y,h.y).key]={backfilled:!1},D[new a.Z(r.overscaledZ,R,h.z,P,h.y).key]={backfilled:!1},h.y>0&&(D[new a.Z(r.overscaledZ,w,h.z,y,h.y-1).key]={backfilled:!1},D[new a.Z(r.overscaledZ,r.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},D[new a.Z(r.overscaledZ,R,h.z,P,h.y-1).key]={backfilled:!1}),h.y+1<m&&(D[new a.Z(r.overscaledZ,w,h.z,y,h.y+1).key]={backfilled:!1},D[new a.Z(r.overscaledZ,r.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},D[new a.Z(r.overscaledZ,R,h.z,P,h.y+1).key]={backfilled:!1}),D}unloadTile(r){return a._(this,void 0,void 0,(function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"RDT",data:{type:this.type,uid:r.uid,source:this.id}}))}))}}class Sn extends a.E{constructor(r,h,m,y){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:h.data},this.actor=m.getActor(),this.setEventedParent(y),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId,h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(h.buffer!==void 0?h.buffer:128),tolerance:this._pixelsToTileUnits(h.tolerance!==void 0?h.tolerance:.375),extent:a.$,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(h.clusterMaxZoom),minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.$,radius:this._pixelsToTileUnits(h.clusterRadius||50),log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(r){return r*(a.$/this.tileSize)}_getClusterMaxZoom(r){const h=r?Math.round(r):this.maxzoom-1;return Number.isInteger(r)||r===void 0||a.w(`Integer expected for option 'clusterMaxZoom': provided value "${r}" rounded to "${h}"`),h}load(){return a._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._pendingWorkerUpdate={data:r},this._updateWorkerData(),this}updateData(r){return this._pendingWorkerUpdate.diff=a.a0(this._pendingWorkerUpdate.diff,r),this._updateWorkerData(),this}getData(){return a._(this,void 0,void 0,(function*(){const r=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:r})}))}getCoordinatesFromGeometry(r){return r.type==="GeometryCollection"?r.geometries.map((h=>h.coordinates)).flat(1/0):r.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,(function*(){const r=new Hn,h=yield this.getData();let m;switch(h.type){case"FeatureCollection":m=h.features.map((y=>this.getCoordinatesFromGeometry(y.geometry))).flat(1/0);break;case"Feature":m=this.getCoordinatesFromGeometry(h.geometry);break;default:m=this.getCoordinatesFromGeometry(h)}if(m.length==0)return r;for(let y=0;y<m.length-1;y+=2)r.extend([m[y],m[y+1]]);return r}))}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(r.clusterRadius)),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(r.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,h,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:r,limit:h,offset:m}})}_updateWorkerData(){return a._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:r,diff:h}=this._pendingWorkerUpdate;if(!r&&!h)return void a.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const m=a.e({type:this.type},this.workerOptions);r?(typeof r=="string"?(m.request=this.map._requestManager.transformRequest(L.resolveURL(r),"Source"),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(r),this._pendingWorkerUpdate.data=void 0):h&&(m.dataDiff=h,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new a.l("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:m});if(this._isUpdatingWorker=!1,this._removed||y.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));this._data=y.data;let w=null;y.resourceTiming&&y.resourceTiming[this.id]&&(w=y.resourceTiming[this.id].slice(0));const P={dataType:"source"};this._collectResourceTiming&&w&&w.length>0&&a.e(P,{resourceTiming:w}),this.fire(new a.l("data",Object.assign(Object.assign({},P),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},P),{sourceDataType:"content"})))}catch(y){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(y))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(r){return a._(this,void 0,void 0,(function*(){const h=r.actor?"RT":"LT";r.actor=this.actor;const m={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};r.abortController=new AbortController;const y=yield this.actor.sendAsync({type:h,data:m},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(y,this.map.painter,h==="RT")}))}abortTile(r){return a._(this,void 0,void 0,(function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0}))}unloadTile(r){return a._(this,void 0,void 0,(function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Nn extends a.E{constructor(r,h,m,y){super(),this.flippedWindingOrder=!1,this.id=r,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=h}load(r){return a._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield Se.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,r&&(this.coordinates=r),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.k(h))}}))}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;const h=r.map(a.a1.fromLngLat);var m;return this.tileID=(function(y){const w=a.a2.fromPoints(y),P=w.width(),R=w.height(),D=Math.max(P,R),B=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),U=Math.pow(2,B);return new a.a4(B,Math.floor((w.minX+w.maxX)/2*U),Math.floor((w.minY+w.maxY)/2*U))})(h),this.terrainTileRanges=this._getOverlappingTileRanges(h),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=h.map((y=>this.tileID.getTilePoint(y)._round())),this.flippedWindingOrder=((m=this.tileCoords)[1].x-m[0].x)*(m[2].y-m[0].y)-(m[1].y-m[0].y)*(m[2].x-m[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,h=r.gl;this.texture||(this.texture=new a.T(r,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,m=!0)}m&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return a._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(r){const{minX:h,minY:m,maxX:y,maxY:w}=a.a2.fromPoints(r),P={};for(let R=0;R<=a.a3;R++){const D=Math.pow(2,R),B=Math.floor(h*D),U=Math.floor(m*D),W=Math.floor(y*D),$=Math.floor(w*D);P[R]={minTileX:B,minTileY:U,maxTileX:W,maxTileY:$}}return P}}class Yn extends Nn{constructor(r,h,m,y){super(r,h,m,y),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!1;const r=this.options;this.urls=[];for(const h of r.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a5(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.k(h))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const h=this.video.seekable;r<h.start(0)||r>h.end(0)?this.fire(new a.k(new a.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,h=r.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(r,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,m=!0)}m&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class yi extends Nn{constructor(r,h,m,y){super(r,h,m,y),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some((w=>!Array.isArray(w)||w.length!==2||w.some((P=>typeof P!="number"))))||this.fire(new a.k(new a.a6(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a6(`sources.${r}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.k(new a.a6(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a6(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a6(`sources.${r}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,m=h.gl;this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(h,this.canvas,m.RGBA,{premultiply:!0});let y=!1;for(const w in this.tiles){const P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,y=!0)}y&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const hs={},Es=x=>{switch(x){case"geojson":return Sn;case"image":return Nn;case"raster":return Pt;case"raster-dem":return Yt;case"vector":return xt;case"video":return Yn;case"canvas":return yi}return hs[x]},ds="RTLPluginLoaded";class Kr extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qt()}_syncState(r){return this.status=r,this.dispatcher.broadcast("SRPS",{pluginStatus:r,pluginURL:this.url}).catch((h=>{throw this.status="error",h}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return a._(this,arguments,void 0,(function*(h,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=L.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return a._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(ds))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Zs=null;function Jr(){return Zs||(Zs=new Kr),Zs}class Ps{constructor(r,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=a.a7(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const h=r+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,h,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=(function(y,w){const P={};if(!w)return P;for(const R of y){const D=R.layerIds.map((B=>w.getLayer(B))).filter(Boolean);if(D.length!==0){R.layers=D,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map((B=>D.filter((U=>U.id===B))[0])));for(const B of D)P[B.id]=R}}return P})(r.buckets,h?.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const w=this.buckets[y];if(w instanceof a.a9){if(this.hasSymbolBuckets=!0,!m)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const w=this.buckets[y];if(w instanceof a.a9&&w.hasRTLText){this.hasRTLText=!0,Jr().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const w=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(y).queryRadius(w))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),this.dashPositions=r.dashPositions}else this.collisionBoxArray=new a.a8}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const m in this.buckets){const y=this.buckets[m];y.uploadPending()&&y.upload(r)}const h=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new a.T(r,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(r,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,h,m,y,w,P,R,D,B,U,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:w,scale:P,tileSize:this.tileSize,pixelPosMatrix:U,transform:D,params:R,queryPadding:this.queryPadding*B,getElevation:W},r,h,m):{}}querySourceFeatures(r,h){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const y=m.loadVTLayers(),w=h&&h.sourceLayer?h.sourceLayer:"",P=y._geojsonTileLayer||y[w];if(!P)return;const R=a.aa(h?.filter,h?.globalState),{z:D,x:B,y:U}=this.tileID.canonical,W={z:D,x:B,y:U};for(let $=0;$<P.length;$++){const Z=P.feature($);if(R.needGeometry){const ae=a.ab(Z,!0);if(!R.filter(new a.F(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!R.filter(new a.F(this.tileID.overscaledZ),Z))continue;const Q=m.getId(Z,w),re=new a.ac(Z,D,B,U,Q);re.tile=W,r.push(re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const h=this.expirationTime;if(r.cacheControl){const m=a.ad(r.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const m=Date.now();let y=!1;if(this.expirationTime>m)y=!1;else if(h)if(this.expirationTime<h)y=!0;else{const w=this.expirationTime-h;w?this.expirationTime=m+Math.max(w,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!h.style.hasLayer(y))continue;const w=this.buckets[y],P=w.layers[0].sourceLayer||"_geojsonTileLayer",R=m[P],D=r[P];if(!R||!D||Object.keys(D).length===0)continue;w.update(D,R,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const B=h&&h.style&&h.style.getLayer(y);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<L.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=L.now()+r}setDependencies(r,h){const m={};for(const y of h)m[y]=!0;this.dependencies[r]=m}hasDependency(r,h){for(const m of r){const y=this.dependencies[m];if(y){for(const w of h)if(y[w])return!0}}return!1}}class Le{constructor(r,h){this.max=r,this.onRemove=h,this.reset()}reset(){for(const r in this.data)for(const h of this.data[r])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(r,h,m){const y=r.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const w={value:h,timeout:void 0};if(m!==void 0&&(w.timeout=setTimeout((()=>{this.remove(r,w)}),m)),this.data[y].push(w),this.order.push(y),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const h=this.data[r].shift();return h.timeout&&clearTimeout(h.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),h.value}getByKey(r){const h=this.data[r];return h?h[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,h){if(!this.has(r))return this;const m=r.wrapped().key,y=h===void 0?0:this.data[m].indexOf(h),w=this.data[m][y];return this.data[m].splice(y,1),w.timeout&&clearTimeout(w.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(w.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(r){const h=[];for(const m in this.data)for(const y of this.data[m])r(y.value)||h.push(y);for(const m of h)this.remove(m.value.tileID,m)}}class K{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,h,m){const y=String(h);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][y]=this.stateChanges[r][y]||{},a.e(this.stateChanges[r][y],m),this.deletedStates[r]===null){this.deletedStates[r]={};for(const w in this.state[r])w!==y&&(this.deletedStates[r][w]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][y]===null){this.deletedStates[r][y]={};for(const w in this.state[r][y])m[w]||(this.deletedStates[r][y][w]=null)}else for(const w in m)this.deletedStates[r]&&this.deletedStates[r][y]&&this.deletedStates[r][y][w]===null&&delete this.deletedStates[r][y][w]}removeFeatureState(r,h,m){if(this.deletedStates[r]===null)return;const y=String(h);if(this.deletedStates[r]=this.deletedStates[r]||{},m&&h!==void 0)this.deletedStates[r][y]!==null&&(this.deletedStates[r][y]=this.deletedStates[r][y]||{},this.deletedStates[r][y][m]=null);else if(h!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][y])for(m in this.deletedStates[r][y]={},this.stateChanges[r][y])this.deletedStates[r][y][m]=null;else this.deletedStates[r][y]=null;else this.deletedStates[r]=null}getState(r,h){const m=String(h),y=a.e({},(this.state[r]||{})[m],(this.stateChanges[r]||{})[m]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const w=this.deletedStates[r][h];if(w===null)return{};for(const P in w)delete y[P]}return y}initializeTileState(r,h){r.setFeatureState(this.state,h)}coalesceChanges(r,h){const m={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const w={};for(const P in this.stateChanges[y])this.state[y][P]||(this.state[y][P]={}),a.e(this.state[y][P],this.stateChanges[y][P]),w[P]=this.state[y][P];m[y]=w}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const w={};if(this.deletedStates[y]===null)for(const P in this.state[y])w[P]={},this.state[y][P]={};else for(const P in this.deletedStates[y]){if(this.deletedStates[y][P]===null)this.state[y][P]={};else for(const R of Object.keys(this.deletedStates[y][P]))delete this.state[y][P][R];w[P]=this.state[y][P]}m[y]=m[y]||{},a.e(m[y],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const y in r)r[y].setFeatureState(m,h)}}const J=89.25;function ie(x,r){const h=a.ah(r.lat,-a.ai,a.ai);return new a.P(a.V(r.lng)*x,a.U(h)*x)}function we(x,r){return new a.a1(r.x/x,r.y/x).toLngLat()}function Ce(x){return x.cameraToCenterDistance*Math.min(.85*Math.tan(a.ae(90-x.pitch)),Math.tan(a.ae(J-x.pitch)))}function Fe(x,r){const h=x.canonical,m=r/a.af(h.z),y=h.x+Math.pow(2,h.z)*x.wrap,w=a.ag(new Float64Array(16));return a.M(w,w,[y*m,h.y*m,0]),a.N(w,w,[m/a.$,m/a.$,1]),w}function Ke(x,r,h,m,y){const w=a.a1.fromLngLat(x,r),P=y*a.aj(1,x.lat),R=P*Math.cos(a.ae(h)),D=Math.sqrt(P*P-R*R),B=D*Math.sin(a.ae(-m)),U=D*Math.cos(a.ae(-m));return new a.a1(w.x+B,w.y+U,w.z+R)}function ze(x,r,h){const m=r.intersectsFrustum(x);if(!h||m===0)return m;const y=r.intersectsPlane(h);return y===0?0:m===2&&y===2?2:1}function rt(x,r,h){let m=0;const y=(h-r)/10;for(let w=0;w<10;w++)m+=y*Math.pow(Math.cos(r+(w+.5)/10*(h-r)),x);return m}function mt(x,r){return function(h,m,y,w,P){const R=2*((x-1)/a.ak(Math.cos(a.ae(J-P))/Math.cos(a.ae(J)))-1),D=Math.acos(y/w),B=2*rt(R-1,0,a.ae(P/2)),U=Math.min(a.ae(J),D+a.ae(P/2)),W=rt(R-1,Math.min(U,D-a.ae(P/2)),U),$=Math.atan(m/y),Z=Math.hypot(m,y);let Q=h;return Q+=a.ak(w/Z/Math.max(.5,Math.cos(a.ae(P/2)))),Q+=R*a.ak(Math.cos($))/2,Q-=a.ak(Math.max(1,W/B/r))/2,Q}}const at=mt(9.314,3);function zt(x,r){const h=(r.roundZoom?Math.round:Math.floor)(x.zoom+a.ak(x.tileSize/r.tileSize));return Math.max(0,h)}function Be(x,r){const h=x.getCameraFrustum(),m=x.getClippingPlane(),y=x.screenPointToMercatorCoordinate(x.getCameraPoint()),w=a.a1.fromLngLat(x.center,x.elevation);y.z=w.z+Math.cos(x.pitchInRadians)*x.cameraToCenterDistance/x.worldSize;const P=x.getCoveringTilesDetailsProvider(),R=P.allowVariableZoom(x,r),D=zt(x,r),B=r.minzoom||0,U=r.maxzoom!==void 0?r.maxzoom:x.maxZoom,W=Math.min(Math.max(0,D),U),$=Math.pow(2,W),Z=[$*y.x,$*y.y,0],Q=[$*w.x,$*w.y,0],re=Math.hypot(w.x-y.x,w.y-y.y),ae=Math.abs(w.z-y.z),le=Math.hypot(re,ae),pe=Ae=>({zoom:0,x:0,y:0,wrap:Ae,fullyVisible:!1}),be=[],fe=[];if(x.renderWorldCopies&&P.allowWorldCopies())for(let Ae=1;Ae<=3;Ae++)be.push(pe(-Ae)),be.push(pe(Ae));for(be.push(pe(0));be.length>0;){const Ae=be.pop(),Me=Ae.x,xe=Ae.y;let Re=Ae.fullyVisible;const Ge={x:Me,y:xe,z:Ae.zoom},qe=P.getTileBoundingVolume(Ge,Ae.wrap,x.elevation,r);if(!Re){const _t=ze(h,qe,m);if(_t===0)continue;Re=_t===2}const Ye=P.distanceToTile2d(y.x,y.y,Ge,qe);let tt=D;R&&(tt=(r.calculateTileZoom||at)(x.zoom+a.ak(x.tileSize/r.tileSize),Ye,ae,le,x.fov)),tt=(r.roundZoom?Math.round:Math.floor)(tt),tt=Math.max(0,tt);const bt=Math.min(tt,U);if(Ae.wrap=P.getWrap(w,Ge,Ae.wrap),Ae.zoom>=bt){if(Ae.zoom<B)continue;const _t=W-Ae.zoom,ht=Z[0]-.5-(Me<<_t),Bt=Z[1]-.5-(xe<<_t),xn=r.reparseOverscaled?Math.max(Ae.zoom,tt):Ae.zoom;fe.push({tileID:new a.Z(Ae.zoom===U?xn:Ae.zoom,Ae.wrap,Ae.zoom,Me,xe),distanceSq:a.al([Q[0]-.5-Me,Q[1]-.5-xe]),tileDistanceToCamera:Math.sqrt(ht*ht+Bt*Bt)})}else for(let _t=0;_t<4;_t++)be.push({zoom:Ae.zoom+1,x:(Me<<1)+_t%2,y:(xe<<1)+(_t>>1),wrap:Ae.wrap,fullyVisible:Re})}return fe.sort(((Ae,Me)=>Ae.distanceSq-Me.distanceSq)).map((Ae=>Ae.tileID))}const un=a.a2.fromPoints([new a.P(0,0),new a.P(a.$,a.$)]);class Dn extends a.E{constructor(r,h,m){super(),this.id=r,this.dispatcher=m,this.on("data",(y=>this._dataHandler(y))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((y,w,P,R)=>{const D=new(Es(w.type))(y,w,P,R);if(D.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${D.id}`);return D})(r,h,m,this),this._tiles={},this._cache=new Le(0,(y=>this._unloadTile(y))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new K,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const h=this._tiles[r];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,h,m){return a._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,h,m)}catch(y){r.state="errored",y.status!==404?this._source.fire(new a.k(y,{tile:r})):this.update(this.transform,this.terrain)}}))}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new a.l("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const m=this._tiles[h];m.upload(r),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((r=>r.tileID)).sort(Xt).map((r=>r.key))}getRenderableIds(r){const h=[];for(const m in this._tiles)this._isIdRenderable(m,r)&&h.push(this._tiles[m]);return r?h.sort(((m,y)=>{const w=m.tileID,P=y.tileID,R=new a.P(w.canonical.x,w.canonical.y)._rotate(-this.transform.bearingInRadians),D=new a.P(P.canonical.x,P.canonical.y)._rotate(-this.transform.bearingInRadians);return w.overscaledZ-P.overscaledZ||D.y-R.y||D.x-R.x})).map((m=>m.tileID.key)):h.map((m=>m.tileID)).sort(Xt).map((m=>m.key))}hasRenderableParent(r){const h=this.findLoadedParent(r,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(r,h){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(h||!this._tiles[r].holdingForFade())}reload(r){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const h in this._tiles)r?this._reloadTile(h,"expired"):this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")}}_reloadTile(r,h){return a._(this,void 0,void 0,(function*(){const m=this._tiles[r];m&&(m.state!=="loading"&&(m.state=h),yield this._loadTile(m,r,h))}))}_tileLoaded(r,h,m){r.timeAdded=L.now(),m==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(h,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const h=this.getRenderableIds();for(let y=0;y<h.length;y++){const w=h[y];if(r.neighboringTiles&&r.neighboringTiles[w]){const P=this.getTileByID(w);m(r,P),m(P,r)}}function m(y,w){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let P=w.tileID.canonical.x-y.tileID.canonical.x;const R=w.tileID.canonical.y-y.tileID.canonical.y,D=Math.pow(2,y.tileID.canonical.z),B=w.tileID.key;P===0&&R===0||Math.abs(R)>1||(Math.abs(P)>1&&(Math.abs(P+D)===1?P+=D:Math.abs(P-D)===1&&(P-=D)),w.dem&&y.dem&&(y.dem.backfillBorder(w.dem,P,R),y.neighboringTiles&&y.neighboringTiles[B]&&(y.neighboringTiles[B].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,h){const m=Object.values(r),y=this._getLoadedDescendents(m),w={};for(const P of m){const R=y[P.key];if(!R?.length){w[P.key]=P;continue}const D=P.overscaledZ+Dn.maxUnderzooming,B=R.filter(($=>$.tileID.overscaledZ<=D));if(!B.length){w[P.key]=P;continue}const U=Math.min(...B.map(($=>$.tileID.overscaledZ))),W=B.filter(($=>$.tileID.overscaledZ===U)).map(($=>$.tileID));for(const $ of W)h[$.key]=$;this._areDescendentsComplete(W,U,P.overscaledZ)||(w[P.key]=P)}return w}_getLoadedDescendents(r){var h;const m={};for(const y in this._tiles){const w=this._tiles[y];if(w.hasData())for(const P of r)w.tileID.isChildOf(P)&&(m[h=P.key]||(m[h]=[])).push(w)}return m}_areDescendentsComplete(r,h,m){return r.length===1&&r[0].isOverscaled()?r[0].overscaledZ===h:Math.pow(4,h-m)===r.length}findLoadedParent(r,h){if(r.key in this._loadedParentTiles){const m=this._loadedParentTiles[r.key];return m&&m.tileID.overscaledZ>=h?m:null}for(let m=r.overscaledZ-1;m>=h;m--){const y=r.scaledTo(m),w=this._getLoadedTile(y);if(w)return w}}findLoadedSibling(r){return this._getLoadedTile(r)}_getLoadedTile(r){const h=this._tiles[r.key];return h&&h.hasData()?h:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const h=Math.ceil(r.width/this._source.tileSize)+1,m=Math.ceil(r.height/this._source.tileSize)+1,y=Math.floor(h*m*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(r){const h=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,h){const m={};for(const y in this._tiles){const w=this._tiles[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+h),m[w.tileID.key]=w}this._tiles=m;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}update(r,h){if(!this._sourceLoaded||this._paused)return;let m;this.transform=r,this.terrain=h,this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=r.getVisibleUnwrappedCoordinates(this._source.tileID).map((B=>new a.Z(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y))):(m=Be(r,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(m=m.filter((B=>this._source.hasTile(B))))):m=[],this.usedForTerrain&&(m=this._addTerrainIdealTiles(m));const y=zt(r,this._source),w=Math.max(y-Dn.maxOverzooming,this._source.minzoom),P=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const R=this._updateRetainedTiles(m,y);yn(this._source.type)&&!h&&this._updateFadingTiles(R,w);for(const B in R)this._tiles[B].clearFadeHold();const D=a.am(this._tiles,R);for(const B of D){const U=this._tiles[B];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(B)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}_addTerrainIdealTiles(r){const h=[];for(const m of r)if(m.canonical.z>this._source.minzoom){const y=m.scaledTo(m.canonical.z-1);h.push(y);const w=m.scaledTo(Math.max(this._source.minzoom,Math.min(m.canonical.z,5)));h.push(w)}return r.concat(h)}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,h){var m;const y={},w={},P=Math.max(h-Dn.maxOverzooming,this._source.minzoom);let R={};for(const D of r){const B=this._addTile(D);y[D.key]=D,B.hasData()||(R[D.key]=D)}R=this._retainLoadedChildren(R,y);for(const D in R){const B=R[D];let U=this._tiles[D],W=U?.wasRequested();for(let $=B.overscaledZ-1;$>=P;--$){const Z=B.scaledTo($);if(w[Z.key])break;if(w[Z.key]=!0,U=this.getTile(Z),!U&&W&&(U=this._addTile(Z)),U){const Q=U.hasData();if((Q||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||W)&&(y[Z.key]=Z),W=U.wasRequested(),Q)break}}}return y}_updateFadingTiles(r,h){const m={},y={},w=Object.keys(r),P=L.now();for(const R of w){const D=r[R],B=this._tiles[R];if(!B||B.fadeEndTime!==0&&B.fadeEndTime<=P)continue;const U=this.findLoadedParent(D,h),W=this.findLoadedSibling(D),$=U||W||null;$&&(this._addTile($.tileID),m[$.tileID.key]=$.tileID),y[R]=D}this._retainLoadedChildren(y,r);for(const R in m)r[R]||(this._coveredTiles[R]=!0,r[R]=m[R])}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const h=[];let m,y=this._tiles[r].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){m=this._loadedParentTiles[y.key];break}h.push(y.key);const w=y.scaledTo(y.overscaledZ-1);if(m=this._getLoadedTile(w),m)break;y=w}for(const w of h)this._loadedParentTiles[w]=m}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const r in this._tiles){const h=this._tiles[r].tileID,m=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=m}}_addTile(r){let h=this._tiles[r.key];if(h)return h;h=this._cache.getAndRemove(r),h&&(this._setTileReloadTimer(r.key,h),h.tileID=r,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,h)));const m=h;return h||(h=new Ps(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(h,r.key,h.state)),h.uses++,this._tiles[r.key]=h,m||this._source.fire(new a.l("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(r,h){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const m=h.getExpiryTimeout();m&&(this._timers[r]=setTimeout((()=>{this._reloadTile(r,"expired"),delete this._timers[r]}),m))}refreshTiles(r){for(const h in this._tiles)(this._isIdRenderable(h)||this._tiles[h].state=="errored")&&r.some((m=>m.equals(this._tiles[h].tileID.canonical)))&&this._reloadTile(h,"expired")}_removeTile(r){const h=this._tiles[r];h&&(h.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(r){const h=r.sourceDataType;r.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&r.dataType==="source"&&h==="content"&&(this.reload(r.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,h,m){const y=[],w=this.transform;if(!w)return y;const P=w.getCoveringTilesDetailsProvider().allowWorldCopies(),R=m?w.getCameraQueryGeometry(r):r,D=Z=>w.screenPointToMercatorCoordinate(Z,this.terrain),B=this.transformBbox(r,D,!P),U=this.transformBbox(R,D,!P),W=this.getIds(),$=a.a2.fromPoints(U);for(let Z=0;Z<W.length;Z++){const Q=this._tiles[W[Z]];if(Q.holdingForFade())continue;const re=P?[Q.tileID]:[Q.tileID.unwrapTo(-1),Q.tileID.unwrapTo(0)],ae=Math.pow(2,w.zoom-Q.tileID.overscaledZ),le=h*Q.queryPadding*a.$/Q.tileSize/ae;for(const pe of re){const be=$.map((fe=>pe.getTilePoint(new a.a1(fe.x,fe.y))));if(be.expandBy(le),be.intersects(un)){const fe=B.map((Me=>pe.getTilePoint(Me))),Ae=U.map((Me=>pe.getTilePoint(Me)));y.push({tile:Q,tileID:P?pe:pe.unwrapTo(0),queryGeometry:fe,cameraQueryGeometry:Ae,scale:ae})}}}return y}transformBbox(r,h,m){let y=r.map(h);if(m){const w=a.a2.fromPoints(r);w.shrinkBy(.001*Math.min(w.width(),w.height()));const P=w.map(h);a.a2.fromPoints(y).covers(P)||(y=y.map((R=>R.x>.5?new a.a1(R.x-1,R.y,R.z):R)))}return y}getVisibleCoordinates(r){const h=this.getRenderableIds(r).map((m=>this._tiles[m].tileID));return this.transform&&this.transform.populateCache(h),h}hasTransition(){if(this._source.hasTransition())return!0;if(yn(this._source.type)){const r=L.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=r)return!0}return!1}setFeatureState(r,h,m){this._state.updateState(r=r||"_geojsonTileLayer",h,m)}removeFeatureState(r,h,m){this._state.removeFeatureState(r=r||"_geojsonTileLayer",h,m)}getFeatureState(r,h){return this._state.getState(r=r||"_geojsonTileLayer",h)}setDependencies(r,h,m){const y=this._tiles[r];y&&y.setDependencies(h,m)}reloadTilesForDependencies(r,h){for(const m in this._tiles)this._tiles[m].hasDependency(r,h)&&this._reloadTile(m,"reloading");this._cache.filter((m=>!m.hasDependency(r,h)))}}function Xt(x,r){const h=Math.abs(2*x.wrap)-+(x.wrap<0),m=Math.abs(2*r.wrap)-+(r.wrap<0);return x.overscaledZ-r.overscaledZ||m-h||r.canonical.y-x.canonical.y||r.canonical.x-x.canonical.x}function yn(x){return x==="raster"||x==="image"||x==="video"}Dn.maxOverzooming=10,Dn.maxUnderzooming=3;class ai{constructor(r,h){this.reset(r,h)}reset(r,h){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=a.ah(r,0,1);let h=1,m=this._distances[h];const y=r*this.paddedLength+this.padding;for(;m<y&&h<this._distances.length;)m=this._distances[++h];const w=h-1,P=this._distances[w],R=m-P,D=R>0?(y-P)/R:0;return this.points[w].mult(1-D).add(this.points[h].mult(D))}}function Ei(x,r){let h=!0;return x==="always"||x!=="never"&&r!=="never"||(h=!1),h}class $i{constructor(r,h,m){const y=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(h/m);for(let P=0;P<this.xCellCount*this.yCellCount;P++)y.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=h,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,h,m,y,w){this._forEachCell(h,m,y,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(w)}insertCircle(r,h,m,y){this._forEachCell(h-y,m-y,h+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(h),this.circles.push(m),this.circles.push(y)}_insertBoxCell(r,h,m,y,w,P){this.boxCells[w].push(P)}_insertCircleCell(r,h,m,y,w,P){this.circleCells[w].push(P)}_query(r,h,m,y,w,P,R){if(m<0||r>this.width||y<0||h>this.height)return[];const D=[];if(r<=0&&h<=0&&this.width<=m&&this.height<=y){if(w)return[{key:null,x1:r,y1:h,x2:m,y2:y}];for(let B=0;B<this.boxKeys.length;B++)D.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const U=this.circles[3*B],W=this.circles[3*B+1],$=this.circles[3*B+2];D.push({key:this.circleKeys[B],x1:U-$,y1:W-$,x2:U+$,y2:W+$})}}else this._forEachCell(r,h,m,y,this._queryCell,D,{hitTest:w,overlapMode:P,seenUids:{box:{},circle:{}}},R);return D}query(r,h,m,y){return this._query(r,h,m,y,!1,null)}hitTest(r,h,m,y,w,P){return this._query(r,h,m,y,!0,w,P).length>0}hitTestCircle(r,h,m,y,w){const P=r-m,R=r+m,D=h-m,B=h+m;if(R<0||P>this.width||B<0||D>this.height)return!1;const U=[];return this._forEachCell(P,D,R,B,this._queryCellCircle,U,{hitTest:!0,overlapMode:y,circle:{x:r,y:h,radius:m},seenUids:{box:{},circle:{}}},w),U.length>0}_queryCell(r,h,m,y,w,P,R,D){const{seenUids:B,hitTest:U,overlapMode:W}=R,$=this.boxCells[w];if($!==null){const Q=this.bboxes;for(const re of $)if(!B.box[re]){B.box[re]=!0;const ae=4*re,le=this.boxKeys[re];if(r<=Q[ae+2]&&h<=Q[ae+3]&&m>=Q[ae+0]&&y>=Q[ae+1]&&(!D||D(le))&&(!U||!Ei(W,le.overlapMode))&&(P.push({key:le,x1:Q[ae],y1:Q[ae+1],x2:Q[ae+2],y2:Q[ae+3]}),U))return!0}}const Z=this.circleCells[w];if(Z!==null){const Q=this.circles;for(const re of Z)if(!B.circle[re]){B.circle[re]=!0;const ae=3*re,le=this.circleKeys[re];if(this._circleAndRectCollide(Q[ae],Q[ae+1],Q[ae+2],r,h,m,y)&&(!D||D(le))&&(!U||!Ei(W,le.overlapMode))){const pe=Q[ae],be=Q[ae+1],fe=Q[ae+2];if(P.push({key:le,x1:pe-fe,y1:be-fe,x2:pe+fe,y2:be+fe}),U)return!0}}}return!1}_queryCellCircle(r,h,m,y,w,P,R,D){const{circle:B,seenUids:U,overlapMode:W}=R,$=this.boxCells[w];if($!==null){const Q=this.bboxes;for(const re of $)if(!U.box[re]){U.box[re]=!0;const ae=4*re,le=this.boxKeys[re];if(this._circleAndRectCollide(B.x,B.y,B.radius,Q[ae+0],Q[ae+1],Q[ae+2],Q[ae+3])&&(!D||D(le))&&!Ei(W,le.overlapMode))return P.push(!0),!0}}const Z=this.circleCells[w];if(Z!==null){const Q=this.circles;for(const re of Z)if(!U.circle[re]){U.circle[re]=!0;const ae=3*re,le=this.circleKeys[re];if(this._circlesCollide(Q[ae],Q[ae+1],Q[ae+2],B.x,B.y,B.radius)&&(!D||D(le))&&!Ei(W,le.overlapMode))return P.push(!0),!0}}}_forEachCell(r,h,m,y,w,P,R,D){const B=this._convertToXCellCoord(r),U=this._convertToYCellCoord(h),W=this._convertToXCellCoord(m),$=this._convertToYCellCoord(y);for(let Z=B;Z<=W;Z++)for(let Q=U;Q<=$;Q++)if(w.call(this,r,h,m,y,this.xCellCount*Q+Z,P,R,D))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,h,m,y,w,P){const R=y-r,D=w-h,B=m+P;return B*B>R*R+D*D}_circleAndRectCollide(r,h,m,y,w,P,R){const D=(P-y)/2,B=Math.abs(r-(y+D));if(B>D+m)return!1;const U=(R-w)/2,W=Math.abs(h-(w+U));if(W>U+m)return!1;if(B<=D||W<=U)return!0;const $=B-D,Z=W-U;return $*$+Z*Z<=m*m}}function Pi(x,r,h){const m=a.L();if(!x){const{vecSouth:W,vecEast:$}=Kn(r),Z=A();Z[0]=$[0],Z[1]=$[1],Z[2]=W[0],Z[3]=W[1],y=Z,(U=(P=(w=Z)[0])*(B=w[3])-(D=w[2])*(R=w[1]))&&(y[0]=B*(U=1/U),y[1]=-R*U,y[2]=-D*U,y[3]=P*U),m[0]=Z[0],m[1]=Z[1],m[4]=Z[2],m[5]=Z[3]}var y,w,P,R,D,B,U;return a.N(m,m,[1/h,1/h,1]),m}function Li(x,r,h,m){if(x){const y=a.L();if(!r){const{vecSouth:w,vecEast:P}=Kn(h);y[0]=P[0],y[1]=P[1],y[4]=w[0],y[5]=w[1]}return a.N(y,y,[m,m,1]),y}return h.pixelsToClipSpaceMatrix}function Kn(x){const r=Math.cos(x.rollInRadians),h=Math.sin(x.rollInRadians),m=Math.cos(x.pitchInRadians),y=Math.cos(x.bearingInRadians),w=Math.sin(x.bearingInRadians),P=a.ar();P[0]=-y*m*h-w*r,P[1]=-w*m*h+y*r;const R=a.as(P);R<1e-9?a.at(P):a.au(P,P,1/R);const D=a.ar();D[0]=y*m*r-w*h,D[1]=w*m*r+y*h;const B=a.as(D);return B<1e-9?a.at(D):a.au(D,D,1/B),{vecEast:D,vecSouth:P}}function Fi(x,r,h,m){let y;m?(y=[x,r,m(x,r),1],a.aw(y,y,h)):(y=[x,r,0,1],Il(y,y,h));const w=y[3];return{point:new a.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function lt(x,r){return .5+x/r*.5}function bi(x,r){return x.x>=-r[0]&&x.x<=r[0]&&x.y>=-r[1]&&x.y<=r[1]}function xr(x,r,h,m,y,w,P,R,D,B,U,W,$){const Z=h?x.textSizeData:x.iconSizeData,Q=a.an(Z,r.transform.zoom),re=[256/r.width*2+1,256/r.height*2+1],ae=h?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;ae.clear();const le=x.lineVertexArray,pe=h?x.text.placedSymbolArray:x.icon.placedSymbolArray,be=r.transform.width/r.transform.height;let fe=!1;for(let Ae=0;Ae<pe.length;Ae++){const Me=pe.get(Ae);if(Me.hidden||Me.writingMode===a.ao.vertical&&!fe){ho(Me.numGlyphs,ae);continue}fe=!1;const xe=new a.P(Me.anchorX,Me.anchorY),Re={getElevation:$,pitchedLabelPlaneMatrix:m,lineVertexArray:le,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:r.transform,tileAnchorPoint:xe,unwrappedTileID:D,width:B,height:U,translation:W},Ge=na(Me.anchorX,Me.anchorY,Re);if(!bi(Ge.point,re)){ho(Me.numGlyphs,ae);continue}const qe=lt(r.transform.cameraToCenterDistance,Ge.signedDistanceFromCamera),Ye=a.ap(Z,Q,Me),tt=w?Ye*r.transform.getPitchedTextCorrection(Me.anchorX,Me.anchorY,D)/qe:Ye*qe,bt=wt({projectionContext:Re,pitchedLabelPlaneMatrixInverse:y,symbol:Me,fontSize:tt,flip:!1,keepUpright:P,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:be,rotateToLine:R});fe=bt.useVertical,(bt.notEnoughRoom||fe||bt.needsFlipping&&wt({projectionContext:Re,pitchedLabelPlaneMatrixInverse:y,symbol:Me,fontSize:tt,flip:!0,keepUpright:P,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:be,rotateToLine:R}).notEnoughRoom)&&ho(Me.numGlyphs,ae)}h?x.text.dynamicLayoutVertexBuffer.updateData(ae):x.icon.dynamicLayoutVertexBuffer.updateData(ae)}function Co(x,r,h,m,y,w,P,R){const D=w.glyphStartIndex+w.numGlyphs,B=w.lineStartIndex,U=w.lineStartIndex+w.lineLength,W=r.getoffsetX(w.glyphStartIndex),$=r.getoffsetX(D-1),Z=Io(x*W,h,m,y,w.segment,B,U,R,P);if(!Z)return null;const Q=Io(x*$,h,m,y,w.segment,B,U,R,P);return Q?R.projectionCache.anyProjectionOccluded?null:{first:Z,last:Q}:null}function br(x,r,h,m){return x===a.ao.horizontal&&Math.abs(h.y-r.y)>Math.abs(h.x-r.x)*m?{useVertical:!0}:(x===a.ao.vertical?r.y<h.y:r.x>h.x)?{needsFlipping:!0}:null}function wt(x){const{projectionContext:r,pitchedLabelPlaneMatrixInverse:h,symbol:m,fontSize:y,flip:w,keepUpright:P,glyphOffsetArray:R,dynamicLayoutVertexArray:D,aspectRatio:B,rotateToLine:U}=x,W=y/24,$=m.lineOffsetX*W,Z=m.lineOffsetY*W;let Q;if(m.numGlyphs>1){const re=m.glyphStartIndex+m.numGlyphs,ae=m.lineStartIndex,le=m.lineStartIndex+m.lineLength,pe=Co(W,R,$,Z,w,m,U,r);if(!pe)return{notEnoughRoom:!0};const be=ta(pe.first.point.x,pe.first.point.y,r,h),fe=ta(pe.last.point.x,pe.last.point.y,r,h);if(P&&!w){const Ae=br(m.writingMode,be,fe,B);if(Ae)return Ae}Q=[pe.first];for(let Ae=m.glyphStartIndex+1;Ae<re-1;Ae++){const Me=Io(W*R.getoffsetX(Ae),$,Z,w,m.segment,ae,le,r,U);if(!Me)return{notEnoughRoom:!0};Q.push(Me)}Q.push(pe.last)}else{if(P&&!w){const ae=tr(r.tileAnchorPoint.x,r.tileAnchorPoint.y,r).point,le=m.lineStartIndex+m.segment+1,pe=new a.P(r.lineVertexArray.getx(le),r.lineVertexArray.gety(le)),be=tr(pe.x,pe.y,r),fe=be.signedDistanceFromCamera>0?be.point:wn(r.tileAnchorPoint,pe,ae,1,r),Ae=ta(ae.x,ae.y,r,h),Me=ta(fe.x,fe.y,r,h),xe=br(m.writingMode,Ae,Me,B);if(xe)return xe}const re=Io(W*R.getoffsetX(m.glyphStartIndex),$,Z,w,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,r,U);if(!re||r.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Q=[re]}for(const re of Q)a.av(D,re.point,re.angle);return{}}function wn(x,r,h,m,y){const w=x.add(x.sub(r)._unit()),P=tr(w.x,w.y,y).point,R=h.sub(P);return h.add(R._mult(m/R.mag()))}function mn(x,r,h){const m=r.projectionCache;if(m.projections[x])return m.projections[x];const y=new a.P(r.lineVertexArray.getx(x),r.lineVertexArray.gety(x)),w=tr(y.x,y.y,r);if(w.signedDistanceFromCamera>0)return m.projections[x]=w.point,m.anyProjectionOccluded=m.anyProjectionOccluded||w.isOccluded,w.point;const P=x-h.direction;return wn(h.distanceFromAnchor===0?r.tileAnchorPoint:new a.P(r.lineVertexArray.getx(P),r.lineVertexArray.gety(P)),y,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,r)}function tr(x,r,h){const m=x+h.translation[0],y=r+h.translation[1];let w;return h.pitchWithMap?(w=Fi(m,y,h.pitchedLabelPlaneMatrix,h.getElevation),w.isOccluded=!1):(w=h.transform.projectTileCoordinates(m,y,h.unwrappedTileID,h.getElevation),w.point.x=(.5*w.point.x+.5)*h.width,w.point.y=(.5*-w.point.y+.5)*h.height),w}function ta(x,r,h,m){if(h.pitchWithMap){const y=[x,r,0,1];return a.aw(y,y,m),h.transform.projectTileCoordinates(y[0]/y[3],y[1]/y[3],h.unwrappedTileID,h.getElevation).point}return{x:x/h.width*2-1,y:1-r/h.height*2}}function na(x,r,h){return h.transform.projectTileCoordinates(x,r,h.unwrappedTileID,h.getElevation)}function vn(x,r,h){return x._unit()._perp()._mult(r*h)}function Mc(x,r,h,m,y,w,P,R,D){if(R.projectionCache.offsets[x])return R.projectionCache.offsets[x];const B=h.add(r);if(x+D.direction<m||x+D.direction>=y)return R.projectionCache.offsets[x]=B,B;const U=mn(x+D.direction,R,D),W=vn(U.sub(h),P,D.direction),$=h.add(W),Z=U.add(W);return R.projectionCache.offsets[x]=a.ax(w,B,$,Z)||B,R.projectionCache.offsets[x]}function Io(x,r,h,m,y,w,P,R,D){const B=m?x-r:x+r;let U=B>0?1:-1,W=0;m&&(U*=-1,W=Math.PI),U<0&&(W+=Math.PI);let $,Z=U>0?w+y:w+y+1;R.projectionCache.cachedAnchorPoint?$=R.projectionCache.cachedAnchorPoint:($=tr(R.tileAnchorPoint.x,R.tileAnchorPoint.y,R).point,R.projectionCache.cachedAnchorPoint=$);let Q,re,ae=$,le=$,pe=0,be=0;const fe=Math.abs(B),Ae=[];let Me;for(;pe+be<=fe;){if(Z+=U,Z<w||Z>=P)return null;pe+=be,le=ae,re=Q;const Ge={absOffsetX:fe,direction:U,distanceFromAnchor:pe,previousVertex:le};if(ae=mn(Z,R,Ge),h===0)Ae.push(le),Me=ae.sub(le);else{let qe;const Ye=ae.sub(le);qe=Ye.mag()===0?vn(mn(Z+U,R,Ge).sub(ae),h,U):vn(Ye,h,U),re||(re=le.add(qe)),Q=Mc(Z,qe,ae,w,P,re,h,R,Ge),Ae.push(re),Me=Q.sub(re)}be=Me.mag()}const xe=Me._mult((fe-pe)/be)._add(re||le),Re=W+Math.atan2(ae.y-le.y,ae.x-le.x);return Ae.push(xe),{point:xe,angle:D?Re:0,path:Ae}}const Rc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ho(x,r){for(let h=0;h<x;h++){const m=r.length;r.resize(m+4),r.float32.set(Rc,3*m)}}function Il(x,r,h){const m=r[0],y=r[1];return x[0]=h[0]*m+h[4]*y+h[12],x[1]=h[1]*m+h[5]*y+h[13],x[3]=h[3]*m+h[7]*y+h[15],x}const Pn=100;class Ru{constructor(r,h=new $i(r.width+200,r.height+200,25),m=new $i(r.width+200,r.height+200,25)){this.transform=r,this.grid=h,this.ignoredGrid=m,this.pitchFactor=Math.cos(r.pitch*Math.PI/180)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Pn,this.screenBottomBoundary=r.height+Pn,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,h,m,y,w,P,R,D,B,U,W,$){const Z=this.projectAndGetPerspectiveRatio(r.anchorPointX+D[0],r.anchorPointY+D[1],w,U,$),Q=m*Z.perspectiveRatio;let re;if(P||R)re=this._projectCollisionBox(r,Q,y,w,P,R,D,Z,U,W,$);else{const Me=Z.x+(W?W.x*Q:0),xe=Z.y+(W?W.y*Q:0);re={allPointsOccluded:!1,box:[Me+r.x1*Q,xe+r.y1*Q,Me+r.x2*Q,xe+r.y2*Q]}}const[ae,le,pe,be]=re.box,fe=P?re.allPointsOccluded:Z.isOccluded;let Ae=fe;return Ae||(Ae=Z.perspectiveRatio<this.perspectiveRatioCutoff),Ae||(Ae=!this.isInsideGrid(ae,le,pe,be)),Ae||h!=="always"&&this.grid.hitTest(ae,le,pe,be,h,B)?{box:[ae,le,pe,be],placeable:!1,offscreen:!1,occluded:fe}:{box:[ae,le,pe,be],placeable:!0,offscreen:this.isOffscreen(ae,le,pe,be),occluded:fe}}placeCollisionCircles(r,h,m,y,w,P,R,D,B,U,W,$,Z,Q){const re=[],ae=new a.P(h.anchorX,h.anchorY),le=this.getPerspectiveRatio(ae.x,ae.y,P,Q),pe=(B?w*this.transform.getPitchedTextCorrection(h.anchorX,h.anchorY,P)/le:w*le)/a.aB,be={getElevation:Q,pitchedLabelPlaneMatrix:R,lineVertexArray:m,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ae,unwrappedTileID:P,width:this.transform.width,height:this.transform.height,translation:Z},fe=Co(pe,y,h.lineOffsetX*pe,h.lineOffsetY*pe,!1,h,!1,be);let Ae=!1,Me=!1,xe=!0;if(fe){const Re=.5*W*le+$,Ge=new a.P(-100,-100),qe=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Ye=new ai,tt=fe.first,bt=fe.last;let _t=[];for(let xn=tt.path.length-1;xn>=1;xn--)_t.push(tt.path[xn]);for(let xn=1;xn<bt.path.length;xn++)_t.push(bt.path[xn]);const ht=2.5*Re;if(B){const xn=this.projectPathToScreenSpace(_t,be);_t=xn.some((qn=>qn.signedDistanceFromCamera<=0))?[]:xn.map((qn=>qn.point))}let Bt=[];if(_t.length>0){const xn=_t[0].clone(),qn=_t[0].clone();for(let ui=1;ui<_t.length;ui++)xn.x=Math.min(xn.x,_t[ui].x),xn.y=Math.min(xn.y,_t[ui].y),qn.x=Math.max(qn.x,_t[ui].x),qn.y=Math.max(qn.y,_t[ui].y);Bt=xn.x>=Ge.x&&qn.x<=qe.x&&xn.y>=Ge.y&&qn.y<=qe.y?[_t]:qn.x<Ge.x||xn.x>qe.x||qn.y<Ge.y||xn.y>qe.y?[]:a.ay([_t],Ge.x,Ge.y,qe.x,qe.y)}for(const xn of Bt){Ye.reset(xn,.25*Re);let qn=0;qn=Ye.length<=.5*Re?1:Math.ceil(Ye.paddedLength/ht)+1;for(let ui=0;ui<qn;ui++){const oi=ui/Math.max(qn-1,1),ni=Ye.lerp(oi),hi=ni.x+Pn,Di=ni.y+Pn;re.push(hi,Di,Re,0);const ii=hi-Re,Qn=Di-Re,mi=hi+Re,En=Di+Re;if(xe=xe&&this.isOffscreen(ii,Qn,mi,En),Me=Me||this.isInsideGrid(ii,Qn,mi,En),r!=="always"&&this.grid.hitTestCircle(hi,Di,Re,r,U)&&(Ae=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Ae}}}}return{circles:!D&&Ae||!Me||le<this.perspectiveRatioCutoff?[]:re,offscreen:xe,collisionDetected:Ae}}projectPathToScreenSpace(r,h){const m=(function(y,w){const P=a.L();return a.aq(P,w.pitchedLabelPlaneMatrix),y.map((R=>{const D=Fi(R.x,R.y,P,w.getElevation),B=w.transform.projectTileCoordinates(D.point.x,D.point.y,w.unwrappedTileID,w.getElevation);return B.point.x=(.5*B.point.x+.5)*w.width,B.point.y=(.5*-B.point.y+.5)*w.height,B}))})(r,h);return(function(y){let w=0,P=0,R=0,D=0;for(let B=0;B<y.length;B++)y[B].isOccluded?(R=B+1,D=0):(D++,D>P&&(P=D,w=R));return y.slice(w,w+P)})(m)}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[],m=new a.a2;for(const W of r){const $=new a.P(W.x+Pn,W.y+Pn);m.extend($),h.push($)}const{minX:y,minY:w,maxX:P,maxY:R}=m,D=this.grid.query(y,w,P,R).concat(this.ignoredGrid.query(y,w,P,R)),B={},U={};for(const W of D){const $=W.key;if(B[$.bucketInstanceId]===void 0&&(B[$.bucketInstanceId]={}),B[$.bucketInstanceId][$.featureIndex])continue;const Z=[new a.P(W.x1,W.y1),new a.P(W.x2,W.y1),new a.P(W.x2,W.y2),new a.P(W.x1,W.y2)];a.az(h,Z)&&(B[$.bucketInstanceId][$.featureIndex]=!0,U[$.bucketInstanceId]===void 0&&(U[$.bucketInstanceId]=[]),U[$.bucketInstanceId].push($.featureIndex))}return U}insertCollisionBox(r,h,m,y,w,P){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:P,overlapMode:h},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,h,m,y,w,P){const R=m?this.ignoredGrid:this.grid,D={bucketInstanceId:y,featureIndex:w,collisionGroupID:P,overlapMode:h};for(let B=0;B<r.length;B+=4)R.insertCircle(D,r[B],r[B+1],r[B+2])}projectAndGetPerspectiveRatio(r,h,m,y,w){if(w){let P;y?(P=[r,h,y(r,h),1],a.aw(P,P,w)):(P=[r,h,0,1],Il(P,P,w));const R=P[3];return{x:(P[0]/R+1)/2*this.transform.width+Pn,y:(-P[1]/R+1)/2*this.transform.height+Pn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/R*.5,isOccluded:!1,signedDistanceFromCamera:R}}{const P=this.transform.projectTileCoordinates(r,h,m,y);return{x:(P.point.x+1)/2*this.transform.width+Pn,y:(1-P.point.y)/2*this.transform.height+Pn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/P.signedDistanceFromCamera*.5,isOccluded:P.isOccluded,signedDistanceFromCamera:P.signedDistanceFromCamera}}}getPerspectiveRatio(r,h,m,y){const w=this.transform.projectTileCoordinates(r,h,m,y);return .5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5}isOffscreen(r,h,m,y){return m<Pn||r>=this.screenRightBoundary||y<Pn||h>this.screenBottomBoundary}isInsideGrid(r,h,m,y){return m>=0&&r<this.gridRightBoundary&&y>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const r=a.ag([]);return a.M(r,r,[-100,-100,0]),r}_projectCollisionBox(r,h,m,y,w,P,R,D,B,U,W){let $=1,Z=0,Q=0,re=1;const ae=r.anchorPointX+R[0],le=r.anchorPointY+R[1];if(P&&!w){const _t=this.projectAndGetPerspectiveRatio(ae+1,le,y,B,W),ht=_t.x-D.x,Bt=Math.atan((_t.y-D.y)/ht)+(ht<0?Math.PI:0),xn=Math.sin(Bt),qn=Math.cos(Bt);$=qn,Z=xn,Q=-xn,re=qn}else if(!P&&w){const _t=Kn(this.transform);$=_t.vecEast[0],Z=_t.vecEast[1],Q=_t.vecSouth[0],re=_t.vecSouth[1]}let pe=D.x,be=D.y,fe=h;w&&(pe=ae,be=le,fe=Math.pow(2,-(this.transform.zoom-m.overscaledZ)),fe*=this.transform.getPitchedTextCorrection(ae,le,y),U||(fe*=a.ah(.5+D.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),U&&(pe+=$*U.x*fe+Q*U.y*fe,be+=Z*U.x*fe+re*U.y*fe);const Ae=r.x1*fe,Me=r.x2*fe,xe=(Ae+Me)/2,Re=r.y1*fe,Ge=r.y2*fe,qe=(Re+Ge)/2,Ye=[{offsetX:Ae,offsetY:Re},{offsetX:xe,offsetY:Re},{offsetX:Me,offsetY:Re},{offsetX:Me,offsetY:qe},{offsetX:Me,offsetY:Ge},{offsetX:xe,offsetY:Ge},{offsetX:Ae,offsetY:Ge},{offsetX:Ae,offsetY:qe}];let tt=[];for(const{offsetX:_t,offsetY:ht}of Ye)tt.push(new a.P(pe+$*_t+Q*ht,be+Z*_t+re*ht));let bt=!1;if(w){const _t=tt.map((ht=>this.projectAndGetPerspectiveRatio(ht.x,ht.y,y,B,W)));bt=_t.some((ht=>!ht.isOccluded)),tt=_t.map((ht=>new a.P(ht.x,ht.y)))}else bt=!0;return{box:a.aA(tt),allPointsOccluded:!bt}}}class wr{constructor(r,h,m,y){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?h:-h))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class ei{constructor(r,h,m,y,w){this.text=new wr(r?r.text:null,h,m,w),this.icon=new wr(r?r.icon:null,h,y,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kc{constructor(r,h,m){this.text=r,this.icon=h,this.skipFade=m}}class Dc{constructor(r,h,m,y,w){this.bucketInstanceId=r,this.featureIndex=h,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=w}}class ku{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const h=++this.maxGroupID;this.collisionGroups[r]={ID:h,predicate:m=>m.collisionGroupID===h}}return this.collisionGroups[r]}}function Xs(x,r,h,m,y){const{horizontalAlign:w,verticalAlign:P}=a.aH(x);return new a.P(-(w-.5)*r+m[0]*y,-(P-.5)*h+m[1]*y)}class dr{constructor(r,h,m,y,w){this.transform=r.clone(),this.terrain=h,this.collisionIndex=new Ru(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new ku(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(r){const h=this.terrain;return h?(m,y)=>h.getElevation(r,m,y):null}getBucketParts(r,h,m,y){const w=m.getBucket(h),P=m.latestFeatureIndex;if(!w||!P||h.id!==w.layerIds[0])return;const R=m.collisionBoxArray,D=w.layers[0].layout,B=w.layers[0].paint,U=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),W=m.tileSize/a.$,$=m.tileID.toUnwrapped(),Z=D.get("text-rotation-alignment")==="map",Q=a.aC(m,1,this.transform.zoom),re=a.aD(this.collisionIndex.transform,m,B.get("text-translate"),B.get("text-translate-anchor")),ae=a.aD(this.collisionIndex.transform,m,B.get("icon-translate"),B.get("icon-translate-anchor")),le=Pi(Z,this.transform,Q);this.retainedQueryData[w.bucketInstanceId]=new Dc(w.bucketInstanceId,P,w.sourceLayerIndex,w.index,m.tileID);const pe={bucket:w,layout:D,translationText:re,translationIcon:ae,unwrappedTileID:$,pitchedLabelPlaneMatrix:le,scale:U,textPixelRatio:W,holdingForFade:m.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:a.an(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(y)for(const be of w.sortKeyRanges){const{sortKey:fe,symbolInstanceStart:Ae,symbolInstanceEnd:Me}=be;r.push({sortKey:fe,symbolInstanceStart:Ae,symbolInstanceEnd:Me,parameters:pe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(r,h,m,y,w,P,R,D,B,U,W,$,Z,Q,re,ae,le,pe,be,fe){const Ae=a.aE[r.textAnchor],Me=[r.textOffset0,r.textOffset1],xe=Xs(Ae,m,y,Me,w),Re=this.collisionIndex.placeCollisionBox(h,$,D,B,U,R,P,ae,W.predicate,be,xe,fe);if((!pe||this.collisionIndex.placeCollisionBox(pe,$,D,B,U,R,P,le,W.predicate,be,xe,fe).placeable)&&Re.placeable){let Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:Me,width:m,height:y,anchor:Ae,textBoxScale:w,prevAnchor:Ge},this.markUsedJustification(Q,Ae,Z,re),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,re,Z),this.placedOrientations[Z.crossTileID]=re),{shift:xe,placedGlyphBoxes:Re}}}placeLayerBucketPart(r,h,m){const{bucket:y,layout:w,translationText:P,translationIcon:R,unwrappedTileID:D,pitchedLabelPlaneMatrix:B,textPixelRatio:U,holdingForFade:W,collisionBoxArray:$,partiallyEvaluatedTextSize:Z,collisionGroup:Q}=r.parameters,re=w.get("text-optional"),ae=w.get("icon-optional"),le=a.aF(w,"text-overlap","text-allow-overlap"),pe=le==="always",be=a.aF(w,"icon-overlap","icon-allow-overlap"),fe=be==="always",Ae=w.get("text-rotation-alignment")==="map",Me=w.get("text-pitch-alignment")==="map",xe=w.get("icon-text-fit")!=="none",Re=w.get("symbol-z-order")==="viewport-y",Ge=pe&&(fe||!y.hasIconData()||ae),qe=fe&&(pe||!y.hasTextData()||re);!y.collisionArrays&&$&&y.deserializeCollisionBoxes($);const Ye=this.retainedQueryData[y.bucketInstanceId].tileID,tt=this._getTerrainElevationFunc(Ye),bt=this.transform.getFastPathSimpleProjectionMatrix(Ye),_t=(ht,Bt,xn)=>{var qn,ui;if(h[ht.crossTileID])return;if(W)return void(this.placements[ht.crossTileID]=new kc(!1,!1,!1));let oi=!1,ni=!1,hi=!0,Di=null,ii={box:null,placeable:!1,offscreen:null,occluded:!1},Qn={placeable:!1},mi=null,En=null,rr=null,To=0,ba=0,So=0;Bt.textFeatureIndex?To=Bt.textFeatureIndex:ht.useRuntimeCollisionCircles&&(To=ht.featureIndex),Bt.verticalTextFeatureIndex&&(ba=Bt.verticalTextFeatureIndex);const wa=Bt.textBox;if(wa){const is=Ui=>{let ji=a.ao.horizontal;if(y.allowVerticalPlacement&&!Ui&&this.prevPlacement){const sr=this.prevPlacement.placedOrientations[ht.crossTileID];sr&&(this.placedOrientations[ht.crossTileID]=sr,ji=sr,this.markUsedOrientation(y,ji,ht))}return ji},Ta=(Ui,ji)=>{if(y.allowVerticalPlacement&&ht.numVerticalGlyphVertices>0&&Bt.verticalTextBox){for(const sr of y.writingModes)if(sr===a.ao.vertical?(ii=ji(),Qn=ii):ii=Ui(),ii&&ii.placeable)break}else ii=Ui()},jo=ht.textAnchorOffsetStartIndex,Vo=ht.textAnchorOffsetEndIndex;if(Vo===jo){const Ui=(ji,sr)=>{const gi=this.collisionIndex.placeCollisionBox(ji,le,U,Ye,D,Me,Ae,P,Q.predicate,tt,void 0,bt);return gi&&gi.placeable&&(this.markUsedOrientation(y,sr,ht),this.placedOrientations[ht.crossTileID]=sr),gi};Ta((()=>Ui(wa,a.ao.horizontal)),(()=>{const ji=Bt.verticalTextBox;return y.allowVerticalPlacement&&ht.numVerticalGlyphVertices>0&&ji?Ui(ji,a.ao.vertical):{box:null,offscreen:null}})),is(ii&&ii.placeable)}else{let Ui=a.aE[(ui=(qn=this.prevPlacement)===null||qn===void 0?void 0:qn.variableOffsets[ht.crossTileID])===null||ui===void 0?void 0:ui.anchor];const ji=(gi,th,uf)=>{const Fs=gi.x2-gi.x1,ad=gi.y2-gi.y1,oc=ht.textBoxScale,ac=xe&&be==="never"?th:null;let rs=null,ro=le==="never"?1:2,ss="never";Ui&&ro++;for(let os=0;os<ro;os++){for(let lc=jo;lc<Vo;lc++){const uu=y.textAnchorOffsets.get(lc);if(Ui&&uu.textAnchor!==Ui)continue;const nh=this.attemptAnchorPlacement(uu,gi,Fs,ad,oc,Ae,Me,U,Ye,D,Q,ss,ht,y,uf,P,R,ac,tt);if(nh&&(rs=nh.placedGlyphBoxes,rs&&rs.placeable))return oi=!0,Di=nh.shift,rs}Ui?Ui=null:ss=le}return m&&!rs&&(rs={box:this.collisionIndex.placeCollisionBox(wa,"always",U,Ye,D,Me,Ae,P,Q.predicate,tt,void 0,bt).box,offscreen:!1,placeable:!1,occluded:!1}),rs};Ta((()=>ji(wa,Bt.iconBox,a.ao.horizontal)),(()=>{const gi=Bt.verticalTextBox;return y.allowVerticalPlacement&&(!ii||!ii.placeable)&&ht.numVerticalGlyphVertices>0&&gi?ji(gi,Bt.verticalIconBox,a.ao.vertical):{box:null,occluded:!0,offscreen:null}})),ii&&(oi=ii.placeable,hi=ii.offscreen);const sr=is(ii&&ii.placeable);if(!oi&&this.prevPlacement){const gi=this.prevPlacement.variableOffsets[ht.crossTileID];gi&&(this.variableOffsets[ht.crossTileID]=gi,this.markUsedJustification(y,gi.anchor,ht,sr))}}}if(mi=ii,oi=mi&&mi.placeable,hi=mi&&mi.offscreen,ht.useRuntimeCollisionCircles&&ht.centerJustifiedTextSymbolIndex>=0){const is=y.text.placedSymbolArray.get(ht.centerJustifiedTextSymbolIndex),Ta=a.ap(y.textSizeData,Z,is),jo=w.get("text-padding");En=this.collisionIndex.placeCollisionCircles(le,is,y.lineVertexArray,y.glyphOffsetArray,Ta,D,B,m,Me,Q.predicate,ht.collisionCircleDiameter,jo,P,tt),En.circles.length&&En.collisionDetected&&!m&&a.w("Collisions detected, but collision boxes are not shown"),oi=pe||En.circles.length>0&&!En.collisionDetected,hi=hi&&En.offscreen}if(Bt.iconFeatureIndex&&(So=Bt.iconFeatureIndex),Bt.iconBox){const is=Ta=>this.collisionIndex.placeCollisionBox(Ta,be,U,Ye,D,Me,Ae,R,Q.predicate,tt,xe&&Di?Di:void 0,bt);Qn&&Qn.placeable&&Bt.verticalIconBox?(rr=is(Bt.verticalIconBox),ni=rr.placeable):(rr=is(Bt.iconBox),ni=rr.placeable),hi=hi&&rr.offscreen}const sc=re||ht.numHorizontalGlyphVertices===0&&ht.numVerticalGlyphVertices===0,Uo=ae||ht.numIconVertices===0;sc||Uo?Uo?sc||(ni=ni&&oi):oi=ni&&oi:ni=oi=ni&&oi;const hl=ni&&rr.placeable;if(oi&&mi.placeable&&this.collisionIndex.insertCollisionBox(mi.box,le,w.get("text-ignore-placement"),y.bucketInstanceId,Qn&&Qn.placeable&&ba?ba:To,Q.ID),hl&&this.collisionIndex.insertCollisionBox(rr.box,be,w.get("icon-ignore-placement"),y.bucketInstanceId,So,Q.ID),En&&oi&&this.collisionIndex.insertCollisionCircles(En.circles,le,w.get("text-ignore-placement"),y.bucketInstanceId,To,Q.ID),m&&this.storeCollisionData(y.bucketInstanceId,xn,Bt,mi,rr,En),ht.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ht.crossTileID]=new kc((oi||Ge)&&!mi?.occluded,(ni||qe)&&!rr?.occluded,hi||y.justReloaded),h[ht.crossTileID]=!0};if(Re){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ht=y.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Bt=ht.length-1;Bt>=0;--Bt){const xn=ht[Bt];_t(y.symbolInstances.get(xn),y.collisionArrays[xn],xn)}}else for(let ht=r.symbolInstanceStart;ht<r.symbolInstanceEnd;ht++)_t(y.symbolInstances.get(ht),y.collisionArrays[ht],ht);y.justReloaded=!1}storeCollisionData(r,h,m,y,w,P){if(m.textBox||m.iconBox){let R,D;this.collisionBoxArrays.has(r)?R=this.collisionBoxArrays.get(r):(R=new Map,this.collisionBoxArrays.set(r,R)),R.has(h)?D=R.get(h):(D={text:null,icon:null},R.set(h,D)),m.textBox&&(D.text=y.box),m.iconBox&&(D.icon=w.box)}if(P){let R=this.collisionCircleArrays[r];R===void 0&&(R=this.collisionCircleArrays[r]=[]);for(let D=0;D<P.circles.length;D+=4)R.push(P.circles[D+0]-Pn),R.push(P.circles[D+1]-Pn),R.push(P.circles[D+2]),R.push(P.collisionDetected?1:0)}}markUsedJustification(r,h,m,y){let w;w=y===a.ao.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[a.aG(h)];const P=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const R of P)R>=0&&(r.text.placedSymbolArray.get(R).crossTileID=w>=0&&R!==w?0:m.crossTileID)}markUsedOrientation(r,h,m){const y=h===a.ao.horizontal||h===a.ao.horizontalOnly?h:0,w=h===a.ao.vertical?h:0,P=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const R of P)r.text.placedSymbolArray.get(R).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let m=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const y=h?h.symbolFadeChange(r):1,w=h?h.opacities:{},P=h?h.variableOffsets:{},R=h?h.placedOrientations:{};for(const D in this.placements){const B=this.placements[D],U=w[D];U?(this.opacities[D]=new ei(U,y,B.text,B.icon),m=m||B.text!==U.text.placed||B.icon!==U.icon.placed):(this.opacities[D]=new ei(null,y,B.text,B.icon,B.skipFade),m=m||B.text||B.icon)}for(const D in w){const B=w[D];if(!this.opacities[D]){const U=new ei(B,y,!1,!1);U.isHidden()||(this.opacities[D]=U,m=m||B.text.placed||B.icon.placed)}}for(const D in P)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=P[D]);for(const D in R)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=R[D]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:r)}updateLayerOpacities(r,h){const m={};for(const y of h){const w=y.getBucket(r);w&&y.latestFeatureIndex&&r.id===w.layerIds[0]&&this.updateBucketOpacities(w,y.tileID,m,y.collisionBoxArray)}}updateBucketOpacities(r,h,m,y){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const w=r.layers[0],P=w.layout,R=new ei(null,0,!1,!1,!0),D=P.get("text-allow-overlap"),B=P.get("icon-allow-overlap"),U=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),W=P.get("text-rotation-alignment")==="map",$=P.get("text-pitch-alignment")==="map",Z=P.get("icon-text-fit")!=="none",Q=new ei(null,0,D&&(B||!r.hasIconData()||P.get("icon-optional")),B&&(D||!r.hasTextData()||P.get("text-optional")),!0);!r.collisionArrays&&y&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(y);const re=(le,pe,be)=>{for(let fe=0;fe<pe/4;fe++)le.opacityVertexArray.emplaceBack(be);le.hasVisibleVertices=le.hasVisibleVertices||be!==kl},ae=this.collisionBoxArrays.get(r.bucketInstanceId);for(let le=0;le<r.symbolInstances.length;le++){const pe=r.symbolInstances.get(le),{numHorizontalGlyphVertices:be,numVerticalGlyphVertices:fe,crossTileID:Ae}=pe;let Me=this.opacities[Ae];m[Ae]?Me=R:Me||(Me=Q,this.opacities[Ae]=Me),m[Ae]=!0;const xe=pe.numIconVertices>0,Re=this.placedOrientations[pe.crossTileID],Ge=Re===a.ao.vertical,qe=Re===a.ao.horizontal||Re===a.ao.horizontalOnly;if(be>0||fe>0){const tt=Rl(Me.text);re(r.text,be,Ge?kl:tt),re(r.text,fe,qe?kl:tt);const bt=Me.text.isHidden();[pe.rightJustifiedTextSymbolIndex,pe.centerJustifiedTextSymbolIndex,pe.leftJustifiedTextSymbolIndex].forEach((Bt=>{Bt>=0&&(r.text.placedSymbolArray.get(Bt).hidden=bt||Ge?1:0)})),pe.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(pe.verticalPlacedTextSymbolIndex).hidden=bt||qe?1:0);const _t=this.variableOffsets[pe.crossTileID];_t&&this.markUsedJustification(r,_t.anchor,pe,Re);const ht=this.placedOrientations[pe.crossTileID];ht&&(this.markUsedJustification(r,"left",pe,ht),this.markUsedOrientation(r,ht,pe))}if(xe){const tt=Rl(Me.icon),bt=!(Z&&pe.verticalPlacedIconSymbolIndex&&Ge);pe.placedIconSymbolIndex>=0&&(re(r.icon,pe.numIconVertices,bt?tt:kl),r.icon.placedSymbolArray.get(pe.placedIconSymbolIndex).hidden=Me.icon.isHidden()),pe.verticalPlacedIconSymbolIndex>=0&&(re(r.icon,pe.numVerticalIconVertices,bt?kl:tt),r.icon.placedSymbolArray.get(pe.verticalPlacedIconSymbolIndex).hidden=Me.icon.isHidden())}const Ye=ae&&ae.has(le)?ae.get(le):{text:null,icon:null};if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const tt=r.collisionArrays[le];if(tt){let bt=new a.P(0,0);if(tt.textBox||tt.verticalTextBox){let _t=!0;if(U){const ht=this.variableOffsets[Ae];ht?(bt=Xs(ht.anchor,ht.width,ht.height,ht.textOffset,ht.textBoxScale),W&&bt._rotate($?-this.transform.bearingInRadians:this.transform.bearingInRadians)):_t=!1}if(tt.textBox||tt.verticalTextBox){let ht;tt.textBox&&(ht=Ge),tt.verticalTextBox&&(ht=qe),Dh(r.textCollisionBox.collisionVertexArray,Me.text.placed,!_t||ht,Ye.text,bt.x,bt.y)}}if(tt.iconBox||tt.verticalIconBox){const _t=!!(!qe&&tt.verticalIconBox);let ht;tt.iconBox&&(ht=_t),tt.verticalIconBox&&(ht=!_t),Dh(r.iconCollisionBox.collisionVertexArray,Me.icon.placed,ht,Ye.icon,Z?bt.x:0,Z?bt.y:0)}}}}if(r.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);r.bucketInstanceId in this.collisionCircleArrays&&(r.collisionCircleArray=this.collisionCircleArrays[r.bucketInstanceId],delete this.collisionCircleArrays[r.bucketInstanceId])}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,h){const m=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function Dh(x,r,h,m,y,w){m&&m.length!==0||(m=[0,0,0,0]);const P=m[0]-Pn,R=m[1]-Pn,D=m[2]-Pn,B=m[3]-Pn;x.emplaceBack(r?1:0,h?1:0,y||0,w||0,P,R),x.emplaceBack(r?1:0,h?1:0,y||0,w||0,D,R),x.emplaceBack(r?1:0,h?1:0,y||0,w||0,D,B),x.emplaceBack(r?1:0,h?1:0,y||0,w||0,P,B)}const Cs=Math.pow(2,25),Kd=Math.pow(2,24),Ml=Math.pow(2,17),Jd=Math.pow(2,16),Du=Math.pow(2,9),Ou=Math.pow(2,8),Oc=Math.pow(2,1);function Rl(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const r=x.placed?1:0,h=Math.floor(127*x.opacity);return h*Cs+r*Kd+h*Ml+r*Jd+h*Du+r*Ou+h*Oc+r}const kl=0;class Oh{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,h,m,y,w){const P=this._bucketParts;for(;this._currentTileIndex<r.length;)if(h.getBucketParts(P,y,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(((R,D)=>R.sortKey-D.sortKey)));this._currentPartIndex<P.length;)if(h.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,w())return!0;return!1}}class Lc{constructor(r,h,m,y,w,P,R,D){this.placement=new dr(r,h,P,R,D),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(r,h,m){const y=L.now(),w=()=>!this._forceFullPlacement&&L.now()-y>2;for(;this._currentPlacementIndex>=0;){const P=h[r[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=R)&&(!P.maxzoom||P.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Oh(P)),this._inProgressLayer.continuePlacement(m[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Ba=512/a.$/2;class Fc{constructor(r,h,m){this.tileID=r,this.bucketInstanceId=m,this._symbolsByKey={};const y=new Map;for(let w=0;w<h.length;w++){const P=h.get(w),R=P.key,D=y.get(R);D?D.push(P):y.set(R,[P])}for(const[w,P]of y){const R={positions:P.map((D=>({x:Math.floor(D.anchorX*Ba),y:Math.floor(D.anchorY*Ba)}))),crossTileIDs:P.map((D=>D.crossTileID))};if(R.positions.length>128){const D=new a.aI(R.positions.length,16,Uint16Array);for(const{x:B,y:U}of R.positions)D.add(B,U);D.finish(),delete R.positions,R.index=D}this._symbolsByKey[w]=R}}getScaledCoordinates(r,h){const{x:m,y,z:w}=this.tileID.canonical,{x:P,y:R,z:D}=h.canonical,B=Ba/Math.pow(2,D-w),U=(R*a.$+r.anchorY)*B,W=y*a.$*Ba;return{x:Math.floor((P*a.$+r.anchorX)*B-m*a.$*Ba),y:Math.floor(U-W)}}findMatches(r,h,m){const y=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let w=0;w<r.length;w++){const P=r.get(w);if(P.crossTileID)continue;const R=this._symbolsByKey[P.key];if(!R)continue;const D=this.getScaledCoordinates(P,h);if(R.index){const B=R.index.range(D.x-y,D.y-y,D.x+y,D.y+y).sort();for(const U of B){const W=R.crossTileIDs[U];if(!m[W]){m[W]=!0,P.crossTileID=W;break}}}else if(R.positions)for(let B=0;B<R.positions.length;B++){const U=R.positions[B],W=R.crossTileIDs[B];if(Math.abs(U.x-D.x)<=y&&Math.abs(U.y-D.y)<=y&&!m[W]){m[W]=!0,P.crossTileID=W;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:r})=>r))}}class za{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Up{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const h=Math.round((r-this.lng)/360);if(h!==0)for(const m in this.indexes){const y=this.indexes[m],w={};for(const P in y){const R=y[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+h),w[R.tileID.key]=R}this.indexes[m]=w}this.lng=r}addBucket(r,h,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const y=this.usedCrossTileIDs[r.overscaledZ];for(const w in this.indexes){const P=this.indexes[w];if(Number(w)>r.overscaledZ)for(const R in P){const D=P[R];D.tileID.isChildOf(r)&&D.findMatches(h.symbolInstances,r,y)}else{const R=P[r.scaledTo(Number(w)).key];R&&R.findMatches(h.symbolInstances,r,y)}}for(let w=0;w<h.symbolInstances.length;w++){const P=h.symbolInstances.get(w);P.crossTileID||(P.crossTileID=m.generate(),y[P.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Fc(r,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(r,h){for(const m of h.getCrossTileIDsLists())for(const y of m)delete this.usedCrossTileIDs[r][y]}removeStaleBuckets(r){let h=!1;for(const m in this.indexes){const y=this.indexes[m];for(const w in y)r[y[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[w]),delete y[w],h=!0)}return h}}class ia{constructor(){this.layerIndexes={},this.crossTileIDs=new za,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,h,m){let y=this.layerIndexes[r.id];y===void 0&&(y=this.layerIndexes[r.id]=new Up);let w=!1;const P={};y.handleWrapJump(m);for(const R of h){const D=R.getBucket(r);D&&r.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(R.tileID,D,this.crossTileIDs)&&(w=!0),P[D.bucketInstanceId]=!0)}return y.removeStaleBuckets(P)&&(w=!0),w}pruneUnusedLayers(r){const h={};r.forEach((m=>{h[m]=!0}));for(const m in this.layerIndexes)h[m]||delete this.layerIndexes[m]}}var Zn="void main() {fragColor=vec4(1.0);}";const Is={prelude:Cn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Cn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Cn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Cn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Cn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Cn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Cn(Zn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Cn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Cn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Cn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Cn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Cn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Cn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Cn(Zn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Cn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Cn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Cn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Cn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Cn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Cn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Cn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Cn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Cn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Cn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Cn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Cn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Cn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Cn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Cn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Cn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Cn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Cn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Cn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Cn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Cn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Cn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Cn(x,r){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=r.match(/in ([\w]+) ([\w]+)/g),y=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(y):y,R={};return{fragmentSource:x=x.replace(h,((D,B,U,W,$)=>(R[$]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${$}
in ${U} ${W} ${$};
#else
uniform ${U} ${W} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${U} ${W} ${$} = u_${$};
#endif
`))),vertexSource:r=r.replace(h,((D,B,U,W,$)=>{const Z=W==="float"?"vec2":"vec4",Q=$.match(/color/)?"color":Z;return R[$]?B==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${Z} a_${$};
out ${U} ${W} ${$};
#else
uniform ${U} ${W} u_${$};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${U} ${W} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${Q}(a_${$}, u_${$}_t);
#else
    ${U} ${W} ${$} = u_${$};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${Z} a_${$};
#else
uniform ${U} ${W} u_${$};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${W} ${$} = a_${$};
#else
    ${U} ${W} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${W} ${$} = unpack_mix_${Q}(a_${$}, u_${$}_t);
#else
    ${U} ${W} ${$} = u_${$};
#endif
`})),staticAttributes:m,staticUniforms:P}}class Mo{constructor(r,h,m){this.vertexBuffer=r,this.indexBuffer=h,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ro=a.aJ([{name:"a_pos",type:"Int16",components:2}]);const fo="#define PROJECTION_MERCATOR",ra="mercator";class An{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ra}get shaderDefine(){return fo}get shaderPreludeCode(){return Is.projectionMercator}get vertexShaderPreludeCode(){return Is.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(r){}getMeshFromTileID(r,h,m,y,w){if(this._cachedMesh)return this._cachedMesh;const P=new a.aL;P.emplaceBack(0,0),P.emplaceBack(a.$,0),P.emplaceBack(0,a.$),P.emplaceBack(a.$,a.$);const R=r.createVertexBuffer(P,Ro.members),D=a.aM.simpleSegment(0,0,4,2),B=new a.aN;B.emplaceBack(1,0,2),B.emplaceBack(1,2,3);const U=r.createIndexBuffer(B);return this._cachedMesh=new Mo(R,U,D),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(r){}}class po{constructor(r=0,h=0,m=0,y=0){if(isNaN(r)||r<0||isNaN(h)||h<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=h,this.left=m,this.right=y}interpolate(r,h,m){return h.top!=null&&r.top!=null&&(this.top=a.C.number(r.top,h.top,m)),h.bottom!=null&&r.bottom!=null&&(this.bottom=a.C.number(r.bottom,h.bottom,m)),h.left!=null&&r.left!=null&&(this.left=a.C.number(r.left,h.left,m)),h.right!=null&&r.right!=null&&(this.right=a.C.number(r.right,h.right,m)),this}getCenter(r,h){const m=a.ah((this.left+r-this.right)/2,0,r),y=a.ah((this.top+h-this.bottom)/2,0,h);return new a.P(m,y)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new po(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function qs(x,r){if(!x.renderWorldCopies||x.lngRange)return;const h=r.lng-x.center.lng;r.lng+=h>180?-360:h<-180?360:0}function Gs(x){return Math.max(0,Math.floor(x))}class Mi{constructor(r,h,m,y,w,P){this._callbacks=r,this._tileSize=512,this._renderWorldCopies=P===void 0||!!P,this._minZoom=h||0,this._maxZoom=m||22,this._minPitch=y??0,this._maxPitch=w??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Gs(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new po,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(r,h,m){this._latRange=r.latRange,this._lngRange=r.lngRange,this._width=r.width,this._height=r.height,this._center=r.center,this._elevation=r.elevation,this._minElevationForCurrentTile=r.minElevationForCurrentTile,this._zoom=r.zoom,this._tileZoom=Gs(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=r.bearingInRadians,this._fovInRadians=r.fovInRadians,this._pitchInRadians=r.pitchInRadians,this._rollInRadians=r.rollInRadians,this._unmodified=r.unmodified,this._edgeInsets=new po(r.padding.top,r.padding.bottom,r.padding.left,r.padding.right),this._minZoom=r.minZoom,this._maxZoom=r.maxZoom,this._minPitch=r.minPitch,this._maxPitch=r.maxPitch,this._renderWorldCopies=r.renderWorldCopies,this._cameraToCenterDistance=r.cameraToCenterDistance,this._nearZ=r.nearZ,this._farZ=r.farZ,this._autoCalculateNearFarZ=!m&&r.autoCalculateNearFarZ,h&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(r){this._minElevationForCurrentTile=r}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(r){this._minZoom!==r&&(this._minZoom=r,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(r){this._minPitch!==r&&(this._minPitch=r,this.setPitch(Math.max(this.pitch,r)))}get maxPitch(){return this._maxPitch}setMaxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.setPitch(Math.min(this.pitch,r)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(r){const h=a.aO(r,-180,180)*Math.PI/180;var m,y,w,P,R,D,B,U,W;this._bearingInRadians!==h&&(this._unmodified=!1,this._bearingInRadians=h,this._calcMatrices(),this._rotationMatrix=A(),m=this._rotationMatrix,w=-this._bearingInRadians,P=(y=this._rotationMatrix)[0],R=y[1],D=y[2],B=y[3],U=Math.sin(w),W=Math.cos(w),m[0]=P*W+D*U,m[1]=R*W+B*U,m[2]=P*-U+D*W,m[3]=R*-U+B*W)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(r){const h=a.ah(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==h&&(this._unmodified=!1,this._pitchInRadians=h,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(r){const h=r/180*Math.PI;this._rollInRadians!==h&&(this._unmodified=!1,this._rollInRadians=h,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aP(this._fovInRadians)}setFov(r){r=a.ah(r,.1,150),this.fov!==r&&(this._unmodified=!1,this._fovInRadians=a.ae(r),this._calcMatrices())}get zoom(){return this._zoom}setZoom(r){const h=this.getConstrained(this._center,r).zoom;this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this._tileZoom=Math.max(0,Math.floor(h)),this._scale=a.af(h),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(r,h){this._autoCalculateNearFarZ=!1,this._nearZ=r,this._farZ=h,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,h,m){this._unmodified=!1,this._edgeInsets.interpolate(r,h,m),this._constrain(),this._calcMatrices()}resize(r,h,m=!0){this._width=r,this._height=h,m&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Hn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(r){r?(this._lngRange=[r.getWest(),r.getEast()],this._latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-a.ai,a.ai])}getConstrained(r,h){return this._callbacks.getConstrained(r,h)}getCameraQueryGeometry(r,h){if(h.length===1)return[h[0],r];{const{minX:m,minY:y,maxX:w,maxY:P}=a.a2.fromPoints(h).extend(r);return[new a.P(m,y),new a.P(w,y),new a.P(w,P),new a.P(m,P),new a.P(m,y)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const r=this._unmodified,{center:h,zoom:m}=this.getConstrained(this.center,this.zoom);this.setCenter(h),this.setZoom(m),this._unmodified=r,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let r=a.ag(new Float64Array(16));a.N(r,r,[this._width/2,-this._height/2,1]),a.M(r,r,[1,-1,0]),this._clipSpaceToPixelsMatrix=r,r=a.ag(new Float64Array(16)),a.N(r,r,[1,-1,1]),a.M(r,r,[-1,-1,0]),a.N(r,r,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=r,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(r,h,m,y){const w=m!==void 0?m:this.bearing,P=y=y!==void 0?y:this.pitch,R=a.a1.fromLngLat(r,h),D=-Math.cos(a.ae(P)),B=Math.sin(a.ae(P)),U=B*Math.sin(a.ae(w)),W=-B*Math.cos(a.ae(w));let $=this.elevation;const Z=h-$;let Q;D*Z>=0||Math.abs(D)<.1?(Q=1e4,$=h+Q*D):Q=-Z/D;let re,ae,le=a.aQ(1,R.y),pe=0;do{if(pe+=1,pe>10)break;ae=Q/le,re=new a.a1(R.x+U*ae,R.y+W*ae),le=1/re.meterInMercatorCoordinateUnits()}while(Math.abs(Q-ae*le)>1e-12);return{center:re.toLngLat(),elevation:$,zoom:a.ak(this.height/2/Math.tan(this.fovInRadians/2)/ae/this.tileSize)}}recalculateZoomAndCenter(r){if(this.elevation-r==0)return;const h=a.aj(1,this.center.lat)*this.worldSize,m=this.cameraToCenterDistance/h,y=a.a1.fromLngLat(this.center,this.elevation),w=Ke(this.center,this.elevation,this.pitch,this.bearing,m);this._elevation=r;const P=this.calculateCenterFromCameraLngLatAlt(w.toLngLat(),a.aQ(w.z,y.y),this.bearing,this.pitch);this._elevation=P.elevation,this._center=P.center,this.setZoom(P.zoom)}getCameraPoint(){const r=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(r*Math.sin(this.rollInRadians),r*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const r=a.aj(1,this.center.lat)*this.worldSize;return Ke(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/r).toLngLat()}getMercatorTileCoordinates(r){if(!r)return[0,0,1,1];const h=r.canonical.z>=0?1<<r.canonical.z:Math.pow(2,r.canonical.z);return[r.canonical.x/h,r.canonical.y/h,1/h/a.$,1/h/a.$]}}class Ri{constructor(r,h){this.min=r,this.max=h,this.center=a.aR([],a.aS([],this.min,this.max),.5)}quadrant(r){const h=[r%2==0,r<2],m=a.aT(this.min),y=a.aT(this.max);for(let w=0;w<h.length;w++)m[w]=h[w]?this.min[w]:this.center[w],y[w]=h[w]?this.center[w]:this.max[w];return y[2]=this.max[2],new Ri(m,y)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersectsFrustum(r){let h=!0;for(let m=0;m<r.planes.length;m++){const y=this.intersectsPlane(r.planes[m]);if(y===0)return 0;y===1&&(h=!1)}return h?2:r.aabb.min[0]>this.max[0]||r.aabb.min[1]>this.max[1]||r.aabb.min[2]>this.max[2]||r.aabb.max[0]<this.min[0]||r.aabb.max[1]<this.min[1]||r.aabb.max[2]<this.min[2]?0:1}intersectsPlane(r){let h=r[3],m=r[3];for(let y=0;y<3;y++)r[y]>0?(h+=r[y]*this.min[y],m+=r[y]*this.max[y]):(m+=r[y]*this.min[y],h+=r[y]*this.max[y]);return h>=0?2:m<0?0:1}}class Yi{distanceToTile2d(r,h,m,y){const w=y.distanceX([r,h]),P=y.distanceY([r,h]);return Math.hypot(w,P)}getWrap(r,h,m){return m}getTileBoundingVolume(r,h,m,y){var w,P;let R=0,D=0;if(y?.terrain){const U=new a.Z(r.z,h,r.z,r.x,r.y),W=y.terrain.getMinMaxElevation(U);R=(w=W.minElevation)!==null&&w!==void 0?w:Math.min(0,m),D=(P=W.maxElevation)!==null&&P!==void 0?P:Math.max(0,m)}const B=1<<r.z;return new Ri([h+r.x/B,r.y/B,R],[h+(r.x+1)/B,(r.y+1)/B,D])}allowVariableZoom(r,h){const m=r.fov*(Math.abs(Math.cos(r.rollInRadians))*r.height+Math.abs(Math.sin(r.rollInRadians))*r.width)/r.height,y=a.ah(78.5-m/2,0,60);return!!h.terrain||r.pitch>y}allowWorldCopies(){return!0}prepareNextFrame(){}}class li{constructor(r,h,m){this.points=r,this.planes=h,this.aabb=m}static fromInvProjectionMatrix(r,h=1,m=0,y,w){const P=w?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],R=Math.pow(2,m),D=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(($=>(function(Z,Q,re,ae){const le=a.aw([],Z,Q),pe=1/le[3]/re*ae;return a.aY(le,le,[pe,pe,1/le[3],pe])})($,r,h,R)));y&&(function($,Z,Q,re){const ae=re?4:0,le=re?0:4;let pe=0;const be=[],fe=[];for(let xe=0;xe<4;xe++){const Re=a.aU([],$[xe+le],$[xe+ae]),Ge=a.aZ(Re);a.aR(Re,Re,1/Ge),be.push(Ge),fe.push(Re)}for(let xe=0;xe<4;xe++){const Re=a.a_($[xe+ae],fe[xe],Q);pe=Re!==null&&Re>=0?Math.max(pe,Re):Math.max(pe,be[xe])}const Ae=(function(xe,Re){const Ge=a.aU([],xe[Re[0]],xe[Re[1]]),qe=a.aU([],xe[Re[2]],xe[Re[1]]),Ye=[0,0,0,0];return a.aV(Ye,a.aW([],Ge,qe)),Ye[3]=-a.aX(Ye,xe[Re[0]]),Ye})($,Z),Me=(function(xe,Re){const Ge=a.a$(xe),qe=a.b0([],xe,1/Ge),Ye=a.aU([],Re,a.aR([],qe,a.aX(Re,qe))),tt=a.a$(Ye);if(tt>0){const bt=Math.sqrt(1-qe[3]*qe[3]),_t=a.aR([],qe,-qe[3]),ht=a.aS([],_t,a.aR([],Ye,bt/tt));return a.b1(Re,ht)}return null})(Q,Ae);if(Me!==null){const xe=Me/a.aX(fe[0],Ae);pe=Math.min(pe,xe)}for(let xe=0;xe<4;xe++){const Re=Math.min(pe,be[xe]);$[xe+le]=[$[xe+ae][0]+fe[xe][0]*Re,$[xe+ae][1]+fe[xe][1]*Re,$[xe+ae][2]+fe[xe][2]*Re,1]}})(D,P[0],y,w);const B=P.map(($=>{const Z=a.aU([],D[$[0]],D[$[1]]),Q=a.aU([],D[$[2]],D[$[1]]),re=a.aV([],a.aW([],Z,Q)),ae=-a.aX(re,D[$[1]]);return re.concat(ae)})),U=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],W=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const $ of D)for(let Z=0;Z<3;Z++)U[Z]=Math.min(U[Z],$[Z]),W[Z]=Math.max(W[Z],$[Z]);return new li(D,B,new Ri(U,W))}}class si{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,h,m){return this._helper.interpolatePadding(r,h,m)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,h,m=!0){this._helper.resize(r,h,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}overrideNearFarZ(r,h){this._helper.overrideNearFarZ(r,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(r,h){}constructor(r,h,m,y,w){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Mi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(P,R)=>this.getConstrained(P,R)},r,h,m,y,w),this._coveringTilesDetailsProvider=new Yi}clone(){const r=new si;return r.apply(this),r}apply(r,h,m){this._helper.apply(r,h,m)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(r){const h=[new a.b2(0,r)];if(this._helper._renderWorldCopies){const m=this.screenPointToMercatorCoordinate(new a.P(0,0)),y=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),w=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),P=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),R=Math.floor(Math.min(m.x,y.x,w.x,P.x)),D=Math.floor(Math.max(m.x,y.x,w.x,P.x)),B=1;for(let U=R-B;U<=D+B;U++)U!==0&&h.push(new a.b2(U,r))}return h}getCameraFrustum(){return li.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(r){const h=this.screenPointToLocation(this.centerPoint,r),m=r?r.getElevationForLngLatZoom(h,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(m)}setLocationAtPoint(r,h){const m=a.aj(this.elevation,this.center.lat),y=this.screenPointToMercatorCoordinateAtZ(h,m),w=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,m),P=a.a1.fromLngLat(r),R=new a.a1(P.x-(y.x-w.x),P.y-(y.y-w.y));this.setCenter(R?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(r,h){return h?this.coordinatePoint(a.a1.fromLngLat(r),h.getElevationForLngLatZoom(r,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.a1.fromLngLat(r))}screenPointToLocation(r,h){var m;return(m=this.screenPointToMercatorCoordinate(r,h))===null||m===void 0?void 0:m.toLngLat()}screenPointToMercatorCoordinate(r,h){if(h){const m=h.pointCoordinate(r);if(m!=null)return m}return this.screenPointToMercatorCoordinateAtZ(r)}screenPointToMercatorCoordinateAtZ(r,h){const m=h||0,y=[r.x,r.y,0,1],w=[r.x,r.y,1,1];a.aw(y,y,this._pixelMatrixInverse),a.aw(w,w,this._pixelMatrixInverse);const P=y[3],R=w[3],D=y[1]/P,B=w[1]/R,U=y[2]/P,W=w[2]/R,$=U===W?0:(m-U)/(W-U);return new a.a1(a.C.number(y[0]/P,w[0]/R,$)/this.worldSize,a.C.number(D,B,$)/this.worldSize,m)}coordinatePoint(r,h=0,m=this._pixelMatrix){const y=[r.x*this.worldSize,r.y*this.worldSize,h,1];return a.aw(y,y,m),new a.P(y[0]/y[3],y[1]/y[3])}getBounds(){const r=Math.max(0,this._helper._height/2-Ce(this));return new Hn().extend(this.screenPointToLocation(new a.P(0,r))).extend(this.screenPointToLocation(new a.P(this._helper._width,r))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(r,h){return h?h.pointCoordinate(r)!=null:r.y>this.height/2-Ce(this)}calculatePosMatrix(r,h=!1,m){var y;const w=(y=r.key)!==null&&y!==void 0?y:a.b3(r.wrap,r.canonical.z,r.canonical.z,r.canonical.x,r.canonical.y),P=h?this._alignedPosMatrixCache:this._posMatrixCache;if(P.has(w)){const B=P.get(w);return m?B.f32:B.f64}const R=Fe(r,this.worldSize);a.O(R,h?this._alignedProjMatrix:this._viewProjMatrix,R);const D={f64:R,f32:new Float32Array(R)};return P.set(w,D),m?D.f32:D.f64}calculateFogMatrix(r){const h=r.key,m=this._fogMatrixCacheF32;if(m.has(h))return m.get(h);const y=Fe(r,this.worldSize);return a.O(y,this._fogMatrix,y),m.set(h,new Float32Array(y)),m.get(h)}getConstrained(r,h){h=a.ah(+h,this.minZoom,this.maxZoom);const m={center:new a.S(r.lng,r.lat),zoom:h};let y=this._helper._lngRange;if(!this._helper._renderWorldCopies&&y===null){const be=179.9999999999;y=[-be,be]}const w=this.tileSize*a.af(m.zoom);let P=0,R=w,D=0,B=w,U=0,W=0;const{x:$,y:Z}=this.size;if(this._helper._latRange){const be=this._helper._latRange;P=a.U(be[1])*w,R=a.U(be[0])*w,R-P<Z&&(U=Z/(R-P))}y&&(D=a.aO(a.V(y[0])*w,0,w),B=a.aO(a.V(y[1])*w,0,w),B<D&&(B+=w),B-D<$&&(W=$/(B-D)));const{x:Q,y:re}=ie(w,r);let ae,le;const pe=Math.max(W||0,U||0);if(pe){const be=new a.P(W?(B+D)/2:Q,U?(R+P)/2:re);return m.center=we(w,be).wrap(),m.zoom+=a.ak(pe),m}if(this._helper._latRange){const be=Z/2;re-be<P&&(le=P+be),re+be>R&&(le=R-be)}if(y){const be=(D+B)/2;let fe=Q;this._helper._renderWorldCopies&&(fe=a.aO(Q,be-w/2,be+w/2));const Ae=$/2;fe-Ae<D&&(ae=D+Ae),fe+Ae>B&&(ae=B-Ae)}if(ae!==void 0||le!==void 0){const be=new a.P(ae??Q,le??re);m.center=we(w,be).wrap()}return m}calculateCenterFromCameraLngLatAlt(r,h,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(r,h,m,y)}_calculateNearFarZIfNeeded(r,h,m){if(!this._helper.autoCalculateNearFarZ)return;const y=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),w=r-y*this._helper._pixelPerMeter/Math.cos(h),P=y<0?w:r,R=Math.PI/2+this.pitchInRadians,D=a.ae(this.fov)*(Math.abs(Math.cos(a.ae(this.roll)))*this.height+Math.abs(Math.sin(a.ae(this.roll)))*this.width)/this.height*(.5+m.y/this.height),B=Math.sin(D)*P/Math.sin(a.ah(Math.PI-R-D,.01,Math.PI-.01)),U=Ce(this),W=Math.atan(U/this._helper.cameraToCenterDistance),$=a.ae(.75),Z=W>$?2*W*(.5+m.y/(2*U)):$,Q=Math.sin(Z)*P/Math.sin(a.ah(Math.PI-R-Z,.01,Math.PI-.01)),re=Math.min(B,Q);this._helper._farZ=1.01*(Math.cos(Math.PI/2-h)*re+P),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const r=this.centerOffset,h=ie(this.worldSize,this.center),m=h.x,y=h.y;this._helper._pixelPerMeter=a.aj(1,this.center.lat)*this.worldSize;const w=a.ae(Math.min(this.pitch,J)),P=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(w));let R;this._calculateNearFarZIfNeeded(P,w,r),R=new Float64Array(16),a.b4(R,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.aq(this._invProjMatrix,R),R[8]=2*-r.x/this._helper._width,R[9]=2*r.y/this._helper._height,this._projectionMatrix=a.b5(R),a.N(R,R,[1,-1,1]),a.M(R,R,[0,0,-this._helper.cameraToCenterDistance]),a.b6(R,R,-this.rollInRadians),a.b7(R,R,this.pitchInRadians),a.b6(R,R,-this.bearingInRadians),a.M(R,R,[-m,-y,0]),this._mercatorMatrix=a.N([],R,[this.worldSize,this.worldSize,this.worldSize]),a.N(R,R,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,R),a.M(R,R,[0,0,-this.elevation]),this._viewProjMatrix=R,this._invViewProjMatrix=a.aq([],R);const D=[0,0,-1,1];a.aw(D,D,this._invViewProjMatrix),this._cameraPosition=[D[0]/D[3],D[1]/D[3],D[2]/D[3]],this._fogMatrix=new Float64Array(16),a.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,P,this._helper._farZ),this._fogMatrix[8]=2*-r.x/this.width,this._fogMatrix[9]=2*r.y/this.height,a.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.M(this._fogMatrix,this._fogMatrix,[-m,-y,0]),a.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,R);const B=this._helper._width%2/2,U=this._helper._height%2/2,W=Math.cos(this.bearingInRadians),$=Math.sin(-this.bearingInRadians),Z=m-Math.round(m)+W*B+$*U,Q=y-Math.round(y)+W*U+$*B,re=new Float64Array(R);if(a.M(re,re,[Z>.5?Z-1:Z,Q>.5?Q-1:Q,0]),this._alignedProjMatrix=re,R=a.aq(new Float64Array(16),this._pixelMatrix),!R)throw new Error("failed to invert matrix");this._pixelMatrixInverse=R,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const r=this.screenPointToMercatorCoordinate(new a.P(0,0)),h=[r.x*this.worldSize,r.y*this.worldSize,0,1];return a.aw(h,h,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const r=a.aj(1,this.center.lat)*this.worldSize;return Ke(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/r).toLngLat()}lngLatToCameraDepth(r,h){const m=a.a1.fromLngLat(r),y=[m.x*this.worldSize,m.y*this.worldSize,h,1];return a.aw(y,y,this._viewProjMatrix),y[2]/y[3]}getProjectionData(r){const{overscaledTileID:h,aligned:m,applyTerrainMatrix:y}=r,w=this._helper.getMercatorTileCoordinates(h),P=h?this.calculatePosMatrix(h,m,!0):null;let R;return R=h&&h.terrainRttPosMatrix32f&&y?h.terrainRttPosMatrix32f:P||a.b8(),{mainMatrix:R,tileMercatorCoords:w,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:R}}isLocationOccluded(r){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(r,h,m){return 1}transformLightDirection(r){return a.aT(r)}getRayDirectionFromPixel(r){throw new Error("Not implemented.")}projectTileCoordinates(r,h,m,y){const w=this.calculatePosMatrix(m);let P;y?(P=[r,h,y(r,h),1],a.aw(P,P,w)):(P=[r,h,0,1],Il(P,P,w));const R=P[3];return{point:new a.P(P[0]/R,P[1]/R),signedDistanceFromCamera:R,isOccluded:!1}}populateCache(r){for(const h of r)this.calculatePosMatrix(h)}getMatrixForModel(r,h){const m=a.a1.fromLngLat(r,h),y=m.meterInMercatorCoordinateUnits(),w=a.b9();return a.M(w,w,[m.x,m.y,m.z]),a.b6(w,w,Math.PI),a.b7(w,w,Math.PI/2),a.N(w,w,[-y,y,y]),w}getProjectionDataForCustomLayer(r=!0){const h=new a.Z(0,0,0,0,0),m=this.getProjectionData({overscaledTileID:h,applyGlobeMatrix:r}),y=Fe(h,this.worldSize);a.O(y,this._viewProjMatrix,y),m.tileMercatorCoords=[0,0,1,1];const w=[a.$,a.$,this.worldSize/this._helper.pixelsPerMeter],P=a.ba();return a.N(P,y,w),m.fallbackMatrix=P,m.mainMatrix=P,m}getFastPathSimpleProjectionMatrix(r){return this.calculatePosMatrix(r)}}function Lh(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Ki(x){if(x.useSlerp)if(x.k<1){const r=a.bb(x.startEulerAngles.roll,x.startEulerAngles.pitch,x.startEulerAngles.bearing),h=a.bb(x.endEulerAngles.roll,x.endEulerAngles.pitch,x.endEulerAngles.bearing),m=new Float64Array(4);a.bc(m,r,h,x.k);const y=a.bd(m);x.tr.setRoll(y.roll),x.tr.setPitch(y.pitch),x.tr.setBearing(y.bearing)}else x.tr.setRoll(x.endEulerAngles.roll),x.tr.setPitch(x.endEulerAngles.pitch),x.tr.setBearing(x.endEulerAngles.bearing);else x.tr.setRoll(a.C.number(x.startEulerAngles.roll,x.endEulerAngles.roll,x.k)),x.tr.setPitch(a.C.number(x.startEulerAngles.pitch,x.endEulerAngles.pitch,x.k)),x.tr.setBearing(a.C.number(x.startEulerAngles.bearing,x.endEulerAngles.bearing,x.k))}function fs(x,r,h,m,y){const w=y.padding,P=ie(y.worldSize,h.getNorthWest()),R=ie(y.worldSize,h.getNorthEast()),D=ie(y.worldSize,h.getSouthEast()),B=ie(y.worldSize,h.getSouthWest()),U=a.ae(-m),W=P.rotate(U),$=R.rotate(U),Z=D.rotate(U),Q=B.rotate(U),re=new a.P(Math.max(W.x,$.x,Q.x,Z.x),Math.max(W.y,$.y,Q.y,Z.y)),ae=new a.P(Math.min(W.x,$.x,Q.x,Z.x),Math.min(W.y,$.y,Q.y,Z.y)),le=re.sub(ae),pe=(y.width-(w.left+w.right+r.left+r.right))/le.x,be=(y.height-(w.top+w.bottom+r.top+r.bottom))/le.y;if(be<0||pe<0)return void Lh();const fe=Math.min(a.ak(y.scale*Math.min(pe,be)),x.maxZoom),Ae=a.P.convert(x.offset),Me=new a.P((r.left-r.right)/2,(r.top-r.bottom)/2).rotate(a.ae(m)),xe=Ae.add(Me).mult(y.scale/a.af(fe));return{center:we(y.worldSize,P.add(D).div(2).sub(xe)),zoom:fe,bearing:m}}class fr{get useGlobeControls(){return!1}handlePanInertia(r,h){const m=r.mag(),y=Math.abs(Ce(h));return{easingOffset:r.mult(Math.min(.75*y/m,1)),easingCenter:h.center}}handleMapControlsRollPitchBearingZoom(r,h){r.bearingDelta&&h.setBearing(h.bearing+r.bearingDelta),r.pitchDelta&&h.setPitch(h.pitch+r.pitchDelta),r.rollDelta&&h.setRoll(h.roll+r.rollDelta),r.zoomDelta&&h.setZoom(h.zoom+r.zoomDelta)}handleMapControlsPan(r,h,m){r.around.distSqr(h.centerPoint)<.01||h.setLocationAtPoint(m,r.around)}cameraForBoxAndBearing(r,h,m,y,w){return fs(r,h,m,y,w)}handleJumpToCenterZoom(r,h){r.zoom!==(h.zoom!==void 0?+h.zoom:r.zoom)&&r.setZoom(+h.zoom),h.center!==void 0&&r.setCenter(a.S.convert(h.center))}handleEaseTo(r,h){const m=r.zoom,y=r.padding,w={roll:r.roll,pitch:r.pitch,bearing:r.bearing},P={roll:h.roll===void 0?r.roll:h.roll,pitch:h.pitch===void 0?r.pitch:h.pitch,bearing:h.bearing===void 0?r.bearing:h.bearing},R=h.zoom!==void 0,D=!r.isPaddingEqual(h.padding);let B=!1;const U=R?+h.zoom:r.zoom;let W=r.centerPoint.add(h.offsetAsPoint);const $=r.screenPointToLocation(W),{center:Z,zoom:Q}=r.getConstrained(a.S.convert(h.center||$),U??m);qs(r,Z);const re=ie(r.worldSize,$),ae=ie(r.worldSize,Z).sub(re),le=a.af(Q-m);return B=Q!==m,{easeFunc:pe=>{if(B&&r.setZoom(a.C.number(m,Q,pe)),a.be(w,P)||Ki({startEulerAngles:w,endEulerAngles:P,tr:r,k:pe,useSlerp:w.roll!=P.roll}),D&&(r.interpolatePadding(y,h.padding,pe),W=r.centerPoint.add(h.offsetAsPoint)),h.around)r.setLocationAtPoint(h.around,h.aroundPoint);else{const be=a.af(r.zoom-m),fe=Q>m?Math.min(2,le):Math.max(.5,le),Ae=Math.pow(fe,1-pe),Me=we(r.worldSize,re.add(ae.mult(pe*Ae)).mult(be));r.setLocationAtPoint(r.renderWorldCopies?Me.wrap():Me,W)}},isZooming:B,elevationCenter:Z}}handleFlyTo(r,h){const m=h.zoom!==void 0,y=r.zoom,w=r.getConstrained(a.S.convert(h.center||h.locationAtOffset),m?+h.zoom:y),P=w.center,R=w.zoom;qs(r,P);const D=ie(r.worldSize,h.locationAtOffset),B=ie(r.worldSize,P).sub(D),U=B.mag(),W=a.af(R-y);let $;if(h.minZoom!==void 0){const Z=Math.min(+h.minZoom,y,R),Q=r.getConstrained(P,Z).zoom;$=a.af(Q-y)}return{easeFunc:(Z,Q,re,ae)=>{r.setZoom(Z===1?R:y+a.ak(Q));const le=Z===1?P:we(r.worldSize,D.add(B.mult(re)).mult(Q));r.setLocationAtPoint(r.renderWorldCopies?le.wrap():le,ae)},scaleOfZoom:W,targetCenter:P,scaleOfMinZoom:$,pixelPathLength:U}}}class ti{constructor(r,h,m){this.blendFunction=r,this.blendColor=h,this.mask=m}}ti.Replace=[1,0],ti.disabled=new ti(ti.Replace,a.bf.transparent,[!1,!1,!1,!1]),ti.unblended=new ti(ti.Replace,a.bf.transparent,[!0,!0,!0,!0]),ti.alphaBlended=new ti([1,771],a.bf.transparent,[!0,!0,!0,!0]);const sa=2305;class on{constructor(r,h,m){this.enable=r,this.mode=h,this.frontFace=m}}on.disabled=new on(!1,1029,sa),on.backCCW=new on(!0,1029,sa),on.frontCCW=new on(!0,1028,sa);class hn{constructor(r,h,m){this.func=r,this.mask=h,this.range=m}}hn.ReadOnly=!1,hn.ReadWrite=!0,hn.disabled=new hn(519,hn.ReadOnly,[0,1]);const ps=7680;class In{constructor(r,h,m,y,w,P){this.test=r,this.ref=h,this.mask=m,this.fail=y,this.depthFail=w,this.pass=P}}In.disabled=new In({func:519,mask:0},0,0,ps,ps,ps);const Tr=new WeakMap;function mo(x){var r;if(Tr.has(x))return Tr.get(x);{const h=(r=x.getParameter(x.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return Tr.set(x,h),h}}class go{get awaitingQuery(){return!!this._readbackQueue}constructor(r){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=r;const h=r.context,m=h.gl;this._texFormat=m.RGBA,this._texType=m.UNSIGNED_BYTE;const y=new a.aL;y.emplaceBack(-1,-1),y.emplaceBack(2,-1),y.emplaceBack(-1,2);const w=new a.aN;w.emplaceBack(0,1,2),this._fullscreenTriangle=new Mo(h.createVertexBuffer(y,Ro.members),h.createIndexBuffer(w),a.aM.simpleSegment(0,0,y.length,w.length)),this._resultBuffer=new Uint8Array(4),h.activeTexture.set(m.TEXTURE1);const P=m.createTexture();m.bindTexture(m.TEXTURE_2D,P),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texImage2D(m.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=h.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(P),mo(m)&&(this._pbo=m.createBuffer(),m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.bufferData(m.PIXEL_PACK_BUFFER,4,m.STREAM_READ),m.bindBuffer(m.PIXEL_PACK_BUFFER,null))}destroy(){const r=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),r.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(r,h){const m=this._updateCount;return this._readbackQueue?m>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():m>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(r,h),this._updateCount++,this._measuredError}_bindFramebuffer(){const r=this._cachedRenderContext.context,h=r.gl;r.activeTexture.set(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this._fbo.colorAttachment.get()),r.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(r,h){const m=this._cachedRenderContext.context,y=m.gl;if(this._bindFramebuffer(),m.viewport.set([0,0,this._texWidth,this._texHeight]),m.clear({color:a.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(m,y.TRIANGLES,hn.disabled,In.disabled,ti.unblended,on.disabled,((w,P)=>({u_input:w,u_output_expected:P}))(r,h),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&mo(y)){y.bindBuffer(y.PIXEL_PACK_BUFFER,this._pbo),y.readBuffer(y.COLOR_ATTACHMENT0),y.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,null);const w=y.fenceSync(y.SYNC_GPU_COMMANDS_COMPLETE,0);y.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:w}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const r=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&mo(r)){const h=r.clientWaitSync(this._readbackQueue.sync,0,0);if(h===r.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(h===r.TIMEOUT_EXPIRED)return;r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),r.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=go._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(r){let h=0;return h+=r[0]/256,h+=r[1]/65536,h+=r[2]/16777216,r[3]<127&&(h=-h),h/128}}const Dl=a.$/128;function Ol(x,r){const h=x.granularity!==void 0?Math.max(x.granularity,1):1,m=h+(x.generateBorders?2:0),y=h+(x.extendToNorthPole||x.generateBorders?1:0)+(x.extendToSouthPole||x.generateBorders?1:0),w=m+1,P=y+1,R=x.generateBorders?-1:0,D=x.generateBorders||x.extendToNorthPole?-1:0,B=h+(x.generateBorders?1:0),U=h+(x.generateBorders||x.extendToSouthPole?1:0),W=w*P,$=m*y*6,Z=w*P>65536;if(Z&&r==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Q=Z||r==="32bit",re=new Int16Array(2*W);let ae=0;for(let be=D;be<=U;be++)for(let fe=R;fe<=B;fe++){let Ae=fe/h*a.$;fe===-1&&(Ae=-Dl),fe===h+1&&(Ae=a.$+Dl);let Me=be/h*a.$;be===-1&&(Me=x.extendToNorthPole?a.bh:-Dl),be===h+1&&(Me=x.extendToSouthPole?a.bi:a.$+Dl),re[ae++]=Ae,re[ae++]=Me}const le=Q?new Uint32Array($):new Uint16Array($);let pe=0;for(let be=0;be<y;be++)for(let fe=0;fe<m;fe++){const Ae=fe+1+be*w,Me=fe+(be+1)*w,xe=fe+1+(be+1)*w;le[pe++]=fe+be*w,le[pe++]=Me,le[pe++]=Ae,le[pe++]=Ae,le[pe++]=Me,le[pe++]=xe}return{vertices:re.buffer.slice(0),indices:le.buffer.slice(0),uses32bitIndices:Q}}const oa=new a.aK({fill:new a.bj(128,2),line:new a.bj(512,0),tile:new a.bj(128,32),stencil:new a.bj(128,1),circle:3});class Ll{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Is.projectionGlobe}get vertexShaderPreludeCode(){return Is.projectionMercator.vertexSource}get subdivisionGranularity(){return oa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(r){this._errorMeasurement||(this._errorMeasurement=new go(r));const h=a.U(this._errorQueryLatitudeDegrees),m=2*Math.atan(Math.exp(Math.PI-h*Math.PI*2))-.5*Math.PI,y=this._errorMeasurement.updateErrorLoop(h,m),w=L.now();y!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=y,this._errorMeasurementLastChangeTime=w);const P=Math.min(Math.max((w-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bl(P))}_getMeshKey(r){return`${r.granularity.toString(36)}_${r.generateBorders?"b":""}${r.extendToNorthPole?"n":""}${r.extendToSouthPole?"s":""}`}getMeshFromTileID(r,h,m,y,w){const P=(w==="stencil"?oa.stencil:oa.tile).getGranularityForZoomLevel(h.z);return this._getMesh(r,{granularity:P,generateBorders:m,extendToNorthPole:h.y===0&&y,extendToSouthPole:h.y===(1<<h.z)-1&&y})}_getMesh(r,h){const m=this._getMeshKey(h);if(m in this._tileMeshCache)return this._tileMeshCache[m];const y=(function(w,P){const R=Ol(P,"16bit"),D=a.aL.deserialize({arrayBuffer:R.vertices,length:R.vertices.byteLength/2/2}),B=a.aN.deserialize({arrayBuffer:R.indices,length:R.indices.byteLength/2/3});return new Mo(w.createVertexBuffer(D,Ro.members),w.createIndexBuffer(B),a.aM.simpleSegment(0,0,D.length,B.length))})(r,h);return this._tileMeshCache[m]=y,y}recalculate(r){}hasTransition(){const r=L.now();let h=!1;return h=h||(r-this._errorMeasurementLastChangeTime)/1e3<.7,h=h||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,h}setErrorQueryLatitudeDegrees(r){this._errorQueryLatitudeDegrees=r}}const Ys=new a.r({type:new a.D(a.v.projection.type)});class Fl extends a.E{constructor(r){super(),this._transitionable=new a.t(Ys,void 0),this.setProjection(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0)),this._mercatorProjection=new An,this._verticalPerspectiveProjection=new Ll}get transitionState(){const r=this.properties.get("type");if(typeof r=="string"&&r==="mercator")return 0;if(typeof r=="string"&&r==="vertical-perspective")return 1;if(r instanceof a.bm){if(r.from==="vertical-perspective"&&r.to==="mercator")return 1-r.transition;if(r.from==="mercator"&&r.to==="vertical-perspective")return r.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(r){this._mercatorProjection.updateGPUdependent(r),this._verticalPerspectiveProjection.updateGPUdependent(r)}getMeshFromTileID(r,h,m,y,w){return this.currentProjection.getMeshFromTileID(r,h,m,y,w)}setProjection(r){this._transitionable.setValue("type",r?.type||"mercator")}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}setErrorQueryLatitudeDegrees(r){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(r),this._mercatorProjection.setErrorQueryLatitudeDegrees(r)}}function Ua(x){const r=ko(x.worldSize,x.center.lat);return 2*Math.PI*r}function Ms(x,r,h,m,y){const w=1/(1<<y),P=r/a.$*w+m*w,R=a.bo((x/a.$*w+h*w)*Math.PI*2+Math.PI,2*Math.PI),D=2*Math.atan(Math.exp(Math.PI-P*Math.PI*2))-.5*Math.PI,B=Math.cos(D),U=new Float64Array(3);return U[0]=Math.sin(R)*B,U[1]=Math.sin(D),U[2]=Math.cos(R)*B,U}function Ni(x){return(function(r,h){const m=Math.cos(h),y=new Float64Array(3);return y[0]=Math.sin(r)*m,y[1]=Math.sin(h),y[2]=Math.cos(r)*m,y})(x.lng*Math.PI/180,x.lat*Math.PI/180)}function ko(x,r){return x/(2*Math.PI)/Math.cos(r*Math.PI/180)}function Nl(x){const r=Math.asin(x[1])/Math.PI*180,h=Math.sqrt(x[0]*x[0]+x[2]*x[2]);if(h>1e-6){const m=x[0]/h,y=Math.acos(x[2]/h),w=(m>0?y:-y)/Math.PI*180;return new a.S(a.aO(w,-180,180),r)}return new a.S(0,r)}function Ji(x){return Math.cos(x*Math.PI/180)}function ci(x,r){const h=Ji(x),m=Ji(r);return a.ak(m/h)}function Lu(x,r){const h=x.rotate(r.bearingInRadians),m=r.zoom+ci(r.center.lat,0),y=a.bk(1/Ji(r.center.lat),1/Ji(Math.min(Math.abs(r.center.lat),60)),a.bn(m,7,3,0,1)),w=360/Ua({worldSize:r.worldSize,center:{lat:r.center.lat}});return new a.S(r.center.lng-h.x*w*y,a.ah(r.center.lat+h.y*w,-a.ai,a.ai))}function Do(x){const r=.5*x,h=Math.sin(r),m=Math.cos(r);return Math.log(h+m)-Math.log(m-h)}function Fh(x,r,h,m){const y=x.lat+h*m;if(Math.abs(h)>1){const w=(Math.sign(x.lat+h)!==Math.sign(x.lat)?-Math.abs(x.lat):Math.abs(x.lat))*Math.PI/180,P=Math.abs(x.lat+h)*Math.PI/180,R=Do(w+m*(P-w)),D=Do(w),B=Do(P);return new a.S(x.lng+r*((R-D)/(B-D)),y)}return new a.S(x.lng+r*m,y)}class Nh{constructor(r){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=r}swapBuffers(){if(!this._hadAnyChanges)return;const r=this._cachePrevious;this._cachePrevious=this._cache,this._cache=r,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(r,h,m,y){const w=`${r.z}_${r.x}_${r.y}_${y?.terrain?"t":""}`,P=this._cache.get(w);if(P)return P;const R=this._cachePrevious.get(w);if(R)return this._cache.set(w,R),R;const D=this._boundingVolumeFactory(r,h,m,y);return this._cache.set(w,D),this._hadAnyChanges=!0,D}}class aa{constructor(r,h,m,y){this.min=m,this.max=y,this.points=r,this.planes=h}static fromAabb(r,h){const m=[];for(let y=0;y<8;y++)m.push([1&~y?r[0]:h[0],(y>>1&1)==1?h[1]:r[1],(y>>2&1)==1?h[2]:r[2]]);return new aa(m,[[-1,0,0,h[0]],[1,0,0,-r[0]],[0,-1,0,h[1]],[0,1,0,-r[1]],[0,0,-1,h[2]],[0,0,1,-r[2]]],r,h)}static fromCenterSizeAngles(r,h,m){const y=a.br([],m[0],m[1],m[2]),w=a.bs([],[h[0],0,0],y),P=a.bs([],[0,h[1],0],y),R=a.bs([],[0,0,h[2]],y),D=[...r],B=[...r];for(let W=0;W<8;W++)for(let $=0;$<3;$++){const Z=r[$]+w[$]*(1&~W?-1:1)+P[$]*((W>>1&1)==1?1:-1)+R[$]*((W>>2&1)==1?1:-1);D[$]=Math.min(D[$],Z),B[$]=Math.max(B[$],Z)}const U=[];for(let W=0;W<8;W++){const $=[...r];a.aS($,$,a.aR([],w,1&~W?-1:1)),a.aS($,$,a.aR([],P,(W>>1&1)==1?1:-1)),a.aS($,$,a.aR([],R,(W>>2&1)==1?1:-1)),U.push($)}return new aa(U,[[...w,-a.aX(w,U[0])],[...P,-a.aX(P,U[0])],[...R,-a.aX(R,U[0])],[-w[0],-w[1],-w[2],-a.aX(w,U[7])],[-P[0],-P[1],-P[2],-a.aX(P,U[7])],[-R[0],-R[1],-R[2],-a.aX(R,U[7])]],D,B)}intersectsFrustum(r){let h=!0;const m=this.points.length,y=this.planes.length,w=r.planes.length,P=r.points.length;for(let R=0;R<w;R++){const D=r.planes[R];let B=0;for(let U=0;U<m;U++){const W=this.points[U];D[0]*W[0]+D[1]*W[1]+D[2]*W[2]+D[3]>=0&&B++}if(B===0)return 0;B<m&&(h=!1)}if(h)return 2;for(let R=0;R<y;R++){const D=this.planes[R];let B=0;for(let U=0;U<P;U++){const W=r.points[U];D[0]*W[0]+D[1]*W[1]+D[2]*W[2]+D[3]>=0&&B++}if(B===0)return 0}return 1}intersectsPlane(r){const h=this.points.length;let m=0;for(let y=0;y<h;y++){const w=this.points[y];r[0]*w[0]+r[1]*w[1]+r[2]*w[2]+r[3]>=0&&m++}return m===h?2:m===0?0:1}}function Bi(x,r,h){const m=x-r;return m<0?-m:Math.max(0,m-h)}function la(x,r,h,m,y){const w=x-h;let P;return P=w<0?Math.min(-w,1+w-y):w>1?Math.min(Math.max(w-y,0),1-w):0,Math.max(P,Bi(r,m,y))}class Ks{constructor(){this._boundingVolumeCache=new Nh(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(r,h,m,y){const w=1<<m.z,P=1/w,R=m.x/w,D=m.y/w;let B=2;return B=Math.min(B,la(r,h,R,D,P)),B=Math.min(B,la(r,h,R+.5,-D-P,P)),B=Math.min(B,la(r,h,R+.5,2-D-P,P)),B}getWrap(r,h,m){const y=1<<h.z,w=1/y,P=h.x/y,R=Bi(r.x,P,w),D=Bi(r.x,P-1,w),B=Bi(r.x,P+1,w),U=Math.min(R,D,B);return U===B?1:U===D?-1:0}allowVariableZoom(r,h){return zt(r,h)>4}allowWorldCopies(){return!1}getTileBoundingVolume(r,h,m,y){return this._boundingVolumeCache.getTileBoundingVolume(r,h,m,y)}_computeTileBoundingVolume(r,h,m,y){var w,P;let R=0,D=0;if(y?.terrain){const B=new a.Z(r.z,h,r.z,r.x,r.y),U=y.terrain.getMinMaxElevation(B);R=(w=U.minElevation)!==null&&w!==void 0?w:Math.min(0,m),D=(P=U.maxElevation)!==null&&P!==void 0?P:Math.max(0,m)}if(R/=a.bu,D/=a.bu,R+=1,D+=1,r.z<=0)return aa.fromAabb([-D,-D,-D],[D,D,D]);if(r.z===1)return aa.fromAabb([r.x===0?-D:0,r.y===0?0:-D,-D],[r.x===0?0:D,r.y===0?D:0,D]);{const B=[Ms(0,0,r.x,r.y,r.z),Ms(a.$,0,r.x,r.y,r.z),Ms(a.$,a.$,r.x,r.y,r.z),Ms(0,a.$,r.x,r.y,r.z)],U=[];for(const Ye of B)U.push(a.aR([],Ye,D));if(D!==R)for(const Ye of B)U.push(a.aR([],Ye,R));r.y===0&&U.push([0,1,0]),r.y===(1<<r.z)-1&&U.push([0,-1,0]);const W=[1,1,1],$=[-1,-1,-1];for(const Ye of U)for(let tt=0;tt<3;tt++)W[tt]=Math.min(W[tt],Ye[tt]),$[tt]=Math.max($[tt],Ye[tt]);const Z=Ms(a.$/2,a.$/2,r.x,r.y,r.z),Q=a.aW([],[0,1,0],Z);a.aV(Q,Q);const re=a.aW([],Z,Q);a.aV(re,re);const ae=a.aW([],B[2],B[1]);a.aV(ae,ae);const le=a.aW([],B[0],B[3]);a.aV(le,le),U.push(a.aR([],Z,D)),r.y>=(1<<r.z)/2&&U.push(a.aR([],Ms(a.$/2,0,r.x,r.y,r.z),D)),r.y<(1<<r.z)/2&&U.push(a.aR([],Ms(a.$/2,a.$,r.x,r.y,r.z),D));const pe=Nc(Z,U),be=Nc(re,U),fe=[-Z[0],-Z[1],-Z[2],pe.max],Ae=[Z[0],Z[1],Z[2],-pe.min],Me=[-re[0],-re[1],-re[2],be.max],xe=[re[0],re[1],re[2],-be.min],Re=[...ae,0],Ge=[...le,0],qe=[];return r.y===0?qe.push(a.bt(Ge,Re,fe),a.bt(Ge,Re,Ae)):qe.push(a.bt(Me,Re,fe),a.bt(Me,Re,Ae),a.bt(Me,Ge,fe),a.bt(Me,Ge,Ae)),r.y===(1<<r.z)-1?qe.push(a.bt(Ge,Re,fe),a.bt(Ge,Re,Ae)):qe.push(a.bt(xe,Re,fe),a.bt(xe,Re,Ae),a.bt(xe,Ge,fe),a.bt(xe,Ge,Ae)),new aa(qe,[fe,Ae,Me,xe,Re,Ge],W,$)}}}function Nc(x,r){let h=1/0,m=-1/0;for(const y of r){const w=a.aX(x,y);h=Math.min(h,w),m=Math.max(m,w)}return{min:h,max:m}}class Bc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,h,m){return this._helper.interpolatePadding(r,h,m)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,h){this._helper.resize(r,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}overrideNearFarZ(r,h){this._helper.overrideNearFarZ(r,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(r){}constructor(){this._cachedClippingPlane=a.bv(),this._projectionMatrix=a.b9(),this._globeViewProjMatrix32f=a.b8(),this._globeViewProjMatrixNoCorrection=a.b9(),this._globeViewProjMatrixNoCorrectionInverted=a.b9(),this._globeProjMatrixInverted=a.b9(),this._cameraPosition=a.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Mi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(r,h)=>this.getConstrained(r,h)}),this._coveringTilesDetailsProvider=new Ks}clone(){const r=new Bc;return r.apply(this),r}apply(r,h){this._globeLatitudeErrorCorrectionRadians=h||0,this._helper.apply(r)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const r=a.bp();return r[0]=this._cameraPosition[0],r[1]=this._cameraPosition[1],r[2]=this._cameraPosition[2],r}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(r){const{overscaledTileID:h,applyGlobeMatrix:m}=r,y=this._helper.getMercatorTileCoordinates(h);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:y,clippingPlane:this._cachedClippingPlane,projectionTransition:m?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(r){const h=this.pitchInRadians,m=this.cameraToCenterDistance/r,y=Math.sin(h)*m,w=Math.cos(h)*m+1,P=1/Math.sqrt(y*y+w*w)*1;let R=-y,D=w;const B=Math.sqrt(R*R+D*D);R/=B,D/=B;const U=[0,R,D];a.bw(U,U,[0,0,0],-this.bearingInRadians),a.bx(U,U,[0,0,0],-1*this.center.lat*Math.PI/180),a.by(U,U,[0,0,0],this.center.lng*Math.PI/180);const W=1/a.aZ(U);return a.aR(U,U,W),[...U,-P*W]}isLocationOccluded(r){return!this.isSurfacePointVisible(Ni(r))}transformLightDirection(r){const h=this._helper._center.lng*Math.PI/180,m=this._helper._center.lat*Math.PI/180,y=Math.cos(m),w=[Math.sin(h)*y,Math.sin(m),Math.cos(h)*y],P=[w[2],0,-w[0]],R=[0,0,0];a.aW(R,P,w),a.aV(P,P),a.aV(R,R);const D=[0,0,0];return a.aV(D,[P[0]*r[0]+R[0]*r[1]+w[0]*r[2],P[1]*r[0]+R[1]*r[1]+w[1]*r[2],P[2]*r[0]+R[2]*r[1]+w[2]*r[2]]),D}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(r,h,m){const y=(function(R,D,B){const U=1/(1<<B.z);return new a.a1(R/a.$*U+B.x*U,D/a.$*U+B.y*U)})(r,h,m.canonical),w=(P=y.y,[a.bo(y.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-P*Math.PI*2))-.5*Math.PI]);var P;return this.getCircleRadiusCorrection()/Math.cos(w[1])}projectTileCoordinates(r,h,m,y){const w=m.canonical,P=Ms(r,h,w.x,w.y,w.z),R=1+(y?y(r,h):0)/a.bu,D=[P[0]*R,P[1]*R,P[2]*R,1];a.aw(D,D,this._globeViewProjMatrixNoCorrection);const B=this._cachedClippingPlane,U=B[0]*P[0]+B[1]*P[1]+B[2]*P[2]+B[3]<0;return{point:new a.P(D[0]/D[3],D[1]/D[3]),signedDistanceFromCamera:D[3],isOccluded:U}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const r=ko(this.worldSize,this.center.lat),h=a.ba(),m=a.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*r),a.b4(h,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const y=this.centerOffset;h[8]=2*-y.x/this._helper._width,h[9]=2*y.y/this._helper._height,this._projectionMatrix=a.b5(h),this._globeProjMatrixInverted=a.ba(),a.aq(this._globeProjMatrixInverted,h),a.M(h,h,[0,0,-this.cameraToCenterDistance]),a.b6(h,h,this.rollInRadians),a.b7(h,h,-this.pitchInRadians),a.b6(h,h,this.bearingInRadians),a.M(h,h,[0,0,-r]);const w=a.bp();w[0]=r,w[1]=r,w[2]=r,a.b7(m,h,this.center.lat*Math.PI/180),a.bz(m,m,-this.center.lng*Math.PI/180),a.N(m,m,w),this._globeViewProjMatrixNoCorrection=m,a.b7(h,h,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bz(h,h,-this.center.lng*Math.PI/180),a.N(h,h,w),this._globeViewProjMatrix32f=new Float32Array(h),this._globeViewProjMatrixNoCorrectionInverted=a.ba(),a.aq(this._globeViewProjMatrixNoCorrectionInverted,m);const P=a.bp();this._cameraPosition=a.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/r,a.bw(this._cameraPosition,this._cameraPosition,P,-this.rollInRadians),a.bx(this._cameraPosition,this._cameraPosition,P,this.pitchInRadians),a.bw(this._cameraPosition,this._cameraPosition,P,-this.bearingInRadians),a.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bx(this._cameraPosition,this._cameraPosition,P,-this.center.lat*Math.PI/180),a.by(this._cameraPosition,this._cameraPosition,P,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(r);const R=a.b5(this._globeViewProjMatrixNoCorrectionInverted);a.N(R,R,[1,1,-1]),this._cachedFrustum=li.fromInvProjectionMatrix(R,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(r){a.w("calculateFogMatrix is not supported on globe projection.");const h=a.ba();return a.ag(h),h}getVisibleUnwrappedCoordinates(r){return[new a.b2(0,r)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(r){r&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(r,h){if(!this._globeViewProjMatrixNoCorrection)return 1;const m=Ni(r);a.aR(m,m,1+h/a.bu);const y=a.bv();return a.aw(y,[m[0],m[1],m[2],1],this._globeViewProjMatrixNoCorrection),y[2]/y[3]}populateCache(r){}getBounds(){const r=.5*this.width,h=.5*this.height,m=[new a.P(0,0),new a.P(r,0),new a.P(this.width,0),new a.P(this.width,h),new a.P(this.width,this.height),new a.P(r,this.height),new a.P(0,this.height),new a.P(0,h)],y=[];for(const W of m)y.push(this.unprojectScreenPoint(W));let w=0,P=0,R=0,D=0;const B=this.center;for(const W of y){const $=a.bA(B.lng,W.lng),Z=a.bA(B.lat,W.lat);$<P&&(P=$),$>w&&(w=$),Z<D&&(D=Z),Z>R&&(R=Z)}const U=[B.lng+P,B.lat+D,B.lng+w,B.lat+R];return this.isSurfacePointOnScreen([0,1,0])&&(U[3]=90,U[0]=-180,U[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(U[1]=-90,U[0]=-180,U[2]=180),new Hn(U)}getConstrained(r,h){const m=a.ah(r.lat,-a.ai,a.ai),y=a.ah(+h,this.minZoom+ci(0,m),this.maxZoom);return{center:new a.S(r.lng,m),zoom:y}}calculateCenterFromCameraLngLatAlt(r,h,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(r,h,m,y)}setLocationAtPoint(r,h){const m=Ni(this.unprojectScreenPoint(h)),y=Ni(r),w=a.bp();a.bB(w);const P=a.bp();a.by(P,m,w,-this.center.lng*Math.PI/180),a.bx(P,P,w,this.center.lat*Math.PI/180);const R=y[0]*y[0]+y[2]*y[2],D=P[0]*P[0];if(R<D)return;const B=Math.sqrt(R-D),U=-B,W=a.bC(y[0],y[2],P[0],B),$=a.bC(y[0],y[2],P[0],U),Z=a.bp();a.by(Z,y,w,-W);const Q=a.bC(Z[1],Z[2],P[1],P[2]),re=a.bp();a.by(re,y,w,-$);const ae=a.bC(re[1],re[2],P[1],P[2]),le=.5*Math.PI,pe=Q>=-le&&Q<=le,be=ae>=-le&&ae<=le;let fe,Ae;if(pe&&be){const Ge=this.center.lng*Math.PI/180,qe=this.center.lat*Math.PI/180;a.bD(W,Ge)+a.bD(Q,qe)<a.bD($,Ge)+a.bD(ae,qe)?(fe=W,Ae=Q):(fe=$,Ae=ae)}else if(pe)fe=W,Ae=Q;else{if(!be)return;fe=$,Ae=ae}const Me=fe/Math.PI*180,xe=Ae/Math.PI*180,Re=this.center.lat;this.setCenter(new a.S(Me,a.ah(xe,-90,90))),this.setZoom(this.zoom+ci(Re,this.center.lat))}locationToScreenPoint(r,h){const m=Ni(r);if(h){const y=h.getElevationForLngLatZoom(r,this._helper._tileZoom);a.aR(m,m,1+y/a.bu)}return this._projectSurfacePointToScreen(m)}_projectSurfacePointToScreen(r){const h=a.bv();return a.aw(h,[...r,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],new a.P((.5*h[0]+.5)*this.width,(.5*-h[1]+.5)*this.height)}screenPointToMercatorCoordinate(r,h){if(h){const m=h.pointCoordinate(r);if(m)return m}return a.a1.fromLngLat(this.unprojectScreenPoint(r))}screenPointToLocation(r,h){var m;return(m=this.screenPointToMercatorCoordinate(r,h))===null||m===void 0?void 0:m.toLngLat()}isPointOnMapSurface(r,h){const m=this._cameraPosition,y=this.getRayDirectionFromPixel(r);return!!this.rayPlanetIntersection(m,y)}getRayDirectionFromPixel(r){const h=a.bv();h[0]=r.x/this.width*2-1,h[1]=-1*(r.y/this.height*2-1),h[2]=1,h[3]=1,a.aw(h,h,this._globeViewProjMatrixNoCorrectionInverted),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3];const m=a.bp();m[0]=h[0]-this._cameraPosition[0],m[1]=h[1]-this._cameraPosition[1],m[2]=h[2]-this._cameraPosition[2];const y=a.bp();return a.aV(y,m),y}isSurfacePointVisible(r){const h=this._cachedClippingPlane;return h[0]*r[0]+h[1]*r[1]+h[2]*r[2]+h[3]>=0}isSurfacePointOnScreen(r){if(!this.isSurfacePointVisible(r))return!1;const h=a.bv();return a.aw(h,[...r,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3],h[0]>-1&&h[0]<1&&h[1]>-1&&h[1]<1&&h[2]>-1&&h[2]<1}rayPlanetIntersection(r,h){const m=a.aX(r,h),y=a.bp(),w=a.bp();a.aR(w,h,m),a.aU(y,r,w);const P=1-a.aX(y,y);if(P<0)return null;const R=a.aX(r,r)-1,D=-m+(m<0?1:-1)*Math.sqrt(P),B=R/D,U=D;return{tMin:Math.min(B,U),tMax:Math.max(B,U)}}unprojectScreenPoint(r){const h=this._cameraPosition,m=this.getRayDirectionFromPixel(r),y=this.rayPlanetIntersection(h,m);if(y){const U=a.bp();a.aS(U,h,[m[0]*y.tMin,m[1]*y.tMin,m[2]*y.tMin]);const W=a.bp();return a.aV(W,U),Nl(W)}const w=this._cachedClippingPlane,P=w[0]*m[0]+w[1]*m[1]+w[2]*m[2],R=-a.b1(w,h)/P,D=a.bp();if(R>0)a.aS(D,h,[m[0]*R,m[1]*R,m[2]*R]);else{const U=a.bp();a.aS(U,h,[2*m[0],2*m[1],2*m[2]]);const W=a.b1(this._cachedClippingPlane,U);a.aU(D,U,[this._cachedClippingPlane[0]*W,this._cachedClippingPlane[1]*W,this._cachedClippingPlane[2]*W])}const B=(function(U){const W=a.bp();return W[0]=U[0]*-U[3],W[1]=U[1]*-U[3],W[2]=U[2]*-U[3],{center:W,radius:Math.sqrt(1-U[3]*U[3])}})(w);return Nl((function(U,W,$){const Z=a.bp();a.aU(Z,$,U);const Q=a.bp();return a.bq(Q,U,Z,W/a.a$(Z)),Q})(B.center,B.radius,D))}getMatrixForModel(r,h){const m=a.S.convert(r),y=1/a.bu,w=a.b9();return a.bz(w,w,m.lng/180*Math.PI),a.b7(w,w,-m.lat/180*Math.PI),a.M(w,w,[0,0,1+h/a.bu]),a.b7(w,w,.5*Math.PI),a.N(w,w,[y,y,y]),w}getProjectionDataForCustomLayer(r=!0){const h=this.getProjectionData({overscaledTileID:new a.Z(0,0,0,0,0),applyGlobeMatrix:r});return h.tileMercatorCoords=[0,0,1,1],h}getFastPathSimpleProjectionMatrix(r){}}class zc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,h,m){return this._helper.interpolatePadding(r,h,m)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,h,m=!0){this._helper.resize(r,h,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}overrideNearFarZ(r,h){this._helper.overrideNearFarZ(r,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(r,h){this._globeness=r,this._globeLatitudeErrorCorrectionRadians=h,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Mi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(r,h)=>this.getConstrained(r,h)}),this._globeness=1,this._mercatorTransform=new si,this._verticalPerspectiveTransform=new Bc}clone(){const r=new zc;return r._globeness=this._globeness,r._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,r.apply(this),r}apply(r){this._helper.apply(r),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(r){const h=this._mercatorTransform.getProjectionData(r),m=this._verticalPerspectiveTransform.getProjectionData(r);return{mainMatrix:this.isGlobeRendering?m.mainMatrix:h.mainMatrix,clippingPlane:m.clippingPlane,tileMercatorCoords:m.tileMercatorCoords,projectionTransition:r.applyGlobeMatrix?this._globeness:0,fallbackMatrix:h.fallbackMatrix}}isLocationOccluded(r){return this.currentTransform.isLocationOccluded(r)}transformLightDirection(r){return this.currentTransform.transformLightDirection(r)}getPixelScale(){return a.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(r,h,m){const y=this._mercatorTransform.getPitchedTextCorrection(r,h,m),w=this._verticalPerspectiveTransform.getPitchedTextCorrection(r,h,m);return a.bk(y,w,this._globeness)}projectTileCoordinates(r,h,m,y){return this.currentTransform.projectTileCoordinates(r,h,m,y)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(r){return this.currentTransform.calculateFogMatrix(r)}getVisibleUnwrappedCoordinates(r){return this.currentTransform.getVisibleUnwrappedCoordinates(r)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(r){this._mercatorTransform.recalculateZoomAndCenter(r),this._verticalPerspectiveTransform.recalculateZoomAndCenter(r)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(r,h){return this.currentTransform.lngLatToCameraDepth(r,h)}populateCache(r){this._mercatorTransform.populateCache(r),this._verticalPerspectiveTransform.populateCache(r)}getBounds(){return this.currentTransform.getBounds()}getConstrained(r,h){return this.currentTransform.getConstrained(r,h)}calculateCenterFromCameraLngLatAlt(r,h,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(r,h,m,y)}setLocationAtPoint(r,h){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(r,h),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(r,h),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(r,h){return this.currentTransform.locationToScreenPoint(r,h)}screenPointToMercatorCoordinate(r,h){return this.currentTransform.screenPointToMercatorCoordinate(r,h)}screenPointToLocation(r,h){return this.currentTransform.screenPointToLocation(r,h)}isPointOnMapSurface(r,h){return this.currentTransform.isPointOnMapSurface(r,h)}getRayDirectionFromPixel(r){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(r)}getMatrixForModel(r,h){return this.currentTransform.getMatrixForModel(r,h)}getProjectionDataForCustomLayer(r=!0){const h=this._mercatorTransform.getProjectionDataForCustomLayer(r);if(!this.isGlobeRendering)return h;const m=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(r);return m.fallbackMatrix=h.mainMatrix,m}getFastPathSimpleProjectionMatrix(r){return this.currentTransform.getFastPathSimpleProjectionMatrix(r)}}class nr{get useGlobeControls(){return!0}handlePanInertia(r,h){const m=Lu(r,h);return Math.abs(m.lng-h.center.lng)>180&&(m.lng=h.center.lng+179.5*Math.sign(m.lng-h.center.lng)),{easingCenter:m,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(r,h){const m=r.around,y=h.screenPointToLocation(m);r.bearingDelta&&h.setBearing(h.bearing+r.bearingDelta),r.pitchDelta&&h.setPitch(h.pitch+r.pitchDelta),r.rollDelta&&h.setRoll(h.roll+r.rollDelta);const w=h.zoom;r.zoomDelta&&h.setZoom(h.zoom+r.zoomDelta);const P=h.zoom-w;if(P===0)return;const R=a.bA(h.center.lng,y.lng),D=R/(Math.abs(R/180)+1),B=a.bA(h.center.lat,y.lat),U=h.getRayDirectionFromPixel(m),W=h.cameraPosition,$=-1*a.aX(W,U),Z=a.bp();a.aS(Z,W,[U[0]*$,U[1]*$,U[2]*$]);const Q=a.aZ(Z)-1,re=Math.exp(.5*-Math.max(Q-.3,0)),ae=ko(h.worldSize,h.center.lat)/Math.min(h.width,h.height),le=a.bn(ae,.9,.5,1,.25),pe=(1-a.af(-P))*Math.min(re,le),be=h.center.lat,fe=h.zoom,Ae=new a.S(h.center.lng+D*pe,a.ah(h.center.lat+B*pe,-a.ai,a.ai));h.setLocationAtPoint(y,m);const Me=h.center,xe=a.bn(Math.abs(R),45,85,0,1),Re=a.bn(ae,.75,.35,0,1),Ge=Math.pow(Math.max(xe,Re),.25),qe=a.bA(Me.lng,Ae.lng),Ye=a.bA(Me.lat,Ae.lat);h.setCenter(new a.S(Me.lng+qe*Ge,Me.lat+Ye*Ge).wrap()),h.setZoom(fe+ci(be,h.center.lat))}handleMapControlsPan(r,h,m){if(!r.panDelta)return;const y=h.center.lat,w=h.zoom;h.setCenter(Lu(r.panDelta,h).wrap()),h.setZoom(w+ci(y,h.center.lat))}cameraForBoxAndBearing(r,h,m,y,w){const P=fs(r,h,m,y,w),R=h.left/w.width*2-1,D=(w.width-h.right)/w.width*2-1,B=h.top/w.height*-2+1,U=(w.height-h.bottom)/w.height*-2+1,W=a.bA(m.getWest(),m.getEast())<0,$=W?m.getEast():m.getWest(),Z=W?m.getWest():m.getEast(),Q=Math.max(m.getNorth(),m.getSouth()),re=Math.min(m.getNorth(),m.getSouth()),ae=$+.5*a.bA($,Z),le=Q+.5*a.bA(Q,re),pe=w.clone();pe.setCenter(P.center),pe.setBearing(P.bearing),pe.setPitch(0),pe.setRoll(0),pe.setZoom(P.zoom);const be=pe.modelViewProjectionMatrix,fe=[Ni(m.getNorthWest()),Ni(m.getNorthEast()),Ni(m.getSouthWest()),Ni(m.getSouthEast()),Ni(new a.S(Z,le)),Ni(new a.S($,le)),Ni(new a.S(ae,Q)),Ni(new a.S(ae,re))],Ae=Ni(P.center);let Me=Number.POSITIVE_INFINITY;for(const xe of fe)R<0&&(Me=nr.getLesserNonNegativeNonNull(Me,nr.solveVectorScale(xe,Ae,be,"x",R))),D>0&&(Me=nr.getLesserNonNegativeNonNull(Me,nr.solveVectorScale(xe,Ae,be,"x",D))),B>0&&(Me=nr.getLesserNonNegativeNonNull(Me,nr.solveVectorScale(xe,Ae,be,"y",B))),U<0&&(Me=nr.getLesserNonNegativeNonNull(Me,nr.solveVectorScale(xe,Ae,be,"y",U)));if(Number.isFinite(Me)&&Me!==0)return P.zoom=pe.zoom+a.ak(Me),P;Lh()}handleJumpToCenterZoom(r,h){const m=r.center.lat,y=r.getConstrained(h.center?a.S.convert(h.center):r.center,r.zoom).center;r.setCenter(y.wrap());const w=h.zoom!==void 0?+h.zoom:r.zoom+ci(m,y.lat);r.zoom!==w&&r.setZoom(w)}handleEaseTo(r,h){const m=r.zoom,y=r.center,w=r.padding,P={roll:r.roll,pitch:r.pitch,bearing:r.bearing},R={roll:h.roll===void 0?r.roll:h.roll,pitch:h.pitch===void 0?r.pitch:h.pitch,bearing:h.bearing===void 0?r.bearing:h.bearing},D=h.zoom!==void 0,B=!r.isPaddingEqual(h.padding);let U=!1;const W=h.center?a.S.convert(h.center):y,$=r.getConstrained(W,m).center;qs(r,$);const Z=r.clone();Z.setCenter($),Z.setZoom(D?+h.zoom:m+ci(y.lat,W.lat)),Z.setBearing(h.bearing);const Q=new a.P(a.ah(r.centerPoint.x+h.offsetAsPoint.x,0,r.width),a.ah(r.centerPoint.y+h.offsetAsPoint.y,0,r.height));Z.setLocationAtPoint($,Q);const re=(h.offset&&h.offsetAsPoint.mag())>0?Z.center:$,ae=D?+h.zoom:m+ci(y.lat,re.lat),le=m+ci(y.lat,0),pe=ae+ci(re.lat,0),be=a.bA(y.lng,re.lng),fe=a.bA(y.lat,re.lat),Ae=a.af(pe-le);return U=ae!==m,{easeFunc:Me=>{if(a.be(P,R)||Ki({startEulerAngles:P,endEulerAngles:R,tr:r,k:Me,useSlerp:P.roll!=R.roll}),B&&r.interpolatePadding(w,h.padding,Me),h.around)a.w("Easing around a point is not supported under globe projection."),r.setLocationAtPoint(h.around,h.aroundPoint);else{const xe=pe>le?Math.min(2,Ae):Math.max(.5,Ae),Re=Math.pow(xe,1-Me),Ge=Fh(y,be,fe,Me*Re);r.setCenter(Ge.wrap())}if(U){const xe=a.C.number(le,pe,Me)+ci(0,r.center.lat);r.setZoom(xe)}},isZooming:U,elevationCenter:re}}handleFlyTo(r,h){const m=h.zoom!==void 0,y=r.center,w=r.zoom,P=r.padding,R=!r.isPaddingEqual(h.padding),D=r.getConstrained(a.S.convert(h.center||h.locationAtOffset),w).center,B=m?+h.zoom:r.zoom+ci(r.center.lat,D.lat),U=r.clone();U.setCenter(D),U.setZoom(B),U.setBearing(h.bearing);const W=new a.P(a.ah(r.centerPoint.x+h.offsetAsPoint.x,0,r.width),a.ah(r.centerPoint.y+h.offsetAsPoint.y,0,r.height));U.setLocationAtPoint(D,W);const $=U.center;qs(r,$);const Z=(function(fe,Ae,Me){const xe=Ni(Ae),Re=Ni(Me),Ge=a.aX(xe,Re),qe=Math.acos(Ge),Ye=Ua(fe);return qe/(2*Math.PI)*Ye})(r,y,$),Q=w+ci(y.lat,0),re=B+ci($.lat,0),ae=a.af(re-Q);let le;if(typeof h.minZoom=="number"){const fe=+h.minZoom+ci($.lat,0),Ae=Math.min(fe,Q,re)+ci(0,$.lat),Me=r.getConstrained($,Ae).zoom+ci($.lat,0);le=a.af(Me-Q)}const pe=a.bA(y.lng,$.lng),be=a.bA(y.lat,$.lat);return{easeFunc:(fe,Ae,Me,xe)=>{const Re=Fh(y,pe,be,Me);R&&r.interpolatePadding(P,h.padding,fe);const Ge=fe===1?$:Re;r.setCenter(Ge.wrap());const qe=Q+a.ak(Ae);r.setZoom(fe===1?B:qe+ci(0,Ge.lat))},scaleOfZoom:ae,targetCenter:$,scaleOfMinZoom:le,pixelPathLength:Z}}static solveVectorScale(r,h,m,y,w){const P=y==="x"?[m[0],m[4],m[8],m[12]]:[m[1],m[5],m[9],m[13]],R=[m[3],m[7],m[11],m[15]],D=r[0]*P[0]+r[1]*P[1]+r[2]*P[2],B=r[0]*R[0]+r[1]*R[1]+r[2]*R[2],U=h[0]*P[0]+h[1]*P[1]+h[2]*P[2],W=h[0]*R[0]+h[1]*R[1]+h[2]*R[2];return U+w*B===D+w*W||R[3]*(D-U)+P[3]*(W-B)+D*W==U*B?null:(U+P[3]-w*W-w*R[3])/(U-D-w*W+w*B)}static getLesserNonNegativeNonNull(r,h){return h!==null&&h>=0&&h<r?h:r}}class Qd{constructor(r){this._globe=r,this._mercatorCameraHelper=new fr,this._verticalPerspectiveCameraHelper=new nr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(r,h){return this.currentHelper.handlePanInertia(r,h)}handleMapControlsRollPitchBearingZoom(r,h){return this.currentHelper.handleMapControlsRollPitchBearingZoom(r,h)}handleMapControlsPan(r,h,m){this.currentHelper.handleMapControlsPan(r,h,m)}cameraForBoxAndBearing(r,h,m,y,w){return this.currentHelper.cameraForBoxAndBearing(r,h,m,y,w)}handleJumpToCenterZoom(r,h){this.currentHelper.handleJumpToCenterZoom(r,h)}handleEaseTo(r,h){return this.currentHelper.handleEaseTo(r,h)}handleFlyTo(r,h){return this.currentHelper.handleFlyTo(r,h)}}const Fu=(x,r)=>a.y(x,r&&r.filter((h=>h.identifier!=="source.canvas"))),jp=a.bE();class Bh extends a.E{constructor(r,h={}){var m,y;super(),this._rtlPluginLoaded=()=>{for(const P in this.sourceCaches){const R=this.sourceCaches[P].getSource().type;R!=="vector"&&R!=="geojson"||this.sourceCaches[P].reload()}},this.map=r,this.dispatcher=new $t(It(),r._getMapId()),this.dispatcher.registerMessageHandler("GG",((P,R)=>this.getGlyphs(P,R))),this.dispatcher.registerMessageHandler("GI",((P,R)=>this.getImages(P,R))),this.dispatcher.registerMessageHandler("GDA",((P,R)=>this.getDashes(P,R))),this.imageManager=new vt,this.imageManager.setEventedParent(this);const w=((m=r._container)===null||m===void 0?void 0:m.lang)||typeof document<"u"&&((y=document.documentElement)===null||y===void 0?void 0:y.lang)||void 0;this.glyphManager=new sn(r._requestManager,h.localIdeographFontFamily,w),this.lineAtlas=new Ue(256,512),this.crossTileSymbolIndex=new ia,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",a.bG()),Jr().on(ds,this._rtlPluginLoaded),this.on("data",(P=>{if(P.dataType!=="source"||P.sourceDataType!=="metadata")return;const R=this.sourceCaches[P.sourceId];if(!R)return;const D=R.getSource();if(D&&D.vectorLayerIds)for(const B in this._layers){const U=this._layers[B];U.source===D.id&&this._validateLayer(U)}}))}setGlobalStateProperty(r,h){var m,y,w;this._checkLoaded();const P=h===null?(w=(y=(m=this.stylesheet.state)===null||m===void 0?void 0:m[r])===null||y===void 0?void 0:y.default)!==null&&w!==void 0?w:null:h;if(a.bH(P,this._globalState[r]))return this;this._globalState[r]=P,this._applyGlobalStateChanges([r])}getGlobalState(){return this._globalState}setGlobalState(r){this._checkLoaded();const h=[];for(const m in r)!a.bH(this._globalState[m],r[m].default)&&(h.push(m),this._globalState[m]=r[m].default);this._applyGlobalStateChanges(h)}_applyGlobalStateChanges(r){if(r.length===0)return;const h=new Set,m={};for(const y of r){m[y]=this._globalState[y];for(const w in this._layers){const P=this._layers[w],R=P.getLayoutAffectingGlobalStateRefs(),D=P.getPaintAffectingGlobalStateRefs();if(R.has(y)&&h.add(P.source),D.has(y))for(const{name:B,value:U}of D.get(y))this._updatePaintProperty(P,B,U)}}this.dispatcher.broadcast("UGS",m);for(const y in this.sourceCaches)h.has(y)&&(this._reloadSource(y),this._changed=!0)}loadURL(r,h={},m){this.fire(new a.l("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const y=this.map._requestManager.transformRequest(r,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;a.j(y,this._loadStyleRequest).then((P=>{this._loadStyleRequest=null,this._load(P.data,h,m)})).catch((P=>{this._loadStyleRequest=null,P&&!w.signal.aborted&&this.fire(new a.k(P))}))}loadJSON(r,h={},m){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,L.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(r,h,m)})).catch((()=>{}))}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(jp,{validate:!1})}_load(r,h,m){var y,w;let P=h.transformStyle?h.transformStyle(m,r):r;if(!h.validate||!Fu(this,a.z(P))){P=Object.assign({},P),this._loaded=!0,this.stylesheet=P;for(const R in P.sources)this.addSource(R,P.sources[R],{validate:!1});P.sprite?this._loadSprite(P.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(P.glyphs),this._createLayers(),this.light=new Pe(this.stylesheet.light),this._setProjectionInternal(((y=this.stylesheet.projection)===null||y===void 0?void 0:y.type)||"mercator"),this.sky=new ge(this.stylesheet.sky),this.map.setTerrain((w=this.stylesheet.terrain)!==null&&w!==void 0?w:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){var r;const h=a.bI(this.stylesheet.layers);this.setGlobalState((r=this.stylesheet.state)!==null&&r!==void 0?r:null),this.dispatcher.broadcast("SL",h),this._order=h.map((m=>m.id)),this._layers={},this._serializedLayers=null;for(const m of h){const y=a.bJ(m,this._globalState);y.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=y}}_loadSprite(r,h=!1,m=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(w,P,R,D){return a._(this,void 0,void 0,(function*(){const B=nt(w),U=R>1?"@2x":"",W={},$={};for(const{id:Z,url:Q}of B){const re=P.transformRequest(dt(Q,U,".json"),"SpriteJSON");W[Z]=a.j(re,D);const ae=P.transformRequest(dt(Q,U,".png"),"SpriteImage");$[Z]=Se.getImage(ae,D)}return yield Promise.all([...Object.values(W),...Object.values($)]),(function(Z,Q){return a._(this,void 0,void 0,(function*(){const re={};for(const ae in Z){re[ae]={};const le=L.getImageCanvasContext((yield Q[ae]).data),pe=(yield Z[ae]).data;for(const be in pe){const{width:fe,height:Ae,x:Me,y:xe,sdf:Re,pixelRatio:Ge,stretchX:qe,stretchY:Ye,content:tt,textFitWidth:bt,textFitHeight:_t}=pe[be];re[ae][be]={data:null,pixelRatio:Ge,sdf:Re,stretchX:qe,stretchY:Ye,content:tt,textFitWidth:bt,textFitHeight:_t,spriteData:{width:fe,height:Ae,x:Me,y:xe,context:le}}}}return re}))})(W,$)}))})(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((w=>{if(this._spriteRequest=null,w)for(const P in w){this._spritesImagesIds[P]=[];const R=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter((D=>!(D in w))):[];for(const D of R)this.imageManager.removeImage(D),this._changedImages[D]=!0;for(const D in w[P]){const B=P==="default"?D:`${P}:${D}`;this._spritesImagesIds[P].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,w[P][D],!1):this.imageManager.addImage(B,w[P][D]),h&&(this._changedImages[B]=!0)}}})).catch((w=>{this._spriteRequest=null,y=w,this.fire(new a.k(y))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),m&&m(y)}))}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(r){const h=this.sourceCaches[r.source];if(!h)return;const m=r.sourceLayer;if(!m)return;const y=h.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(m)===-1)&&this.fire(new a.k(new Error(`Source layer "${m}" does not exist on source "${y.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r,h=!1){const m=this._serializedAllLayers();if(!r||r.length===0)return Object.values(h?a.bK(m):m);const y=[];for(const w of r)if(m[w]){const P=h?a.bK(m[w]):m[w];y.push(P)}return y}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const h=Object.keys(this._layers);for(const m of h){const y=this._layers[m];y.type!=="custom"&&(r[m]=y.serialize())}return r}hasTransitions(){var r,h,m;if(!((r=this.light)===null||r===void 0)&&r.hasTransition()||!((h=this.sky)===null||h===void 0)&&h.hasTransition()||!((m=this.projection)===null||m===void 0)&&m.hasTransition())return!0;for(const y in this.sourceCaches)if(this.sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const h=this._changed;if(h){const y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(y.length||w.length)&&this._updateWorkerLayers(y,w);for(const P in this._updatedSources){const R=this._updatedSources[P];if(R==="reload")this._reloadSource(P);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(r);this.light.updateTransitions(r),this.sky.updateTransitions(r),this._resetUpdates()}const m={};for(const y in this.sourceCaches){const w=this.sourceCaches[y];m[y]=w.used,w.used=!1}for(const y of this._order){const w=this._layers[y];w.recalculate(r,this._availableImages),!w.isHidden(r.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const y in m){const w=this.sourceCaches[y];!!m[y]!=!!w.used&&w.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(r),this.sky.recalculate(r),this.projection.recalculate(r),this.z=r.zoom,h&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(r,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,h={}){var m;this._checkLoaded();const y=this.serialize();if(r=h.transformStyle?h.transformStyle(y,r):r,((m=h.validate)===null||m===void 0||m)&&Fu(this,a.z(r)))return!1;(r=a.bK(r)).layers=a.bI(r.layers);const w=a.bL(y,r),P=this._getOperationsToPerform(w);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const R of P.operations)R();return this.stylesheet=r,this._serializedLayers=null,!0}_getOperationsToPerform(r){const h=[],m=[];for(const y of r)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":h.push((()=>this.addLayer.apply(this,y.args)));break;case"removeLayer":h.push((()=>this.removeLayer.apply(this,y.args)));break;case"setPaintProperty":h.push((()=>this.setPaintProperty.apply(this,y.args)));break;case"setLayoutProperty":h.push((()=>this.setLayoutProperty.apply(this,y.args)));break;case"setFilter":h.push((()=>this.setFilter.apply(this,y.args)));break;case"addSource":h.push((()=>this.addSource.apply(this,y.args)));break;case"removeSource":h.push((()=>this.removeSource.apply(this,y.args)));break;case"setLayerZoomRange":h.push((()=>this.setLayerZoomRange.apply(this,y.args)));break;case"setLight":h.push((()=>this.setLight.apply(this,y.args)));break;case"setGeoJSONSourceData":h.push((()=>this.setGeoJSONSourceData.apply(this,y.args)));break;case"setGlyphs":h.push((()=>this.setGlyphs.apply(this,y.args)));break;case"setSprite":h.push((()=>this.setSprite.apply(this,y.args)));break;case"setTerrain":h.push((()=>this.map.setTerrain.apply(this,y.args)));break;case"setSky":h.push((()=>this.setSky.apply(this,y.args)));break;case"setProjection":this.setProjection.apply(this,y.args);break;case"setGlobalState":h.push((()=>this.setGlobalState.apply(this,y.args)));break;case"setTransition":h.push((()=>{}));break;default:m.push(y.command)}return{operations:h,unimplemented:m}}addImage(r,h){if(this.getImage(r))return this.fire(new a.k(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,h),this._afterImageUpdated(r)}updateImage(r,h){this.imageManager.updateImage(r,h)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new a.k(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,h,m={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.z.source,`sources.${r}`,h,null,m))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const y=this.sourceCaches[r]=new Dn(r,h,this.dispatcher);y.style=this,y.setEventedParent(this,(()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:r}))),y.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===r)return this.fire(new a.k(new Error(`Source "${r}" cannot be removed while layer "${m}" is using it.`)));const h=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],h.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,h){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const m=this.sourceCaches[r].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(h),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,h,m={}){this._checkLoaded();const y=r.id;if(this.getLayer(y))return void this.fire(new a.k(new Error(`Layer "${y}" already exists on this map.`)));let w;if(r.type==="custom"){if(Fu(this,a.bM(r)))return;w=a.bJ(r,this._globalState)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(y,r.source),r=a.bK(r),r=a.e(r,{source:y})),this._validate(a.z.layer,`layers.${y}`,r,{arrayIndex:-1},m))return;w=a.bJ(r,this._globalState),this._validateLayer(w),w.setEventedParent(this,{layer:{id:y}})}const P=h?this._order.indexOf(h):this._order.length;if(h&&P===-1)this.fire(new a.k(new Error(`Cannot add layer "${y}" before non-existing layer "${h}".`)));else{if(this._order.splice(P,0,y),this._layerOrderChanged=!0,this._layers[y]=w,this._removedLayers[y]&&w.source&&w.type!=="custom"){const R=this._removedLayers[y];delete this._removedLayers[y],R.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(r,h){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new a.k(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===h)return;const m=this._order.indexOf(r);this._order.splice(m,1);const y=h?this._order.indexOf(h):this._order.length;h&&y===-1?this.fire(new a.k(new Error(`Cannot move layer "${r}" before non-existing layer "${h}".`))):(this._order.splice(y,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const h=this._layers[r];if(!h)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${r}".`)));h.setEventedParent(null);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=h,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],h.onRemove&&h.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,h,m){this._checkLoaded();const y=this.getLayer(r);y?y.minzoom===h&&y.maxzoom===m||(h!=null&&(y.minzoom=h),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,h,m={}){this._checkLoaded();const y=this.getLayer(r);if(y){if(!a.bH(y.filter,h))return h==null?(y.setFilter(void 0),void this._updateLayer(y)):void(this._validate(a.z.filter,`layers.${y.id}.filter`,h,null,m)||(y.setFilter(a.bK(h)),this._updateLayer(y)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return a.bK(this.getLayer(r).filter)}setLayoutProperty(r,h,m,y={}){this._checkLoaded();const w=this.getLayer(r);w?a.bH(w.getLayoutProperty(h),m)||(w.setLayoutProperty(h,m,y),this._updateLayer(w)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,h){const m=this.getLayer(r);if(m)return m.getLayoutProperty(h);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,h,m,y={}){this._checkLoaded();const w=this.getLayer(r);w?a.bH(w.getPaintProperty(h),m)||this._updatePaintProperty(w,h,m,y):this.fire(new a.k(new Error(`Cannot style non-existing layer "${r}".`)))}_updatePaintProperty(r,h,m,y={}){r.setPaintProperty(h,m,y)&&this._updateLayer(r),this._changed=!0,this._updatedPaintProps[r.id]=!0,this._serializedLayers=null}getPaintProperty(r,h){return this.getLayer(r).getPaintProperty(h)}setFeatureState(r,h){this._checkLoaded();const m=r.source,y=r.sourceLayer,w=this.sourceCaches[m];if(w===void 0)return void this.fire(new a.k(new Error(`The source '${m}' does not exist in the map's style.`)));const P=w.getSource().type;P==="geojson"&&y?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||y?(r.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),w.setFeatureState(y,r.id,h)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,h){this._checkLoaded();const m=r.source,y=this.sourceCaches[m];if(y===void 0)return void this.fire(new a.k(new Error(`The source '${m}' does not exist in the map's style.`)));const w=y.getSource().type,P=w==="vector"?r.sourceLayer:void 0;w!=="vector"||P?h&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(P,r.id,h):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const h=r.source,m=r.sourceLayer,y=this.sourceCaches[h];if(y!==void 0)return y.getSource().type!=="vector"||m?(r.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),y.getFeatureState(m,r.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=a.bN(this.sourceCaches,(w=>w.serialize())),h=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,y=this.stylesheet;return a.bO({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,projection:y.projection,sources:r,layers:h,terrain:m},(w=>w!==void 0))}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const h=P=>this._layers[P].type==="fill-extrusion",m={},y=[];for(let P=this._order.length-1;P>=0;P--){const R=this._order[P];if(h(R)){m[R]=P;for(const D of r){const B=D[R];if(B)for(const U of B)y.push(U)}}}y.sort(((P,R)=>R.intersectionZ-P.intersectionZ));const w=[];for(let P=this._order.length-1;P>=0;P--){const R=this._order[P];if(h(R))for(let D=y.length-1;D>=0;D--){const B=y[D].feature;if(m[B.layer.id]<P)break;w.push(B),y.pop()}else for(const D of r){const B=D[R];if(B)for(const U of B)w.push(U.feature)}}return w}queryRenderedFeatures(r,h,m){h&&h.filter&&this._validate(a.z.filter,"queryRenderedFeatures.filter",h.filter,null,h);const y={};if(h&&h.layers){if(!(Array.isArray(h.layers)||h.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const B of h.layers){const U=this._layers[B];if(!U)return this.fire(new a.k(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];y[U.source]=!0}}const w=[];h.availableImages=this._availableImages;const P=this._serializedAllLayers(),R=h.layers instanceof Set?h.layers:Array.isArray(h.layers)?new Set(h.layers):null,D=Object.assign(Object.assign({},h),{layers:R,globalState:this._globalState});for(const B in this.sourceCaches)h.layers&&!y[B]||w.push(an(this.sourceCaches[B],this._layers,P,r,D,m,this.map.terrain?(U,W,$)=>this.map.terrain.getElevation(U,W,$):void 0));return this.placement&&w.push((function(B,U,W,$,Z,Q,re){const ae={},le=Q.queryRenderedSymbols($),pe=[];for(const be of Object.keys(le).map(Number))pe.push(re[be]);pe.sort(_n);for(const be of pe){const fe=be.featureIndex.lookupSymbolFeatures(le[be.bucketInstanceId],U,be.bucketIndex,be.sourceLayerIndex,{filterSpec:Z.filter,globalState:Z.globalState},Z.layers,Z.availableImages,B);for(const Ae in fe){const Me=ae[Ae]=ae[Ae]||[],xe=fe[Ae];xe.sort(((Re,Ge)=>{const qe=be.featureSortOrder;if(qe){const Ye=qe.indexOf(Re.featureIndex);return qe.indexOf(Ge.featureIndex)-Ye}return Ge.featureIndex-Re.featureIndex}));for(const Re of xe)Me.push(Re)}}return(function(be,fe,Ae){for(const Me in be)for(const xe of be[Me])Gi(xe,Ae[fe[Me].source]);return be})(ae,B,W)})(this._layers,P,this.sourceCaches,r,D,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(r,h){h?.filter&&this._validate(a.z.filter,"querySourceFeatures.filter",h.filter,null,h);const m=this.sourceCaches[r];return m?(function(y,w){const P=y.getRenderableIds().map((B=>y.getTileByID(B))),R=[],D={};for(let B=0;B<P.length;B++){const U=P[B],W=U.tileID.canonical.key;D[W]||(D[W]=!0,U.querySourceFeatures(R,w))}return R})(m,h?Object.assign(Object.assign({},h),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(r,h={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const P in r)if(!a.bH(r[P],m[P])){y=!0;break}if(!y)return;const w={now:L.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,h),this.light.updateTransitions(w)}getProjection(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.projection}setProjection(r){if(this._checkLoaded(),this.projection){if(this.projection.name===r.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=r,this._setProjectionInternal(r.type)}getSky(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.sky}setSky(r,h={}){this._checkLoaded();const m=this.getSky();let y=!1;if(!r&&!m)return;if(r&&!m)y=!0;else if(!r&&m)y=!0;else for(const P in r)if(!a.bH(r[P],m[P])){y=!0;break}if(!y)return;const w={now:L.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=r,this.sky.setSky(r,h),this.sky.updateTransitions(w)}_setProjectionInternal(r){const h=(function(m){if(Array.isArray(m)){const y=new Fl({type:m});return{projection:y,transform:new zc,cameraHelper:new Qd(y)}}switch(m){case"mercator":return{projection:new An,transform:new si,cameraHelper:new fr};case"globe":{const y=new Fl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:y,transform:new zc,cameraHelper:new Qd(y)}}case"vertical-perspective":return{projection:new Ll,transform:new Bc,cameraHelper:new nr};default:return a.w(`Unknown projection name: ${m}. Falling back to mercator projection.`),{projection:new An,transform:new si,cameraHelper:new fr}}})(r);this.projection=h.projection,this.map.migrateProjection(h.transform,h.cameraHelper);for(const m in this.sourceCaches)this.sourceCaches[m].reload()}_validate(r,h,m,y,w={}){return(!w||w.validate!==!1)&&Fu(this,r.call(a.z,a.e({key:h,style:this.serialize(),value:m,styleSpec:a.v},y)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Jr().off(ds,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const m=this.sourceCaches[h];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const h in this.sourceCaches)this.sourceCaches[h].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,h,m,y,w=!1){let P=!1,R=!1;const D={};for(const B of this._order){const U=this._layers[B];if(U.type!=="symbol")continue;if(!D[U.source]){const $=this.sourceCaches[U.source];D[U.source]=$.getRenderableIds(!0).map((Z=>$.getTileByID(Z))).sort(((Z,Q)=>Q.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(Q.tileID)?-1:1)))}const W=this.crossTileSymbolIndex.addLayer(U,D[U.source],r.center.lng);P=P||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(L.now(),r.zoom))&&(this.pauseablePlacement=new Lc(r,this.map.terrain,this._order,w,h,m,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(L.now()),R=!0),P&&this.pauseablePlacement.placement.setStale()),R||P)for(const B of this._order){const U=this._layers[B];U.type==="symbol"&&this.placement.updateLayerOpacities(U,D[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(L.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,h){return a._(this,void 0,void 0,(function*(){const m=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,h.icons),m}))}getGlyphs(r,h){return a._(this,void 0,void 0,(function*(){const m=yield this.glyphManager.getGlyphs(h.stacks),y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,[""]),m}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,h={}){this._checkLoaded(),r&&this._validate(a.z.glyphs,"glyphs",r,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}getDashes(r,h){return a._(this,void 0,void 0,(function*(){const m={};for(const[y,w]of Object.entries(h.dashes))m[y]=this.lineAtlas.getDash(w.dasharray,w.round);return m}))}addSprite(r,h,m={},y){this._checkLoaded();const w=[{id:r,url:h}],P=[...nt(this.stylesheet.sprite),...w];this._validate(a.z.sprite,"sprite",P,null,m)||(this.stylesheet.sprite=P,this._loadSprite(w,!0,y))}removeSprite(r){this._checkLoaded();const h=nt(this.stylesheet.sprite);if(h.find((m=>m.id===r))){if(this._spritesImagesIds[r])for(const m of this._spritesImagesIds[r])this.imageManager.removeImage(m),this._changedImages[m]=!0;h.splice(h.findIndex((m=>m.id===r)),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return nt(this.stylesheet.sprite)}setSprite(r,h={},m){this._checkLoaded(),r&&this._validate(a.z.sprite,"sprite",r,null,h)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,m):(this._unloadSprite(),m&&m(null)))}}var Vp=a.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ef{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,h,m,y,w,P,R,D,B){this.context=r;let U=this.boundPaintVertexBuffers.length!==y.length;for(let W=0;!U&&W<y.length;W++)this.boundPaintVertexBuffers[W]!==y[W]&&(U=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==m||U||this.boundIndexBuffer!==w||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==B?this.freshBind(h,m,y,w,P,R,D,B):(r.bindVertexArray.set(this.vao),R&&R.bind(),w&&w.dynamicDraw&&w.bind(),D&&D.bind(),B&&B.bind())}freshBind(r,h,m,y,w,P,R,D){const B=r.numAttributes,U=this.context,W=U.gl;this.vao&&this.destroy(),this.vao=U.createVertexArray(),U.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=D,h.enableAttributes(W,r);for(const $ of m)$.enableAttributes(W,r);P&&P.enableAttributes(W,r),R&&R.enableAttributes(W,r),D&&D.enableAttributes(W,r),h.bind(),h.setVertexAttribPointers(W,r,w);for(const $ of m)$.bind(),$.setVertexAttribPointers(W,r,w);P&&(P.bind(),P.setVertexAttribPointers(W,r,w)),y&&y.bind(),R&&(R.bind(),R.setVertexAttribPointers(W,r,w)),D&&(D.bind(),D.setVertexAttribPointers(W,r,w)),U.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Nu=(x,r,h,m,y)=>({u_texture:0,u_ele_delta:x,u_fog_matrix:r,u_fog_color:h?h.properties.get("fog-color"):a.bf.white,u_fog_ground_blend:h?h.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?0:h?h.calculateFogBlendOpacity(m):0,u_horizon_color:h?h.properties.get("horizon-color"):a.bf.white,u_horizon_fog_blend:h?h.properties.get("horizon-fog-blend"):1,u_is_globe_mode:y?1:0}),zh={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ja(x){const r=[];for(let h=0;h<x.length;h++){if(x[h]===null)continue;const m=x[h].split(" ");r.push(m.pop())}return r}class Uh{constructor(r,h,m,y,w,P,R,D,B=[]){const U=r.gl;this.program=U.createProgram();const W=ja(h.staticAttributes),$=m?m.getBinderAttributes():[],Z=W.concat($),Q=Is.prelude.staticUniforms?ja(Is.prelude.staticUniforms):[],re=R.staticUniforms?ja(R.staticUniforms):[],ae=h.staticUniforms?ja(h.staticUniforms):[],le=m?m.getBinderUniforms():[],pe=Q.concat(re).concat(ae).concat(le),be=[];for(const qe of pe)be.indexOf(qe)<0&&be.push(qe);const fe=m?m.defines():[];mo(U)&&fe.unshift("#version 300 es"),w&&fe.push("#define OVERDRAW_INSPECTOR;"),P&&fe.push("#define TERRAIN3D;"),D&&fe.push(D),B&&fe.push(...B);let Ae=fe.concat(Is.prelude.fragmentSource,R.fragmentSource,h.fragmentSource).join(`
`),Me=fe.concat(Is.prelude.vertexSource,R.vertexSource,h.vertexSource).join(`
`);mo(U)||(Ae=(function(qe){return qe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Ae),Me=(function(qe){return qe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Me));const xe=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(xe,Ae),U.compileShader(xe),!U.getShaderParameter(xe,U.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${U.getShaderInfoLog(xe)}`);U.attachShader(this.program,xe);const Re=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(Re,Me),U.compileShader(Re),!U.getShaderParameter(Re,U.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${U.getShaderInfoLog(Re)}`);U.attachShader(this.program,Re),this.attributes={};const Ge={};this.numAttributes=Z.length;for(let qe=0;qe<this.numAttributes;qe++)Z[qe]&&(U.bindAttribLocation(this.program,qe,Z[qe]),this.attributes[Z[qe]]=qe);if(U.linkProgram(this.program),!U.getProgramParameter(this.program,U.LINK_STATUS))throw new Error(`Program failed to link: ${U.getProgramInfoLog(this.program)}`);U.deleteShader(Re),U.deleteShader(xe);for(let qe=0;qe<be.length;qe++){const Ye=be[qe];if(Ye&&!Ge[Ye]){const tt=U.getUniformLocation(this.program,Ye);tt&&(Ge[Ye]=tt)}}this.fixedUniforms=y(r,Ge),this.terrainUniforms=((qe,Ye)=>({u_depth:new a.bP(qe,Ye.u_depth),u_terrain:new a.bP(qe,Ye.u_terrain),u_terrain_dim:new a.bg(qe,Ye.u_terrain_dim),u_terrain_matrix:new a.bR(qe,Ye.u_terrain_matrix),u_terrain_unpack:new a.bS(qe,Ye.u_terrain_unpack),u_terrain_exaggeration:new a.bg(qe,Ye.u_terrain_exaggeration)}))(r,Ge),this.projectionUniforms=((qe,Ye)=>({u_projection_matrix:new a.bR(qe,Ye.u_projection_matrix),u_projection_tile_mercator_coords:new a.bS(qe,Ye.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bS(qe,Ye.u_projection_clipping_plane),u_projection_transition:new a.bg(qe,Ye.u_projection_transition),u_projection_fallback_matrix:new a.bR(qe,Ye.u_projection_fallback_matrix)}))(r,Ge),this.binderUniforms=m?m.getUniforms(r,Ge):[]}draw(r,h,m,y,w,P,R,D,B,U,W,$,Z,Q,re,ae,le,pe,be){const fe=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(y),r.setColorMode(w),r.setCullFace(P),D){r.activeTexture.set(fe.TEXTURE2),fe.bindTexture(fe.TEXTURE_2D,D.depthTexture),r.activeTexture.set(fe.TEXTURE3),fe.bindTexture(fe.TEXTURE_2D,D.texture);for(const Me in this.terrainUniforms)this.terrainUniforms[Me].set(D[Me])}if(B)for(const Me in B)this.projectionUniforms[zh[Me]].set(B[Me]);if(R)for(const Me in this.fixedUniforms)this.fixedUniforms[Me].set(R[Me]);ae&&ae.setUniforms(r,this.binderUniforms,Q,{zoom:re});let Ae=0;switch(h){case fe.LINES:Ae=2;break;case fe.TRIANGLES:Ae=3;break;case fe.LINE_STRIP:Ae=1}for(const Me of Z.get()){const xe=Me.vaos||(Me.vaos={});(xe[U]||(xe[U]=new ef)).bind(r,this,W,ae?ae.getPaintVertexBuffers():[],$,Me.vertexOffset,le,pe,be),fe.drawElements(h,Me.primitiveLength*Ae,fe.UNSIGNED_SHORT,Me.primitiveOffset*Ae*2)}}}function Bl(x,r,h){const m=1/a.aC(h,1,r.transform.tileZoom),y=Math.pow(2,h.tileID.overscaledZ),w=h.tileSize*Math.pow(2,r.transform.tileZoom)/y,P=w*(h.tileID.canonical.x+h.tileID.wrap*y),R=w*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[P>>16,R>>16],u_pixel_coord_lower:[65535&P,65535&R]}}const Js=(x,r,h,m)=>{const y=x.style.light,w=y.properties.get("position"),P=[w.x,w.y,w.z],R=a.bV();y.properties.get("anchor")==="viewport"&&a.bW(R,x.transform.bearingInRadians),a.bX(P,P,R);const D=x.transform.transformLightDirection(P),B=y.properties.get("color");return{u_lightpos:P,u_lightpos_globe:D,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+r,u_opacity:h,u_fill_translate:m}},$p=(x,r,h,m,y,w,P)=>a.e(Js(x,r,h,m),Bl(w,x,P),{u_height_factor:-Math.pow(2,y.overscaledZ)/P.tileSize/8}),Bu=(x,r,h,m)=>a.e(Bl(r,x,h),{u_fill_translate:m}),zl=(x,r)=>({u_world:x,u_fill_translate:r}),Uc=(x,r,h,m,y)=>a.e(Bu(x,r,h,y),{u_world:m}),Wp=(x,r,h,m,y)=>{const w=x.transform;let P,R,D=0;if(h.paint.get("circle-pitch-alignment")==="map"){const B=a.aC(r,1,w.zoom);P=!0,R=[B,B],D=B/(a.$*Math.pow(2,r.tileID.overscaledZ))*2*Math.PI*y}else P=!1,R=w.pixelsToGLUnits;return{u_camera_to_center_distance:w.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+P,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:R,u_globe_extrude_scale:D,u_translate:m}},zu=x=>({u_pixel_extrude_scale:[1/x.width,1/x.height]}),Hp=x=>({u_viewport_size:[x.width,x.height]}),Va=(x,r=1)=>({u_color:x,u_overlay:0,u_overlay_scale:r}),tf=(x,r,h,m)=>{const y=a.aC(x,1,r)/(a.$*Math.pow(2,x.tileID.overscaledZ))*2*Math.PI*m;return{u_extrude_scale:a.aC(x,1,r),u_intensity:h,u_globe_extrude_scale:y}},jh=(x,r,h,m)=>{const y=a.L();a.bY(y,0,x.width,x.height,0,0,1);const w=x.context.gl;return{u_matrix:y,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:h,u_color_ramp:m,u_opacity:r.paint.get("heatmap-opacity")}},Vh=(x,r,h)=>{const m=h.paint.get("hillshade-accent-color");let y;switch(h.paint.get("hillshade-method")){case"basic":y=4;break;case"combined":y=1;break;case"igor":y=2;break;case"multidirectional":y=3;break;default:y=0}const w=h.getIlluminationProperties();for(let P=0;P<w.directionRadians.length;P++)h.paint.get("hillshade-illumination-anchor")==="viewport"&&(w.directionRadians[P]+=x.transform.bearingInRadians);return{u_image:0,u_latrange:$h(0,r.tileID),u_exaggeration:h.paint.get("hillshade-exaggeration"),u_altitudes:w.altitudeRadians,u_azimuths:w.directionRadians,u_accent:m,u_method:y,u_highlights:w.highlightColor,u_shadows:w.shadowColor}},Ul=(x,r)=>{const h=r.stride,m=a.L();return a.bY(m,0,a.$,-a.$,0,0,1),a.M(m,m,[0,-a.$,0]),{u_matrix:m,u_image:1,u_dimension:[h,h],u_zoom:x.overscaledZ,u_unpack:r.getUnpackVector()}};function $h(x,r){const h=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new a.a1(0,m/h).toLngLat().lat,new a.a1(0,(m+1)/h).toLngLat().lat]}const Wh=(x,r,h=0)=>({u_image:0,u_unpack:r.getUnpackVector(),u_dimension:[r.stride,r.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:h,u_opacity:x.paint.get("color-relief-opacity")}),jc=(x,r,h,m)=>{const y=x.transform;return{u_translation:Xh(x,r,h),u_ratio:m/a.aC(r,1,y.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Hh=(x,r,h,m,y)=>a.e(jc(x,r,h,m),{u_image:0,u_image_height:y}),Zh=(x,r,h,m,y)=>{const w=x.transform,P=ua(r,w);return{u_translation:Xh(x,r,h),u_texsize:r.imageAtlasTexture.size,u_ratio:m/a.aC(r,1,w.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[P,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},ca=(x,r,h,m,y)=>{const w=ua(r,x.transform);return a.e(jc(x,r,h,m),{u_tileratio:w,u_crossfade_from:y.fromScale,u_crossfade_to:y.toScale,u_image:0,u_mix:y.t,u_lineatlas_width:x.lineAtlas.width,u_lineatlas_height:x.lineAtlas.height})};function ua(x,r){return 1/a.aC(x,1,r.tileZoom)}function Xh(x,r,h){return a.aD(x.transform,r,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Vc=(x,r,h,m,y)=>{return{u_tl_parent:x,u_scale_parent:r,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(P=m.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=m.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Zp(m.paint.get("raster-hue-rotate")),u_coords_top:[y[0].x,y[0].y,y[1].x,y[1].y],u_coords_bottom:[y[3].x,y[3].y,y[2].x,y[2].y]};var w,P};function Zp(x){x*=Math.PI/180;const r=Math.sin(x),h=Math.cos(x);return[(2*h+1)/3,(-Math.sqrt(3)*r-h+1)/3,(Math.sqrt(3)*r-h+1)/3]}const jl=(x,r,h,m,y,w,P,R,D,B,U,W,$)=>{const Z=P.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Z.width/Z.height,u_fade_change:P.options.fadeDuration?P.symbolFadeChange:1,u_label_plane_matrix:R,u_coord_matrix:D,u_is_text:+U,u_pitch_with_map:+m,u_is_along_line:y,u_is_variable_anchor:w,u_texsize:W,u_texture:0,u_translation:B,u_pitched_scale:$}},qh=(x,r,h,m,y,w,P,R,D,B,U,W,$,Z)=>{const Q=P.transform;return a.e(jl(x,r,h,m,y,w,P,R,D,B,U,W,Z),{u_gamma_scale:m?Math.cos(Q.pitch*Math.PI/180)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:P.pixelRatio,u_is_halo:1})},$c=(x,r,h,m,y,w,P,R,D,B,U,W,$)=>a.e(qh(x,r,h,m,y,w,P,R,D,B,!0,U,0,$),{u_texsize_icon:W,u_texture_icon:1}),Vl=(x,r)=>({u_opacity:x,u_color:r}),nf=(x,r,h,m,y)=>a.e((function(w,P,R,D){const B=R.imageManager.getPattern(w.from.toString()),U=R.imageManager.getPattern(w.to.toString()),{width:W,height:$}=R.imageManager.getPixelSize(),Z=Math.pow(2,D.tileID.overscaledZ),Q=D.tileSize*Math.pow(2,R.transform.tileZoom)/Z,re=Q*(D.tileID.canonical.x+D.tileID.wrap*Z),ae=Q*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[W,$],u_mix:P.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/a.aC(D,1,R.transform.tileZoom),u_pixel_coord_upper:[re>>16,ae>>16],u_pixel_coord_lower:[65535&re,65535&ae]}})(h,y,r,m),{u_opacity:x}),$l=(x,r)=>{},Gh={fillExtrusion:(x,r)=>({u_lightpos:new a.bT(x,r.u_lightpos),u_lightpos_globe:new a.bT(x,r.u_lightpos_globe),u_lightintensity:new a.bg(x,r.u_lightintensity),u_lightcolor:new a.bT(x,r.u_lightcolor),u_vertical_gradient:new a.bg(x,r.u_vertical_gradient),u_opacity:new a.bg(x,r.u_opacity),u_fill_translate:new a.bU(x,r.u_fill_translate)}),fillExtrusionPattern:(x,r)=>({u_lightpos:new a.bT(x,r.u_lightpos),u_lightpos_globe:new a.bT(x,r.u_lightpos_globe),u_lightintensity:new a.bg(x,r.u_lightintensity),u_lightcolor:new a.bT(x,r.u_lightcolor),u_vertical_gradient:new a.bg(x,r.u_vertical_gradient),u_height_factor:new a.bg(x,r.u_height_factor),u_opacity:new a.bg(x,r.u_opacity),u_fill_translate:new a.bU(x,r.u_fill_translate),u_image:new a.bP(x,r.u_image),u_texsize:new a.bU(x,r.u_texsize),u_pixel_coord_upper:new a.bU(x,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(x,r.u_pixel_coord_lower),u_scale:new a.bT(x,r.u_scale),u_fade:new a.bg(x,r.u_fade)}),fill:(x,r)=>({u_fill_translate:new a.bU(x,r.u_fill_translate)}),fillPattern:(x,r)=>({u_image:new a.bP(x,r.u_image),u_texsize:new a.bU(x,r.u_texsize),u_pixel_coord_upper:new a.bU(x,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(x,r.u_pixel_coord_lower),u_scale:new a.bT(x,r.u_scale),u_fade:new a.bg(x,r.u_fade),u_fill_translate:new a.bU(x,r.u_fill_translate)}),fillOutline:(x,r)=>({u_world:new a.bU(x,r.u_world),u_fill_translate:new a.bU(x,r.u_fill_translate)}),fillOutlinePattern:(x,r)=>({u_world:new a.bU(x,r.u_world),u_image:new a.bP(x,r.u_image),u_texsize:new a.bU(x,r.u_texsize),u_pixel_coord_upper:new a.bU(x,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(x,r.u_pixel_coord_lower),u_scale:new a.bT(x,r.u_scale),u_fade:new a.bg(x,r.u_fade),u_fill_translate:new a.bU(x,r.u_fill_translate)}),circle:(x,r)=>({u_camera_to_center_distance:new a.bg(x,r.u_camera_to_center_distance),u_scale_with_map:new a.bP(x,r.u_scale_with_map),u_pitch_with_map:new a.bP(x,r.u_pitch_with_map),u_extrude_scale:new a.bU(x,r.u_extrude_scale),u_device_pixel_ratio:new a.bg(x,r.u_device_pixel_ratio),u_globe_extrude_scale:new a.bg(x,r.u_globe_extrude_scale),u_translate:new a.bU(x,r.u_translate)}),collisionBox:(x,r)=>({u_pixel_extrude_scale:new a.bU(x,r.u_pixel_extrude_scale)}),collisionCircle:(x,r)=>({u_viewport_size:new a.bU(x,r.u_viewport_size)}),debug:(x,r)=>({u_color:new a.bQ(x,r.u_color),u_overlay:new a.bP(x,r.u_overlay),u_overlay_scale:new a.bg(x,r.u_overlay_scale)}),depth:$l,clippingMask:$l,heatmap:(x,r)=>({u_extrude_scale:new a.bg(x,r.u_extrude_scale),u_intensity:new a.bg(x,r.u_intensity),u_globe_extrude_scale:new a.bg(x,r.u_globe_extrude_scale)}),heatmapTexture:(x,r)=>({u_matrix:new a.bR(x,r.u_matrix),u_world:new a.bU(x,r.u_world),u_image:new a.bP(x,r.u_image),u_color_ramp:new a.bP(x,r.u_color_ramp),u_opacity:new a.bg(x,r.u_opacity)}),hillshade:(x,r)=>({u_image:new a.bP(x,r.u_image),u_latrange:new a.bU(x,r.u_latrange),u_exaggeration:new a.bg(x,r.u_exaggeration),u_altitudes:new a.b_(x,r.u_altitudes),u_azimuths:new a.b_(x,r.u_azimuths),u_accent:new a.bQ(x,r.u_accent),u_method:new a.bP(x,r.u_method),u_shadows:new a.bZ(x,r.u_shadows),u_highlights:new a.bZ(x,r.u_highlights)}),hillshadePrepare:(x,r)=>({u_matrix:new a.bR(x,r.u_matrix),u_image:new a.bP(x,r.u_image),u_dimension:new a.bU(x,r.u_dimension),u_zoom:new a.bg(x,r.u_zoom),u_unpack:new a.bS(x,r.u_unpack)}),colorRelief:(x,r)=>({u_image:new a.bP(x,r.u_image),u_unpack:new a.bS(x,r.u_unpack),u_dimension:new a.bU(x,r.u_dimension),u_elevation_stops:new a.bP(x,r.u_elevation_stops),u_color_stops:new a.bP(x,r.u_color_stops),u_color_ramp_size:new a.bP(x,r.u_color_ramp_size),u_opacity:new a.bg(x,r.u_opacity)}),line:(x,r)=>({u_translation:new a.bU(x,r.u_translation),u_ratio:new a.bg(x,r.u_ratio),u_device_pixel_ratio:new a.bg(x,r.u_device_pixel_ratio),u_units_to_pixels:new a.bU(x,r.u_units_to_pixels)}),lineGradient:(x,r)=>({u_translation:new a.bU(x,r.u_translation),u_ratio:new a.bg(x,r.u_ratio),u_device_pixel_ratio:new a.bg(x,r.u_device_pixel_ratio),u_units_to_pixels:new a.bU(x,r.u_units_to_pixels),u_image:new a.bP(x,r.u_image),u_image_height:new a.bg(x,r.u_image_height)}),linePattern:(x,r)=>({u_translation:new a.bU(x,r.u_translation),u_texsize:new a.bU(x,r.u_texsize),u_ratio:new a.bg(x,r.u_ratio),u_device_pixel_ratio:new a.bg(x,r.u_device_pixel_ratio),u_image:new a.bP(x,r.u_image),u_units_to_pixels:new a.bU(x,r.u_units_to_pixels),u_scale:new a.bT(x,r.u_scale),u_fade:new a.bg(x,r.u_fade)}),lineSDF:(x,r)=>({u_translation:new a.bU(x,r.u_translation),u_ratio:new a.bg(x,r.u_ratio),u_device_pixel_ratio:new a.bg(x,r.u_device_pixel_ratio),u_units_to_pixels:new a.bU(x,r.u_units_to_pixels),u_image:new a.bP(x,r.u_image),u_mix:new a.bg(x,r.u_mix),u_tileratio:new a.bg(x,r.u_tileratio),u_crossfade_from:new a.bg(x,r.u_crossfade_from),u_crossfade_to:new a.bg(x,r.u_crossfade_to),u_lineatlas_width:new a.bg(x,r.u_lineatlas_width),u_lineatlas_height:new a.bg(x,r.u_lineatlas_height)}),raster:(x,r)=>({u_tl_parent:new a.bU(x,r.u_tl_parent),u_scale_parent:new a.bg(x,r.u_scale_parent),u_buffer_scale:new a.bg(x,r.u_buffer_scale),u_fade_t:new a.bg(x,r.u_fade_t),u_opacity:new a.bg(x,r.u_opacity),u_image0:new a.bP(x,r.u_image0),u_image1:new a.bP(x,r.u_image1),u_brightness_low:new a.bg(x,r.u_brightness_low),u_brightness_high:new a.bg(x,r.u_brightness_high),u_saturation_factor:new a.bg(x,r.u_saturation_factor),u_contrast_factor:new a.bg(x,r.u_contrast_factor),u_spin_weights:new a.bT(x,r.u_spin_weights),u_coords_top:new a.bS(x,r.u_coords_top),u_coords_bottom:new a.bS(x,r.u_coords_bottom)}),symbolIcon:(x,r)=>({u_is_size_zoom_constant:new a.bP(x,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(x,r.u_is_size_feature_constant),u_size_t:new a.bg(x,r.u_size_t),u_size:new a.bg(x,r.u_size),u_camera_to_center_distance:new a.bg(x,r.u_camera_to_center_distance),u_pitch:new a.bg(x,r.u_pitch),u_rotate_symbol:new a.bP(x,r.u_rotate_symbol),u_aspect_ratio:new a.bg(x,r.u_aspect_ratio),u_fade_change:new a.bg(x,r.u_fade_change),u_label_plane_matrix:new a.bR(x,r.u_label_plane_matrix),u_coord_matrix:new a.bR(x,r.u_coord_matrix),u_is_text:new a.bP(x,r.u_is_text),u_pitch_with_map:new a.bP(x,r.u_pitch_with_map),u_is_along_line:new a.bP(x,r.u_is_along_line),u_is_variable_anchor:new a.bP(x,r.u_is_variable_anchor),u_texsize:new a.bU(x,r.u_texsize),u_texture:new a.bP(x,r.u_texture),u_translation:new a.bU(x,r.u_translation),u_pitched_scale:new a.bg(x,r.u_pitched_scale)}),symbolSDF:(x,r)=>({u_is_size_zoom_constant:new a.bP(x,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(x,r.u_is_size_feature_constant),u_size_t:new a.bg(x,r.u_size_t),u_size:new a.bg(x,r.u_size),u_camera_to_center_distance:new a.bg(x,r.u_camera_to_center_distance),u_pitch:new a.bg(x,r.u_pitch),u_rotate_symbol:new a.bP(x,r.u_rotate_symbol),u_aspect_ratio:new a.bg(x,r.u_aspect_ratio),u_fade_change:new a.bg(x,r.u_fade_change),u_label_plane_matrix:new a.bR(x,r.u_label_plane_matrix),u_coord_matrix:new a.bR(x,r.u_coord_matrix),u_is_text:new a.bP(x,r.u_is_text),u_pitch_with_map:new a.bP(x,r.u_pitch_with_map),u_is_along_line:new a.bP(x,r.u_is_along_line),u_is_variable_anchor:new a.bP(x,r.u_is_variable_anchor),u_texsize:new a.bU(x,r.u_texsize),u_texture:new a.bP(x,r.u_texture),u_gamma_scale:new a.bg(x,r.u_gamma_scale),u_device_pixel_ratio:new a.bg(x,r.u_device_pixel_ratio),u_is_halo:new a.bP(x,r.u_is_halo),u_translation:new a.bU(x,r.u_translation),u_pitched_scale:new a.bg(x,r.u_pitched_scale)}),symbolTextAndIcon:(x,r)=>({u_is_size_zoom_constant:new a.bP(x,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(x,r.u_is_size_feature_constant),u_size_t:new a.bg(x,r.u_size_t),u_size:new a.bg(x,r.u_size),u_camera_to_center_distance:new a.bg(x,r.u_camera_to_center_distance),u_pitch:new a.bg(x,r.u_pitch),u_rotate_symbol:new a.bP(x,r.u_rotate_symbol),u_aspect_ratio:new a.bg(x,r.u_aspect_ratio),u_fade_change:new a.bg(x,r.u_fade_change),u_label_plane_matrix:new a.bR(x,r.u_label_plane_matrix),u_coord_matrix:new a.bR(x,r.u_coord_matrix),u_is_text:new a.bP(x,r.u_is_text),u_pitch_with_map:new a.bP(x,r.u_pitch_with_map),u_is_along_line:new a.bP(x,r.u_is_along_line),u_is_variable_anchor:new a.bP(x,r.u_is_variable_anchor),u_texsize:new a.bU(x,r.u_texsize),u_texsize_icon:new a.bU(x,r.u_texsize_icon),u_texture:new a.bP(x,r.u_texture),u_texture_icon:new a.bP(x,r.u_texture_icon),u_gamma_scale:new a.bg(x,r.u_gamma_scale),u_device_pixel_ratio:new a.bg(x,r.u_device_pixel_ratio),u_is_halo:new a.bP(x,r.u_is_halo),u_translation:new a.bU(x,r.u_translation),u_pitched_scale:new a.bg(x,r.u_pitched_scale)}),background:(x,r)=>({u_opacity:new a.bg(x,r.u_opacity),u_color:new a.bQ(x,r.u_color)}),backgroundPattern:(x,r)=>({u_opacity:new a.bg(x,r.u_opacity),u_image:new a.bP(x,r.u_image),u_pattern_tl_a:new a.bU(x,r.u_pattern_tl_a),u_pattern_br_a:new a.bU(x,r.u_pattern_br_a),u_pattern_tl_b:new a.bU(x,r.u_pattern_tl_b),u_pattern_br_b:new a.bU(x,r.u_pattern_br_b),u_texsize:new a.bU(x,r.u_texsize),u_mix:new a.bg(x,r.u_mix),u_pattern_size_a:new a.bU(x,r.u_pattern_size_a),u_pattern_size_b:new a.bU(x,r.u_pattern_size_b),u_scale_a:new a.bg(x,r.u_scale_a),u_scale_b:new a.bg(x,r.u_scale_b),u_pixel_coord_upper:new a.bU(x,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(x,r.u_pixel_coord_lower),u_tile_units_to_pixels:new a.bg(x,r.u_tile_units_to_pixels)}),terrain:(x,r)=>({u_texture:new a.bP(x,r.u_texture),u_ele_delta:new a.bg(x,r.u_ele_delta),u_fog_matrix:new a.bR(x,r.u_fog_matrix),u_fog_color:new a.bQ(x,r.u_fog_color),u_fog_ground_blend:new a.bg(x,r.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.bg(x,r.u_fog_ground_blend_opacity),u_horizon_color:new a.bQ(x,r.u_horizon_color),u_horizon_fog_blend:new a.bg(x,r.u_horizon_fog_blend),u_is_globe_mode:new a.bg(x,r.u_is_globe_mode)}),terrainDepth:(x,r)=>({u_ele_delta:new a.bg(x,r.u_ele_delta)}),terrainCoords:(x,r)=>({u_texture:new a.bP(x,r.u_texture),u_terrain_coords_id:new a.bg(x,r.u_terrain_coords_id),u_ele_delta:new a.bg(x,r.u_ele_delta)}),projectionErrorMeasurement:(x,r)=>({u_input:new a.bg(x,r.u_input),u_output_expected:new a.bg(x,r.u_output_expected)}),atmosphere:(x,r)=>({u_sun_pos:new a.bT(x,r.u_sun_pos),u_atmosphere_blend:new a.bg(x,r.u_atmosphere_blend),u_globe_position:new a.bT(x,r.u_globe_position),u_globe_radius:new a.bg(x,r.u_globe_radius),u_inv_proj_matrix:new a.bR(x,r.u_inv_proj_matrix)}),sky:(x,r)=>({u_sky_color:new a.bQ(x,r.u_sky_color),u_horizon_color:new a.bQ(x,r.u_horizon_color),u_horizon:new a.bU(x,r.u_horizon),u_horizon_normal:new a.bU(x,r.u_horizon_normal),u_sky_horizon_blend:new a.bg(x,r.u_sky_horizon_blend),u_sky_blend:new a.bg(x,r.u_sky_blend)})};class Yh{constructor(r,h,m){this.context=r;const y=r.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Wl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qs{constructor(r,h,m,y){this.length=h.length,this.attributes=m,this.itemSize=h.bytesPerElement,this.dynamicDraw=y,this.context=r;const w=r.gl;this.buffer=w.createBuffer(),r.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,h){for(let m=0;m<this.attributes.length;m++){const y=h.attributes[this.attributes[m].name];y!==void 0&&r.enableVertexAttribArray(y)}}setVertexAttribPointers(r,h,m){for(let y=0;y<this.attributes.length;y++){const w=this.attributes[y],P=h.attributes[w.name];P!==void 0&&r.vertexAttribPointer(P,w.components,r[Wl[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Uu extends zn{getDefault(){return a.bf.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ju extends zn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class rf extends zn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Kh extends zn{getDefault(){return[!0,!0,!0,!0]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class $a extends zn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Jh extends zn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Xp extends zn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const h=this.current;(r.func!==h.func||r.ref!==h.ref||r.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class eo extends zn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Wc extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=r,this.dirty=!1}}class sf extends zn{getDefault(){return[0,1]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Qh extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=r,this.dirty=!1}}class of extends zn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class ed extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.BLEND):h.disable(h.BLEND),this.current=r,this.dirty=!1}}class Hl extends zn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Vu extends zn{getDefault(){return a.bf.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class $u extends zn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class ha extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=r,this.dirty=!1}}class Oo extends zn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Lo extends zn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class da extends zn{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class ms extends zn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Hc extends zn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Wa extends zn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Zc extends zn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class fa extends zn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Ha extends zn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Xc extends zn{getDefault(){return null}set(r){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Zl extends zn{getDefault(){return null}set(r){var h;if(r===this.current&&!this.dirty)return;const m=this.gl;mo(m)?m.bindVertexArray(r):(h=m.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class qc extends zn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class td extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Za extends zn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Fo extends zn{constructor(r,h){super(r),this.context=r,this.parent=h}getDefault(){return null}}class No extends Fo{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Gc extends Fo{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Mn extends Fo{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}const Yc="Framebuffer is not complete";class qp{constructor(r,h,m,y,w){this.context=r,this.width=h,this.height=m;const P=r.gl,R=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new No(r,R),y)this.depthAttachment=w?new Mn(r,R):new Gc(r,R);else if(w)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error(Yc)}destroy(){const r=this.context.gl,h=this.colorAttachment.get();if(h&&r.deleteTexture(h),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class Xl{constructor(r){var h,m;if(this.gl=r,this.clearColor=new Uu(this),this.clearDepth=new ju(this),this.clearStencil=new rf(this),this.colorMask=new Kh(this),this.depthMask=new $a(this),this.stencilMask=new Jh(this),this.stencilFunc=new Xp(this),this.stencilOp=new eo(this),this.stencilTest=new Wc(this),this.depthRange=new sf(this),this.depthTest=new Qh(this),this.depthFunc=new of(this),this.blend=new ed(this),this.blendFunc=new Hl(this),this.blendColor=new Vu(this),this.blendEquation=new $u(this),this.cullFace=new ha(this),this.cullFaceSide=new Oo(this),this.frontFace=new Lo(this),this.program=new da(this),this.activeTexture=new ms(this),this.viewport=new Hc(this),this.bindFramebuffer=new Wa(this),this.bindRenderbuffer=new Zc(this),this.bindTexture=new fa(this),this.bindVertexBuffer=new Ha(this),this.bindElementBuffer=new Xc(this),this.bindVertexArray=new Zl(this),this.pixelStoreUnpack=new qc(this),this.pixelStoreUnpackPremultiplyAlpha=new td(this),this.pixelStoreUnpackFlipY=new Za(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),mo(r)){this.HALF_FLOAT=r.HALF_FLOAT;const y=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=r.RGBA16F)!==null&&h!==void 0?h:y?.RGBA16F_EXT,this.RGB16F=(m=r.RGB16F)!==null&&m!==void 0?m:y?.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const y=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=y?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,h){return new Yh(this,r,h)}createVertexBuffer(r,h,m){return new Qs(this,r,h,m)}createRenderbuffer(r,h,m){const y=this.gl,w=y.createRenderbuffer();return this.bindRenderbuffer.set(w),y.renderbufferStorage(y.RENDERBUFFER,r,h,m),this.bindRenderbuffer.set(null),w}createFramebuffer(r,h,m,y){return new qp(this,r,h,m,y)}clear({color:r,depth:h,stencil:m}){const y=this.gl;let w=0;r&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),m!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(w)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){a.bH(r.blendFunction,ti.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return mo(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var h;return mo(this.gl)?this.gl.deleteVertexArray(r):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}let pa;function nd(x,r,h,m,y){const w=x.context,P=x.transform,R=w.gl,D=x.useProgram("collisionBox"),B=[];let U=0,W=0;for(let le=0;le<m.length;le++){const pe=m[le],be=r.getTile(pe).getBucket(h);if(!be)continue;const fe=y?be.textCollisionBox:be.iconCollisionBox,Ae=be.collisionCircleArray;Ae.length>0&&(B.push({circleArray:Ae,circleOffset:W,coord:pe}),U+=Ae.length/4,W=U),fe&&D.draw(w,R.LINES,hn.disabled,In.disabled,x.colorModeForRenderPass(),on.disabled,zu(x.transform),x.style.map.terrain&&x.style.map.terrain.getTerrainData(pe),P.getProjectionData({overscaledTileID:pe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,null,x.transform.zoom,null,null,fe.collisionVertexBuffer)}if(!y||!B.length)return;const $=x.useProgram("collisionCircle"),Z=new a.b$;Z.resize(4*U),Z._trim();let Q=0;for(const le of B)for(let pe=0;pe<le.circleArray.length/4;pe++){const be=4*pe,fe=le.circleArray[be+0],Ae=le.circleArray[be+1],Me=le.circleArray[be+2],xe=le.circleArray[be+3];Z.emplace(Q++,fe,Ae,Me,xe,0),Z.emplace(Q++,fe,Ae,Me,xe,1),Z.emplace(Q++,fe,Ae,Me,xe,2),Z.emplace(Q++,fe,Ae,Me,xe,3)}(!pa||pa.length<2*U)&&(pa=(function(le){const pe=2*le,be=new a.c1;be.resize(pe),be._trim();for(let fe=0;fe<pe;fe++){const Ae=6*fe;be.uint16[Ae+0]=4*fe+0,be.uint16[Ae+1]=4*fe+1,be.uint16[Ae+2]=4*fe+2,be.uint16[Ae+3]=4*fe+2,be.uint16[Ae+4]=4*fe+3,be.uint16[Ae+5]=4*fe+0}return be})(U));const re=w.createIndexBuffer(pa,!0),ae=w.createVertexBuffer(Z,a.c0.members,!0);for(const le of B){const pe=Hp(x.transform);$.draw(w,R.TRIANGLES,hn.disabled,In.disabled,x.colorModeForRenderPass(),on.disabled,pe,x.style.map.terrain&&x.style.map.terrain.getTerrainData(le.coord),null,h.id,ae,re,a.aM.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,x.transform.zoom,null,null,null)}ae.destroy(),re.destroy()}const af=a.ag(new Float32Array(16));function fi(x,r,h,m,y,w){const{horizontalAlign:P,verticalAlign:R}=a.aH(x);return new a.P((-(P-.5)*r/y+m[0])*w,(-(R-.5)*h/y+m[1])*w)}function id(x,r,h,m,y,w){const P=r.tileAnchorPoint.add(new a.P(r.translation[0],r.translation[1]));if(r.pitchWithMap){let R=m.mult(w);h||(R=R.rotate(-y));const D=P.add(R);return Fi(D.x,D.y,r.pitchedLabelPlaneMatrix,r.getElevation).point}if(h){const R=tr(r.tileAnchorPoint.x+1,r.tileAnchorPoint.y,r).point.sub(x),D=Math.atan(R.y/R.x)+(R.x<0?Math.PI:0);return x.add(m.rotate(D))}return x.add(m)}function ql(x,r,h,m,y,w,P,R,D,B,U,W){const $=x.text.placedSymbolArray,Z=x.text.dynamicLayoutVertexArray,Q=x.icon.dynamicLayoutVertexArray,re={};Z.clear();for(let ae=0;ae<$.length;ae++){const le=$.get(ae),pe=le.hidden||!le.crossTileID||x.allowVerticalPlacement&&!le.placedOrientation?null:m[le.crossTileID];if(pe){const be=new a.P(le.anchorX,le.anchorY),fe={getElevation:W,width:y.width,height:y.height,pitchedLabelPlaneMatrix:w,pitchWithMap:h,transform:y,tileAnchorPoint:be,translation:B,unwrappedTileID:U},Ae=h?na(be.x,be.y,fe):tr(be.x,be.y,fe),Me=lt(y.cameraToCenterDistance,Ae.signedDistanceFromCamera);let xe=a.ap(x.textSizeData,R,le)*Me/a.aB;h&&(xe*=x.tilePixelRatio/P);const{width:Re,height:Ge,anchor:qe,textOffset:Ye,textBoxScale:tt}=pe,bt=fi(qe,Re,Ge,Ye,tt,xe),_t=y.getPitchedTextCorrection(be.x+B[0],be.y+B[1],U),ht=id(Ae.point,fe,r,bt,-y.bearingInRadians,_t),Bt=x.allowVerticalPlacement&&le.placedOrientation===a.ao.vertical?Math.PI/2:0;for(let xn=0;xn<le.numGlyphs;xn++)a.av(Z,ht,Bt);D&&le.associatedIconIndex>=0&&(re[le.associatedIconIndex]={shiftedAnchor:ht,angle:Bt})}else ho(le.numGlyphs,Z)}if(D){Q.clear();const ae=x.icon.placedSymbolArray;for(let le=0;le<ae.length;le++){const pe=ae.get(le);if(pe.hidden)ho(pe.numGlyphs,Q);else{const be=re[le];if(be)for(let fe=0;fe<pe.numGlyphs;fe++)a.av(Q,be.shiftedAnchor,be.angle);else ho(pe.numGlyphs,Q)}}x.icon.dynamicLayoutVertexBuffer.updateData(Q)}x.text.dynamicLayoutVertexBuffer.updateData(Z)}function ma(x,r,h){return h.iconsInText&&r?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function Gl(x,r,h,m,y,w,P,R,D,B,U,W,$){const Z=x.context,Q=Z.gl,re=x.transform,ae=R==="map",le=D==="map",pe=R!=="viewport"&&h.layout.get("symbol-placement")!=="point",be=ae&&!le&&!pe,fe=!h.layout.get("symbol-sort-key").isConstant();let Ae=!1;const Me=x.getDepthModeForSublayer(0,hn.ReadOnly),xe=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[],Ge=re.getCircleRadiusCorrection();for(const qe of m){const Ye=r.getTile(qe),tt=Ye.getBucket(h);if(!tt)continue;const bt=y?tt.text:tt.icon;if(!bt||!bt.segments.get().length||!bt.hasVisibleVertices)continue;const _t=bt.programConfigurations.get(h.id),ht=y||tt.sdfIcons,Bt=y?tt.textSizeData:tt.iconSizeData,xn=le||re.pitch!==0,qn=x.useProgram(ma(ht,y,tt),_t),ui=a.an(Bt,re.zoom),oi=x.style.map.terrain&&x.style.map.terrain.getTerrainData(qe);let ni,hi,Di,ii,Qn=[0,0],mi=null;if(y)hi=Ye.glyphAtlasTexture,Di=Q.LINEAR,ni=Ye.glyphAtlasTexture.size,tt.iconsInText&&(Qn=Ye.imageAtlasTexture.size,mi=Ye.imageAtlasTexture,ii=xn||x.options.rotating||x.options.zooming||Bt.kind==="composite"||Bt.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const Ui=h.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear;hi=Ye.imageAtlasTexture,Di=ht||x.options.rotating||x.options.zooming||Ui||xn?Q.LINEAR:Q.NEAREST,ni=Ye.imageAtlasTexture.size}const En=a.aC(Ye,1,x.transform.zoom),rr=Pi(ae,x.transform,En),To=a.L();a.aq(To,rr);const ba=Li(le,ae,x.transform,En),So=a.aD(re,Ye,w,P),wa=re.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),sc=xe&&tt.hasTextData(),Uo=h.layout.get("icon-text-fit")!=="none"&&sc&&tt.hasIconData();if(pe){const Ui=x.style.map.terrain?(sr,gi)=>x.style.map.terrain.getElevation(qe,sr,gi):null,ji=h.layout.get("text-rotation-alignment")==="map";xr(tt,x,y,rr,To,le,B,ji,qe.toUnwrapped(),re.width,re.height,So,Ui)}const hl=y&&xe||Uo,is=pe||hl?af:le?rr:x.transform.clipSpaceToPixelsMatrix,Ta=ht&&h.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let jo;jo=ht?tt.iconsInText?$c(Bt.kind,ui,be,le,pe,hl,x,is,ba,So,ni,Qn,Ge):qh(Bt.kind,ui,be,le,pe,hl,x,is,ba,So,y,ni,0,Ge):jl(Bt.kind,ui,be,le,pe,hl,x,is,ba,So,y,ni,Ge);const Vo={program:qn,buffers:bt,uniformValues:jo,projectionData:wa,atlasTexture:hi,atlasTextureIcon:mi,atlasInterpolation:Di,atlasInterpolationIcon:ii,isSDF:ht,hasHalo:Ta};if(fe&&tt.canOverlap){Ae=!0;const Ui=bt.segments.get();for(const ji of Ui)Re.push({segments:new a.aM([ji]),sortKey:ji.sortKey,state:Vo,terrainData:oi})}else Re.push({segments:bt.segments,sortKey:0,state:Vo,terrainData:oi})}Ae&&Re.sort(((qe,Ye)=>qe.sortKey-Ye.sortKey));for(const qe of Re){const Ye=qe.state;if(Z.activeTexture.set(Q.TEXTURE0),Ye.atlasTexture.bind(Ye.atlasInterpolation,Q.CLAMP_TO_EDGE),Ye.atlasTextureIcon&&(Z.activeTexture.set(Q.TEXTURE1),Ye.atlasTextureIcon&&Ye.atlasTextureIcon.bind(Ye.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),Ye.isSDF){const tt=Ye.uniformValues;Ye.hasHalo&&(tt.u_is_halo=1,Xa(Ye.buffers,qe.segments,h,x,Ye.program,Me,U,W,tt,Ye.projectionData,qe.terrainData)),tt.u_is_halo=0}Xa(Ye.buffers,qe.segments,h,x,Ye.program,Me,U,W,Ye.uniformValues,Ye.projectionData,qe.terrainData)}}function Xa(x,r,h,m,y,w,P,R,D,B,U){const W=m.context;y.draw(W,W.gl.TRIANGLES,w,P,R,on.backCCW,D,U,B,h.id,x.layoutVertexBuffer,x.indexBuffer,r,h.paint,m.transform.zoom,x.programConfigurations.get(h.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function qa(x,r,h,m,y){const w=x.context,P=w.gl,R=In.disabled,D=new ti([P.ONE,P.ONE],a.bf.transparent,[!0,!0,!0,!0]),B=r.getBucket(h);if(!B)return;const U=m.key;let W=h.heatmapFbos.get(U);W||(W=_o(w,r.tileSize,r.tileSize),h.heatmapFbos.set(U,W)),w.bindFramebuffer.set(W.framebuffer),w.viewport.set([0,0,r.tileSize,r.tileSize]),w.clear({color:a.bf.transparent});const $=B.programConfigurations.get(h.id),Z=x.useProgram("heatmap",$,!y),Q=x.transform.getProjectionData({overscaledTileID:r.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),re=x.style.map.terrain.getTerrainData(m);Z.draw(w,P.TRIANGLES,hn.disabled,R,D,on.disabled,tf(r,x.transform.zoom,h.paint.get("heatmap-intensity"),1),re,Q,h.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,h.paint,x.transform.zoom,$)}function Kc(x,r,h,m,y){const w=x.context,P=w.gl,R=x.transform;w.setColorMode(x.colorModeForRenderPass());const D=Yl(w,r),B=h.key,U=r.heatmapFbos.get(B);if(!U)return;w.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,U.colorAttachment.get()),w.activeTexture.set(P.TEXTURE1),D.bind(P.LINEAR,P.CLAMP_TO_EDGE);const W=R.getProjectionData({overscaledTileID:h,applyTerrainMatrix:y,applyGlobeMatrix:!m});x.useProgram("heatmapTexture").draw(w,P.TRIANGLES,hn.disabled,In.disabled,x.colorModeForRenderPass(),on.disabled,jh(x,r,0,1),null,W,r.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments,r.paint,R.zoom),U.destroy(),r.heatmapFbos.delete(B)}function _o(x,r,h){var m,y;const w=x.gl,P=w.createTexture();w.bindTexture(w.TEXTURE_2D,P),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const R=(m=x.HALF_FLOAT)!==null&&m!==void 0?m:w.UNSIGNED_BYTE,D=(y=x.RGBA16F)!==null&&y!==void 0?y:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,D,r,h,0,w.RGBA,R,null);const B=x.createFramebuffer(r,h,!1,!1);return B.colorAttachment.set(P),B}function Yl(x,r){return r.colorRampTexture||(r.colorRampTexture=new a.T(x,r.colorRamp,x.gl.RGBA)),r.colorRampTexture}function Jc(x,r,h,m,y){if(!h||!m||!m.imageAtlas)return;const w=m.imageAtlas.patternPositions;let P=w[h.to.toString()],R=w[h.from.toString()];if(!P&&R&&(P=R),!R&&P&&(R=P),!P||!R){const D=y.getPaintProperty(r);P=w[D],R=w[D]}P&&R&&x.setConstantPatternPositions(P,R)}function Ga(x,r,h,m,y,w,P,R){const D=x.context.gl,B="fill-pattern",U=h.paint.get(B),W=U&&U.constantOr(1),$=h.getCrossfadeParameters();let Z,Q,re,ae,le;const pe=x.transform,be=h.paint.get("fill-translate"),fe=h.paint.get("fill-translate-anchor");P?(Q=W&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=D.LINES):(Q=W?"fillPattern":"fill",Z=D.TRIANGLES);const Ae=U.constantOr(null);for(const Me of m){const xe=r.getTile(Me);if(W&&!xe.patternsLoaded())continue;const Re=xe.getBucket(h);if(!Re)continue;const Ge=Re.programConfigurations.get(h.id),qe=x.useProgram(Q,Ge),Ye=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Me);W&&(x.context.activeTexture.set(D.TEXTURE0),xe.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ge.updatePaintBuffers($)),Jc(Ge,B,Ae,xe,h);const tt=pe.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),bt=a.aD(pe,xe,be,fe);if(P){ae=Re.indexBuffer2,le=Re.segments2;const ht=[D.drawingBufferWidth,D.drawingBufferHeight];re=Q==="fillOutlinePattern"&&W?Uc(x,$,xe,ht,bt):zl(ht,bt)}else ae=Re.indexBuffer,le=Re.segments,re=W?Bu(x,$,xe,bt):{u_fill_translate:bt};const _t=x.stencilModeForClipping(Me);qe.draw(x.context,Z,y,_t,w,on.backCCW,re,Ye,tt,h.id,Re.layoutVertexBuffer,ae,le,h.paint,x.transform.zoom,Ge)}}function Kl(x,r,h,m,y,w,P,R){const D=x.context,B=D.gl,U="fill-extrusion-pattern",W=h.paint.get(U),$=W.constantOr(1),Z=h.getCrossfadeParameters(),Q=h.paint.get("fill-extrusion-opacity"),re=W.constantOr(null),ae=x.transform;for(const le of m){const pe=r.getTile(le),be=pe.getBucket(h);if(!be)continue;const fe=x.style.map.terrain&&x.style.map.terrain.getTerrainData(le),Ae=be.programConfigurations.get(h.id),Me=x.useProgram($?"fillExtrusionPattern":"fillExtrusion",Ae);$&&(x.context.activeTexture.set(B.TEXTURE0),pe.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ae.updatePaintBuffers(Z));const xe=ae.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!R,applyTerrainMatrix:!0});Jc(Ae,U,re,pe,h);const Re=a.aD(ae,pe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ge=h.paint.get("fill-extrusion-vertical-gradient"),qe=$?$p(x,Ge,Q,Re,le,Z,pe):Js(x,Ge,Q,Re);Me.draw(D,D.gl.TRIANGLES,y,w,P,on.backCCW,qe,fe,xe,h.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,h.paint,x.transform.zoom,Ae,x.style.map.terrain&&be.centroidVertexBuffer)}}function Jl(x,r,h,m,y,w,P,R,D){var B;const U=x.style.projection,W=x.context,$=x.transform,Z=W.gl,Q=[`#define NUM_ILLUMINATION_SOURCES ${h.paint.get("hillshade-highlight-color").values.length}`],re=x.useProgram("hillshade",null,!1,Q),ae=!x.options.moving;for(const le of m){const pe=r.getTile(le),be=pe.fbo;if(!be)continue;const fe=U.getMeshFromTileID(W,le.canonical,R,!0,"raster"),Ae=(B=x.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(le);W.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,be.colorAttachment.get());const Me=$.getProjectionData({overscaledTileID:le,aligned:ae,applyGlobeMatrix:!D,applyTerrainMatrix:!0});re.draw(W,Z.TRIANGLES,w,y[le.overscaledZ],P,on.backCCW,Vh(x,pe,h),Ae,Me,h.id,fe.vertexBuffer,fe.indexBuffer,fe.segments)}}function yo(x,r,h,m,y,w,P,R,D){var B;const U=x.style.projection,W=x.context,$=x.transform,Z=W.gl,Q=x.useProgram("colorRelief"),re=!x.options.moving;let ae=!0,le=0;for(const pe of m){const be=r.getTile(pe),fe=be.dem;if(ae){const qe=Z.getParameter(Z.MAX_TEXTURE_SIZE),{elevationTexture:Ye,colorTexture:tt}=h.getColorRampTextures(W,qe,fe.getUnpackVector());W.activeTexture.set(Z.TEXTURE1),Ye.bind(Z.NEAREST,Z.CLAMP_TO_EDGE),W.activeTexture.set(Z.TEXTURE4),tt.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ae=!1,le=Ye.size[0]}if(!fe||!fe.data)continue;const Ae=fe.stride,Me=fe.getPixels();if(W.activeTexture.set(Z.TEXTURE0),W.pixelStoreUnpackPremultiplyAlpha.set(!1),be.demTexture=be.demTexture||x.getTileTexture(Ae),be.demTexture){const qe=be.demTexture;qe.update(Me,{premultiply:!1}),qe.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}else be.demTexture=new a.T(W,Me,Z.RGBA,{premultiply:!1}),be.demTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const xe=U.getMeshFromTileID(W,pe.canonical,R,!0,"raster"),Re=(B=x.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(pe),Ge=$.getProjectionData({overscaledTileID:pe,aligned:re,applyGlobeMatrix:!D,applyTerrainMatrix:!0});Q.draw(W,Z.TRIANGLES,w,y[pe.overscaledZ],P,on.backCCW,Wh(h,be.dem,le),Re,Ge,h.id,xe.vertexBuffer,xe.indexBuffer,xe.segments)}}const Qc=[new a.P(0,0),new a.P(a.$,0),new a.P(a.$,a.$),new a.P(0,a.$)];function Ya(x,r,h,m,y,w,P,R,D=!1,B=!1){const U=m[m.length-1].overscaledZ,W=x.context,$=W.gl,Z=x.useProgram("raster"),Q=x.transform,re=x.style.projection,ae=x.colorModeForRenderPass(),le=!x.options.moving;for(const pe of m){const be=x.getDepthModeForSublayer(pe.overscaledZ-U,h.paint.get("raster-opacity")===1?hn.ReadWrite:hn.ReadOnly,$.LESS),fe=r.getTile(pe);fe.registerFadeDuration(h.paint.get("raster-fade-duration"));const Ae=r.findLoadedParent(pe,0),Me=r.findLoadedSibling(pe),xe=Ql(fe,Ae||Me||null,r,h,x.transform,x.style.map.terrain);let Re,Ge;const qe=h.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;W.activeTexture.set($.TEXTURE0),fe.texture.bind(qe,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),W.activeTexture.set($.TEXTURE1),Ae?(Ae.texture.bind(qe,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,Ae.tileID.overscaledZ-fe.tileID.overscaledZ),Ge=[fe.tileID.canonical.x*Re%1,fe.tileID.canonical.y*Re%1]):fe.texture.bind(qe,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),fe.texture.useMipmap&&W.extTextureFilterAnisotropic&&x.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const Ye=x.style.map.terrain&&x.style.map.terrain.getTerrainData(pe),tt=Q.getProjectionData({overscaledTileID:pe,aligned:le,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),bt=Vc(Ge||[0,0],Re||1,xe,h,R),_t=re.getMeshFromTileID(W,pe.canonical,w,P,"raster");Z.draw(W,$.TRIANGLES,be,y?y[pe.overscaledZ]:In.disabled,ae,D?on.frontCCW:on.backCCW,bt,Ye,tt,h.id,_t.vertexBuffer,_t.indexBuffer,_t.segments)}}function Ql(x,r,h,m,y,w){const P=m.paint.get("raster-fade-duration");if(!w&&P>0){const R=L.now(),D=(R-x.timeAdded)/P,B=r?(R-r.timeAdded)/P:-1,U=h.getSource(),W=zt(y,{tileSize:U.tileSize,roundZoom:U.roundZoom}),$=!r||Math.abs(r.tileID.overscaledZ-W)>Math.abs(x.tileID.overscaledZ-W),Z=$&&x.refreshedUponExpiration?1:a.ah($?D:1-B,0,1);return x.refreshedUponExpiration&&D>=1&&(x.refreshedUponExpiration=!1),r?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const eu=new a.bf(1,0,0,1),lf=new a.bf(0,1,0,1),rd=new a.bf(0,0,1,1),Wu=new a.bf(1,0,1,1),sd=new a.bf(0,1,1,1);function Hu(x,r,h,m){pi(x,0,r+h/2,x.transform.width,h,m)}function vo(x,r,h,m){pi(x,r-h/2,0,h,x.transform.height,m)}function pi(x,r,h,m,y,w){const P=x.context,R=P.gl;R.enable(R.SCISSOR_TEST),R.scissor(r*x.pixelRatio,h*x.pixelRatio,m*x.pixelRatio,y*x.pixelRatio),P.clear({color:w}),R.disable(R.SCISSOR_TEST)}function Rs(x,r,h){const m=x.context,y=m.gl,w=x.useProgram("debug"),P=hn.disabled,R=In.disabled,D=x.colorModeForRenderPass(),B="$debug",U=x.style.map.terrain&&x.style.map.terrain.getTerrainData(h);m.activeTexture.set(y.TEXTURE0);const W=r.getTileByID(h.key).latestRawTileData,$=Math.floor((W&&W.byteLength||0)/1024),Z=r.getTile(h).tileSize,Q=512/Math.min(Z,512)*(h.overscaledZ/x.transform.zoom)*.5;let re=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(re+=` => ${h.overscaledZ}`),(function(le,pe){le.initDebugOverlayCanvas();const be=le.debugOverlayCanvas,fe=le.context.gl,Ae=le.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,be.width,be.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(pe,5,5),Ae.strokeText(pe,5,5),le.debugOverlayTexture.update(be),le.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)})(x,`${re} ${$}kB`);const ae=x.transform.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!0,applyTerrainMatrix:!0});w.draw(m,y.TRIANGLES,P,R,ti.alphaBlended,on.disabled,Va(a.bf.transparent,Q),null,ae,B,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),w.draw(m,y.LINE_STRIP,P,R,D,on.disabled,Va(a.bf.red),U,ae,B,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function ki(x,r,h,m){const{isRenderingGlobe:y}=m,w=x.context,P=w.gl,R=x.transform,D=x.colorModeForRenderPass(),B=x.getDepthModeFor3D(),U=x.useProgram("terrain");w.bindFramebuffer.set(null),w.viewport.set([0,0,x.width,x.height]);for(const W of h){const $=r.getTerrainMesh(W.tileID),Z=x.renderToTexture.getTexture(W),Q=r.getTerrainData(W.tileID);w.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,Z.texture);const re=r.getMeshFrameDelta(R.zoom),ae=R.calculateFogMatrix(W.tileID.toUnwrapped()),le=Nu(re,ae,x.style.sky,R.pitch,y),pe=R.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(w,P.TRIANGLES,B,In.disabled,D,on.backCCW,le,Q,pe,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}}function ga(x,r){if(!r.mesh){const h=new a.aL;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1);const m=new a.aN;m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),r.mesh=new Mo(x.createVertexBuffer(h,Ro.members),x.createIndexBuffer(m),a.aM.simpleSegment(0,0,h.length,m.length))}return r.mesh}class ks{constructor(r,h){this.context=new Xl(r),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Dn.maxUnderzooming+Dn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ia}resize(r,h,m){if(this.width=Math.floor(r*m),this.height=Math.floor(h*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const r=this.context,h=new a.aL;h.emplaceBack(0,0),h.emplaceBack(a.$,0),h.emplaceBack(0,a.$),h.emplaceBack(a.$,a.$),this.tileExtentBuffer=r.createVertexBuffer(h,Ro.members),this.tileExtentSegments=a.aM.simpleSegment(0,0,4,2);const m=new a.aL;m.emplaceBack(0,0),m.emplaceBack(a.$,0),m.emplaceBack(0,a.$),m.emplaceBack(a.$,a.$),this.debugBuffer=r.createVertexBuffer(m,Ro.members),this.debugSegments=a.aM.simpleSegment(0,0,4,5);const y=new a.c6;y.emplaceBack(0,0,0,0),y.emplaceBack(a.$,0,a.$,0),y.emplaceBack(0,a.$,0,a.$),y.emplaceBack(a.$,a.$,a.$,a.$),this.rasterBoundsBuffer=r.createVertexBuffer(y,Vp.members),this.rasterBoundsSegments=a.aM.simpleSegment(0,0,4,2);const w=new a.aL;w.emplaceBack(0,0),w.emplaceBack(a.$,0),w.emplaceBack(0,a.$),w.emplaceBack(a.$,a.$),this.rasterBoundsBufferPosOnly=r.createVertexBuffer(w,Ro.members),this.rasterBoundsSegmentsPosOnly=a.aM.simpleSegment(0,0,4,5);const P=new a.aL;P.emplaceBack(0,0),P.emplaceBack(1,0),P.emplaceBack(0,1),P.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(P,Ro.members),this.viewportSegments=a.aM.simpleSegment(0,0,4,2);const R=new a.c7;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(R);const D=new a.aN;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(D);const B=this.context.gl;this.stencilClearMode=new In({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.tileExtentMesh=new Mo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const r=this.context,h=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=a.L();a.bY(m,0,this.width,this.height,0,0,1),a.N(m,m,[h.drawingBufferWidth,h.drawingBufferHeight,0]);const y={mainMatrix:m,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:m};this.useProgram("clippingMask",null,!0).draw(r,h.TRIANGLES,hn.disabled,this.stencilClearMode,ti.disabled,on.disabled,null,null,y,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,h,m){if(this.currentStencilSource===r.source||!r.isTileClipped()||!h||!h.length)return;this.currentStencilSource=r.source,this.nextStencilID+h.length>256&&this.clearStencil();const y=this.context;y.setColorMode(ti.disabled),y.setDepthMode(hn.disabled);const w={};for(const P of h)w[P.key]=this.nextStencilID++;this._renderTileMasks(w,h,m,!0),this._renderTileMasks(w,h,m,!1),this._tileClippingMaskIDs=w}_renderTileMasks(r,h,m,y){const w=this.context,P=w.gl,R=this.style.projection,D=this.transform,B=this.useProgram("clippingMask");for(const U of h){const W=r[U.key],$=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U),Z=R.getMeshFromTileID(this.context,U.canonical,y,!0,"stencil"),Q=D.getProjectionData({overscaledTileID:U,applyGlobeMatrix:!m,applyTerrainMatrix:!0});B.draw(w,P.TRIANGLES,hn.disabled,new In({func:P.ALWAYS,mask:0},W,255,P.KEEP,P.KEEP,P.REPLACE),ti.disabled,m?on.disabled:on.backCCW,null,$,Q,"$clipping",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}_renderTilesDepthBuffer(){const r=this.context,h=r.gl,m=this.style.projection,y=this.transform,w=this.useProgram("depth"),P=this.getDepthModeFor3D(),R=Be(y,{tileSize:y.tileSize});for(const D of R){const B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),U=m.getMeshFromTileID(this.context,D.canonical,!0,!0,"raster"),W=y.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!0,applyTerrainMatrix:!0});w.draw(r,h.TRIANGLES,P,In.disabled,ti.disabled,on.backCCW,null,B,W,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,h=this.context.gl;return new In({func:h.NOTEQUAL,mask:255},r,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(r){const h=this.context.gl;return new In({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,h.KEEP,h.KEEP,h.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(r){const h=this.context.gl,m=r.sort(((P,R)=>R.overscaledZ-P.overscaledZ)),y=m[m.length-1].overscaledZ,w=m[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const P={};for(let R=0;R<w;R++)P[R+y]=new In({func:h.GEQUAL,mask:255},R+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[P,m]}return[{[y]:In.disabled},m]}stencilConfigForOverlapTwoPass(r){const h=this.context.gl,m=r.sort(((P,R)=>R.overscaledZ-P.overscaledZ)),y=m[m.length-1].overscaledZ,w=m[0].overscaledZ-y+1;if(this.clearStencil(),w>1){const P={},R={};for(let D=0;D<w;D++)P[D+y]=new In({func:h.GREATER,mask:255},w+1+D,255,h.KEEP,h.KEEP,h.REPLACE),R[D+y]=new In({func:h.GREATER,mask:255},1+D,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID=2*w+1,[P,R,m]}return this.nextStencilID=3,[{[y]:new In({func:h.GREATER,mask:255},2,255,h.KEEP,h.KEEP,h.REPLACE)},{[y]:new In({func:h.GREATER,mask:255},1,255,h.KEEP,h.KEEP,h.REPLACE)},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new ti([r.CONSTANT_COLOR,r.ONE],new a.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ti.unblended:ti.alphaBlended}getDepthModeForSublayer(r,h,m){if(!this.opaquePassEnabledForLayer())return hn.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new hn(m||this.context.gl.LEQUAL,h,[y,y])}getDepthModeFor3D(){return new hn(this.context.gl.LEQUAL,hn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,h){var m,y;this.style=r,this.options=h,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(L.now()),this.imageManager.beginFrame();const w=this.style._order,P=this.style.sourceCaches,R={},D={},B={},U={isRenderingToTexture:!1,isRenderingGlobe:((m=r.projection)===null||m===void 0?void 0:m.transitionState)>0};for(const $ in P){const Z=P[$];Z.used&&Z.prepare(this.context),R[$]=Z.getVisibleCoordinates(!1),D[$]=R[$].slice().reverse(),B[$]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<w.length;$++)if(this.style._layers[w[$]].is3D()){this.opaquePassCutoff=$;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const $ of w){const Z=this.style._layers[$];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const Q=D[Z.source];(Z.type==="custom"||Q.length)&&this.renderLayer(this,P[Z.source],Z,Q,U)}if((y=this.style.projection)===null||y===void 0||y.updateGPUdependent({context:this.context,useProgram:$=>this.useProgram($)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.bf.black:a.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function($,Z){const Q=$.context,re=Q.gl,ae=((Me,xe,Re)=>{const Ge=Math.cos(xe.rollInRadians),qe=Math.sin(xe.rollInRadians),Ye=Ce(xe),tt=xe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Me.properties.get("sky-color"),u_horizon_color:Me.properties.get("horizon-color"),u_horizon:[(xe.width/2-Ye*qe)*Re,(xe.height/2+Ye*Ge)*Re],u_horizon_normal:[-qe,Ge],u_sky_horizon_blend:Me.properties.get("sky-horizon-blend")*xe.height/2*Re,u_sky_blend:tt}})(Z,$.style.map.transform,$.pixelRatio),le=new hn(re.LEQUAL,hn.ReadWrite,[0,1]),pe=In.disabled,be=$.colorModeForRenderPass(),fe=$.useProgram("sky"),Ae=ga(Q,Z);fe.draw(Q,re.TRIANGLES,le,pe,be,on.disabled,ae,null,void 0,"sky",Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)})(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[w[this.currentLayer]],Z=P[$.source],Q=R[$.source];this._renderTileClippingMasks($,Q,!1),this.renderLayer(this,Z,$,Q,U)}this.renderPass="translucent";let W=!1;for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const $=this.style._layers[w[this.currentLayer]],Z=P[$.source];if(this.renderToTexture&&this.renderToTexture.renderLayer($,U))continue;this.opaquePassEnabledForLayer()||W||(W=!0,U.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Q=($.type==="symbol"?B:D)[$.source];this._renderTileClippingMasks($,R[$.source],!!this.renderToTexture),this.renderLayer(this,Z,$,Q,U)}if(U.isRenderingGlobe&&(function($,Z,Q){const re=$.context,ae=re.gl,le=$.useProgram("atmosphere"),pe=new hn(ae.LEQUAL,hn.ReadOnly,[0,1]),be=$.transform,fe=(function(tt,bt){const _t=tt.properties.get("position"),ht=[-_t.x,-_t.y,-_t.z],Bt=a.ag(new Float64Array(16));return tt.properties.get("anchor")==="map"&&(a.b6(Bt,Bt,bt.rollInRadians),a.b7(Bt,Bt,-bt.pitchInRadians),a.b6(Bt,Bt,bt.bearingInRadians),a.b7(Bt,Bt,bt.center.lat*Math.PI/180),a.bz(Bt,Bt,-bt.center.lng*Math.PI/180)),a.c5(ht,ht,Bt),ht})(Q,$.transform),Ae=be.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Me=Z.properties.get("atmosphere-blend")*Ae.projectionTransition;if(Me===0)return;const xe=ko(be.worldSize,be.center.lat),Re=be.inverseProjectionMatrix,Ge=new Float64Array(4);Ge[3]=1,a.aw(Ge,Ge,be.modelViewProjectionMatrix),Ge[0]/=Ge[3],Ge[1]/=Ge[3],Ge[2]/=Ge[3],Ge[3]=1,a.aw(Ge,Ge,Re),Ge[0]/=Ge[3],Ge[1]/=Ge[3],Ge[2]/=Ge[3],Ge[3]=1;const qe=((tt,bt,_t,ht,Bt)=>({u_sun_pos:tt,u_atmosphere_blend:bt,u_globe_position:_t,u_globe_radius:ht,u_inv_proj_matrix:Bt}))(fe,Me,[Ge[0],Ge[1],Ge[2]],xe,Re),Ye=ga(re,Z);le.draw(re,ae.TRIANGLES,pe,In.disabled,ti.alphaBlended,on.disabled,qe,null,null,"atmosphere",Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const $=(function(Z,Q){let re=null;const ae=Object.values(Z._layers).flatMap((fe=>fe.source&&!fe.isHidden(Q)?[Z.sourceCaches[fe.source]]:[])),le=ae.filter((fe=>fe.getSource().type==="vector")),pe=ae.filter((fe=>fe.getSource().type!=="vector")),be=fe=>{(!re||re.getSource().maxzoom<fe.getSource().maxzoom)&&(re=fe)};return le.forEach((fe=>be(fe))),re||pe.forEach((fe=>be(fe))),re})(this.style,this.transform.zoom);$&&(function(Z,Q,re){for(let ae=0;ae<re.length;ae++)Rs(Z,Q,re[ae])})(this,$,$.getVisibleCoordinates())}this.options.showPadding&&(function($){const Z=$.transform.padding;Hu($,$.transform.height-(Z.top||0),3,eu),Hu($,Z.bottom||0,3,lf),vo($,Z.left||0,3,rd),vo($,$.transform.width-(Z.right||0),3,Wu);const Q=$.transform.centerPoint;(function(re,ae,le,pe){pi(re,ae-1,le-10,2,20,pe),pi(re,ae-10,le-1,20,2,pe)})($,Q.x,$.transform.height-Q.y,sd)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=r?!a.c8(h,m):!a.c9(h,m)),y||(y=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),y&&(a.ca(h,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(w,P){const R=w.context,D=R.gl,B=w.transform,U=ti.unblended,W=new hn(D.LEQUAL,hn.ReadWrite,[0,1]),$=P.sourceCache.getRenderableTiles(),Z=w.useProgram("terrainDepth");R.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),R.clear({color:a.bf.transparent,depth:1});for(const Q of $){const re=P.getTerrainMesh(Q.tileID),ae=P.getTerrainData(Q.tileID),le=B.getProjectionData({overscaledTileID:Q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),pe={u_ele_delta:P.getMeshFrameDelta(B.zoom)};Z.draw(R,D.TRIANGLES,W,In.disabled,U,on.backCCW,pe,ae,le,"terrain",re.vertexBuffer,re.indexBuffer,re.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,w.width,w.height])})(this,this.style.map.terrain),(function(w,P){const R=w.context,D=R.gl,B=w.transform,U=ti.unblended,W=new hn(D.LEQUAL,hn.ReadWrite,[0,1]),$=P.getCoordsTexture(),Z=P.sourceCache.getRenderableTiles(),Q=w.useProgram("terrainCoords");R.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),R.clear({color:a.bf.transparent,depth:1}),P.coordsIndex=[];for(const re of Z){const ae=P.getTerrainMesh(re.tileID),le=P.getTerrainData(re.tileID);R.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,$.texture);const pe={u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(B.zoom)},be=B.getProjectionData({overscaledTileID:re.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Q.draw(R,D.TRIANGLES,W,In.disabled,U,on.backCCW,pe,le,be,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments),P.coordsIndex.push(re.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,w.width,w.height])})(this,this.style.map.terrain))}renderLayer(r,h,m,y,w){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="custom"||(y||[]).length)&&(this.id=m.id,a.cb(m)?(function(P,R,D,B,U,W){if(P.renderPass!=="translucent")return;const{isRenderingToTexture:$}=W,Z=In.disabled,Q=P.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(re,ae,le,pe,be,fe,Ae,Me,xe){const Re=ae.transform,Ge=ae.style.map.terrain,qe=be==="map",Ye=fe==="map";for(const tt of re){const bt=pe.getTile(tt),_t=bt.getBucket(le);if(!_t||!_t.text||!_t.text.segments.get().length)continue;const ht=a.an(_t.textSizeData,Re.zoom),Bt=a.aC(bt,1,ae.transform.zoom),xn=Pi(qe,ae.transform,Bt),qn=le.layout.get("icon-text-fit")!=="none"&&_t.hasIconData();if(ht){const ui=Math.pow(2,Re.zoom-bt.tileID.overscaledZ),oi=Ge?(ni,hi)=>Ge.getElevation(tt,ni,hi):null;ql(_t,qe,Ye,xe,Re,xn,ui,ht,qn,a.aD(Re,bt,Ae,Me),tt.toUnwrapped(),oi)}}})(B,P,D,R,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),U),D.paint.get("icon-opacity").constantOr(1)!==0&&Gl(P,R,D,B,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),Z,Q,$),D.paint.get("text-opacity").constantOr(1)!==0&&Gl(P,R,D,B,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),Z,Q,$),R.map.showCollisionBoxes&&(nd(P,R,D,B,!0),nd(P,R,D,B,!1))})(r,h,m,y,this.style.placement.variableOffsets,w):a.cc(m)?(function(P,R,D,B,U){if(P.renderPass!=="translucent")return;const{isRenderingToTexture:W}=U,$=D.paint.get("circle-opacity"),Z=D.paint.get("circle-stroke-width"),Q=D.paint.get("circle-stroke-opacity"),re=!D.layout.get("circle-sort-key").isConstant();if($.constantOr(1)===0&&(Z.constantOr(1)===0||Q.constantOr(1)===0))return;const ae=P.context,le=ae.gl,pe=P.transform,be=P.getDepthModeForSublayer(0,hn.ReadOnly),fe=In.disabled,Ae=P.colorModeForRenderPass(),Me=[],xe=pe.getCircleRadiusCorrection();for(let Re=0;Re<B.length;Re++){const Ge=B[Re],qe=R.getTile(Ge),Ye=qe.getBucket(D);if(!Ye)continue;const tt=D.paint.get("circle-translate"),bt=D.paint.get("circle-translate-anchor"),_t=a.aD(pe,qe,tt,bt),ht=Ye.programConfigurations.get(D.id),Bt=P.useProgram("circle",ht),xn=Ye.layoutVertexBuffer,qn=Ye.indexBuffer,ui=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Ge),oi={programConfiguration:ht,program:Bt,layoutVertexBuffer:xn,indexBuffer:qn,uniformValues:Wp(P,qe,D,_t,xe),terrainData:ui,projectionData:pe.getProjectionData({overscaledTileID:Ge,applyGlobeMatrix:!W,applyTerrainMatrix:!0})};if(re){const ni=Ye.segments.get();for(const hi of ni)Me.push({segments:new a.aM([hi]),sortKey:hi.sortKey,state:oi})}else Me.push({segments:Ye.segments,sortKey:0,state:oi})}re&&Me.sort(((Re,Ge)=>Re.sortKey-Ge.sortKey));for(const Re of Me){const{programConfiguration:Ge,program:qe,layoutVertexBuffer:Ye,indexBuffer:tt,uniformValues:bt,terrainData:_t,projectionData:ht}=Re.state;qe.draw(ae,le.TRIANGLES,be,fe,Ae,on.backCCW,bt,_t,ht,D.id,Ye,tt,Re.segments,D.paint,P.transform.zoom,Ge)}})(r,h,m,y,w):a.cd(m)?(function(P,R,D,B,U){if(D.paint.get("heatmap-opacity")===0)return;const W=P.context,{isRenderingToTexture:$,isRenderingGlobe:Z}=U;if(P.style.map.terrain){for(const Q of B){const re=R.getTile(Q);R.hasRenderableParent(Q)||(P.renderPass==="offscreen"?qa(P,re,D,Q,Z):P.renderPass==="translucent"&&Kc(P,D,Q,$,Z))}W.viewport.set([0,0,P.width,P.height])}else P.renderPass==="offscreen"?(function(Q,re,ae,le){const pe=Q.context,be=pe.gl,fe=Q.transform,Ae=In.disabled,Me=new ti([be.ONE,be.ONE],a.bf.transparent,[!0,!0,!0,!0]);(function(xe,Re,Ge){const qe=xe.gl;xe.activeTexture.set(qe.TEXTURE1),xe.viewport.set([0,0,Re.width/4,Re.height/4]);let Ye=Ge.heatmapFbos.get(a.c2);Ye?(qe.bindTexture(qe.TEXTURE_2D,Ye.colorAttachment.get()),xe.bindFramebuffer.set(Ye.framebuffer)):(Ye=_o(xe,Re.width/4,Re.height/4),Ge.heatmapFbos.set(a.c2,Ye))})(pe,Q,ae),pe.clear({color:a.bf.transparent});for(let xe=0;xe<le.length;xe++){const Re=le[xe];if(re.hasRenderableParent(Re))continue;const Ge=re.getTile(Re),qe=Ge.getBucket(ae);if(!qe)continue;const Ye=qe.programConfigurations.get(ae.id),tt=Q.useProgram("heatmap",Ye),bt=fe.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),_t=fe.getCircleRadiusCorrection();tt.draw(pe,be.TRIANGLES,hn.disabled,Ae,Me,on.backCCW,tf(Ge,fe.zoom,ae.paint.get("heatmap-intensity"),_t),null,bt,ae.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,ae.paint,fe.zoom,Ye)}pe.viewport.set([0,0,Q.width,Q.height])})(P,R,D,B):P.renderPass==="translucent"&&(function(Q,re){const ae=Q.context,le=ae.gl;ae.setColorMode(Q.colorModeForRenderPass());const pe=re.heatmapFbos.get(a.c2);pe&&(ae.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_2D,pe.colorAttachment.get()),ae.activeTexture.set(le.TEXTURE1),Yl(ae,re).bind(le.LINEAR,le.CLAMP_TO_EDGE),Q.useProgram("heatmapTexture").draw(ae,le.TRIANGLES,hn.disabled,In.disabled,Q.colorModeForRenderPass(),on.disabled,jh(Q,re,0,1),null,null,re.id,Q.viewportBuffer,Q.quadTriangleIndexBuffer,Q.viewportSegments,re.paint,Q.transform.zoom))})(P,D)})(r,h,m,y,w):a.ce(m)?(function(P,R,D,B,U){if(P.renderPass!=="translucent")return;const{isRenderingToTexture:W}=U,$=D.paint.get("line-opacity"),Z=D.paint.get("line-width");if($.constantOr(1)===0||Z.constantOr(1)===0)return;const Q=P.getDepthModeForSublayer(0,hn.ReadOnly),re=P.colorModeForRenderPass(),ae=D.paint.get("line-dasharray"),le=ae.constantOr(1),pe=D.paint.get("line-pattern"),be=pe.constantOr(1),fe=D.paint.get("line-gradient"),Ae=D.getCrossfadeParameters(),Me=be?"linePattern":le?"lineSDF":fe?"lineGradient":"line",xe=P.context,Re=xe.gl,Ge=P.transform;let qe=!0;for(const Ye of B){const tt=R.getTile(Ye);if(be&&!tt.patternsLoaded())continue;const bt=tt.getBucket(D);if(!bt)continue;const _t=bt.programConfigurations.get(D.id),ht=P.context.program.get(),Bt=P.useProgram(Me,_t),xn=qe||Bt.program!==ht,qn=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Ye),ui=pe.constantOr(null),oi=ae&&ae.constantOr(null);if(ui&&tt.imageAtlas){const Qn=tt.imageAtlas,mi=Qn.patternPositions[ui.to.toString()],En=Qn.patternPositions[ui.from.toString()];mi&&En&&_t.setConstantPatternPositions(mi,En)}else if(oi){const Qn=D.layout.get("line-cap")==="round",mi=P.lineAtlas.getDash(oi.to,Qn),En=P.lineAtlas.getDash(oi.from,Qn);_t.setConstantDashPositions(mi,En)}const ni=Ge.getProjectionData({overscaledTileID:Ye,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),hi=Ge.getPixelScale(),Di=be?Zh(P,tt,D,hi,Ae):le?ca(P,tt,D,hi,Ae):fe?Hh(P,tt,D,hi,bt.lineClipsArray.length):jc(P,tt,D,hi);if(be)xe.activeTexture.set(Re.TEXTURE0),tt.imageAtlasTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),_t.updatePaintBuffers(Ae);else if(le)(xn||P.lineAtlas.dirty)&&(xe.activeTexture.set(Re.TEXTURE0),P.lineAtlas.bind(xe)),_t.updatePaintBuffers(Ae);else if(fe){const Qn=bt.gradients[D.id];let mi=Qn.texture;if(D.gradientVersion!==Qn.version){let En=256;if(D.stepInterpolant){const rr=R.getSource().maxzoom,To=Ye.canonical.z===rr?Math.ceil(1<<P.transform.maxZoom-Ye.canonical.z):1;En=a.ah(a.c3(bt.maxLineLength/a.$*1024*To),256,xe.maxTextureSize)}Qn.gradient=a.c4({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:En,image:Qn.gradient||void 0,clips:bt.lineClipsArray}),Qn.texture?Qn.texture.update(Qn.gradient):Qn.texture=new a.T(xe,Qn.gradient,Re.RGBA),Qn.version=D.gradientVersion,mi=Qn.texture}xe.activeTexture.set(Re.TEXTURE0),mi.bind(D.stepInterpolant?Re.NEAREST:Re.LINEAR,Re.CLAMP_TO_EDGE)}const ii=P.stencilModeForClipping(Ye);Bt.draw(xe,Re.TRIANGLES,Q,ii,re,on.disabled,Di,qn,ni,D.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,D.paint,P.transform.zoom,_t,bt.layoutVertexBuffer2),qe=!1}})(r,h,m,y,w):a.cf(m)?(function(P,R,D,B,U){const W=D.paint.get("fill-color"),$=D.paint.get("fill-opacity");if($.constantOr(1)===0)return;const{isRenderingToTexture:Z}=U,Q=P.colorModeForRenderPass(),re=D.paint.get("fill-pattern"),ae=P.opaquePassEnabledForLayer()&&!re.constantOr(1)&&W.constantOr(a.bf.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(P.renderPass===ae){const le=P.getDepthModeForSublayer(1,P.renderPass==="opaque"?hn.ReadWrite:hn.ReadOnly);Ga(P,R,D,B,le,Q,!1,Z)}if(P.renderPass==="translucent"&&D.paint.get("fill-antialias")){const le=P.getDepthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,hn.ReadOnly);Ga(P,R,D,B,le,Q,!0,Z)}})(r,h,m,y,w):a.cg(m)?(function(P,R,D,B,U){const W=D.paint.get("fill-extrusion-opacity");if(W===0)return;const{isRenderingToTexture:$}=U;if(P.renderPass==="translucent"){const Z=new hn(P.context.gl.LEQUAL,hn.ReadWrite,P.depthRangeFor3D);if(W!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))Kl(P,R,D,B,Z,In.disabled,ti.disabled,$),Kl(P,R,D,B,Z,P.stencilModeFor3D(),P.colorModeForRenderPass(),$);else{const Q=P.colorModeForRenderPass();Kl(P,R,D,B,Z,In.disabled,Q,$)}}})(r,h,m,y,w):a.ch(m)?(function(P,R,D,B,U){if(P.renderPass!=="offscreen"&&P.renderPass!=="translucent")return;const{isRenderingToTexture:W}=U,$=P.context,Z=P.style.projection.useSubdivision,Q=P.getDepthModeForSublayer(0,hn.ReadOnly),re=P.colorModeForRenderPass();if(P.renderPass==="offscreen")(function(ae,le,pe,be,fe,Ae,Me){const xe=ae.context,Re=xe.gl;for(const Ge of pe){const qe=le.getTile(Ge),Ye=qe.dem;if(!Ye||!Ye.data||!qe.needsHillshadePrepare)continue;const tt=Ye.dim,bt=Ye.stride,_t=Ye.getPixels();if(xe.activeTexture.set(Re.TEXTURE1),xe.pixelStoreUnpackPremultiplyAlpha.set(!1),qe.demTexture=qe.demTexture||ae.getTileTexture(bt),qe.demTexture){const Bt=qe.demTexture;Bt.update(_t,{premultiply:!1}),Bt.bind(Re.NEAREST,Re.CLAMP_TO_EDGE)}else qe.demTexture=new a.T(xe,_t,Re.RGBA,{premultiply:!1}),qe.demTexture.bind(Re.NEAREST,Re.CLAMP_TO_EDGE);xe.activeTexture.set(Re.TEXTURE0);let ht=qe.fbo;if(!ht){const Bt=new a.T(xe,{width:tt,height:tt,data:null},Re.RGBA);Bt.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),ht=qe.fbo=xe.createFramebuffer(tt,tt,!0,!1),ht.colorAttachment.set(Bt.texture)}xe.bindFramebuffer.set(ht.framebuffer),xe.viewport.set([0,0,tt,tt]),ae.useProgram("hillshadePrepare").draw(xe,Re.TRIANGLES,fe,Ae,Me,on.disabled,Ul(qe.tileID,Ye),null,null,be.id,ae.rasterBoundsBuffer,ae.quadTriangleIndexBuffer,ae.rasterBoundsSegments),qe.needsHillshadePrepare=!1}})(P,R,B,D,Q,In.disabled,re),$.viewport.set([0,0,P.width,P.height]);else if(P.renderPass==="translucent")if(Z){const[ae,le,pe]=P.stencilConfigForOverlapTwoPass(B);Jl(P,R,D,pe,ae,Q,re,!1,W),Jl(P,R,D,pe,le,Q,re,!0,W)}else{const[ae,le]=P.getStencilConfigForOverlapAndUpdateStencilID(B);Jl(P,R,D,le,ae,Q,re,!1,W)}})(r,h,m,y,w):a.ci(m)?(function(P,R,D,B,U){if(P.renderPass!=="translucent"||!B.length)return;const{isRenderingToTexture:W}=U,$=P.style.projection.useSubdivision,Z=P.getDepthModeForSublayer(0,hn.ReadOnly),Q=P.colorModeForRenderPass();if($){const[re,ae,le]=P.stencilConfigForOverlapTwoPass(B);yo(P,R,D,le,re,Z,Q,!1,W),yo(P,R,D,le,ae,Z,Q,!0,W)}else{const[re,ae]=P.getStencilConfigForOverlapAndUpdateStencilID(B);yo(P,R,D,ae,re,Z,Q,!1,W)}})(r,h,m,y,w):a.cj(m)?(function(P,R,D,B,U){if(P.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!B.length)return;const{isRenderingToTexture:W}=U,$=R.getSource(),Z=P.style.projection.useSubdivision;if($ instanceof Nn)Ya(P,R,D,B,null,!1,!1,$.tileCoords,$.flippedWindingOrder,W);else if(Z){const[Q,re,ae]=P.stencilConfigForOverlapTwoPass(B);Ya(P,R,D,ae,Q,!1,!0,Qc,!1,W),Ya(P,R,D,ae,re,!0,!0,Qc,!1,W)}else{const[Q,re]=P.getStencilConfigForOverlapAndUpdateStencilID(B);Ya(P,R,D,re,Q,!1,!0,Qc,!1,W)}})(r,h,m,y,w):a.ck(m)?(function(P,R,D,B,U){const W=D.paint.get("background-color"),$=D.paint.get("background-opacity");if($===0)return;const{isRenderingToTexture:Z}=U,Q=P.context,re=Q.gl,ae=P.style.projection,le=P.transform,pe=le.tileSize,be=D.paint.get("background-pattern");if(P.isPatternMissing(be))return;const fe=!be&&W.a===1&&$===1&&P.opaquePassEnabledForLayer()?"opaque":"translucent";if(P.renderPass!==fe)return;const Ae=In.disabled,Me=P.getDepthModeForSublayer(0,fe==="opaque"?hn.ReadWrite:hn.ReadOnly),xe=P.colorModeForRenderPass(),Re=P.useProgram(be?"backgroundPattern":"background"),Ge=B||Be(le,{tileSize:pe,terrain:P.style.map.terrain});be&&(Q.activeTexture.set(re.TEXTURE0),P.imageManager.bind(P.context));const qe=D.getCrossfadeParameters();for(const Ye of Ge){const tt=le.getProjectionData({overscaledTileID:Ye,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),bt=be?nf($,P,be,{tileID:Ye,tileSize:pe},qe):Vl($,W),_t=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Ye),ht=ae.getMeshFromTileID(Q,Ye.canonical,!1,!0,"raster");Re.draw(Q,re.TRIANGLES,Me,Ae,xe,on.backCCW,bt,_t,tt,D.id,ht.vertexBuffer,ht.indexBuffer,ht.segments)}})(r,0,m,y,w):a.cl(m)&&(function(P,R,D,B){const{isRenderingGlobe:U}=B,W=P.context,$=D.implementation,Z=P.style.projection,Q=P.transform,re=Q.getProjectionDataForCustomLayer(U),ae={farZ:Q.farZ,nearZ:Q.nearZ,fov:Q.fov*Math.PI/180,modelViewProjectionMatrix:Q.modelViewProjectionMatrix,projectionMatrix:Q.projectionMatrix,shaderData:{variantName:Z.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Z.shaderPreludeCode.vertexSource}`,define:Z.shaderDefine},defaultProjectionData:re},le=$.renderingMode?$.renderingMode:"2d";if(P.renderPass==="offscreen"){const pe=$.prerender;pe&&(P.setCustomLayerDefaults(),W.setColorMode(P.colorModeForRenderPass()),pe.call($,W.gl,ae),W.setDirty(),P.setBaseState())}else if(P.renderPass==="translucent"){P.setCustomLayerDefaults(),W.setColorMode(P.colorModeForRenderPass()),W.setStencilMode(In.disabled);const pe=le==="3d"?P.getDepthModeFor3D():P.getDepthModeForSublayer(0,hn.ReadOnly);W.setDepthMode(pe),$.render(W.gl,ae),W.setDirty(),P.setBaseState(),W.bindFramebuffer.set(null)}})(r,0,m,w))}saveTileTexture(r){const h=this._tileTextures[r.size[0]];h?h.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const h=this._tileTextures[r];return h&&h.length>0?h.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const h=this.imageManager.getPattern(r.from.toString()),m=this.imageManager.getPattern(r.to.toString());return!h||!m}useProgram(r,h,m=!1,y=[]){this.cache=this.cache||{};const w=!!this.style.map.terrain,P=this.style.projection,R=m?Is.projectionMercator:P.shaderPreludeCode,D=m?fo:P.shaderDefine,B=r+(h?h.cacheKey:"")+`/${m?ra:P.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(w?"/terrain":"")+(y?`/${y.join("/")}`:"");return this.cache[B]||(this.cache[B]=new Uh(this.context,Is[r],h,Gh[r],this._showOverdrawInspector,w,R,D,y)),this.cache[B]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:h}=this.context.gl;return this.width!==r||this.height!==h}}function tu(x,r){let h,m=!1,y=null,w=null;const P=()=>{y=null,m&&(x.apply(w,h),y=setTimeout(P,r),m=!1)};return(...R)=>(m=!0,w=this,h=R,y||P(),y)}class Ka{constructor(r){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let m;return h.split("&").map((y=>y.split("="))).forEach((y=>{y[0]===this._hashName&&(m=y)})),(m&&m[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(!this._isValidHash(h))return!1;const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:m,pitch:+(h[4]||0)}),!0},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const m=h.join("/");let y=m;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${m}`);let w=window.location.hash.replace(y,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let P=window.location.href.replace(/(#.+)?$/,w);P=P.replace("&&","&"),window.history.replaceState(window.history.state,null,P)},this._updateHash=tu(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(r){const h=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,y),P=Math.round(h.lng*w)/w,R=Math.round(h.lat*w)/w,D=this._map.getBearing(),B=this._map.getPitch();let U="";if(U+=r?`/${P}/${R}/${m}`:`${m}/${R}/${P}`,(D||B)&&(U+="/"+Math.round(10*D)/10),B&&(U+=`/${Math.round(B)}`),this._hashName){const W=this._hashName;let $=!1;const Z=window.location.hash.slice(1).split("&").map((Q=>{const re=Q.split("=")[0];return re===W?($=!0,`${re}=${U}`):Q})).filter((Q=>Q));return $||Z.push(`${W}=${U}`),`#${Z.join("&")}`}return`#${U}`}_isValidHash(r){if(r.length<3||r.some(isNaN))return!1;try{new a.S(+r[2],+r[1])}catch{return!1}const h=+r[0],m=+(r[3]||0),y=+(r[4]||0);return h>=this._map.getMinZoom()&&h<=this._map.getMaxZoom()&&m>=-180&&m<=180&&y>=this._map.getMinPitch()&&y<=this._map.getMaxPitch()}}const Ja={linearity:.3,easing:a.cm(0,0,.3,1)},to=a.e({deceleration:2500,maxSpeed:1400},Ja),Qa=a.e({deceleration:20,maxSpeed:1400},Ja),el=a.e({deceleration:1e3,maxSpeed:360},Ja),nu=a.e({deceleration:1e3,maxSpeed:90},Ja),Zu=a.e({deceleration:1e3,maxSpeed:360},Ja);class tl{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:L.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,h=L.now();for(;r.length>0&&h-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,h.roll+=w.rollDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(h.pan.mag()){const w=Un(h.pan.mag(),m,a.e({},to,r||{})),P=h.pan.mult(w.amount/h.pan.mag()),R=this._map.cameraHelper.handlePanInertia(P,this._map.transform);y.center=R.easingCenter,y.offset=R.easingOffset,gs(y,w)}if(h.zoom){const w=Un(h.zoom,m,Qa);y.zoom=this._map.transform.zoom+w.amount,gs(y,w)}if(h.bearing){const w=Un(h.bearing,m,el);y.bearing=this._map.transform.bearing+a.ah(w.amount,-179,179),gs(y,w)}if(h.pitch){const w=Un(h.pitch,m,nu);y.pitch=this._map.transform.pitch+w.amount,gs(y,w)}if(h.roll){const w=Un(h.roll,m,Zu);y.roll=this._map.transform.roll+a.ah(w.amount,-179,179),gs(y,w)}if(y.zoom||y.bearing){const w=h.pinchAround===void 0?h.around:h.pinchAround;y.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),a.e(y,{noMoveStart:!0})}}function gs(x,r){(!x.duration||x.duration<r.duration)&&(x.duration=r.duration,x.easing=r.easing)}function Un(x,r,h){const{maxSpeed:m,linearity:y,deceleration:w}=h,P=a.ah(x*y/(r/1e3),-m,m),R=Math.abs(P)/(w*y);return{easing:h.easing,duration:1e3*R,amount:P*(R/2)}}class Ln extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,m,y={}){m=m instanceof MouseEvent?m:new MouseEvent(r,m);const w=z.mousePos(h.getCanvas(),m),P=h.unproject(w);super(r,a.e({point:w,lngLat:P,originalEvent:m},y)),this._defaultPrevented=!1,this.target=h}}class _s extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,m){const y=r==="touchend"?m.changedTouches:m.touches,w=z.touchPos(h.getCanvasContainer(),y),P=w.map((D=>h.unproject(D))),R=w.reduce(((D,B,U,W)=>D.add(B.div(W.length))),new a.P(0,0));super(r,{points:w,point:R,lngLats:P,lngLat:h.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class ir extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}}class Fr{constructor(r,h){this._map=r,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new ir(r.type,this._map,r))}mousedown(r,h){return this._mousedownPos=h,this._firePreventable(new Ln(r.type,this._map,r))}mouseup(r){this._map.fire(new Ln(r.type,this._map,r))}click(r,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Ln(r.type,this._map,r))}dblclick(r){return this._firePreventable(new Ln(r.type,this._map,r))}mouseover(r){this._map.fire(new Ln(r.type,this._map,r))}mouseout(r){this._map.fire(new Ln(r.type,this._map,r))}touchstart(r){return this._firePreventable(new _s(r.type,this._map,r))}touchmove(r){this._map.fire(new _s(r.type,this._map,r))}touchend(r){this._map.fire(new _s(r.type,this._map,r))}touchcancel(r){this._map.fire(new _s(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _a{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new Ln(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new Ln(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class no{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.screenPointToLocation(a.P.convert(r),this._map.terrain)}}class Sr{constructor(r,h){this._map=r,this._tr=new no(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,h){this.isEnabled()&&r.shiftKey&&r.button===0&&(z.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(r,h){if(!this._active)return;const m=h;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=z.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const w=Math.min(y.x,m.x),P=Math.max(y.x,m.x),R=Math.min(y.y,m.y),D=Math.max(y.y,m.y);z.setTransform(this._box,`translate(${w}px,${R}px)`),this._box.style.width=P-w+"px",this._box.style.height=D-R+"px"}mouseupWindow(r,h){if(!this._active||r.button!==0)return;const m=this._startPos,y=h;if(this.reset(),z.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:r})),{cameraAnimation:w=>w.fitScreenCoordinates(m,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,h){return this._map.fire(new a.l(r,{originalEvent:h}))}}function nl(x,r){if(x.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${r.length}`);const h={};for(let m=0;m<x.length;m++)h[x[m].identifier]=r[m];return h}class iu{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,h,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=(function(y){const w=new a.P(0,0);for(const P of y)w._add(P);return w.div(y.length)})(h),this.touches=nl(m,h)))}touchmove(r,h,m){if(this.aborted||!this.centroid)return;const y=nl(m,h);for(const w in this.touches){const P=y[w];(!P||P.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(r,h,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class ru{constructor(r){this.singleTap=new iu(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,h,m){this.singleTap.touchstart(r,h,m)}touchmove(r,h,m){this.singleTap.touchmove(r,h,m)}touchend(r,h,m){const y=this.singleTap.touchend(r,h,m);if(y){const w=r.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(y)<30;if(w&&P||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Nr{constructor(r){this._tr=new no(r),this._zoomIn=new ru({numTouches:1,numTaps:2}),this._zoomOut=new ru({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,h,m){this._zoomIn.touchstart(r,h,m),this._zoomOut.touchstart(r,h,m)}touchmove(r,h,m){this._zoomIn.touchmove(r,h,m),this._zoomOut.touchmove(r,h,m)}touchend(r,h,m){const y=this._zoomIn.touchend(r,h,m),w=this._zoomOut.touchend(r,h,m),P=this._tr;return y?(this._active=!0,r.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(y)},{originalEvent:r})}):w?(this._active=!0,r.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(w)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ar{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const h=this._moveFunction(...r);if(h.bearingDelta||h.pitchDelta||h.rollDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(r,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=Array.isArray(h)?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,h){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const y=Array.isArray(h)?h[0]:h;return!this._moved&&y.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(m,y))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&z.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const xo=0,Qr=2,ya={[xo]:1,[Qr]:2};class ec{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const h=z.mouseButton(r);this._eventButton=h}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!(function(h,m){const y=ya[m];return h.buttons===void 0||(h.buttons&y)!==y})(r,this._eventButton)}isValidEndEvent(r){return z.mouseButton(r)===this._eventButton}}class Gp{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}class va{constructor(r=new ec({checkCorrectEvent:()=>!0}),h=new Gp){this.mouseMoveStateManager=r,this.oneFingerTouchMoveStateManager=h}_executeRelevantHandler(r,h,m){return r instanceof MouseEvent?h(r):typeof TouchEvent<"u"&&r instanceof TouchEvent?m(r):void 0}startMove(r){this._executeRelevantHandler(r,(h=>this.mouseMoveStateManager.startMove(h)),(h=>this.oneFingerTouchMoveStateManager.startMove(h)))}endMove(r){this._executeRelevantHandler(r,(h=>this.mouseMoveStateManager.endMove(h)),(h=>this.oneFingerTouchMoveStateManager.endMove(h)))}isValidStartEvent(r){return this._executeRelevantHandler(r,(h=>this.mouseMoveStateManager.isValidStartEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidStartEvent(h)))}isValidMoveEvent(r){return this._executeRelevantHandler(r,(h=>this.mouseMoveStateManager.isValidMoveEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(h)))}isValidEndEvent(r){return this._executeRelevantHandler(r,(h=>this.mouseMoveStateManager.isValidEndEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidEndEvent(h)))}}const Bo=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=r=>{r.preventDefault()}};class il{constructor(r,h){this._clickTolerance=r.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(r){return r<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(r,h,m){return this._calculateTransform(r,h,m)}touchmove(r,h,m){if(this._active){if(!this._shouldBePrevented(m.length))return r.preventDefault(),this._calculateTransform(r,h,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",r)}}touchend(r,h,m){this._calculateTransform(r,h,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,h,m){m.length>0&&(this._active=!0);const y=nl(m,h),w=new a.P(0,0),P=new a.P(0,0);let R=0;for(const B in y){const U=y[B],W=this._touches[B];W&&(w._add(U),P._add(U.sub(W)),R++,y[B]=U)}if(this._touches=y,this._shouldBePrevented(R)||!P.mag())return;const D=P.div(R);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(R),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,h,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([h[0],h[1]]))}touchmove(r,h,m){if(!this._firstTwoTouches)return;r.preventDefault();const[y,w]=this._firstTwoTouches,P=Br(m,h,y),R=Br(m,h,w);if(!P||!R)return;const D=this._aroundCenter?null:P.add(R).div(2);return this._move([P,R],D,r)}touchend(r,h,m){if(!this._firstTwoTouches)return;const[y,w]=this._firstTwoTouches,P=Br(m,h,y),R=Br(m,h,w);P&&R||(this._active&&z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Br(x,r,h){for(let m=0;m<x.length;m++)if(x[m].identifier===h)return r[m]}function Ct(x,r){return Math.log(x/r)/Math.LN2}class es extends bo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,h){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Ct(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ct(this._distance,m),pinchAround:h}}}function wo(x,r){return 180*x.angleWith(r)/Math.PI}class io extends bo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,h,m){const y=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wo(this._vector,y),pinchAround:h}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const h=25/(Math.PI*this._minDiameter)*360,m=wo(r,this._startVector);return Math.abs(m)<h}}function zr(x){return Math.abs(x.y)>Math.abs(x.x)}class Ds extends bo{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,h,m){super.touchstart(r,h,m),this._currentTouchCount=m.length}_start(r){this._lastPoints=r,zr(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,h,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=r[0].sub(this._lastPoints[0]),w=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,w,m.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(r,h,m){if(this._valid!==void 0)return this._valid;const y=r.mag()>=2,w=h.mag()>=2;if(!y&&!w)return;if(!y||!w)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const P=r.y>0==h.y>0;return zr(r)&&zr(h)&&P}}const Xu={panStep:100,bearingStep:15,pitchStep:10};class Rn{constructor(r){this._tr=new no(r);const h=Xu;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let h=0,m=0,y=0,w=0,P=0;switch(r.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),w=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),w=1);break;case 38:r.shiftKey?y=1:(r.preventDefault(),P=-1);break;case 40:r.shiftKey?y=-1:(r.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:R=>{const D=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:su,zoom:h?Math.round(D.zoom)+h*(r.shiftKey?2:1):D.zoom,bearing:D.bearing+m*this._bearingStep,pitch:D.pitch+y*this._pitchStep,offset:[-w*this._panStep,-P*this._panStep],center:D.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function su(x){return x*(2-x)}const ts=4.000244140625,Ur=1/450;class vi{constructor(r,h){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=r,this._tr=new no(r),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ur}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(r){return!!this._map.cooperativeGestures.isEnabled()&&!(r.ctrlKey||this._map.cooperativeGestures.isBypassed(r))}wheel(r){if(!this.isEnabled())return;if(this._shouldBePrevented(r))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",r);let h=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=L.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,h!==0&&h%ts==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(y*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),r.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=r,this._delta-=h,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=z.mousePos(this._map.getCanvas(),r),m=this._tr;this._aroundPoint=this._aroundCenter?m.transform.locationToScreenPoint(a.S.convert(m.center)):h,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const R=r.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=R),typeof this._targetZoom=="number"&&(this._targetZoom+=R)}if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>ts?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&D!==0&&(D=1/D);const B=typeof this._targetZoom!="number"?r.scale:a.af(this._targetZoom);this._targetZoom=r.getConstrained(r.getCameraLngLat(),a.ak(B*D)).zoom,this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom!="number"?r.zoom:this._targetZoom,m=this._startZoom,y=this._easing;let w,P=!1;if(this._type==="wheel"&&m&&y){const R=L.now()-this._lastWheelEventTime,D=Math.min((R+5)/200,1),B=y(D);w=a.C.number(m,h,B),D<1?this._frameId||(this._frameId=!0):P=!0}else w=h,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=w,{noInertia:!0,needsRenderFrame:!P,zoomDelta:w-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let h=a.co;if(this._prevEase){const m=this._prevEase,y=(L.now()-m.start)/m.duration,w=m.easing(y+.01)-m.easing(y),P=.27/Math.sqrt(w*w+1e-4)*.01,R=Math.sqrt(.0729-P*P);h=a.cm(P,R,.25,1)}return this._prevEase={start:L.now(),duration:r,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Os{constructor(r,h){this._clickZoom=r,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class od{constructor(r){this._tr=new no(r),this.reset()}reset(){this._active=!1}dblclick(r,h){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qu{constructor(){this._tap=new ru({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,h,m){if(!this._swipePoint)if(this._tapTime){const y=h[0],w=r.timeStamp-this._tapTime<500,P=this._tapPoint.dist(y)<30;w&&P?m.length>0&&(this._swipePoint=y,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(r,h,m)}touchmove(r,h,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=h[0],w=y.y-this._swipePoint.y;return this._swipePoint=y,r.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(r,h,m)}touchend(r,h,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const y=this._tap.touchend(r,h,m);y&&(this._tapTime=r.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ou{constructor(r,h,m){this._el=r,this._mousePan=h,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gu{constructor(r,h,m,y){this._pitchWithRotate=r.pitchWithRotate,this._rollEnabled=r.rollEnabled,this._mouseRotate=h,this._mousePitch=m,this._mouseRoll=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Yu{constructor(r,h,m,y){this._el=r,this._touchZoom=h,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class au{constructor(r,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=z.create("div","maplibregl-cooperative-gesture-screen",r);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=h,this._container.appendChild(y);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=m,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(z.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(r){return r[this._bypassKey]}notifyGestureBlocked(r,h){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:r,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const lu=x=>x.zoom||x.drag||x.roll||x.pitch||x.rotate;class ys extends a.l{}function Xn(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta||x.rollDelta}class Yp{constructor(r,h){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,w)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=y.type==="renderFrame"?void 0:y,R={needsRenderFrame:!1},D={},B={};for(const{handlerName:$,handler:Z,allowed:Q}of this._handlers){if(!Z.isEnabled())continue;let re;if(this._blockedByActive(B,Q,$))Z.reset();else if(Z[w||y.type]){if(a.cp(y,w||y.type)){const ae=z.mousePos(this._map.getCanvas(),y);re=Z[w||y.type](y,ae)}else if(a.cq(y,w||y.type)){const ae=this._getMapTouches(y.touches),le=z.touchPos(this._map.getCanvas(),ae);re=Z[w||y.type](y,le,ae)}else a.cr(w||y.type)||(re=Z[w||y.type](y));this.mergeHandlerResult(R,D,re,$,P),re&&re.needsRenderFrame&&this._triggerRenderFrame()}(re||Z.isActive())&&(B[$]=Z)}const U={};for(const $ in this._previousActiveHandlers)B[$]||(U[$]=P);this._previousActiveHandlers=B,(Object.keys(U).length||Xn(R))&&(this._changes.push([R,D,U]),this._triggerRenderFrame()),(Object.keys(B).length||Xn(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=R;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tl(r),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,w,P]of this._listeners)z.addEventListener(y,w,y===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[r,h,m]of this._listeners)z.removeEventListener(r,h,r===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const h=this._map,m=h.getCanvasContainer();this._add("mapEvent",new Fr(h,r));const y=h.boxZoom=new Sr(h,r);this._add("boxZoom",y),r.interactive&&r.boxZoom&&y.enable();const w=h.cooperativeGestures=new au(h,r.cooperativeGestures);this._add("cooperativeGestures",w),r.cooperativeGestures&&w.enable();const P=new Nr(h),R=new od(h);h.doubleClickZoom=new Os(R,P),this._add("tapZoom",P),this._add("clickZoom",R),r.interactive&&r.doubleClickZoom&&h.doubleClickZoom.enable();const D=new qu;this._add("tapDragZoom",D);const B=h.touchPitch=new Ds(h);this._add("touchPitch",B),r.interactive&&r.touchPitch&&h.touchPitch.enable(r.touchPitch);const U=()=>h.project(h.getCenter()),W=(function({enable:fe,clickTolerance:Ae,aroundCenter:Me=!0,minPixelCenterThreshold:xe=100,rotateDegreesPerPixelMoved:Re=.8},Ge){const qe=new ec({checkCorrectEvent:Ye=>z.mouseButton(Ye)===0&&Ye.ctrlKey||z.mouseButton(Ye)===2&&!Ye.ctrlKey});return new Ar({clickTolerance:Ae,move:(Ye,tt)=>{const bt=Ge();if(Me&&Math.abs(bt.y-Ye.y)>xe)return{bearingDelta:a.cn(new a.P(Ye.x,tt.y),tt,bt)};let _t=(tt.x-Ye.x)*Re;return Me&&tt.y<bt.y&&(_t=-_t),{bearingDelta:_t}},moveStateManager:qe,enable:fe,assignEvents:Bo})})(r,U),$=(function({enable:fe,clickTolerance:Ae,pitchDegreesPerPixelMoved:Me=-.5}){const xe=new ec({checkCorrectEvent:Re=>z.mouseButton(Re)===0&&Re.ctrlKey||z.mouseButton(Re)===2});return new Ar({clickTolerance:Ae,move:(Re,Ge)=>({pitchDelta:(Ge.y-Re.y)*Me}),moveStateManager:xe,enable:fe,assignEvents:Bo})})(r),Z=(function({enable:fe,clickTolerance:Ae,rollDegreesPerPixelMoved:Me=.3},xe){const Re=new ec({checkCorrectEvent:Ge=>z.mouseButton(Ge)===2&&Ge.ctrlKey});return new Ar({clickTolerance:Ae,move:(Ge,qe)=>{const Ye=xe();let tt=(qe.x-Ge.x)*Me;return qe.y<Ye.y&&(tt=-tt),{rollDelta:tt}},moveStateManager:Re,enable:fe,assignEvents:Bo})})(r,U);h.dragRotate=new Gu(r,W,$,Z),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",$,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Z,["mousePitch"]),r.interactive&&r.dragRotate&&h.dragRotate.enable();const Q=(function({enable:fe,clickTolerance:Ae}){const Me=new ec({checkCorrectEvent:xe=>z.mouseButton(xe)===0&&!xe.ctrlKey});return new Ar({clickTolerance:Ae,move:(xe,Re)=>({around:Re,panDelta:Re.sub(xe)}),activateOnStart:!0,moveStateManager:Me,enable:fe,assignEvents:Bo})})(r),re=new il(r,h);h.dragPan=new ou(m,Q,re),this._add("mousePan",Q),this._add("touchPan",re,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&h.dragPan.enable(r.dragPan);const ae=new io,le=new es;h.touchZoomRotate=new Yu(m,le,ae,D),this._add("touchRotate",ae,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&h.touchZoomRotate.enable(r.touchZoomRotate);const pe=h.scrollZoom=new vi(h,(()=>this._triggerRenderFrame()));this._add("scrollZoom",pe,["mousePan"]),r.interactive&&r.scrollZoom&&h.scrollZoom.enable(r.scrollZoom);const be=h.keyboard=new Rn(h);this._add("keyboard",be),r.interactive&&r.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new _a(h))}_add(r,h,m){this._handlers.push({handlerName:r,handler:h,allowed:m}),this._handlersById[r]=h}stop(r){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!lu(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,h,m){for(const y in r)if(y!==m&&(!h||h.indexOf(y)<0))return!0;return!1}_getMapTouches(r){const h=[];for(const m of r)this._el.contains(m.target)&&h.push(m);return h}mergeHandlerResult(r,h,m,y,w){if(!m)return;a.e(r,m);const P={handlerName:y,originalEvent:m.originalEvent||w};m.zoomDelta!==void 0&&(h.zoom=P),m.panDelta!==void 0&&(h.drag=P),m.rollDelta!==void 0&&(h.roll=P),m.pitchDelta!==void 0&&(h.pitch=P),m.bearingDelta!==void 0&&(h.rotate=P)}_applyChanges(){const r={},h={},m={};for(const[y,w,P]of this._changes)y.panDelta&&(r.panDelta=(r.panDelta||new a.P(0,0))._add(y.panDelta)),y.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+y.pitchDelta),y.rollDelta&&(r.rollDelta=(r.rollDelta||0)+y.rollDelta),y.around!==void 0&&(r.around=y.around),y.pinchAround!==void 0&&(r.pinchAround=y.pinchAround),y.noInertia&&(r.noInertia=y.noInertia),a.e(h,w),a.e(m,P);this._updateMapTransform(r,h,m),this._changes=[]}_updateMapTransform(r,h,m){const y=this._map,w=y._getTransformForUpdate(),P=y.terrain;if(!(Xn(r)||P&&this._terrainMovement))return this._fireEvents(h,m,!0);y._stop(!0);let{panDelta:R,zoomDelta:D,bearingDelta:B,pitchDelta:U,rollDelta:W,around:$,pinchAround:Z}=r;Z!==void 0&&($=Z),$=$||y.transform.centerPoint,P&&!w.isPointOnMapSurface($)&&($=w.centerPoint);const Q={panDelta:R,zoomDelta:D,rollDelta:W,pitchDelta:U,bearingDelta:B,around:$};this._map.cameraHelper.useGlobeControls&&!w.isPointOnMapSurface($)&&($=w.centerPoint);const re=$.distSqr(w.centerPoint)<.01?w.center:w.screenPointToLocation(R?$.sub(R):$);this._handleMapControls({terrain:P,tr:w,deltasForHelper:Q,preZoomAroundLoc:re,combinedEventsInProgress:h,panDelta:R}),y._applyUpdatedTransform(w),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(h,m,!0)}_handleMapControls({terrain:r,tr:h,deltasForHelper:m,preZoomAroundLoc:y,combinedEventsInProgress:w,panDelta:P}){const R=this._map.cameraHelper;if(R.handleMapControlsRollPitchBearingZoom(m,h),r)return R.useGlobeControls?(this._terrainMovement||!w.drag&&!w.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void R.handleMapControlsPan(m,h,y)):this._terrainMovement||!w.drag&&!w.zoom?void(w.drag&&this._terrainMovement&&P?h.setCenter(h.screenPointToLocation(h.centerPoint.sub(P))):R.handleMapControlsPan(m,h,y)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void R.handleMapControlsPan(m,h,y));R.handleMapControlsPan(m,h,y)}_fireEvents(r,h,m){const y=lu(this._eventsInProgress),w=lu(r),P={};for(const W in r){const{originalEvent:$}=r[W];this._eventsInProgress[W]||(P[`${W}start`]=$),this._eventsInProgress[W]=r[W]}!y&&w&&this._fireEvent("movestart",w.originalEvent);for(const W in P)this._fireEvent(W,P[W]);w&&this._fireEvent("move",w.originalEvent);for(const W in r){const{originalEvent:$}=r[W];this._fireEvent(W,$)}const R={};let D;for(const W in this._eventsInProgress){const{handlerName:$,originalEvent:Z}=this._eventsInProgress[W];this._handlersById[$].isActive()||(delete this._eventsInProgress[W],D=h[$]||Z,R[`${W}end`]=D)}for(const W in R)this._fireEvent(W,R[W]);const B=lu(this._eventsInProgress),U=(y||w)&&!B;if(U&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const W=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&W.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(W)}if(m&&U){this._updatingCamera=!0;const W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!W||!W.essential&&L.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:D})),$(this._map.getBearing())&&this._map.resetNorth()):($(W.bearing||this._map.getBearing())&&(W.bearing=0),W.freezeElevation=!0,this._map.easeTo(W,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(r,h){this._map.fire(new a.l(r,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((r=>{delete this._frameId,this.handleEvent(new ys("renderFrame",{timeStamp:r})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xa extends a.E{constructor(r,h,m){super(),this._renderFrameCallback=()=>{const y=Math.min((L.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=m.bearingSnap,this.cameraHelper=h,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(r,h){r.apply(this.transform),this.transform=r,this.cameraHelper=h}getCenter(){return new a.S(this.transform.center.lng,this.transform.center.lat)}setCenter(r,h){return this.jumpTo({center:r},h)}getCenterElevation(){return this.transform.elevation}setCenterElevation(r,h){return this.jumpTo({elevation:r},h),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(r){this._centerClampedToGround=r}panBy(r,h,m){return r=a.P.convert(r).mult(-1),this.panTo(this.transform.center,a.e({offset:r},h),m)}panTo(r,h,m){return this.easeTo(a.e({center:r},h),m)}getZoom(){return this.transform.zoom}setZoom(r,h){return this.jumpTo({zoom:r},h),this}zoomTo(r,h,m){return this.easeTo(a.e({zoom:r},h),m)}zoomIn(r,h){return this.zoomTo(this.getZoom()+1,r,h),this}zoomOut(r,h){return this.zoomTo(this.getZoom()-1,r,h),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(r,h){return r!=this.transform.fov&&(this.transform.setFov(r),this.fire(new a.l("movestart",h)).fire(new a.l("move",h)).fire(new a.l("moveend",h))),this}getBearing(){return this.transform.bearing}setBearing(r,h){return this.jumpTo({bearing:r},h),this}getPadding(){return this.transform.padding}setPadding(r,h){return this.jumpTo({padding:r},h),this}rotateTo(r,h,m){return this.easeTo(a.e({bearing:r},h),m)}resetNorth(r,h){return this.rotateTo(0,a.e({duration:1e3},r),h),this}resetNorthPitch(r,h){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},r),h),this}snapToNorth(r,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,h):this}getPitch(){return this.transform.pitch}setPitch(r,h){return this.jumpTo({pitch:r},h),this}getRoll(){return this.transform.roll}setRoll(r,h){return this.jumpTo({roll:r},h),this}cameraForBounds(r,h){r=Hn.convert(r).adjustAntiMeridian();const m=h&&h.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),m,h)}_cameraForBoxAndBearing(r,h,m,y){const w={top:0,bottom:0,right:0,left:0};if(typeof(y=a.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const B=y.padding;y.padding={top:B,bottom:B,right:B,left:B}}const P=a.e(w,y.padding);y.padding=P;const R=this.transform,D=new Hn(r,h);return this.cameraHelper.cameraForBoxAndBearing(y,P,D,m,R)}fitBounds(r,h,m){return this._fitInternal(this.cameraForBounds(r,h),h,m)}fitScreenCoordinates(r,h,m,y,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(r)),this.transform.screenPointToLocation(a.P.convert(h)),m,y),y,w)}_fitInternal(r,h,m){return r?(delete(h=a.e(r,h)).padding,h.linear?this.easeTo(h,m):this.flyTo(h,m)):this}jumpTo(r,h){this.stop();const m=this._getTransformForUpdate();let y=!1,w=!1,P=!1;const R=m.zoom;this.cameraHelper.handleJumpToCenterZoom(m,r);const D=m.zoom!==R;return"elevation"in r&&m.elevation!==+r.elevation&&m.setElevation(+r.elevation),"bearing"in r&&m.bearing!==+r.bearing&&(y=!0,m.setBearing(+r.bearing)),"pitch"in r&&m.pitch!==+r.pitch&&(w=!0,m.setPitch(+r.pitch)),"roll"in r&&m.roll!==+r.roll&&(P=!0,m.setRoll(+r.roll)),r.padding==null||m.isPaddingEqual(r.padding)||m.setPadding(r.padding),this._applyUpdatedTransform(m),this.fire(new a.l("movestart",h)).fire(new a.l("move",h)),D&&this.fire(new a.l("zoomstart",h)).fire(new a.l("zoom",h)).fire(new a.l("zoomend",h)),y&&this.fire(new a.l("rotatestart",h)).fire(new a.l("rotate",h)).fire(new a.l("rotateend",h)),w&&this.fire(new a.l("pitchstart",h)).fire(new a.l("pitch",h)).fire(new a.l("pitchend",h)),P&&this.fire(new a.l("rollstart",h)).fire(new a.l("roll",h)).fire(new a.l("rollend",h)),this.fire(new a.l("moveend",h))}calculateCameraOptionsFromTo(r,h,m,y=0){const w=a.a1.fromLngLat(r,h),P=a.a1.fromLngLat(m,y),R=P.x-w.x,D=P.y-w.y,B=P.z-w.z,U=Math.hypot(R,D,B);if(U===0)throw new Error("Can't calculate camera options with same From and To");const W=Math.hypot(R,D),$=a.ak(this.transform.cameraToCenterDistance/U/this.transform.tileSize),Z=180*Math.atan2(R,-D)/Math.PI;let Q=180*Math.acos(W/U)/Math.PI;return Q=B<0?90-Q:90+Q,{center:P.toLngLat(),elevation:y,zoom:$,pitch:Q,bearing:Z}}calculateCameraOptionsFromCameraLngLatAltRotation(r,h,m,y,w){const P=this.transform.calculateCenterFromCameraLngLatAlt(r,h,m,y);return{center:P.center,elevation:P.elevation,zoom:P.zoom,bearing:m,pitch:y,roll:w}}easeTo(r,h){this._stop(!1,r.easeId),((r=a.e({offset:[0,0],duration:500,easing:a.co},r)).animate===!1||!r.essential&&L.prefersReducedMotion)&&(r.duration=0);const m=this._getTransformForUpdate(),y=this.getBearing(),w=m.pitch,P=m.roll,R="bearing"in r?this._normalizeBearing(r.bearing,y):y,D="pitch"in r?+r.pitch:w,B="roll"in r?this._normalizeBearing(r.roll,P):P,U="padding"in r?r.padding:m.padding,W=a.P.convert(r.offset);let $,Z;r.around&&($=a.S.convert(r.around),Z=m.locationToScreenPoint($));const Q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},re=this.cameraHelper.handleEaseTo(m,{bearing:R,pitch:D,roll:B,padding:U,around:$,aroundPoint:Z,offsetAsPoint:W,offset:r.offset,zoom:r.zoom,center:r.center});return this._rotating=this._rotating||y!==R,this._pitching=this._pitching||D!==w,this._rolling=this._rolling||B!==P,this._padding=!m.isPaddingEqual(U),this._zooming=this._zooming||re.isZooming,this._easeId=r.easeId,this._prepareEase(h,r.noMoveStart,Q),this.terrain&&this._prepareElevation(re.elevationCenter),this._ease((ae=>{re.easeFunc(ae),this.terrain&&!r.freezeElevation&&this._updateElevation(ae),this._applyUpdatedTransform(m),this._fireMoveEvents(h)}),(ae=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(h,ae)}),r),this}_prepareEase(r,h,m={}){this._moving=!0,h||m.moving||this.fire(new a.l("movestart",r)),this._zooming&&!m.zooming&&this.fire(new a.l("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new a.l("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new a.l("pitchstart",r)),this._rolling&&!m.rolling&&this.fire(new a.l("rollstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&h!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(m-(h-(m*r+this._elevationStart))/(1-r)),this._elevationTarget=h}this.transform.setElevation(a.C.number(this._elevationStart,this._elevationTarget,r))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(r){if(!this.terrain&&r.elevation>=0&&r.pitch<=90)return{};const h=r.getCameraLngLat(),m=r.getCameraAltitude(),y=this.terrain?this.terrain.getElevationForLngLatZoom(h,r.zoom):0;if(m<y){const w=this.calculateCameraOptionsFromTo(h,y,r.center,r.elevation);return{pitch:w.pitch,zoom:w.zoom}}return{}}_applyUpdatedTransform(r){const h=[];if(h.push((y=>this._elevateCameraIfInsideTerrain(y))),this.transformCameraUpdate&&h.push((y=>this.transformCameraUpdate(y))),!h.length)return;const m=r.clone();for(const y of h){const w=m.clone(),{center:P,zoom:R,roll:D,pitch:B,bearing:U,elevation:W}=y(w);P&&w.setCenter(P),W!==void 0&&w.setElevation(W),R!==void 0&&w.setZoom(R),D!==void 0&&w.setRoll(D),B!==void 0&&w.setPitch(B),U!==void 0&&w.setBearing(U),m.apply(w)}this.transform.apply(m)}_fireMoveEvents(r){this.fire(new a.l("move",r)),this._zooming&&this.fire(new a.l("zoom",r)),this._rotating&&this.fire(new a.l("rotate",r)),this._pitching&&this.fire(new a.l("pitch",r)),this._rolling&&this.fire(new a.l("roll",r))}_afterEase(r,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const m=this._zooming,y=this._rotating,w=this._pitching,P=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,m&&this.fire(new a.l("zoomend",r)),y&&this.fire(new a.l("rotateend",r)),w&&this.fire(new a.l("pitchend",r)),P&&this.fire(new a.l("rollend",r)),this.fire(new a.l("moveend",r))}flyTo(r,h){if(!r.essential&&L.prefersReducedMotion){const tt=a.Q(r,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(tt,h)}this.stop(),r=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.co},r);const m=this._getTransformForUpdate(),y=m.bearing,w=m.pitch,P=m.roll,R=m.padding,D="bearing"in r?this._normalizeBearing(r.bearing,y):y,B="pitch"in r?+r.pitch:w,U="roll"in r?this._normalizeBearing(r.roll,P):P,W="padding"in r?r.padding:m.padding,$=a.P.convert(r.offset);let Z=m.centerPoint.add($);const Q=m.screenPointToLocation(Z),re=this.cameraHelper.handleFlyTo(m,{bearing:D,pitch:B,roll:U,padding:W,locationAtOffset:Q,offsetAsPoint:$,center:r.center,minZoom:r.minZoom,zoom:r.zoom});let ae=r.curve;const le=Math.max(m.width,m.height),pe=le/re.scaleOfZoom,be=re.pixelPathLength;typeof re.scaleOfMinZoom=="number"&&(ae=Math.sqrt(le/re.scaleOfMinZoom/be*2));const fe=ae*ae;function Ae(tt){const bt=(pe*pe-le*le+(tt?-1:1)*fe*fe*be*be)/(2*(tt?pe:le)*fe*be);return Math.log(Math.sqrt(bt*bt+1)-bt)}function Me(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function xe(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Re=Ae(!1);let Ge=function(tt){return xe(Re)/xe(Re+ae*tt)},qe=function(tt){return le*((xe(Re)*(Me(bt=Re+ae*tt)/xe(bt))-Me(Re))/fe)/be;var bt},Ye=(Ae(!0)-Re)/ae;if(Math.abs(be)<2e-6||!isFinite(Ye)){if(Math.abs(le-pe)<1e-6)return this.easeTo(r,h);const tt=pe<le?-1:1;Ye=Math.abs(Math.log(pe/le))/ae,qe=()=>0,Ge=bt=>Math.exp(tt*ae*bt)}return r.duration="duration"in r?+r.duration:1e3*Ye/("screenSpeed"in r?+r.screenSpeed/ae:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=y!==D,this._pitching=B!==w,this._rolling=U!==P,this._padding=!m.isPaddingEqual(W),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(re.targetCenter),this._ease((tt=>{const bt=tt*Ye,_t=1/Ge(bt),ht=qe(bt);this._rotating&&m.setBearing(a.C.number(y,D,tt)),this._pitching&&m.setPitch(a.C.number(w,B,tt)),this._rolling&&m.setRoll(a.C.number(P,U,tt)),this._padding&&(m.interpolatePadding(R,W,tt),Z=m.centerPoint.add($)),re.easeFunc(tt,_t,ht,Z),this.terrain&&!r.freezeElevation&&this._updateElevation(tt),this._applyUpdatedTransform(m),this._fireMoveEvents(h)}),(()=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(h)}),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,h){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}return r||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(r,h,m){m.animate===!1||m.duration===0?(r(1),h()):(this._easeStart=L.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,h){r=a.aO(r,-180,180);const m=Math.abs(r-h);return Math.abs(r-360-h)<m&&(r-=360),Math.abs(r+360-h)<m&&(r+=360),r}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(a.S.convert(r),this.transform.tileZoom):null}}const rl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ku{constructor(r=rl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=z.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,h){const m=this._map._getUIString(`AttributionControl.${h}`);r.title=m,r.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map((y=>typeof y!="string"?"":y))):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const h=this._map.style.sourceCaches;for(const y in h){const w=h[y];if(w.used||w.usedForTerrain){const P=w.getSource();P.attribution&&r.indexOf(P.attribution)<0&&r.push(P.attribution)}}r=r.filter((y=>String(y).trim())),r.sort(((y,w)=>y.length-w.length)),r=r.filter(((y,w)=>{for(let P=w+1;P<r.length;P++)if(r[P].indexOf(y)>=0)return!1;return!0}));const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=z.sanitize(m),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ju{constructor(r={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const m=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=z.create("div","maplibregl-ctrl");const h=z.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class sl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const h=++this._id;return this._queue.push({callback:r,id:h,cancelled:!1}),h}remove(r){const h=this._currentlyRunning,m=h?this._queue.concat(h):this._queue;for(const y of m)if(y.id===r)return void(y.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const m of h)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var cf=a.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class vs extends a.E{constructor(r){super(),this._lastTilesetChange=L.now(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=r._source.tileSize*2**this.deltaZoom,r.usedForTerrain=!0,r.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,h){this.sourceCache.update(r,h),this._renderableTilesKeys=[];const m={};for(const y of Be(r,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))m[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.terrainRttPosMatrix32f=new Float64Array(16),a.bY(y.terrainRttPosMatrix32f,0,a.$,a.$,0,0,1),this._tiles[y.key]=new Ps(y,this.tileSize),this._lastTilesetChange=L.now());for(const y in this._tiles)m[y]||delete this._tiles[y]}freeRtt(r){for(const h in this._tiles){const m=this._tiles[h];(!r||m.tileID.equals(r)||m.tileID.isChildOf(r)||r.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((r=>this.getTileByID(r)))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r,h){return h?this._getTerrainCoordsForTileRanges(r,h):this._getTerrainCoordsForRegularTile(r)}_getTerrainCoordsForRegularTile(r){const h={};for(const m of this._renderableTilesKeys){const y=this._tiles[m].tileID,w=r.clone(),P=a.ba();if(y.canonical.equals(r.canonical))a.bY(P,0,a.$,a.$,0,0,1);else if(y.canonical.isChildOf(r.canonical)){const R=y.canonical.z-r.canonical.z,D=y.canonical.x-(y.canonical.x>>R<<R),B=y.canonical.y-(y.canonical.y>>R<<R),U=a.$>>R;a.bY(P,0,U,U,0,0,1),a.M(P,P,[-D*U,-B*U,0])}else{if(!r.canonical.isChildOf(y.canonical))continue;{const R=r.canonical.z-y.canonical.z,D=r.canonical.x-(r.canonical.x>>R<<R),B=r.canonical.y-(r.canonical.y>>R<<R),U=a.$>>R;a.bY(P,0,a.$,a.$,0,0,1),a.M(P,P,[D*U,B*U,0]),a.N(P,P,[1/2**R,1/2**R,0])}}w.terrainRttPosMatrix32f=new Float32Array(P),h[m]=w}return h}_getTerrainCoordsForTileRanges(r,h){const m={};for(const y of this._renderableTilesKeys){const w=this._tiles[y].tileID;if(!this._isWithinTileRanges(w,h))continue;const P=r.clone(),R=a.ba();if(w.canonical.z===r.canonical.z){const D=r.canonical.x-w.canonical.x,B=r.canonical.y-w.canonical.y;a.bY(R,0,a.$,a.$,0,0,1),a.M(R,R,[D*a.$,B*a.$,0])}else if(w.canonical.z>r.canonical.z){const D=w.canonical.z-r.canonical.z,B=w.canonical.x-(w.canonical.x>>D<<D),U=w.canonical.y-(w.canonical.y>>D<<D),W=r.canonical.x-(w.canonical.x>>D),$=r.canonical.y-(w.canonical.y>>D),Z=a.$>>D;a.bY(R,0,Z,Z,0,0,1),a.M(R,R,[-B*Z+W*a.$,-U*Z+$*a.$,0])}else{const D=r.canonical.z-w.canonical.z,B=r.canonical.x-(r.canonical.x>>D<<D),U=r.canonical.y-(r.canonical.y>>D<<D),W=(r.canonical.x>>D)-w.canonical.x,$=(r.canonical.y>>D)-w.canonical.y,Z=a.$<<D;a.bY(R,0,Z,Z,0,0,1),a.M(R,R,[B*a.$+W*Z,U*a.$+$*Z,0])}P.terrainRttPosMatrix32f=new Float32Array(R),m[y]=P}return m}getSourceTile(r,h){const m=this.sourceCache._source;let y=r.overscaledZ-this.deltaZoom;if(y>m.maxzoom&&(y=m.maxzoom),y<m.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(y).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!w||!w.dem)&&h)for(;y>=m.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(r.scaledTo(y--).key);return w}anyTilesAfterTime(r=Date.now()){return this._lastTilesetChange>=r}_isWithinTileRanges(r,h){return h[r.canonical.z]&&r.canonical.x>=h[r.canonical.z].minTileX&&r.canonical.x<=h[r.canonical.z].maxTileX&&r.canonical.y>=h[r.canonical.z].minTileY&&r.canonical.y<=h[r.canonical.z].maxTileY}}class ol{constructor(r,h,m){this._meshCache={},this.painter=r,this.sourceCache=new vs(h),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,h,m,y=a.$){var w;if(!(h>=0&&h<y&&m>=0&&m<y))return 0;const P=this.getTerrainData(r),R=(w=P.tile)===null||w===void 0?void 0:w.dem;if(!R)return 0;const D=a.cs([],[h/y*a.$,m/y*a.$],P.u_terrain_matrix),B=[D[0]*R.dim,D[1]*R.dim],U=Math.floor(B[0]),W=Math.floor(B[1]),$=B[0]-U,Z=B[1]-W;return R.get(U,W)*(1-$)*(1-Z)+R.get(U+1,W)*$*(1-Z)+R.get(U,W+1)*(1-$)*Z+R.get(U+1,W+1)*$*Z}getElevationForLngLatZoom(r,h){if(!a.ct(h,r.wrap()))return 0;const{tileID:m,mercatorX:y,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(r,h);return this.getElevation(m,y%a.$,w%a.$,a.$)}getElevation(r,h,m,y=a.$){return this.getDEMElevation(r,h,m,y)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const y=this.painter.context,w=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new a.T(y,w,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new a.T(y,new a.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ag([])}const h=this.sourceCache.getSourceTile(r,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const y=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new a.T(y,h.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),h.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const m=h&&h+h.tileID.key+r.key;if(m&&!this._demMatrixCache[m]){const y=this.sourceCache.sourceCache._source.maxzoom;let w=r.canonical.z-h.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=y?w=r.canonical.z-y:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=r.canonical.x-(r.canonical.x>>w<<w),R=r.canonical.y-(r.canonical.y>>w<<w),D=a.cu(new Float64Array(16),[1/(a.$<<w),1/(a.$<<w),0]);a.M(D,D,[P*a.$,R*a.$,0]),this._demMatrixCache[r.key]={matrix:D,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(r){const h=this.painter,m=h.width/devicePixelRatio,y=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new a.T(h.context,{width:m,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new a.T(h.context,{width:m,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(m,y,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,m,y))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,P=0;w<this._coordsTextureSize;w++)for(let R=0;R<this._coordsTextureSize;R++,P+=4)h[P+0]=255&R,h[P+1]=255&w,h[P+2]=R>>8<<4|w>>8,h[P+3]=0;const m=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),y=new a.T(r,m,r.gl.RGBA,{premultiply:!1});return y.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),m=this.painter.context,y=m.gl,w=Math.round(r.x*this.painter.pixelRatio/devicePixelRatio),P=Math.round(r.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(w,R-P-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null);const D=h[0]+(h[2]>>4<<8),B=h[1]+((15&h[2])<<8),U=this.coordsIndex[255-h[3]],W=U&&this.sourceCache.getTileByID(U);if(!W)return null;const $=this._coordsTextureSize,Z=(1<<W.tileID.canonical.z)*$;return new a.a1((W.tileID.canonical.x*$+D)/Z+W.tileID.wrap,(W.tileID.canonical.y*$+B)/Z,this.getElevation(W.tileID,D,B,$))}depthAtPoint(r){const h=new Uint8Array(4),m=this.painter.context,y=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(r){var h;const m=((h=this.painter.style.projection)===null||h===void 0?void 0:h.transitionState)>0,y=m&&r.canonical.y===0,w=m&&r.canonical.y===(1<<r.canonical.z)-1,P=`m_${y?"n":""}_${w?"s":""}`;if(this._meshCache[P])return this._meshCache[P];const R=this.painter.context,D=new a.cv,B=new a.aN,U=this.meshSize,W=a.$/U,$=U*U;for(let xe=0;xe<=U;xe++)for(let Re=0;Re<=U;Re++)D.emplaceBack(Re*W,xe*W,0);for(let xe=0;xe<$;xe+=U+1)for(let Re=0;Re<U;Re++)B.emplaceBack(Re+xe,U+Re+xe+1,U+Re+xe+2),B.emplaceBack(Re+xe,U+Re+xe+2,Re+xe+1);const Z=D.length,Q=Z+(U+1),re=(U+1)*U,ae=y?a.bh:0,le=y?0:1,pe=w?a.bi:a.$,be=w?0:1;for(let xe=0;xe<=U;xe++)D.emplaceBack(xe*W,ae,le);for(let xe=0;xe<=U;xe++)D.emplaceBack(xe*W,pe,be);for(let xe=0;xe<U;xe++)B.emplaceBack(re+xe,Q+xe,Q+xe+1),B.emplaceBack(re+xe,Q+xe+1,re+xe+1),B.emplaceBack(0+xe,Z+xe+1,Z+xe),B.emplaceBack(0+xe,0+xe+1,Z+xe+1);const fe=D.length,Ae=fe+2*(U+1);for(const xe of[0,1])for(let Re=0;Re<=U;Re++)for(const Ge of[0,1])D.emplaceBack(xe*a.$,Re*W,Ge);for(let xe=0;xe<2*U;xe+=2)B.emplaceBack(fe+xe,fe+xe+1,fe+xe+3),B.emplaceBack(fe+xe,fe+xe+3,fe+xe+2),B.emplaceBack(Ae+xe,Ae+xe+3,Ae+xe+1),B.emplaceBack(Ae+xe,Ae+xe+2,Ae+xe+3);const Me=new Mo(R.createVertexBuffer(D,cf.members),R.createIndexBuffer(B),a.aM.simpleSegment(0,0,D.length,B.length));return this._meshCache[P]=Me,Me}getMeshFrameDelta(r){return 2*Math.PI*a.bu/Math.pow(2,Math.max(r,0))/5}getMinTileElevationForLngLatZoom(r,h){var m;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(r,h);return(m=this.getMinMaxElevation(y).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(r){const h=this.getTerrainData(r).tile,m={minElevation:null,maxElevation:null};return h&&h.dem&&(m.minElevation=h.dem.min*this.exaggeration,m.maxElevation=h.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(r,h){const m=a.a1.fromLngLat(r.wrap()),y=(1<<h)*a.$,w=m.x*y,P=m.y*y,R=Math.floor(w/a.$),D=Math.floor(P/a.$);return{tileID:new a.Z(h,0,h,R,D),mercatorX:w,mercatorY:P}}}class jt{constructor(r,h,m){this._context=r,this._size=h,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new a.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(m.texture),{id:r,fbo:h,texture:m,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((h=>r.id!==h)),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((r=>!r.inUse))===!1}}const qt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class al{constructor(r,h){this.painter=r,this.terrain=h,this.pool=new jt(r.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter((m=>!r._layers[m].isHidden(h))),this._coordsAscending={};for(const m in r.sourceCaches){this._coordsAscending[m]={};const y=r.sourceCaches[m].getVisibleCoordinates(),w=r.sourceCaches[m].getSource(),P=w instanceof Nn?w.terrainTileRanges:null;for(const R of y){const D=this.terrain.sourceCache.getTerrainCoords(R,P);for(const B in D)this._coordsAscending[m][B]||(this._coordsAscending[m][B]=[]),this._coordsAscending[m][B].push(D[B])}}this._coordsAscendingStr={};for(const m of r._order){const y=r._layers[m],w=y.source;if(qt[y.type]&&!this._coordsAscendingStr[w]){this._coordsAscendingStr[w]={};for(const P in this._coordsAscending[w])this._coordsAscendingStr[w][P]=this._coordsAscending[w][P].map((R=>R.key)).sort().join()}}for(const m of this._renderableTiles)for(const y in this._coordsAscendingStr){const w=this._coordsAscendingStr[y][m.tileID.key];w&&w!==m.rttCoords[y]&&(m.rtt=[])}}renderLayer(r,h){if(r.isHidden(this.painter.transform.zoom))return!1;const m=Object.assign(Object.assign({},h),{isRenderingToTexture:!0}),y=r.type,w=this.painter,P=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(qt[y]&&(this._prevType&&qt[this._prevType]||this._stacks.push([]),this._prevType=y,this._stacks[this._stacks.length-1].push(r.id),!P))return!0;if(qt[this._prevType]||qt[y]&&P){this._prevType=y;const R=this._stacks.length-1,D=this._stacks[R]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(ki(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[R]){const W=this.pool.getObjectForId(B.rtt[R].id);if(W.stamp===B.rtt[R].stamp){this.pool.useObject(W);continue}}const U=this.pool.getOrCreateFreeObject();this.pool.useObject(U),this.pool.stampObject(U),B.rtt[R]={id:U.id,stamp:U.stamp},w.context.bindFramebuffer.set(U.fbo.framebuffer),w.context.clear({color:a.bf.transparent,stencil:0}),w.currentStencilSource=void 0;for(let W=0;W<D.length;W++){const $=w.style._layers[D[W]],Z=$.source?this._coordsAscending[$.source][B.tileID.key]:[B.tileID];w.context.viewport.set([0,0,U.fbo.width,U.fbo.height]),w._renderTileClippingMasks($,Z,!0),w.renderLayer(w,w.style.sourceCaches[$.source],$,Z,m),$.source&&(B.rttCoords[$.source]=this._coordsAscendingStr[$.source][B.tileID.key])}}return ki(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects(),qt[y]}return!1}}const Qu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},tc=v,zi={hash:!1,interactive:!0,bearingSnap:7,attributionControl:rl,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},xs={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class pr{constructor(r,h,m=!1){this.mousedown=w=>{this.startMove(w,z.mousePos(this.element,w)),z.addEventListener(window,"mousemove",this.mousemove),z.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.move(w,z.mousePos(this.element,w))},this.mouseup=w=>{this._rotatePitchHandler.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,w.targetTouches)[0],this.startMove(w,this._startPos),z.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=z.touchPos(this.element,w.targetTouches)[0],this.move(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=h;const y=new va;this._rotatePitchHandler=new Ar({clickTolerance:3,move:(w,P)=>{const R=h.getBoundingClientRect(),D=new a.P((R.bottom-R.top)/2,(R.right-R.left)/2);return{bearingDelta:a.cn(new a.P(w.x,P.y),P,D),pitchDelta:m?-.5*(P.y-w.y):void 0}},moveStateManager:y,enable:!0,assignEvents:()=>{}}),this.map=r,z.addEventListener(h,"mousedown",this.mousedown),z.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(h,"touchcancel",this.reset)}startMove(r,h){this._rotatePitchHandler.dragStart(r,h),z.disableDrag()}move(r,h){const m=this.map,{bearingDelta:y,pitchDelta:w}=this._rotatePitchHandler.dragMove(r,h)||{};y&&m.setBearing(m.getBearing()+y),w&&m.setPitch(m.getPitch()+w)}off(){const r=this.element;z.removeEventListener(r,"mousedown",this.mousedown),z.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend),z.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){z.enableDrag(),z.removeEventListener(window,"mousemove",this.mousemove),z.removeEventListener(window,"mouseup",this.mouseup),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend)}}let zo;function ll(x,r,h,m=!1){if(m||!h.getCoveringTilesDetailsProvider().allowWorldCopies())return x?.wrap();const y=new a.S(x.lng,x.lat);if(x=new a.S(x.lng,x.lat),r){const w=new a.S(x.lng-360,x.lat),P=new a.S(x.lng+360,x.lat),R=h.locationToScreenPoint(x).distSqr(r);h.locationToScreenPoint(w).distSqr(r)<R?x=w:h.locationToScreenPoint(P).distSqr(r)<R&&(x=P)}for(;Math.abs(x.lng-h.center.lng)>180;){const w=h.locationToScreenPoint(x);if(w.x>=0&&w.y>=0&&w.x<=h.width&&w.y<=h.height)break;x.lng>h.center.lng?x.lng-=360:x.lng+=360}return x.lng!==y.lng&&h.isPointOnMapSurface(h.locationToScreenPoint(x))?x:y}const Vn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Jn(x,r,h){const m=x.classList;for(const y in Vn)m.remove(`maplibregl-${h}-anchor-${y}`);m.add(`maplibregl-${h}-anchor-${r}`)}class nc extends a.E{constructor(r){if(super(),this._onKeyPress=h=>{const m=h.code,y=h.charCode||h.keyCode;m!=="Space"&&m!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=h=>{const m=h.originalEvent.target,y=this._element;this._popup&&(m===y||y.contains(m))&&this.togglePopup()},this._update=h=>{if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();(h?.type==="terrain"||h?.type==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=ll(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),z.setTransform(this._element,`${Vn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${y}`),L.frameAsync(new AbortController).then((()=>{this._updateOpacity(h&&h.type==="moveend")})).catch((()=>{}))},this._onMove=h=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._subpixelPositioning=r&&r.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(r?.opacity,r?.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=a.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=z.create("div");const h=z.createNS("http://www.w3.org/2000/svg","svg"),m=41,y=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${m}px`),h.setAttributeNS(null,"width",`${y}px`),h.setAttributeNS(null,"viewBox",`0 0 ${y} ${m}`);const w=z.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const P=z.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const R=z.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const le of D){const pe=z.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",le.rx),pe.setAttributeNS(null,"ry",le.ry),R.appendChild(pe)}const B=z.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const U=z.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(U);const W=z.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");const $=z.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild($);const Z=z.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const Q=z.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=z.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const ae=z.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),Q.appendChild(re),Q.appendChild(ae),P.appendChild(R),P.appendChild(B),P.appendChild(W),P.appendChild(Z),P.appendChild(Q),h.appendChild(P),h.setAttributeNS(null,"height",m*this._scale+"px"),h.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(h=>{h.preventDefault()})),this._element.addEventListener("mousedown",(h=>{h.preventDefault()})),Jn(this._element,this._anchor,"marker"),r&&r.className)for(const h of r.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(r){return this.remove(),this._map=r,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",r._getUIString("Marker.Title")),r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),r.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.S.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const y=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(r){return this._subpixelPositioning=r,this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var h,m;const y=(h=this._map)===null||h===void 0?void 0:h.terrain,w=this._map.transform.isLocationOccluded(this._lngLat);if(!y||w){const Z=w?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Z&&(this._element.style.opacity=Z))}if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const P=this._map,R=P.terrain.depthAtPoint(this._pos),D=P.terrain.getElevationForLngLatZoom(this._lngLat,P.transform.tileZoom);if(P.transform.lngLatToCameraDepth(this._lngLat,D)-R<.006)return void(this._element.style.opacity=this._opacity);const B=-this._offset.y/P.transform.pixelsPerMeter,U=Math.sin(P.getPitch()*Math.PI/180)*B,W=P.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),$=P.transform.lngLatToCameraDepth(this._lngLat,D+U)-W>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&$&&this._popup.remove(),this._element.style.opacity=$?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=a.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,h){return(this._opacity===void 0||r===void 0&&h===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let jr=0,ns=!1;const rc={maxWidth:100,unit:"metric"};function cu(x,r,h){const m=h&&h.maxWidth||100,y=x._container.clientHeight/2,w=x._container.clientWidth/2,P=x.unproject([w-m/2,y]),R=x.unproject([w+m/2,y]),D=Math.round(x.project(R).x-x.project(P).x),B=Math.min(m,D,x._container.clientWidth),U=P.distanceTo(R);if(h&&h.unit==="imperial"){const W=3.2808*U;W>5280?Ls(r,B,W/5280,x._getUIString("ScaleControl.Miles")):Ls(r,B,W,x._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Ls(r,B,U/1852,x._getUIString("ScaleControl.NauticalMiles")):U>=1e3?Ls(r,B,U/1e3,x._getUIString("ScaleControl.Kilometers")):Ls(r,B,U,x._getUIString("ScaleControl.Meters"))}function Ls(x,r,h,m){const y=(function(w){const P=Math.pow(10,`${Math.floor(w)}`.length-1);let R=w/P;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:(function(D){const B=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*B)/B})(R),P*R})(h);x.style.width=r*(y/h)+"px",x.innerHTML=`${y}&nbsp;${m}`}const eh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},cl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bs(x){if(x){if(typeof x=="number"){const r=Math.round(Math.abs(x)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,x),"top-left":new a.P(r,r),"top-right":new a.P(-r,r),bottom:new a.P(0,-x),"bottom-left":new a.P(r,-r),"bottom-right":new a.P(-r,-r),left:new a.P(x,0),right:new a.P(-x,0)}}if(x instanceof a.P||Array.isArray(x)){const r=a.P.convert(x);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:a.P.convert(x.center||[0,0]),top:a.P.convert(x.top||[0,0]),"top-left":a.P.convert(x["top-left"]||[0,0]),"top-right":a.P.convert(x["top-right"]||[0,0]),bottom:a.P.convert(x.bottom||[0,0]),"bottom-left":a.P.convert(x["bottom-left"]||[0,0]),"bottom-right":a.P.convert(x["bottom-right"]||[0,0]),left:a.P.convert(x.left||[0,0]),right:a.P.convert(x.right||[0,0])}}return bs(new a.P(0,0))}const ul=v;d.AJAXError=a.cz,d.Event=a.l,d.Evented=a.E,d.LngLat=a.S,d.MercatorCoordinate=a.a1,d.Point=a.P,d.addProtocol=a.cA,d.config=a.a,d.removeProtocol=a.cB,d.AttributionControl=Ku,d.BoxZoomHandler=Sr,d.CanvasSource=yi,d.CooperativeGesturesHandler=au,d.DoubleClickZoomHandler=Os,d.DragPanHandler=ou,d.DragRotateHandler=Gu,d.EdgeInsets=po,d.FullscreenControl=class extends a.E{constructor(x={}){super(),this._onFullscreenChange=()=>{var r;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((r=h?.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=z.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);z.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=Sn,d.GeolocateControl=class extends a.E{constructor(x){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",r)),this._finish()}},this._updateCamera=r=>{const h=new a.S(r.coords.longitude,r.coords.latitude),m=r.coords.accuracy,y=this._map.getBearing(),w=a.e({bearing:y},this.options.fitBoundsOptions),P=Hn.fromLngLat(h,m);this._map.fitBounds(P,w,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const h=new a.S(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=r.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=r=>{if(this._map){if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&ns)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(r=>r.preventDefault())),this._geolocateButton=z.create("button","maplibregl-ctrl-geolocate",this._container),z.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=r=>{if(this._map){if(r===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new nc({element:this._dotElement}),this._circleElement=z.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(h=>{const m=h?.[0]instanceof ResizeObserverEntry;h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||m||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))}))}},this.options=a.e({},ic,x)}onAdd(x){return this._map=x,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return a._(this,arguments,void 0,(function*(r=!1){if(zo!==void 0&&!r)return zo;if(window.navigator.permissions===void 0)return zo=!!window.navigator.geolocation,zo;try{zo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{zo=!!window.navigator.geolocation}return zo}))})().then((r=>this._finishSetupUI(r))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),z.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,jr=0,ns=!1}_isOutOfMapMaxBounds(x){const r=this._map.getMaxBounds(),h=x.coords;return r&&(h.longitude<r.getWest()||h.longitude>r.getEast()||h.latitude<r.getSouth()||h.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const x=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&x))return;const r=this._map.project(x),h=this._map.unproject([r.x+100,r.y]),m=x.distanceTo(h)/100,y=2*this._accuracy/m;this._circleElement.style.width=`${y.toFixed(2)}px`,this._circleElement.style.height=`${y.toFixed(2)}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":jr--,ns=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),jr++,jr>1?(x={maximumAge:6e5,timeout:0},ns=!0):(x=this.options.positionOptions,ns=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.GlobeControl=class{constructor(){this._toggleProjection=()=>{var x;const r=(x=this._map.getProjection())===null||x===void 0?void 0:x.type;this._map.setProjection(r!=="mercator"&&r?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var x;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((x=this._map.getProjection())===null||x===void 0?void 0:x.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(x){return this._map=x,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=z.create("button","maplibregl-ctrl-globe",this._container),z.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){z.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},d.Hash=Ka,d.ImageSource=Nn,d.KeyboardHandler=Rn,d.LngLatBounds=Hn,d.LogoControl=Ju,d.Map=class extends xa{constructor(x){var r,h;a.cw.mark(a.cx.create);const m=Object.assign(Object.assign(Object.assign({},zi),x),{canvasContextAttributes:Object.assign(Object.assign({},zi.canvasContextAttributes),x.canvasContextAttributes)});if(m.minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const y=new si,w=new fr;if(m.minZoom!==void 0&&y.setMinZoom(m.minZoom),m.maxZoom!==void 0&&y.setMaxZoom(m.maxZoom),m.minPitch!==void 0&&y.setMinPitch(m.minPitch),m.maxPitch!==void 0&&y.setMaxPitch(m.maxPitch),m.renderWorldCopies!==void 0&&y.setRenderWorldCopies(m.renderWorldCopies),super(y,w,{bearingSnap:m.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new sl,this._controls=[],this._mapId=a.a7(),this._contextLost=R=>{R.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:R}))},this._contextRestored=R=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:R}))},this._onMapScroll=R=>{if(R.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},m.canvasContextAttributes),this._trackResize=m.trackResize===!0,this._bearingSnap=m.bearingSnap,this._centerClampedToGround=m.centerClampedToGround,this._refreshExpiredTiles=m.refreshExpiredTiles===!0,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions===!0,this._collectResourceTiming=m.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Qu),m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=m.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Se.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ne(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let R=!1;const D=tu((B=>{this._trackResize&&!this._removed&&(this.resize(B),this.redraw())}),50);this._resizeObserver=new ResizeObserver((B=>{R?D(B):R=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Yp(this,m),this._hash=m.hash&&new Ka(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,roll:m.roll}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,a.e({},m.fitBoundsOptions,{duration:0}))));const P=typeof m.style=="string"||((h=(r=m.style)===null||r===void 0?void 0:r.projection)===null||h===void 0?void 0:h.type)!=="globe";this.resize(null,P),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Ku(typeof m.attributionControl=="boolean"?void 0:m.attributionControl)),m.maplibreLogo&&this.addControl(new Ju,m.logoPosition),this.on("style.load",(()=>{if(P||this._resizeTransform(),this.transform.unmodified){const R=a.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(R)}})),this.on("data",(R=>{this._update(R.dataType==="style"),this.fire(new a.l(`${R.dataType}data`,R))})),this.on("dataloading",(R=>{this.fire(new a.l(`${R.dataType}dataloading`,R))})),this.on("dataabort",(R=>{this.fire(new a.l("sourcedataabort",R))}))}_getMapId(){return this._mapId}setGlobalStateProperty(x,r){return this.style.setGlobalStateProperty(x,r),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(x,r){if(r===void 0&&(r=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=x.onAdd(this);this._controls.push(x);const m=this._controlPositions[r];return r.indexOf("bottom")!==-1?m.insertBefore(h,m.firstChild):m.appendChild(h),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(x);return r>-1&&this._controls.splice(r,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}coveringTiles(x){return Be(this.transform,x)}calculateCameraOptionsFromTo(x,r,h,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,r,h,m)}resize(x,r=!0){const[h,m]=this._containerDimensions(),y=this._getClampedPixelRatio(h,m);if(this._resizeCanvas(h,m,y),this.painter.resize(h,m,y),this.painter.overLimit()){const P=this.painter.context.gl;this._maxCanvasSize=[P.drawingBufferWidth,P.drawingBufferHeight];const R=this._getClampedPixelRatio(h,m);this._resizeCanvas(h,m,R),this.painter.resize(h,m,R)}this._resizeTransform(r);const w=!this._moving;return w&&(this.stop(),this.fire(new a.l("movestart",x)).fire(new a.l("move",x))),this.fire(new a.l("resize",x)),w&&this.fire(new a.l("moveend",x)),this}_resizeTransform(x=!0){var r;const[h,m]=this._containerDimensions();this.transform.resize(h,m,x),(r=this._requestedCameraState)===null||r===void 0||r.resize(h,m,x)}_getClampedPixelRatio(x,r){const{0:h,1:m}=this._maxCanvasSize,y=this.getPixelRatio(),w=x*y,P=r*y;return Math.min(w>h?h/w:1,P>m?m/P:1)*y}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(Hn.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.setMinZoom(x),this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.setMaxZoom(x),this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.setMinPitch(x),this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(x>=this.transform.minPitch)return this.transform.setMaxPitch(x),this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.setRenderWorldCopies(x),this._update()}project(x){return this.transform.locationToScreenPoint(a.S.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.screenPointToLocation(a.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,r,h){if(x==="mouseenter"||x==="mouseover"){let m=!1;return{layers:r,listener:h,delegates:{mousemove:w=>{const P=r.filter((D=>this.getLayer(D))),R=P.length!==0?this.queryRenderedFeatures(w.point,{layers:P}):[];R.length?m||(m=!0,h.call(this,new Ln(x,this,w.originalEvent,{features:R}))):m=!1},mouseout:()=>{m=!1}}}}if(x==="mouseleave"||x==="mouseout"){let m=!1;return{layers:r,listener:h,delegates:{mousemove:P=>{const R=r.filter((D=>this.getLayer(D)));(R.length!==0?this.queryRenderedFeatures(P.point,{layers:R}):[]).length?m=!0:m&&(m=!1,h.call(this,new Ln(x,this,P.originalEvent)))},mouseout:P=>{m&&(m=!1,h.call(this,new Ln(x,this,P.originalEvent)))}}}}{const m=y=>{const w=r.filter((R=>this.getLayer(R))),P=w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[];P.length&&(y.features=P,h.call(this,y),delete y.features)};return{layers:r,listener:h,delegates:{[x]:m}}}}_saveDelegatedListener(x,r){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(r)}_removeDelegatedListener(x,r,h){if(!this._delegatedListeners||!this._delegatedListeners[x])return;const m=this._delegatedListeners[x];for(let y=0;y<m.length;y++){const w=m[y];if(w.listener===h&&w.layers.length===r.length&&w.layers.every((P=>r.includes(P)))){for(const P in w.delegates)this.off(P,w.delegates[P]);return void m.splice(y,1)}}}on(x,r,h){if(h===void 0)return super.on(x,r);const m=typeof r=="string"?[r]:r,y=this._createDelegatedListener(x,m,h);this._saveDelegatedListener(x,y);for(const w in y.delegates)this.on(w,y.delegates[w]);return{unsubscribe:()=>{this._removeDelegatedListener(x,m,h)}}}once(x,r,h){if(h===void 0)return super.once(x,r);const m=typeof r=="string"?[r]:r,y=this._createDelegatedListener(x,m,h);for(const w in y.delegates){const P=y.delegates[w];y.delegates[w]=(...R)=>{this._removeDelegatedListener(x,m,h),P(...R)}}this._saveDelegatedListener(x,y);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(x,r,h){return h===void 0?super.off(x,r):(this._removeDelegatedListener(x,typeof r=="string"?[r]:r,h),this)}queryRenderedFeatures(x,r){if(!this.style)return[];let h;const m=x instanceof a.P||Array.isArray(x),y=m?x:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(m?{}:x)||{},y instanceof a.P||typeof y[0]=="number")h=[a.P.convert(y)];else{const w=a.P.convert(y[0]),P=a.P.convert(y[1]);h=[w,new a.P(P.x,w.y),P,new a.P(w.x,P.y),w]}return this.style.queryRenderedFeatures(h,r,this.transform)}querySourceFeatures(x,r){return this.style.querySourceFeatures(x,r)}setStyle(x,r){return(r=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(x,r))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const r=this._locale[x];if(r==null)throw new Error(`Missing UI string '${x}'`);return r}_updateStyle(x,r){var h,m;if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(x,r)));const y=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new Bh(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,r,y):this.style.loadJSON(x,r,y),this):((m=(h=this.style)===null||h===void 0?void 0:h.projection)===null||m===void 0||m.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Bh(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,r){if(typeof x=="string"){const h=this._requestManager.transformRequest(x,"Style");a.j(h,new AbortController).then((m=>{this._updateDiff(m.data,r)})).catch((m=>{m&&this.fire(new a.k(m))}))}else typeof x=="object"&&this._updateDiff(x,r)}_updateDiff(x,r){try{this.style.setState(x,r)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(x,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(x,r){return this._lazyInitEmptyStyle(),this.style.addSource(x,r),this._update(!0)}isSourceLoaded(x){const r=this.style&&this.style.sourceCaches[x];if(r!==void 0)return r.loaded();this.fire(new a.k(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const r=this.style.sourceCaches[x.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&r.reload();for(const h in this.style._layers){const m=this.style._layers[h];m.type==="hillshade"&&m.source===x.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),m.type==="color-relief"&&m.source===x.source&&a.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ol(this.painter,r,x),this.painter.renderToTexture=new al(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=h=>{var m;h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==x.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((m=h.source)===null||m===void 0?void 0:m.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:x})),this}getTerrain(){var x,r;return(r=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const r in x){const h=x[r]._tiles;for(const m in h){const y=h[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}setSourceTileLodParams(x,r,h){if(h){const m=this.getSource(h);if(!m)throw new Error(`There is no source with ID "${h}", cannot set LOD parameters`);m.calculateTileZoom=mt(Math.max(1,x),Math.max(1,r))}else for(const m in this.style.sourceCaches)this.style.sourceCaches[m].getSource().calculateTileZoom=mt(Math.max(1,x),Math.max(1,r));return this._update(!0),this}refreshTiles(x,r){const h=this.style.sourceCaches[x];if(!h)throw new Error(`There is no source cache with ID "${x}", cannot refresh tile`);r===void 0?h.reload(!0):h.refreshTiles(r.map((m=>new a.a4(m.z,m.x,m.y))))}addImage(x,r,h={}){const{pixelRatio:m=1,sdf:y=!1,stretchX:w,stretchY:P,content:R,textFitWidth:D,textFitHeight:B}=h;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||a.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:U,height:W,data:$}=r,Z=r;return this.style.addImage(x,{data:new a.R({width:U,height:W},new Uint8Array($)),pixelRatio:m,stretchX:w,stretchY:P,content:R,textFitWidth:D,textFitHeight:B,sdf:y,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,x),this}}{const{width:U,height:W,data:$}=L.getImageData(r);this.style.addImage(x,{data:new a.R({width:U,height:W},$),pixelRatio:m,stretchX:w,stretchY:P,content:R,textFitWidth:D,textFitHeight:B,sdf:y,version:0})}}updateImage(x,r){const h=this.style.getImage(x);if(!h)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof HTMLImageElement||a.b(r)?L.getImageData(r):r,{width:y,height:w,data:P}=m;if(y===void 0||w===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==h.data.width||w!==h.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(r instanceof HTMLImageElement||a.b(r));return h.data.replace(P,R),this.style.updateImage(x,h),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return Se.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,r){return this._lazyInitEmptyStyle(),this.style.addLayer(x,r),this._update(!0)}moveLayer(x,r){return this.style.moveLayer(x,r),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,r,h){return this.style.setLayerZoomRange(x,r,h),this._update(!0)}setFilter(x,r,h={}){return this.style.setFilter(x,r,h),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,r,h,m={}){return this.style.setPaintProperty(x,r,h,m),this._update(!0)}getPaintProperty(x,r){return this.style.getPaintProperty(x,r)}setLayoutProperty(x,r,h,m={}){return this.style.setLayoutProperty(x,r,h,m),this._update(!0)}getLayoutProperty(x,r){return this.style.getLayoutProperty(x,r)}setGlyphs(x,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,r,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,r,h,(m=>{m||this._update(!0)})),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,r,(h=>{h||this._update(!0)})),this}setLight(x,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,r),this._update(!0)}getLight(){return this.style.getLight()}setSky(x,r={}){return this._lazyInitEmptyStyle(),this.style.setSky(x,r),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(x,r){return this.style.setFeatureState(x,r),this._update()}removeFeatureState(x,r){return this.style.removeFeatureState(x,r),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,r=0;return this._container&&(x=this._container.clientWidth||400,r=this._container.clientHeight||300),[x,r]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const r=this._canvasContainer=z.create("div","maplibregl-canvas-container",x);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=z.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),m=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],m);const y=this._controlContainer=z.create("div","maplibregl-control-container",x),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((P=>{w[P]=z.create("div",`maplibregl-ctrl-${P} `,y)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,r,h){this._canvas.width=Math.floor(h*x),this._canvas.height=Math.floor(h*r),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const x=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let r=null;this._canvas.addEventListener("webglcontextcreationerror",(m=>{r={requestedAttributes:x},m&&(r.statusMessage=m.statusMessage,r.type=m.type)}),{once:!0});let h=null;if(h=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,x):this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x),!h){const m="Failed to initialize WebGL";throw r?(r.message=m,new Error(JSON.stringify(r))):new Error(m)}this.painter=new ks(h,this.transform),q.testSupport(h)}migrateProjection(x,r){super.migrateProjection(x,r),this.painter.transform=x,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){var r,h,m,y,w;const P=this._idleTriggered?this._fadeDuration:0,R=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let D=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const W=this.transform.zoom,$=L.now();this.style.zoomHistory.update(W,$);const Z=new a.F(W,{now:$,fadeDuration:P,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Q=Z.crossFadingFactor();Q===1&&Q===this._crossFadingFactor||(D=!0,this._crossFadingFactor=Q),this.style.update(Z)}const B=((h=this.style.projection)===null||h===void 0?void 0:h.transitionState)>0!==R;(m=this.style.projection)===null||m===void 0||m.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((y=this.style.projection)===null||y===void 0?void 0:y.transitionState,(w=this.style.projection)===null||w===void 0?void 0:w.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||B)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,P,this._crossSourceCollisions,B),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:P,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cw.mark(a.cx.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const U=this._sourcesDirty||this._styleDirty||this._placementDirty;return U||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,a.cw.mark(a.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Se.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r?.loseContext&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),z.remove(this._canvasContainer),z.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cw.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,L.frame(this._frameRequest,(x=>{a.cw.frame(x),this._frameRequest=null;try{this._render(x)}catch(r){if(!a.cy(r)&&!(function(h){return h.message===Yc})(r))throw r}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return tc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(x){return this._lazyInitEmptyStyle(),this.style.setProjection(x),this._update(!0)}},d.MapMouseEvent=Ln,d.MapTouchEvent=_s,d.MapWheelEvent=ir,d.Marker=nc,d.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const r=this._map.getZoom(),h=r===this._map.getMaxZoom(),m=r===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(r,h)=>{const m=this._map._getUIString(`NavigationControl.${h}`);r.title=m,r.setAttribute("aria-label",m)},this.options=a.e({},xs,x),this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(r=>r.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(r=>this._map.zoomIn({},{originalEvent:r}))),z.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(r=>this._map.zoomOut({},{originalEvent:r}))),z.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})})),this._compassIcon=z.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,r){const h=z.create("button",x,this._container);return h.type="button",h.addEventListener("click",r),h}},d.Popup=class extends a.E{constructor(x){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&z.remove(this._content),this._container&&(z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=z.create("div","maplibregl-popup",this._map.getContainer()),this._tip=z.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ll(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!r)return;const h=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationToScreenPoint(this._lngLat));let m=this.options.anchor;const y=bs(this.options.offset);if(!m){const P=this._container.offsetWidth,R=this._container.offsetHeight;let D;D=h.y+y.bottom.y<R?["top"]:h.y>this._map.transform.height-R?["bottom"]:[],h.x<P/2?D.push("left"):h.x>this._map.transform.width-P/2&&D.push("right"),m=D.length===0?"bottom":D.join("-")}let w=h.add(y[m]);this.options.subpixelPositioning||(w=w.round()),z.setTransform(this._container,`${Vn[m]} translate(${w.x}px,${w.y}px)`),Jn(this._container,m,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(eh),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=a.S.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const r=document.createDocumentFragment(),h=document.createElement("body");let m;for(h.innerHTML=x;m=h.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){return this._container&&this._container.classList.add(x),this}removeClassName(x){return this._container&&this._container.classList.remove(x),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}_createCloseButton(){this.options.closeButton&&(this._closeButton=z.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(cl);x&&x.focus()}},d.RasterDEMTileSource=Yt,d.RasterTileSource=Pt,d.ScaleControl=class{constructor(x){this._onMove=()=>{cu(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,cu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},rc),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=vi,d.Style=Bh,d.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=z.create("button","maplibregl-ctrl-terrain",this._container),z.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=Ds,d.TwoFingersTouchRotateHandler=io,d.TwoFingersTouchZoomHandler=es,d.TwoFingersTouchZoomRotateHandler=Yu,d.VectorTileSource=xt,d.VideoSource=Yn,d.addSourceType=(x,r)=>a._(void 0,void 0,void 0,(function*(){if(Es(x))throw new Error(`A source type called "${x}" already exists.`);((h,m)=>{hs[h]=m})(x,r)})),d.clearPrewarmedResources=function(){const x=ut;x&&(x.isPreloaded()&&x.numActive()===1?(x.release($e),ut=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.createTileMesh=Ol,d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return Jr().getRTLTextPluginStatus()},d.getVersion=function(){return ul},d.getWorkerCount=function(){return de.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(x){return Qt().broadcast("IS",x)},d.prewarm=function(){It().acquire($e)},d.setMaxParallelImageRequests=function(x){a.a.MAX_PARALLEL_IMAGE_REQUESTS=x},d.setRTLTextPlugin=function(x,r){return Jr().setRTLTextPlugin(x,r)},d.setWorkerCount=function(x){de.workerCount=x},d.setWorkerUrl=function(x){a.a.WORKER_URL=x}}));var c=t;return c}))})(L_)),L_.exports}var uP=xL();const hP=Rx(uP),bL=uA({__proto__:null,default:hP},[uP]),wL="modulepreload",TL=function(n){return"/"+n},I2={},q0=function(e,t,i){let o=Promise.resolve();if(t&&t.length>0){let A=function(E){return Promise.all(E.map(k=>Promise.resolve(k).then(L=>({status:"fulfilled",value:L}),L=>({status:"rejected",reason:L}))))};var d=A;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),v=a?.nonce||a?.getAttribute("nonce");o=A(t.map(E=>{if(E=TL(E),E in I2)return;I2[E]=!0;const k=E.endsWith(".css"),L=k?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${E}"]${L}`))return;const z=document.createElement("link");if(z.rel=k?"stylesheet":wL,k||(z.as="script"),z.crossOrigin="",z.href=E,v&&z.setAttribute("nonce",v),document.head.appendChild(z),k)return new Promise((q,Y)=>{z.addEventListener("load",q),z.addEventListener("error",()=>Y(new Error(`Unable to preload CSS for ${E}`)))})}))}function c(a){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=a,window.dispatchEvent(v),!v.defaultPrevented)throw a}return o.then(a=>{for(const v of a||[])v.status==="rejected"&&c(v.reason);return e().catch(c)})},SL=ye.createContext(null);function AL(n,e){const t=Array.isArray(n)?n[0]:n?n.x:0,i=Array.isArray(n)?n[1]:n?n.y:0,o=Array.isArray(e)?e[0]:e?e.x:0,c=Array.isArray(e)?e[1]:e?e.y:0;return t===o&&i===c}function Tc(n,e){if(n===e)return!0;if(!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Tc(n[t],e[t]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(const o of t)if(!e.hasOwnProperty(o)||!Tc(n[o],e[o]))return!1;return!0}return!1}function M2(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function R2(n,e){const t=e.viewState||e,i={};if("longitude"in t&&"latitude"in t&&(t.longitude!==n.center.lng||t.latitude!==n.center.lat)){const o=n.center.constructor;i.center=new o(t.longitude,t.latitude)}return"zoom"in t&&t.zoom!==n.zoom&&(i.zoom=t.zoom),"bearing"in t&&t.bearing!==n.bearing&&(i.bearing=t.bearing),"pitch"in t&&t.pitch!==n.pitch&&(i.pitch=t.pitch),t.padding&&n.padding&&!Tc(t.padding,n.padding)&&(i.padding=t.padding),i}const EL=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function k2(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const e={};for(const i of n.layers)e[i.id]=i;const t=n.layers.map(i=>{let o=null;"interactive"in i&&(o=Object.assign({},i),delete o.interactive);const c=e[i.ref];if(c){o=o||Object.assign({},i),delete o.ref;for(const d of EL)d in c&&(o[d]=c[d])}return o||i});return{...n,layers:t}}const D2={version:8,sources:{},layers:[]},O2={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},L2={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},F2={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},PL=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],CL=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class xp{constructor(e,t,i){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=o=>{const c=this.props[F2[o.type]];c?c(o):o.type==="error"&&console.error(o.error)},this._onCameraEvent=o=>{if(this._internalUpdate)return;o.viewState=this._propsedCameraUpdate||M2(this._map.transform);const c=this.props[L2[o.type]];c&&c(o)},this._onCameraUpdate=o=>this._internalUpdate?o:(this._propsedCameraUpdate=M2(o),R2(o,this.props)),this._onPointerEvent=o=>{(o.type==="mousemove"||o.type==="mouseout")&&this._updateHover(o);const c=this.props[O2[o.type]];c&&(this.props.interactiveLayerIds&&o.type!=="mouseover"&&o.type!=="mouseout"&&(o.features=this._hoveredFeatures||this._queryRenderedFeatures(o.point)),c(o),delete o.features)},this._MapClass=e,this.props=t,this._initialize(i)}get map(){return this._map}setProps(e){const t=this.props;this.props=e;const i=this._updateSettings(e,t),o=this._updateSize(e),c=this._updateViewState(e);this._updateStyle(e,t),this._updateStyleComponents(e),this._updateHandlers(e,t),(i||o||c&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const i=xp.savedMaps.pop();if(!i)return null;const o=i.map,c=o.getContainer();for(t.className=c.className;c.childNodes.length>0;)t.appendChild(c.childNodes[0]);o._container=t;const d=o._resizeObserver;d&&(d.disconnect(),d.observe(t)),i.setProps({...e,styleDiffing:!1}),o.resize();const{initialViewState:a}=e;return a&&(a.bounds?o.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):i._updateViewState(a)),o.isStyleLoaded()?o.fire("load"):o.once("style.load",()=>o.fire("load")),o._update(),i}_initialize(e){const{props:t}=this,{mapStyle:i=D2}=t,o={...t,...t.initialViewState,container:e,style:k2(i)},c=o.initialViewState||o.viewState||o;if(Object.assign(o,{center:[c.longitude||0,c.latitude||0],zoom:c.zoom||0,pitch:c.pitch||0,bearing:c.bearing||0}),t.gl){const a=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=a,t.gl)}const d=new this._MapClass(o);c.padding&&d.setPadding(c.padding),t.cursor&&(d.getCanvas().style.cursor=t.cursor),d.transformCameraUpdate=this._onCameraUpdate,d.on("style.load",()=>{this._styleComponents={light:d.getLight(),sky:d.getSky(),projection:d.getProjection?.(),terrain:d.getTerrain()},this._updateStyleComponents(this.props)}),d.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const a in O2)d.on(a,this._onPointerEvent);for(const a in L2)d.on(a,this._onCameraEvent);for(const a in F2)d.on(a,this._onEvent);this._map=d}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),xp.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:t}=e;if(t){const i=this._map;if(t.width!==i.transform.width||t.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e){const t=this._map,i=t.transform;if(!t.isMoving()){const c=R2(i,e);if(Object.keys(c).length>0)return this._internalUpdate=!0,t.jumpTo(c),this._internalUpdate=!1,!0}return!1}_updateSettings(e,t){const i=this._map;let o=!1;for(const c of PL)c in e&&!Tc(e[c],t[c])&&(o=!0,i[`set${c[0].toUpperCase()}${c.slice(1)}`]?.call(i,e[c]));return o}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:i=D2,styleDiffing:o=!0}=e,c={diff:o};"localIdeographFontFamily"in e&&(c.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(k2(i),c)}}_updateStyleComponents({light:e,projection:t,sky:i,terrain:o}){const c=this._map,d=this._styleComponents;c.style._loaded&&(e&&!Tc(e,d.light)&&(d.light=e,c.setLight(e)),t&&!Tc(t,d.projection)&&t!==d.projection?.type&&(d.projection=typeof t=="string"?{type:t}:t,c.setProjection?.(d.projection)),i&&!Tc(i,d.sky)&&(d.sky=i,c.setSky(i)),o!==void 0&&!Tc(o,d.terrain)&&(!o||c.getSource(o.source))&&(d.terrain=o,c.setTerrain(o)))}_updateHandlers(e,t){const i=this._map;for(const o of CL){const c=e[o]??!0,d=t[o]??!0;Tc(c,d)||(c?i[o].enable(c):i[o].disable())}}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:i=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:i.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const o=e.type,c=this._hoveredFeatures?.length>0,d=this._queryRenderedFeatures(e.point),a=d.length>0;!a&&c&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=d,a&&!c&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=o}else this._hoveredFeatures=null}}xp.savedMaps=[];const IL=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function ML(n){if(!n)return null;const e=n.map,t={getMap:()=>e};for(const i of RL(e))!(i in t)&&!IL.includes(i)&&(t[i]=e[i].bind(e));return t}function RL(n){const e=new Set;let t=n;for(;t;){for(const i of Object.getOwnPropertyNames(t))i[0]!=="_"&&typeof n[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);t=Object.getPrototypeOf(t)}return Array.from(e)}const kL=typeof document<"u"?ye.useLayoutEffect:ye.useEffect;function DL(n,e){const{RTLTextPlugin:t,maxParallelImageRequests:i,workerCount:o,workerUrl:c}=e;if(t&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:d,lazy:a=!0}=typeof t=="string"?{pluginUrl:t}:t;n.setRTLTextPlugin(d,v=>{v&&console.error(v)},a)}i!==void 0&&n.setMaxParallelImageRequests(i),o!==void 0&&n.setWorkerCount(o),c!==void 0&&n.setWorkerUrl(c)}const Ry=ye.createContext(null);function OL(n,e){const t=ye.useContext(SL),[i,o]=ye.useState(null),c=ye.useRef(),{current:d}=ye.useRef({mapLib:null,map:null});ye.useEffect(()=>{const A=n.mapLib;let E=!0,k;return Promise.resolve(A||q0(()=>Promise.resolve().then(()=>bL),void 0)).then(L=>{if(!E)return;if(!L)throw new Error("Invalid mapLib");const z="Map"in L?L:L.default;if(!z.Map)throw new Error("Invalid mapLib");DL(z,n),n.reuseMaps&&(k=xp.reuse(n,c.current)),k||(k=new xp(z.Map,n,c.current)),d.map=ML(k),d.mapLib=z,o(k),t?.onMapMount(d.map,n.id)}).catch(L=>{const{onError:z}=n;z?z({type:"error",target:null,originalEvent:null,error:L}):console.error(L)}),()=>{E=!1,k&&(t?.onMapUnmount(n.id),n.reuseMaps?k.recycle():k.destroy())}},[]),kL(()=>{i&&i.setProps(n)}),ye.useImperativeHandle(e,()=>d.map,[i]);const a=ye.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]),v={height:"100%"};return ye.createElement("div",{id:n.id,ref:c,style:a},i&&ye.createElement(Ry.Provider,{value:d},ye.createElement("div",{"mapboxgl-children":"",style:v},n.children)))}const LL=ye.forwardRef(OL),FL=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Iu(n,e){if(!n||!e)return;const t=n.style;for(const i in e){const o=e[i];Number.isFinite(o)&&!FL.test(i)?t[i]=`${o}px`:t[i]=o}}function dP(n,e){if(n===e)return null;const t=N2(n),i=N2(e),o=[];for(const c of i)t.has(c)||o.push(c);for(const c of t)i.has(c)||o.push(c);return o.length===0?null:o}function N2(n){return new Set(n?n.trim().split(/\s+/):[])}ye.memo(ye.forwardRef((n,e)=>{const{map:t,mapLib:i}=ye.useContext(Ry),o=ye.useRef({props:n}),c=ye.useMemo(()=>{let ue=!1;ye.Children.forEach(n.children,Se=>{Se&&(ue=!0)});const ve={...n,element:ue?document.createElement("div"):void 0},se=new i.Marker(ve);return se.setLngLat([n.longitude,n.latitude]),se.getElement().addEventListener("click",Se=>{o.current.props.onClick?.({type:"click",target:se,originalEvent:Se})}),se.on("dragstart",Se=>{const Ne=Se;Ne.lngLat=c.getLngLat(),o.current.props.onDragStart?.(Ne)}),se.on("drag",Se=>{const Ne=Se;Ne.lngLat=c.getLngLat(),o.current.props.onDrag?.(Ne)}),se.on("dragend",Se=>{const Ne=Se;Ne.lngLat=c.getLngLat(),o.current.props.onDragEnd?.(Ne)}),se},[]);ye.useEffect(()=>(c.addTo(t.getMap()),()=>{c.remove()}),[]);const{longitude:d,latitude:a,offset:v,style:A,draggable:E=!1,popup:k=null,rotation:L=0,rotationAlignment:z="auto",pitchAlignment:q="auto"}=n;ye.useEffect(()=>{Iu(c.getElement(),A)},[A]),ye.useImperativeHandle(e,()=>c,[]);const Y=o.current.props;(c.getLngLat().lng!==d||c.getLngLat().lat!==a)&&c.setLngLat([d,a]),v&&!AL(c.getOffset(),v)&&c.setOffset(v),c.isDraggable()!==E&&c.setDraggable(E),c.getRotation()!==L&&c.setRotation(L),c.getRotationAlignment()!==z&&c.setRotationAlignment(z),c.getPitchAlignment()!==q&&c.setPitchAlignment(q),c.getPopup()!==k&&c.setPopup(k);const ne=dP(Y.className,n.className);if(ne)for(const ue of ne)c.toggleClassName(ue);return o.current.props=n,Dx.createPortal(n.children,c.getElement())}));ye.memo(ye.forwardRef((n,e)=>{const{map:t,mapLib:i}=ye.useContext(Ry),o=ye.useMemo(()=>document.createElement("div"),[]),c=ye.useRef({props:n}),d=ye.useMemo(()=>{const a={...n},v=new i.Popup(a);return v.setLngLat([n.longitude,n.latitude]),v.once("open",A=>{c.current.props.onOpen?.(A)}),v},[]);if(ye.useEffect(()=>{const a=v=>{c.current.props.onClose?.(v)};return d.on("close",a),d.setDOMContent(o).addTo(t.getMap()),()=>{d.off("close",a),d.isOpen()&&d.remove()}},[]),ye.useEffect(()=>{Iu(d.getElement(),n.style)},[n.style]),ye.useImperativeHandle(e,()=>d,[]),d.isOpen()){const a=c.current.props;(d.getLngLat().lng!==n.longitude||d.getLngLat().lat!==n.latitude)&&d.setLngLat([n.longitude,n.latitude]),n.offset&&!Tc(a.offset,n.offset)&&d.setOffset(n.offset),(a.anchor!==n.anchor||a.maxWidth!==n.maxWidth)&&(d.options.anchor=n.anchor,d.setMaxWidth(n.maxWidth));const v=dP(a.className,n.className);if(v)for(const A of v)d.toggleClassName(A);c.current.props=n}return Dx.createPortal(n.children,o)}));function Xd(n,e,t,i){const o=ye.useContext(Ry),c=ye.useMemo(()=>n(o),[]);return ye.useEffect(()=>{const d=e,a=null,v=typeof e=="function"?e:null,{map:A}=o;return A.hasControl(c)||(A.addControl(c,d?.position),a&&a(o)),()=>{v&&v(o),A.hasControl(c)&&A.removeControl(c)}},[]),c}function NL(n){const e=Xd(({mapLib:t})=>new t.AttributionControl(n),{position:n.position});return ye.useEffect(()=>{Iu(e._container,n.style)},[n.style]),null}ye.memo(NL);function BL(n){const e=Xd(({mapLib:t})=>new t.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return ye.useEffect(()=>{Iu(e._controlContainer,n.style)},[n.style]),null}ye.memo(BL);function zL(n,e){const t=ye.useRef({props:n}),i=Xd(({mapLib:o})=>{const c=new o.GeolocateControl(n),d=c._setupUI;return c._setupUI=()=>{c._container.hasChildNodes()||d()},c.on("geolocate",a=>{t.current.props.onGeolocate?.(a)}),c.on("error",a=>{t.current.props.onError?.(a)}),c.on("outofmaxbounds",a=>{t.current.props.onOutOfMaxBounds?.(a)}),c.on("trackuserlocationstart",a=>{t.current.props.onTrackUserLocationStart?.(a)}),c.on("trackuserlocationend",a=>{t.current.props.onTrackUserLocationEnd?.(a)}),c},{position:n.position});return t.current.props=n,ye.useImperativeHandle(e,()=>i,[]),ye.useEffect(()=>{Iu(i._container,n.style)},[n.style]),null}ye.memo(ye.forwardRef(zL));function UL(n){const e=Xd(({mapLib:t})=>new t.NavigationControl(n),{position:n.position});return ye.useEffect(()=>{Iu(e._container,n.style)},[n.style]),null}ye.memo(UL);function jL(n){const e=Xd(({mapLib:c})=>new c.ScaleControl(n),{position:n.position}),t=ye.useRef(n),i=t.current;t.current=n;const{style:o}=n;return n.maxWidth!==void 0&&n.maxWidth!==i.maxWidth&&(e.options.maxWidth=n.maxWidth),n.unit!==void 0&&n.unit!==i.unit&&e.setUnit(n.unit),ye.useEffect(()=>{Iu(e._container,o)},[o]),null}ye.memo(jL);function VL(n){const e=Xd(({mapLib:t})=>new t.TerrainControl(n),{position:n.position});return ye.useEffect(()=>{Iu(e._container,n.style)},[n.style]),null}ye.memo(VL);function $L(n){const e=Xd(({mapLib:t})=>new t.LogoControl(n),{position:n.position});return ye.useEffect(()=>{Iu(e._container,n.style)},[n.style]),null}ye.memo($L);function J_(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const mb=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),B2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);B2&&parseFloat(B2[1]);const z2=globalThis,U2=globalThis.process||{},WL=globalThis.navigator||{};function fP(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function qd(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||fP()}function HL(n){return qd()?fP()?"Electron":(WL.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const pP="4.1.0";function ZL(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class XL{constructor(e,t,i="sessionStorage"){this.storage=ZL(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function qL(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function GL(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var Q_;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Q_||(Q_={}));const YL=10;function j2(n){return typeof n!="string"?n:(n=n.toUpperCase(),Q_[n]||Q_.WHITE)}function KL(n,e,t){return!qd&&typeof n=="string"&&(e&&(n=`\x1B[${j2(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${j2(t)+YL}m${n}\x1B[49m`)),n}function JL(n,e=["constructor"]){const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t),o=n;for(const c of i){const d=o[c];typeof d=="function"&&(e.find(a=>c===a)||(o[c]=d.bind(n)))}}function gb(n,e){if(!n)throw new Error("Assertion failed")}function Gf(){let n;if(qd()&&z2.performance)n=z2?.performance?.now?.();else if("hrtime"in U2){const e=U2?.hrtime?.();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}const Yf={debug:qd()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},QL={enabled:!0,level:0};function Kf(){}const V2={},$2={once:!0};class xg{constructor({id:e}={id:""}){this.VERSION=pP,this._startTs=Gf(),this._deltaTs=Gf(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new XL(`__probe-${this.id}__`,QL),this.timeStamp(`${this.id} started`),JL(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Gf()-this._startTs).toPrecision(10))}getDelta(){return Number((Gf()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Yf.warn,arguments,$2)}error(e){return this._getLogFunction(0,e,Yf.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Yf.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Yf.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Yf.debug||Yf.info,arguments,$2)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Kf,i&&[i],{tag:tF(t)}):Kf}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Kf)}group(e,t,i={collapsed:!1}){const o=W2({logLevel:e,message:t,opts:i}),{collapsed:c}=i;return o.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Kf)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=mP(e)}_getLogFunction(e,t,i,o,c){if(this._shouldLog(e)){c=W2({logLevel:e,message:t,args:o,opts:c}),i=i||c.method,gb(i),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=Gf();const d=c.tag||c.message;if(c.once&&d)if(!V2[d])V2[d]=Gf();else return Kf;return t=eF(this.id,c.message,c),i.bind(console,t,...c.args)}return Kf}}xg.VERSION=pP;function mP(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return gb(Number.isFinite(e)&&e>=0),e}function W2(n){const{logLevel:e,message:t}=n;n.logLevel=mP(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const o=typeof n.message;return gb(o==="string"||o==="object"),Object.assign(n,{args:i},n.opts)}function eF(n,e,t){if(typeof e=="string"){const i=t.time?GL(qL(t.total)):"";e=t.time?`${n}: ${i}  ${e}`:`${n}: ${e}`,e=KL(e,t.color,t.background)}return e}function tF(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const Uv="4.3.3",nF=Uv[0]>="0"&&Uv[0]<="9"?`v${Uv}`:"";function iF(){const n=new xg({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=nF,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const rF=iF();function sF(n,e){return gP(n||{},e)}function gP(n,e,t=0){if(t>3)return e;const i={...n};for(const[o,c]of Object.entries(e))c&&typeof c=="object"&&!Array.isArray(c)?i[o]=gP(i[o]||{},e[o],t+1):i[o]=e[o];return i}const oF="latest";function aF(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const lF=aF();function Ih(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Nd=typeof process!="object"||String(process)!=="[object process]"||process.browser,cF=typeof window<"u"&&typeof window.orientation<"u",H2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);H2&&parseFloat(H2[1]);class uF{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((i,o)=>{this._resolve=i,this._reject=o})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Ih(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ih(this.isRunning),this.isRunning=!1,this._reject(e)}}class jv{terminate(){}}const Vv=new Map;function hF(n){Ih(n.source&&!n.url||!n.source&&n.url);let e=Vv.get(n.source||n.url);return e||(n.url&&(e=dF(n.url),Vv.set(n.url,e)),n.source&&(e=_P(n.source),Vv.set(n.source,e))),Ih(e),e}function dF(n){if(!n.startsWith("http"))return n;const e=fF(n);return _P(e)}function _P(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function fF(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function yP(n,e=!0,t){const i=t||new Set;if(n){if(Z2(n))i.add(n);else if(Z2(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const o in n)yP(n[o],e,i)}}return t===void 0?Array.from(i):[]}function Z2(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const $v=()=>{};class G0{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Nd||typeof jv<"u"&&!Nd}constructor(e){const{name:t,source:i,url:o}=e;Ih(i||o),this.name=t,this.source=i,this.url=o,this.onMessage=$v,this.onError=c=>console.log(c),this.worker=Nd?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=$v,this.onError=$v,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||yP(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=hF({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new jv(i,{eval:!1})}else if(this.source)e=new jv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class pF{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return G0.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(o,c,d)=>o.done(d),i=(o,c)=>o.error(c)){const o=new Promise(c=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:c}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new uF(t.name,e);e.onMessage=o=>t.onMessage(i,o.type,o.payload),e.onError=o=>t.onError(i,o),t.onStart(i);try{await i.result}catch(o){console.error(`Worker exception: ${o}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Nd||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new G0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return cF?this.maxMobileConcurrency:this.maxConcurrency}}const mF={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class yh{props;workerPools=new Map;static _workerFarm;static isSupported(){return G0.isSupported()}static getWorkerFarm(e={}){return yh._workerFarm=yh._workerFarm||new yh({}),yh._workerFarm.setProps(e),yh._workerFarm}constructor(e){this.props={...mF},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:o}=e;let c=this.workerPools.get(t);return c||(c=new pF({name:t,source:i,url:o}),c.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,c)),c}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function gF(n,e={}){const t=e[n.id]||{},i=Nd?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let o=t.workerUrl;if(!o&&n.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(Nd?o=`modules/${n.module}/dist/${i}`:o=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!o){let c=n.version;c==="latest"&&(c=oF);const d=c?`@${c}`:"";o=`https://unpkg.com/@loaders.gl/${n.module}${d}/dist/${i}`}return Ih(o),o}function _F(n,e=lF){Ih(n,"no worker provided");const t=n.version;return!(!e||!t)}function yF(n,e){return!yh.isSupported()||!Nd&&!e?._nodeWorkers?!1:n.worker&&e?.worker}async function vF(n,e,t,i,o){const c=n.id,d=gF(n,t),v=yh.getWorkerFarm(t).getWorkerPool({name:c,url:d});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const A=await v.startJob("process-on-worker",xF.bind(null,o));return A.postMessage("process",{input:e,options:t,context:i}),await(await A.result).result}async function xF(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:o,input:c,options:d}=i;try{const a=await n(c,d);e.postMessage("done",{id:o,result:a})}catch(a){const v=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:o,error:v})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function bF(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(n),o=new Uint8Array(e);for(let c=0;c<i.length;++c)if(i[c]!==o[c])return!1;return!0}function wF(...n){return TF(n)}function TF(n){const e=n.map(c=>c instanceof ArrayBuffer?new Uint8Array(c):c),t=e.reduce((c,d)=>c+d.byteLength,0),i=new Uint8Array(t);let o=0;for(const c of e)i.set(c,o),o+=c.byteLength;return i.buffer}async function SF(n){const e=[];for await(const t of n)e.push(t);return wF(...e)}function X2(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class q2{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=X2(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(X2()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ky{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let o=this.stats[t];return o||(e instanceof q2?o=e:o=new q2(t,i),this.stats[t]=o),o}}let AF="";const G2={};function EF(n){for(const e in G2)if(n.startsWith(e)){const t=G2[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${AF}${n}`),n}function PF(n){return n&&typeof n=="object"&&n.isBuffer}function vP(n){if(PF(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function xP(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function CF(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const IF=n=>typeof n=="boolean",Xm=n=>typeof n=="function",bg=n=>n!==null&&typeof n=="object",Y2=n=>bg(n)&&n.constructor==={}.constructor,MF=n=>!!n&&typeof n[Symbol.iterator]=="function",RF=n=>n&&typeof n[Symbol.asyncIterator]=="function",Gd=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Yd=n=>typeof Blob<"u"&&n instanceof Blob,kF=n=>n&&typeof n=="object"&&n.isBuffer,DF=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||bg(n)&&Xm(n.tee)&&Xm(n.cancel)&&Xm(n.getReader),OF=n=>bg(n)&&Xm(n.read)&&Xm(n.pipe)&&IF(n.readable),bP=n=>DF(n)||OF(n);class LF extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const FF=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,NF=/^([-\w.]+\/[-\w.+]+)/;function K2(n,e){return n.toLowerCase()===e.toLowerCase()}function BF(n){const e=NF.exec(n);return e?e[1]:n}function J2(n){const e=FF.exec(n);return e?e[1]:""}const wP=/\?.*/;function zF(n){const e=n.match(wP);return e&&e[0]}function _b(n){return n.replace(wP,"")}function UF(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Dy(n){return Gd(n)?n.url:Yd(n)?n.name||"":typeof n=="string"?n:""}function yb(n){if(Gd(n)){const e=n,t=e.headers.get("content-type")||"",i=_b(e.url);return BF(t)||J2(i)}return Yd(n)?n.type||"":typeof n=="string"?J2(n):""}function jF(n){return Gd(n)?n.headers["content-length"]||-1:Yd(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function TP(n){if(Gd(n))return n;const e={},t=jF(n);t>=0&&(e["content-length"]=String(t));const i=Dy(n),o=yb(n);o&&(e["content-type"]=o);const c=await WF(n);c&&(e["x-first-bytes"]=c),typeof n=="string"&&(n=new TextEncoder().encode(n));const d=new Response(n,{headers:e});return Object.defineProperty(d,"url",{value:i}),d}async function VF(n){if(!n.ok)throw await $F(n)}async function $F(n){const e=UF(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const i={reason:n.statusText,url:n.url,response:n};try{const o=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&o?.includes("application/json")?await n.json():await n.text()}catch{}return new LF(t,i)}async function WF(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(i=>{const o=new FileReader;o.onload=c=>i(c?.target?.result),o.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${HF(t)}`}return null}function HF(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function ZF(n){return!XF(n)&&!qF(n)}function XF(n){return n.startsWith("http:")||n.startsWith("https:")}function qF(n){return n.startsWith("data:")}async function Q2(n,e){if(typeof n=="string"){const t=EF(n);return ZF(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await TP(n)}const eT=new xg({id:"loaders.gl"});class GF{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class YF{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const SP={fetch:null,mimeType:void 0,nothrow:!1,log:new YF,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:mb,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},KF={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function AP(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function EP(){const n=AP();return n.globalOptions=n.globalOptions||{...SP},n.globalOptions}function JF(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],QF(n,t),tN(e,n,i)}function QF(n,e){tT(n,null,SP,KF,e);for(const t of e){const i=n&&n[t.id]||{},o=t.options&&t.options[t.id]||{},c=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};tT(i,t.id,o,c,e)}}function tT(n,e,t,i,o){const c=e||"Top level",d=e?`${e}.`:"";for(const a in n){const v=!e&&bg(n[a]),A=a==="baseUri"&&!e,E=a==="workerUrl"&&e;if(!(a in t)&&!A&&!E){if(a in i)eT.warn(`${c} loader option '${d}${a}' no longer supported, use '${i[a]}'`)();else if(!v){const k=eN(a,o);eT.warn(`${c} loader option '${d}${a}' not recognized. ${k}`)()}}}}function eN(n,e){const t=n.toLowerCase();let i="";for(const o of e)for(const c in o.options){if(n===c)return`Did you mean '${o.id}.${c}'?`;const d=c.toLowerCase();(t.startsWith(d)||d.startsWith(t))&&(i=i||`Did you mean '${o.id}.${c}'?`)}return i}function tN(n,e,t){const o={...n.options||{}};return nN(o,t),o.log===null&&(o.log=new GF),nT(o,EP()),nT(o,e),o}function nT(n,e){for(const t in e)if(t in e){const i=e[t];Y2(i)&&Y2(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function nN(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function vb(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function xb(n){J_(n,"null loader"),J_(vb(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const PP=()=>{const n=AP();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function iN(n){const e=PP();n=Array.isArray(n)?n:[n];for(const t of n){const i=xb(t);e.find(o=>i===o)||e.unshift(i)}}function rN(){return PP()}const sN=/\.([^.]+)$/;async function oN(n,e=[],t,i){if(!CP(n))return null;let o=iT(n,e,{...t,nothrow:!0},i);if(o)return o;if(Yd(n)&&(n=await n.slice(0,10).arrayBuffer(),o=iT(n,e,t,i)),!o&&!t?.nothrow)throw new Error(IP(n));return o}function iT(n,e=[],t,i){if(!CP(n))return null;if(e&&!Array.isArray(e))return xb(e);let o=[];e&&(o=o.concat(e)),t?.ignoreRegisteredLoaders||o.push(...rN()),lN(o);const c=aN(n,o,t,i);if(!c&&!t?.nothrow)throw new Error(IP(n));return c}function aN(n,e,t,i){const o=Dy(n),c=yb(n),d=_b(o)||i?.url;let a=null,v="";return t?.mimeType&&(a=Wv(e,t?.mimeType),v=`match forced by supplied MIME type ${t?.mimeType}`),a=a||cN(e,d),v=v||(a?`matched url ${d}`:""),a=a||Wv(e,c),v=v||(a?`matched MIME type ${c}`:""),a=a||hN(e,n),v=v||(a?`matched initial data ${MP(n)}`:""),t?.fallbackMimeType&&(a=a||Wv(e,t?.fallbackMimeType),v=v||(a?`matched fallback MIME type ${c}`:"")),v&&rF.log(1,`selectLoader selected ${a?.name}: ${v}.`),a}function CP(n){return!(n instanceof Response&&n.status===204)}function IP(n){const e=Dy(n),t=yb(n);let i="No valid loader found (";i+=e?`${xP(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const o=n?MP(n):"";return i+=o?` first bytes: "${o}"`:"first bytes: not available",i+=")",i}function lN(n){for(const e of n)xb(e)}function cN(n,e){const t=e&&sN.exec(e),i=t&&t[1];return i?uN(n,i):null}function uN(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function Wv(n,e){for(const t of n)if(t.mimeTypes?.some(i=>K2(e,i))||K2(e,`application/x.${t.id}`))return t;return null}function hN(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(dN(e,t))return t}else if(ArrayBuffer.isView(e)){if(rT(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&rT(e,0,t))return t;return null}function dN(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function rT(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(o=>fN(n,e,t,o))}function fN(n,e,t,i){if(i instanceof ArrayBuffer)return bF(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const o=Y0(n,e,i.length);return i===o;default:return!1}}function MP(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Y0(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Y0(n,0,e):""}function Y0(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let o="";for(let c=0;c<t;c++)o+=String.fromCharCode(i.getUint8(e+c));return o}const pN=256*1024;function*mN(n,e){const t=e?.chunkSize||pN;let i=0;const o=new TextEncoder;for(;i<n.length;){const c=Math.min(n.length-i,t),d=n.slice(i,i+c);i+=c,yield o.encode(d)}}const gN=256*1024;function*_N(n,e={}){const{chunkSize:t=gN}=e;let i=0;for(;i<n.byteLength;){const o=Math.min(n.byteLength-i,t),c=new ArrayBuffer(o),d=new Uint8Array(n,i,o);new Uint8Array(c).set(d),i+=o,yield c}}const yN=1024*1024;async function*vN(n,e){const t=e?.chunkSize||yN;let i=0;for(;i<n.size;){const o=i+t,c=await n.slice(i,o).arrayBuffer();i=o,yield c}}function sT(n,e){return mb?xN(n,e):bN(n)}async function*xN(n,e){const t=n.getReader();let i;try{for(;;){const o=i||t.read();e?._streamReadAhead&&(i=t.read());const{done:c,value:d}=await o;if(c)return;yield vP(d)}}catch{t.releaseLock()}}async function*bN(n,e){for await(const t of n)yield vP(t)}function wN(n,e){if(typeof n=="string")return mN(n,e);if(n instanceof ArrayBuffer)return _N(n,e);if(Yd(n))return vN(n,e);if(bP(n))return sT(n,e);if(Gd(n))return sT(n.body,e);throw new Error("makeIterator")}const RP="Cannot convert supplied data type";function TN(n,e,t){if(e.text&&typeof n=="string")return n;if(kF(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const o=n.byteLength||n.length;return(n.byteOffset!==0||o!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+o)),i}throw new Error(RP)}async function SN(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return TN(n,e);if(Yd(n)&&(n=await TP(n)),Gd(n)){const o=n;return await VF(o),e.binary?await o.arrayBuffer():await o.text()}if(bP(n)&&(n=wN(n,t)),MF(n)||RF(n))return SF(n);throw new Error(RP)}function kP(n,e){const t=EP(),i=n||t;return typeof i.fetch=="function"?i.fetch:bg(i.fetch)?o=>Q2(o,i.fetch):e?.fetch?e?.fetch:Q2}function AN(n,e,t){if(t)return t;const i={fetch:kP(e,n),...n};if(i.url){const o=_b(i.url);i.baseUrl=o,i.queryString=zF(i.url),i.filename=xP(o),i.baseUrl=CF(o)}return Array.isArray(i.loaders)||(i.loaders=null),i}function EN(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function ey(n,e,t,i){e&&!Array.isArray(e)&&!vb(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};const o=Dy(n),d=EN(e,i),a=await oN(n,d,t);return a?(t=JF(t,a,d,o),i=AN({url:o,_parse:ey,loaders:d},t,i||null),await PN(a,n,t,i)):null}async function PN(n,e,t,i){if(_F(n),t=sF(n.options,t),Gd(e)){const c=e,{ok:d,redirected:a,status:v,statusText:A,type:E,url:k}=c,L=Object.fromEntries(c.headers.entries());i.response={headers:L,ok:d,redirected:a,status:v,statusText:A,type:E,url:k}}e=await SN(e,n,t);const o=n;if(o.parseTextSync&&typeof e=="string")return o.parseTextSync(e,t,i);if(yF(n,t))return await vF(n,e,t,i,ey);if(o.parseText&&typeof e=="string")return await o.parseText(e,t,i);if(o.parse)return await o.parse(e,t,i);throw Ih(!o.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function ty(n,e,t,i){let o,c;!Array.isArray(e)&&!vb(e)?(o=[],c=e):(o=e,c=t);const d=kP(c);let a=n;return typeof n=="string"&&(a=await d(n)),Yd(n)&&(a=await d(n)),Array.isArray(o)?await ey(a,o,c):await ey(a,o,c)}const CN="4.3.3",IN=globalThis.loaders?.parseImageNode,K0=typeof Image<"u",J0=typeof ImageBitmap<"u",MN=!!IN,Q0=mb?!0:MN;function RN(n){switch(n){case"auto":return J0||K0||Q0;case"imagebitmap":return J0;case"image":return K0;case"data":return Q0;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function kN(){if(J0)return"imagebitmap";if(K0)return"image";if(Q0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function DN(n){const e=LN(n);if(!e)throw new Error("Not an image");return e}function ON(n){switch(DN(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function LN(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const FN=/^data:image\/svg\+xml/,NN=/\.svg((\?|#).*)?$/;function bb(n){return n&&(FN.test(n)||NN.test(n))}function BN(n,e){if(bb(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(c){throw new Error(c.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return DP(n,e)}function DP(n,e){if(bb(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function OP(n,e,t){const i=BN(n,t),o=self.URL||self.webkitURL,c=typeof i!="string"&&o.createObjectURL(i);try{return await zN(c||i,e)}finally{c&&o.revokeObjectURL(c)}}async function zN(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,o)=>{try{t.onload=()=>i(t),t.onerror=c=>{const d=c instanceof Error?c.message:"error";o(new Error(d))}}catch(c){o(c)}})}const UN={};let oT=!0;async function jN(n,e,t){let i;bb(t)?i=await OP(n,e,t):i=DP(n,t);const o=e&&e.imagebitmap;return await VN(i,o)}async function VN(n,e=null){if(($N(e)||!oT)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),oT=!1}return await createImageBitmap(n)}function $N(n){for(const e in n||UN)return!1;return!0}function WN(n){return!qN(n,"ftyp",4)||(n[8]&96)===0?null:HN(n)}function HN(n){switch(ZN(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function ZN(n,e,t){return String.fromCharCode(...n.slice(e,t))}function XN(n){return[...n].map(e=>e.charCodeAt(0))}function qN(n,e,t=0){const i=XN(e);for(let o=0;o<i.length;++o)if(i[o]!==n[o+t])return!1;return!0}const Sc=!1,qm=!0;function LP(n){const e=wg(n);return YN(e)||QN(e)||KN(e)||JN(e)||GN(e)}function GN(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=WN(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function YN(n){const e=wg(n);return e.byteLength>=24&&e.getUint32(0,Sc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Sc),height:e.getUint32(20,Sc)}:null}function KN(n){const e=wg(n);return e.byteLength>=10&&e.getUint32(0,Sc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,qm),height:e.getUint16(8,qm)}:null}function JN(n){const e=wg(n);return e.byteLength>=14&&e.getUint16(0,Sc)===16973&&e.getUint32(2,qm)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,qm),height:e.getUint32(22,qm)}:null}function QN(n){const e=wg(n);if(!(e.byteLength>=3&&e.getUint16(0,Sc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:o}=eB();let c=2;for(;c+9<e.byteLength;){const d=e.getUint16(c,Sc);if(o.has(d))return{mimeType:"image/jpeg",height:e.getUint16(c+5,Sc),width:e.getUint16(c+7,Sc)};if(!i.has(d))return null;c+=2,c+=e.getUint16(c,Sc)}return null}function eB(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function wg(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function tB(n,e){const{mimeType:t}=LP(n)||{},i=globalThis.loaders?.parseImageNode;return J_(i),await i(n,t)}async function nB(n,e,t){e=e||{};const o=(e.image||{}).type||"auto",{url:c}=t||{},d=iB(o);let a;switch(d){case"imagebitmap":a=await jN(n,e,c);break;case"image":a=await OP(n,e,c);break;case"data":a=await tB(n);break;default:J_(!1)}return o==="data"&&(a=ON(a)),a}function iB(n){switch(n){case"auto":case"data":return kN();default:return RN(n),n}}const rB=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],sB=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],oB={image:{type:"auto",decode:!0}},aB={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:CN,mimeTypes:sB,extensions:rB,parse:nB,tests:[n=>!!LP(new DataView(n))],options:oB},xi=new xg({id:"deck"});let ex={};function lB(n){ex=n}function Ws(n,e,t,i){xi.level>0&&ex[n]&&ex[n].call(null,e,t,i)}function cB(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const uB={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:cB,parseTextSync:JSON.parse};function hB(){const n="9.1.15",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(xi.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:xi,_registerLoggers:lB},iN([uB,[aB,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const dB=hB();function wb(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const Hv={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function fB(n){const e={};for(const[t,i]of Object.entries(n))e[t]=pB(i);return e}function pB(n){let e=aT(n);if(e!=="object")return{value:n,...Hv[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...Hv[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=aT(n.value),{...n,...Hv[e],type:e}):{type:"object",value:null};throw new Error("props")}function aT(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const mB=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,gB=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,_B={vertex:mB,fragment:gB},lT=/void\s+main\s*\([^)]*\)\s*\{\n?/,cT=/}\n?[^{}]*$/,Zv=[],F_="__LUMA_INJECT_DECLARATIONS__";function yB(n){const e={vertex:{},fragment:{}};for(const t in n){let i=n[t];const o=vB(t);typeof i=="string"&&(i={order:0,injection:i}),e[o][t]=i}return e}function vB(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function ny(n,e,t,i=!1){const o=e==="vertex";for(const c in t){const d=t[c];d.sort((v,A)=>v.order-A.order),Zv.length=d.length;for(let v=0,A=d.length;v<A;++v)Zv[v]=d[v].injection;const a=`${Zv.join(`
`)}
`;switch(c){case"vs:#decl":o&&(n=n.replace(F_,a));break;case"vs:#main-start":o&&(n=n.replace(lT,v=>v+a));break;case"vs:#main-end":o&&(n=n.replace(cT,v=>a+v));break;case"fs:#decl":o||(n=n.replace(F_,a));break;case"fs:#main-start":o||(n=n.replace(lT,v=>v+a));break;case"fs:#main-end":o||(n=n.replace(cT,v=>a+v));break;default:n=n.replace(c,v=>v+a)}}return n=n.replace(F_,""),i&&(n=n.replace(/\}\s*$/,c=>c+_B[e])),n}function iy(n){n.map(e=>xB(e))}function xB(n){if(n.instance)return;iy(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:i={}}=n,o={normalizedInjections:yB(i),parsedDeprecations:bB(t)};e&&(o.propValidators=fB(e)),n.instance=o;let c={};e&&(c=Object.entries(e).reduce((d,[a,v])=>{const A=v?.value;return A&&(d[a]=A),d},{})),n.defaultUniforms={...n.defaultUniforms,...c}}function FP(n,e,t){n.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function bB(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function Tb(n){iy(n);const e={},t={};NP({modules:n,level:0,moduleMap:e,moduleDepth:t});const i=Object.keys(t).sort((o,c)=>t[c]-t[o]).map(o=>e[o]);return iy(i),i}function NP(n){const{modules:e,level:t,moduleMap:i,moduleDepth:o}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const c of e)i[c.name]=c,(o[c.name]===void 0||o[c.name]<t)&&(o[c.name]=t);for(const c of e)c.dependencies&&NP({modules:c.dependencies,level:t+1,moduleMap:i,moduleDepth:o})}function wB(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function TB(n,e){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=uT(n,SB),n;case"fragment":return n=uT(n,AB),n;default:throw new Error(e)}}const BP=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],SB=[...BP,[tx("attribute"),"in $1"],[tx("varying"),"out $1"]],AB=[...BP,[tx("varying"),"in $1"]];function uT(n,e){for(const[t,i]of e)n=n.replace(t,i);return n}function tx(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function zP(n,e){let t="";for(const i in n){const o=n[i];if(t+=`void ${o.signature} {
`,o.header&&(t+=`  ${o.header}`),e[i]){const c=e[i];c.sort((d,a)=>d.order-a.order);for(const d of c)t+=`  ${d.injection}
`}o.footer&&(t+=`  ${o.footer}`),t+=`}
`}return t}function UP(n){const e={vertex:{},fragment:{}};for(const t of n){let i,o;typeof t!="string"?(i=t,o=i.hook):(i={},o=t),o=o.trim();const[c,d]=o.split(":"),a=o.replace(/\(.+/,""),v=Object.assign(i,{signature:d});switch(c){case"vs":e.vertex[a]=v;break;case"fs":e.fragment[a]=v;break;default:throw new Error(c)}}return e}function EB(n,e){return{name:PB(n,e),language:"glsl",version:CB(n)}}function PB(n,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:e}function CB(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const jP=`

${F_}
`,IB=`precision highp float;
`;function MB(n){const e=Tb(n.modules||[]);return{source:kB(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:VP(e)}}function RB(n){const{vs:e,fs:t}=n,i=Tb(n.modules||[]);return{vs:hT(n.platformInfo,{...n,source:e,stage:"vertex",modules:i}),fs:hT(n.platformInfo,{...n,source:t,stage:"fragment",modules:i}),getUniforms:VP(i)}}function kB(n,e){const{source:t,stage:i,modules:o,hookFunctions:c=[],inject:d={},log:a}=e;wb(typeof t=="string","shader source must be a string");const v=t;let A="";const E=UP(c),k={},L={},z={};for(const Y in d){const ne=typeof d[Y]=="string"?{injection:d[Y],order:0}:d[Y],ue=/^(v|f)s:(#)?([\w-]+)$/.exec(Y);if(ue){const ve=ue[2],se=ue[3];ve?se==="decl"?L[Y]=[ne]:z[Y]=[ne]:k[Y]=[ne]}else z[Y]=[ne]}const q=o;for(const Y of q){a&&FP(Y,v,a);const ne=$P(Y,"wgsl");A+=ne;const ue=Y.injections?.[i]||{};for(const ve in ue){const se=/^(v|f)s:#([\w-]+)$/.exec(ve);if(se){const Ne=se[2]==="decl"?L:z;Ne[ve]=Ne[ve]||[],Ne[ve].push(ue[ve])}else k[ve]=k[ve]||[],k[ve].push(ue[ve])}}return A+=jP,A=ny(A,i,L),A+=zP(E[i],k),A+=v,A=ny(A,i,z),A}function hT(n,e){const{id:t,source:i,stage:o,language:c="glsl",modules:d,defines:a={},hookFunctions:v=[],inject:A={},prologue:E=!0,log:k}=e;wb(typeof i=="string","shader source must be a string");const L=c==="glsl"?EB(i).version:-1,z=n.shaderLanguageVersion,q=L===100?"#version 100":"#version 300 es",ne=i.split(`
`).slice(1).join(`
`),ue={};d.forEach(dt=>{Object.assign(ue,dt.defines)}),Object.assign(ue,a);let ve="";switch(c){case"wgsl":break;case"glsl":ve=E?`${q}

// ----- PROLOGUE -------------------------
${DB({id:t,source:i,stage:o})}
${`#define SHADER_TYPE_${o.toUpperCase()}`}

${wB(n)}
${o==="fragment"?IB:""}

// ----- APPLICATION DEFINES -------------------------

${OB(ue)}

`:`${q}
`;break}const se=UP(v),Se={},Ne={},nt={};for(const dt in A){const gt=typeof A[dt]=="string"?{injection:A[dt],order:0}:A[dt],vt=/^(v|f)s:(#)?([\w-]+)$/.exec(dt);if(vt){const Ft=vt[2],Wt=vt[3];Ft?Wt==="decl"?Ne[dt]=[gt]:nt[dt]=[gt]:Se[dt]=[gt]}else nt[dt]=[gt]}for(const dt of d){k&&FP(dt,ne,k);const gt=$P(dt,o);ve+=gt;const vt=dt.instance?.normalizedInjections[o]||{};for(const Ft in vt){const Wt=/^(v|f)s:#([\w-]+)$/.exec(Ft);if(Wt){const sn=Wt[2]==="decl"?Ne:nt;sn[Ft]=sn[Ft]||[],sn[Ft].push(vt[Ft])}else Se[Ft]=Se[Ft]||[],Se[Ft].push(vt[Ft])}}return ve+="// ----- MAIN SHADER SOURCE -------------------------",ve+=jP,ve=ny(ve,o,Ne),ve+=zP(se[o],Se),ve+=ne,ve=ny(ve,o,nt),c==="glsl"&&L!==z&&(ve=TB(ve,o)),ve.trim()}function VP(n){return function(t){const i={};for(const o of n){const c=o.getUniforms?.(t,i);Object.assign(i,c)}return i}}function DB(n){const{id:e,source:t,stage:i}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function OB(n={}){let e="";for(const t in n){const i=n[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function $P(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:wb(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let o=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(o+=`#define MODULE_${i}
`),o+=`${t}
`,o}const LB=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,FB=/^\s*\#\s*endif\s*$/;function NB(n,e){const t=n.split(`
`),i=[];let o=!0,c=null;for(const d of t){const a=d.match(LB),v=d.match(FB);a?(c=a[1],o=!!e?.defines?.[c]):v?o=!0:o&&i.push(d)}return i.join(`
`)}class Rd{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Rd.defaultShaderAssembler=Rd.defaultShaderAssembler||new Rd,Rd.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),i=this._hookFunctions,{source:o,getUniforms:c}=MB({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?NB(o):o,getUniforms:c,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),i=this._hookFunctions;return{...RB({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),i={};let o=0;for(let c=0,d=this._defaultModules.length;c<d;++c){const a=this._defaultModules[c],v=a.name;t[o++]=a,i[v]=!0}for(let c=0,d=e.length;c<d;++c){const a=e[c],v=a.name;i[v]||(t[o++]=a,i[v]=!0)}return t.length=o,iy(t),t}}const BB=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,zB=`#version 300 es
${BB}`;function WP(n){const{input:e,inputChannels:t,output:i}=n||{};if(!e)return zB;if(!t)throw new Error("inputChannels");const o=UB(t),c=jB(e,t);return`#version 300 es
in ${o} ${e};
out vec4 ${i};
void main() {
  ${i} = ${c};
}`}function UB(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function jB(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class VB{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new ky({id:e})),this.stats.get(e)}}const HP=new VB,Dt=new xg({id:"luma.gl"}),Xv={};function Oy(n="id"){Xv[n]=Xv[n]||1;const e=Xv[n]++;return`${n}-${e}`}let Ai=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,i){if(!e)throw new Error("no device");this._device=e,this.props=$B(t,i);const o=this.props.id!=="undefined"?this.props.id:Oy(this[Symbol.toStringTag]);this.props.id=o,this.id=o,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function $B(n,e){const t={...e};for(const i in n)n[i]!==void 0&&(t[i]=n[i]);return t}class Ci extends Ai{static defaultProps={...Ai.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const i={...t};(t.usage||0)&Ci.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,Ci.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,t){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,i){const o=ArrayBuffer.isView(e)?e.buffer:e,c=Math.min(e?e.byteLength:i,Ci.DEBUG_DATA_MAX_LENGTH);o===null?this.debugData=new ArrayBuffer(c):t===0&&i===o.byteLength?this.debugData=o.slice(0,c):this.debugData=o.slice(t,t+c)}}function ZP(n){const e=dT[n],t=WB(e),i=n.includes("norm"),o=!i&&!n.startsWith("float"),c=n.startsWith("s");return{dataType:dT[n],byteLength:t,integer:o,signed:c,normalized:i}}function WB(n){return HB[n]}const dT={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},HB={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},js="texture-compression-bc",Ti="texture-compression-astc",xc="texture-compression-etc2",ZB="texture-compression-etc1-webgl",u_="texture-compression-pvrtc-webgl",qv="texture-compression-atc-webgl",h_="float32-renderable-webgl",Gv="float16-renderable-webgl",XB="rgb9e5ufloat-renderable-webgl",Yv="snorm8-renderable-webgl",Mm="norm16-renderable-webgl",Kv="snorm16-renderable-webgl",d_="float32-filterable",fT="float16-filterable-webgl";function XP(n){const e=qB[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const qB={r8unorm:{},r8snorm:{render:Yv},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Yv},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Gv,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Mm},"r16snorm-webgl":{f:Kv},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Yv},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Gv,filter:fT},"rg16unorm-webgl":{render:Mm},"rg16snorm-webgl":{render:Kv},r32uint:{},r32sint:{},r32float:{render:h_,filter:d_},rgb9e5ufloat:{channels:"rgb",packed:!0,render:XB},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:h_},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Mm},"rgb16snorm-webgl":{f:Mm},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:d_},rgba16uint:{},rgba16sint:{},rgba16float:{render:Gv,filter:fT},"rgba16unorm-webgl":{render:Mm},"rgba16snorm-webgl":{render:Kv},"rgb32float-webgl":{render:h_,filter:d_},rgba32uint:{},rgba32sint:{},rgba32float:{render:h_,filter:d_},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:js},"bc1-rgb-unorm-srgb-webgl":{f:js},"bc1-rgba-unorm":{f:js},"bc1-rgba-unorm-srgb":{f:js},"bc2-rgba-unorm":{f:js},"bc2-rgba-unorm-srgb":{f:js},"bc3-rgba-unorm":{f:js},"bc3-rgba-unorm-srgb":{f:js},"bc4-r-unorm":{f:js},"bc4-r-snorm":{f:js},"bc5-rg-unorm":{f:js},"bc5-rg-snorm":{f:js},"bc6h-rgb-ufloat":{f:js},"bc6h-rgb-float":{f:js},"bc7-rgba-unorm":{f:js},"bc7-rgba-unorm-srgb":{f:js},"etc2-rgb8unorm":{f:xc},"etc2-rgb8unorm-srgb":{f:xc},"etc2-rgb8a1unorm":{f:xc},"etc2-rgb8a1unorm-srgb":{f:xc},"etc2-rgba8unorm":{f:xc},"etc2-rgba8unorm-srgb":{f:xc},"eac-r11unorm":{f:xc},"eac-r11snorm":{f:xc},"eac-rg11unorm":{f:xc},"eac-rg11snorm":{f:xc},"astc-4x4-unorm":{f:Ti},"astc-4x4-unorm-srgb":{f:Ti},"astc-5x4-unorm":{f:Ti},"astc-5x4-unorm-srgb":{f:Ti},"astc-5x5-unorm":{f:Ti},"astc-5x5-unorm-srgb":{f:Ti},"astc-6x5-unorm":{f:Ti},"astc-6x5-unorm-srgb":{f:Ti},"astc-6x6-unorm":{f:Ti},"astc-6x6-unorm-srgb":{f:Ti},"astc-8x5-unorm":{f:Ti},"astc-8x5-unorm-srgb":{f:Ti},"astc-8x6-unorm":{f:Ti},"astc-8x6-unorm-srgb":{f:Ti},"astc-8x8-unorm":{f:Ti},"astc-8x8-unorm-srgb":{f:Ti},"astc-10x5-unorm":{f:Ti},"astc-10x5-unorm-srgb":{f:Ti},"astc-10x6-unorm":{f:Ti},"astc-10x6-unorm-srgb":{f:Ti},"astc-10x8-unorm":{f:Ti},"astc-10x8-unorm-srgb":{f:Ti},"astc-10x10-unorm":{f:Ti},"astc-10x10-unorm-srgb":{f:Ti},"astc-12x10-unorm":{f:Ti},"astc-12x10-unorm-srgb":{f:Ti},"astc-12x12-unorm":{f:Ti},"astc-12x12-unorm-srgb":{f:Ti},"pvrtc-rgb4unorm-webgl":{f:u_},"pvrtc-rgba4unorm-webgl":{f:u_},"pvrtc-rbg2unorm-webgl":{f:u_},"pvrtc-rgba2unorm-webgl":{f:u_},"etc1-rbg-unorm-webgl":{f:ZB},"atc-rgb-unorm-webgl":{f:qv},"atc-rgba-unorm-webgl":{f:qv},"atc-rgbai-unorm-webgl":{f:qv}},GB=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],YB=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function qP(n){return GB.some(e=>n.startsWith(e))}function Sb(n){let e=KB(n);if(qP(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=JB(n);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const t=YB.exec(n);if(t){const[,i,o,c,d,a]=t,v=`${c}${o}`,A=ZP(v),E=A.byteLength*8,k=i.length,L=[E,k>=2?E:0,k>=3?E:0,k>=4?E:0];e={format:n,attachment:e.attachment,dataType:A.dataType,components:k,channels:i,integer:A.integer,signed:A.signed,normalized:A.normalized,bitsPerChannel:L,bytesPerPixel:A.byteLength*i.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),d==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function KB(n){const e=XP(n),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function JB(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,i,o]=t;return{blockWidth:Number(i),blockHeight:Number(o)}}return null}function QB(n){const e=XP(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=Sb(n),o=n.startsWith("depth")||n.startsWith("stencil"),c=i?.signed,d=i?.integer,a=i?.webgl;return t.render&&=!c,t.filter&&=!o&&!c&&!d&&!a,t}class ez{}class tz{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Sh{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Dt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Dt.get("debug")||void 0,debugShaders:Dt.get("debug-shaders")||void 0,debugFramebuffers:!!Dt.get("debug-framebuffers"),debugWebGL:!!Dt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...Sh.defaultProps,...e},this.id=this.props.id||Oy(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=HP;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const t=QB(e),i=d=>(typeof d=="string"?this.features.has(d):d)??!0,o=i(t.create),c={format:e,create:o,render:o&&i(t.render),filter:o&&i(t.filter),blend:o&&i(t.blend),store:o&&i(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(c)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return qP(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Ci.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":Dt.warn("indices buffer content must be of integer type")()),t}}const nz=qd()&&typeof document<"u",iz=()=>nz&&document.readyState==="complete",rz="set luma.log.level=1 (or higher) to trace rendering",pT="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class lp{static defaultProps={...Sh.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=sz().then(()=>{Dt.probe(2,"DOM is loaded")()});stats=HP;log=Dt;VERSION="9.1.10";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Dt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Dt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Dt.error("This version of luma.gl has already been initialized")()}Dt.log(1,`${this.VERSION} - ${rz}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapter(e=[]){const t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(lp.defaultProps,e)}async createDevice(e={}){e={...lp.defaultProps,...e},e.waitForPageLoad&&await lp.pageLoaded;const t=this.getAdapterMap(e.adapters);let i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);const d=await(this.getAdapterMap(e.adapters)||t).get(i)?.create?.(e);if(d)return d;throw new Error(pT)}async attachDevice(e){const t=this.getAdapterMap(e.adapters);let i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await lp.pageLoaded,e.handle===null&&(i="unknown");const c=await t.get(i)?.attach?.(null);if(c)return c;throw new Error(pT)}enforceWebGL2(e=!0,t=[]){const o=this.getAdapterMap(t).get("webgl");o||Dt.warn("enforceWebGL2: webgl adapter not found")(),o?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const i of e)t.set(i.type,i);return t}registerDevices(e){Dt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const i=t.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}}const nx=new lp;function sz(){return iz()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class oz{}class Ab{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Ab.defaultProps,...e},e=this.props,!qd()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=lz(e.canvas):this.canvas=e.canvas;else{const t=cz(e),i=az(e?.container||null);i.insertBefore(t,i.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const i of t)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){const i=this.cssToDeviceRatio(),[o,c]=this.getDrawingBufferSize();return uz(e,i,o,c,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let i="width"in t?t.width:this.htmlCanvas.clientWidth,o="height"in t?t.height:this.htmlCanvas.clientHeight;(!i||!o)&&(Dt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,o=this.htmlCanvas.height||1);const c=this._canvasSizeInfo;if(c.clientWidth!==i||c.clientHeight!==o||c.devicePixelRatio!==e){let d=e;const a=Math.floor(i*d),v=Math.floor(o*d);if(this.htmlCanvas.width=a,this.htmlCanvas.height=v,this.device.gl){const[E,k]=this.getDrawingBufferSize();(E!==a||k!==v)&&(d=Math.min(E/i,k/o),this.htmlCanvas.width=Math.floor(i*d),this.htmlCanvas.height=Math.floor(o*d),Dt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=o,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function az(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function lz(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function cz(n){const{width:e,height:t}=n,i=document.createElement("canvas");return i.id=Oy("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",i}function uz(n,e,t,i,o){const c=n,d=mT(c[0],e,t);let a=gT(c[1],e,i,o),v=mT(c[0]+1,e,t);const A=v===t-1?v:v-1;v=gT(c[1]+1,e,i,o);let E;return o?(v=v===0?v:v+1,E=a,a=v):E=v===i-1?v:v-1,{x:d,y:a,width:Math.max(A-d+1,1),height:Math.max(E-a+1,1)}}function mT(n,e,t){return Math.min(Math.round(n*e),t-1)}function gT(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}class Si extends Ai{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...Ai.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,t){if(t=Si.normalizeProps(e,t),super(e,t,Si.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=Si.getTextureDataSize(this.props.data);this.width=i?.width||1,this.height=i?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Si.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return Si.getTextureDataSize(e[0]);if(Si.isExternalImage(e))return Si.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,t){let i;return ArrayBuffer.isView(e)?i=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?i=e:i=[e],i}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,t){const i={...t},o=e?.props?._resourceDefaults?.texture||{};Object.assign(i,o);const{width:c,height:d}=i;return typeof c=="number"&&(i.width=Math.max(1,Math.ceil(c))),typeof d=="number"&&(i.height=Math.max(1,Math.ceil(d))),i}}class Ly extends Ai{static defaultProps={...Ai.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Ly.defaultProps)}}function hz(n,e,t){let i="";const o=e.split(/\r?\n/),c=n.slice().sort((d,a)=>d.lineNum-a.lineNum);switch(t?.showSourceCode||"no"){case"all":let d=0;for(let a=1;a<=o.length;a++)for(i+=GP(o[a-1],a,t);c.length>d&&c[d].lineNum===a;){const v=c[d++];i+=_T(v,o,v.lineNum,{...t,inlineSource:!1})}return i;case"issues":case"no":for(const a of n)i+=_T(a,o,a.lineNum,{inlineSource:t?.showSourceCode!=="no"});return i}}function _T(n,e,t,i){if(i?.inlineSource){const c=dz(e,t),d=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${c}${d}${n.type.toUpperCase()}: ${n.message}

`}const o=n.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${o};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function dz(n,e,t){let i="";for(let o=e-2;o<=e;o++){const c=n[o-1];c!==void 0&&(i+=GP(c,e,t))}return i}function GP(n,e,t){const i=t?.html?pz(n):n;return`${fz(String(e),4)}: ${i}${t?.html?"<br/>":`
`}`}function fz(n,e){let t="";for(let i=n.length;i<e;++i)t+=" ";return t+n}function pz(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Fy extends Ai{static defaultProps={...Ai.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:mz(t),...t},Fy.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const t=YP(this.source),i=`${this.stage} ${t}`;let o=hz(e,this.source,{showSourceCode:"all",html:!0});const c=this.getTranslatedSource();c&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${c}</pre></code>`);const d=document.createElement("Button");d.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,d.style.top="10px",d.style.left="10px",d.style.position="absolute",d.style.zIndex="9999",d.style.width="100%",d.style.textAlign="left",document.body.appendChild(d),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),d.onclick=()=>{const v=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(v)}}}function mz(n){return YP(n.source)||n.id||Oy(`unnamed ${n.stage}-shader`)}function YP(n,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:e}class lg extends Ai{static defaultProps={...Ai.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=lg.normalizeProps(e,t),super(e,t,lg.defaultProps)}static normalizeProps(e,t){const i=e?.props?._resourceDefaults?.sampler||{};return{...t,...i}}}class Ny extends Ai{static defaultProps={...Ai.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,Ny.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(o=>o.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:i})}resize(e){let t=!e;if(e){const[i,o]=Array.isArray(e)?e:[e.width,e.height];t=t||o!==this.height||i!==this.width,this.width=i,this.height=o}t&&(Dt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,i)=>{if(typeof t=="string"){const o=this.createColorTexture(t,i);return this.attachResource(o),o.view}return t instanceof Si?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof Si?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:Si.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Si.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const o=this.colorAttachments[i].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=o.view,this.attachResource(o.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}}class bp extends Ai{static defaultProps={...Ai.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,bp.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class Pd extends Ai{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...Ai.defaultProps,framebuffer:null,parameters:void 0,clearColor:Pd.defaultClearColor,clearColors:void 0,clearDepth:Pd.defaultClearDepth,clearStencil:Pd.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Pd.normalizeProps(e,t),super(e,t,Pd.defaultProps)}static normalizeProps(e,t){return{...e.props._resourceDefaults?.renderPass,...t}}}class ry extends Ai{static defaultProps={...Ai.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,ry.defaultProps),this.shaderLayout=t.shaderLayout}}class Eb extends Ai{static defaultProps={...Ai.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Eb.defaultProps)}}class Pb extends Ai{static defaultProps={...Ai.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Pb.defaultProps)}}function gz(n){const[e,t]=yz[n],i=e==="i32"||e==="u32",o=e!=="u32",c=vz[e]*t,d=_z(e,t);return{dataType:e,components:t,defaultVertexFormat:d,byteLength:c,integer:i,signed:o}}function _z(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const yz={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},vz={f32:4,f16:2,i32:4,u32:4};function KP(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,i]=n.split("x"),o=t,c=i?parseInt(i):1,d=ZP(o),a={type:o,components:c,byteLength:d.byteLength*c,integer:d.integer,signed:d.signed,normalized:d.normalized};return e&&(a.webglOnly=!0),a}function JP(n,e){const t={};for(const i of n.attributes){const o=bz(n,e,i.name);o&&(t[i.name]=o)}return t}function xz(n,e,t=16){const i=JP(n,e),o=new Array(t).fill(null);for(const c of Object.values(i))o[c.location]=c;return o}function bz(n,e,t){const i=wz(n,t),o=Tz(e,t);if(!i)return null;const c=gz(i.type),d=o?.vertexFormat||c.defaultVertexFormat,a=KP(d);return{attributeName:o?.attributeName||i.name,bufferName:o?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:c.dataType,shaderComponents:c.components,vertexFormat:d,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:c.integer,stepMode:o?.stepMode||i.stepMode||"vertex",byteOffset:o?.byteOffset||0,byteStride:o?.byteStride||0}}function wz(n,e){const t=n.attributes.find(i=>i.name===e);return t||Dt.warn(`shader layout attribute "${e}" not present in shader`),t||null}function Tz(n,e){Sz(n);let t=Az(n,e);return t||(t=Ez(n,e),t)?t:(Dt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function Sz(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&Dt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Az(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function Ez(n,e){for(const t of n){let i=t.byteStride;if(typeof t.byteStride!="number")for(const c of t.attributes||[]){const d=KP(c.format);i+=d.byteLength}const o=t.attributes?.find(c=>c.attribute===e);if(o)return{attributeName:o.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:o.format,byteOffset:o.byteOffset,byteStride:i}}return null}class Cb extends Ai{static defaultProps={...Ai.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,Cb.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:o}=t.renderPipeline||{};if(!i||!o)throw new Error("VertexArray");this.attributeInfos=xz(i,o,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"))}}class Ib extends Ai{static defaultProps={...Ai.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Ib.defaultProps)}}class Mb extends Ai{static defaultProps={...Ai.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Mb.defaultProps)}}const Pz={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function Cz(n){return Pz[n]}function Iz(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let f_;function QP(n){return(!f_||f_.byteLength<n)&&(f_=new ArrayBuffer(n)),f_}function Mz(n,e){const t=QP(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function Rz(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function sy(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":Rz(n)}const yT=1024;class kz{layout={};byteLength;constructor(e){let t=0;for(const[o,c]of Object.entries(e)){const d=Cz(c),{type:a,components:v}=d;t=Iz(t,v);const A=t;t+=v,this.layout[o]={type:a,size:v,offset:A}}t+=(4-t%4)%4;const i=t*4;this.byteLength=Math.max(i,yT)}getData(e){const t=Math.max(this.byteLength,yT),i=QP(t),o={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[c,d]of Object.entries(e)){const a=this.layout[c];if(!a){Dt.warn(`Supplied uniform value ${c} not present in uniform block layout`)();continue}const{type:v,size:A,offset:E}=a,k=o[v];if(A===1){if(typeof d!="number"&&typeof d!="boolean"){Dt.warn(`Supplied value for single component uniform ${c} is not a number: ${d}`)();continue}k[E]=Number(d)}else{if(!sy(d)){Dt.warn(`Supplied value for multi component / array uniform ${c} is not a numeric array: ${d}`)();continue}k.set(d,E)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function Dz(n,e,t=16){if(n!==e)return!1;const i=n,o=e;if(!sy(i))return!1;if(sy(o)&&i.length===o.length){for(let c=0;c<i.length;++c)if(o[c]!==i[c])return!1}return!0}function Oz(n){return sy(n)?n.slice():n}class Lz{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(o=>o.type==="uniform"&&o.name===e?.name);if(!t)throw new Error(e?.name);const i=t;for(const o of i.uniforms||[])this.bindingLayout[o.name]=o}}setUniforms(e){for(const[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){Dz(this.uniforms[e],t)||(this.uniforms[e]=Oz(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class Fz{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,i]of Object.entries(e)){const o=t,c=new kz(i.uniformTypes||{});this.uniformBufferLayouts.set(o,c);const d=new Lz({name:t});d.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(o,d)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,i]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);const o=this.getUniformBufferByteLength(t),c=e.createBuffer({usage:Ci.UNIFORM|Ci.COPY_DST,byteLength:o}),d=this.getUniformBufferData(t);return c.write(d),c}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const i=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:Ci.UNIFORM|Ci.COPY_DST,byteLength:i});this.uniformBuffers.set(t,o)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(t);e||=i}return e&&Dt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),o=!1;if(i&&t?.needsRedraw){o||=t.needsRedraw;const c=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(c);const d=this.uniformBlocks.get(e)?.getAllUniforms();Dt.log(4,`Writing to uniform buffer ${String(e)}`,c,d)()}return o}}function eC(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function tC(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function Nz(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let o=eC(n);if(o==="uint8"&&t&&i===1)return"unorm8-webgl";if(o==="uint8"&&t&&i===3)return"unorm8x3-webgl";if(o==="uint8"||o==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(o=o.replace("int","norm")),`${o}x${i}`}if(o==="uint16"||o==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(o=o.replace("int","norm")),`${o}x${i}`}return i===1?o:`${o}x${i}`}class Jv{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const i=[...e];for(const o of t){const c=i.findIndex(d=>d.name===o.name);c<0?i.push(o):i[c]=o}return i}getBufferIndex(e){const t=this.bufferLayouts.findIndex(i=>i.name===e);return t===-1&&Dt.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function Bz(n,e){const t=Object.fromEntries(n.attributes.map(o=>[o.name,o.location])),i=e.slice();return i.sort((o,c)=>{const d=o.attributes?o.attributes.map(E=>E.attribute):[o.name],a=c.attributes?c.attributes.map(E=>E.attribute):[c.name],v=Math.min(...d.map(E=>t[E])),A=Math.min(...a.map(E=>t[E]));return v-A}),i}class Ra{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class vT{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class xh extends Ra{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Ah extends Ra{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class ix extends Ra{constructor(e,t,i){super(e,i),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class jd extends Ra{constructor(e,t,i,o){super(e,i),this.format=t,this.access=o}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var _h;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(_h||(_h={}));class p_{constructor(e,t,i,o,c,d,a){this.name=e,this.type=t,this.group=i,this.binding=o,this.attributes=c,this.resourceType=d,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class zz{constructor(e,t){this.name=e,this.type=t}}class Uz{constructor(e,t,i,o){this.name=e,this.type=t,this.locationType=i,this.location=o,this.interpolation=null}}class xT{constructor(e,t,i,o){this.name=e,this.type=t,this.locationType=i,this.location=o}}class jz{constructor(e,t,i,o){this.name=e,this.type=t,this.attributes=i,this.id=o}}class Vz{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}}class $z{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}}class Wz{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function Hz(n){var e=(32768&n)>>15,t=(31744&n)>>10,i=1023&n;return t==0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):t==31?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+i/Math.pow(2,10))}const nC=new Float32Array(1),Zz=new Int32Array(nC.buffer),Vs=new Uint16Array(1);function Xz(n){nC[0]=n;const e=Zz[0],t=e>>31&1;let i=e>>23&255,o=8388607&e;if(i===255)return Vs[0]=t<<15|31744|(o!==0?512:0),Vs[0];if(i===0){if(o===0)return Vs[0]=t<<15,Vs[0];o|=8388608;let c=113;for(;!(8388608&o);)o<<=1,c--;return i=127-c,o&=8388607,i>0?(o=(o>>126-i)+(o>>127-i&1),Vs[0]=t<<15|i<<10|o>>13,Vs[0]):(Vs[0]=t<<15,Vs[0])}return i=i-127+15,i>=31?(Vs[0]=t<<15|31744,Vs[0]):i<=0?i<-10?(Vs[0]=t<<15,Vs[0]):(o=(8388608|o)>>1-i,Vs[0]=t<<15|o>>13,Vs[0]):(o>>=13,Vs[0]=t<<15|i<<10|o,Vs[0])}const Rb=new Uint32Array(1),iC=new Float32Array(Rb.buffer,0,1);function bT(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return Rb[0]=e,iC[0]}function qz(n,e,t,i,o,c,d,a,v){const A=i*(d>>=o)*(c>>=o)+t*d+e*a;switch(v){case"r8unorm":return[di(n,A,"8unorm",1)[0]];case"r8snorm":return[di(n,A,"8snorm",1)[0]];case"r8uint":return[di(n,A,"8uint",1)[0]];case"r8sint":return[di(n,A,"8sint",1)[0]];case"rg8unorm":{const E=di(n,A,"8unorm",2);return[E[0],E[1]]}case"rg8snorm":{const E=di(n,A,"8snorm",2);return[E[0],E[1]]}case"rg8uint":{const E=di(n,A,"8uint",2);return[E[0],E[1]]}case"rg8sint":{const E=di(n,A,"8sint",2);return[E[0],E[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const E=di(n,A,"8unorm",4);return[E[0],E[1],E[2],E[3]]}case"rgba8snorm":{const E=di(n,A,"8snorm",4);return[E[0],E[1],E[2],E[3]]}case"rgba8uint":{const E=di(n,A,"8uint",4);return[E[0],E[1],E[2],E[3]]}case"rgba8sint":{const E=di(n,A,"8sint",4);return[E[0],E[1],E[2],E[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const E=di(n,A,"8unorm",4);return[E[2],E[1],E[0],E[3]]}case"r16uint":return[di(n,A,"16uint",1)[0]];case"r16sint":return[di(n,A,"16sint",1)[0]];case"r16float":return[di(n,A,"16float",1)[0]];case"rg16uint":{const E=di(n,A,"16uint",2);return[E[0],E[1]]}case"rg16sint":{const E=di(n,A,"16sint",2);return[E[0],E[1]]}case"rg16float":{const E=di(n,A,"16float",2);return[E[0],E[1]]}case"rgba16uint":{const E=di(n,A,"16uint",4);return[E[0],E[1],E[2],E[3]]}case"rgba16sint":{const E=di(n,A,"16sint",4);return[E[0],E[1],E[2],E[3]]}case"rgba16float":{const E=di(n,A,"16float",4);return[E[0],E[1],E[2],E[3]]}case"r32uint":return[di(n,A,"32uint",1)[0]];case"r32sint":return[di(n,A,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[di(n,A,"32float",1)[0]];case"rg32uint":{const E=di(n,A,"32uint",2);return[E[0],E[1]]}case"rg32sint":{const E=di(n,A,"32sint",2);return[E[0],E[1]]}case"rg32float":{const E=di(n,A,"32float",2);return[E[0],E[1]]}case"rgba32uint":{const E=di(n,A,"32uint",4);return[E[0],E[1],E[2],E[3]]}case"rgba32sint":{const E=di(n,A,"32sint",4);return[E[0],E[1],E[2],E[3]]}case"rgba32float":{const E=di(n,A,"32float",4);return[E[0],E[1],E[2],E[3]]}case"rg11b10ufloat":{const E=new Uint32Array(n.buffer,A,1)[0],k=(4192256&E)>>11,L=(4290772992&E)>>22;return[bT(2047&E),bT(k),(function(z){const q=112+(z>>5&31)<<23|(31&z)<<18;return Rb[0]=q,iC[0]})(L),1]}}return null}function di(n,e,t,i){const o=[0,0,0,0];for(let c=0;c<i;++c)switch(t){case"8unorm":o[c]=n[e]/255,e++;break;case"8snorm":o[c]=n[e]/255*2-1,e++;break;case"8uint":o[c]=n[e],e++;break;case"8sint":o[c]=n[e]-127,e++;break;case"16uint":o[c]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":o[c]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":o[c]=Hz(n[e]|n[e+1]<<8),e+=2;break;case"32uint":case"32sint":o[c]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":o[c]=new Float32Array(n.buffer,e,1)[0],e+=4}return o}function _i(n,e,t,i,o){for(let c=0;c<i;++c)switch(t){case"8unorm":n[e]=255*o[c],e++;break;case"8snorm":n[e]=.5*(o[c]+1)*255,e++;break;case"8uint":n[e]=o[c],e++;break;case"8sint":n[e]=o[c]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=o[c],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=o[c],e+=2;break;case"16float":{const d=Xz(o[c]);new Uint16Array(n.buffer,e,1)[0]=d,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=o[c],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=o[c],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=o[c],e+=4}return o}const Qv={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Na{constructor(){this.id=Na._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(oy.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(ay.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Na._id=0;class oy extends Na{}oy.instance=new oy;class ay extends Na{}ay.instance=new ay;const rC=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class qi extends Na{constructor(){super()}}class cg extends qi{constructor(e,t,i,o,c,d){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=o,this.startLine=c,this.endLine=d}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class Gz extends qi{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class sC extends qi{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class rx extends qi{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class oC extends qi{constructor(e,t,i,o){super(),this.init=e,this.condition=t,this.increment=i,this.body=o}get astNodeType(){return"for"}search(e){var t,i,o;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(o=this.increment)===null||o===void 0||o.search(e),this.searchBlock(this.body,e)}}class Au extends qi{constructor(e,t,i,o,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=o,this.value=c}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class kb extends qi{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Gm extends qi{constructor(e,t,i,o,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=o,this.value=c}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class N_ extends qi{constructor(e,t,i,o,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=o,this.value=c}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var cp,Fm,et,He;(n=>{n.increment="++",n.decrement="--"})(cp||(cp={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(cp||(cp={}));class aC extends qi{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Fm||(Fm={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Fm||(Fm={}));class lC extends qi{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Db extends qi{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return rC.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class cC extends qi{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class uC extends qi{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class hC extends qi{constructor(e,t,i,o){super(),this.condition=e,this.body=t,this.elseif=i,this.else=o}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class dC extends qi{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Yz extends qi{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Kz extends qi{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class fC extends qi{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Ob extends qi{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class Jz extends qi{constructor(){super()}get astNodeType(){return"discard"}}class pC extends qi{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class mC extends qi{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class pt extends qi{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const o=pt._priority.get(t.name);pt._priority.get(e[i].name)<o&&(t=e[i])}return t.name==="x32"?pt.i32:t}getTypeName(){return this.name}}pt.x32=new pt("x32"),pt.f32=new pt("f32"),pt.i32=new pt("i32"),pt.u32=new pt("u32"),pt.f16=new pt("f16"),pt.bool=new pt("bool"),pt.void=new pt("void"),pt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class wT extends pt{constructor(e){super(e)}}class Tu extends pt{constructor(e,t,i,o){super(e),this.members=t,this.startLine=i,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class Xe extends pt{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}Xe.vec2f=new Xe("vec2",pt.f32,null),Xe.vec3f=new Xe("vec3",pt.f32,null),Xe.vec4f=new Xe("vec4",pt.f32,null),Xe.vec2i=new Xe("vec2",pt.i32,null),Xe.vec3i=new Xe("vec3",pt.i32,null),Xe.vec4i=new Xe("vec4",pt.i32,null),Xe.vec2u=new Xe("vec2",pt.u32,null),Xe.vec3u=new Xe("vec3",pt.u32,null),Xe.vec4u=new Xe("vec4",pt.u32,null),Xe.vec2h=new Xe("vec2",pt.f16,null),Xe.vec3h=new Xe("vec3",pt.f16,null),Xe.vec4h=new Xe("vec4",pt.f16,null),Xe.vec2b=new Xe("vec2",pt.bool,null),Xe.vec3b=new Xe("vec3",pt.bool,null),Xe.vec4b=new Xe("vec4",pt.bool,null),Xe.mat2x2f=new Xe("mat2x2",pt.f32,null),Xe.mat2x3f=new Xe("mat2x3",pt.f32,null),Xe.mat2x4f=new Xe("mat2x4",pt.f32,null),Xe.mat3x2f=new Xe("mat3x2",pt.f32,null),Xe.mat3x3f=new Xe("mat3x3",pt.f32,null),Xe.mat3x4f=new Xe("mat3x4",pt.f32,null),Xe.mat4x2f=new Xe("mat4x2",pt.f32,null),Xe.mat4x3f=new Xe("mat4x3",pt.f32,null),Xe.mat4x4f=new Xe("mat4x4",pt.f32,null),Xe.mat2x2h=new Xe("mat2x2",pt.f16,null),Xe.mat2x3h=new Xe("mat2x3",pt.f16,null),Xe.mat2x4h=new Xe("mat2x4",pt.f16,null),Xe.mat3x2h=new Xe("mat3x2",pt.f16,null),Xe.mat3x3h=new Xe("mat3x3",pt.f16,null),Xe.mat3x4h=new Xe("mat3x4",pt.f16,null),Xe.mat4x2h=new Xe("mat4x2",pt.f16,null),Xe.mat4x3h=new Xe("mat4x3",pt.f16,null),Xe.mat4x4h=new Xe("mat4x4",pt.f16,null),Xe.mat2x2i=new Xe("mat2x2",pt.i32,null),Xe.mat2x3i=new Xe("mat2x3",pt.i32,null),Xe.mat2x4i=new Xe("mat2x4",pt.i32,null),Xe.mat3x2i=new Xe("mat3x2",pt.i32,null),Xe.mat3x3i=new Xe("mat3x3",pt.i32,null),Xe.mat3x4i=new Xe("mat3x4",pt.i32,null),Xe.mat4x2i=new Xe("mat4x2",pt.i32,null),Xe.mat4x3i=new Xe("mat4x3",pt.i32,null),Xe.mat4x4i=new Xe("mat4x4",pt.i32,null),Xe.mat2x2u=new Xe("mat2x2",pt.u32,null),Xe.mat2x3u=new Xe("mat2x3",pt.u32,null),Xe.mat2x4u=new Xe("mat2x4",pt.u32,null),Xe.mat3x2u=new Xe("mat3x2",pt.u32,null),Xe.mat3x3u=new Xe("mat3x3",pt.u32,null),Xe.mat3x4u=new Xe("mat3x4",pt.u32,null),Xe.mat4x2u=new Xe("mat4x2",pt.u32,null),Xe.mat4x3u=new Xe("mat4x3",pt.u32,null),Xe.mat4x4u=new Xe("mat4x4",pt.u32,null);class B_ extends pt{constructor(e,t,i,o){super(e),this.storage=t,this.type=i,this.access=o}get astNodeType(){return"pointer"}}class Ym extends pt{constructor(e,t,i,o){super(e),this.attributes=t,this.format=i,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class Nm extends pt{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class Cl extends Na{constructor(){super(),this.postfix=null}}class Vd extends Cl{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class wc extends Cl{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Lb extends Cl{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return rC.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class ea extends Cl{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class gC extends Cl{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class qr extends Cl{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof We}get isVector(){return this.value instanceof _e||this.value instanceof bn}get scalarValue(){return this.value instanceof We?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof _e||this.value instanceof bn?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class _C extends Cl{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class wp extends Cl{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class yC extends Cl{constructor(){super()}}class Dr extends yC{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Tl extends yC{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?pt.f32:e.name==="u32"||t.name==="u32"?pt.u32:pt.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class vC extends Na{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class z_ extends Cl{constructor(){super()}get astNodeType(){return"default"}}class xC extends vC{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class bC extends vC{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class TT extends Na{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class Qz extends Na{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class ST extends Na{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class wC extends Na{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class La{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=La._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,o){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}La._id=0;class sx extends La{constructor(){super(new Ra("void",null),null)}toString(){return"void"}}sx.void=new sx;class Jf extends La{constructor(e){super(new ix("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,o){this.reference.setDataValue(e,t,i,o)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}toString(){return`&${this.reference.toString()}`}}class We extends La{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new We(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new We(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new We(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,o){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof We))return void console.error("SetDataValue: Invalid value",t);let c=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?c=Math.floor(c):this.typeInfo.name==="bool"&&(c=c?1:0),this.data[0]=c}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function e6(n,e,t){const i=e.length;return i===2?t==="f32"?new _e(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new _e(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new _e(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new _e(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):i===3?t==="f32"?new _e(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new _e(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new _e(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new _e(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):i===4?t==="f32"?new _e(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new _e(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new _e(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new _e(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class _e extends La{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?this.data=new Float32Array(e):o==="vec2i"||o==="vec3i"||o==="vec4i"?this.data=new Int32Array(e):o==="vec2u"||o==="vec3u"||o==="vec4u"?this.data=new Uint32Array(e):o==="vec2h"||o==="vec3h"||o==="vec4h"?this.data=new Float32Array(e):o==="vec2b"||o==="vec3b"||o==="vec4b"?this.data=new Int32Array(e):o==="vec2"||o==="vec3"||o==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${o}`)}}clone(){if(this.data instanceof Float32Array)return new _e(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new _e(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new _e(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,o){i instanceof Vd?console.error("TODO: Set vector postfix"):t instanceof _e?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let o=e.getTypeInfo("f32");if(this.typeInfo instanceof jd)o=this.typeInfo.format||o;else{const d=this.typeInfo.name;d==="vec2f"||d==="vec3f"||d==="vec4f"?o=e.getTypeInfo("f32"):d==="vec2i"||d==="vec3i"||d==="vec4i"?o=e.getTypeInfo("i32"):d==="vec2b"||d==="vec3b"||d==="vec4b"?o=e.getTypeInfo("bool"):d==="vec2u"||d==="vec3u"||d==="vec4u"?o=e.getTypeInfo("u32"):d==="vec2h"||d==="vec3h"||d==="vec4h"?o=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${d}`)}let c=this;for(;t!==null&&c!==null;){if(t instanceof wp){const d=t.index;let a=-1;if(d instanceof qr){if(!(d.value instanceof We))return console.error(`GetSubData: Invalid array index ${d.value}`),null;a=d.value.value}else{const v=e.evalExpression(d,i);if(!(v instanceof We))return console.error("GetSubData: Unknown index type",d),null;a=v.value}if(a<0||a>=c.data.length)return console.error("GetSubData: Index out of range",a),null;if(c.data instanceof Float32Array){const v=new Float32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new We(v,o)}if(c.data instanceof Int32Array){const v=new Int32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new We(v,o)}if(c.data instanceof Uint32Array){const v=new Uint32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new We(v,o)}throw"GetSubData: Invalid data type"}if(!(t instanceof Vd))return console.error("GetSubData: Unknown postfix",t),null;{const d=t.value.toLowerCase();if(d.length===1){let v=0;if(d==="x"||d==="r")v=0;else if(d==="y"||d==="g")v=1;else if(d==="z"||d==="b")v=2;else{if(d!=="w"&&d!=="a")return console.error(`GetSubData: Unknown member ${d}`),null;v=3}if(this.data instanceof Float32Array){let A=new Float32Array(this.data.buffer,this.data.byteOffset+4*v,1);return new We(A,o,this)}if(this.data instanceof Int32Array){let A=new Int32Array(this.data.buffer,this.data.byteOffset+4*v,1);return new We(A,o,this)}if(this.data instanceof Uint32Array){let A=new Uint32Array(this.data.buffer,this.data.byteOffset+4*v,1);return new We(A,o,this)}}const a=[];for(const v of d)v==="x"||v==="r"?a.push(this.data[0]):v==="y"||v==="g"?a.push(this.data[1]):v==="z"||v==="b"?a.push(this.data[2]):v==="w"||v==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${v}`);c=e6(e,a,o.name)}t=t.postfix}return c}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class bn extends La{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new bn(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,o){i instanceof Vd?console.error("TODO: Set matrix postfix"):t instanceof bn?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;const o=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof jd)this.typeInfo.format;else if(o.endsWith("f"))e.getTypeInfo("f32");else if(o.endsWith("i"))e.getTypeInfo("i32");else if(o.endsWith("u"))e.getTypeInfo("u32");else{if(!o.endsWith("h"))return console.error(`GetDataValue: Unknown type ${o}`),null;e.getTypeInfo("f16")}if(t instanceof wp){const c=t.index;let d=-1;if(c instanceof qr){if(!(c.value instanceof We))return console.error(`GetDataValue: Invalid array index ${c.value}`),null;d=c.value.value}else{const A=e.evalExpression(c,i);if(!(A instanceof We))return console.error("GetDataValue: Unknown index type",c),null;d=A.value}if(d<0||d>=this.data.length)return console.error("GetDataValue: Index out of range",d),null;const a=o.endsWith("h")?"h":"f";let v;if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h"||o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h")v=new _e(new Float32Array(this.data.buffer,this.data.byteOffset+2*d*4,2),e.getTypeInfo(`vec2${a}`));else if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h"||o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h")v=new _e(new Float32Array(this.data.buffer,this.data.byteOffset+3*d*4,3),e.getTypeInfo(`vec3${a}`));else{if(o!=="mat2x4"&&o!=="mat2x4f"&&o!=="mat2x4h"&&o!=="mat3x4"&&o!=="mat3x4f"&&o!=="mat3x4h"&&o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${o}`),null;v=new _e(new Float32Array(this.data.buffer,this.data.byteOffset+4*d*4,4),e.getTypeInfo(`vec4${a}`))}return t.postfix?v.getSubData(e,t.postfix,i):v}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class hr extends La{constructor(e,t,i=0,o=null){super(t,o),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new hr(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,i,o){if(t===null)return void console.log("setDataValue: NULL data.");let c=this.offset,d=this.typeInfo;for(;i;){if(i instanceof wp)if(d instanceof Ah){const a=i.index;if(a instanceof qr){if(!(a.value instanceof We))return void console.error(`SetDataValue: Invalid index type ${a.value}`);c+=a.value.value*d.stride}else{const v=e.evalExpression(a,o);if(!(v instanceof We))return void console.error("SetDataValue: Unknown index type",a);c+=v.value*d.stride}d=d.format}else console.error(`SetDataValue: Type ${d.getTypeName()} is not an array`);else{if(!(i instanceof Vd))return void console.error("SetDataValue: Unknown postfix type",i);{const a=i.value;if(d instanceof xh){let v=!1;for(const A of d.members)if(A.name===a){c+=A.offset,d=A.type,v=!0;break}if(!v)return void console.error(`SetDataValue: Member ${a} not found`)}else if(d instanceof Ra){const v=d.getTypeName();let A=0;if(a==="x"||a==="r")A=0;else if(a==="y"||a==="g")A=1;else if(a==="z"||a==="b")A=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);A=3}if(!(t instanceof We))return void console.error("SetDataValue: Invalid value",t);const E=t.value;return v==="vec2f"?void(new Float32Array(this.buffer,c,2)[A]=E):v==="vec3f"?void(new Float32Array(this.buffer,c,3)[A]=E):v==="vec4f"?void(new Float32Array(this.buffer,c,4)[A]=E):v==="vec2i"?void(new Int32Array(this.buffer,c,2)[A]=E):v==="vec3i"?void(new Int32Array(this.buffer,c,3)[A]=E):v==="vec4i"?void(new Int32Array(this.buffer,c,4)[A]=E):v==="vec2u"?void(new Uint32Array(this.buffer,c,2)[A]=E):v==="vec3u"?void(new Uint32Array(this.buffer,c,3)[A]=E):v==="vec4u"?void(new Uint32Array(this.buffer,c,4)[A]=E):void console.error(`SetDataValue: Type ${v} is not a struct`)}}}i=i.postfix}this.setData(e,t,d,c,o)}setData(e,t,i,o,c){const d=i.getTypeName();if(d!=="f32"&&d!=="f16")if(d!=="i32"&&d!=="atomic<i32>"&&d!=="x32")if(d!=="u32"&&d!=="atomic<u32>")if(d!=="bool"){if(d==="vec2f"||d==="vec2h"){const a=new Float32Array(this.buffer,o,2);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(d==="vec3f"||d==="vec3h"){const a=new Float32Array(this.buffer,o,3);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(d==="vec4f"||d==="vec4h"){const a=new Float32Array(this.buffer,o,4);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(d==="vec2i"){const a=new Int32Array(this.buffer,o,2);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(d==="vec3i"){const a=new Int32Array(this.buffer,o,3);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(d==="vec4i"){const a=new Int32Array(this.buffer,o,4);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(d==="vec2u"){const a=new Uint32Array(this.buffer,o,2);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(d==="vec3u"){const a=new Uint32Array(this.buffer,o,3);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(d==="vec4u"){const a=new Uint32Array(this.buffer,o,4);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(d==="vec2b"){const a=new Uint32Array(this.buffer,o,2);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(d==="vec3b"){const a=new Uint32Array(this.buffer,o,3);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(d==="vec4b"){const a=new Uint32Array(this.buffer,o,4);return void(t instanceof _e?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(d==="mat2x2f"||d==="mat2x2h"){const a=new Float32Array(this.buffer,o,4);return void(t instanceof bn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(d==="mat2x3f"||d==="mat2x3h"){const a=new Float32Array(this.buffer,o,6);return void(t instanceof bn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(d==="mat2x4f"||d==="mat2x4h"){const a=new Float32Array(this.buffer,o,8);return void(t instanceof bn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(d==="mat3x2f"||d==="mat3x2h"){const a=new Float32Array(this.buffer,o,6);return void(t instanceof bn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(d==="mat3x3f"||d==="mat3x3h"){const a=new Float32Array(this.buffer,o,9);return void(t instanceof bn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8]))}if(d==="mat3x4f"||d==="mat3x4h"){const a=new Float32Array(this.buffer,o,12);return void(t instanceof bn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(d==="mat4x2f"||d==="mat4x2h"){const a=new Float32Array(this.buffer,o,8);return void(t instanceof bn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(d==="mat4x3f"||d==="mat4x3h"){const a=new Float32Array(this.buffer,o,12);return void(t instanceof bn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(d==="mat4x4f"||d==="mat4x4h"){const a=new Float32Array(this.buffer,o,16);return void(t instanceof bn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11],a[12]=t.data[12],a[13]=t.data[13],a[14]=t.data[14],a[15]=t.data[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]))}if(t instanceof hr){if(i===t.typeInfo)return void new Uint8Array(this.buffer,o,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",d,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${d}`)}else t instanceof We&&(new Int32Array(this.buffer,o,1)[0]=t.value);else t instanceof We&&(new Uint32Array(this.buffer,o,1)[0]=t.value);else t instanceof We&&(new Int32Array(this.buffer,o,1)[0]=t.value);else t instanceof We&&(new Float32Array(this.buffer,o,1)[0]=t.value)}getSubData(e,t,i){var o,c,d;if(t===null)return this;let a=this.offset,v=this.typeInfo;for(;t;){if(t instanceof wp){const E=t.index,k=E instanceof Cl?e.evalExpression(E,i):E;let L=0;if(k instanceof We?L=k.value:typeof k=="number"?L=k:console.error("GetDataValue: Invalid index type",E),v instanceof Ah)a+=L*v.stride,v=v.format;else{const z=v.getTypeName();z==="mat4x4"||z==="mat4x4f"||z==="mat4x4h"?(a+=16*L,v=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${v.getTypeName()} is not an array`)}}else{if(!(t instanceof Vd))return console.error("GetDataValue: Unknown postfix type",t),null;{const E=t.value;if(v instanceof xh){let k=!1;for(const L of v.members)if(L.name===E){a+=L.offset,v=L.type,k=!0;break}if(!k)return console.error(`GetDataValue: Member ${E} not found`),null}else if(v instanceof Ra){const k=v.getTypeName();if(k==="vec2f"||k==="vec3f"||k==="vec4f"||k==="vec2i"||k==="vec3i"||k==="vec4i"||k==="vec2u"||k==="vec3u"||k==="vec4u"||k==="vec2b"||k==="vec3b"||k==="vec4b"||k==="vec2h"||k==="vec3h"||k==="vec4h"||k==="vec2"||k==="vec3"||k==="vec4"){if(E.length>0&&E.length<5){let L="f";const z=[];for(let q=0;q<E.length;++q){const Y=E[q].toLowerCase();let ne=0;if(Y==="x"||Y==="r")ne=0;else if(Y==="y"||Y==="g")ne=1;else if(Y==="z"||Y==="b")ne=2;else{if(Y!=="w"&&Y!=="a")return console.error(`Unknown member ${E}`),null;ne=3}if(E.length===1){if(k.endsWith("f"))return this.buffer.byteLength<a+4*ne+4?(console.log("Insufficient buffer data"),null):new We(new Float32Array(this.buffer,a+4*ne,1),e.getTypeInfo("f32"),this);if(k.endsWith("h"))return new We(new Float32Array(this.buffer,a+4*ne,1),e.getTypeInfo("f16"),this);if(k.endsWith("i"))return new We(new Int32Array(this.buffer,a+4*ne,1),e.getTypeInfo("i32"),this);if(k.endsWith("b"))return new We(new Int32Array(this.buffer,a+4*ne,1),e.getTypeInfo("bool"),this);if(k.endsWith("u"))return new We(new Uint32Array(this.buffer,a+4*ne,1),e.getTypeInfo("i32"),this)}if(k==="vec2f")z.push(new Float32Array(this.buffer,a,2)[ne]);else if(k==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const ue=new Float32Array(this.buffer,a,3);z.push(ue[ne])}else if(k==="vec4f")z.push(new Float32Array(this.buffer,a,4)[ne]);else if(k==="vec2i")L="i",z.push(new Int32Array(this.buffer,a,2)[ne]);else if(k==="vec3i")L="i",z.push(new Int32Array(this.buffer,a,3)[ne]);else if(k==="vec4i")L="i",z.push(new Int32Array(this.buffer,a,4)[ne]);else if(k==="vec2u"){L="u";const ue=new Uint32Array(this.buffer,a,2);z.push(ue[ne])}else k==="vec3u"?(L="u",z.push(new Uint32Array(this.buffer,a,3)[ne])):k==="vec4u"&&(L="u",z.push(new Uint32Array(this.buffer,a,4)[ne]))}return z.length===2?v=e.getTypeInfo(`vec2${L}`):z.length===3?v=e.getTypeInfo(`vec3${L}`):z.length===4?v=e.getTypeInfo(`vec4${L}`):console.error(`GetDataValue: Invalid vector length ${z.length}`),new _e(z,v,null)}return console.error(`GetDataValue: Unknown member ${E}`),null}return console.error(`GetDataValue: Type ${k} is not a struct`),null}}}t=t.postfix}const A=v.getTypeName();return A==="f32"?new We(new Float32Array(this.buffer,a,1),v,this):A==="i32"?new We(new Int32Array(this.buffer,a,1),v,this):A==="u32"?new We(new Uint32Array(this.buffer,a,1),v,this):A==="vec2f"?new _e(new Float32Array(this.buffer,a,2),v,this):A==="vec3f"?new _e(new Float32Array(this.buffer,a,3),v,this):A==="vec4f"?new _e(new Float32Array(this.buffer,a,4),v,this):A==="vec2i"?new _e(new Int32Array(this.buffer,a,2),v,this):A==="vec3i"?new _e(new Int32Array(this.buffer,a,3),v,this):A==="vec4i"?new _e(new Int32Array(this.buffer,a,4),v,this):A==="vec2u"?new _e(new Uint32Array(this.buffer,a,2),v,this):A==="vec3u"?new _e(new Uint32Array(this.buffer,a,3),v,this):A==="vec4u"?new _e(new Uint32Array(this.buffer,a,4),v,this):v instanceof jd&&v.name==="atomic"?((o=v.format)===null||o===void 0?void 0:o.name)==="u32"?new We(new Uint32Array(this.buffer,a,1)[0],v.format,this):((c=v.format)===null||c===void 0?void 0:c.name)==="i32"?new We(new Int32Array(this.buffer,a,1)[0],v.format,this):(console.error(`GetDataValue: Invalid atomic format ${(d=v.format)===null||d===void 0?void 0:d.name}`),null):new hr(this.buffer,v,a,this)}toString(){let e="";if(this.typeInfo instanceof Ah)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof xh?e+="{...}":e="[...]";return e}}class Su extends La{constructor(e,t,i,o){super(t,null),this.data=e,this.descriptor=i,this.view=o}clone(){return new Su(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.width)!==null&&t!==void 0?t:0}get height(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){const e=this.format,t=Qv[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Qv[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Qv[e],i=this.width;if(!e||i<=0||!t)return-1;const o=this.height,c=this.depthOrArrayLayers,d=this.dimension;return i/t.blockWidth*(d==="1d"?1:o/t.blockHeight)*t.bytesPerBlock*c}getPixel(e,t,i=0,o=0){const c=this.texelByteSize,d=this.bytesPerRow,a=this.height,v=this.data[o];return qz(new Uint8Array(v),e,t,i,o,a,d,c,this.format)}setPixel(e,t,i,o,c){const d=this.texelByteSize,a=this.bytesPerRow,v=this.height,A=this.data[o];(function(E,k,L,z,q,Y,ne,ue,ve,se){const Se=z*(ne>>=q)*(Y>>=q)+L*ne+k*ue;switch(ve){case"r8unorm":return void _i(E,Se,"8unorm",1,se);case"r8snorm":return void _i(E,Se,"8snorm",1,se);case"r8uint":return void _i(E,Se,"8uint",1,se);case"r8sint":return void _i(E,Se,"8sint",1,se);case"rg8unorm":return void _i(E,Se,"8unorm",2,se);case"rg8snorm":return void _i(E,Se,"8snorm",2,se);case"rg8uint":return void _i(E,Se,"8uint",2,se);case"rg8sint":return void _i(E,Se,"8sint",2,se);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void _i(E,Se,"8unorm",4,se);case"rgba8snorm":return void _i(E,Se,"8snorm",4,se);case"rgba8uint":return void _i(E,Se,"8uint",4,se);case"rgba8sint":return void _i(E,Se,"8sint",4,se);case"r16uint":return void _i(E,Se,"16uint",1,se);case"r16sint":return void _i(E,Se,"16sint",1,se);case"r16float":return void _i(E,Se,"16float",1,se);case"rg16uint":return void _i(E,Se,"16uint",2,se);case"rg16sint":return void _i(E,Se,"16sint",2,se);case"rg16float":return void _i(E,Se,"16float",2,se);case"rgba16uint":return void _i(E,Se,"16uint",4,se);case"rgba16sint":return void _i(E,Se,"16sint",4,se);case"rgba16float":return void _i(E,Se,"16float",4,se);case"r32uint":return void _i(E,Se,"32uint",1,se);case"r32sint":return void _i(E,Se,"32sint",1,se);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void _i(E,Se,"32float",1,se);case"rg32uint":return void _i(E,Se,"32uint",2,se);case"rg32sint":return void _i(E,Se,"32sint",2,se);case"rg32float":return void _i(E,Se,"32float",2,se);case"rgba32uint":return void _i(E,Se,"32uint",4,se);case"rgba32sint":return void _i(E,Se,"32sint",4,se);case"rgba32float":return void _i(E,Se,"32float",4,se);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(A),e,t,i,o,v,a,d,this.format,c)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(He||(He={}));class Ze{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class ce{}et=ce,ce.none=new Ze("",He.reserved,""),ce.eof=new Ze("EOF",He.token,""),ce.reserved={asm:new Ze("asm",He.reserved,"asm"),bf16:new Ze("bf16",He.reserved,"bf16"),do:new Ze("do",He.reserved,"do"),enum:new Ze("enum",He.reserved,"enum"),f16:new Ze("f16",He.reserved,"f16"),f64:new Ze("f64",He.reserved,"f64"),handle:new Ze("handle",He.reserved,"handle"),i8:new Ze("i8",He.reserved,"i8"),i16:new Ze("i16",He.reserved,"i16"),i64:new Ze("i64",He.reserved,"i64"),mat:new Ze("mat",He.reserved,"mat"),premerge:new Ze("premerge",He.reserved,"premerge"),regardless:new Ze("regardless",He.reserved,"regardless"),typedef:new Ze("typedef",He.reserved,"typedef"),u8:new Ze("u8",He.reserved,"u8"),u16:new Ze("u16",He.reserved,"u16"),u64:new Ze("u64",He.reserved,"u64"),unless:new Ze("unless",He.reserved,"unless"),using:new Ze("using",He.reserved,"using"),vec:new Ze("vec",He.reserved,"vec"),void:new Ze("void",He.reserved,"void")},ce.keywords={array:new Ze("array",He.keyword,"array"),atomic:new Ze("atomic",He.keyword,"atomic"),bool:new Ze("bool",He.keyword,"bool"),f32:new Ze("f32",He.keyword,"f32"),i32:new Ze("i32",He.keyword,"i32"),mat2x2:new Ze("mat2x2",He.keyword,"mat2x2"),mat2x3:new Ze("mat2x3",He.keyword,"mat2x3"),mat2x4:new Ze("mat2x4",He.keyword,"mat2x4"),mat3x2:new Ze("mat3x2",He.keyword,"mat3x2"),mat3x3:new Ze("mat3x3",He.keyword,"mat3x3"),mat3x4:new Ze("mat3x4",He.keyword,"mat3x4"),mat4x2:new Ze("mat4x2",He.keyword,"mat4x2"),mat4x3:new Ze("mat4x3",He.keyword,"mat4x3"),mat4x4:new Ze("mat4x4",He.keyword,"mat4x4"),ptr:new Ze("ptr",He.keyword,"ptr"),sampler:new Ze("sampler",He.keyword,"sampler"),sampler_comparison:new Ze("sampler_comparison",He.keyword,"sampler_comparison"),struct:new Ze("struct",He.keyword,"struct"),texture_1d:new Ze("texture_1d",He.keyword,"texture_1d"),texture_2d:new Ze("texture_2d",He.keyword,"texture_2d"),texture_2d_array:new Ze("texture_2d_array",He.keyword,"texture_2d_array"),texture_3d:new Ze("texture_3d",He.keyword,"texture_3d"),texture_cube:new Ze("texture_cube",He.keyword,"texture_cube"),texture_cube_array:new Ze("texture_cube_array",He.keyword,"texture_cube_array"),texture_multisampled_2d:new Ze("texture_multisampled_2d",He.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ze("texture_storage_1d",He.keyword,"texture_storage_1d"),texture_storage_2d:new Ze("texture_storage_2d",He.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ze("texture_storage_2d_array",He.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ze("texture_storage_3d",He.keyword,"texture_storage_3d"),texture_depth_2d:new Ze("texture_depth_2d",He.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ze("texture_depth_2d_array",He.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ze("texture_depth_cube",He.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ze("texture_depth_cube_array",He.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ze("texture_depth_multisampled_2d",He.keyword,"texture_depth_multisampled_2d"),texture_external:new Ze("texture_external",He.keyword,"texture_external"),u32:new Ze("u32",He.keyword,"u32"),vec2:new Ze("vec2",He.keyword,"vec2"),vec3:new Ze("vec3",He.keyword,"vec3"),vec4:new Ze("vec4",He.keyword,"vec4"),bitcast:new Ze("bitcast",He.keyword,"bitcast"),block:new Ze("block",He.keyword,"block"),break:new Ze("break",He.keyword,"break"),case:new Ze("case",He.keyword,"case"),continue:new Ze("continue",He.keyword,"continue"),continuing:new Ze("continuing",He.keyword,"continuing"),default:new Ze("default",He.keyword,"default"),diagnostic:new Ze("diagnostic",He.keyword,"diagnostic"),discard:new Ze("discard",He.keyword,"discard"),else:new Ze("else",He.keyword,"else"),enable:new Ze("enable",He.keyword,"enable"),fallthrough:new Ze("fallthrough",He.keyword,"fallthrough"),false:new Ze("false",He.keyword,"false"),fn:new Ze("fn",He.keyword,"fn"),for:new Ze("for",He.keyword,"for"),function:new Ze("function",He.keyword,"function"),if:new Ze("if",He.keyword,"if"),let:new Ze("let",He.keyword,"let"),const:new Ze("const",He.keyword,"const"),loop:new Ze("loop",He.keyword,"loop"),while:new Ze("while",He.keyword,"while"),private:new Ze("private",He.keyword,"private"),read:new Ze("read",He.keyword,"read"),read_write:new Ze("read_write",He.keyword,"read_write"),return:new Ze("return",He.keyword,"return"),requires:new Ze("requires",He.keyword,"requires"),storage:new Ze("storage",He.keyword,"storage"),switch:new Ze("switch",He.keyword,"switch"),true:new Ze("true",He.keyword,"true"),alias:new Ze("alias",He.keyword,"alias"),type:new Ze("type",He.keyword,"type"),uniform:new Ze("uniform",He.keyword,"uniform"),var:new Ze("var",He.keyword,"var"),override:new Ze("override",He.keyword,"override"),workgroup:new Ze("workgroup",He.keyword,"workgroup"),write:new Ze("write",He.keyword,"write"),r8unorm:new Ze("r8unorm",He.keyword,"r8unorm"),r8snorm:new Ze("r8snorm",He.keyword,"r8snorm"),r8uint:new Ze("r8uint",He.keyword,"r8uint"),r8sint:new Ze("r8sint",He.keyword,"r8sint"),r16uint:new Ze("r16uint",He.keyword,"r16uint"),r16sint:new Ze("r16sint",He.keyword,"r16sint"),r16float:new Ze("r16float",He.keyword,"r16float"),rg8unorm:new Ze("rg8unorm",He.keyword,"rg8unorm"),rg8snorm:new Ze("rg8snorm",He.keyword,"rg8snorm"),rg8uint:new Ze("rg8uint",He.keyword,"rg8uint"),rg8sint:new Ze("rg8sint",He.keyword,"rg8sint"),r32uint:new Ze("r32uint",He.keyword,"r32uint"),r32sint:new Ze("r32sint",He.keyword,"r32sint"),r32float:new Ze("r32float",He.keyword,"r32float"),rg16uint:new Ze("rg16uint",He.keyword,"rg16uint"),rg16sint:new Ze("rg16sint",He.keyword,"rg16sint"),rg16float:new Ze("rg16float",He.keyword,"rg16float"),rgba8unorm:new Ze("rgba8unorm",He.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ze("rgba8unorm_srgb",He.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ze("rgba8snorm",He.keyword,"rgba8snorm"),rgba8uint:new Ze("rgba8uint",He.keyword,"rgba8uint"),rgba8sint:new Ze("rgba8sint",He.keyword,"rgba8sint"),bgra8unorm:new Ze("bgra8unorm",He.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ze("bgra8unorm_srgb",He.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ze("rgb10a2unorm",He.keyword,"rgb10a2unorm"),rg11b10float:new Ze("rg11b10float",He.keyword,"rg11b10float"),rg32uint:new Ze("rg32uint",He.keyword,"rg32uint"),rg32sint:new Ze("rg32sint",He.keyword,"rg32sint"),rg32float:new Ze("rg32float",He.keyword,"rg32float"),rgba16uint:new Ze("rgba16uint",He.keyword,"rgba16uint"),rgba16sint:new Ze("rgba16sint",He.keyword,"rgba16sint"),rgba16float:new Ze("rgba16float",He.keyword,"rgba16float"),rgba32uint:new Ze("rgba32uint",He.keyword,"rgba32uint"),rgba32sint:new Ze("rgba32sint",He.keyword,"rgba32sint"),rgba32float:new Ze("rgba32float",He.keyword,"rgba32float"),static_assert:new Ze("static_assert",He.keyword,"static_assert")},ce.tokens={decimal_float_literal:new Ze("decimal_float_literal",He.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Ze("hex_float_literal",He.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Ze("int_literal",He.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ze("uint_literal",He.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Ze("name",He.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Ze("ident",He.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ze("and",He.token,"&"),and_and:new Ze("and_and",He.token,"&&"),arrow:new Ze("arrow ",He.token,"->"),attr:new Ze("attr",He.token,"@"),forward_slash:new Ze("forward_slash",He.token,"/"),bang:new Ze("bang",He.token,"!"),bracket_left:new Ze("bracket_left",He.token,"["),bracket_right:new Ze("bracket_right",He.token,"]"),brace_left:new Ze("brace_left",He.token,"{"),brace_right:new Ze("brace_right",He.token,"}"),colon:new Ze("colon",He.token,":"),comma:new Ze("comma",He.token,","),equal:new Ze("equal",He.token,"="),equal_equal:new Ze("equal_equal",He.token,"=="),not_equal:new Ze("not_equal",He.token,"!="),greater_than:new Ze("greater_than",He.token,">"),greater_than_equal:new Ze("greater_than_equal",He.token,">="),shift_right:new Ze("shift_right",He.token,">>"),less_than:new Ze("less_than",He.token,"<"),less_than_equal:new Ze("less_than_equal",He.token,"<="),shift_left:new Ze("shift_left",He.token,"<<"),modulo:new Ze("modulo",He.token,"%"),minus:new Ze("minus",He.token,"-"),minus_minus:new Ze("minus_minus",He.token,"--"),period:new Ze("period",He.token,"."),plus:new Ze("plus",He.token,"+"),plus_plus:new Ze("plus_plus",He.token,"++"),or:new Ze("or",He.token,"|"),or_or:new Ze("or_or",He.token,"||"),paren_left:new Ze("paren_left",He.token,"("),paren_right:new Ze("paren_right",He.token,")"),semicolon:new Ze("semicolon",He.token,";"),star:new Ze("star",He.token,"*"),tilde:new Ze("tilde",He.token,"~"),underscore:new Ze("underscore",He.token,"_"),xor:new Ze("xor",He.token,"^"),plus_equal:new Ze("plus_equal",He.token,"+="),minus_equal:new Ze("minus_equal",He.token,"-="),times_equal:new Ze("times_equal",He.token,"*="),division_equal:new Ze("division_equal",He.token,"/="),modulo_equal:new Ze("modulo_equal",He.token,"%="),and_equal:new Ze("and_equal",He.token,"&="),or_equal:new Ze("or_equal",He.token,"|="),xor_equal:new Ze("xor_equal",He.token,"^="),shift_right_equal:new Ze("shift_right_equal",He.token,">>="),shift_left_equal:new Ze("shift_left_equal",He.token,"<<=")},ce.simpleTokens={"@":et.tokens.attr,"{":et.tokens.brace_left,"}":et.tokens.brace_right,":":et.tokens.colon,",":et.tokens.comma,"(":et.tokens.paren_left,")":et.tokens.paren_right,";":et.tokens.semicolon},ce.literalTokens={"&":et.tokens.and,"&&":et.tokens.and_and,"->":et.tokens.arrow,"/":et.tokens.forward_slash,"!":et.tokens.bang,"[":et.tokens.bracket_left,"]":et.tokens.bracket_right,"=":et.tokens.equal,"==":et.tokens.equal_equal,"!=":et.tokens.not_equal,">":et.tokens.greater_than,">=":et.tokens.greater_than_equal,">>":et.tokens.shift_right,"<":et.tokens.less_than,"<=":et.tokens.less_than_equal,"<<":et.tokens.shift_left,"%":et.tokens.modulo,"-":et.tokens.minus,"--":et.tokens.minus_minus,".":et.tokens.period,"+":et.tokens.plus,"++":et.tokens.plus_plus,"|":et.tokens.or,"||":et.tokens.or_or,"*":et.tokens.star,"~":et.tokens.tilde,_:et.tokens.underscore,"^":et.tokens.xor,"+=":et.tokens.plus_equal,"-=":et.tokens.minus_equal,"*=":et.tokens.times_equal,"/=":et.tokens.division_equal,"%=":et.tokens.modulo_equal,"&=":et.tokens.and_equal,"|=":et.tokens.or_equal,"^=":et.tokens.xor_equal,">>=":et.tokens.shift_right_equal,"<<=":et.tokens.shift_left_equal},ce.regexTokens={decimal_float_literal:et.tokens.decimal_float_literal,hex_float_literal:et.tokens.hex_float_literal,int_literal:et.tokens.int_literal,uint_literal:et.tokens.uint_literal,ident:et.tokens.ident},ce.storage_class=[et.keywords.function,et.keywords.private,et.keywords.workgroup,et.keywords.uniform,et.keywords.storage],ce.access_mode=[et.keywords.read,et.keywords.write,et.keywords.read_write],ce.sampler_type=[et.keywords.sampler,et.keywords.sampler_comparison],ce.sampled_texture_type=[et.keywords.texture_1d,et.keywords.texture_2d,et.keywords.texture_2d_array,et.keywords.texture_3d,et.keywords.texture_cube,et.keywords.texture_cube_array],ce.multisampled_texture_type=[et.keywords.texture_multisampled_2d],ce.storage_texture_type=[et.keywords.texture_storage_1d,et.keywords.texture_storage_2d,et.keywords.texture_storage_2d_array,et.keywords.texture_storage_3d],ce.depth_texture_type=[et.keywords.texture_depth_2d,et.keywords.texture_depth_2d_array,et.keywords.texture_depth_cube,et.keywords.texture_depth_cube_array,et.keywords.texture_depth_multisampled_2d],ce.texture_external_type=[et.keywords.texture_external],ce.any_texture_type=[...et.sampled_texture_type,...et.multisampled_texture_type,...et.storage_texture_type,...et.depth_texture_type,...et.texture_external_type],ce.texel_format=[et.keywords.r8unorm,et.keywords.r8snorm,et.keywords.r8uint,et.keywords.r8sint,et.keywords.r16uint,et.keywords.r16sint,et.keywords.r16float,et.keywords.rg8unorm,et.keywords.rg8snorm,et.keywords.rg8uint,et.keywords.rg8sint,et.keywords.r32uint,et.keywords.r32sint,et.keywords.r32float,et.keywords.rg16uint,et.keywords.rg16sint,et.keywords.rg16float,et.keywords.rgba8unorm,et.keywords.rgba8unorm_srgb,et.keywords.rgba8snorm,et.keywords.rgba8uint,et.keywords.rgba8sint,et.keywords.bgra8unorm,et.keywords.bgra8unorm_srgb,et.keywords.rgb10a2unorm,et.keywords.rg11b10float,et.keywords.rg32uint,et.keywords.rg32sint,et.keywords.rg32float,et.keywords.rgba16uint,et.keywords.rgba16sint,et.keywords.rgba16float,et.keywords.rgba32uint,et.keywords.rgba32sint,et.keywords.rgba32float],ce.const_literal=[et.tokens.int_literal,et.tokens.uint_literal,et.tokens.decimal_float_literal,et.tokens.hex_float_literal,et.keywords.true,et.keywords.false],ce.literal_or_ident=[et.tokens.ident,et.tokens.int_literal,et.tokens.uint_literal,et.tokens.decimal_float_literal,et.tokens.hex_float_literal,et.tokens.name],ce.element_count_expression=[et.tokens.int_literal,et.tokens.uint_literal,et.tokens.ident],ce.template_types=[et.keywords.vec2,et.keywords.vec3,et.keywords.vec4,et.keywords.mat2x2,et.keywords.mat2x3,et.keywords.mat2x4,et.keywords.mat3x2,et.keywords.mat3x3,et.keywords.mat3x4,et.keywords.mat4x2,et.keywords.mat4x3,et.keywords.mat4x4,et.keywords.atomic,et.keywords.bitcast,...et.any_texture_type],ce.attribute_name=[et.tokens.ident,et.keywords.block,et.keywords.diagnostic],ce.assignment_operators=[et.tokens.equal,et.tokens.plus_equal,et.tokens.minus_equal,et.tokens.times_equal,et.tokens.division_equal,et.tokens.modulo_equal,et.tokens.and_equal,et.tokens.or_equal,et.tokens.xor_equal,et.tokens.shift_right_equal,et.tokens.shift_left_equal],ce.increment_operators=[et.tokens.plus_plus,et.tokens.minus_minus];class AT{constructor(e,t,i,o,c){this.type=e,this.lexeme=t,this.line=i,this.start=o,this.end=c}toString(){return this.lexeme}isTemplateType(){return ce.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ce.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class t6{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new AT(ce.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let d=1;for(;d>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),d--,d==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),d++)}return!0}}const t=ce.simpleTokens[e];if(t)return this._addToken(t),!0;let i=ce.none;const o=this._isAlpha(e),c=e==="_";if(this._isAlphaNumeric(e)){let d=this._peekAhead();for(;this._isAlphaNumeric(d);)e+=this._advance(),d=this._peekAhead()}if(o){const d=ce.keywords[e];if(d)return this._addToken(d),!0}if(o||c)return this._addToken(ce.tokens.ident),!0;for(;;){let d=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(ce.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(ce.tokens.minus_minus),!0;const v=this._tokens.length-1;if((ce.literal_or_ident.indexOf(this._tokens[v].type)!=-1||this._tokens[v].type==ce.tokens.paren_right)&&a!=">")return this._addToken(d),!0}if(e==">"&&(a==">"||a=="=")){let v=!1,A=this._tokens.length-1;for(let E=0;E<5&&A>=0&&ce.assignment_operators.indexOf(this._tokens[A].type)===-1;++E,--A)if(this._tokens[A].type===ce.tokens.less_than){A>0&&this._tokens[A-1].isArrayOrTemplateType()&&(v=!0);break}if(v)return this._addToken(d),!0}if(d===ce.none){let v=e,A=0;const E=2;for(let k=0;k<E;++k)if(v+=this._peekAhead(k),d=this._findType(v),d!==ce.none){A=k;break}if(d===ce.none)return i!==ce.none&&(this._current--,this._addToken(i),!0);e=v,this._current+=A+1}if(i=d,this._isAtEnd())break;e+=this._advance()}return i!==ce.none&&(this._addToken(i),!0)}_findType(e){for(const i in ce.regexTokens){const o=ce.regexTokens[i];if(this._match(e,o.rule))return o}return ce.literalTokens[e]||ce.none}_match(e,t){const i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new AT(e,t,this._line,this._start,this._current))}}function Vt(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const ly=new Float32Array(1),n6=new Uint32Array(ly.buffer),i6=new Uint32Array(ly.buffer),cy=new Int32Array(1),r6=new Float32Array(cy.buffer),s6=new Uint32Array(cy.buffer),uy=new Uint32Array(1),o6=new Float32Array(uy.buffer),a6=new Int32Array(uy.buffer);function ET(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return ly[0]=n,n6[0];if(t==="u32")return ly[0]=n,i6[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return cy[0]=n,r6[0];if(t==="u32")return cy[0]=n,s6[0]}else if(e==="u32"){if(t==="f32")return uy[0]=n,o6[0];if(t==="i32"||t==="x32")return uy[0]=n,a6[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class l6{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class m_{constructor(e,t){this.align=e,this.size=t}}class Ac{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Wz,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof cg&&this._functions.set(t.name,new l6(t));for(const t of e)if(t instanceof Tu){const i=this.getTypeInfo(t,null);i instanceof xh&&this.structs.push(i)}for(const t of e)if(t instanceof Ob)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof kb){const i=t,o=this._getAttributeNum(i.attributes,"id",0),c=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new jz(i.name,c,i.attributes,o));continue}if(this._isUniformVar(t)){const i=t,o=this._getAttributeNum(i.attributes,"group",0),c=this._getAttributeNum(i.attributes,"binding",0),d=this.getTypeInfo(i.type,i.attributes),a=new p_(i.name,d,o,c,i.attributes,_h.Uniform,i.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(t)){const i=t,o=this._getAttributeNum(i.attributes,"group",0),c=this._getAttributeNum(i.attributes,"binding",0),d=this.getTypeInfo(i.type,i.attributes),a=this._isStorageTexture(d),v=new p_(i.name,d,o,c,i.attributes,a?_h.StorageTexture:_h.Storage,i.access);v.access||(v.access="read"),this.storage.push(v);continue}if(this._isTextureVar(t)){const i=t,o=this._getAttributeNum(i.attributes,"group",0),c=this._getAttributeNum(i.attributes,"binding",0),d=this.getTypeInfo(i.type,i.attributes),a=this._isStorageTexture(d),v=new p_(i.name,d,o,c,i.attributes,a?_h.StorageTexture:_h.Texture,i.access);v.access||(v.access="read"),a?this.storage.push(v):this.textures.push(v);continue}if(this._isSamplerVar(t)){const i=t,o=this._getAttributeNum(i.attributes,"group",0),c=this._getAttributeNum(i.attributes,"binding",0),d=this.getTypeInfo(i.type,i.attributes),a=new p_(i.name,d,o,c,i.attributes,_h.Sampler,i.access);this.samplers.push(a);continue}}for(const t of e)if(t instanceof cg){const i=this._getAttribute(t,"vertex"),o=this._getAttribute(t,"fragment"),c=this._getAttribute(t,"compute"),d=i||o||c,a=new $z(t.name,d?.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,d&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!d),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[d.name].push(a)),a.arguments=t.args.map(v=>new Vz(v.name,this.getTypeInfo(v.type,v.attributes),v.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(i=>{var o,c,d;if(i instanceof wC){if(i.value)if(Vt(i.value))for(const a of i.value)for(const v of this.overrides)a===v.name&&((o=t.info)===null||o===void 0||o.overrides.push(v));else for(const a of this.overrides)i.value===a.name&&((c=t.info)===null||c===void 0||c.overrides.push(a))}else if(i instanceof ea)for(const a of this.overrides)i.name===a.name&&((d=t.info)===null||d===void 0||d.overrides.push(a))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(const o of e.calls){const c=(i=this._functions.get(o.name))===null||i===void 0?void 0:i.info;c&&t.add(c)}}findResource(e,t,i){if(i){for(const o of this.entry.compute)if(o.name===i){for(const c of o.resources)if(c.group==e&&c.binding==t)return c}for(const o of this.entry.vertex)if(o.name===i){for(const c of o.resources)if(c.group==e&&c.binding==t)return c}for(const o of this.entry.fragment)if(o.name===i){for(const c of o.resources)if(c.group==e&&c.binding==t)return c}}for(const o of this.uniforms)if(o.group==e&&o.binding==t)return o;for(const o of this.storage)if(o.group==e&&o.binding==t)return o;for(const o of this.textures)if(o.group==e&&o.binding==t)return o;for(const o of this.samplers)if(o.group==e&&o.binding==t)return o;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const i=[],o=this,c=[];return e.search(d=>{if(d instanceof oy)c.push({});else if(d instanceof ay)c.pop();else if(d instanceof Au){const a=d;t&&a.type!==null&&this._markStructsFromAST(a.type),c.length>0&&(c[c.length-1][a.name]=a)}else if(d instanceof wc){const a=d;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(d instanceof Gm){const a=d;t&&a.type!==null&&this._markStructsFromAST(a.type),c.length>0&&(c[c.length-1][a.name]=a)}else if(d instanceof ea){const a=d;if(c.length>0&&c[c.length-1][a.name])return;const v=o._findResource(a.name);v&&i.push(v)}else if(d instanceof Lb){const a=d,v=o._functions.get(a.name);v&&(t&&(v.inUse=!0),e.calls.add(v.node),v.resources===null&&(v.resources=o._findResources(v.node,t)),i.push(...v.resources))}else if(d instanceof Db){const a=d,v=o._functions.get(a.name);v&&(t&&(v.inUse=!0),e.calls.add(v.node),v.resources===null&&(v.resources=o._findResources(v.node,t)),i.push(...v.resources))}}),[...new Map(i.map(d=>[d.name,d])).values()]}getBindGroups(){const e=[];function t(i,o){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),o>=e[i].length&&(e[i].length=o+1)}for(const i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Tu)this._getStructOutputs(e,t);else{const i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(const i of e.members)if(i.type instanceof Tu)this._getStructOutputs(i.type,t);else{const o=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(o!==null){const c=this.getTypeInfo(i.type,i.type.attributes),d=this._parseInt(o.value),a=new xT(i.name,c,o.name,d);t.push(a)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this.getTypeInfo(e,e.attributes),o=this._parseInt(t.value);return new xT("",i,t.name,o)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const i of e)if(i.type instanceof Tu)this._getStructInputs(i.type,t);else{const o=this._getInputInfo(i);o!==null&&t.push(o)}return t}_getStructInputs(e,t){for(const i of e.members)if(i.type instanceof Tu)this._getStructInputs(i.type,t);else{const o=this._getInputInfo(i);o!==null&&t.push(o)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this._getAttribute(e,"interpolation"),o=this.getTypeInfo(e.type,e.attributes),c=this._parseInt(t.value),d=new Uz(e.name,o,t.name,c);return i!==null&&(d.interpolation=this._parseString(i.value)),d}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new zz(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof B_){const o=e.type?this.getTypeInfo(e.type,e.attributes):null,c=new ix(e.name,o,t);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof Ym){const o=e,c=o.format?this.getTypeInfo(o.format,o.attributes):null,d=new Ah(o.name,t);return d.format=c,d.count=o.count,this._types.set(e,d),this._updateTypeInfo(d),d}if(e instanceof Tu){const o=e,c=new xh(o.name,t);c.startLine=o.startLine,c.endLine=o.endLine;for(const d of o.members){const a=this.getTypeInfo(d.type,d.attributes);c.members.push(new vT(d.name,a,d.attributes))}return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof Nm){const o=e,c=o.format instanceof pt,d=o.format?c?this.getTypeInfo(o.format,null):new Ra(o.format,null):null,a=new jd(o.name,d,t,o.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Xe){const o=e,c=o.format?this.getTypeInfo(o.format,null):null,d=new jd(o.name,c,t,o.access);return this._types.set(e,d),this._updateTypeInfo(d),d}const i=new Ra(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,o;const c=this._getTypeSize(e);if(e.size=(t=c?.size)!==null&&t!==void 0?t:0,e instanceof Ah&&e.format){const d=this._getTypeSize(e.format);e.stride=Math.max((i=d?.size)!==null&&i!==void 0?i:0,(o=d?.align)!==null&&o!==void 0?o:0),this._updateTypeInfo(e.format)}e instanceof ix&&this._updateTypeInfo(e.format),e instanceof xh&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,o=0,c=0,d=0;for(let a=0,v=e.members.length;a<v;++a){const A=e.members[a],E=this._getTypeSize(A);if(!E)continue;(t=this._getAlias(A.type.name))!==null&&t!==void 0||A.type;const k=E.align,L=E.size;i=this._roundUp(k,i+o),o=L,c=i,d=Math.max(d,k),A.offset=i,A.size=L,this._updateTypeInfo(A.type)}e.size=this._roundUp(d,c+o),e.align=d}_getTypeSize(e){var t,i;if(e==null)return null;const o=this._getAttributeNum(e.attributes,"size",0),c=this._getAttributeNum(e.attributes,"align",0);if(e instanceof vT&&(e=e.type),e instanceof Ra){const d=this._getAlias(e.name);d!==null&&(e=d)}{const d=Ac._typeInfo[e.name];if(d!==void 0){const a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new m_(Math.max(c,d.align/a),Math.max(o,d.size/a))}}{const d=Ac._typeInfo[e.name.substring(0,e.name.length-1)];if(d){const a=e.name[e.name.length-1]==="h"?2:1;return new m_(Math.max(c,d.align/a),Math.max(o,d.size/a))}}if(e instanceof Ah){let d=e,a=8,v=8;const A=this._getTypeSize(d.format);return A!==null&&(v=A.size,a=A.align),v=d.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(a,v)),o&&(v=o),new m_(Math.max(c,a),Math.max(o,v))}if(e instanceof xh){let d=0,a=0,v=0,A=0,E=0;for(const k of e.members){const L=this._getTypeSize(k.type);L!==null&&(d=Math.max(L.align,d),v=this._roundUp(L.align,v+A),A=L.size,E=v)}return a=this._roundUp(d,E+A),new m_(Math.max(c,d),Math.max(o,a))}return null}_isUniformVar(e){return e instanceof Au&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Au&&e.storage=="storage"}_isTextureVar(e){return e instanceof Au&&e.type!==null&&Ac._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Au&&e.type!==null&&Ac._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const i=e;if(!i||!i.attributes)return null;const o=i.attributes;for(let c of o)if(c.name==t)return c;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let o of e)if(o.name==t){let c=o!==null&&o.value!==null?o.value:i;return c instanceof Array&&(c=c[0]),typeof c=="number"?c:typeof c=="string"?parseInt(c):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}Ac._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Ac._textureTypes=ce.any_texture_type.map(n=>n.name),Ac._samplerTypes=ce.sampler_type.map(n=>n.name);let Fb=0;class Nb{constructor(e,t,i){this.id=Fb++,this.name=e,this.value=t,this.node=i}clone(){return new Nb(this.name,this.value,this.node)}}class Bb{constructor(e){this.id=Fb++,this.name=e.name,this.node=e}clone(){return new Bb(this.node)}}class zb{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Fb++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new Nb(e,t,i??null))}setVariable(e,t,i){const o=this.getVariable(e);o!==null?o.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;const i=this.getVariable(e);return(t=i?.value)!==null&&t!==void 0?t:null}clone(){return new zb(this)}}class c6{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class u6{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const i=this.exec.evalExpression(e.args[0],t);let o=!0;if(i instanceof _e)return i.data.forEach(c=>{c||(o=!1)}),new We(o?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e){const o=i.data.some(c=>c);return new We(o?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof We))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.evalExpression(i,t);if(o instanceof hr&&o.typeInfo.size===0){const c=o.typeInfo,d=o.buffer.byteLength/c.stride;return new We(d,this.getTypeInfo("u32"))}return new We(o.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.abs(c)),i.typeInfo);const o=i;return new We(Math.abs(o.value),o.typeInfo)}Acos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.acos(c)),i.typeInfo);const o=i;return new We(Math.acos(o.value),i.typeInfo)}Acosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.acosh(c)),i.typeInfo);const o=i;return new We(Math.acosh(o.value),i.typeInfo)}Asin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.asin(c)),i.typeInfo);const o=i;return new We(Math.asin(o.value),i.typeInfo)}Asinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.asinh(c)),i.typeInfo);const o=i;return new We(Math.asinh(o.value),i.typeInfo)}Atan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.atan(c)),i.typeInfo);const o=i;return new We(Math.atan(o.value),i.typeInfo)}Atanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.atanh(c)),i.typeInfo);const o=i;return new We(Math.atanh(o.value),i.typeInfo)}Atan2(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(i instanceof _e&&o instanceof _e)return new _e(i.data.map((a,v)=>Math.atan2(a,o.data[v])),i.typeInfo);const c=i,d=o;return new We(Math.atan2(c.value,d.value),i.typeInfo)}Ceil(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.ceil(c)),i.typeInfo);const o=i;return new We(Math.ceil(o.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(i instanceof _e&&o instanceof _e&&c instanceof _e)return new _e(i.data.map((A,E)=>this._clamp(A,o.data[E],c.data[E])),i.typeInfo);const d=i,a=o,v=c;return new We(this._clamp(d.value,a.value,v.value),i.typeInfo)}Cos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.cos(c)),i.typeInfo);const o=i;return new We(Math.cos(o.value),i.typeInfo)}Cosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.cosh(c)),i.typeInfo);const o=i;return new We(Math.cos(o.value),i.typeInfo)}CountLeadingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.clz32(c)),i.typeInfo);const o=i;return new We(Math.clz32(o.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>this._countOneBits(c)),i.typeInfo);const o=i;return new We(this._countOneBits(o.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>this._countTrailingZeros(c)),i.typeInfo);const o=i;return new We(this._countTrailingZeros(o.value),i.typeInfo)}Cross(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(i instanceof _e&&o instanceof _e){if(i.data.length!==3||o.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const c=i.data,d=o.data;return new _e([c[1]*d[2]-d[1]*c[2],c[2]*d[0]-d[2]*c[0],c[0]*d[1]-d[0]*c[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const i=this.exec.evalExpression(e.args[0],t),o=180/Math.PI;return i instanceof _e?new _e(i.data.map(c=>c*o),i.typeInfo):new We(i.value*o,this.getTypeInfo("f32"))}Determinant(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof bn){const o=i.data,c=i.typeInfo.getTypeName(),d=c.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(c==="mat2x2"||c==="mat2x2f"||c==="mat2x2h")return new We(o[0]*o[3]-o[1]*o[2],d);if(c==="mat2x3"||c==="mat2x3f"||c==="mat2x3h")return new We(o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6]),d);if(c==="mat2x4"||c==="mat2x4f"||c==="mat2x4h")console.error(`TODO: Determinant for ${c}`);else if(c==="mat3x2"||c==="mat3x2f"||c==="mat3x2h")console.error(`TODO: Determinant for ${c}`);else{if(c==="mat3x3"||c==="mat3x3f"||c==="mat3x3h")return new We(o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6]),d);c==="mat3x4"||c==="mat3x4f"||c==="mat3x4h"||c==="mat4x2"||c==="mat4x2f"||c==="mat4x2h"||c==="mat4x3"||c==="mat4x3f"||c==="mat4x3h"?console.error(`TODO: Determinant for ${c}`):c!=="mat4x4"&&c!=="mat4x4f"&&c!=="mat4x4h"||console.error(`TODO: Determinant for ${c}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(i instanceof _e&&o instanceof _e){let a=0;for(let v=0;v<i.data.length;++v)a+=(i.data[v]-o.data[v])*(i.data[v]-o.data[v]);return new We(Math.sqrt(a),this.getTypeInfo("f32"))}const c=i,d=o;return new We(Math.abs(c.value-d.value),i.typeInfo)}_dot(e,t){let i=0;for(let o=0;o<e.length;++o)i+=t[o]*e[o];return i}Dot(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);return i instanceof _e&&o instanceof _e?new We(this._dot(i.data,o.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.exp(c)),i.typeInfo);const o=i;return new We(Math.exp(o.value),i.typeInfo)}Exp2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.pow(2,c)),i.typeInfo);const o=i;return new We(Math.pow(2,o.value),i.typeInfo)}ExtractBits(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const d=o.value,a=c.value;if(i instanceof _e)return new _e(i.data.map(A=>A>>d&(1<<a)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const v=i.value;return new We(v>>d&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(i instanceof _e&&o instanceof _e&&c instanceof _e){const d=this._dot(o.data,c.data);return new _e(d<0?Array.from(i.data):i.data.map(a=>-a),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>this._firstLeadingBit(c)),i.typeInfo);const o=i;return new We(this._firstLeadingBit(o.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>this._firstTrailingBit(c)),i.typeInfo);const o=i;return new We(this._firstTrailingBit(o.value),i.typeInfo)}Floor(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.floor(c)),i.typeInfo);const o=i;return new We(Math.floor(o.value),i.typeInfo)}Fma(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(i instanceof _e&&o instanceof _e&&c instanceof _e)return i.data.length!==o.data.length||i.data.length!==c.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new _e(i.data.map((A,E)=>A*o.data[E]+c.data[E]),i.typeInfo);const d=i,a=o,v=c;return new We(d.value*a.value+v.value,d.typeInfo)}Fract(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>c-Math.floor(c)),i.typeInfo);const o=i;return new We(o.value-Math.floor(o.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t),d=this.exec.evalExpression(e.args[3],t);if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=c.value,v=(1<<d.value)-1<<a,A=~v;if(i instanceof _e&&o instanceof _e)return new _e(i.data.map((L,z)=>L&A|o.data[z]<<a&v),i.typeInfo);const E=i.value,k=o.value;return new We(E&A|k<<a&v,i.typeInfo)}InverseSqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>1/Math.sqrt(c)),i.typeInfo);const o=i;return new We(1/Math.sqrt(o.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e){let c=0;return i.data.forEach(d=>{c+=d*d}),new We(Math.sqrt(c),this.getTypeInfo("f32"))}const o=i;return new We(Math.abs(o.value),i.typeInfo)}Log(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.log(c)),i.typeInfo);const o=i;return new We(Math.log(o.value),i.typeInfo)}Log2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.log2(c)),i.typeInfo);const o=i;return new We(Math.log2(o.value),i.typeInfo)}Max(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(i instanceof _e&&o instanceof _e)return new _e(i.data.map((a,v)=>Math.max(a,o.data[v])),i.typeInfo);const c=i,d=o;return new We(Math.max(c.value,d.value),i.typeInfo)}Min(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(i instanceof _e&&o instanceof _e)return new _e(i.data.map((a,v)=>Math.min(a,o.data[v])),i.typeInfo);const c=i,d=o;return new We(Math.min(c.value,d.value),i.typeInfo)}Mix(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(i instanceof _e&&o instanceof _e&&c instanceof _e)return new _e(i.data.map((v,A)=>i.data[A]*(1-c.data[A])+o.data[A]*c.data[A]),i.typeInfo);const d=o,a=c;return new We(i.value*(1-a.value)+d.value*a.value,i.typeInfo)}Modf(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(i instanceof _e&&o instanceof _e)return new _e(i.data.map((d,a)=>d%o.data[a]),i.typeInfo);const c=o;return new We(i.value%c.value,i.typeInfo)}Normalize(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e){const o=this.Length(e,t).value;return new _e(i.data.map(c=>c/o),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(i instanceof _e&&o instanceof _e)return new _e(i.data.map((a,v)=>Math.pow(a,o.data[v])),i.typeInfo);const c=i,d=o;return new We(Math.pow(c.value,d.value),i.typeInfo)}QuantizeToF16(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof _e?new _e(i.data.map(o=>o),i.typeInfo):new We(i.value,i.typeInfo)}Radians(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof _e?new _e(i.data.map(o=>o*Math.PI/180),i.typeInfo):new We(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(i instanceof _e&&o instanceof _e){const c=this._dot(i.data,o.data);return new _e(i.data.map((d,a)=>d-2*c*o.data[a]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(i instanceof _e&&o instanceof _e&&c instanceof We){const d=this._dot(o.data,i.data);return new _e(i.data.map((a,v)=>{const A=1-c.value*c.value*(1-d*d);if(A<0)return 0;const E=Math.sqrt(A);return c.value*a-(c.value*d+E)*o.data[v]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.round(c)),i.typeInfo);const o=i;return new We(Math.round(o.value),i.typeInfo)}Saturate(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.min(Math.max(c,0),1)),i.typeInfo);const o=i;return new We(Math.min(Math.max(o.value,0),1),i.typeInfo)}Sign(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.sign(c)),i.typeInfo);const o=i;return new We(Math.sign(o.value),i.typeInfo)}Sin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.sin(c)),i.typeInfo);const o=i;return new We(Math.sin(o.value),i.typeInfo)}Sinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.sinh(c)),i.typeInfo);const o=i;return new We(Math.sinh(o.value),i.typeInfo)}_smoothstep(e,t,i){const o=Math.min(Math.max((i-e)/(t-e),0),1);return o*o*(3-2*o)}SmoothStep(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(c instanceof _e&&i instanceof _e&&o instanceof _e)return new _e(c.data.map((A,E)=>this._smoothstep(i.data[E],o.data[E],A)),c.typeInfo);const d=i,a=o,v=c;return new We(this._smoothstep(d.value,a.value,v.value),c.typeInfo)}Sqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.sqrt(c)),i.typeInfo);const o=i;return new We(Math.sqrt(o.value),i.typeInfo)}Step(e,t){const i=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(o instanceof _e&&i instanceof _e)return new _e(o.data.map((d,a)=>d<i.data[a]?0:1),o.typeInfo);const c=i;return new We(o.value<c.value?0:1,c.typeInfo)}Tan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.tan(c)),i.typeInfo);const o=i;return new We(Math.tan(o.value),i.typeInfo)}Tanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.tanh(c)),i.typeInfo);const o=i;return new We(Math.tanh(o.value),i.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof bn))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const o=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const c=i.data;return new bn([c[0],c[2],c[1],c[3]],o)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const c=i.data;return new bn([c[0],c[3],c[6],c[1],c[4],c[7]],o)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const c=i.data;return new bn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13]],o)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const c=i.data;return new bn([c[0],c[3],c[1],c[4],c[2],c[5]],o)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const c=i.data;return new bn([c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]],o)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const c=i.data;return new bn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14]],o)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const c=i.data;return new bn([c[0],c[4],c[1],c[5],c[2],c[6]],o)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const c=i.data;return new bn([c[0],c[4],c[8],c[1],c[5],c[9],c[2],c[6],c[10]],o)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const c=i.data;return new bn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14],c[3],c[7],c[11],c[15]],o)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof _e)return new _e(i.data.map(c=>Math.trunc(c)),i.typeInfo);const o=i;return new We(Math.trunc(o.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const i=e.args[0],o=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof ea){const c=i.name,d=t.getVariableValue(c);if(d instanceof Su){if(o<0||o>=d.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=d.getMipLevelSize(o),v=d.dimension;return v==="1d"?new We(a[0],this.getTypeInfo("u32")):v==="3d"?new _e(a,this.getTypeInfo("vec3u")):v==="2d"?new _e(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${v} not found. Line ${e.line}`),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const i=e.args[0],o=this.exec.evalExpression(e.args[1],t),c=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(o instanceof _e)||o.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof ea){const d=i.name,a=t.getVariableValue(d);if(a instanceof Su){const v=Math.floor(o.data[0]),A=Math.floor(o.data[1]);if(v<0||v>=a.width||A<0||A>=a.height)return console.error(`Texture ${d} out of bounds. Line ${e.line}`),null;const E=a.getPixel(v,A,0,c);return E===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new _e(E,this.getTypeInfo("vec4f"))}return console.error(`Texture ${d} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const i=e.args[0];if(i instanceof ea){const o=i.name,c=t.getVariableValue(o);return c instanceof Su?new We(c.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const i=e.args[0];if(i instanceof ea){const o=i.name,c=t.getVariableValue(o);return c instanceof Su?new We(c.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const i=e.args[0];if(i instanceof ea){const o=i.name,c=t.getVariableValue(o);return c instanceof Su?new We(c.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const i=e.args[0],o=this.exec.evalExpression(e.args[1],t),c=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,d=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(d.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(o instanceof _e)||o.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof ea){const a=i.name,v=t.getVariableValue(a);if(v instanceof Su){const A=v.getMipLevelSize(0),E=Math.floor(o.data[0]),k=Math.floor(o.data[1]);return E<0||E>=A[0]||k<0||k>=A[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(v.setPixel(E,k,0,c,Array.from(d)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.getVariableName(i,t);return t.getVariable(o).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.getVariableName(i,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,i.postfix,t);return v instanceof We&&a instanceof We&&(v.value=a.value),c.value instanceof hr&&c.value.setDataValue(this.exec,v,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.getVariableName(i,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,i.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value+=a.value),c.value instanceof hr&&c.value.setDataValue(this.exec,v,i.postfix,t),A}AtomicSub(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.getVariableName(i,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,i.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value-=a.value),c.value instanceof hr&&c.value.setDataValue(this.exec,v,i.postfix,t),A}AtomicMax(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.getVariableName(i,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,i.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=Math.max(v.value,a.value)),c.value instanceof hr&&c.value.setDataValue(this.exec,v,i.postfix,t),A}AtomicMin(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.getVariableName(i,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,i.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=Math.min(v.value,a.value)),c.value instanceof hr&&c.value.setDataValue(this.exec,v,i.postfix,t),A}AtomicAnd(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.getVariableName(i,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,i.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=v.value&a.value),c.value instanceof hr&&c.value.setDataValue(this.exec,v,i.postfix,t),A}AtomicOr(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.getVariableName(i,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,i.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=v.value|a.value),c.value instanceof hr&&c.value.setDataValue(this.exec,v,i.postfix,t),A}AtomicXor(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.getVariableName(i,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,i.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=v.value^a.value),c.value instanceof hr&&c.value.setDataValue(this.exec,v,i.postfix,t),A}AtomicExchange(e,t){let i=e.args[0];i instanceof Dr&&(i=i.right);const o=this.exec.getVariableName(i,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,i.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=a.value),c.value instanceof hr&&c.value.setDataValue(this.exec,v,i.postfix,t),A}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const e0={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},co={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class $s extends c6{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new Ac,this.reflection.updateAST(this.ast),this.context=(i=t?.clone())!==null&&i!==void 0?i:new zb,this.builtins=new u6(this),this.typeInfo={bool:this.getTypeInfo(pt.bool),i32:this.getTypeInfo(pt.i32),u32:this.getTypeInfo(pt.u32),f32:this.getTypeInfo(pt.f32),f16:this.getTypeInfo(pt.f16),vec2f:this.getTypeInfo(Xe.vec2f),vec2u:this.getTypeInfo(Xe.vec2u),vec2i:this.getTypeInfo(Xe.vec2i),vec2h:this.getTypeInfo(Xe.vec2h),vec3f:this.getTypeInfo(Xe.vec3f),vec3u:this.getTypeInfo(Xe.vec3u),vec3i:this.getTypeInfo(Xe.vec3i),vec3h:this.getTypeInfo(Xe.vec3h),vec4f:this.getTypeInfo(Xe.vec4f),vec4u:this.getTypeInfo(Xe.vec4u),vec4i:this.getTypeInfo(Xe.vec4i),vec4h:this.getTypeInfo(Xe.vec4h),mat2x2f:this.getTypeInfo(Xe.mat2x2f),mat2x3f:this.getTypeInfo(Xe.mat2x3f),mat2x4f:this.getTypeInfo(Xe.mat2x4f),mat3x2f:this.getTypeInfo(Xe.mat3x2f),mat3x3f:this.getTypeInfo(Xe.mat3x3f),mat3x4f:this.getTypeInfo(Xe.mat3x4f),mat4x2f:this.getTypeInfo(Xe.mat4x2f),mat4x3f:this.getTypeInfo(Xe.mat4x3f),mat4x4f:this.getTypeInfo(Xe.mat4x4f)}}getVariableValue(e){var t,i;const o=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;if(o===null)return null;if(o instanceof We)return o.value;if(o instanceof _e||o instanceof bn)return Array.from(o.data);if(o instanceof hr&&o.typeInfo instanceof Ah){if(o.typeInfo.format.name==="u32")return Array.from(new Uint32Array(o.buffer,o.offset,o.typeInfo.count));if(o.typeInfo.format.name==="i32")return Array.from(new Int32Array(o.buffer,o.offset,o.typeInfo.count));if(o.typeInfo.format.name==="f32")return Array.from(new Float32Array(o.buffer,o.offset,o.typeInfo.count))}return console.error(`Unsupported return variable type ${o.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,o){const c=this.context.clone();(o=o??{}).constants&&this._setOverrides(o.constants,c),this._execStatements(this.ast,c);const d=c.getFunction(e);if(!d)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const a=t[0],v=t[1],A=t[2],E=this.getTypeInfo("vec3u");c.setVariable("@num_workgroups",new _e(t,E));const k=this.reflection.getFunctionInfo(e);k===null&&console.error(`Function ${e} not found in reflection data`);for(const L in i)for(const z in i[L]){const q=i[L][z];c.variables.forEach(Y=>{var ne;const ue=Y.node;if(ue?.attributes){let ve=null,se=null;for(const Se of ue.attributes)Se.name==="binding"?ve=Se.value:Se.name==="group"&&(se=Se.value);if(z==ve&&L==se){let Se=!1;for(const Ne of k.resources)if(Ne.name===Y.name&&Ne.group===parseInt(L)&&Ne.binding===parseInt(z)){Se=!0;break}if(Se)if(q.texture!==void 0&&q.descriptor!==void 0){const Ne=new Su(q.texture,this.getTypeInfo(ue.type),q.descriptor,(ne=q.texture.view)!==null&&ne!==void 0?ne:null);Y.value=Ne}else q.uniform!==void 0?Y.value=new hr(q.uniform,this.getTypeInfo(ue.type)):Y.value=new hr(q,this.getTypeInfo(ue.type))}}})}for(let L=0;L<A;++L)for(let z=0;z<v;++z)for(let q=0;q<a;++q)c.setVariable("@workgroup_id",new _e([q,z,L],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(d,[q,z,L],c)}execStatement(e,t){if(e instanceof dC)return this.evalExpression(e.value,t);if(e instanceof pC){if(e.condition){const i=this.evalExpression(e.condition,t);if(!(i instanceof We))throw new Error("Invalid break-if condition");if(!i.value)return null}return $s._breakObj}if(e instanceof mC)return $s._continueObj;if(e instanceof Gm)this._let(e,t);else if(e instanceof Au)this._var(e,t);else if(e instanceof N_)this._const(e,t);else if(e instanceof cg)this._function(e,t);else{if(e instanceof hC)return this._if(e,t);if(e instanceof uC)return this._switch(e,t);if(e instanceof oC)return this._for(e,t);if(e instanceof sC)return this._while(e,t);if(e instanceof cC)return this._loop(e,t);if(e instanceof rx){const i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof lC)this._assign(e,t);else if(e instanceof aC)this._increment(e,t);else{if(e instanceof Tu)return null;if(e instanceof kb){const i=e.name;t.getVariable(i)===null&&t.setVariable(i,new We(0,this.getTypeInfo("u32")))}else if(e instanceof Db)this._call(e,t);else{if(e instanceof fC||e instanceof Ob)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Tl?this._evalBinaryOp(e,t):e instanceof qr?this._evalLiteral(e,t):e instanceof ea?this._evalVariable(e,t):e instanceof Lb?this._evalCall(e,t):e instanceof wc?this._evalCreate(e,t):e instanceof gC?this._evalConst(e,t):e instanceof _C?this._evalBitcast(e,t):e instanceof Dr?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof pt){const o=this.reflection.getTypeInfo(e);if(o!==null)return o}let i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(const i in e){const o=e[i],c=this.reflection.getOverrideInfo(i);c!==null?(c.type===null&&(c.type=this.getTypeInfo("u32")),c.type.name==="u32"||c.type.name==="i32"||c.type.name==="f32"||c.type.name==="f16"?t.setVariable(i,new We(o,c.type)):c.type.name==="bool"?t.setVariable(i,new We(o?1:0,c.type)):c.type.name==="vec2"||c.type.name==="vec3"||c.type.name==="vec4"||c.type.name==="vec2f"||c.type.name==="vec3f"||c.type.name==="vec4f"||c.type.name==="vec2i"||c.type.name==="vec3i"||c.type.name==="vec4i"||c.type.name==="vec2u"||c.type.name==="vec3u"||c.type.name==="vec4u"||c.type.name==="vec2h"||c.type.name==="vec3h"||c.type.name==="vec4h"?t.setVariable(i,new _e(o,c.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){const o=[1,1,1];for(const E of e.node.attributes)if(E.name==="workgroup_size"){if(E.value.length>0){const k=i.getVariableValue(E.value[0]);o[0]=k instanceof We?k.value:parseInt(E.value[0])}if(E.value.length>1){const k=i.getVariableValue(E.value[1]);o[1]=k instanceof We?k.value:parseInt(E.value[1])}if(E.value.length>2){const k=i.getVariableValue(E.value[2]);o[2]=k instanceof We?k.value:parseInt(E.value[2])}}const c=this.getTypeInfo("vec3u"),d=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new _e(o,c));const a=o[0],v=o[1],A=o[2];for(let E=0,k=0;E<A;++E)for(let L=0;L<v;++L)for(let z=0;z<a;++z,++k){const q=[z,L,E],Y=[z+t[0]*o[0],L+t[1]*o[1],E+t[2]*o[2]];i.setVariable("@local_invocation_id",new _e(q,c)),i.setVariable("@global_invocation_id",new _e(Y,c)),i.setVariable("@local_invocation_index",new We(k,d)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(const i of e.node.args)for(const o of i.attributes)if(o.name==="builtin"){const c=`@${o.value}`,d=t.getVariable(c);d!==void 0&&t.variables.set(i.name,d)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Dr;)e=e.right;return e instanceof ea?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const i of e){if(i instanceof Array){const c=t.clone(),d=this._execStatements(i,c);if(d)return d;continue}const o=this.execStatement(i,t);if(o)return o}return null}_call(e,t){const i=t.clone();i.currentFunctionName=e.name;const o=t.getFunction(e.name);if(o){for(let c=0;c<o.node.args.length;++c){const d=o.node.args[c],a=this.evalExpression(e.args[c],i);i.setVariable(d.name,a,d)}this._execStatements(o.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const i=this.getVariableName(e.variable,t),o=t.getVariable(i);o?e.operator==="++"?o.value instanceof We?o.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?o.value instanceof We?o.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof ea){const i=this.getVariableName(e,t),o=t.getVariable(i);return o===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):o.value.getSubData(this,e.postfix,t)}if(e instanceof Dr){if(e.operator==="*"){const i=this._getVariableData(e.right,t);return i instanceof Jf?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,t);return new Jf(i)}}return null}_assign(e,t){let i=null,o="<var>",c=null;if(e.variable instanceof Dr){const v=this._getVariableData(e.variable,t),A=this.evalExpression(e.value,t),E=e.operator;if(E==="="){if(v instanceof We||v instanceof _e||v instanceof bn){if(A instanceof We||A instanceof _e||A instanceof bn&&v.data.length===A.data.length)return void v.data.set(A.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(v instanceof hr&&A instanceof hr&&v.buffer.byteLength-v.offset>=A.buffer.byteLength-A.offset)return void(v.buffer.byteLength%4==0?new Uint32Array(v.buffer,v.offset,v.typeInfo.size/4).set(new Uint32Array(A.buffer,A.offset,A.typeInfo.size/4)):new Uint8Array(v.buffer,v.offset,v.typeInfo.size).set(new Uint8Array(A.buffer,A.offset,A.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(E==="+=")return v instanceof We||v instanceof _e||v instanceof bn?A instanceof We||A instanceof _e||A instanceof bn?void v.data.set(A.data.map((k,L)=>v.data[L]+k)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(E==="-=")return(v instanceof We||v instanceof _e||v instanceof bn)&&(A instanceof We||A instanceof _e||A instanceof bn)?void v.data.set(A.data.map((k,L)=>v.data[L]-k)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Dr){if(e.variable.operator==="*"){o=this.getVariableName(e.variable.right,t);const v=t.getVariable(o);if(!(v&&v.value instanceof Jf))return void console.error(`Variable ${o} is not a pointer. Line ${e.line}`);i=v.value.reference;let A=e.variable.postfix;if(!A){let E=e.variable.right;for(;E instanceof Dr;){if(E.postfix){A=E.postfix;break}E=E.right}}A&&(i=i.getSubData(this,A,t))}}else{c=e.variable.postfix,o=this.getVariableName(e.variable,t);const v=t.getVariable(o);if(v===null)return void console.error(`Variable ${o} not found. Line ${e.line}`);i=v.value}if(i instanceof Jf&&(i=i.reference),i===null)return void console.error(`Variable ${o} not found. Line ${e.line}`);const d=this.evalExpression(e.value,t),a=e.operator;if(a!=="="){const v=i.getSubData(this,c,t);if(v instanceof _e&&d instanceof We){const A=v.data,E=d.value;if(a==="+=")for(let k=0;k<A.length;++k)A[k]+=E;else if(a==="-=")for(let k=0;k<A.length;++k)A[k]-=E;else if(a==="*=")for(let k=0;k<A.length;++k)A[k]*=E;else if(a==="/=")for(let k=0;k<A.length;++k)A[k]/=E;else if(a==="%=")for(let k=0;k<A.length;++k)A[k]%=E;else if(a==="&=")for(let k=0;k<A.length;++k)A[k]&=E;else if(a==="|=")for(let k=0;k<A.length;++k)A[k]|=E;else if(a==="^=")for(let k=0;k<A.length;++k)A[k]^=E;else if(a==="<<=")for(let k=0;k<A.length;++k)A[k]<<=E;else if(a===">>=")for(let k=0;k<A.length;++k)A[k]>>=E;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(v instanceof _e&&d instanceof _e){const A=v.data,E=d.data;if(A.length!==E.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let k=0;k<A.length;++k)A[k]+=E[k];else if(a==="-=")for(let k=0;k<A.length;++k)A[k]-=E[k];else if(a==="*=")for(let k=0;k<A.length;++k)A[k]*=E[k];else if(a==="/=")for(let k=0;k<A.length;++k)A[k]/=E[k];else if(a==="%=")for(let k=0;k<A.length;++k)A[k]%=E[k];else if(a==="&=")for(let k=0;k<A.length;++k)A[k]&=E[k];else if(a==="|=")for(let k=0;k<A.length;++k)A[k]|=E[k];else if(a==="^=")for(let k=0;k<A.length;++k)A[k]^=E[k];else if(a==="<<=")for(let k=0;k<A.length;++k)A[k]<<=E[k];else if(a===">>=")for(let k=0;k<A.length;++k)A[k]>>=E[k];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(v instanceof We&&d instanceof We))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?v.value+=d.value:a==="-="?v.value-=d.value:a==="*="?v.value*=d.value:a==="/="?v.value/=d.value:a==="%="?v.value%=d.value:a==="&="?v.value&=d.value:a==="|="?v.value|=d.value:a==="^="?v.value^=d.value:a==="<<="?v.value<<=d.value:a===">>="?v.value>>=d.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(i instanceof hr&&i.setDataValue(this,v,c,t))}if(i instanceof hr)i.setDataValue(this,d,c,t);else if(c){if(!(i instanceof _e||i instanceof bn))return void console.error(`Variable ${o} is not a vector or matrix. Line ${e.line}`);if(c instanceof wp){const v=this.evalExpression(c.index,t).value;if(i instanceof _e){if(!(d instanceof We))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);i.data[v]=d.value}else{if(!(i instanceof bn))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);{const A=this.evalExpression(c.index,t).value;if(A<0)return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(!(d instanceof _e))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);{const E=i.typeInfo.getTypeName();if(E==="mat2x2"||E==="mat2x2f"||E==="mat2x2h"){if(!(A<2&&d.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);i.data[2*A]=d.data[0],i.data[2*A+1]=d.data[1]}else if(E==="mat2x3"||E==="mat2x3f"||E==="mat2x3h"){if(!(A<2&&d.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);i.data[3*A]=d.data[0],i.data[3*A+1]=d.data[1],i.data[3*A+2]=d.data[2]}else if(E==="mat2x4"||E==="mat2x4f"||E==="mat2x4h"){if(!(A<2&&d.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);i.data[4*A]=d.data[0],i.data[4*A+1]=d.data[1],i.data[4*A+2]=d.data[2],i.data[4*A+3]=d.data[3]}else if(E==="mat3x2"||E==="mat3x2f"||E==="mat3x2h"){if(!(A<3&&d.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);i.data[2*A]=d.data[0],i.data[2*A+1]=d.data[1]}else if(E==="mat3x3"||E==="mat3x3f"||E==="mat3x3h"){if(!(A<3&&d.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);i.data[3*A]=d.data[0],i.data[3*A+1]=d.data[1],i.data[3*A+2]=d.data[2]}else if(E==="mat3x4"||E==="mat3x4f"||E==="mat3x4h"){if(!(A<3&&d.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);i.data[4*A]=d.data[0],i.data[4*A+1]=d.data[1],i.data[4*A+2]=d.data[2],i.data[4*A+3]=d.data[3]}else if(E==="mat4x2"||E==="mat4x2f"||E==="mat4x2h"){if(!(A<4&&d.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);i.data[2*A]=d.data[0],i.data[2*A+1]=d.data[1]}else if(E==="mat4x3"||E==="mat4x3f"||E==="mat4x3h"){if(!(A<4&&d.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);i.data[3*A]=d.data[0],i.data[3*A+1]=d.data[1],i.data[3*A+2]=d.data[2]}else{if(E!=="mat4x4"&&E!=="mat4x4f"&&E!=="mat4x4h")return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(!(A<4&&d.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);i.data[4*A]=d.data[0],i.data[4*A+1]=d.data[1],i.data[4*A+2]=d.data[2],i.data[4*A+3]=d.data[3]}}}}}else if(c instanceof Vd){const v=c.value;if(!(i instanceof _e))return void console.error(`Invalid assignment to ${v}. Variable ${o} is not a vector. Line ${e.line}`);if(d instanceof We){if(v.length>1)return void console.error(`Invalid assignment to ${v} for variable ${o}. Line ${e.line}`);if(v==="x")i.data[0]=d.value;else if(v==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${v} for variable ${o}. Line ${e.line}`);i.data[1]=d.value}else if(v==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${v} for variable ${o}. Line ${e.line}`);i.data[2]=d.value}else if(v==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${v} for variable ${o}. Line ${e.line}`);i.data[3]=d.value}}else{if(!(d instanceof _e))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(v.length!==d.data.length)return void console.error(`Invalid assignment to ${v} for variable ${o}. Line ${e.line}`);for(let A=0;A<v.length;++A){const E=v[A];if(E==="x"||E==="r")i.data[0]=d.data[A];else if(E==="y"||E==="g"){if(d.data.length<2)return void console.error(`Invalid assignment to ${E} for variable ${o}. Line ${e.line}`);i.data[1]=d.data[A]}else if(E==="z"||E==="b"){if(d.data.length<3)return void console.error(`Invalid assignment to ${E} for variable ${o}. Line ${e.line}`);i.data[2]=d.data[A]}else{if(E!=="w"&&E!=="a")return void console.error(`Invalid assignment to ${E} for variable ${o}. Line ${e.line}`);if(d.data.length<4)return void console.error(`Invalid assignment to ${E} for variable ${o}. Line ${e.line}`);i.data[3]=d.data[A]}}}}}else i instanceof We&&d instanceof We?i.value=d.value:i instanceof _e&&d instanceof _e||i instanceof bn&&d instanceof bn?i.data.set(d.data):console.error(`Invalid assignment to ${o}. Line ${e.line}`)}_function(e,t){const i=new Bb(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!==null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Dr||(i=i.clone())}else{const o=e.type.name;if(o==="f32"||o==="i32"||o==="u32"||o==="bool"||o==="f16"||o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2b"||o==="vec3b"||o==="vec4b"||o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"||o==="array"){const c=new wc(e.type,[]);i=this._evalCreate(c,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Dr||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const o=e.type.name;if(o==="f32"||o==="i32"||o==="u32"||o==="bool"||o==="f16"||o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2b"||o==="vec3b"||o==="vec4b"||o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"||e.type instanceof Ym||e.type instanceof Tu||e.type instanceof Xe){const c=new wc(e.type,[]);i=this._evalCreate(c,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof We))return console.error(`Invalid if condition. Line ${e.line}`),null;let o=null;for(const c of e.cases)if(c instanceof xC)for(const d of c.selectors){if(d instanceof z_){o=c;continue}const a=this.evalExpression(d,t);if(!(a instanceof We))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===i.value)return this._execStatements(c.body,t)}else c instanceof bC&&(o=c);return o?this._execStatements(o.body,t):null}_if(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof We))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(const o of e.elseif){const c=this.evalExpression(o.condition,t);if(!(c instanceof We))return console.error(`Invalid if condition. Line ${e.line}`),null;if(c.value)return this._execStatements(o.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof We?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===$s._breakObj)break;if(i!==null&&i!==$s._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const i=this._execStatements(e.body,t);if(i===$s._breakObj)break;if(i===$s._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===$s._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===$s._breakObj)break;if(i!==$s._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){const i=this.evalExpression(e.value,t),o=e.type;if(i instanceof We){const c=ET(i.value,i.typeInfo.name,o.name);return new We(c,this.getTypeInfo(o))}if(i instanceof _e){const c=i.typeInfo.getTypeName();let d="";if(c.endsWith("f"))d="f32";else if(c.endsWith("i"))d="i32";else if(c.endsWith("u"))d="u32";else if(c.endsWith("b"))d="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${c}. Line ${e.line}`),null;d="f16"}const a=o.getTypeName();let v="";if(a.endsWith("f"))v="f32";else if(a.endsWith("i"))v="i32";else if(a.endsWith("u"))v="u32";else if(a.endsWith("b"))v="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${v}. Line ${e.line}`),null;v="f16"}const A=(function(E,k,L){if(k===L)return E;const z=new Array(E.length);for(let q=0;q<E.length;q++)z[q]=ET(E[q],k,L);return z})(Array.from(i.data),d,v);return new _e(A,this.getTypeInfo(o))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof wc){if(e.type===null)return sx.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const o=e instanceof wc?e.type.name:e.name,c=e instanceof wc?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(c===null)return console.error(`Unknown type ${o}. Line ${e.line}`),null;if(c.size===0)return null;const d=new hr(new ArrayBuffer(c.size),c,0);if(c instanceof xh){if(e.args)for(let a=0;a<e.args.length;++a){const v=c.members[a],A=e.args[a],E=this.evalExpression(A,t);d.setData(this,E,v.type,v.offset,t)}}else if(c instanceof Ah){let a=0;if(e.args)for(let v=0;v<e.args.length;++v){const A=e.args[v],E=this.evalExpression(A,t);c.format===null&&(((i=E.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?c.format=this.getTypeInfo("i32"):c.format=E.typeInfo),d.setData(this,E,c.format,a,t),a+=c.stride}}else console.error(`Unknown type "${o}". Line ${e.line}`);return e instanceof wc?d.getSubData(this,e.postfix,t):d}_evalLiteral(e,t){const i=this.getTypeInfo(e.type),o=i.name;return o==="x32"||o==="u32"||o==="f32"||o==="f16"||o==="i32"||o==="bool"?new We(e.scalarValue,i):o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"?this._callConstructorVec(e,t):o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const i=t.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const o=$s._priority.get(t.name);$s._priority.get(e[i].name)<o&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const i=this.evalExpression(e.right,t);if(e.operator==="&")return new Jf(i);if(e.operator==="*")return i instanceof Jf?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const o=i instanceof We?i.value:i instanceof _e?Array.from(i.data):null;switch(e.operator){case"+":{if(Vt(o)){const a=o.map((v,A)=>+v);return new _e(a,i.typeInfo)}const c=o,d=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new We(+c,d)}case"-":{if(Vt(o)){const a=o.map((v,A)=>-v);return new _e(a,i.typeInfo)}const c=o,d=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new We(-c,d)}case"!":{if(Vt(o)){const a=o.map((v,A)=>v?0:1);return new _e(a,i.typeInfo)}const c=o,d=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new We(c?0:1,d)}case"~":{if(Vt(o)){const a=o.map((v,A)=>~v);return new _e(a,i.typeInfo)}const c=o,d=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new We(~c,d)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const i=this.evalExpression(e.left,t),o=this.evalExpression(e.right,t),c=i instanceof We?i.value:i instanceof _e||i instanceof bn?Array.from(i.data):null,d=o instanceof We?o.value:o instanceof _e||o instanceof bn?Array.from(o.data):null;switch(e.operator){case"+":{if(Vt(c)&&Vt(d)){const E=c,k=d;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=E.map((z,q)=>z+k[q]);return new _e(L,i.typeInfo)}if(Vt(c)){const E=d,k=c.map((L,z)=>L+E);return new _e(k,i.typeInfo)}if(Vt(d)){const E=c,k=d.map((L,z)=>E+L);return new _e(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([i.typeInfo,o.typeInfo]);return new We(a+v,A)}case"-":{if(Vt(c)&&Vt(d)){const E=c,k=d;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=E.map((z,q)=>z-k[q]);return new _e(L,i.typeInfo)}if(Vt(c)){const E=d,k=c.map((L,z)=>L-E);return new _e(k,i.typeInfo)}if(Vt(d)){const E=c,k=d.map((L,z)=>E-L);return new _e(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([i.typeInfo,o.typeInfo]);return new We(a-v,A)}case"*":{if(Vt(c)&&Vt(d)){const E=c,k=d;if(i instanceof bn&&o instanceof bn){const L=(function(ne,ue,ve,se){if(co[ue.name]===void 0||co[se.name]===void 0)return null;const Se=co[ue.name][0],Ne=co[ue.name][1],nt=co[se.name][0];if(Se!==co[se.name][1])return null;const dt=new Array(nt*Ne);for(let gt=0;gt<Ne;gt++)for(let vt=0;vt<nt;vt++){let Ft=0;for(let Wt=0;Wt<Se;Wt++)Ft+=ne[Wt*Ne+gt]*ve[vt*Se+Wt];dt[gt*nt+vt]=Ft}return dt})(E,i.typeInfo,k,o.typeInfo);if(L===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const z=co[o.typeInfo.name][0],q=co[i.typeInfo.name][1],Y=this.getTypeInfo(`mat${z}x${q}f`);return new bn(L,Y)}if(i instanceof bn&&o instanceof _e){const L=(function(z,q,Y,ne){if(co[q.name]===void 0||e0[ne.name]===void 0)return null;const ue=co[q.name][0],ve=co[q.name][1];if(ue!==Y.length)return null;const se=new Array(ve);for(let Se=0;Se<ve;Se++){let Ne=0;for(let nt=0;nt<ue;nt++)Ne+=z[nt*ve+Se]*Y[nt];se[Se]=Ne}return se})(E,i.typeInfo,k,o.typeInfo);return L===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new _e(L,o.typeInfo)}if(i instanceof _e&&o instanceof bn){const L=(function(z,q,Y,ne){if(e0[q.name]===void 0||co[ne.name]===void 0)return null;const ue=co[ne.name][0],ve=co[ne.name][1];if(ve!==z.length)return null;const se=[];for(let Se=0;Se<ue;Se++){let Ne=0;for(let nt=0;nt<ve;nt++)Ne+=z[nt]*Y[nt*ue+Se];se[Se]=Ne}return se})(E,i.typeInfo,k,o.typeInfo);return L===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new _e(L,i.typeInfo)}{if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=E.map((z,q)=>z*k[q]);return new _e(L,i.typeInfo)}}if(Vt(c)){const E=d,k=c.map((L,z)=>L*E);return i instanceof bn?new bn(k,i.typeInfo):new _e(k,i.typeInfo)}if(Vt(d)){const E=c,k=d.map((L,z)=>E*L);return o instanceof bn?new bn(k,o.typeInfo):new _e(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([i.typeInfo,o.typeInfo]);return new We(a*v,A)}case"%":{if(Vt(c)&&Vt(d)){const E=c,k=d;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=E.map((z,q)=>z%k[q]);return new _e(L,i.typeInfo)}if(Vt(c)){const E=d,k=c.map((L,z)=>L%E);return new _e(k,i.typeInfo)}if(Vt(d)){const E=c,k=d.map((L,z)=>E%L);return new _e(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([i.typeInfo,o.typeInfo]);return new We(a%v,A)}case"/":{if(Vt(c)&&Vt(d)){const E=c,k=d;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=E.map((z,q)=>z/k[q]);return new _e(L,i.typeInfo)}if(Vt(c)){const E=d,k=c.map((L,z)=>L/E);return new _e(k,i.typeInfo)}if(Vt(d)){const E=c,k=d.map((L,z)=>E/L);return new _e(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([i.typeInfo,o.typeInfo]);return new We(a/v,A)}case"&":{if(Vt(c)&&Vt(d)){const E=c,k=d;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=E.map((z,q)=>z&k[q]);return new _e(L,i.typeInfo)}if(Vt(c)){const E=d,k=c.map((L,z)=>L&E);return new _e(k,i.typeInfo)}if(Vt(d)){const E=c,k=d.map((L,z)=>E&L);return new _e(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([i.typeInfo,o.typeInfo]);return new We(a&v,A)}case"|":{if(Vt(c)&&Vt(d)){const E=c,k=d;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=E.map((z,q)=>z|k[q]);return new _e(L,i.typeInfo)}if(Vt(c)){const E=d,k=c.map((L,z)=>L|E);return new _e(k,i.typeInfo)}if(Vt(d)){const E=c,k=d.map((L,z)=>E|L);return new _e(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([i.typeInfo,o.typeInfo]);return new We(a|v,A)}case"^":{if(Vt(c)&&Vt(d)){const E=c,k=d;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=E.map((z,q)=>z^k[q]);return new _e(L,i.typeInfo)}if(Vt(c)){const E=d,k=c.map((L,z)=>L^E);return new _e(k,i.typeInfo)}if(Vt(d)){const E=c,k=d.map((L,z)=>E^L);return new _e(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([i.typeInfo,o.typeInfo]);return new We(a^v,A)}case"<<":{if(Vt(c)&&Vt(d)){const E=c,k=d;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=E.map((z,q)=>z<<k[q]);return new _e(L,i.typeInfo)}if(Vt(c)){const E=d,k=c.map((L,z)=>L<<E);return new _e(k,i.typeInfo)}if(Vt(d)){const E=c,k=d.map((L,z)=>E<<L);return new _e(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([i.typeInfo,o.typeInfo]);return new We(a<<v,A)}case">>":{if(Vt(c)&&Vt(d)){const E=c,k=d;if(E.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=E.map((z,q)=>z>>k[q]);return new _e(L,i.typeInfo)}if(Vt(c)){const E=d,k=c.map((L,z)=>L>>E);return new _e(k,i.typeInfo)}if(Vt(d)){const E=c,k=d.map((L,z)=>E>>L);return new _e(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([i.typeInfo,o.typeInfo]);return new We(a>>v,A)}case">":if(Vt(c)&&Vt(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((E,k)=>E>v[k]?1:0);return new _e(A,i.typeInfo)}if(Vt(c)){const a=d,v=c.map((A,E)=>A>a?1:0);return new _e(v,i.typeInfo)}if(Vt(d)){const a=c,v=d.map((A,E)=>a>A?1:0);return new _e(v,o.typeInfo)}return new We(c>d?1:0,this.getTypeInfo("bool"));case"<":if(Vt(c)&&Vt(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((E,k)=>E<v[k]?1:0);return new _e(A,i.typeInfo)}if(Vt(c)){const a=d,v=c.map((A,E)=>A<a?1:0);return new _e(v,i.typeInfo)}if(Vt(d)){const a=c,v=d.map((A,E)=>a<A?1:0);return new _e(v,o.typeInfo)}return new We(c<d?1:0,this.getTypeInfo("bool"));case"==":if(Vt(c)&&Vt(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((E,k)=>E===v[k]?1:0);return new _e(A,i.typeInfo)}if(Vt(c)){const a=d,v=c.map((A,E)=>A==a?1:0);return new _e(v,i.typeInfo)}if(Vt(d)){const a=c,v=d.map((A,E)=>a==A?1:0);return new _e(v,o.typeInfo)}return new We(c===d?1:0,this.getTypeInfo("bool"));case"!=":if(Vt(c)&&Vt(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((E,k)=>E!==v[k]?1:0);return new _e(A,i.typeInfo)}if(Vt(c)){const a=d,v=c.map((A,E)=>A!==a?1:0);return new _e(v,i.typeInfo)}if(Vt(d)){const a=c,v=d.map((A,E)=>a!==A?1:0);return new _e(v,o.typeInfo)}return new We(c!==d?1:0,this.getTypeInfo("bool"));case">=":if(Vt(c)&&Vt(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((E,k)=>E>=v[k]?1:0);return new _e(A,i.typeInfo)}if(Vt(c)){const a=d,v=c.map((A,E)=>A>=a?1:0);return new _e(v,i.typeInfo)}if(Vt(d)){const a=c,v=d.map((A,E)=>a>=A?1:0);return new _e(v,o.typeInfo)}return new We(c>=d?1:0,this.getTypeInfo("bool"));case"<=":if(Vt(c)&&Vt(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((E,k)=>E<=v[k]?1:0);return new _e(A,i.typeInfo)}if(Vt(c)){const a=d,v=c.map((A,E)=>A<=a?1:0);return new _e(v,i.typeInfo)}if(Vt(d)){const a=c,v=d.map((A,E)=>a<=A?1:0);return new _e(v,o.typeInfo)}return new We(c<=d?1:0,this.getTypeInfo("bool"));case"&&":if(Vt(c)&&Vt(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((E,k)=>E&&v[k]?1:0);return new _e(A,i.typeInfo)}if(Vt(c)){const a=d,v=c.map((A,E)=>A&&a?1:0);return new _e(v,i.typeInfo)}if(Vt(d)){const a=c,v=d.map((A,E)=>a&&A?1:0);return new _e(v,o.typeInfo)}return new We(c&&d?1:0,this.getTypeInfo("bool"));case"||":if(Vt(c)&&Vt(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((E,k)=>E||v[k]?1:0);return new _e(A,i.typeInfo)}if(Vt(c)){const a=d,v=c.map((A,E)=>A||a?1:0);return new _e(v,i.typeInfo)}if(Vt(d)){const a=c,v=d.map((A,E)=>a||A?1:0);return new _e(v,o.typeInfo)}return new We(c||d?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=t.clone();i.currentFunctionName=e.name;const o=t.getFunction(e.name);if(!o)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let c=0;c<o.node.args.length;++c){const d=o.node.args[c],a=this.evalExpression(e.args[c],i);i.createVariable(d.name,a,d)}return this._execStatements(o.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const i=t.getFunction(e.name);if(i){const o=t.clone();for(let c=0;c<i.node.args.length;++c){const d=i.node.args[c],a=this.evalExpression(e.args[c],o);o.setVariable(d.name,a,d)}return this._execStatements(i.node.body,o)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new We(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const i=this.getTypeInfo(e.type),o=e.type.getTypeName(),c=e0[o];if(c===void 0)return console.error(`Invalid vec constructor ${o}. Line ${e.line}`),null;const d=[];if(e instanceof qr)if(e.isVector){const a=e.vectorValue;for(const v of a)d.push(v)}else d.push(e.scalarValue);else if(e.args)for(const a of e.args){const v=this.evalExpression(a,t);if(v instanceof _e){const A=v.data;for(let E=0;E<A.length;++E){let k=A[E];d.push(k)}}else if(v instanceof We){let A=v.value;d.push(A)}}if(e.type instanceof Xe&&e.type.format===null&&(e.type.format=Xe.f32),d.length===0){const a=new Array(c).fill(0);return new _e(a,i).getSubData(this,e.postfix,t)}if(d.length===1)for(;d.length<c;)d.push(d[0]);return d.length<c?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new _e(d.length>c?d.slice(0,c):d,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const i=this.getTypeInfo(e.type),o=e.type.getTypeName(),c=co[o];if(c===void 0)return console.error(`Invalid matrix constructor ${o}. Line ${e.line}`),null;const d=[];if(e instanceof qr)if(e.isVector){const a=e.vectorValue;for(const v of a)d.push(v)}else d.push(e.scalarValue);else if(e.args)for(const a of e.args){const v=this.evalExpression(a,t);v instanceof _e?d.push(...v.data):v instanceof We?d.push(v.value):v instanceof bn&&d.push(...v.data)}if(i instanceof jd&&i.format===null&&(i.format=this.getTypeInfo("f32")),d.length===0){const a=new Array(c[2]).fill(0);return new bn(a,i).getSubData(this,e.postfix,t)}return d.length!==c[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new bn(d,i).getSubData(this,e.postfix,t)}}$s._breakObj=new La(new Ra("BREAK",null),null),$s._continueObj=new La(new Ra("CONTINUE",null),null),$s._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class h6{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class d6{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new h6,this._exec=new $s,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const o=i.arrayType,c=i.countNode;if(c instanceof ea){const d=c.name,a=this._context.constants.get(d);if(a)try{const v=a.constEvaluate(this._exec);o.count=v}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(o=>{o instanceof ST||o instanceof B_?o.type=this._forwardType(o.type):o instanceof Ym?o.format=this._forwardType(o.format):o instanceof Au||o instanceof Gm||o instanceof N_?o.type=this._forwardType(o.type):o instanceof cg?o.returnType=this._forwardType(o.returnType):o instanceof TT&&(o.type=this._forwardType(o.type))});return t}_forwardType(e){if(e instanceof wT){const t=this._getType(e.name);if(t)return t}else e instanceof B_?e.type=this._forwardType(e.type):e instanceof Ym&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new t6(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ce.eof}_match(e){if(e instanceof Ze)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){const o=e[t];if(this._check(o))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const i=t.type;let o=!1;for(const c of e){if(i===c)return!0;c===ce.tokens.name&&(o=!0)}if(o){const c=ce.tokens.name.rule.exec(t.lexeme);if(c&&c.index==0&&c[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===ce.tokens.name){const i=ce.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ce.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ce.keywords.alias)){const t=this._type_alias();return this._consume(ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ce.keywords.diagnostic)){const t=this._diagnostic();return this._consume(ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ce.keywords.requires)){const t=this._requires_directive();return this._consume(ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ce.keywords.enable)){const t=this._enable_directive();return this._consume(ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(ce.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ce.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ce.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ce.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ce.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(ce.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(ce.keywords.fn))return null;const e=this._currentLine,t=this._consume(ce.tokens.ident,"Expected function name.").toString();this._consume(ce.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(ce.tokens.paren_right))do{if(this._check(ce.tokens.paren_right))break;const a=this._attribute(),v=this._consume(ce.tokens.name,"Expected argument name.").toString();this._consume(ce.tokens.colon,"Expected ':' for argument type.");const A=this._attribute(),E=this._type_decl();E!=null&&(E.attributes=A,i.push(this._updateNode(new TT(v,E,a))))}while(this._match(ce.tokens.comma));this._consume(ce.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(ce.tokens.arrow)){const a=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=a)}const c=this._compound_statement(),d=this._currentLine;return this._updateNode(new cg(t,i,o,c,e,d),e)}_compound_statement(){const e=[];for(this._consume(ce.tokens.brace_left,"Expected '{' for block.");!this._check(ce.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(ce.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ce.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ce.tokens.attr)&&this._attribute(),this._check(ce.keywords.if))return this._if_statement();if(this._check(ce.keywords.switch))return this._switch_statement();if(this._check(ce.keywords.loop))return this._loop_statement();if(this._check(ce.keywords.for))return this._for_statement();if(this._check(ce.keywords.while))return this._while_statement();if(this._check(ce.keywords.continuing))return this._continuing_statement();if(this._check(ce.keywords.static_assert))return this._static_assert_statement();if(this._check(ce.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(ce.keywords.return))e=this._return_statement();else if(this._check([ce.keywords.var,ce.keywords.let,ce.keywords.const]))e=this._variable_statement();else if(this._match(ce.keywords.discard))e=this._updateNode(new Jz);else if(this._match(ce.keywords.break)){const t=this._updateNode(new pC);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(ce.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(ce.keywords.continue)){const t=this._updateNode(new mC);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(ce.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ce.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new Gz(t),e)}_while_statement(){if(!this._match(ce.keywords.while))return null;const e=this._updateNode(new sC(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ce.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(ce.keywords.continuing))return null;const t=this._currentLine,i=this._compound_statement();return this._updateNode(new rx(i,e),t)}_for_statement(){if(!this._match(ce.keywords.for))return null;this._consume(ce.tokens.paren_left,"Expected '('.");const e=this._updateNode(new oC(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(ce.tokens.semicolon)?null:this._for_init(),this._consume(ce.tokens.semicolon,"Expected ';'."),e.condition=this._check(ce.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(ce.tokens.semicolon,"Expected ';'."),e.increment=this._check(ce.tokens.paren_right)?null:this._for_increment(),this._consume(ce.tokens.paren_right,"Expected ')'."),this._check(ce.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ce.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(ce.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Au(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(ce.keywords.let)){const e=this._currentLine,t=this._consume(ce.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(ce.tokens.colon)){const c=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=c)}this._consume(ce.tokens.equal,"Expected '=' for let.");const o=this._short_circuit_or_expression();return this._updateNode(new Gm(t,i,null,null,o),e)}if(this._match(ce.keywords.const)){const e=this._currentLine,t=this._consume(ce.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(ce.tokens.colon)){const c=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=c)}this._consume(ce.tokens.equal,"Expected '=' for const.");const o=this._short_circuit_or_expression();return i===null&&o instanceof qr&&(i=o.type),this._updateNode(new N_(t,i,null,null,o),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(ce.increment_operators))return this._current=e,null;const i=this._consume(ce.increment_operators,"Expected increment operator");return this._updateNode(new aC(i.type===ce.tokens.plus_plus?cp.increment:cp.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(ce.tokens.brace_right))return null;let i=this._match(ce.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const o=this._consume(ce.assignment_operators,"Expected assignment operator."),c=this._short_circuit_or_expression();return this._updateNode(new lC(Fm.parse(o.lexeme),e,c),t)}_func_call_statement(){if(!this._check(ce.tokens.ident))return null;const e=this._currentLine,t=this._current,i=this._consume(ce.tokens.ident,"Expected function name."),o=this._argument_expression_list();return o===null?(this._current=t,null):this._updateNode(new Db(i.lexeme,o),e)}_loop_statement(){if(!this._match(ce.keywords.loop))return null;this._check(ce.tokens.attr)&&this._attribute(),this._consume(ce.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new cC([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof rx){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(ce.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(ce.keywords.switch))return null;const e=this._updateNode(new uC(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ce.tokens.attr)&&this._attribute(),this._consume(ce.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ce.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([ce.keywords.default,ce.keywords.case]);){if(this._match(ce.keywords.case)){const i=this._case_selectors();for(const c of i)if(c instanceof z_){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(ce.tokens.colon),this._check(ce.tokens.attr)&&this._attribute(),this._consume(ce.tokens.brace_left,"Exected '{' for switch case.");const o=this._case_body();this._consume(ce.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new xC(i,o)))}if(this._match(ce.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(ce.tokens.colon),this._check(ce.tokens.attr)&&this._attribute(),this._consume(ce.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(ce.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new bC(i)))}}return e}_case_selectors(){const e=[];for(this._match(ce.keywords.default)?e.push(this._updateNode(new z_)):e.push(this._shift_expression());this._match(ce.tokens.comma);)this._match(ce.keywords.default)?e.push(this._updateNode(new z_)):e.push(this._shift_expression());return e}_case_body(){if(this._match(ce.keywords.fallthrough))return this._consume(ce.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(ce.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(ce.tokens.attr)&&this._attribute();const i=this._compound_statement();let o=[];this._match_elseif()&&(this._check(ce.tokens.attr)&&this._attribute(),o=this._elseif_statement(o));let c=null;return this._match(ce.keywords.else)&&(this._check(ce.tokens.attr)&&this._attribute(),c=this._compound_statement()),this._updateNode(new hC(t,i,o,c),e)}_match_elseif(){return this._tokens[this._current].type===ce.keywords.else&&this._tokens[this._current+1].type===ce.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new Qz(t,i))),this._match_elseif()&&(this._check(ce.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ce.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new dC(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ce.tokens.or_or);)e=this._updateNode(new Tl(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ce.tokens.and_and);)e=this._updateNode(new Tl(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ce.tokens.or);)e=this._updateNode(new Tl(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ce.tokens.xor);)e=this._updateNode(new Tl(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(ce.tokens.and);)e=this._updateNode(new Tl(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([ce.tokens.equal_equal,ce.tokens.not_equal])?this._updateNode(new Tl(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ce.tokens.less_than,ce.tokens.greater_than,ce.tokens.less_than_equal,ce.tokens.greater_than_equal]);)e=this._updateNode(new Tl(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ce.tokens.shift_left,ce.tokens.shift_right]);)e=this._updateNode(new Tl(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ce.tokens.plus,ce.tokens.minus]);)e=this._updateNode(new Tl(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ce.tokens.star,ce.tokens.forward_slash,ce.tokens.modulo]);)e=this._updateNode(new Tl(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([ce.tokens.minus,ce.tokens.bang,ce.tokens.tilde,ce.tokens.star,ce.tokens.and])?this._updateNode(new Dr(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(ce.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ce.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new wp(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(ce.tokens.period)){const e=this._consume(ce.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new Vd(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return pt.void;case"bool":return pt.bool;case"i32":return pt.i32;case"u32":return pt.u32;case"f32":return pt.f32;case"f16":return pt.f16;case"vec2f":return Xe.vec2f;case"vec3f":return Xe.vec3f;case"vec4f":return Xe.vec4f;case"vec2i":return Xe.vec2i;case"vec3i":return Xe.vec3i;case"vec4i":return Xe.vec4i;case"vec2u":return Xe.vec2u;case"vec3u":return Xe.vec3u;case"vec4u":return Xe.vec4u;case"vec2h":return Xe.vec2h;case"vec3h":return Xe.vec3h;case"vec4h":return Xe.vec4h;case"mat2x2f":return Xe.mat2x2f;case"mat2x3f":return Xe.mat2x3f;case"mat2x4f":return Xe.mat2x4f;case"mat3x2f":return Xe.mat3x2f;case"mat3x3f":return Xe.mat3x3f;case"mat3x4f":return Xe.mat3x4f;case"mat4x2f":return Xe.mat4x2f;case"mat4x3f":return Xe.mat4x3f;case"mat4x4f":return Xe.mat4x4f;case"mat2x2h":return Xe.mat2x2h;case"mat2x3h":return Xe.mat2x3h;case"mat2x4h":return Xe.mat2x4h;case"mat3x2h":return Xe.mat3x2h;case"mat3x3h":return Xe.mat3x3h;case"mat3x4h":return Xe.mat3x4h;case"mat4x2h":return Xe.mat4x2h;case"mat4x3h":return Xe.mat4x3h;case"mat4x4h":return Xe.mat4x4h;case"mat2x2i":return Xe.mat2x2i;case"mat2x3i":return Xe.mat2x3i;case"mat2x4i":return Xe.mat2x4i;case"mat3x2i":return Xe.mat3x2i;case"mat3x3i":return Xe.mat3x3i;case"mat3x4i":return Xe.mat3x4i;case"mat4x2i":return Xe.mat4x2i;case"mat4x3i":return Xe.mat4x3i;case"mat4x4i":return Xe.mat4x4i;case"mat2x2u":return Xe.mat2x2u;case"mat2x3u":return Xe.mat2x3u;case"mat2x4u":return Xe.mat2x4u;case"mat3x2u":return Xe.mat3x2u;case"mat3x3u":return Xe.mat3x3u;case"mat3x4u":return Xe.mat3x4u;case"mat4x2u":return Xe.mat4x2u;case"mat4x3u":return Xe.mat4x3u;case"mat4x4u":return Xe.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(ce.tokens.ident)){const i=this._previous().toString();if(this._check(ce.tokens.paren_left)){const o=this._argument_expression_list(),c=this._getType(i);return c!==null?this._updateNode(new wc(c,o)):this._updateNode(new Lb(i,o))}if(this._context.constants.has(i)){const o=this._context.constants.get(i);return this._updateNode(new gC(i,o.value))}return this._updateNode(new ea(i))}if(this._match(ce.tokens.int_literal)){const i=this._previous().toString();let o=i.endsWith("i")||i.endsWith("i")?pt.i32:i.endsWith("u")||i.endsWith("U")?pt.u32:pt.x32;const c=parseInt(i);return this._validateTypeRange(c,o),this._updateNode(new qr(new We(c,this._exec.getTypeInfo(o)),o))}if(this._match(ce.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,pt.u32),this._updateNode(new qr(new We(i,this._exec.getTypeInfo(pt.u32)),pt.u32))}if(this._match([ce.tokens.decimal_float_literal,ce.tokens.hex_float_literal])){let i=this._previous().toString(),o=i.endsWith("h");o&&(i=i.substring(0,i.length-1));const c=parseFloat(i);this._validateTypeRange(c,o?pt.f16:pt.f32);const d=o?pt.f16:pt.f32;return this._updateNode(new qr(new We(c,this._exec.getTypeInfo(d)),d))}if(this._match([ce.keywords.true,ce.keywords.false])){let i=this._previous().toString()===ce.keywords.true.rule;return this._updateNode(new qr(new We(i?1:0,this._exec.getTypeInfo(pt.bool)),pt.bool))}if(this._check(ce.tokens.paren_left))return this._paren_expression();if(this._match(ce.keywords.bitcast)){this._consume(ce.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(ce.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return this._updateNode(new _C(i,o))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new wc(e,t))}_argument_expression_list(){if(!this._match(ce.tokens.paren_left))return null;const e=[];do{if(this._check(ce.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(ce.tokens.comma));return this._consume(ce.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ce.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ce.tokens.paren_right),e}_paren_expression(){this._consume(ce.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ce.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(ce.keywords.struct))return null;const e=this._currentLine,t=this._consume(ce.tokens.ident,"Expected name for struct.").toString();this._consume(ce.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(ce.tokens.brace_right);){const d=this._attribute(),a=this._consume(ce.tokens.name,"Expected variable name.").toString();this._consume(ce.tokens.colon,"Expected ':' for struct member type.");const v=this._attribute(),A=this._type_decl();A!=null&&(A.attributes=v),this._check(ce.tokens.brace_right)?this._match(ce.tokens.comma):this._consume(ce.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new ST(a,A,d)))}this._consume(ce.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,c=this._updateNode(new Tu(t,i,e,o),e);return this._context.structs.set(t,c),c}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(ce.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof qr){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof qr&&(e.type=e.value.type.name==="x32"?pt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ce.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(ce.keywords.const))return null;const t=this._consume(ce.tokens.name,"Expected variable name"),i=this._currentLine;let o=null;if(this._match(ce.tokens.colon)){const v=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=v)}let c=null;this._consume(ce.tokens.equal,"const declarations require an assignment");const d=this._short_circuit_or_expression();try{let v=[pt.f32],A=d.constEvaluate(this._exec,v);A instanceof We&&this._validateTypeRange(A.value,v[0]),v[0]instanceof Xe&&v[0].format===null&&A.typeInfo instanceof jd&&A.typeInfo.format!==null&&(A.typeInfo.format.name==="f16"?v[0].format=pt.f16:A.typeInfo.format.name==="f32"?v[0].format=pt.f32:A.typeInfo.format.name==="i32"?v[0].format=pt.i32:A.typeInfo.format.name==="u32"?v[0].format=pt.u32:A.typeInfo.format.name==="bool"?v[0].format=pt.bool:console.error(`TODO: impelement template format type ${A.typeInfo.format.name}`)),c=this._updateNode(new qr(A,v[0])),this._exec.context.setVariable(t.toString(),A)}catch{c=d}if(o!==null&&c instanceof qr){if(c.type.name!=="x32"&&o.getTypeName()!==c.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${c.type.name} to ${o.name}. Line:${this._currentLine}`);c.type=o,c.isScalar&&this._validateTypeRange(c.scalarValue,c.type)}else o===null&&c instanceof qr&&(o=(e=c?.type)!==null&&e!==void 0?e:pt.f32,o===pt.x32&&(o=pt.i32));const a=this._updateNode(new N_(t.toString(),o,"","",c),i);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(ce.keywords.let))return null;const e=this._currentLine,t=this._consume(ce.tokens.name,"Expected variable name");let i=null;if(this._match(ce.tokens.colon)){const c=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=c)}let o=null;if(this._match(ce.tokens.equal)&&(o=this._const_expression()),i!==null&&o instanceof qr){if(o.type.name!=="x32"&&i.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${i.name}. Line:${this._currentLine}`);o.type=i}else i===null&&o instanceof qr&&(i=o.type.name==="x32"?pt.i32:o.type);return o instanceof qr&&o.isScalar&&this._validateTypeRange(o.scalarValue,i),this._updateNode(new Gm(t.toString(),i,"","",o),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ce.keywords.var))return null;const e=this._currentLine;let t="",i="";this._match(ce.tokens.less_than)&&(t=this._consume(ce.storage_class,"Expected storage_class.").toString(),this._match(ce.tokens.comma)&&(i=this._consume(ce.access_mode,"Expected access_mode.").toString()),this._consume(ce.tokens.greater_than,"Expected '>'."));const o=this._consume(ce.tokens.name,"Expected variable name");let c=null;if(this._match(ce.tokens.colon)){const d=this._attribute();c=this._type_decl(),c!=null&&(c.attributes=d)}return this._updateNode(new Au(o.toString(),c,t,i,null),e)}_override_decl(){if(!this._match(ce.keywords.override))return null;const e=this._consume(ce.tokens.name,"Expected variable name");let t=null;if(this._match(ce.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new kb(e.toString(),t,null))}_diagnostic(){this._consume(ce.tokens.paren_left,"Expected '('");const e=this._consume(ce.tokens.ident,"Expected severity control name.");this._consume(ce.tokens.comma,"Expected ','");let t=this._consume(ce.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(ce.tokens.period)&&(t+=`.${this._consume(ce.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(ce.tokens.paren_right,"Expected ')'"),this._updateNode(new fC(e.toString(),t))}_enable_directive(){const e=this._consume(ce.tokens.ident,"identity expected.");return this._updateNode(new Yz(e.toString()))}_requires_directive(){const e=[this._consume(ce.tokens.ident,"identity expected.").toString()];for(;this._match(ce.tokens.comma);){const t=this._consume(ce.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new Kz(e))}_type_alias(){const e=this._consume(ce.tokens.ident,"identity expected.");this._consume(ce.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const i=this._updateNode(new Ob(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([ce.tokens.ident,...ce.texel_format,ce.keywords.bool,ce.keywords.f32,ce.keywords.i32,ce.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const o=this._updateNode(new wT(i));return this._forwardTypeCount++,o}return this._updateNode(new pt(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(ce.template_types)){let i=this._advance().toString(),o=null,c=null;return this._match(ce.tokens.less_than)&&(o=this._type_decl(),c=null,this._match(ce.tokens.comma)&&(c=this._consume(ce.access_mode,"Expected access_mode for pointer").toString()),this._consume(ce.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Xe(i,o,c))}if(this._match(ce.keywords.ptr)){let i=this._previous().toString();this._consume(ce.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(ce.storage_class,"Expected storage_class for pointer");this._consume(ce.tokens.comma,"Expected ',' for pointer.");const c=this._type_decl();let d=null;return this._match(ce.tokens.comma)&&(d=this._consume(ce.access_mode,"Expected access_mode for pointer").toString()),this._consume(ce.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new B_(i,o.toString(),c,d))}const t=this._attribute();if(this._match(ce.keywords.array)){let i=null,o=-1;const c=this._previous();let d=null;if(this._match(ce.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let v="";if(this._match(ce.tokens.comma)){d=this._shift_expression();try{v=d.constEvaluate(this._exec).toString(),d=null}catch{v="1"}}this._consume(ce.tokens.greater_than,"Expected '>' for array."),o=v?parseInt(v):0}const a=this._updateNode(new Ym(c.toString(),t,i,o));return d&&this._deferArrayCountEval.push({arrayType:a,countNode:d}),a}return null}_texture_sampler_types(){if(this._match(ce.sampler_type))return this._updateNode(new Nm(this._previous().toString(),null,null));if(this._match(ce.depth_texture_type))return this._updateNode(new Nm(this._previous().toString(),null,null));if(this._match(ce.sampled_texture_type)||this._match(ce.multisampled_texture_type)){const e=this._previous();this._consume(ce.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(ce.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Nm(e.toString(),t,null))}if(this._match(ce.storage_texture_type)){const e=this._previous();this._consume(ce.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(ce.texel_format,"Invalid texel format.").toString();this._consume(ce.tokens.comma,"Expected ',' after texel format.");const i=this._consume(ce.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ce.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Nm(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(ce.tokens.attr);){const t=this._consume(ce.attribute_name,"Expected attribute name"),i=this._updateNode(new wC(t.toString(),null));if(this._match(ce.tokens.paren_left)){if(i.value=this._consume(ce.literal_or_ident,"Expected attribute value").toString(),this._check(ce.tokens.comma)){this._advance();do{const o=this._consume(ce.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(o)}while(this._match(ce.tokens.comma))}this._consume(ce.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class f6 extends Ac{constructor(e){super(),e&&this.update(e)}update(e){const t=new d6().parse(e);this.updateAST(t)}}function p6(n){const e={attributes:[],bindings:[]};let t;try{t=m6(n)}catch(c){return Dt.error(c.message)(),e}for(const c of t.uniforms){const d=[];for(const a of c.type?.members||[])d.push({name:a.name,type:PT(a.type)});e.bindings.push({type:"uniform",name:c.name,group:c.group,location:c.binding,members:d})}for(const c of t.textures)e.bindings.push({type:"texture",name:c.name,group:c.group,location:c.binding});for(const c of t.samplers)e.bindings.push({type:"sampler",name:c.name,group:c.group,location:c.binding});const i=t.entry.vertex[0],o=i?.inputs.length||0;for(let c=0;c<o;c++){const d=i.inputs[c];if(d.locationType==="location"){const a=PT(d.type);e.attributes.push({name:d.name,location:Number(d.location),type:a})}}return e}function PT(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function m6(n){try{return new f6(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const g6={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...g6}};const ka=globalThis.mathgl.config;function _6(n,{precision:e=ka.precision}={}){return n=y6(n),`${parseFloat(n.toPrecision(e))}`}function Tp(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function bh(n,e,t){return x6(n,i=>Math.max(e,Math.min(t,i)))}function ug(n,e,t){return Tp(n)?n.map((i,o)=>ug(i,e[o],t)):t*e+(1-t)*n}function hg(n,e,t){const i=ka.EPSILON;try{if(n===e)return!0;if(Tp(n)&&Tp(e)){if(n.length!==e.length)return!1;for(let o=0;o<n.length;++o)if(!hg(n[o],e[o]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=ka.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{ka.EPSILON=i}}function y6(n){return Math.round(n/ka.EPSILON)*ka.EPSILON}function v6(n){return n.clone?n.clone():new Array(n.length)}function x6(n,e,t){if(Tp(n)){const i=n;t=t||v6(i);for(let o=0;o<t.length&&o<i.length;++o){const c=typeof n=="number"?n:n[o];t[o]=e(c,o,t)}return t}return e(n)}class TC extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Tp(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ka)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+_6(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!hg(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let o=0;o<this.ELEMENTS;++o){const c=e[o],d=typeof t=="number"?t:t[o];this[o]=c+i*(d-c)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ka.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function b6(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Qo(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function t0(n,e,t=""){if(ka.debug&&!b6(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function CT(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class w6 extends TC{get x(){return this[0]}set x(e){this[0]=Qo(e)}get y(){return this[1]}set y(e){this[1]=Qo(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const o=this[i]-e[i];t+=o*o}return Qo(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return Qo(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return CT(e>=0&&e<this.ELEMENTS,"index is out of range"),Qo(this[e])}setComponent(e,t){return CT(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const U_=1e-6;let Sp=typeof Float32Array<"u"?Float32Array:Array;function T6(){const n=new Sp(2);return Sp!=Float32Array&&(n[0]=0,n[1]=0),n}function ox(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function S6(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function A6(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function E6(n){const e=n[0],t=n[1];return Math.sqrt(e*e+t*t)}function P6(n,e){return n[0]=-e[0],n[1]=-e[1],n}function SC(n,e,t,i){const o=e[0],c=e[1];return n[0]=o+i*(t[0]-o),n[1]=c+i*(t[1]-c),n}function C6(n,e,t){const i=e[0],o=e[1];return n[0]=t[0]*i+t[4]*o+t[12],n[1]=t[1]*i+t[5]*o+t[13],n}const I6=S6;(function(){const n=T6();return function(e,t,i,o,c,d){let a,v;for(t||(t=2),i||(i=0),o?v=Math.min(o*t+i,e.length):v=e.length,a=i;a<v;a+=t)n[0]=e[a],n[1]=e[a+1],c(n,n,d),e[a]=n[0],e[a+1]=n[1];return e}})();function M6(n,e,t){const i=e[0],o=e[1],c=t[3]*i+t[7]*o||1;return n[0]=(t[0]*i+t[4]*o)/c,n[1]=(t[1]*i+t[5]*o)/c,n}function AC(n,e,t){const i=e[0],o=e[1],c=e[2],d=t[3]*i+t[7]*o+t[11]*c||1;return n[0]=(t[0]*i+t[4]*o+t[8]*c)/d,n[1]=(t[1]*i+t[5]*o+t[9]*c)/d,n[2]=(t[2]*i+t[6]*o+t[10]*c)/d,n}function R6(n,e,t){const i=e[0],o=e[1];return n[0]=t[0]*i+t[2]*o,n[1]=t[1]*i+t[3]*o,n[2]=e[2],n}function k6(){const n=new Sp(3);return Sp!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function D6(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function O6(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function L6(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function F6(n,e,t){const i=e[0],o=e[1],c=e[2],d=t[0],a=t[1],v=t[2];return n[0]=o*v-c*a,n[1]=c*d-i*v,n[2]=i*a-o*d,n}function EC(n,e,t){const i=e[0],o=e[1],c=e[2];let d=t[3]*i+t[7]*o+t[11]*c+t[15];return d=d||1,n[0]=(t[0]*i+t[4]*o+t[8]*c+t[12])/d,n[1]=(t[1]*i+t[5]*o+t[9]*c+t[13])/d,n[2]=(t[2]*i+t[6]*o+t[10]*c+t[14])/d,n}function N6(n,e,t){const i=e[0],o=e[1],c=e[2];return n[0]=i*t[0]+o*t[3]+c*t[6],n[1]=i*t[1]+o*t[4]+c*t[7],n[2]=i*t[2]+o*t[5]+c*t[8],n}function B6(n,e,t){const i=t[0],o=t[1],c=t[2],d=t[3],a=e[0],v=e[1],A=e[2];let E=o*A-c*v,k=c*a-i*A,L=i*v-o*a,z=o*L-c*k,q=c*E-i*L,Y=i*k-o*E;const ne=d*2;return E*=ne,k*=ne,L*=ne,z*=2,q*=2,Y*=2,n[0]=a+E+z,n[1]=v+k+q,n[2]=A+L+Y,n}function z6(n,e,t,i){const o=[],c=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],c[0]=o[0],c[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),c[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),n[0]=c[0]+t[0],n[1]=c[1]+t[1],n[2]=c[2]+t[2],n}function U6(n,e,t,i){const o=[],c=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],c[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),c[1]=o[1],c[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),n[0]=c[0]+t[0],n[1]=c[1]+t[1],n[2]=c[2]+t[2],n}function j6(n,e,t,i){const o=[],c=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],c[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),c[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),c[2]=o[2],n[0]=c[0]+t[0],n[1]=c[1]+t[1],n[2]=c[2]+t[2],n}function V6(n,e){const t=n[0],i=n[1],o=n[2],c=e[0],d=e[1],a=e[2],v=Math.sqrt((t*t+i*i+o*o)*(c*c+d*d+a*a)),A=v&&L6(n,e)/v;return Math.acos(Math.min(Math.max(A,-1),1))}const $6=D6;(function(){const n=k6();return function(e,t,i,o,c,d){let a,v;for(t||(t=3),i||(i=0),o?v=Math.min(o*t+i,e.length):v=e.length,a=i;a<v;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],c(n,n,d),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}})();const n0=[0,0,0];let g_;class Cc extends w6{static get ZERO(){return g_||(g_=new Cc(0,0,0),Object.freeze(g_)),g_}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&Tp(e)?this.copy(e):(ka.debug&&(Qo(e),Qo(t),Qo(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ka.debug&&(Qo(e.x),Qo(e.y),Qo(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Qo(e)}angle(e){return V6(this,e)}cross(e){return F6(this,this,e),this.check()}rotateX({radians:e,origin:t=n0}){return z6(this,this,t,e),this.check()}rotateY({radians:e,origin:t=n0}){return U6(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=n0}){return j6(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return EC(this,this,e),this.check()}transformAsVector(e){return AC(this,this,e),this.check()}transformByMatrix3(e){return N6(this,this,e),this.check()}transformByMatrix2(e){return R6(this,this,e),this.check()}transformByQuaternion(e){return B6(this,this,e),this.check()}}class W6 extends TC{toString(){let e="[";if(ka.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=Qo(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let o=0;o<this.RANK;++o)t[o]=this[i+o];return t}setColumn(e,t){const i=e*this.RANK;for(let o=0;o<this.RANK;++o)this[i+o]=t[o];return this}}function H6(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Z6(n,e){if(n===e){const t=e[1],i=e[2],o=e[3],c=e[6],d=e[7],a=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=c,n[11]=e[14],n[12]=o,n[13]=d,n[14]=a}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function ax(n,e){const t=e[0],i=e[1],o=e[2],c=e[3],d=e[4],a=e[5],v=e[6],A=e[7],E=e[8],k=e[9],L=e[10],z=e[11],q=e[12],Y=e[13],ne=e[14],ue=e[15],ve=t*a-i*d,se=t*v-o*d,Se=t*A-c*d,Ne=i*v-o*a,nt=i*A-c*a,dt=o*A-c*v,gt=E*Y-k*q,vt=E*ne-L*q,Ft=E*ue-z*q,Wt=k*ne-L*Y,pn=k*ue-z*Y,sn=L*ue-z*ne;let rn=ve*sn-se*pn+Se*Wt+Ne*Ft-nt*vt+dt*gt;return rn?(rn=1/rn,n[0]=(a*sn-v*pn+A*Wt)*rn,n[1]=(o*pn-i*sn-c*Wt)*rn,n[2]=(Y*dt-ne*nt+ue*Ne)*rn,n[3]=(L*nt-k*dt-z*Ne)*rn,n[4]=(v*Ft-d*sn-A*vt)*rn,n[5]=(t*sn-o*Ft+c*vt)*rn,n[6]=(ne*Se-q*dt-ue*se)*rn,n[7]=(E*dt-L*Se+z*se)*rn,n[8]=(d*pn-a*Ft+A*gt)*rn,n[9]=(i*Ft-t*pn-c*gt)*rn,n[10]=(q*nt-Y*Se+ue*ve)*rn,n[11]=(k*Se-E*nt-z*ve)*rn,n[12]=(a*vt-d*Wt-v*gt)*rn,n[13]=(t*Wt-i*vt+o*gt)*rn,n[14]=(Y*se-q*Ne-ne*ve)*rn,n[15]=(E*Ne-k*se+L*ve)*rn,n):null}function X6(n){const e=n[0],t=n[1],i=n[2],o=n[3],c=n[4],d=n[5],a=n[6],v=n[7],A=n[8],E=n[9],k=n[10],L=n[11],z=n[12],q=n[13],Y=n[14],ne=n[15],ue=e*d-t*c,ve=e*a-i*c,se=t*a-i*d,Se=A*q-E*z,Ne=A*Y-k*z,nt=E*Y-k*q,dt=e*nt-t*Ne+i*Se,gt=c*nt-d*Ne+a*Se,vt=A*se-E*ve+k*ue,Ft=z*se-q*ve+Y*ue;return v*dt-o*gt+ne*vt-L*Ft}function Bd(n,e,t){const i=e[0],o=e[1],c=e[2],d=e[3],a=e[4],v=e[5],A=e[6],E=e[7],k=e[8],L=e[9],z=e[10],q=e[11],Y=e[12],ne=e[13],ue=e[14],ve=e[15];let se=t[0],Se=t[1],Ne=t[2],nt=t[3];return n[0]=se*i+Se*a+Ne*k+nt*Y,n[1]=se*o+Se*v+Ne*L+nt*ne,n[2]=se*c+Se*A+Ne*z+nt*ue,n[3]=se*d+Se*E+Ne*q+nt*ve,se=t[4],Se=t[5],Ne=t[6],nt=t[7],n[4]=se*i+Se*a+Ne*k+nt*Y,n[5]=se*o+Se*v+Ne*L+nt*ne,n[6]=se*c+Se*A+Ne*z+nt*ue,n[7]=se*d+Se*E+Ne*q+nt*ve,se=t[8],Se=t[9],Ne=t[10],nt=t[11],n[8]=se*i+Se*a+Ne*k+nt*Y,n[9]=se*o+Se*v+Ne*L+nt*ne,n[10]=se*c+Se*A+Ne*z+nt*ue,n[11]=se*d+Se*E+Ne*q+nt*ve,se=t[12],Se=t[13],Ne=t[14],nt=t[15],n[12]=se*i+Se*a+Ne*k+nt*Y,n[13]=se*o+Se*v+Ne*L+nt*ne,n[14]=se*c+Se*A+Ne*z+nt*ue,n[15]=se*d+Se*E+Ne*q+nt*ve,n}function hy(n,e,t){const i=t[0],o=t[1],c=t[2];let d,a,v,A,E,k,L,z,q,Y,ne,ue;return e===n?(n[12]=e[0]*i+e[4]*o+e[8]*c+e[12],n[13]=e[1]*i+e[5]*o+e[9]*c+e[13],n[14]=e[2]*i+e[6]*o+e[10]*c+e[14],n[15]=e[3]*i+e[7]*o+e[11]*c+e[15]):(d=e[0],a=e[1],v=e[2],A=e[3],E=e[4],k=e[5],L=e[6],z=e[7],q=e[8],Y=e[9],ne=e[10],ue=e[11],n[0]=d,n[1]=a,n[2]=v,n[3]=A,n[4]=E,n[5]=k,n[6]=L,n[7]=z,n[8]=q,n[9]=Y,n[10]=ne,n[11]=ue,n[12]=d*i+E*o+q*c+e[12],n[13]=a*i+k*o+Y*c+e[13],n[14]=v*i+L*o+ne*c+e[14],n[15]=A*i+z*o+ue*c+e[15]),n}function Ub(n,e,t){const i=t[0],o=t[1],c=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*o,n[5]=e[5]*o,n[6]=e[6]*o,n[7]=e[7]*o,n[8]=e[8]*c,n[9]=e[9]*c,n[10]=e[10]*c,n[11]=e[11]*c,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function q6(n,e,t,i){let o=i[0],c=i[1],d=i[2],a=Math.sqrt(o*o+c*c+d*d),v,A,E,k,L,z,q,Y,ne,ue,ve,se,Se,Ne,nt,dt,gt,vt,Ft,Wt,pn,sn,rn,kn;return a<U_?null:(a=1/a,o*=a,c*=a,d*=a,A=Math.sin(t),v=Math.cos(t),E=1-v,k=e[0],L=e[1],z=e[2],q=e[3],Y=e[4],ne=e[5],ue=e[6],ve=e[7],se=e[8],Se=e[9],Ne=e[10],nt=e[11],dt=o*o*E+v,gt=c*o*E+d*A,vt=d*o*E-c*A,Ft=o*c*E-d*A,Wt=c*c*E+v,pn=d*c*E+o*A,sn=o*d*E+c*A,rn=c*d*E-o*A,kn=d*d*E+v,n[0]=k*dt+Y*gt+se*vt,n[1]=L*dt+ne*gt+Se*vt,n[2]=z*dt+ue*gt+Ne*vt,n[3]=q*dt+ve*gt+nt*vt,n[4]=k*Ft+Y*Wt+se*pn,n[5]=L*Ft+ne*Wt+Se*pn,n[6]=z*Ft+ue*Wt+Ne*pn,n[7]=q*Ft+ve*Wt+nt*pn,n[8]=k*sn+Y*rn+se*kn,n[9]=L*sn+ne*rn+Se*kn,n[10]=z*sn+ue*rn+Ne*kn,n[11]=q*sn+ve*rn+nt*kn,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function PC(n,e,t){const i=Math.sin(t),o=Math.cos(t),c=e[4],d=e[5],a=e[6],v=e[7],A=e[8],E=e[9],k=e[10],L=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=c*o+A*i,n[5]=d*o+E*i,n[6]=a*o+k*i,n[7]=v*o+L*i,n[8]=A*o-c*i,n[9]=E*o-d*i,n[10]=k*o-a*i,n[11]=L*o-v*i,n}function G6(n,e,t){const i=Math.sin(t),o=Math.cos(t),c=e[0],d=e[1],a=e[2],v=e[3],A=e[8],E=e[9],k=e[10],L=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=c*o-A*i,n[1]=d*o-E*i,n[2]=a*o-k*i,n[3]=v*o-L*i,n[8]=c*i+A*o,n[9]=d*i+E*o,n[10]=a*i+k*o,n[11]=v*i+L*o,n}function CC(n,e,t){const i=Math.sin(t),o=Math.cos(t),c=e[0],d=e[1],a=e[2],v=e[3],A=e[4],E=e[5],k=e[6],L=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=c*o+A*i,n[1]=d*o+E*i,n[2]=a*o+k*i,n[3]=v*o+L*i,n[4]=A*o-c*i,n[5]=E*o-d*i,n[6]=k*o-a*i,n[7]=L*o-v*i,n}function Y6(n,e){const t=e[0],i=e[1],o=e[2],c=e[3],d=t+t,a=i+i,v=o+o,A=t*d,E=i*d,k=i*a,L=o*d,z=o*a,q=o*v,Y=c*d,ne=c*a,ue=c*v;return n[0]=1-k-q,n[1]=E+ue,n[2]=L-ne,n[3]=0,n[4]=E-ue,n[5]=1-A-q,n[6]=z+Y,n[7]=0,n[8]=L+ne,n[9]=z-Y,n[10]=1-A-k,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function K6(n,e,t,i,o,c,d){const a=1/(t-e),v=1/(o-i),A=1/(c-d);return n[0]=c*2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c*2*v,n[6]=0,n[7]=0,n[8]=(t+e)*a,n[9]=(o+i)*v,n[10]=(d+c)*A,n[11]=-1,n[12]=0,n[13]=0,n[14]=d*c*2*A,n[15]=0,n}function J6(n,e,t,i,o){const c=1/Math.tan(e/2);if(n[0]=c/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,o!=null&&o!==1/0){const d=1/(i-o);n[10]=(o+i)*d,n[14]=2*o*i*d}else n[10]=-1,n[14]=-2*i;return n}const Q6=J6;function e5(n,e,t,i,o,c,d){const a=1/(e-t),v=1/(i-o),A=1/(c-d);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*A,n[11]=0,n[12]=(e+t)*a,n[13]=(o+i)*v,n[14]=(d+c)*A,n[15]=1,n}const t5=e5;function n5(n,e,t,i){let o,c,d,a,v,A,E,k,L,z;const q=e[0],Y=e[1],ne=e[2],ue=i[0],ve=i[1],se=i[2],Se=t[0],Ne=t[1],nt=t[2];return Math.abs(q-Se)<U_&&Math.abs(Y-Ne)<U_&&Math.abs(ne-nt)<U_?H6(n):(k=q-Se,L=Y-Ne,z=ne-nt,o=1/Math.sqrt(k*k+L*L+z*z),k*=o,L*=o,z*=o,c=ve*z-se*L,d=se*k-ue*z,a=ue*L-ve*k,o=Math.sqrt(c*c+d*d+a*a),o?(o=1/o,c*=o,d*=o,a*=o):(c=0,d=0,a=0),v=L*a-z*d,A=z*c-k*a,E=k*d-L*c,o=Math.sqrt(v*v+A*A+E*E),o?(o=1/o,v*=o,A*=o,E*=o):(v=0,A=0,E=0),n[0]=c,n[1]=v,n[2]=k,n[3]=0,n[4]=d,n[5]=A,n[6]=L,n[7]=0,n[8]=a,n[9]=E,n[10]=z,n[11]=0,n[12]=-(c*q+d*Y+a*ne),n[13]=-(v*q+A*Y+E*ne),n[14]=-(k*q+L*Y+z*ne),n[15]=1,n)}function i5(){const n=new Sp(4);return Sp!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function r5(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function Tg(n,e,t){const i=e[0],o=e[1],c=e[2],d=e[3];return n[0]=t[0]*i+t[4]*o+t[8]*c+t[12]*d,n[1]=t[1]*i+t[5]*o+t[9]*c+t[13]*d,n[2]=t[2]*i+t[6]*o+t[10]*c+t[14]*d,n[3]=t[3]*i+t[7]*o+t[11]*c+t[15]*d,n}(function(){const n=i5();return function(e,t,i,o,c,d){let a,v;for(t||(t=4),i||(i=0),o?v=Math.min(o*t+i,e.length):v=e.length,a=i;a<v;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],n[3]=e[a+3],c(n,n,d),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2],e[a+3]=n[3];return e}})();var lx;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(lx||(lx={}));const s5=45*Math.PI/180,o5=1,i0=.1,r0=500,a5=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ic extends W6{static get IDENTITY(){return c5()}static get ZERO(){return l5()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return lx}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,o,c,d,a,v,A,E,k,L,z,q,Y,ne){return this[0]=e,this[1]=t,this[2]=i,this[3]=o,this[4]=c,this[5]=d,this[6]=a,this[7]=v,this[8]=A,this[9]=E,this[10]=k,this[11]=L,this[12]=z,this[13]=q,this[14]=Y,this[15]=ne,this.check()}setRowMajor(e,t,i,o,c,d,a,v,A,E,k,L,z,q,Y,ne){return this[0]=e,this[1]=c,this[2]=A,this[3]=z,this[4]=t,this[5]=d,this[6]=E,this[7]=q,this[8]=i,this[9]=a,this[10]=k,this[11]=Y,this[12]=o,this[13]=v,this[14]=L,this[15]=ne,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(a5)}fromObject(e){return this.check()}fromQuaternion(e){return Y6(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:o,top:c,near:d=i0,far:a=r0}=e;return a===1/0?u5(this,t,i,o,c,d):K6(this,t,i,o,c,d,a),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:o=[0,1,0]}=e;return n5(this,t,i,o),this.check()}ortho(e){const{left:t,right:i,bottom:o,top:c,near:d=i0,far:a=r0}=e;return t5(this,t,i,o,c,d,a),this.check()}orthographic(e){const{fovy:t=s5,aspect:i=o5,focalDistance:o=1,near:c=i0,far:d=r0}=e;IT(t);const a=t/2,v=o*Math.tan(a),A=v*i;return this.ortho({left:-A,right:A,bottom:-v,top:v,near:c,far:d})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:o=.1,far:c=500}=e;return IT(t),Q6(this,t,i,o,c),this.check()}determinant(){return X6(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),o=1/i[0],c=1/i[1],d=1/i[2];return e[0]=this[0]*o,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*c,e[6]=this[6]*d,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*c,e[10]=this[10]*d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),o=1/i[0],c=1/i[1],d=1/i[2];return e[0]=this[0]*o,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=this[4]*o,e[4]=this[5]*c,e[5]=this[6]*d,e[6]=this[8]*o,e[7]=this[9]*c,e[8]=this[10]*d,e}transpose(){return Z6(this,this),this.check()}invert(){return ax(this,this),this.check()}multiplyLeft(e){return Bd(this,e,this),this.check()}multiplyRight(e){return Bd(this,this,e),this.check()}rotateX(e){return PC(this,this,e),this.check()}rotateY(e){return G6(this,this,e),this.check()}rotateZ(e){return CC(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return q6(this,this,e,t),this.check()}scale(e){return Ub(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return hy(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Tg(t||[-0,-0,-0,-0],e,this),t0(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let o;switch(i){case 2:o=C6(t||[-0,-0],e,this);break;case 3:o=EC(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return t0(o,e.length),o}transformAsVector(e,t){let i;switch(e.length){case 2:i=M6(t||[-0,-0],e,this);break;case 3:i=AC(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return t0(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let __,y_;function l5(){return __||(__=new Ic([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(__)),__}function c5(){return y_||(y_=new Ic,Object.freeze(y_)),y_}function IT(n){if(n>Math.PI*2)throw Error("expected radians")}function u5(n,e,t,i,o,c){const d=2*c/(t-e),a=2*c/(o-i),v=(t+e)/(t-e),A=(o+i)/(o-i),E=-1,k=-1,L=-2*c;return n[0]=d,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=v,n[9]=A,n[10]=E,n[11]=k,n[12]=0,n[13]=0,n[14]=L,n[15]=0,n}function IC(n,e=[],t=0){const i=Math.fround(n),o=n-i;return e[t]=i,e[t+1]=o,e}function h5(n){return n-Math.fround(n)}function d5(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){const o=t*4+i;IC(n[i*4+t],e,o*2)}return e}const f5=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,p5={name:"fp32",vs:f5},m5=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,g5={ONE:1},_5={name:"fp64arithmetic",vs:m5,defaultUniforms:g5,uniformTypes:{ONE:"f32"},fp64ify:IC,fp64LowPart:h5,fp64ifyMatrix4:d5},y5=[0,1,1,1],v5=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,x5=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,MT={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:y5},vs:v5,fs:x5,getUniforms:b5};function b5(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,o=>o/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const RT=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,w5=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,MC=3,T5=255;var dg;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(dg||(dg={}));const j_={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:MC},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:dg.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:w5,vs:RT,fs:RT,getUniforms:S5};function S5(n,e={}){if(n=n&&{...n},!n)return{...j_.defaultUniforms};n.lights&&(n={...n,...E5(n.lights),lights:void 0});const{ambientLight:t,pointLights:i,directionalLights:o}=n||{};if(!(t||i&&i.length>0||o&&o.length>0))return{...j_.defaultUniforms,enabled:0};const d={...j_.defaultUniforms,...e,...A5({ambientLight:t,pointLights:i,directionalLights:o})};return n.enabled!==void 0&&(d.enabled=n.enabled?1:0),d}function A5({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const i={};i.ambientLightColor=s0(n);let o=0;for(const c of e){i.lightType=dg.POINT;const d=o;i[`lightColor${d}`]=s0(c),i[`lightPosition${d}`]=c.position,i[`lightAttenuation${d}`]=c.attenuation||[1,0,0],o++}for(const c of t){i.lightType=dg.DIRECTIONAL;const d=o;i[`lightColor${d}`]=s0(c),i[`lightDirection${d}`]=c.direction,o++}return o>MC&&Dt.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=t.length,i.pointLightCount=e.length,i}function E5(n){const e={pointLights:[],directionalLights:[]};for(const t of n||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break}return e}function s0(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(i=>i*t/T5)}const P5=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,C5=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,I5=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,RC={props:{},name:"gouraudMaterial",vs:C5.replace("phongMaterial","gouraudMaterial"),fs:P5.replace("phongMaterial","gouraudMaterial"),source:I5.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[j_],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...RC.defaultUniforms,...e}}},kT=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,M5={name:"layer",vs:kT,fs:kT,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},R5=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,kC="#define SMOOTH_EDGE_RADIUS 0.5",k5=`${kC}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,D5=`${kC}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,DC={name:"geometry",source:R5,vs:k5,fs:D5},O5=25;var Lr;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(Lr||(Lr={}));var Gr;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Gr||(Gr={}));var Fn;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Fn||(Fn={}));const L5="compute",F5="auto",cx="manipulation",V_="none",ux="pan-x",hx="pan-y";function N5(n){if(n.includes(V_))return V_;const e=n.includes(ux),t=n.includes(hx);return e&&t?V_:e||t?e?ux:hx:n.includes(cx)?cx:F5}class B5{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===L5&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return N5(e.join(" "))}}function dy(n){return n.trim().split(/\s+/g)}function o0(n,e,t){if(n)for(const i of dy(e))n.addEventListener(i,t,!1)}function a0(n,e,t){if(n)for(const i of dy(e))n.removeEventListener(i,t,!1)}function DT(n){return(n.ownerDocument||n).defaultView}function z5(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function OC(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,i=0,o=0;for(;o<e;)t+=n[o].clientX,i+=n[o].clientY,o++;return{x:Math.round(t/e),y:Math.round(i/e)}}function OT(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:OC(e),deltaX:n.deltaX,deltaY:n.deltaY}}function LC(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.sqrt(t*t+i*i)}function LT(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(t*t+i*i)}function U5(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.atan2(i,t)*180/Math.PI}function FT(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.atan2(i,t)*180/Math.PI}function FC(n,e){return n===e?Gr.None:Math.abs(n)>=Math.abs(e)?n<0?Gr.Left:Gr.Right:e<0?Gr.Up:Gr.Down}function j5(n,e){const t=e.center;let i=n.offsetDelta,o=n.prevDelta;const c=n.prevInput;return(e.eventType===Lr.Start||c?.eventType===Lr.End)&&(o=n.prevDelta={x:c?.deltaX||0,y:c?.deltaY||0},i=n.offsetDelta={x:t.x,y:t.y}),{deltaX:o.x+(t.x-i.x),deltaY:o.y+(t.y-i.y)}}function NC(n,e,t){return{x:e/n||0,y:t/n||0}}function V5(n,e){return LT(e[0],e[1])/LT(n[0],n[1])}function $5(n,e){return FT(e[1],e[0])-FT(n[1],n[0])}function W5(n,e){const t=n.lastInterval||e,i=e.timeStamp-t.timeStamp;let o,c,d,a;if(e.eventType!==Lr.Cancel&&(i>O5||t.velocity===void 0)){const v=e.deltaX-t.deltaX,A=e.deltaY-t.deltaY,E=NC(i,v,A);c=E.x,d=E.y,o=Math.abs(E.x)>Math.abs(E.y)?E.x:E.y,a=FC(v,A),n.lastInterval=e}else o=t.velocity,c=t.velocityX,d=t.velocityY,a=t.direction;e.velocity=o,e.velocityX=c,e.velocityY=d,e.direction=a}function H5(n,e){const{session:t}=n,{pointers:i}=e,{length:o}=i;t.firstInput||(t.firstInput=OT(e)),o>1&&!t.firstMultiple?t.firstMultiple=OT(e):o===1&&(t.firstMultiple=!1);const{firstInput:c,firstMultiple:d}=t,a=d?d.center:c.center,v=e.center=OC(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-c.timeStamp,e.angle=U5(a,v),e.distance=LC(a,v);const{deltaX:A,deltaY:E}=j5(t,e);e.deltaX=A,e.deltaY=E,e.offsetDirection=FC(e.deltaX,e.deltaY);const k=NC(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=k.x,e.overallVelocityY=k.y,e.overallVelocity=Math.abs(k.x)>Math.abs(k.y)?k.x:k.y,e.scale=d?V5(d.pointers,i):1,e.rotation=d?$5(d.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let L=n.element;return z5(e.srcEvent.target,L)&&(L=e.srcEvent.target),e.target=L,W5(t,e),e}function Z5(n,e,t){const i=t.pointers.length,o=t.changedPointers.length,c=e&Lr.Start&&i-o===0,d=e&(Lr.End|Lr.Cancel)&&i-o===0;t.isFirst=!!c,t.isFinal=!!d,c&&(n.session={}),t.eventType=e;const a=H5(n,t);n.emit("hammer.input",a),n.recognize(a),n.session.prevInput=a}let X5=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){Z5(this.manager,e,t)}init(){o0(this.element,this.evEl,this.domHandler),o0(this.target,this.evTarget,this.domHandler),o0(DT(this.element),this.evWin,this.domHandler)}destroy(){a0(this.element,this.evEl,this.domHandler),a0(this.target,this.evTarget,this.domHandler),a0(DT(this.element),this.evWin,this.domHandler)}};const q5={pointerdown:Lr.Start,pointermove:Lr.Move,pointerup:Lr.End,pointercancel:Lr.Cancel,pointerout:Lr.Cancel},G5="pointerdown",Y5="pointermove pointerup pointercancel";class K5 extends X5{constructor(e){super(e),this.evEl=G5,this.evWin=Y5,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let i=!1;const o=q5[e.type],c=e.pointerType,d=c==="touch";let a=t.findIndex(v=>v.pointerId===e.pointerId);o&Lr.Start&&(e.buttons||d)?a<0&&(t.push(e),a=t.length-1):o&(Lr.End|Lr.Cancel)&&(i=!0),!(a<0)&&(t[a]=e,this.callback(o,{pointers:t,changedPointers:[e],eventType:o,pointerType:c,srcEvent:e}),i&&t.splice(a,1))}}const J5=["","webkit","Moz","MS","ms","o"];function Q5(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const i of J5){const o=i?i+t:e;if(o in n)return o}}const eU=1,NT=2,BT={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class tU{constructor(e,t){this.options={...BT,...t,cssProps:{...BT.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new K5(this),this.touchAction=new B5(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?NT:eU}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:o}=this;let{curRecognizer:c}=t;(!c||c&&c.state&Fn.Recognized)&&(c=t.curRecognizer=null);let d=0;for(;d<o.length;)i=o[d],t.stopped!==NT&&(!c||i===c||i.canRecognizeWith(c))?i.recognize(e):i.reset(),!c&&i.state&(Fn.Began|Fn.Changed|Fn.Ended)&&(c=t.curRecognizer=i),d++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,o=i.indexOf(t);o!==-1&&(i.splice(o,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const o of dy(e))i[o]=i[o]||[],i[o].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const o of dy(e))t?i[o]&&i[o].splice(i[o].indexOf(t),1):delete i[o]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const o=t;o.type=e,o.preventDefault=function(){t.srcEvent.preventDefault()};let c=0;for(;c<i.length;)i[c](o),c++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,o]of Object.entries(this.options.cssProps)){const c=Q5(t.style,i);e?(this.oldCssProps[c]=t.style[c],t.style[c]=o):t.style[c]=this.oldCssProps[c]||""}e||(this.oldCssProps={})}}}let nU=1;function iU(){return nU++}function zT(n){return n&Fn.Cancelled?"cancel":n&Fn.Ended?"end":n&Fn.Changed?"move":n&Fn.Began?"start":""}class BC{constructor(e){this.options=e,this.id=iU(),this.state=Fn.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const o of e)this.recognizeWith(o);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const o of e)this.requireFailure(o);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Fn.Ended&&this.manager.emit(this.options.event+zT(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Fn.Ended&&this.manager.emit(this.options.event+zT(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Fn.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Fn.Failed|Fn.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Fn.Failed;return}this.state&(Fn.Recognized|Fn.Cancelled|Fn.Failed)&&(this.state=Fn.Possible),this.state=this.process(t),this.state&(Fn.Began|Fn.Changed|Fn.Ended|Fn.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class zC extends BC{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:i}=e,o=t&(Fn.Began|Fn.Changed),c=this.attrTest(e);return o&&(i&Lr.Cancel||!c)?t|Fn.Cancelled:o||c?i&Lr.End?t|Fn.Ended:t&Fn.Began?t|Fn.Changed:Fn.Began:Fn.Failed}}class UT extends BC{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[cx]}process(e){const{options:t}=this,i=e.pointers.length===t.pointers,o=e.distance<t.threshold,c=e.deltaTime<t.time;if(this.reset(),e.eventType&Lr.Start&&this.count===0)return this.failTimeout();if(o&&c&&i){if(e.eventType!==Lr.End)return this.failTimeout();const d=this.pTime?e.timeStamp-this.pTime<t.interval:!0,a=!this.pCenter||LC(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!d?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Fn.Recognized,this.tryEmit(this._input)},t.interval),Fn.Began):Fn.Recognized}return Fn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Fn.Failed},this.options.interval),Fn.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Fn.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const rU=["","start","move","end","cancel","up","down","left","right"];class jT extends zC{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Gr.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Gr.Horizontal&&t.push(hx),e&Gr.Vertical&&t.push(ux),t}getEventNames(){return rU.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let i=!0,{distance:o}=e,{direction:c}=e;const d=e.deltaX,a=e.deltaY;return c&t.direction||(t.direction&Gr.Horizontal?(c=d===0?Gr.None:d<0?Gr.Left:Gr.Right,i=d!==this.pX,o=Math.abs(e.deltaX)):(c=a===0?Gr.None:a<0?Gr.Up:Gr.Down,i=a!==this.pY,o=Math.abs(e.deltaY))),e.direction=c,i&&o>t.threshold&&!!(c&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Fn.Began)||!(this.state&Fn.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Gr[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const sU=["","start","move","end","cancel","in","out"];class oU extends zC{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[V_]}getEventNames(){return sU.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Fn.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class By{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}const aU=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",lU=aU.indexOf("firefox")!==-1,VT=4.000244140625,cU=40,uU=.25;class hU extends By{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=o=>{if(!this.options.enable)return;let c=o.deltaY;globalThis.WheelEvent&&(lU&&o.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(c/=globalThis.devicePixelRatio),o.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(c*=cU)),c!==0&&c%VT===0&&(c=Math.floor(c/VT)),o.shiftKey&&c&&(c=c*uU),this.callback({type:"wheel",center:{x:o.clientX,y:o.clientY},delta:-c,srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const $T=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class dU extends By{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=c=>{this.handleOverEvent(c),this.handleOutEvent(c),this.handleEnterEvent(c),this.handleLeaveEvent(c),this.handleMoveEvent(c)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,$T.forEach(c=>e.addEventListener(c,this.handleEvent))}destroy(){$T.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const WT=["keydown","keyup"];class fU extends By{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=o=>{const c=o.target||o.srcElement;c.tagName==="INPUT"&&c.type==="text"||c.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:"keydown",srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:"keyup",srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",WT.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){WT.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class pU extends By{constructor(e,t,i){super(e,t,i),this.handleEvent=o=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const HT=1,dx=2,ZT=4,mU={pointerdown:HT,pointermove:dx,pointerup:ZT,mousedown:HT,mousemove:dx,mouseup:ZT},gU=0,_U=1,yU=2,vU=1,xU=2,bU=4;function wU(n){const e=mU[n.srcEvent.type];if(!e)return null;const{buttons:t,button:i}=n.srcEvent;let o=!1,c=!1,d=!1;return e===dx?(o=!!(t&vU),c=!!(t&bU),d=!!(t&xU)):(o=i===gU,c=i===_U,d=i===yU),{leftButton:o,middleButton:c,rightButton:d}}function TU(n,e){const t=n.center;if(!t)return null;const i=e.getBoundingClientRect(),o=i.width/e.offsetWidth||1,c=i.height/e.offsetHeight||1,d={x:(t.x-i.left-e.clientLeft)/o,y:(t.y-i.top-e.clientTop)/c};return{center:t,offsetCenter:d}}const SU={srcElement:"root",priority:0};class AU{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const o=this._normalizeEvent(i);let c=i.srcEvent.target;for(;c&&c!==o.rootElement;){if(this._emit(o,c),o.handled)return;c=c.parentNode}this._emit(o,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,o=!1,c=!1){const{handlers:d,handlersByElement:a}=this,v={...SU,...i};let A=a.get(v.srcElement);A||(A=[],a.set(v.srcElement,A));const E={type:e,handler:t,srcElement:v.srcElement,priority:v.priority};o&&(E.once=!0),c&&(E.passive=!0),d.push(E),this._active=this._active||!E.passive;let k=A.length-1;for(;k>=0&&!(A[k].priority>=E.priority);)k--;A.splice(k+1,0,E)}remove(e,t){const{handlers:i,handlersByElement:o}=this;for(let c=i.length-1;c>=0;c--){const d=i[c];if(d.type===e&&d.handler===t){i.splice(c,1);const a=o.get(d.srcElement);a.splice(a.indexOf(d),1),a.length===0&&o.delete(d.srcElement)}}this._active=i.some(c=>!c.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let o=!1;const c=()=>{e.handled=!0},d=()=>{e.handled=!0,o=!0},a=[];for(let v=0;v<i.length;v++){const{type:A,handler:E,once:k}=i[v];if(E({...e,type:A,stopPropagation:c,stopImmediatePropagation:d}),k&&a.push(i[v]),o)break}for(let v=0;v<a.length;v++){const{type:A,handler:E}=a[v];this.remove(A,E)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...wU(e),...TU(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function EU(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const i=t.shift(),o=t.shift()||{};e=new i(o)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class PU{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new tU(e,this.options);for(const i of this.options.recognizers){const{recognizer:o,recognizeWith:c,requireFailure:d}=EU(i);this.manager.add(o),c&&o.recognizeWith(c),d&&o.requireFailure(d)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new hU(e,this._onOtherEvent,{enable:!1}),this.moveInput=new dU(e,this._onOtherEvent,{enable:!1}),this.keyInput=new fU(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new pU(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:i}=this;if(!i)return;const o=i.get(e);o&&(o.set({enable:t}),i.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,i,o,c){if(typeof e!="string"){i=t;for(const[A,E]of Object.entries(e))this._addEventHandler(A,E,i,o,c);return}const{manager:d,events:a}=this;if(!d)return;let v=a.get(e);if(!v){const A=this._getRecognizerName(e)||e;v=new AU(this,A),a.set(e,v),d&&d.on(e,v.handleEvent)}v.add(e,t,i,o,c),v.isEmpty()||this._toggleRecognizer(v.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[c,d]of Object.entries(e))this._removeEventHandler(c,d);return}const{events:i}=this,o=i.get(e);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:c}=o;let d=!1;for(const a of i.values())if(a.recognizerName===c&&!a.isEmpty()){d=!0;break}d||this._toggleRecognizer(c,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const Wn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Wn,"IDENTITY",{get:()=>(xi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ia={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Mh={common:0,meters:1,pixels:2},fx={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},XT={multipan:[jT,{threshold:10,direction:Gr.Vertical,pointers:2}],pinch:[oU,{},null,["multipan"]],pan:[jT,{threshold:1},["pinch"],["multipan"]],dblclick:[UT,{event:"dblclick",taps:2}],click:[UT,{event:"click"},null,["dblclick"]]};function CU(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function Sg(n){let e={},t;return i=>{for(const o in i)if(!CU(i[o],e[o])){t=n(i),e=i;break}return t}}const qT=[0,0,0,0],IU=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],UC=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],MU=[0,0,0],jC=[0,0,0],RU=Sg(OU);function VC(n,e,t=jC){t.length<3&&(t=[t[0],t[1],0]);let i=t,o,c=!0;switch(e===Wn.LNGLAT_OFFSETS||e===Wn.METER_OFFSETS?o=t:o=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Ia.WEB_MERCATOR:(e===Wn.LNGLAT||e===Wn.CARTESIAN)&&(o=[0,0,0],c=!1);break;case Ia.WEB_MERCATOR_AUTO_OFFSET:e===Wn.LNGLAT?i=o:e===Wn.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],o=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case Ia.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case Ia.GLOBE:c=!1,o=null;break;default:c=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:i,offsetMode:c}}function kU(n,e,t){const{viewMatrixUncentered:i,projectionMatrix:o}=n;let{viewMatrix:c,viewProjectionMatrix:d}=n,a=qT,v=qT,A=n.cameraPosition;const{geospatialOrigin:E,shaderCoordinateOrigin:k,offsetMode:L}=VC(n,e,t);return L&&(v=n.projectPosition(E||k),A=[A[0]-v[0],A[1]-v[1],A[2]-v[2]],v[3]=1,a=Tg([],v,d),c=i||c,d=Bd([],o,c),d=Bd([],d,IU)),{viewMatrix:c,viewProjectionMatrix:d,projectionCenter:a,originCommon:v,cameraPosCommon:A,shaderCoordinateOrigin:k,geospatialOrigin:E}}function DU({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=Wn.DEFAULT,coordinateOrigin:o=jC,autoWrapLongitude:c=!1}){i===Wn.DEFAULT&&(i=n.isGeospatial?Wn.LNGLAT:Wn.CARTESIAN);const d=RU({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:o});return d.wrapLongitude=c,d.modelMatrix=t||UC,d}function OU({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:o,viewProjectionMatrix:c,originCommon:d,cameraPosCommon:a,shaderCoordinateOrigin:v,geospatialOrigin:A}=kU(n,t,i),E=n.getDistanceScales(),k=[n.width*e,n.height*e],L=Tg([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,z={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:v,commonOrigin:d.slice(0,3),center:o,pseudoMeters:!!n._pseudoMeters,viewportSize:k,devicePixelRatio:e,focalDistance:L,commonUnitsPerMeter:E.unitsPerMeter,commonUnitsPerWorldUnit:E.unitsPerMeter,commonUnitsPerWorldUnit2:MU,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:c,modelMatrix:UC,cameraPosition:a};if(A){const q=n.getDistanceScales(A);switch(t){case Wn.METER_OFFSETS:z.commonUnitsPerWorldUnit=q.unitsPerMeter,z.commonUnitsPerWorldUnit2=q.unitsPerMeter2;break;case Wn.LNGLAT:case Wn.LNGLAT_OFFSETS:n._pseudoMeters||(z.commonUnitsPerMeter=q.unitsPerMeter),z.commonUnitsPerWorldUnit=q.unitsPerDegree,z.commonUnitsPerWorldUnit2=q.unitsPerDegree2;break;case Wn.CARTESIAN:z.commonUnitsPerWorldUnit=[1,1,q.unitsPerMeter[2]],z.commonUnitsPerWorldUnit2=[0,0,q.unitsPerMeter2[2]];break}}return z}const LU=Object.keys(Wn).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${Wn[n]};`).join(""),FU=Object.keys(Ia).map(n=>`const PROJECTION_MODE_${n}: i32 = ${Ia[n]};`).join(""),NU=Object.keys(Mh).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Mh[n]};`).join(""),BU=`${LU}
${FU}
${NU}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,zU=`${BU}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,UU=Object.keys(Wn).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Wn[n]};`).join(""),jU=Object.keys(Ia).map(n=>`const int PROJECTION_MODE_${n} = ${Ia[n]};`).join(""),VU=Object.keys(Mh).map(n=>`const int UNIT_${n.toUpperCase()} = ${Mh[n]};`).join(""),$U=`${UU}
${jU}
${VU}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,WU={};function HU(n=WU){return"viewport"in n?DU(n):{}}const jb={name:"project",dependencies:[p5,DC],source:zU,vs:$U,getUniforms:HU,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},ZU=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,XU=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Bp={name:"project32",dependencies:[jb],source:ZU,vs:XU};function qU(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function gp(n,e){const t=Tg([],e,n);return r5(t,t,1/t[3]),t}function GT(n,e){const t=n%e;return t<0?e+t:t}function GU(n,e,t){return t*e+(1-t)*n}function px(n,e,t){return n<e?e:n>t?t:n}function YU(n){return Math.log(n)*Math.LOG2E}const Vb=Math.log2||YU;function Cu(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Al=Math.PI,$C=Al/4,Da=Al/180,mx=180/Al,Ap=512,fy=4003e4,v_=85.051129,KU=1.5;function YT(n){return Math.pow(2,n)}function WC(n){return Vb(n)}function Ep(n){const[e,t]=n;Cu(Number.isFinite(e)),Cu(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*Da,o=t*Da,c=Ap*(i+Al)/(2*Al),d=Ap*(Al+Math.log(Math.tan($C+o*.5)))/(2*Al);return[c,d]}function $d(n){const[e,t]=n,i=e/Ap*(2*Al)-Al,o=2*(Math.atan(Math.exp(t/Ap*(2*Al)-Al))-$C);return[i*mx,o*mx]}function JU(n){const{latitude:e}=n;Cu(Number.isFinite(e));const t=Math.cos(e*Da);return WC(fy*t)-9}function l0(n){const e=Math.cos(n*Da);return Ap/fy/e}function gx(n){const{latitude:e,longitude:t,highPrecision:i=!1}=n;Cu(Number.isFinite(e)&&Number.isFinite(t));const o=Ap,c=Math.cos(e*Da),d=o/360,a=d/c,v=o/fy/c,A={unitsPerMeter:[v,v,v],metersPerUnit:[1/v,1/v,1/v],unitsPerDegree:[d,a,v],degreesPerUnit:[1/d,1/a,1/v]};if(i){const E=Da*Math.tan(e*Da)/c,k=d*E/2,L=o/fy*E,z=L/a*v;A.unitsPerDegree2=[0,k,L],A.unitsPerMeter2=[z,0,z]}return A}function HC(n,e){const[t,i,o]=n,[c,d,a]=e,{unitsPerMeter:v,unitsPerMeter2:A}=gx({longitude:t,latitude:i,highPrecision:!0}),E=Ep(n);E[0]+=c*(v[0]+A[0]*d),E[1]+=d*(v[1]+A[1]*d);const k=$d(E),L=(o||0)+(a||0);return Number.isFinite(o)||Number.isFinite(a)?[k[0],k[1],L]:k}function QU(n){const{height:e,pitch:t,bearing:i,altitude:o,scale:c,center:d}=n,a=qU();hy(a,a,[0,0,-o]),PC(a,a,-t*Da),CC(a,a,i*Da);const v=c/e;return Ub(a,a,[v,v,v]),d&&hy(a,a,O6([],d)),a}function ej(n){const{width:e,height:t,altitude:i,pitch:o=0,offset:c,center:d,scale:a,nearZMultiplier:v=1,farZMultiplier:A=1}=n;let{fovy:E=py(KU)}=n;i!==void 0&&(E=py(i));const k=E*Da,L=o*Da,z=ZC(E);let q=z;d&&(q+=d[2]*a/Math.cos(L)/t);const Y=k*(.5+(c?c[1]:0)/t),ne=Math.sin(Y)*q/Math.sin(px(Math.PI/2-L-Y,.01,Math.PI-.01)),ue=Math.sin(L)*ne+q,ve=q*10,se=Math.min(ue*A,ve);return{fov:k,aspect:e/t,focalDistance:z,near:v,far:se}}function py(n){return 2*Math.atan(.5/n)*mx}function ZC(n){return .5/Math.tan(.5*n*Da)}function XC(n,e){const[t,i,o=0]=n;return Cu(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(o)),gp(e,[t,i,o,1])}function $b(n,e,t=0){const[i,o,c]=n;if(Cu(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(c))return gp(e,[i,o,c,1]);const d=gp(e,[i,o,0,1]),a=gp(e,[i,o,1,1]),v=d[2],A=a[2],E=v===A?0:((t||0)-v)/(A-v);return SC([],d,a,E)}function tj(n){const{width:e,height:t,bounds:i,minExtent:o=0,maxZoom:c=24,offset:d=[0,0]}=n,[[a,v],[A,E]]=i,k=nj(n.padding),L=Ep([a,px(E,-v_,v_)]),z=Ep([A,px(v,-v_,v_)]),q=[Math.max(Math.abs(z[0]-L[0]),o),Math.max(Math.abs(z[1]-L[1]),o)],Y=[e-k.left-k.right-Math.abs(d[0])*2,t-k.top-k.bottom-Math.abs(d[1])*2];Cu(Y[0]>0&&Y[1]>0);const ne=Y[0]/q[0],ue=Y[1]/q[1],ve=(k.right-k.left)/2/ne,se=(k.top-k.bottom)/2/ue,Se=[(z[0]+L[0])/2+ve,(z[1]+L[1])/2+se],Ne=$d(Se),nt=Math.min(c,Vb(Math.abs(Math.min(ne,ue))));return Cu(Number.isFinite(nt)),{longitude:Ne[0],latitude:Ne[1],zoom:nt}}function nj(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(Cu(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const KT=Math.PI/180;function ij(n,e=0){const{width:t,height:i,unproject:o}=n,c={targetZ:e},d=o([0,i],c),a=o([t,i],c);let v,A;const E=n.fovy?.5*n.fovy*KT:Math.atan(.5/n.altitude),k=(90-n.pitch)*KT;return E>k-.01?(v=JT(n,0,e),A=JT(n,t,e)):(v=o([0,0],c),A=o([t,0],c)),[d,a,A,v]}function JT(n,e,t){const{pixelUnprojectionMatrix:i}=n,o=gp(i,[e,0,1,1]),c=gp(i,[e,n.height,1,1]),a=(t*n.distanceScales.unitsPerMeter[2]-o[2])/(c[2]-o[2]),v=SC([],o,c,a),A=$d(v);return A.push(t),A}const QT=512;function rj(n){const{width:e,height:t,pitch:i=0}=n;let{longitude:o,latitude:c,zoom:d,bearing:a=0}=n;(o<-180||o>180)&&(o=GT(o+180,360)-180),(a<-180||a>180)&&(a=GT(a+180,360)-180);const v=Vb(t/QT);if(d<=v)d=v,c=0;else{const A=t/2/Math.pow(2,d),E=$d([0,A])[1];if(c<E)c=E;else{const k=$d([0,QT-A])[1];c>k&&(c=k)}}return{width:e,height:t,longitude:o,latitude:c,zoom:d,pitch:i,bearing:a}}const qC=.01,sj=["longitude","latitude","zoom"],GC={curve:1.414,speed:1.2};function oj(n,e,t,i){const{startZoom:o,startCenterXY:c,uDelta:d,w0:a,u1:v,S:A,rho:E,rho2:k,r0:L}=YC(n,e,i);if(v<qC){const Se={};for(const Ne of sj){const nt=n[Ne],dt=e[Ne];Se[Ne]=GU(nt,dt,t)}return Se}const z=t*A,q=Math.cosh(L)/Math.cosh(L+E*z),Y=a*((Math.cosh(L)*Math.tanh(L+E*z)-Math.sinh(L))/k)/v,ne=1/q,ue=o+WC(ne),ve=A6([],d,Y);ox(ve,ve,c);const se=$d(ve);return{longitude:se[0],latitude:se[1],zoom:ue}}function aj(n,e,t){const i={...GC,...t},{screenSpeed:o,speed:c,maxDuration:d}=i,{S:a,rho:v}=YC(n,e,i),A=1e3*a;let E;return Number.isFinite(o)?E=A/(o/v):E=A/c,Number.isFinite(d)&&E>d?0:E}function YC(n,e,t){t=Object.assign({},GC,t);const i=t.curve,o=n.zoom,c=[n.longitude,n.latitude],d=YT(o),a=e.zoom,v=[e.longitude,e.latitude],A=YT(a-o),E=Ep(c),k=Ep(v),L=I6([],k,E),z=Math.max(n.width,n.height),q=z/A,Y=E6(L)*d,ne=Math.max(Y,qC),ue=i*i,ve=(q*q-z*z+ue*ue*ne*ne)/(2*z*ue*ne),se=(q*q-z*z-ue*ue*ne*ne)/(2*q*ue*ne),Se=Math.log(Math.sqrt(ve*ve+1)-ve),Ne=Math.log(Math.sqrt(se*se+1)-se),nt=(Ne-Se)/i;return{startZoom:o,startCenterXY:E,uDelta:L,w0:z,u1:Y,S:nt,rho:i,rho2:ue,r0:Se,r1:Ne}}const KC=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,lj=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,cj=`
${KC}
${lj}
`,uj=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,hj=`
${KC}
${uj}
`,dj=Sg(_j),fj=Sg(yj),pj=[0,0,0,1],mj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function gj(n,e){const[t,i,o]=n,c=$b([t,i,o],e);return Number.isFinite(o)?c:[c[0],c[1],0]}function _j({viewport:n,center:e}){return new Ic(n.viewProjectionMatrix).invert().transform(e)}function yj({viewport:n,shadowMatrices:e}){const t=[],i=n.pixelUnprojectionMatrix,o=n.isGeospatial?void 0:1,c=[[0,0,o],[n.width,0,o],[0,n.height,o],[n.width,n.height,o],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(d=>gj(d,i));for(const d of e){const a=d.clone().translate(new Cc(n.center).negate()),v=c.map(E=>a.transform(E)),A=new Ic().ortho({left:Math.min(...v.map(E=>E[0])),right:Math.max(...v.map(E=>E[0])),bottom:Math.min(...v.map(E=>E[1])),top:Math.max(...v.map(E=>E[1])),near:Math.min(...v.map(E=>-E[2])),far:Math.max(...v.map(E=>-E[2]))});t.push(A.multiplyRight(d))}return t}function vj(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=jb.getUniforms(t),o=dj({viewport:t.viewport,center:i.center}),c=[],d=fj({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let v=0;v<n.shadowMatrices.length;v++){const A=d[v],E=A.clone().translate(new Cc(t.viewport.center).negate());i.coordinateSystem===Wn.LNGLAT&&i.projectionMode===Ia.WEB_MERCATOR?(d[v]=E,c[v]=o):(d[v]=A.clone().multiplyRight(mj),c[v]=E.transform(o))}const a={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||pj,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let v=0;v<d.length;v++)a[`viewProjectionMatrix${v}`]=d[v],a[`projectCenter${v}`]=c[v];for(let v=0;v<2;v++)a[`shadow_uShadowMap${v}`]=n.shadowMaps&&n.shadowMaps[v]||n.dummyShadowMap;return a}const eS={name:"shadow",dependencies:[jb],vs:cj,fs:hj,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:vj,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},zy={...MT,defaultUniforms:{...MT.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},xj=[DC],bj=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],wj=[];function Tj(n){const e=Rd.getDefaultShaderAssembler();for(const i of xj)e.addDefaultModule(i);const t=n==="glsl"?bj:wj;for(const i of t)e.addShaderHook(i);return e}const Sj=[255,255,255],Aj=1;let Ej=0;class Pj{constructor(e={}){this.type="ambient";const{color:t=Sj}=e,{intensity:i=Aj}=e;this.id=e.id||`ambient-${Ej++}`,this.color=t,this.intensity=i}}const Cj=[255,255,255],Ij=1,Mj=[0,0,-1];let Rj=0;class tS{constructor(e={}){this.type="directional";const{color:t=Cj}=e,{intensity:i=Ij}=e,{direction:o=Mj}=e,{_shadow:c=!1}=e;this.id=e.id||`directional-${Rj++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new Cc(o).normalize().toArray(),this.shadow=c}getProjectedLight(e){return this}}class kj{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Wb extends kj{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,i]=this.device.canvasContext.getDrawingBufferSize(),o=e.clearCanvas??!0,c=e.clearColor??(o?[0,0,0,0]:!1),d=o?1:!1,a=o?0:!1,v=e.colorMask??15,A={viewport:[0,0,t,i]};e.colorMask&&(A.colorMask=v),e.scissorRect&&(A.scissorRect=e.scissorRect);const E=this.device.beginRenderPass({framebuffer:e.target,parameters:A,clearColor:c,clearDepth:d,clearStencil:a});try{return this._drawLayers(E,e)}finally{E.end(),this.device.submit()}}_drawLayers(e,t){const{target:i,shaderModuleProps:o,viewports:c,views:d,onViewportActive:a,clearStack:v=!0}=t;t.pass=t.pass||"unknown",v&&(this._lastRenderIndex=-1);const A=[];for(const E of c){const k=d&&d[E.id];a?.(E);const L=this._getDrawLayerParams(E,t),z=E.subViewports||[E];for(const q of z){const Y=this._drawLayersInViewport(e,{target:i,shaderModuleProps:o,viewport:q,view:k,pass:t.pass,layers:t.layers},L);A.push(Y)}}return A}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:o=!1,layerFilter:c,cullRect:d,effects:a,shaderModuleProps:v},A=!1){const E=[],k=JC(this._lastRenderIndex+1),L={layer:t[0],viewport:e,isPicking:o,renderPass:i,cullRect:d},z={};for(let q=0;q<t.length;q++){const Y=t[q],ne=this._shouldDrawLayer(Y,L,c,z),ue={shouldDrawLayer:ne};ne&&!A&&(ue.shouldDrawLayer=!0,ue.layerRenderIndex=k(Y,ne),ue.shaderModuleProps=this._getShaderModuleProps(Y,a,i,v),ue.layerParameters={...Y.context.deck?.props.parameters,...this.getLayerParameters(Y,q,e)}),E[q]=ue}return E}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:o,target:c,viewport:d,view:a},v){const A=Dj(this.device,{shaderModuleProps:i,target:c,viewport:d});if(a&&a.props.clear){const k=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:c,parameters:{viewport:A,scissorRect:A},clearColor:k.color?[0,0,0,0]:!1,clearDepth:k.depth?1:!1}).end()}const E={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:A});for(let k=0;k<t.length;k++){const L=t[k],z=v[k],{shouldDrawLayer:q}=z;if(q&&L.props.pickable&&E.pickableCount++,L.isComposite&&E.compositeCount++,L.isDrawable&&z.shouldDrawLayer){const{layerRenderIndex:Y,shaderModuleProps:ne,layerParameters:ue}=z;E.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,Y),ne.project&&(ne.project.viewport=d),L.context.renderPass=e;try{L._drawLayer({renderPass:e,shaderModuleProps:ne,uniforms:{layerIndex:Y},parameters:ue})}catch(ve){L.raiseError(ve,`drawing ${L} to ${o}`)}}}return E}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let d=e.parent;for(;d;){if(!d.props.visible||!d.filterSubLayer(t))return!1;t.layer=d,d=d.parent}if(i){const a=t.layer.id;if(a in o||(o[a]=i(t)),!o[a])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,o){const c=this.device.canvasContext.cssToDeviceRatio(),d=e.internalState?.propsInTransition||e.props,a={layer:d,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:c,modelMatrix:d.modelMatrix,coordinateSystem:d.coordinateSystem,coordinateOrigin:d.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const v of t)nS(a,v.getShaderModuleProps?.(e,a));return nS(a,this.getShaderModuleProps(e,t,a),o)}}function JC(n=0,e={}){const t={},i=(o,c)=>{const d=o.props._offset,a=o.id,v=o.parent&&o.parent.id;let A;if(v&&!(v in e)&&i(o.parent,!1),v in t){const E=t[v]=t[v]||JC(e[v],e);A=E(o,c),t[a]=E}else Number.isFinite(d)?(A=d+(e[v]||0),t[a]=null):A=n;return c&&A>=n&&(n=A+1),e[a]=A,A};return i}function Dj(n,{shaderModuleProps:e,target:t,viewport:i}){const o=e?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,c]=n.canvasContext.getDrawingBufferSize(),d=t?t.height:c,a=i;return[a.x*o,d-(a.y+a.height)*o,a.width*o,a.height*o]}function nS(n,...e){for(const t of e)if(t)for(const i in t)n[i]?Object.assign(n[i],t[i]):n[i]=t[i];return n}class Oj extends Wb{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),o=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:o})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),o=e.viewports[0],c=o.width*i,d=o.height*i,a=[1,1,1,1];(c!==t.width||d!==t.height)&&t.resize({width:c,height:d}),super.render({...e,clearColor:a,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const Lj={color:[255,255,255],intensity:1},iS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Fj=[0,0,0,200/255];class QC{constructor(e={}){this.id="lighting-effect",this.shadowColor=Fj,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(eS),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:o,views:c}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let d=0;d<this.shadowPasses.length;d++)this.shadowPasses[d].render({layers:e,layerFilter:t,viewports:i,onViewportActive:o,views:c,shaderModuleProps:{shadow:{shadowLightId:d,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(d=>d.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},o={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(d=>d.getProjectedLight({layer:e})),pointLights:this.pointLights.map(d=>d.getProjectedLight({layer:e}))},c=e.props.material;return{shadow:i,lighting:o,phongMaterial:c,gouraudMaterial:c}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(eS))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new Ic().lookAt({eye:new Cc(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new Oj(e);this.shadowPasses[t]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new Pj(Lj),this.directionalLights.push(new tS(iS[0]),new tS(iS[1])))}}class Nj{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:o,padding:c=0,copy:d=!1,initialize:a=!1,maxCount:v}){const A=o||e&&e.constructor||Float32Array,E=t*i+c;if(ArrayBuffer.isView(e)){if(E<=e.length)return e;if(E*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new A(e.buffer,0,E)}let k=1/0;v&&(k=v*i+c);const L=this._allocate(A,E,a,k);return e&&d?L.set(e):a||L.fill(0,0,4),this._release(e),L}release(e){this._release(e)}_allocate(e,t,i,o){let c=Math.max(Math.ceil(t*this.opts.overAlloc),1);c>o&&(c=o);const d=this._pool,a=e.BYTES_PER_ELEMENT*c,v=d.findIndex(A=>A.byteLength>=a);if(v>=0){const A=new e(d.splice(v,1)[0],0,c);return i&&A.fill(0),A}return new e(c)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:o}=i,c=t.findIndex(d=>d.byteLength>=o);c<0?t.push(i):(c>0||t.length<this.opts.poolSize)&&t.splice(c,0,i),t.length>this.opts.poolSize&&t.shift()}}const Pp=new Nj;function Bm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Bj(n){return[n[12],n[13],n[14]]}function zj(n){return{left:Qf(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Qf(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Qf(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Qf(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Qf(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Qf(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const rS=new Cc;function Qf(n,e,t,i){rS.set(n,e,t);const o=rS.len();return{distance:i/o,normal:new Cc(-n/o,-e/o,-t/o)}}function Uj(n){return n-Math.fround(n)}let Rm;function c0(n,e){const{size:t=1,startIndex:i=0}=e,o=e.endIndex!==void 0?e.endIndex:n.length,c=(o-i)/t;Rm=Pp.allocate(Rm,c,{type:Float32Array,size:t*2});let d=i,a=0;for(;d<o;){for(let v=0;v<t;v++){const A=n[d++];Rm[a+v]=A,Rm[a+v+t]=Uj(A)}a+=t*2}return Rm.subarray(0,c*t*2)}function jj(n){let e=null,t=!1;for(const i of n)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const Vj=Math.PI/180,$j=Bm(),sS=[0,0,0],Wj={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Hj({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:o,padding:c,near:d,far:a}){const v=n/e,A=t?new Ic().orthographic({fovy:i,aspect:v,focalDistance:o,near:d,far:a}):new Ic().perspective({fovy:i,aspect:v,near:d,far:a});if(c){const{left:E=0,right:k=0,top:L=0,bottom:z=0}=c,q=bh((E+n-k)/2,0,n)-n/2,Y=bh((L+e-z)/2,0,e)-e/2;A[8]-=q*2/n,A[9]+=Y*2/e}return A}class Ag{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Wj,this.focalDistance=e.focalDistance||1,this.position=e.position||sS,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ia.WEB_MERCATOR:Ia.WEB_MERCATOR_AUTO_OFFSET:Ia.IDENTITY}equals(e){return e instanceof Ag?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&hg(e.projectionMatrix,this.projectionMatrix)&&hg(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const i=this.projectPosition(e),o=XC(i,this.pixelProjectionMatrix),[c,d]=o,a=t?d:this.height-d;return e.length===2?[c,a]:[c,a,o[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[o,c,d]=e,a=t?c:this.height-c,v=i&&i*this.distanceScales.unitsPerMeter[2],A=$b([o,a,d],this.pixelUnprojectionMatrix,v),[E,k,L]=this.unprojectPosition(A);return Number.isFinite(d)?[E,k,L]:Number.isFinite(i)?[E,k,i]:[E,k]}projectPosition(e){const[t,i]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,o]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,o]}projectFlat(e){if(this.isGeospatial){const t=Ep(e);return t[1]=bh(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?$d(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),o=this.unproject([this.width,0],t),c=this.unproject([0,this.height],t),d=this.unproject([this.width,this.height],t);return[Math.min(i[0],o[0],c[0],d[0]),Math.min(i[1],o[1],c[1],d[1]),Math.max(i[0],o[0],c[0],d[0]),Math.max(i[1],o[1],c[1],d[1])]}getDistanceScales(e){return e&&this.isGeospatial?gx({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:o=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,zj(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=JU({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||gx({latitude:i,longitude:t}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:c,modelMatrix:d}=e;let a=sS;if(c&&(a=d?new Ic(d).transformAsVector(c,[]):c),this.isGeospatial){const v=this.projectPosition([t,i,0]);this.center=new Cc(a).scale(this.distanceScales.unitsPerMeter).add(v)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:t=$j,projectionMatrix:i=null,orthographic:o=!1,fovyRadians:c,fovy:d=75,near:a=.1,far:v=1e3,padding:A=null,focalDistance:E=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Ic().multiplyRight(t).translate(new Cc(this.center).negate()),this.projectionMatrix=i||Hj({width:this.width,height:this.height,orthographic:o,fovyRadians:c||d*Vj,focalDistance:E,padding:A,near:a,far:v});const k=Bm();Bd(k,k,this.projectionMatrix),Bd(k,k,this.viewMatrix),this.viewProjectionMatrix=k,this.viewMatrixInverse=ax([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Bj(this.viewMatrixInverse);const L=Bm(),z=Bm();Ub(L,L,[this.width/2,-this.height/2,1]),hy(L,L,[1,-1,0]),Bd(z,L,this.viewProjectionMatrix),this.pixelProjectionMatrix=z,this.pixelUnprojectionMatrix=ax(Bm(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||xi.warn("Pixel project matrix not invertible")()}}Ag.displayName="Viewport";class Cp extends Ag{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:o=0,pitch:c=0,bearing:d=0,nearZMultiplier:a=.1,farZMultiplier:v=1.01,nearZ:A,farZ:E,orthographic:k=!1,projectionMatrix:L,repeat:z=!1,worldOffset:q=0,position:Y,padding:ne,legacyMeterSizes:ue=!1}=e;let{width:ve,height:se,altitude:Se=1.5}=e;const Ne=Math.pow(2,o);ve=ve||1,se=se||1;let nt,dt=null;if(L)Se=L[5]/2,nt=py(Se);else{e.fovy?(nt=e.fovy,Se=ZC(nt)):nt=py(Se);let vt;if(ne){const{top:Ft=0,bottom:Wt=0}=ne;vt=[0,bh((Ft+se-Wt)/2,0,se)-se/2]}dt=ej({width:ve,height:se,scale:Ne,center:Y&&[0,0,Y[2]*l0(t)],offset:vt,pitch:c,fovy:nt,nearZMultiplier:a,farZMultiplier:v}),Number.isFinite(A)&&(dt.near=A),Number.isFinite(E)&&(dt.far=E)}let gt=QU({height:se,pitch:c,bearing:d,scale:Ne,altitude:Se});q&&(gt=new Ic().translate([512*q,0,0]).multiplyLeft(gt)),super({...e,width:ve,height:se,viewMatrix:gt,longitude:i,latitude:t,zoom:o,...dt,fovy:nt,focalDistance:Se}),this.latitude=t,this.longitude=i,this.zoom=o,this.pitch=c,this.bearing=d,this.altitude=Se,this.fovy=nt,this.orthographic=k,this._subViewports=z?[]:null,this._pseudoMeters=ue,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let o=t;o<=i;o++){const c=o?new Cp({...this,worldOffset:o}):this;this._subViewports.push(c)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),o=(e[2]||0)*l0(e[1]);return[t,i,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),o=(e[2]||0)/l0(i);return[t,i,o]}addMetersToLngLat(e,t){return HC(e,t)}panByPosition(e,t){const i=$b(t,this.pixelUnprojectionMatrix),o=this.projectFlat(e),c=ox([],o,P6([],i)),d=ox([],this.center,c),[a,v]=this.unprojectFlat(d);return{longitude:a,latitude:v}}getBounds(e={}){const t=ij(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:o}=this,{longitude:c,latitude:d,zoom:a}=tj({width:i,height:o,bounds:e,...t});return new Cp({width:i,height:o,longitude:c,latitude:d,zoom:a})}}Cp.displayName="WebMercatorViewport";const oS=[0,0,0];function u0(n,e,t=!1){const i=e.projectPosition(n);if(t&&e instanceof Cp){const[o,c,d=0]=n,a=e.getDistanceScales([o,c]);i[2]=d*a.unitsPerMeter[2]}return i}function Zj(n){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=n;let{coordinateSystem:o,fromCoordinateSystem:c,fromCoordinateOrigin:d}=n;return o===Wn.DEFAULT&&(o=e.isGeospatial?Wn.LNGLAT:Wn.CARTESIAN),c===void 0&&(c=o),d===void 0&&(d=i),{viewport:e,coordinateSystem:o,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:c,fromCoordinateOrigin:d}}function e3(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:o,offsetMode:c}){let[d,a,v=0]=n;switch(t&&([d,a,v]=Tg([],[d,a,v,1],t)),i){case Wn.LNGLAT:return u0([d,a,v],e,c);case Wn.LNGLAT_OFFSETS:return u0([d+o[0],a+o[1],v+(o[2]||0)],e,c);case Wn.METER_OFFSETS:return u0(HC(o,[d,a,v]),e,c);case Wn.CARTESIAN:default:return e.isGeospatial?[d+o[0],a+o[1],v+o[2]]:e.projectPosition([d,a,v])}}function Xj(n,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:o,modelMatrix:c,fromCoordinateSystem:d,fromCoordinateOrigin:a}=Zj(e),{autoOffset:v=!0}=e,{geospatialOrigin:A=oS,shaderCoordinateOrigin:E=oS,offsetMode:k=!1}=v?VC(t,i,o):{},L=e3(n,{viewport:t,modelMatrix:c,coordinateSystem:d,coordinateOrigin:a,offsetMode:k});if(k){const z=t.projectPosition(A||E);$6(L,L,z)}return L}let qj=1,Gj=1;class t3{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:o=1,repeat:c=1}=e,d=qj++,a={time:0,delay:t,duration:i,rate:o,repeat:c};return this._setChannelTime(a,this.time),this.channels.set(d,a),d}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const o of t)this._setChannelTime(o,this.time);const i=this.animations.values();for(const o of i){const{animation:c,channel:d}=o;c.setTime(this.getTime(d))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=Gj++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,o=e.duration*e.repeat;i>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function Yj(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function Kj(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let Jj=0;const Qj={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:nx.stats.get(`animation-loop-${Jj++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class e8{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...Qj,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new ky({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=Yj(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(Kj(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1];let i=1;const o=this.device?.canvasContext?.canvas;return o&&o.clientHeight?i=o.clientWidth/o.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const h0={};function Uy(n="id"){h0[n]=h0[n]||1;const e=h0[n]++;return`${n}-${e}`}class aS{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Uy("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ci.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function t8(n,e){if(e instanceof aS)return e;const t=n8(n,e),{attributes:i,bufferLayout:o}=i8(n,e);return new aS({topology:e.topology||"triangle-list",bufferLayout:o,vertexCount:e.vertexCount,indices:t,attributes:i})}function n8(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:Ci.INDEX,data:t})}function i8(n,e){const t=[],i={};for(const[c,d]of Object.entries(e.attributes)){let a=c;switch(c){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(d){i[a]=n.createBuffer({data:d.value,id:`${c}-buffer`});const{value:v,size:A,normalized:E}=d;t.push({name:a,format:Nz(v,A,E)})}}const o=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:o}}class Hb{static defaultProps={...bp.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Hb(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const t={...bp.defaultProps,...e},i=this._hashRenderPipeline(t);if(!this._renderPipelineCache[i]){const o=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});o.hash=i,this._renderPipelineCache[i]={pipeline:o,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const t={...ry.defaultProps,...e},i=this._hashComputePipeline(t);if(!this._computePipelineCache[i]){const o=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});o.hash=i,this._computePipelineCache[i]={pipeline:o,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const t=e.hash,i=e instanceof ry?this._computePipelineCache:this._renderPipelineCache;i[t].useCount--,i[t].useCount===0&&this.destroyPolicy==="unused"&&(i[t].pipeline.destroy(),delete i[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,o="-",c=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${i}V${o}BL${c}`;default:const d=this._getHash(JSON.stringify(e.parameters));return`${t}/${i}V${o}T${e.topology}P${d}BL${c}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class Zb{static defaultProps={...Fy.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Zb(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const t=this._hashShader(e);let i=this._cache[t];if(!i){const o=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:o,useCount:0}}return i.useCount++,i.shader}release(e){const t=this._hashShader(e),i=this._cache[t];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function r8(n,e){const t={},i="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const o of n.attributes)if(o){const c=`${o.location} ${o.name}: ${o.type}`;t[`in ${c}`]={[i]:o.stepMode||"vertex"}}for(const o of n.varyings||[]){const c=`${o.location} ${o.name}`;t[`out ${c}`]={[i]:JSON.stringify(o)}}return t}let us=null,d0=null;function s8(n,{id:e,minimap:t,opaque:i,top:o="0",left:c="0",rgbaScale:d=1}){us||(us=document.createElement("canvas"),us.id=e,us.title=e,us.style.zIndex="100",us.style.position="absolute",us.style.top=o,us.style.left=c,us.style.border="blue 5px solid",us.style.transform="scaleY(-1)",document.body.appendChild(us),d0=us.getContext("2d")),(us.width!==n.width||us.height!==n.height)&&(us.width=n.width/2,us.height=n.height/2,us.style.width="400px",us.style.height="400px");const a=n.device.readPixelsToArrayWebGL(n),v=d0?.createImageData(n.width,n.height);if(v){for(let E=0;E<a.length;E+=4)v.data[0+E+0]=a[E+0]*d,v.data[0+E+1]=a[E+1]*d,v.data[0+E+2]=a[E+2]*d,v.data[0+E+3]=i?255:a[E+3]*d;d0?.putImageData(v,0,0)}}function _x(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!_x(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),o=Object.keys(e);if(i.length!==o.length)return!1;for(const c of i)if(!e.hasOwnProperty(c)||!_x(n[c],e[c],t-1))return!1;return!0}return!1}function o8(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function a8(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function n3(n){return o8(n)||a8(n)}function l8(n){return n3(n)||typeof n=="number"||typeof n=="boolean"}function i3(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];l8(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}class c8{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const i=Tb(Object.values(e).filter(o=>o.dependencies));for(const o of i)e[o.name]=o;Dt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[o,c]of Object.entries(e))this._addModule(c),c.name&&o!==c.name&&!this.options.disableWarnings&&Dt.warn(`Module name: ${o} vs ${c.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const i=t,o=e[i]||{},c=this.modules[i];if(!c){this.options.disableWarnings||Dt.warn(`Module ${t} not found`)();continue}const d=this.moduleUniforms[i],a=this.moduleBindings[i],v=c.getUniforms?.(o,d)||o,{uniforms:A,bindings:E}=i3(v);this.moduleUniforms[i]={...d,...A},this.moduleBindings[i]={...a,...E}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,i]of Object.entries(this.moduleUniforms))for(const[o,c]of Object.entries(i))e[`${t}.${o}`]={type:this.modules[t].uniformTypes?.[o],value:String(c)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let u8="";async function h8(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:u8+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class f0{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e,this.id=t.id||Uy("async-texture"),typeof t?.data=="string"&&t.dimension==="2d"&&(t={...t,data:h8(t.data)}),this.ready=new Promise((i,o)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=o}),this.initAsync(t)}async initAsync(e){const t=e.data;let i;try{i=await r3(t)}catch(c){this.rejectReady(c)}if(this.destroyed)return;const o={...e,data:i};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function r3(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(r3));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),i=Object.keys(e),o={};for(let c=0;c<i.length;c++)o[i[c]]=t[c];return o}return n}const Sd=2,d8=1e4;class Oa{static defaultProps={...bp.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Rd.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...Oa.defaultProps,...t},t=this.props,this.id=t.id||Uy("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(this.props.modules?.map(v=>[v.name,v])||[]),o=t.shaderInputs||new c8(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(o);const c=p8(e),d=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:v,getUniforms:A}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:c,...this.props,modules:d});this.source=v,this._getModuleUniforms=A,this.props.shaderLayout||=p6(this.source)}else{const{vs:v,fs:A,getUniforms:E}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:c,...this.props,modules:d});this.vs=v,this.fs=A,this._getModuleUniforms=E}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Hb.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Zb.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return Dt.info(Sd,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const o=this._getBindings();this.pipeline.setBindings(o,{disableWarnings:this.props.disableWarnings}),yx(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:c}=this.vertexArray,d=c?c.byteLength/(c.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:d,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&t8(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new Jv(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Jv(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){_x(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Fz(this.shaderInputs.modules);for(const[t,i]of Object.entries(this.shaderInputs.modules))if(f8(i)){const o=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=o}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const i=t?.disableWarnings??this.props.disableWarnings;e.indices&&Dt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=Bz(this.pipeline.shaderLayout,this.bufferLayout);const o=new Jv(this.bufferLayout);for(const[c,d]of Object.entries(e)){const a=o.getBufferLayout(c);if(!a){i||Dt.warn(`Model(${this.id}): Missing layout for buffer "${c}".`)();continue}const v=o.getAttributeNamesForBuffer(a);let A=!1;for(const E of v){const k=this._attributeInfos[E];if(k){const L=this.device.type==="webgpu"?o.getBufferIndex(k.bufferName):k.location;this.vertexArray.setBuffer(L,d),A=!0}}!A&&!i&&Dt.warn(`Model(${this.id}): Ignoring buffer "${d.id}" for unknown attribute "${c}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,o]of Object.entries(e)){const c=this._attributeInfos[i];c?this.vertexArray.setConstantWebGL(c.location,o):(t?.disableWarnings??this.props.disableWarnings)||Dt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){yx(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:i}=i3(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof f0&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,i]of Object.entries(this.bindings))i instanceof f0?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Ly?e=Math.max(e,t.texture.updateTimestamp):t instanceof Ci||t instanceof Si?e=Math.max(e,t.updateTimestamp):t instanceof f0?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof lg||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(o=>o.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Dt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let o=null;this.source?o=i:this.fs&&(o=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:o}),this._attributeInfos=JP(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=Dt.level>3?0:d8;Dt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Dt.group(Sd,`>>> DRAWING MODEL ${this.id}`,{collapsed:Dt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=r8(this.pipeline.shaderLayout,this.id);Dt.table(Sd,e)();const t=this.shaderInputs.getDebugTable();for(const[o,c]of Object.entries(this.uniforms))t[o]={value:c};Dt.table(Sd,t)();const i=this._getAttributeDebugTable();Dt.table(Sd,this._attributeInfos)(),Dt.table(Sd,i)(),Dt.groupEnd(Sd)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const i=e.props.framebuffer;i&&s8(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,i]of Object.entries(this._attributeInfos)){const o=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:o?this._getBufferOrConstantValues(o,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){const i=tC(t);return(e instanceof Ci?new i(e.debugData):e).toString()}}function f8(n){return!!(n.uniformTypes&&!yx(n.uniformTypes))}function p8(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function yx(n){for(const e in n)return!1;return!0}class Ip{device;model;transformFeedback;static defaultProps={...Oa.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=Ip.defaultProps){if(!Ip.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Oa(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||WP(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Ci)return t.readAsync();const{buffer:i,byteOffset:o=0,byteLength:c=i.byteLength}=t;return i.readAsync(o,c)}}const m8="transform_output";class lS{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,t){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Oa(this.device,{id:t.id||"texture-transform-model",fs:t.fs||WP({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:m8}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){this.model.destroy();for(const e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(i),i.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:i,targetTexture:o}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,t),o){e.targetTexture=o;const{width:c,height:d}=o;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:c,height:d,colorAttachments:[o]}),e.framebuffer.resize({width:c,height:d})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const i in t)t[i].sampler=this.sampler}}class fg{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:i=null,vertexCount:o=null}=e;this.id=e.id||Uy("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[c,d]of Object.entries(t)){const a=ArrayBuffer.isView(d)?{value:d}:d;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(c)}: must be typed array or object with value as typed array`);if((c==="POSITION"||c==="positions")&&!a.size&&(a.size=3),c==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[c]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const o of Object.values(e)){const{value:c,size:d,constant:a}=o;!a&&c&&d!==void 0&&d>=1&&(i=Math.min(i,c.length/d))}return i}}const g8={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class s3 extends Wb{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:o,onViewportActive:c,pickingFBO:d,deviceRect:{x:a,y:v,width:A,height:E},cullRect:k,effects:L,pass:z="picking",pickZ:q,shaderModuleProps:Y}){this.pickZ=q;const ne=this._resetColorEncoder(q),ue=[a,v,A,E],ve=super.render({target:d,layers:e,layerFilter:t,views:i,viewports:o,onViewportActive:c,cullRect:k,effects:L?.filter(Se=>Se.useInPicking),pass:z,isPicking:!0,shaderModuleProps:Y,clearColor:[0,0,0,0],colorMask:15,scissorRect:ue});return this._colorEncoderState=null,{decodePickingColor:ne&&y8.bind(null,ne),stats:ve}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){const o={...e.props.parameters},{pickable:c,operation:d}=e.props;return!this._colorEncoderState||d.includes("terrain")?o.blend=!1:c&&d.includes("draw")&&(Object.assign(o,g8),o.blend=!0,o.blendColor=_8(this._colorEncoderState,e,i)),o}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function _8(n,e,t){const{byLayer:i,byAlpha:o}=n;let c,d=i.get(e);return d?(d.viewports.push(t),c=d.a):(c=i.size+1,c<=255?(d={a:c,layer:e,viewports:[t]},i.set(e,d),o[c]=d):(xi.warn("Too many pickable layers, only picking the first 255")(),c=0)),[0,0,0,c/255]}function y8(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const tp={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},my=Symbol.for("component"),Eh=Symbol.for("propTypes"),p0=Symbol.for("deprecatedProps"),_p=Symbol.for("asyncPropDefaults"),Wd=Symbol.for("asyncPropOriginal"),wh=Symbol.for("asyncPropResolved");function Xb(n,e=()=>!0){return Array.isArray(n)?o3(n,e,[]):e(n)?[n]:[]}function o3(n,e,t){let i=-1;for(;++i<n.length;){const o=n[i];Array.isArray(o)?o3(o,e,t):e(o)&&t.push(o)}return t}function v8({target:n,source:e,start:t=0,count:i=1}){const o=e.length,c=i*o;let d=0;for(let a=t;d<o;d++)n[a++]=e[d];for(;d<c;)d<c-d?(n.copyWithin(t+d,t,t+d),d*=2):(n.copyWithin(t+d,t,t+c-d),d=c);return n}class x8{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let o=e;typeof e=="string"&&(o=ty(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=c)}).catch(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=c||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const c of this._subscribers)c.onChange(this.getData())}}class b8{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:o=!0}){let c=this._resources[e];c?c.setData(t,i):(c=new x8(e,t,this._context),this._resources[e]=c),c.persistent=o}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const o=t[i],c=this._resources[o.resourceId];c&&c.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:o="default"}){const{_resources:c,protocol:d}=this;e.startsWith(d)&&(e=e.replace(d,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=c[e];if(this._track(i,o,a,t),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,o){const c=this._consumers,d=c[e]=c[e]||{};let a=d[t];const v=a&&a.resourceId&&this._resources[a.resourceId];v&&(v.unsubscribe(a),this.prune()),i&&(a?(a.onChange=o,a.resourceId=i.id):a={onChange:o,resourceId:i.id},d[t]=a,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const w8="layerManager.setLayers",T8="layerManager.activateViewport";class S8{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Ws(T8,this,a),a&&(this.context.viewport=a)};const{deck:i,stats:o,viewport:c,timeline:d}=t||{};this.layers=[],this.resourceManager=new b8({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:Tj(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[M5],renderPass:void 0,stats:o||new ky({id:"deck.gl"}),viewport:c||new Ag({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:d||new t3,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const o=i.getNeedsRedraw(e);t=t||o}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Ws(w8,this,t,e),this._lastRenderedLayers=e;const i=Xb(e,Boolean);for(const o of i)o.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex(o=>o.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){const i={};for(const d of e)i[d.id]?xi.warn(`Multiple old layers with same id ${d.id}`)():i[d.id]=d;if(this._defaultShaderModulesChanged){for(const d of e)d.setNeedsUpdate(),d.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const o=[];this._updateSublayersRecursively(t,i,o),this._finalizeOldLayers(i);let c=!1;for(const d of o)if(d.hasUniformTransition()){c=`Uniform transition in ${d}`;break}this._needsUpdate=c,this.layers=o}_updateSublayersRecursively(e,t,i){for(const o of e){o.context=this.context;const c=t[o.id];c===null&&xi.warn(`Multiple new layers with same id ${o.id}`)(),t[o.id]=null;let d=null;try{this._debug&&c!==o&&o.validateProps(),c?(this._transferLayerState(c,o),this._updateLayer(o)):this._initializeLayer(o),i.push(o),d=o.isComposite?o.getSubLayers():null}catch(a){this._handleError("matching",a,o)}d&&this._updateSublayersRecursively(d,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=tp.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=tp.MATCHED,t!==e&&(e.lifecycle=tp.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=tp.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=tp.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function El(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!El(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),o=Object.keys(e);if(i.length!==o.length)return!1;for(const c of i)if(!e.hasOwnProperty(c)||!El(n[c],e[c],t-1))return!1;return!0}return!1}class A8{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),o={x:e[0],y:e[1]};for(let c=i.length-1;c>=0;--c){const d=i[c];if(d.containsPixel(o)){const a=e.slice();return a[0]-=d.x,a[1]-=d.y,d.unproject(a,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Xb(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!El(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):xi.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:c=>this.getView(e.id)?.makeViewport({viewState:c,width:this.width,height:this.height})})}_updateController(e,t,i,o){const c=e.controller;if(c&&i){const d={...t,...c,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!o||o.constructor!==c.type)&&(o=this._createController(e,d)),o&&o.setProps(d),o}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let o=e.length;o--;){const c=e[o],d=this.getViewState(c),a=c.makeViewport({viewState:d,width:this.width,height:this.height});let v=t[c.id];const A=!!c.controller;A&&!v&&(i=!0),(i||!A)&&v&&(v.finalize(),v=null),this.controllers[c.id]=this._updateController(c,d,a,v),a&&this._viewports.unshift(a)}for(const o in t){const c=t[o];c&&!this.controllers[o]&&c.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,o)=>!e[o].equals(t[o]))}}const E8=/([0-9]+\.?[0-9]*)(%|px)/;function dh(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=E8.exec(n);if(e&&e.length>=3){const t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function fh(n,e){return n.relative?Math.round(n.position*e):n.position}class Mp{constructor(e){const{id:t,x:i=0,y:o=0,width:c="100%",height:d="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=dh(i),this._y=dh(o),this._width=dh(c),this._height=dh(d),this._padding=a&&{left:dh(a.left||0),right:dh(a.right||0),top:dh(a.top||0),bottom:dh(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&El(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);const o=this.getDimensions({width:e,height:t});if(!o.height||!o.width)return null;const c=this.getViewportType(i);return new c({...i,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:fh(this._x,e),y:fh(this._y,t),width:fh(this._width,e),height:fh(this._height,t)};return this._padding&&(i.padding={left:fh(this._padding.left,e),top:fh(this._padding.top,t),right:fh(this._padding.right,e),bottom:fh(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class jy{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const cS=()=>{},vx={BREAK:1,SNAP_TO_END:2,IGNORE:3},P8=n=>n,C8=vx.BREAK;class I8{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:o,startProps:c,endProps:d,duration:a,easing:v}}=t,A=v(i/a),E=o.interpolateProps(c,d,A);this.propsInTransition=this.getControllerState({...this.props,...E}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new jy(e.timeline),this.onViewStateChange=e.onViewStateChange||cS,this.onStateChange=e.onStateChange||cS}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let o=i;if(this.transition.inProgress){const{interruption:c,endProps:d}=this.transition.settings;o={...i,...c===vx.SNAP_TO_END?d:this.propsInTransition||i}}this._triggerTransition(o,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===vx.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),o=this.getControllerState(t).shortestPathFrom(i),c=t.transitionInterpolator,d=c.getDuration?c.getDuration(e,t):t.transitionDuration;if(d===0)return;const a=c.initializeProps(e,o);this.propsInTransition={};const v={duration:d,easing:t.transitionEasing||P8,interpolator:c,interruption:t.transitionInterruption||C8,startProps:a.start,endProps:a.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(v),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function As(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class a3{constructor(e){const{compare:t,extract:i,required:o}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=o}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!hg(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},o={};for(const c of this._propsToExtract)(c in e||c in t)&&(i[c]=e[c],o[c]=t[c]);return this._checkRequiredProps(i),this._checkRequiredProps(o),{start:i,end:o}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];As(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}const M8=["longitude","latitude","zoom","bearing","pitch"],R8=["longitude","latitude","zoom"];class l3 extends a3{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:M8,required:R8},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:o,around:c}=this.opts;if(o&&c){const d=o(e),a=o(t),v=d.unproject(c);i.start.around=c,Object.assign(i.end,{around:a.project(v),aroundPosition:v,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const o={};for(const c of this._propsToExtract)o[c]=ug(e[c]||0,t[c]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const c=this.opts.makeViewport({...t,...o});Object.assign(o,c.panByPosition(t.aroundPosition,ug(e.around,t.around,i)))}return o}}const wu={transitionDuration:0},k8=300,x_=n=>1-(1-n)*(1-n),ep={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Ad={};class D8{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new I8({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:o}=e;return[o.x-t,o.y-i]}isPointInBounds(e,t){const{width:i,height:o}=this.props;if(t&&t.handled)return!1;const c=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=o;return c&&t&&t.stopPropagation(),c}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?k8:0;const{scrollZoom:i=!0,dragPan:o=!0,dragRotate:c=!0,doubleClickZoom:d=!0,touchZoom:a=!0,touchRotate:v=!1,keyboard:A=!0}=e,E=!!this.onViewStateChange;this.toggleEvents(ep.WHEEL,E&&i),this.toggleEvents(ep.PAN,E),this.toggleEvents(ep.PINCH,E&&(a||v)),this.toggleEvents(ep.MULTI_PAN,E&&v),this.toggleEvents(ep.DOUBLE_CLICK,E&&d),this.toggleEvents(ep.KEYBOARD,E&&A),this.scrollZoom=i,this.dragPan=o,this.dragRotate=c,this.doubleClickZoom=d,this.touchZoom=a,this.touchRotate=v,this.keyboard=A}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const o={...e.getViewportProps(),...t},c=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),c){const d=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:d,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const o=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(o,wu,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,wu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),o=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],c=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:x_},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,wu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),o=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],c=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:x_},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:c}=e;let d=2/(1+Math.exp(-Math.abs(c*i)));c<0&&d!==0&&(d=1/d);const a=o?{...this._getTransitionProps({around:t}),transitionDuration:250}:wu,v=this.controllerState.zoom({pos:t,scale:d});return this.updateViewport(v,a,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,wu,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,wu,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),o=[i[0],i[1]+=e.velocityY*t/2],c=this.controllerState.rotate({pos:o});this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:x_},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Ad._startPinchRotation=e.rotation,Ad._lastPinchEvent=e,this.updateViewport(i,wu,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,o=this.getCenter(e);t=t.zoom({pos:o,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:Ad._startPinchRotation-i})}return this.updateViewport(t,wu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ad._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=Ad;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const o=this.getCenter(e);let c=this.controllerState.rotateEnd();const d=Math.log2(e.scale),a=(d-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),v=Math.pow(2,d+a*t/2);c=c.zoom({pos:o,scale:v}).zoomEnd(),this.updateViewport(c,{...this._getTransitionProps({around:o}),transitionDuration:t,transitionEasing:x_},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ad._startPinchRotation=null,Ad._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(o,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:o,rotateSpeedX:c,rotateSpeedY:d}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let v;const A={};switch(e.srcEvent.code){case"Minus":v=t?a.zoomOut(i).zoomOut(i):a.zoomOut(i),A.isZooming=!0;break;case"Equal":v=t?a.zoomIn(i).zoomIn(i):a.zoomIn(i),A.isZooming=!0;break;case"ArrowLeft":t?(v=a.rotateLeft(c),A.isRotating=!0):(v=a.moveLeft(o),A.isPanning=!0);break;case"ArrowRight":t?(v=a.rotateRight(c),A.isRotating=!0):(v=a.moveRight(o),A.isPanning=!0);break;case"ArrowUp":t?(v=a.rotateUp(d),A.isRotating=!0):(v=a.moveUp(o),A.isPanning=!0);break;case"ArrowDown":t?(v=a.rotateDown(d),A.isRotating=!0):(v=a.moveDown(o),A.isPanning=!0);break;default:return!1}return this.updateViewport(v,this._getTransitionProps(),A),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?wu:e?{...t,transitionInterpolator:new l3({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class O8{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const uS=5,L8=1.2;class F8 extends O8{constructor(e){const{width:t,height:i,latitude:o,longitude:c,zoom:d,bearing:a=0,pitch:v=0,altitude:A=1.5,position:E=[0,0,0],maxZoom:k=20,minZoom:L=0,maxPitch:z=60,minPitch:q=0,startPanLngLat:Y,startZoomLngLat:ne,startRotatePos:ue,startBearing:ve,startPitch:se,startZoom:Se,normalize:Ne=!0}=e;As(Number.isFinite(c)),As(Number.isFinite(o)),As(Number.isFinite(d)),super({width:t,height:i,latitude:o,longitude:c,zoom:d,bearing:a,pitch:v,altitude:A,maxZoom:k,minZoom:L,maxPitch:z,minPitch:q,normalize:Ne,position:E},{startPanLngLat:Y,startZoomLngLat:ne,startRotatePos:ue,startBearing:ve,startPitch:se,startZoom:Se}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const c=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(c)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:o,startBearing:c,startPitch:d}=this.getState();if(!o||c===void 0||d===void 0)return this;let a;return e?a=this._getNewRotation(e,o,d,c):a={bearing:c+t,pitch:d+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:o,startZoomLngLat:c}=this.getState();if(c||(o=this.getViewportProps().zoom,c=this._unproject(t)||this._unproject(e)),!c)return this;const{maxZoom:d,minZoom:a}=this.getViewportProps();let v=o+Math.log2(i);v=bh(v,a,d);const A=this.makeViewport({...this.getViewportProps(),zoom:v});return this._getUpdatedState({zoom:v,...A.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:o,longitude:c}=i;return Math.abs(o-t.bearing)>180&&(i.bearing=o<0?o+360:o-360),Math.abs(c-t.longitude)>180&&(i.longitude=c<0?c+360:c-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:o}=e;e.zoom=bh(o,i,t);const{maxPitch:c,minPitch:d,pitch:a}=e;e.pitch=bh(a,d,c);const{normalize:v=!0}=e;return v&&Object.assign(e,rj(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,o){const c=e[0]-t[0],d=e[1]-t[1],a=e[1],v=t[1],{width:A,height:E}=this.getViewportProps(),k=c/A;let L=0;d>0?Math.abs(E-v)>uS&&(L=d/(v-E)*L8):d<0&&v>uS&&(L=1-a/v),L=bh(L,-1,1);const{minPitch:z,maxPitch:q}=this.getViewportProps(),Y=o+180*k;let ne=i;return L>0?ne=i+L*(q-i):L<0&&(ne=i-L*(z-i)),{pitch:ne,bearing:Y}}}class N8 extends D8{constructor(){super(...arguments),this.ControllerState=F8,this.transition={transitionDuration:300,transitionInterpolator:new l3({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class c3 extends Mp{constructor(e={}){super(e)}getViewportType(){return Cp}get ControllerType(){return N8}}c3.displayName="MapView";const B8=new QC;function z8(n,e){const t=n.order??1/0,i=e.order??1/0;return t-i}class U8{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(o=>z8(o,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(El(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const o of this.effects)t[o.id]=o;const i=[];for(const o of e){const c=t[o.id];let d=o;c&&c!==o?c.setProps?(c.setProps(o.props),d=c):c.cleanup(this._context):c||o.setup(this._context),i.push(d),delete t[o.id]}for(const o in t)t[o].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(o=>o instanceof QC)||this._resolvedEffects.push(B8),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class j8 extends Wb{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const V8="deckRenderer.renderLayers";class $8{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new j8(e),this.pickLayersPass=new s3(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const o=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const c=t.render({...i,target:o});i.effects&&this._postRender(i.effects,i),this.renderCount++,Ws(V8,this,c,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const o=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[o]}))});for(const i of e)i.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,o={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const c of e)if(c.postRender){o.target=c.id===this.lastPostProcessEffect?t.target:void 0;const d=c.postRender(o);o.inputBuffer=d,o.swapBuffer=d===i[0]?i[1]:i[0]}}}const W8={pickedColor:null,pickedObjectIndex:-1};function H8({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:o,deviceRect:c}){const{x:d,y:a,width:v,height:A}=c;let E=o*o,k=-1,L=0;for(let z=0;z<A;z++){const q=z+a-i,Y=q*q;if(Y>E)L+=4*v;else for(let ne=0;ne<v;ne++){if(n[L+3]-1>=0){const ve=ne+d-t,se=ve*ve+Y;se<=E&&(E=se,k=L)}L+=4}}if(k>=0){const z=n.slice(k,k+4),q=e(z);if(q){const Y=Math.floor(k/4/v),ne=k/4-Y*v;return{...q,pickedColor:z,pickedX:d+ne,pickedY:a+Y}}xi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return W8}function Z8({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const c=n.slice(i,i+4),d=c.join(",");if(!t.has(d)){const a=e(c);a?t.set(d,{...a,color:c}):xi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function u3({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:o,z:c}){let d=e[0];e.length>1&&(d=q8(n?.pickedViewports||e,{x:i,y:o}));let a;if(d){const v=[i-d.x,o-d.y];c!==void 0&&(v[2]=c),a=d.unproject(v)}return{color:null,layer:null,viewport:d,index:-1,picked:!1,x:i,y:o,pixel:[i,o],coordinate:a,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function X8(n){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:o}=n,{pickedColor:c,pickedLayer:d,pickedObjectIndex:a}=e,v=d?[d]:[];if(i==="hover"){const k=t.index,L=t.layerId,z=d?d.props.id:null;if(z!==L||a!==k){if(z!==L){const q=o.find(Y=>Y.props.id===L);q&&v.unshift(q)}t.layerId=z,t.index=a,t.info=null}}const A=u3(n),E=new Map;return E.set(null,A),v.forEach(k=>{let L={...A};k===d&&(L.color=c,L.index=a,L.picked=!0),L=h3({layer:k,info:L,mode:i});const z=L.layer;k===d&&i==="hover"&&(t.info=L),E.set(z.id,L),i==="hover"&&z.updateAutoHighlight(L)}),E}function h3({layer:n,info:e,mode:t}){for(;n&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}function q8(n,e){for(let t=n.length-1;t>=0;t--){const i=n[t];if(i.containsPixel(e))return i}return n[0]}class G8{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new s3(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:o},c=this.lastPickedInfo.info){const d=c&&c.layer&&c.layer.id,a=c&&c.viewport&&c.viewport.id,v=d?i.find(L=>L.id===d):null,A=a&&o.find(L=>L.id===a)||o[0],E=A&&A.unproject([e-A.x,t-A.y]);return{...c,...{x:e,y:t,viewport:A,coordinate:E,layer:v}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:i,x:o,y:c,radius:d=0,depth:a=1,mode:v="query",unproject3D:A,onViewportActive:E,effects:k}){const L=this.device.canvasContext.cssToDeviceRatio(),z=this._getPickable(e);if(!z||i.length===0)return{result:[],emptyInfo:u3({viewports:i,x:o,y:c,pixelRatio:L})};this._resizeBuffer();const q=this.device.canvasContext.cssToDevicePixels([o,c],!0),Y=[q.x+Math.floor(q.width/2),q.y+Math.floor(q.height/2)],ne=Math.round(d*L),{width:ue,height:ve}=this.pickingFBO,se=this._getPickingRect({deviceX:Y[0],deviceY:Y[1],deviceRadius:ne,deviceWidth:ue,deviceHeight:ve}),Se={x:o-d,y:c-d,width:d*2+1,height:d*2+1};let Ne;const nt=[],dt=new Set;for(let gt=0;gt<a;gt++){let vt;if(se){const Wt=this._drawAndSample({layers:z,views:t,viewports:i,onViewportActive:E,deviceRect:se,cullRect:Se,effects:k,pass:`picking:${v}`});vt=H8({...Wt,deviceX:Y[0],deviceY:Y[1],deviceRadius:ne,deviceRect:se})}else vt={pickedColor:null,pickedObjectIndex:-1};let Ft;if(vt.pickedLayer&&A&&this.depthFBO){const{pickedColors:Wt}=this._drawAndSample({layers:[vt.pickedLayer],views:t,viewports:i,onViewportActive:E,deviceRect:{x:vt.pickedX,y:vt.pickedY,width:1,height:1},cullRect:Se,effects:k,pass:`picking:${v}:z`},!0);Wt[3]&&(Ft=Wt[0])}vt.pickedLayer&&gt+1<a&&(dt.add(vt.pickedLayer),vt.pickedLayer.disablePickingIndex(vt.pickedObjectIndex)),Ne=X8({pickInfo:vt,lastPickedInfo:this.lastPickedInfo,mode:v,layers:z,viewports:i,x:o,y:c,z:Ft,pixelRatio:L});for(const Wt of Ne.values())Wt.layer&&nt.push(Wt);if(!vt.pickedColor)break}for(const gt of dt)gt.restorePickingColors();return{result:nt,emptyInfo:Ne.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:i,x:o,y:c,width:d=1,height:a=1,mode:v="query",maxObjects:A=null,onViewportActive:E,effects:k}){const L=this._getPickable(e);if(!L||i.length===0)return[];this._resizeBuffer();const z=this.device.canvasContext.cssToDeviceRatio(),q=this.device.canvasContext.cssToDevicePixels([o,c],!0),Y=q.x,ne=q.y+q.height,ue=this.device.canvasContext.cssToDevicePixels([o+d,c+a],!0),ve=ue.x+ue.width,se=ue.y,Se={x:Y,y:se,width:ve-Y,height:ne-se},Ne=this._drawAndSample({layers:L,views:t,viewports:i,onViewportActive:E,deviceRect:Se,cullRect:{x:o,y:c,width:d,height:a},effects:k,pass:`picking:${v}`}),nt=Z8(Ne),dt=new Map,gt=[],vt=Number.isFinite(A);for(let Ft=0;Ft<nt.length&&!(vt&&gt.length>=A);Ft++){const Wt=nt[Ft];let pn={color:Wt.pickedColor,layer:null,index:Wt.pickedObjectIndex,picked:!0,x:o,y:c,pixelRatio:z};pn=h3({layer:Wt.pickedLayer,info:pn,mode:v});const sn=pn.layer.id;dt.has(sn)||dt.set(sn,new Set);const rn=dt.get(sn),kn=pn.object??pn.index;rn.has(kn)||(rn.add(kn),gt.push(pn))}return gt}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:o,deviceRect:c,cullRect:d,effects:a,pass:v},A=!1){const E=A?this.depthFBO:this.pickingFBO,k={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:o,pickingFBO:E,deviceRect:c,cullRect:d,effects:a,pass:v,pickZ:A,preRenderStats:{},isPicking:!0};for(const ve of a)ve.useInPicking&&(k.preRenderStats[ve.id]=ve.preRender(k));const{decodePickingColor:L}=this.pickLayersPass.render(k),{x:z,y:q,width:Y,height:ne}=c,ue=new(A?Float32Array:Uint8Array)(Y*ne*4);return this.device.readPixelsToArrayWebGL(E,{sourceX:z,sourceY:q,sourceWidth:Y,sourceHeight:ne,target:ue}),{pickedColors:ue,decodePickingColor:L}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:o,deviceHeight:c}){const d=Math.max(0,e-i),a=Math.max(0,t-i),v=Math.min(o,e+i+1)-d,A=Math.min(c,t+i+1)-a;return v<=0||A<=0?null:{x:d,y:a,width:v,height:A}}}const Y8={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},K8="top-left",hS="__root";class J8{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!El(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const o=t[i.id];o?o.viewId!==i.viewId||o.placement!==i.placement?(this._remove(o),this._add(i)):i!==o&&(o.setProps(i.props),i=o):this._add(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const o=t[i];o&&this._remove(o)}this.widgets=e}_add(e){const{viewId:t=null,placement:i=K8}=e,o=e.onAdd({deck:this.deck,viewId:t});o&&this._getContainer(t,i).append(o),e._element=o}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const i=e||hS;let o=this.containers[i];o||(o=document.createElement("div"),o.style.pointerEvents="none",o.style.position="absolute",o.style.overflow="hidden",this.parentElement?.append(o),this.containers[i]=o);let c=o.querySelector(`.${t}`);return c||(c=document.createElement("div"),c.className=t,c.style.position="absolute",c.style.zIndex="2",Object.assign(c.style,Y8[t]),o.append(c)),c}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const o=this.lastViewports[i]||null,c=i===hS||o,d=this.containers[i];c?(d.style.display="block",d.style.left=`${o?o.x:0}px`,d.style.top=`${o?o.y:0}px`,d.style.width=`${o?o.width:e}px`,d.style.height=`${o?o.height:t}px`):d.style.display="none"}}onRedraw({viewports:e,layers:t}){const i=e.reduce((o,c)=>(o[c.id]=c,o),{});for(const o of this.getWidgets()){const{viewId:c}=o;if(c){const d=i[c];d&&(o.onViewportChange&&o.onViewportChange(d),o.onRedraw?.({viewports:[d],layers:t}))}else{if(o.onViewportChange)for(const d of e)o.onViewportChange(d);o.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(const i of this.getWidgets()){const{viewId:o}=i;(!o||o===e.viewport?.id)&&i.onHover?.(e,t)}}onEvent(e,t){const i=fx[t.type];if(i)for(const o of this.getWidgets()){const{viewId:c}=o;(!c||c===e.viewport?.id)&&o[i]?.(e,t)}}}const Q8={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class eV{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,Q8),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const o=i(e);this.lastViewport=e.viewport,this.setTooltip(o,e.x,e.y)}setTooltip(e,t,i){const o=this.element;if(o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(o.style,e.style)}}}var up;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(up||(up={}));const qb={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},kr=(n,e,t)=>e?n.enable(t):n.disable(t),dS=(n,e,t)=>n.hint(t,e),Ko=(n,e,t)=>n.pixelStorei(t,e),fS=(n,e,t)=>{const i=t===36006?36009:36008;return n.bindFramebuffer(i,e)},km=(n,e,t)=>{const o={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(o,e)};function m0(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const tV={3042:kr,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:kr,2885:(n,e)=>n.cullFace(e),2929:kr,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:kr,35723:dS,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>n.bindTransformFeedback?.(36386,e),34229:(n,e)=>n.bindVertexArray(e),36006:fS,36010:fS,34964:km,36662:km,36663:km,35053:km,35055:km,2886:(n,e)=>n.frontFace(e),33170:dS,2849:(n,e)=>n.lineWidth(e),32823:kr,32824:"polygonOffset",10752:"polygonOffset",35977:kr,32926:kr,32928:kr,32938:"sampleCoverage",32939:"sampleCoverage",3089:kr,3088:(n,e)=>n.scissor(...e),2960:kr,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:kr,10754:kr,12288:kr,12289:kr,12290:kr,12291:kr,12292:kr,12293:kr,12294:kr,12295:kr,3333:Ko,3317:Ko,37440:Ko,37441:Ko,37443:Ko,3330:Ko,3332:Ko,3331:Ko,3314:Ko,32878:Ko,3316:Ko,3315:Ko,32877:Ko,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=e?.length===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=m0(e)?e:[e,e];const[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=m0(e)&&e.length===3?[...e,...e]:e;const[t,i,o,c,d,a]=e;n.stencilFuncSeparate(1028,t,i,o),n.stencilFuncSeparate(1029,c,d,a)},stencilOp:(n,e)=>{e=m0(e)&&e.length===3?[...e,...e]:e;const[t,i,o,c,d,a]=e;n.stencilOpSeparate(1028,t,i,o),n.stencilOpSeparate(1029,c,d,a)},viewport:(n,e)=>n.viewport(...e)};function cr(n,e,t){return e[n]!==void 0?e[n]:t[n]}const nV={blendEquation:(n,e,t)=>n.blendEquationSeparate(cr(32777,e,t),cr(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(cr(32969,e,t),cr(32968,e,t),cr(32971,e,t),cr(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(cr(32824,e,t),cr(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(cr(32938,e,t),cr(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,cr(2962,e,t),cr(2967,e,t),cr(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,cr(34816,e,t),cr(36003,e,t),cr(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,cr(2964,e,t),cr(2965,e,t),cr(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,cr(34817,e,t),cr(34818,e,t),cr(34819,e,t))},pS={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?n({[i]:t}):{valueChanged:!0}},blendColor:(n,e,t,i,o)=>n({32773:new Float32Array([e,t,i,o])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,i,o)=>n({32969:e,32968:t,32971:i,32970:o}),clearColor:(n,e,t,i,o)=>n({3106:new Float32Array([e,t,i,o])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,i,o)=>n({3107:[e,t,i,o]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,i,o)=>n({3088:new Int32Array([e,t,i,o])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(n,e,t,i,o)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:o}),stencilOp:(n,e,t,i)=>n({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(n,e,t,i,o)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:o}),viewport:(n,e,t,i,o)=>n({2978:[e,t,i,o]})},bc=(n,e)=>n.isEnabled(e),mS={3042:bc,2884:bc,2929:bc,3024:bc,32823:bc,32926:bc,32928:bc,3089:bc,2960:bc,35977:bc},iV=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function zp(n,e){if(sV(e))return;const t={};for(const o in e){const c=Number(o),d=tV[o];d&&(typeof d=="string"?t[d]=!0:d(n,e[o],c))}const i=n.state&&n.state.cache;if(i)for(const o in t){const c=nV[o];c(n,e,i)}}function d3(n,e=qb){if(typeof e=="number"){const o=e,c=mS[o];return c?c(n,o):n.getParameter(o)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const o of t){const c=mS[o];i[o]=c?c(n,Number(o)):n.getParameter(Number(o))}return i}function rV(n){zp(n,qb)}function sV(n){for(const e in n)return!1;return!0}function oV(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),i=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&i&&n.length===e.length){for(let o=0;o<n.length;++o)if(n[o]!==e[o])return!1;return!0}return!1}class zd{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];zp(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?d3(e):Object.assign({},qb),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,lV(e);for(const i in pS){const o=pS[i];aV(e,i,o)}gS(e,"getParameter"),gS(e,"isEnabled")}_updateCache(e){let t=!1,i;const o=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const c in e){const d=e[c],a=this.cache[c];oV(d,a)||(t=!0,i=a,o&&!(c in o)&&(o[c]=a),this.cache[c]=d)}return{valueChanged:t,oldValue:i}}}function gS(n,e){const t=n[e].bind(n);n[e]=function(o){if(o===void 0||iV.has(o))return t(o);const c=zd.get(n);return o in c.cache||(c.cache[o]=t(o)),c.enable?c.cache[o]:t(o)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function aV(n,e,t){if(!n[e])return;const i=n[e].bind(n);n[e]=function(...c){const d=zd.get(n),{valueChanged:a,oldValue:v}=t(d._updateCache,...c);return a&&i(...c),v},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function lV(n){const e=n.useProgram.bind(n);n.useProgram=function(i){const o=zd.get(n);o.program!==i&&(e(i),o.program=i)}}function cV(n,e,t){let i="";const o={preserveDrawingBuffer:!0,...t};let c=null;if(c||=n.getContext("webgl2",o),o.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!c&&!t.failIfMajorPerformanceCaveat&&(o.failIfMajorPerformanceCaveat=!1,c=n.getContext("webgl2",o),c.luma||={},c.luma.softwareRenderer=!0),c||(c=n.getContext("webgl",{}),c&&(c=null,i||="Your browser only supports WebGL1")),!c)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:d,onContextRestored:a}=e;return n.addEventListener("webglcontextlost",v=>d(v),!1),n.addEventListener("webglcontextrestored",v=>a(v),!1),c.luma||={},c}function Rp(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function uV(n,e){const t=n.getParameter(7936),i=n.getParameter(7937);Rp(n,"WEBGL_debug_renderer_info",e);const o=e.WEBGL_debug_renderer_info,c=n.getParameter(o?o.UNMASKED_VENDOR_WEBGL:7936),d=n.getParameter(o?o.UNMASKED_RENDERER_WEBGL:7937),a=c||t,v=d||i,A=n.getParameter(7938),E=f3(a,v),k=hV(a,v),L=dV(a,v);return{type:"webgl",gpu:E,gpuType:L,gpuBackend:k,vendor:a,renderer:v,version:A,shadingLanguage:"glsl",shadingLanguageVersion:300}}function f3(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function hV(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function dV(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(f3(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function p3(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const zm="WEBGL_compressed_texture_s3tc",Um="WEBGL_compressed_texture_s3tc_srgb",hp="EXT_texture_compression_rgtc",dp="EXT_texture_compression_bptc",fV="WEBGL_compressed_texture_etc",pV="WEBGL_compressed_texture_astc",mV="WEBGL_compressed_texture_etc1",gV="WEBGL_compressed_texture_pvrtc",_V="WEBGL_compressed_texture_atc",_S="EXT_texture_norm16",yS="EXT_render_snorm",yV="EXT_color_buffer_float",Gb={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[yS],"norm16-renderable-webgl":[_S],"snorm16-renderable-webgl":[_S,yS],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[zm,Um,hp,dp],"texture-compression-bc5-webgl":[hp],"texture-compression-bc7-webgl":[dp],"texture-compression-etc2":[fV],"texture-compression-astc":[pV],"texture-compression-etc1-webgl":[mV],"texture-compression-pvrtc-webgl":[gV],"texture-compression-atc-webgl":[_V]};function vV(n){return n in Gb}function xV(n,e,t){return(Gb[e]||[]).every(o=>Rp(n,o,t))}const Yb={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:yV,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:zm},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Um},"bc1-rgba-unorm":{gl:33777,x:zm},"bc1-rgba-unorm-srgb":{gl:35916,x:Um},"bc2-rgba-unorm":{gl:33778,x:zm},"bc2-rgba-unorm-srgb":{gl:35918,x:Um},"bc3-rgba-unorm":{gl:33779,x:zm},"bc3-rgba-unorm-srgb":{gl:35919,x:Um},"bc4-r-unorm":{gl:36283,x:hp},"bc4-r-snorm":{gl:36284,x:hp},"bc5-rg-unorm":{gl:36285,x:hp},"bc5-rg-snorm":{gl:36286,x:hp},"bc6h-rgb-ufloat":{gl:36495,x:dp},"bc6h-rgb-float":{gl:36494,x:dp},"bc7-rgba-unorm":{gl:36492,x:dp},"bc7-rgba-unorm-srgb":{gl:36493,x:dp},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function bV(n,e,t){let i=e.create;const o=Yb[e.format];return o?.gl===void 0&&(i=!1),o?.x&&(i=i&&!!Rp(n,o.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function m3(n){const e=Yb[n],t=SV(n),i=Sb(n);return{internalFormat:t,format:e?.dataFormat||TV(i.channels,i.integer,i.normalized,t),type:i.dataType?p3(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function wV(n){switch(Sb(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function TV(n,e,t,i){if(i===6408||i===6407)return i;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function SV(n){const t=Yb[n]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const vS={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class AV extends tz{gl;extensions;testedFeatures=new Set;constructor(e,t,i){super([],i),this.gl=e,this.extensions=t,Rp(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),vV(e)&&xV(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(vS),...Object.keys(Gb)]}getWebGLFeature(e){const t=vS[e];return typeof t=="string"?!!Rp(this.gl,t,this.extensions):!!t}}class EV extends ez{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Km extends Ny{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const i=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const i=this.colorAttachments[t];if(i){const o=36064+t;this._attachTextureView(o,i)}}if(this.depthStencilAttachment){const t=wV(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${CV(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:i}=this.device,{texture:o}=t,c=t.props.baseMipLevel,d=t.props.baseArrayLayer;switch(i.bindTexture(o.glTarget,o.handle),o.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,o.handle,c,d);break;case 34067:const a=PV(d);i.framebufferTexture2D(36160,e,a,o.handle,c);break;case 3553:i.framebufferTexture2D(36160,e,3553,o.handle,c);break;default:throw new Error("Illegal texture type")}i.bindTexture(o.glTarget,null)}}function PV(n){return n<34069?n+34069:n}function CV(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class IV extends Ab{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Km(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e);return}}commit(){}}async function g3(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((o,c)=>{i.onload=o,i.onerror=d=>c(new Error(`Unable to load script '${n}': ${d}`)),t.appendChild(i)})}const MV=1;let Jo=null,xS=!1;const Kb={debugSpectorJS:Dt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function RV(n){if(!globalThis.SPECTOR)try{await g3(n.debugSpectorJSUrl||Kb.debugSpectorJSUrl)}catch(e){Dt.warn(String(e))}}function kV(n){if(n={...Kb,...n},!n.debugSpectorJS)return null;if(!Jo&&globalThis.SPECTOR&&!globalThis.luma?.spector){Dt.probe(MV,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;Jo=new e,globalThis.luma&&(globalThis.luma.spector=Jo)}if(!Jo)return null;if(xS||(xS=!0,Jo.spyCanvases(),Jo?.onCaptureStarted.add(e=>Dt.info("Spector capture started:",e)()),Jo?.onCapture.add(e=>{Dt.info("Spector capture complete:",e)(),Jo?.getResultUI(),Jo?.resultView.display(),Jo?.resultView.addCapture(e)})),n.gl){const e=n.gl,t=e.device;Jo?.startCapture(n.gl,500),e.device=t,new Promise(i=>setTimeout(i,2e3)).then(i=>{Dt.info("Spector capture stopped after 2 seconds")(),Jo?.stopCapture()})}return Jo}const DV="https://unpkg.com/webgl-debug@2.0.1/index.js";function _3(n){return n.luma=n.luma||{},n.luma}async function OV(){qd()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await g3(DV))}function LV(n,e={}){return e.debugWebGL||e.traceWebGL?NV(n,e):FV(n)}function FV(n){const e=_3(n);return e.realContext?e.realContext:n}function NV(n,e){if(!globalThis.WebGLDebugUtils)return Dt.warn("webgl-debug not loaded")(),n;const t=_3(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...up,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,BV.bind(null,e),zV.bind(null,e));for(const d in up)!(d in i)&&typeof up[d]=="number"&&(i[d]=up[d]);class o{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(o,i);const c=Object.create(o);return t.realContext=n,t.debugContext=c,c.debug=!0,c}function bS(n,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function BV(n,e,t,i){i=Array.from(i).map(a=>a===void 0?"undefined":a);const o=globalThis.WebGLDebugUtils.glEnumToString(e),c=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),d=`${o} in gl.${t}(${c})`;Dt.error(d)();debugger}function zV(n,e,t){let i="";Dt.level>=1&&(i=bS(e,t),n.traceWebGL&&Dt.log(1,i)());for(const o of t)if(o===void 0){i=i||bS(e,t);debugger}}const g0={};function UV(n="id"){g0[n]=g0[n]||1;const e=g0[n]++;return`${n}-${e}`}class Jm extends Ci{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const i=typeof t=="object"?t.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=jV(this.props.usage),this.glUsage=VV(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,i=e.byteLength+t){const o=this.glTarget;this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,this.glUsage),this.gl.bufferSubData(o,t,e),this.gl.bindBuffer(o,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,t,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,t,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,t,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const i=new Uint8Array(t),o=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,o,t),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,t),i}}function jV(n){return n&Ci.INDEX?34963:n&Ci.VERTEX?34962:n&Ci.UNIFORM?35345:34962}function VV(n){return n&Ci.INDEX||n&Ci.VERTEX?35044:n&Ci.UNIFORM?35048:35044}function $V(n){const e=n.split(/\r?\n/),t=[];for(const i of e){if(i.length<=1)continue;const o=i.split(":");if(o.length===2){const[k,L]=o;t.push({message:L.trim(),type:wS(k),lineNum:0,linePos:0});continue}const[c,d,a,...v]=o;let A=parseInt(a,10);isNaN(A)&&(A=0);let E=parseInt(d,10);isNaN(E)&&(E=0),t.push({message:v.join(":").trim(),type:wS(c),lineNum:A,linePos:E})}return t}function wS(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class WV extends Fy{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?$V(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Dt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Dt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async o=>await new Promise(c=>setTimeout(c,o));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function HV(n,e,t,i){if(GV(e))return i(n);const o=n;o.pushState();try{return ZV(n,e),zp(o.gl,t),i(n)}finally{o.popState()}}function ZV(n,e){const t=n,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Ud("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const c=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,d=Ud("provokingVertex",e.provokingVertex,{first:36429,last:36430});c?.provokingVertexWEBGL(d)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const c=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,d=Ud("polygonMode",e.polygonMode,{fill:6914,line:6913});c?.polygonModeWEBGL(1028,d),c?.polygonModeWEBGL(1029,d)}e.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(qV("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(xx("depthCompare",e.depthCompare))),e.stencilWriteMask){const o=e.stencilWriteMask;i.stencilMaskSeparate(1028,o),i.stencilMaskSeparate(1029,o)}if(e.stencilReadMask&&Dt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const o=e.stencilReadMask||4294967295,c=xx("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,c,0,o),i.stencilFuncSeparate(1029,c,0,o)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const o=_0("stencilPassOperation",e.stencilPassOperation),c=_0("stencilFailOperation",e.stencilFailOperation),d=_0("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,c,d,o),i.stencilOpSeparate(1029,c,d,o)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const o=TS("blendColorOperation",e.blendColorOperation||"add"),c=TS("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(o,c);const d=b_("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=b_("blendColorDstFactor",e.blendColorDstFactor||"zero"),v=b_("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),A=b_("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(d,a,v,A)}}function xx(n,e){return Ud(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function _0(n,e){return Ud(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function TS(n,e){return Ud(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function b_(n,e){return Ud(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function XV(n,e){return`Illegal parameter ${e} for ${n}`}function Ud(n,e,t){if(!(e in t))throw new Error(XV(n,e));return t[e]}function qV(n,e){return e}function GV(n){let e=!0;for(const t in n){e=!1;break}return e}function y3(n){const e={};return n.addressModeU&&(e[10242]=y0(n.addressModeU)),n.addressModeV&&(e[10243]=y0(n.addressModeV)),n.addressModeW&&(e[32882]=y0(n.addressModeW)),n.magFilter&&(e[10240]=bx(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=YV(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=xx("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function y0(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function bx(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function YV(n,e="none"){if(!e)return bx(n);switch(e){case"none":return bx(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class wx extends lg{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=y3(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,i]of Object.entries(e)){const o=Number(t);switch(o){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,o,i);break;default:this.device.gl.samplerParameteri(this.handle,o,i);break}}}}class fp extends Ly{device;gl;handle;texture;constructor(e,t){super(e,{...Si.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}const KV="Failed to deduce GL constant from typed array";function JV(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(KV)}}function QV(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function v3(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function e$(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function gy(n,e,t){if(t$(e))return t(n);const{nocatch:i=!0}=e,o=zd.get(n);o.push(),zp(n,e);let c;if(i)c=t(n),o.pop();else try{c=t(n)}finally{o.pop()}return c}function t$(n){for(const e in n)return!1;return!0}function n$(n,e,t){const{dimension:i,width:o,height:c,depth:d=0}=t,{glInternalFormat:a}=t,v=t.glTarget;switch(i){case"2d-array":case"3d":n.texStorage3D(v,e,a,o,c,d);break;default:n.texStorage2D(v,e,a,o,c)}}function SS(n,e,t,i){const{width:o,height:c}=i,{dimension:d,depth:a=0,mipLevel:v=0}=i,{x:A=0,y:E=0,z:k=0}=i,{glFormat:L,glType:z}=i,q=x3(i.glTarget,d,a),Y=i.flipY?{37440:!0}:{};gy(n,Y,()=>{switch(d){case"2d-array":case"3d":n.bindTexture(q,e),n.texSubImage3D(q,v,A,E,k,o,c,a,L,z,t),n.bindTexture(q,null);break;case"2d":case"cube":n.bindTexture(q,e),n.texSubImage2D(q,v,A,E,o,c,L,z,t),n.bindTexture(q,null);break;default:throw new Error(d)}})}function AS(n,e,t){const{dimension:i,width:o,height:c,depth:d=0,mipLevel:a=0,byteOffset:v=0}=t,{x:A=0,y:E=0,z:k=0}=t,{glFormat:L,glType:z,compressed:q}=t,Y=x3(t.glTarget,i,d);switch(i){case"2d-array":case"3d":q?n.compressedTexSubImage3D(Y,a,A,E,k,o,c,d,L,e,v):n.texSubImage3D(Y,a,A,E,k,o,c,d,L,z,e,v);break;case"2d":case"cube":q?n.compressedTexSubImage2D(Y,a,A,E,o,c,L,e,v):n.texSubImage2D(Y,a,A,E,o,c,L,z,e,v);break;default:throw new Error(i)}}function i$(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function x3(n,e,t){return e==="cube"?34069+t:n}function r$(n,e){const{sourceX:t=0,sourceY:i=0,sourceAttachment:o=0}=e||{};let{target:c=null,sourceWidth:d,sourceHeight:a,sourceDepth:v,sourceFormat:A,sourceType:E}=e||{};const{framebuffer:k,deleteFramebuffer:L}=b3(n),{gl:z,handle:q}=k;d||=k.width,a||=k.height;const Y=k.colorAttachments[o]?.texture;if(!Y)throw new Error(`Invalid framebuffer attachment ${o}`);v=Y?.depth||1,A||=Y?.glFormat||6408,E||=Y?.glType||5121,c=a$(c,E,A,d,a),E=E||JV(c);const ne=z.bindFramebuffer(36160,q);return z.readBuffer(36064+o),z.readPixels(t,i,d,a,A,E,c),z.readBuffer(36064),z.bindFramebuffer(36160,ne||null),L&&k.destroy(),c}function s$(n,e){const{target:t,sourceX:i=0,sourceY:o=0,sourceFormat:c=6408,targetByteOffset:d=0}=e||{};let{sourceWidth:a,sourceHeight:v,sourceType:A}=e||{};const{framebuffer:E,deleteFramebuffer:k}=b3(n);a=a||E.width,v=v||E.height;const L=E;A=A||5121;let z=t;if(!z){const Y=v3(c),ne=e$(A),ue=d+a*v*Y*ne;z=L.device.createBuffer({byteLength:ue})}const q=n.device.createCommandEncoder();return q.copyTextureToBuffer({sourceTexture:n,width:a,height:v,origin:[i,o],destinationBuffer:z,byteOffset:d}),q.destroy(),k&&E.destroy(),z}function b3(n){return n instanceof Ny?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:o$(n),deleteFramebuffer:!0}}function o$(n,e){const{device:t,width:i,height:o,id:c}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${c}`,width:i,height:o,colorAttachments:[n]})}function a$(n,e,t,i,o,c){if(n)return n;e||=5121;const d=QV(e,{clamped:!1}),a=v3(t);return new d(i*o*a)}class Qm extends Si{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,t){super(e,t);const i={...this.props};i.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=i$(this.props.dimension);const o=m3(this.props.format);this.glInternalFormat=o.internalFormat,this.glFormat=o.format,this.glType=o.type,this.compressed=o.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:t,height:i}=e;if(!t||!i){const o=Si.getTextureDataSize(e.data);t=o?.width||1,i=o?.height||1}if(this.width=t,this.height=i,this.depth=e.depth,this.setSampler(e.sampler),this.view=new fp(this.device,{...this.props,texture:this}),this.bind(),n$(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new fp(this.device,{...e,texture:this})}setSampler(e={}){let t;e instanceof wx?(this.sampler=e,t=e.props):(this.sampler=new wx(this.device,e),t=e);const i=y3(t);this._setSamplerParameters(i)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Dt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){Dt.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const t=Si.getExternalImageSize(e.image),i={...Si.defaultCopyExternalImageOptions,...t,...e},{image:o,depth:c,mipLevel:d,x:a,y:v,z:A,flipY:E}=i;let{width:k,height:L}=i;const{dimension:z,glTarget:q,glFormat:Y,glInternalFormat:ne,glType:ue}=this;if(k=Math.min(k,this.width-a),L=Math.min(L,this.height-v),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return SS(this.device.gl,this.handle,o,{dimension:z,mipLevel:d,x:a,y:v,z:A,width:k,height:L,depth:c,glFormat:Y,glType:ue,glTarget:q,flipY:E}),{width:i.width,height:i.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,t=0){this.bind();const i=Si.normalizeTextureData(e,this);i.length>1&&this.props.mipmaps!==!1&&Dt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let o=0;o<i.length;o++){const c=i[o];this._setMipLevel(t,o,c)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),AS(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,t=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of Si.CubeFaces)this.setTextureCubeFaceData(e[i],i)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t,i=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&Dt.warn(`${this.id} has mipmap and multiple LODs.`)();const o=Si.CubeFaces.indexOf(t);this.setTexture2DData(e,o)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:t,width:i,height:o,pixels:c,data:d,format:a=6408,type:v=5121}=e,{gl:A}=this,E=c||d;this.bind(),E instanceof Promise?E.then(k=>this.setImageDataForFace(Object.assign({},e,{face:t,data:k,pixels:k}))):this.width||this.height?A.texImage2D(t,0,a,i,o,0,a,v,E):A.texImage2D(t,0,a,a,v,E)}_getImageDataMap(e){for(let t=0;t<Si.CubeFaces.length;++t){const i=Si.CubeFaces[t];e[i]&&(e[34069+t]=e[i],delete e[i])}return e}_setSamplerParameters(e){Dt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,i]of Object.entries(e)){const o=Number(t),c=i;switch(o){case 33082:case 33083:this.gl.texParameterf(this.glTarget,o,c);break;case 10241:this.gl.texParameteri(this.glTarget,o,c);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,o,c);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,o,c);break;default:this.gl.texParameteri(this.glTarget,o,c);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,i,o=this.glTarget){if(Si.isExternalImage(i)){SS(this.device.gl,this.handle,i,{...this,depth:e,mipLevel:t,glTarget:o,flipY:this.props.flipY});return}if(Si.isTextureLevelData(i)){AS(this.device.gl,i.data,{...this,depth:e,mipLevel:t,glTarget:o});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}const l$=[1,2,4,8];class c$ extends Pd{device;glParameters;constructor(e,t){super(e,t),this.device=e;let i;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:c,height:d}=t.framebuffer;i=[0,0,c,d]}else{const[c,d]=e.getCanvasContext().getDrawingBufferSize();i=[0,0,c,d]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const c=this.props.framebuffer.colorAttachments.map((d,a)=>36064+a);this.device.gl.drawBuffers(c)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=l$.map(i=>!!(i&e.colorMask))),this.glParameters=t,zp(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((i,o)=>{i&&this.clearColorBuffer(o,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&gy(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){gy(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function u$(n){return h$.includes(n)}const h$=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],w3={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function T3(n){const e=w3[n];if(!e)throw new Error("uniform");const[t,i,,o]=e;return{format:o,components:i,glType:t}}function d$(n){const e=w3[n];if(!e)throw new Error("attribute");const[,t,,i,o]=e;return{attributeType:i,vertexFormat:o,components:t}}function f$(n,e){const t={attributes:[],bindings:[]};t.attributes=p$(n,e);const i=_$(n,e);for(const a of i){const v=a.uniforms.map(A=>({name:A.name,format:A.format,byteOffset:A.byteOffset,byteStride:A.byteStride,arrayLength:A.arrayLength}));t.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:v})}const o=g$(n,e);let c=0;for(const a of o)if(u$(a.type)){const{viewDimension:v,sampleType:A}=v$(a.type);t.bindings.push({type:"texture",name:a.name,group:0,location:c,viewDimension:v,sampleType:A}),a.textureUnit=c,c+=1}o.length&&(t.uniforms=o);const d=m$(n,e);return d?.length&&(t.varyings=d),t}function p$(n,e){const t=[],i=n.getProgramParameter(e,35721);for(let o=0;o<i;o++){const c=n.getActiveAttrib(e,o);if(!c)throw new Error("activeInfo");const{name:d,type:a}=c,v=n.getAttribLocation(e,d);if(v>=0){const{attributeType:A}=d$(a),E=/instance/i.test(d)?"instance":"vertex";t.push({name:d,location:v,stepMode:E,type:A})}}return t.sort((o,c)=>o.location-c.location),t}function m$(n,e){const t=[],i=n.getProgramParameter(e,35971);for(let o=0;o<i;o++){const c=n.getTransformFeedbackVarying(e,o);if(!c)throw new Error("activeInfo");const{name:d,type:a,size:v}=c,{glType:A,components:E}=T3(a),k={location:o,name:d,type:A,size:v*E};t.push(k)}return t.sort((o,c)=>o.location-c.location),t}function g$(n,e){const t=[],i=n.getProgramParameter(e,35718);for(let o=0;o<i;o++){const c=n.getActiveUniform(e,o);if(!c)throw new Error("activeInfo");const{name:d,size:a,type:v}=c,{name:A,isArray:E}=x$(d);let k=n.getUniformLocation(e,A);const L={location:k,name:A,size:a,type:v,isArray:E};if(t.push(L),L.size>1)for(let z=0;z<L.size;z++){const q=`${A}[${z}]`;k=n.getUniformLocation(e,q);const Y={...L,name:q,location:k};t.push(Y)}}return t}function _$(n,e){const t=(c,d)=>n.getActiveUniformBlockParameter(e,c,d),i=[],o=n.getProgramParameter(e,35382);for(let c=0;c<o;c++){const d={name:n.getActiveUniformBlockName(e,c)||"",location:t(c,35391),byteLength:t(c,35392),vertex:t(c,35396),fragment:t(c,35398),uniformCount:t(c,35394),uniforms:[]},a=t(c,35395)||[],v=n.getActiveUniforms(e,a,35383),A=n.getActiveUniforms(e,a,35384),E=n.getActiveUniforms(e,a,35387),k=n.getActiveUniforms(e,a,35388);for(let L=0;L<d.uniformCount;++L){const z=n.getActiveUniform(e,a[L]);if(!z)throw new Error("activeInfo");d.uniforms.push({name:z.name,format:T3(v[L]).format,type:v[L],arrayLength:A[L],byteOffset:E[L],byteStride:k[L]})}i.push(d)}return i.sort((c,d)=>c.location-d.location),i}const y$={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function v$(n){const e=y$[n];if(!e)throw new Error("sampler");const[t,i]=e;return{viewDimension:t,sampleType:i}}function x$(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function b$(n,e,t,i){const o=n;let c=i;c===!0&&(c=1),c===!1&&(c=0);const d=typeof c=="number"?[c]:c;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,i);case 5126:return n.uniform1fv(e,d);case 35664:return n.uniform2fv(e,d);case 35665:return n.uniform3fv(e,d);case 35666:return n.uniform4fv(e,d);case 5124:return n.uniform1iv(e,d);case 35667:return n.uniform2iv(e,d);case 35668:return n.uniform3iv(e,d);case 35669:return n.uniform4iv(e,d);case 35670:return n.uniform1iv(e,d);case 35671:return n.uniform2iv(e,d);case 35672:return n.uniform3iv(e,d);case 35673:return n.uniform4iv(e,d);case 5125:return o.uniform1uiv(e,d,1);case 36294:return o.uniform2uiv(e,d,2);case 36295:return o.uniform3uiv(e,d,3);case 36296:return o.uniform4uiv(e,d,4);case 35674:return n.uniformMatrix2fv(e,!1,d);case 35675:return n.uniformMatrix3fv(e,!1,d);case 35676:return n.uniformMatrix4fv(e,!1,d);case 35685:return o.uniformMatrix2x3fv(e,!1,d);case 35686:return o.uniformMatrix2x4fv(e,!1,d);case 35687:return o.uniformMatrix3x2fv(e,!1,d);case 35688:return o.uniformMatrix3x4fv(e,!1,d);case 35689:return o.uniformMatrix4x2fv(e,!1,d);case 35690:return o.uniformMatrix4x3fv(e,!1,d)}throw new Error("Illegal uniform")}function w$(n){return n3(n)!==null||typeof n=="number"||typeof n=="boolean"}function T$(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];w$(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}function S$(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function A$(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const ES=4;class E$ extends bp{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:i,bufferMode:o=35981}=t;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,o)),this._linkShaders(),Dt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=f$(this.device.gl,this.handle),Dt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=P$(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(const[i,o]of Object.entries(e)){const c=this.shaderLayout.bindings.find(d=>d.name===i)||this.shaderLayout.bindings.find(d=>d.name===`${i}Uniforms`);if(!c){const d=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");t?.disableWarnings||Dt.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${d}`,o)();continue}switch(o||Dt.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),c.type){case"uniform":if(!(o instanceof Jm)&&!(o.buffer instanceof Jm))throw new Error("buffer value");break;case"texture":if(!(o instanceof fp||o instanceof Qm||o instanceof Km))throw new Error("texture value");break;case"sampler":Dt.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(c.type)}this.bindings[i]=o}}draw(e){const{renderPass:t,parameters:i=this.props.parameters,topology:o=this.props.topology,vertexArray:c,vertexCount:d,instanceCount:a,isInstanced:v=!1,firstVertex:A=0,transformFeedback:E}=e,k=S$(o),L=!!c.indexBuffer,z=c.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Dt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Dt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),c.bindBeforeRender(t),E&&E.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const q=t;return HV(this.device,i,q.glParameters,()=>{L&&v?this.device.gl.drawElementsInstanced(k,d||0,z,A,a||0):L?this.device.gl.drawElements(k,d||0,z,A):v?this.device.gl.drawArraysInstanced(k,A,d||0,a||0):this.device.gl.drawArrays(k,A,d||0),E&&E.end()}),c.unbindAfterRender(t),!0}setUniformsWebGL(e){const{bindings:t}=T$(e);Object.keys(t).forEach(i=>{Dt.warn(`Unsupported value "${JSON.stringify(t[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Dt.time(ES,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Dt.timeEnd(ES,`linkProgram for ${this.id}`)(),Dt.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}Dt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Dt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const t=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${t}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async o=>await new Promise(c=>setTimeout(c,o));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(Dt.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,i=0;for(const o of this.shaderLayout.bindings){const c=this.bindings[o.name]||this.bindings[o.name.replace(/Uniforms$/,"")];if(!c)throw new Error(`No value for binding ${o.name} in ${this.id}`);switch(o.type){case"uniform":const{name:d}=o,a=e.getUniformBlockIndex(this.handle,d);if(a===4294967295)throw new Error(`Invalid uniform block name ${d}`);e.uniformBlockBinding(this.handle,i,a),c instanceof Jm?e.bindBufferBase(35345,i,c.handle):e.bindBufferRange(35345,i,c.buffer.handle,c.offset||0,c.size||c.buffer.byteLength-c.offset),i+=1;break;case"texture":if(!(c instanceof fp||c instanceof Qm||c instanceof Km))throw new Error("texture");let v;if(c instanceof fp)v=c.texture;else if(c instanceof Qm)v=c;else if(c instanceof Km&&c.colorAttachments[0]instanceof fp)Dt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),v=c.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(v.glTarget,v.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${o.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:i,type:o,textureUnit:c}=e,d=this.uniforms[t]??c;d!==void 0&&b$(this.device.gl,i,o,d)}}}function P$(n,e){const t={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const o=t.attributes.find(c=>c.name===i.name);o?(o.type=i.type||o.type,o.stepMode=i.stepMode||o.stepMode):Dt.warn(`shader layout attribute ${i.name} not present in shader`)}return t}class C$ extends Pb{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":I$(this.device,t.options);break;case"copy-buffer-to-texture":M$(this.device,t.options);break;case"copy-texture-to-buffer":R$(this.device,t.options);break;case"copy-texture-to-texture":k$(this.device,t.options);break;default:throw new Error(t.name)}}}function I$(n,e){const t=e.sourceBuffer,i=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function M$(n,e){throw new Error("Not implemented")}function R$(n,e){const{sourceTexture:t,mipLevel:i=0,aspect:o="all",width:c=e.sourceTexture.width,height:d=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:v=[0,0],destinationBuffer:A,byteOffset:E=0,bytesPerRow:k,rowsPerImage:L}=e;if(o!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||a!==0||k||L)throw new Error("not implemented");const{framebuffer:z,destroyFramebuffer:q}=S3(t);let Y;try{const ne=A,ue=c||z.width,ve=d||z.height,se=m3(z.colorAttachments[0].texture.props.format),Se=se.format,Ne=se.type;n.gl.bindBuffer(35051,ne.handle),Y=n.gl.bindFramebuffer(36160,z.handle),n.gl.readPixels(v[0],v[1],ue,ve,Se,Ne,E)}finally{n.gl.bindBuffer(35051,null),Y!==void 0&&n.gl.bindFramebuffer(36160,Y),q&&z.destroy()}}function k$(n,e){const{sourceTexture:t,destinationMipLevel:i=0,origin:o=[0,0],destinationOrigin:c=[0,0],destinationTexture:d}=e;let{width:a=e.destinationTexture.width,height:v=e.destinationTexture.height}=e;const{framebuffer:A,destroyFramebuffer:E}=S3(t),[k,L]=o,[z,q,Y]=c,ne=n.gl.bindFramebuffer(36160,A.handle);let ue=null,ve;if(d instanceof Qm)ue=d,a=Number.isFinite(a)?a:ue.width,v=Number.isFinite(v)?v:ue.height,ue.bind(0),ve=ue.glTarget;else throw new Error("invalid destination");switch(ve){case 3553:case 34067:n.gl.copyTexSubImage2D(ve,i,z,q,k,L,a,v);break;case 35866:case 32879:n.gl.copyTexSubImage3D(ve,i,z,q,Y,k,L,a,v);break}ue&&ue.unbind(),n.gl.bindFramebuffer(36160,ne),E&&A.destroy()}function S3(n){if(n instanceof Si){const{width:e,height:t,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class D$ extends Eb{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new C$(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,i){}}function O$(n){const{target:e,source:t,start:i=0,count:o=1}=n,c=t.length,d=o*c;let a=0;for(let v=i;a<c;a++)e[v++]=t[a];for(;a<d;)a<d-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+d-a),a=d);return n.target}class Jb extends Cb{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return HL()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const i=t;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:o,type:c,stride:d,offset:a,normalized:v,integer:A,divisor:E}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),A?this.device.gl.vertexAttribIPointer(e,o,c,d,a):this.device.gl.vertexAttribPointer(e,o,c,v,d,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,E||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const i=p3(t.bufferDataType);return{size:t.bufferComponents,type:i,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const o=Jb.isConstantAttributeZeroSupported(this.device)||e!==0;(t||o)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const i=L$(t),o=i.byteLength*e,c=i.length*e;if(this.buffer&&o!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${o} !== ${this.buffer.byteLength}.`);let d=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:o}),d=d||!F$(i,this.bufferValue),d){const a=Mz(t.constructor,c);O$({target:a,source:i,start:0,count:c}),this.buffer.write(a),this.bufferValue=t}return this.buffer}}function L$(n){return Array.isArray(n)?new Float32Array(n):n}function F$(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class N$ extends Ib{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(A$(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const i=this._getVaryingIndex(e),{buffer:o,byteLength:c,byteOffset:d}=this._getBufferRange(t);if(i<0){this.unusedBuffers[e]=o,Dt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:o,byteLength:c,byteOffset:d},this.bindOnUse||this._bindBuffer(i,o,d,c)}getBuffer(e){if(PS(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Jm)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:i=0,byteLength:o=e.buffer.byteLength}=e;return{buffer:t,byteOffset:i,byteLength:o}}_getVaryingIndex(e){if(PS(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:i,byteOffset:o}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,o,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,i=0,o){const c=t&&t.handle;!c||o===void 0?this.gl.bindBufferBase(35982,e,c):this.gl.bindBufferRange(35982,e,c,i,o)}}function PS(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class B$ extends Mb{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,o)=>{const c=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(c)}),this._pollingPromise}}class pp extends Sh{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||UV("webgl-device")});const t=Sh._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=t.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new IV(this,t),this.lost=new Promise(E=>{this._resolveContextLost=E});const o={...e.webgl};t.alphaMode==="premultiplied"&&(o.premultipliedAlpha=!0),e.powerPreference!==void 0&&(o.powerPreference=e.powerPreference);const d=this.props._handle||cV(this.canvasContext.canvas,{onContextLost:E=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:E=>console.log("WebGL context restored")},o);if(!d)throw new Error("WebGL context creation failed");if(i=d.device,i){if(e._reuseDevices)return Dt.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=d,this.gl=d,this.spectorJS=kV({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=uV(this.gl,this._extensions),this.limits=new EV(this.gl),this.features=new AV(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),t.autoResize!==!1&&this.canvasContext.resize(),new zd(this.gl,{log:(...E)=>Dt.log(1,...E)()}).trackState(this.gl,{copyState:!1});const v=e.debugWebGL||e.debug,A=e.debugWebGL;v&&(this.gl=LV(this.gl,{debugWebGL:v,traceWebGL:A}),Dt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Dt.level=Math.max(Dt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Jm(this,t)}createTexture(e){return new Qm(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new wx(this,e)}createShader(e){return new WV(this,e)}createFramebuffer(e){return new Km(this,e)}createVertexArray(e){return new Jb(this,e)}createTransformFeedback(e){return new N$(this,e)}createQuerySet(e){return new B$(this,e)}createRenderPipeline(e){return new E$(this,e)}beginRenderPass(e){return new c$(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new D$(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return r$(e,t)}readPixelsToBufferWebGL(e,t){return s$(e,t)}setParametersWebGL(e){zp(this.gl,e)}getParametersWebGL(e){return d3(this.gl,e)}withParametersWebGL(e,t){return gy(this.gl,e,t)}resetWebGL(){Dt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),rV(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return bV(this.gl,e,this._extensions)}loseDevice(){let e=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){zd.get(this.gl).push()}popState(){zd.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){const i=Number(e);for(const o in this.gl)if(this.gl[o]===i)return`GL.${o}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[o,c])=>(i[`${o}:${this.getGLKey(o,t)}`]=`${c}:${this.getGLKey(c,t)}`,i),{})}_constants;setConstantAttributeWebGL(e,t){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const o=this._constants[e];switch(o&&V$(o,t)&&Dt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:z$(this,e,t);break;case Int32Array:U$(this,e,t);break;case Uint32Array:j$(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return Rp(this.gl,e,this._extensions),this._extensions}}function z$(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function U$(n,e,t){n.gl.vertexAttribI4iv(e,t)}function j$(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function V$(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const $$={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},W$=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),H$=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),Z$=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function X$(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){const o=this.originalGetContext("webgl2",i);return o instanceof HTMLElement&&q$(o),o}return this.originalGetContext(t,i)}}function q$(n){n.getExtension("EXT_color_buffer_float");const e={...$$,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:W$(n),OES_vertex_array_object:H$(n),ANGLE_instanced_arrays:Z$(n)},t=n.getExtension;n.getExtension=function(o){const c=t.call(n,o);return c||(o in e?e[o]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(i.apply(n)||[])?.concat(Object.keys(e))}}const w_=1;class G$ extends oz{type="webgl";constructor(){super(),Sh.defaultProps={...Sh.defaultProps,...Kb},pp.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){X$(e)}async attach(e){if(e instanceof pp)return e;if(e?.device instanceof Sh)return e.device;if(!Y$(e))throw new Error("Invalid WebGL2RenderingContext");return new pp({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){Dt.groupCollapsed(w_,"WebGLDevice created")();const t=[];(e.debugWebGL||e.debug)&&t.push(OV()),e.debugSpectorJS&&t.push(RV(e));const i=await Promise.allSettled(t);for(const d of i)d.status==="rejected"&&Dt.error(`Failed to initialize debug libraries ${d.reason}`)();const o=new pp(e),c=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return Dt.probe(w_,c)(),Dt.table(w_,o.info)(),Dt.groupEnd(w_)(),o}}function Y$(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const CS=new G$;function ph(){}const K$=({isDragging:n})=>n?"grabbing":"grab",A3={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ph,onWebGLInitialized:ph,onResize:ph,onViewStateChange:ph,onInteractionStateChange:ph,onBeforeRender:ph,onAfterRender:ph,onLoad:ph,onError:n=>xi.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:K$,getTooltip:null,debug:!1,drawPickingColors:!1};class Qb{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ky({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:o}=this;if(i.type==="pointerleave")o.x=-1,o.y=-1,o.radius=0;else{if(i.leftButton||i.rightButton)return;{const c=i.offsetCenter;if(!c)return;o.x=c.x,o.y=c.y,o.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:o.x,y:o.y}),o.event=i},this._onEvent=i=>{const o=fx[i.type],c=i.offsetCenter;if(!o||!c||!this.layerManager)return;const d=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:c.x,y:c.y,layers:d,viewports:this.getViewports(c)},this._lastPointerDownInfo),{layer:v}=a,A=v&&(v[o]||v.props[o]),E=this.props[o];let k=!1;A&&(k=A.call(v,a,i)),k||(E?.(a,i),this.widgetManager.onEvent(a,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;const o=i.offsetCenter,c=this._pick("pickObject","pickObject Time",{x:o.x,y:o.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=c.result[0]||c.emptyInfo},this.props={...A3,...e},e=this.props,e.viewState&&e.initialViewState&&xi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&xi.error("WebGL1 context not supported.")(),t=CS.attach(e.gl)),t||(t=nx.createDevice({type:"best-available",_reuseDevices:!0,adapters:[CS],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Pp.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&xi.removed("onLayerHover","onHover")(),"onLayerClick"in e&&xi.removed("onLayerClick","onClick")(),e.initialViewState&&!El(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),c=this.effectManager.needsRedraw(e),d=this.deckRenderer.needsRedraw(e);return t=t||i||o||c||d,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return As(this.viewManager),this.viewManager.views}getViewports(e){return As(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,i){As(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(t).timeStart();const c=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return o.get(t).timeEnd(),c}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),As(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const o=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=o}if(i||i===0){const o=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.viewManager?.setProps({width:t,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){const{gl:i,onError:o,useDevicePixels:c}=t;return new e8({device:e,useDevicePixels:c,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:d=>this._setDevice(d.device),onRender:this._onRenderFrame.bind(this),onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new c3({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let o=i,c=!1;for(const d of t)o=d,c=d.layer?.onHover(d,e.event)||c;c||(this.props.onHover?.(o,e.event),this.widgetManager.onHover(o,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new t3;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new PU(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(XT).map(o=>{const[c,d,a,v]=XT[o],A=this.props.eventRecognizerOptions?.[o],E={...d,...A,event:o};return{recognizer:new c(E),recognizeWith:a,requestFailure:v}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in fx)this.eventManager.on(o,this._onEvent);this.viewManager=new A8({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new S8(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new U8({deck:this,device:this.device}),this.deckRenderer=new $8(this.device),this.deckPicker=new G8(this.device),this.widgetManager=new J8({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new eV),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:i,gl:o}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:o});const c={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(c),c.pass==="screen"&&this.widgetManager.onRedraw({viewports:c.viewports,layers:c.layers}),this.props.onAfterRender({device:i,gl:o})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),xi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=nx.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}Qb.defaultProps=A3;Qb.VERSION=dB;function J$(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return tC(n)}}const Q$=eC;function T_(n,e,t){const i=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function kd(n){return n.stride||n.size*n.bytesPerElement}function eW(n,e){return n.type===e.type&&n.size===e.size&&kd(n)===kd(e)&&(n.offset||0)===(e.offset||0)}function Tx(n,e){e.offset&&xi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=kd(n),i=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,o=e.elementOffset||0,c=i*t+o*n.bytesPerElement+(n.offset||0);return{...e,offset:c,stride:t}}function tW(n,e){const t=Tx(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class nW{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const o=t.logicalType||t.type,c=o==="float64";let{defaultValue:d}=t;d=Number.isFinite(d)?[d]:d||new Array(this.size).fill(0);let a;c?a="float32":!o&&t.isIndexed?a="uint32":a=o||"float32";let v=J$(o||a);this.doublePrecision=c,c&&t.fp64===!1&&(v=Float32Array),this.value=null,this.settings={...t,defaultType:v,defaultValue:d,logicalType:o,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:v.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*kd(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Pp.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const i={};if(this.state.constant){const o=this.value;if(t){const c=Tx(this.getAccessor(),t),d=c.offset/o.BYTES_PER_ELEMENT,a=c.size||this.size;i[e]=o.subarray(d,d+a)}else i[e]=o}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){const i=this.getAccessor(),o=[],c={name:this.id,byteStride:kd(i),attributes:o};if(this.doublePrecision){const d=tW(i,t||{});o.push(T_(e,{...i,...d.high},this.device.type),T_(`${e}64Low`,{...i,...d.low},this.device.type))}else if(t){const d=Tx(i,t);o.push(T_(e,{...i,...d},this.device.type))}else o.push(T_(e,i,this.device.type));return c}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:o}=this,c=i*o;if(t&&c&&t.length>=c){const d=new Array(o).fill(1/0),a=new Array(o).fill(-1/0);for(let v=0;v<c;)for(let A=0;A<o;A++){const E=t[v++];E<d[A]&&(d[A]=E),E>a[A]&&(a[A]=E)}e=[d,a]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Ci?i={buffer:e}:i=e;const o={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)o.type="float32";else{const d=Q$(i.value);o.type=o.normalized?d.replace("int","norm"):d}o.bytesPerElement=i.value.BYTES_PER_ELEMENT,o.stride=kd(o)}if(t.bounds=null,i.constant){let c=i.value;if(c=this._normalizeValue(c,[],0),this.settings.normalized&&(c=this.normalizeConstant(c)),!(!t.constant||!this._areValuesEqual(c,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(c)?c:new Float32Array(c)}else if(i.buffer){const c=i.buffer;t.externalBuffer=c,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let c=i.value;t.externalBuffer=null,t.constant=!1,this.value=c;let{buffer:d}=this;const a=kd(o),v=(o.vertexOffset||0)*a;if(this.doublePrecision&&c instanceof Float64Array&&(c=c0(c,o)),this.settings.isIndexed){const E=this.settings.defaultType;c.constructor!==E&&(c=new E(c))}const A=c.byteLength+v+a*2;(!d||d.byteLength<A)&&(d=this._createBuffer(A)),d.write(c,v)}return this.setAccessor(o),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:o}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?c0(t,{size:this.size,startIndex:i,endIndex:o}):t.subarray(i,o),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:i}=this,o=i.allocatedValue,c=Pp.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=c;const{byteOffset:d}=this;let{buffer:a}=this;return(!a||a.byteLength<c.byteLength+d)&&(a=this._createBuffer(c.byteLength+d),t&&o&&a.write(o instanceof Float64Array?c0(o,this):o,d)),i.allocatedValue=c,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=t.BYTES_PER_ELEMENT<4),o)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&xi.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:o,size:c}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let d=c;for(;--d>=0;)t[i+d]=o[d];return t}switch(c){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let d=c;for(;--d>=0;)t[i+d]=Number.isFinite(e[d])?e[d]:o[d]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let o=0;o<i;o++)if(e[o]!==t[o])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?Ci.INDEX:Ci.VERTEX)|Ci.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}}const IS=[],MS=[];function Vy(n,e=0,t=1/0){let i=IS;const o={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(MS.length=n.length,i=MS):i=IS,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),o.index=e-1),{iterable:i,objectInfo:o}}function E3(n){return n&&n[Symbol.asyncIterator]}function P3(n,e){const{size:t,stride:i,offset:o,startIndices:c,nested:d}=e,a=n.BYTES_PER_ELEMENT,v=i?i/a:t,A=o?o/a:0,E=Math.floor((n.length-A)/v);return(k,{index:L,target:z})=>{if(!c){const ue=L*v+A;for(let ve=0;ve<t;ve++)z[ve]=n[ue+ve];return z}const q=c[L],Y=c[L+1]||E;let ne;if(d){ne=new Array(Y-q);for(let ue=q;ue<Y;ue++){const ve=ue*v+A;z=new Array(t);for(let se=0;se<t;se++)z[se]=n[ve+se];ne[ue-q]=z}}else if(v===t)ne=n.subarray(q*t+A,Y*t+A);else{ne=new n.constructor((Y-q)*t);let ue=0;for(let ve=q;ve<Y;ve++){const se=ve*v+A;for(let Se=0;Se<t;Se++)ne[ue++]=n[se+Se]}}return ne}}const iW=[],$_=[[0,1/0]];function rW(n,e){if(n===$_||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],i=n.length;let o=0;for(let c=0;c<i;c++){const d=n[c];d[1]<e[0]?(t.push(d),o=c+1):d[0]>e[1]?t.push(d):e=[Math.min(d[0],e[0]),Math.max(d[1],e[1])]}return t.splice(o,0,e),t}const sW={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function C3(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...sW[t],...e,...n,type:t}}class I3 extends nW{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:$_}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!eW(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,o=Array.isArray(t)?e[t.find(c=>e[c])]:e[t];return C3(o,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:o=1/0}=t;this.state.updateRanges=rW(this.state.updateRanges,[i,o])}else this.state.updateRanges=$_}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=iW}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==$_),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:d,noAlloc:a}}=this;let v=!0;if(d){for(const[A,E]of c)d.call(o,this,{data:t,startRow:A,endRow:E,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[A,E]of c){const k=Number.isFinite(A)?this.getVertexOffset(A):0,L=Number.isFinite(E)?this.getVertexOffset(E):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:k,endOffset:L})}this._checkAttributeArray()}else v=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),v}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:o}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),o.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const d=e;As(ArrayBuffer.isView(d.value),`invalid ${o.accessor}`);const a=!!d.size&&d.size!==this.size;return i.binaryAccessor=P3(d.value,{size:d.size||this.size,stride:d.stride,offset:d.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:o}=this.settings;if(o==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=o??"vertex",!t)return i;for(const c in t){const d=super._getBufferLayout(c,t[c]);i.attributes.push(...d.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:o,props:c,numInstances:d}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:v,value:A,size:E,startIndices:k}=e,{accessor:L,transform:z}=a;let q=v.binaryAccessor||(typeof L=="function"?L:c[L]);typeof q!="function"&&(q=()=>q),As(typeof q=="function",`accessor "${L}" is not a function`);let Y=e.getVertexOffset(i);const{iterable:ne,objectInfo:ue}=Vy(t,i,o);for(const ve of ne){ue.index++;let se=q(ve,ue);if(z&&(se=z.call(this,se)),k){const Se=(ue.index<k.length-1?k[ue.index+1]:d)-k[ue.index];if(se&&Array.isArray(se[0])){let Ne=Y;for(const nt of se)e._normalizeValue(nt,A,Ne),Ne+=E}else se&&se.length>E?A.set(se,Y):(e._normalizeValue(se,ue.target,0),v8({target:A,source:ue.target,start:Y,count:Se}));Y+=Se*E}else e._normalizeValue(se,A,Y),Y+=E}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function v0(n){const{source:e,target:t,start:i=0,size:o,getData:c}=n,d=n.end||t.length,a=e.length,v=d-i;if(a>v){t.set(e.subarray(0,v),i);return}if(t.set(e,i),!c)return;let A=a;for(;A<v;){const E=c(A,e);for(let k=0;k<o;k++)t[i+A]=E[k]||0,A++}}function oW({source:n,target:e,size:t,getData:i,sourceStartIndices:o,targetStartIndices:c}){if(!o||!c)return v0({source:n,target:e,size:t,getData:i}),e;let d=0,a=0;const v=i&&((E,k)=>i(E+a,k)),A=Math.min(o.length,c.length);for(let E=1;E<A;E++){const k=o[E]*t,L=c[E]*t;v0({source:n.subarray(d,k),target:e,start:a,end:L,size:t,getData:v}),d=k,a=L}return a<e.length&&v0({source:[],target:e,start:a,size:t,getData:v}),e}function aW(n){const{device:e,settings:t,value:i}=n,o=new I3(e,t);return o.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),o}function M3(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function R3(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function k3(n){n.push(n.shift())}function lW(n,e){const{doublePrecision:t,settings:i,value:o,size:c}=n,d=t&&o instanceof Float64Array?2:1;let a=0;const{shaderAttributes:v}=n.settings;if(v)for(const A of Object.values(v))a=Math.max(a,A.vertexOffset??0);return(i.noAlloc?o.length:(e+a)*c)*d}function D3({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function O3({device:n,buffer:e,attribute:t,fromLength:i,toLength:o,fromStartIndices:c,getData:d=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,v=t.size*a,A=t.byteOffset,E=t.settings.bytesPerElement<4?A/t.settings.bytesPerElement*4:A,k=t.startIndices,L=c&&k,z=t.isConstant;if(!L&&e&&i>=o)return e;const q=t.value instanceof Float64Array?Float32Array:t.value.constructor,Y=z?t.value:new q(t.getBuffer().readSyncWebGL(A,o*q.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!z){const se=d;d=(Se,Ne)=>t.normalizeConstant(se(Se,Ne))}const ne=z?(se,Se)=>d(Y,Se):(se,Se)=>d(Y.subarray(se+A,se+A+v),Se),ue=e?new Float32Array(e.readSyncWebGL(E,i*4).buffer):new Float32Array(0),ve=new Float32Array(o);return oW({source:ue,target:ve,sourceStartIndices:c,targetStartIndices:k,size:v,getData:ne}),(!e||e.byteLength<ve.byteLength+E)&&(e?.destroy(),e=n.createBuffer({byteLength:ve.byteLength+E,usage:35050})),e.write(ve,E),e}class L3{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new jy(i),this.attribute=t,this.attributeInTransition=aW(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=lW(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class cW extends L3{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=fW(e,t)}start(e,t){const i=this.currentLength,o=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:c,attribute:d}=this;k3(c),c[0]=O3({device:this.device,buffer:c[0],attribute:d,fromLength:i,toLength:this.currentLength,fromStartIndices:o,getData:e.enter}),c[1]=D3({device:this.device,source:c[0],target:c[1]}),this.setBuffer(c[1]);const{transform:a}=this,v=a.model;let A=Math.floor(this.currentLength/d.size);F3(d)&&(A/=2),v.setVertexCount(A),d.isConstant?(v.setAttributes({aFrom:c[0]}),v.setConstantAttributes({aTo:d.value})):v.setAttributes({aFrom:c[0],aTo:d.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:c[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let o=i/e;t&&(o=t(o));const{model:c}=this.transform,d={time:o};c.shaderInputs.setProps({interpolation:d}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const uW=`uniform interpolationUniforms {
  float time;
} interpolation;
`,RS={name:"interpolation",vs:uW,uniformTypes:{time:"f32"}},hW=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,dW=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function F3(n){return n.doublePrecision&&n.value instanceof Float64Array}function fW(n,e){const t=e.size,i=M3(t),o=R3(t),c=e.getBufferLayout();return F3(e)?new Ip(n,{vs:dW,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:o,byteOffset:0},{attribute:"aFrom64Low",format:o,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:o,byteOffset:0},{attribute:"aTo64Low",format:o,byteOffset:4*t}]}],modules:[_5,RS],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ip(n,{vs:hW,bufferLayout:[{name:"aFrom",format:o},{name:"aTo",format:c.attributes[0].format}],modules:[RS],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class pW extends L3{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=xW(e),this.framebuffer=bW(e,this.texture),this.transform=vW(e,t)}start(e,t){const i=this.currentLength,o=this.currentStartIndices;super.start(e,t);const{buffers:c,attribute:d}=this;for(let v=0;v<2;v++)c[v]=O3({device:this.device,buffer:c[v],attribute:d,fromLength:i,toLength:this.currentLength,fromStartIndices:o,getData:e.enter});c[2]=D3({device:this.device,source:c[0],target:c[2]}),this.setBuffer(c[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/d.size)),d.isConstant?a.setConstantAttributes({aTo:d.value}):a.setAttributes({aTo:d.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:o}=this,c=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const d={stiffness:c.stiffness,damping:c.damping};t.model.shaderInputs.setProps({spring:d}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),k3(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||o.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const mW=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,gW={name:"spring",vs:mW,uniformTypes:{damping:"f32",stiffness:"f32"}},_W=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,yW=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function vW(n,e){const t=M3(e.size),i=R3(e.size);return new Ip(n,{vs:_W,fs:yW,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[gW],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function xW(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function bW(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const wW={interpolation:cW,spring:pW};class TW{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const o in e){const c=e[o],d=c.getTransitionSetting(t);d&&this._updateAttribute(o,c,d)}for(const o in this.transitions){const c=e[o];(!c||!c.getTransitionSetting(t))&&this._removeTransition(o)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const o=this.transitions[e];let c=!o||o.type!==i.type;if(c){o&&this._removeTransition(e);const d=wW[i.type];d?this.transitions[e]=new d({attribute:t,timeline:this.timeline,device:this.device}):(xi.error(`unsupported transition type '${i.type}'`)(),c=!1)}(c||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const kS="attributeManager.invalidate",SW="attributeManager.updateStart",AW="attributeManager.updateEnd",EW="attribute.updateStart",PW="attribute.allocate",CW="attribute.updateEnd";class ew{constructor(e,{id:t="attribute-manager",stats:i,timeline:o}={}){this.mergeBoundsMemoized=Sg(jj),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new TW(e,{id:`${t}-transitions`,timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);Ws(kS,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Ws(kS,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:o,props:c={},buffers:d={},context:a={}}){let v=!1;Ws(SW,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const A in this.attributes){const E=this.attributes[A],k=E.settings.accessor;E.startIndices=i,E.numInstances=t,c[A]&&xi.removed(`props.${A}`,`data.attributes.${A}`)(),E.setExternalBuffer(d[A])||E.setBinaryValue(typeof k=="string"?d[k]:void 0,e.startIndices)||typeof k=="string"&&!d[k]&&E.setConstantValue(c[k])||E.needsUpdate()&&(v=!0,this._updateAttribute({attribute:E,numInstances:t,data:e,props:c,context:a})),this.needsRedraw=this.needsRedraw||E.needsRedraw()}v&&Ws(AW,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,o={...i.getAttributes()};for(const c in t){const d=t[c];d.needsRedraw(e)&&!i.hasAttribute(c)&&(o[c]=d)}return o}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const i in e){const o=e[i],c={...o,id:i,size:o.isIndexed&&1||o.size||1,...t};this.attributes[i]=new I3(this.device,c)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:o}=this,c=o[e];return c&&c.forEach(d=>{const a=i[d];a&&a.setNeedsUpdate(a.id,t)}),c}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if(Ws(EW,t),t.constant){t.setConstantValue(t.value);return}t.allocate(i)&&Ws(PW,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,Ws(CW,t,i))}}class IW extends jy{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:o,easing:c}}=this,d=c(e/o);this._value=ug(t,i,d)}}const DS=1e-5;function OS(n,e,t,i,o){const c=e-n,a=(t-e)*o,v=-c*i;return a+v+c+e}function MW(n,e,t,i,o){if(Array.isArray(t)){const c=[];for(let d=0;d<t.length;d++)c[d]=OS(n[d],e[d],t[d],i,o);return c}return OS(n,e,t,i,o)}function LS(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){const o=n[i]-e[i];t+=o*o}return Math.sqrt(t)}return Math.abs(n-e)}class RW extends jy{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:o}=this.settings,{_prevValue:c=e,_currValue:d=e}=this;let a=MW(c,d,t,i,o);const v=LS(a,t),A=LS(a,d);v<DS&&A<DS&&(a=t,this.end()),this._prevValue=d,this._currValue=a}}const kW={interpolation:IW,spring:RW};class DW{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,o){const{transitions:c}=this;if(c.has(e)){const v=c.get(e),{value:A=v.settings.fromValue}=v;t=A,this.remove(e)}if(o=C3(o),!o)return;const d=kW[o.type];if(!d){xi.error(`unsupported transition type '${o.type}'`)();return}const a=new d(this.timeline);a.start({...o,fromValue:t,toValue:i}),c.set(e,a)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function OW(n){const e=n[Eh];for(const t in e){const i=e[t],{validate:o}=i;if(o&&!o(n[t],i))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function LW(n,e){const t=tw({newProps:n,oldProps:e,propTypes:n[Eh],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=NW(n,e);let o=!1;return i||(o=BW(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:o,extensionsChanged:zW(n,e),transitionsChanged:FW(n,e)}}function FW(n,e){if(!n.transitions)return!1;const t={},i=n[Eh];let o=!1;for(const c in n.transitions){const d=i[c],a=d&&d.type;(a==="number"||a==="color"||a==="array")&&Sx(n[c],e[c],d)&&(t[c]=!0,o=!0)}return o?t:!1}function tw({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:o="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${o} changed shallowly`;if(typeof e!="object"||e===null)return`${o} changed shallowly`;for(const c of Object.keys(n))if(!(c in t)){if(!(c in e))return`${o}.${c} added`;const d=Sx(n[c],e[c],i[c]);if(d)return`${o}.${c} ${d}`}for(const c of Object.keys(e))if(!(c in t)){if(!(c in n))return`${o}.${c} dropped`;if(!Object.hasOwnProperty.call(n,c)){const d=Sx(n[c],e[c],i[c]);if(d)return`${o}.${c} ${d}`}}return!1}function Sx(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":!i&&e!==n?"changed shallowly":null}function NW(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:o}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&o&&(t=o(n.data,e.data)||t),t}function BW(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&FS(n,e,"all"))return{all:!0};const t={};let i=!1;for(const o in n.updateTriggers)o!=="all"&&FS(n,e,o)&&(t[o]=!0,i=!0);return i?t:!1}function zW(n,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let o=0;o<i.length;o++)if(!i[o].equals(t[o]))return!0;return!1}function FS(n,e,t){let i=n.updateTriggers[t];i=i??{};let o=e.updateTriggers[t];return o=o??{},tw({oldProps:o,newProps:i,triggerName:t})}const UW="count(): argument not an object",jW="count(): argument not a container";function VW(n){if(!WW(n))throw new Error(UW);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if($W(n))return Object.keys(n).length;throw new Error(jW)}function $W(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function WW(n){return n!==null&&typeof n=="object"}function NS(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(o=>o.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const i={...n.inject};for(const o in e.inject)i[o]=(i[o]||"")+e.inject[o];t.inject=i}return t}const HW={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ax={};function ZW(n,e,t,i){if(t instanceof Si)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let o=null;t.compressed&&(o={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const c=e.createTexture({...t,sampler:{...HW,...o,...i},mipmaps:!0});return Ax[c.id]=n,c}function XW(n,e){!e||!(e instanceof Si)||Ax[e.id]===n&&(e.delete(),delete Ax[e.id])}const qW={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Ex(n)&&(n.length===3||n.length===4)},equal(n,e,t){return El(n,e,1)}},accessor:{validate(n,e){const t=_y(n);return t==="function"||t===_y(e.value)},equal(n,e,t){return typeof e=="function"?!0:El(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Ex(n)},equal(n,e,t){const{compare:i}=t,o=Number.isInteger(i)?i:i?1:0;return i?El(n,e,o):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:i}=t,o=Number.isInteger(i)?i:i?1:0;return i?El(n,e,o):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:i}=t.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const i=t.context;return!i||!i.device?null:ZW(t.id,i.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{XW(t.id,n)}}};function GW(n){const e={},t={},i={};for(const[o,c]of Object.entries(n)){const d=c?.deprecatedFor;if(d)i[o]=Array.isArray(d)?d:[d];else{const a=YW(o,c);e[o]=a,t[o]=a.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function YW(n,e){switch(_y(e)){case"object":return Dm(n,e);case"array":return Dm(n,{type:"array",value:e,compare:!1});case"boolean":return Dm(n,{type:"boolean",value:e});case"number":return Dm(n,{type:"number",value:e});case"function":return Dm(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Dm(n,e){return"type"in e?{name:n,...qW[e.type],...e}:"value"in e?{name:n,type:_y(e.value),...e}:{name:n,type:"object",value:e}}function Ex(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function _y(n){return Ex(n)?"array":n===null?"null":typeof n}function KW(n,e){let t;for(let c=e.length-1;c>=0;c--){const d=e[c];"extensions"in d&&(t=d.extensions)}const i=Px(n.constructor,t),o=Object.create(i);o[my]=n,o[Wd]={},o[wh]={};for(let c=0;c<e.length;++c){const d=e[c];for(const a in d)o[a]=d[a]}return Object.freeze(o),o}const JW="_mergedDefaultProps";function Px(n,e){if(!(n instanceof $y.constructor))return{};let t=JW;if(e)for(const o of e){const c=o.constructor;c&&(t+=`:${c.extensionName||c.name}`)}const i=N3(n,t);return i||(n[t]=QW(n,e||[]))}function QW(n,e){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),o=Px(i),c=N3(n,"defaultProps")||{},d=GW(c),a=Object.assign(Object.create(null),o,d.defaultProps),v=Object.assign(Object.create(null),o?.[Eh],d.propTypes),A=Object.assign(Object.create(null),o?.[p0],d.deprecatedProps);for(const E of e){const k=Px(E.constructor);k&&(Object.assign(a,k),Object.assign(v,k[Eh]),Object.assign(A,k[p0]))}return e9(a,n),n9(a,v),t9(a,A),a[Eh]=v,a[p0]=A,e.length===0&&!nw(n,"_propTypes")&&(n._propTypes=v),a}function e9(n,e){const t=r9(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function t9(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){const o=`${this.id}: ${t}`;for(const c of e[t])nw(this,c)||(this[c]=i);xi.deprecated(o,e[t].join("/"))()}})}function n9(n,e){const t={},i={};for(const o in e){const c=e[o],{name:d,value:a}=c;c.async&&(t[d]=a,i[d]=i9(d))}n[_p]=t,n[Wd]={},Object.defineProperties(n,i)}function i9(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||E3(e)?this[Wd][n]=e:this[wh][n]=e},get(){if(this[wh]){if(n in this[wh])return this[wh][n]||this[_p][n];if(n in this[Wd]){const e=this[my]&&this[my].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[_p][n]}}return this[_p][n]}}}function nw(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function N3(n,e){return nw(n,e)&&n[e]}function r9(n){const e=n.componentName;return e||xi.warn(`${n.name}.componentName not specified`)(),e||n.name}let s9=0;class $y{constructor(...e){this.props=KW(this,e),this.id=this.props.id,this.count=s9++}clone(e){const{props:t}=this,i={};for(const o in t[_p])o in t[wh]?i[o]=t[wh][o]:o in t[Wd]&&(i[o]=t[Wd][o]);return new this.constructor({...t,...i,...e})}}$y.componentName="Component";$y.defaultProps={};const o9=Object.freeze({});class a9{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||o9}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[my]||this.component;const t=e[wh]||{},i=e[Wd]||e,o=e[_p]||{};for(const c in t){const d=t[c];this._createAsyncPropData(c,o[c]),this._updateAsyncProp(c,d),t[c]=this.getAsyncProp(c)}for(const c in i){const d=i[c];this._createAsyncPropData(c,o[c]),this._updateAsyncProp(c,d)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(E3(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const o=this.asyncProps[e];o&&i>=o.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=t,o.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const o=i.pendingLoadCount;t.then(c=>{this.component&&(c=this._postProcessValue(i,c),this._setAsyncPropValue(e,c,o),this._onResolve(e,c))}).catch(c=>{this._onError(e,c)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const o=i.pendingLoadCount;let c=[],d=0;for await(const a of t){if(!this.component)return;const{dataTransform:v}=this.component.props;v?c=v(a,c):c=c.concat(a),Object.defineProperty(c,"__diff",{enumerable:!1,value:[{startRow:d,endRow:c.length}]}),d=c.length,this._setAsyncPropValue(e,c,o)}this._onResolve(e,c)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const o=this.component&&this.component.props[Eh];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class l9 extends a9{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,o=i?.props.fetch;return o?o(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const o=i.props.onDataLoad;e==="data"&&o&&o(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}const c9="layer.changeFlag",u9="layer.initialize",h9="layer.update",d9="layer.finalize",f9="layer.matched",BS=2**24-1,p9=Object.freeze([]),m9=Sg(({oldViewport:n,viewport:e})=>n.equals(e));let wl=new Uint8ClampedArray(0);const g9={data:{type:"data",value:p9,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:o,signal:c})=>{const{resourceManager:d}=t.context;o=o||t.getLoadOptions(),i=i||t.props.loaders,c&&(o={...o,fetch:{...o?.fetch,signal:c}});let a=d.contains(n);return!a&&!o&&(d.add({resourceId:n,data:ty(n,i),persistent:!1}),a=!0),a?d.subscribe({resourceId:n,onChange:v=>t.internalState?.reloadAsyncProp(e,v),consumerId:t.id,requestId:e}):ty(n,i,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Wn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Mu extends $y{constructor(){super(...arguments),this.internalState=null,this.lifecycle=tp.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){As(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=e3(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,c,d]=XC(i,t.pixelProjectionMatrix);return e.length===2?[o,c]:[o,c,d]}unproject(e){return As(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){As(this.internalState);const i=this.internalState.viewport||this.context.viewport;return Xj(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Wn.DEFAULT||e===Wn.LNGLAT||e===Wn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){As(e instanceof Uint8Array);const[t,i,o]=e;return t+i*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:VW(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=NS(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=NS(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const o of i)t.invalidateAll(o);else t.invalidateAll();if(t){const{props:o}=e,c=this.internalState.hasPickingBuffer,d=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(c!==d){this.internalState.hasPickingBuffer=d;const{pickingColors:a,instancePickingColors:v}=t.attributes,A=a||v;A&&(d&&A.constant&&(A.constant=!1,t.invalidate(A.id)),!A.value&&!d&&(A.constant=!0,A.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!m9({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),o=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:o,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const c=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(c)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const o in t)Object.defineProperty(i,o,{value:t[o]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(wl.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>BS&&xi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),wl=Pp.allocate(wl,t,{size:4,copy:!0,maxCount:Math.max(t,BS)});const o=Math.floor(wl.length/4),c=[0,0,0];for(let d=i;d<o;d++)this.encodePickingColor(d,c),wl[d*4+0]=c[0],wl[d*4+1]=c[1],wl[d*4+2]=c[2],wl[d*4+3]=0}e.value=wl.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){if(!Object.keys(t).length)return;if(i){const a=this.getAttributeManager();e.setBufferLayout(a.getBufferLayouts(e)),t=a.getAttributes()}const o=e.userData?.excludeAttributes||{},c={},d={};for(const a in t){if(o[a])continue;const v=t[a].getValue();for(const A in v){const E=v[A];E instanceof Ci?t[a].settings.isIndexed?e.setIndexBuffer(E):c[A]=E:E&&(d[A]=E)}}e.setAttributes(c),e.setConstantAttributes(d)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:o}=this.getAttributeManager().attributes,c=i||o,d=c&&t.attributes&&t.attributes[c.id];if(d&&d.value){const a=d.value,v=this.encodePickingColor(e);for(let A=0;A<t.length;A++){const E=c.getVertexOffset(A);a[E]===v[0]&&a[E+1]===v[1]&&a[E+2]===v[2]&&this._disablePickingIndex(A)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,o=t||i;if(!o)return;const c=o.getVertexOffset(e),d=o.getVertexOffset(e+1);o.buffer.write(new Uint8Array(d-c),c)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==wl.buffer&&(i.value=wl.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){As(!this.internalState),As(Number.isFinite(this.props.coordinateSystem)),Ws(u9,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new l9({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(xi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new DW(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ws(f9,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ws(h9,this,e),!e)return;const t=this.props,i=this.context,o=this.internalState,c=i.viewport,d=this._updateUniformTransition();o.propsInTransition=d,i.viewport=o.viewport||c,this.props=d;try{const a=this._getUpdateParams(),v=this.getModels();if(i.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const E of this.props.extensions)E.updateState.call(this,a,E);this.setNeedsRedraw(),this._updateAttributes();const A=this.getModels()[0]!==v[0];this._postUpdate(a,A)}finally{i.viewport=c,this.props=t,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){Ws(d9,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:o={}}){this._updateAttributeTransition();const c=this.props,d=this.context;this.props=this.internalState.propsInTransition||c;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:a}=this.props,v=a&&a(i)||[0,0];d.device instanceof pp&&d.device.setParametersWebGL({polygonOffset:v});for(const A of this.getModels())A.device.type==="webgpu"?A.setParameters({...A.parameters,...o}):A.setParameters(o);if(d.device instanceof pp)d.device.withParametersWebGL(o,()=>{const A={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:o,context:d};for(const E of this.props.extensions)E.draw.call(this,A,E);this.draw(A)});else{const A={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:o,context:d};for(const E of this.props.extensions)E.draw.call(this,A,E);this.draw(A)}}finally{this.props=c}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const o in e)if(e[o]){let c=!1;switch(o){case"dataChanged":const d=e[o],a=t[o];d&&Array.isArray(a)&&(t.dataChanged=Array.isArray(d)?a.concat(d):d,c=!0);default:t[o]||(t[o]=e[o],c=!0)}c&&Ws(c9,this,o,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const i=LW(e,t);if(i.updateTriggersChanged)for(const o in i.updateTriggersChanged)i.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(i.transitionsChanged)for(const o in i.transitionsChanged)this.internalState.uniformTransitions.add(o,t[o],e[o],e.transitions?.[o]);return this.setChangeFlags(i)}validateProps(){OW(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new ew(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:o}=e,c=this.state.model;c?.isInstanced&&c.setInstanceCount(this.getNumInstances());const{autoHighlight:d,highlightedObjectIndex:a,highlightColor:v}=i;if(t||o.autoHighlight!==d||o.highlightedObjectIndex!==a||o.highlightColor!==v){const A={};Array.isArray(v)&&(A.highlightColor=v),(t||o.autoHighlight!==d||a!==o.highlightedObjectIndex)&&(A.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:A})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),o=i?i.getNeedsRedraw(e):!1;if(t=t||o,t)for(const c of this.props.extensions)c.onNeedsRedraw.call(this,c);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Mu.defaultProps=g9;Mu.layerName="Layer";const _9="compositeLayer.renderLayers";class iw extends Mu{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(i,o)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,o)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:i,visible:o,parameters:c,getPolygonOffset:d,highlightedObjectIndex:a,autoHighlight:v,highlightColor:A,coordinateSystem:E,coordinateOrigin:k,wrapLongitude:L,positionFormat:z,modelMatrix:q,extensions:Y,fetch:ne,operation:ue,_subLayerProps:ve}=this.props,se={id:"",updateTriggers:{},opacity:t,pickable:i,visible:o,parameters:c,getPolygonOffset:d,highlightedObjectIndex:a,autoHighlight:v,highlightColor:A,coordinateSystem:E,coordinateOrigin:k,wrapLongitude:L,positionFormat:z,modelMatrix:q,extensions:Y,fetch:ne,operation:ue},Se=ve&&e.id&&ve[e.id],Ne=Se&&Se.updateTriggers,nt=e.id||"sublayer";if(Se){const dt=this.props[Eh],gt=e.type?e.type._propTypes:{};for(const vt in Se){const Ft=gt[vt]||dt[vt];Ft&&Ft.type==="accessor"&&(Se[vt]=this.getSubLayerAccessor(Se[vt]))}}Object.assign(se,e,Se),se.id=`${this.props.id}-${nt}`,se.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...Ne};for(const dt of Y){const gt=dt.getSubLayerProps.call(this,dt);gt&&Object.assign(se,gt,{updateTriggers:Object.assign(se.updateTriggers,gt.updateTriggers)})}return se}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const o=!i||this.needsUpdate();if(o){const c=this.renderLayers();i=Xb(c,Boolean),this.internalState.subLayers=i}Ws(_9,this,o,i);for(const c of i)c.parent=this}}iw.layerName="CompositeLayer";const x0={bearing:0,pitch:0,position:[0,0,0]},y9={speed:1.2,curve:1.414};class S_ extends a3{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...y9,...e}}interpolateProps(e,t,i){const o=oj(e,t,i,this.opts);for(const c in x0)o[c]=ug(e[c]||x0[c],t[c]||x0[c],i);return o}getDuration(e,t){let{transitionDuration:i}=t;return i==="auto"&&(i=aj(e,t,this.opts)),i}}class B3{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=Pp,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:i={},getGeometry:o,geometryBuffer:c,positionFormat:d,dataChanged:a,normalize:v=!0}=this.opts;if(this.data=t,this.getGeometry=o,this.positionSize=c&&c.size||(d==="XY"?2:3),this.buffers=i,this.normalize=v,c&&(As(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(c),v||(i.vertexPositions=c)),this.geometryBuffer=i.vertexPositions,Array.isArray(a))for(const A of a)this._rebuildGeometry(A);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?P3(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:i,buffers:o,_attributeDefs:c,typedArrayManager:d}=this;for(const a in c)if(a in o)d.release(i[a]),i[a]=null;else{const v=c[a];v.copy=t,i[a]=d.allocate(i[a],e,v)}}_forEachGeometry(e,t,i){const{data:o,getGeometry:c}=this,{iterable:d,objectInfo:a}=Vy(o,t,i);for(const v of d){a.index++;const A=c?c(v,a):null;e(A,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:o}=this;const{data:c,geometryBuffer:d}=this,{startRow:a=0,endRow:v=1/0}=e||{},A={};if(e||(t=[0],i=[0]),this.normalize||!d)this._forEachGeometry((k,L)=>{const z=k&&this.normalizeGeometry(k);A[L]=z,i[L+1]=i[L]+(z?this.getGeometrySize(z):0)},a,v),o=i[i.length-1];else if(i=c.startIndices,o=i[c.length]||0,ArrayBuffer.isView(d))o=o||d.length/this.positionSize;else if(d instanceof Ci){const k=this.positionSize*4;o=o||d.byteLength/k}else if(d.buffer){const k=d.stride||this.positionSize*4;o=o||d.buffer.byteLength/k}else if(d.value){const k=d.value,L=d.stride/k.BYTES_PER_ELEMENT||this.positionSize;o=o||k.length/L}this._allocate(o,!!e),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=o;const E={};this._forEachGeometry((k,L)=>{const z=A[L]||k;E.vertexStart=i[L],E.indexStart=t[L];const q=L<i.length-1?i[L+1]:o;E.geometrySize=q-i[L],E.geometryIndex=L,this.updateGeometryAttributes(z,E)},a,v),this.vertexCount=t[t.length-1]}}const v9=typeof window<"u"?ye.useLayoutEffect:ye.useEffect;function yy(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const x9={position:"absolute",zIndex:-1};function z3(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>z3(t,e));if(Wy(n)){if(b9(n))return e.style=x9,ye.cloneElement(n,e);if(w9(n))return ye.cloneElement(n,e)}return n}function Wy(n){return n&&typeof n=="object"&&"type"in n||!1}function b9(n){return n.props?.mapStyle}function w9(n){const e=n.type;return e&&e.deckGLViewProps}function Cx(n){if(typeof n=="function")return ye.createElement(Mp,{},n);if(Array.isArray(n))return n.map(Cx);if(Wy(n)){if(n.type===ye.Fragment)return Cx(n.props.children);if(yy(n.type,Mp))return n}return n}function T9({children:n,layers:e=[],views:t=null}){const i=[],o=[],c={};return ye.Children.forEach(Cx(n),d=>{if(Wy(d)){const a=d.type;if(yy(a,Mu)){const v=S9(a,d.props);o.push(v)}else i.push(d);if(yy(a,Mp)&&a!==Mp&&d.props.id){const v=new a(d.props);c[v.id]=v}}else d&&i.push(d)}),Object.keys(c).length>0&&(Array.isArray(t)?t.forEach(d=>{c[d.id]=d}):t&&(c[t.id]=t),t=Object.values(c)),e=o.length>0?[...o,...e]:e,{layers:e,children:i,views:t}}function S9(n,e){const t={},i=n.defaultProps||{};for(const o in e)i[o]!==e[o]&&(t[o]=e[o]);return new n(t)}const A9=ye.createContext();function E9({children:n,deck:e,ContextProvider:t=A9.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const o={},c=i.views[0].id;for(const d of n){let a=c,v=d;Wy(d)&&yy(d.type,Mp)&&(a=d.props.id||c,v=d.props.children);const A=i.getViewport(a),E=i.getViewState(a);if(A){E.padding=A.padding;const{x:k,y:L,width:z,height:q}=A;v=z3(v,{x:k,y:L,width:z,height:q,viewport:A,viewState:E}),o[a]||(o[a]={viewport:A,children:[]}),o[a].children.push(v)}}return Object.keys(o).map(d=>{const{viewport:a,children:v}=o[d],{x:A,y:E,width:k,height:L}=a,z={position:"absolute",left:A,top:E,width:k,height:L},q=`view-${d}`,Y=ye.createElement("div",{key:q,id:q,style:z},...v),ne={deck:e,viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:ve=>{ve.viewId=d,e._onViewStateChange(ve)},widgets:[]},ue=`view-${d}-context`;return ye.createElement(t,{key:ue,value:ne},Y)})}const P9={mixBlendMode:null};function C9({width:n,height:e,style:t}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},o={left:0,top:0};if(t)for(const c in t)c in P9?o[c]=t[c]:i[c]=t[c];return{containerStyle:i,canvasStyle:o}}function I9(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function U3(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function M9(n,e,t){const i=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:o=>{n.redrawReason=o;const c=i.getViewports();n.lastRenderedViewports!==c?n.forceUpdate():U3(n)}});return i}function R9(n,e){const[t,i]=ye.useState(0),c=ye.useRef({control:null,version:t,forceUpdate:()=>i(Ne=>Ne+1)}).current,d=ye.useRef(null),a=ye.useRef(null),v=ye.useMemo(()=>T9(n),[n.layers,n.views,n.children]);let A=!0;const E=Ne=>A&&n.viewState?(c.viewStateUpdateRequested=Ne,null):(c.viewStateUpdateRequested=null,n.onViewStateChange?.(Ne)),k=Ne=>{A?c.interactionStateUpdateRequested=Ne:(c.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(Ne))},L=ye.useMemo(()=>{const Ne={widgets:[],...n,style:null,width:"100%",height:"100%",parent:d.current,canvas:a.current,layers:v.layers,views:v.views,onViewStateChange:E,onInteractionStateChange:k};return delete Ne._customRender,c.deck&&c.deck.setProps(Ne),Ne},[n]);ye.useEffect(()=>{const Ne=n.Deck||Qb;return c.deck=M9(c,Ne,{...L,parent:d.current,canvas:a.current}),()=>c.deck?.finalize()},[]),v9(()=>{U3(c);const{viewStateUpdateRequested:Ne,interactionStateUpdateRequested:nt}=c;Ne&&E(Ne),nt&&k(nt)}),ye.useImperativeHandle(e,()=>I9(c),[]);const z=c.deck&&c.deck.isInitialized?c.deck.getViewports():void 0,{ContextProvider:q,width:Y="100%",height:ne="100%",id:ue,style:ve}=n,{containerStyle:se,canvasStyle:Se}=ye.useMemo(()=>C9({width:Y,height:ne,style:ve}),[Y,ne,ve]);if(!c.viewStateUpdateRequested&&c.lastRenderedViewports===z||c.version!==t){c.lastRenderedViewports=z,c.version=t;const Ne=E9({children:v.children,deck:c.deck,ContextProvider:q}),nt=ye.createElement("canvas",{key:"canvas",id:ue||"deckgl-overlay",ref:a,style:Se});c.control=ye.createElement("div",{id:`${ue||"deckgl"}-wrapper`,ref:d,style:se},[nt,Ne])}return A=!1,c.control}const k9=ye.forwardRef(R9),D9=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function O9(n,e=!1,t=Float32Array){let i;if(Number.isFinite(n[0]))i=new t(n);else{i=new t(n.length*4);let o=0;for(let c=0;c<n.length;c++){const d=n[c];i[o++]=d[0],i[o++]=d[1],i[o++]=d[2],i[o++]=Number.isFinite(d[3])?d[3]:255}}if(e)for(let o=0;o<i.length;o++)i[o]/=255;return i}const zS=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,L9={name:"icon",vs:zS,fs:zS,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},F9=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,N9=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,B9=1024,z9=4,US=()=>{},jS={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},U9={x:0,y:0,width:0,height:0};function j9(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function V9(n,e,t,i){const o=Math.min(t/e.width,i/e.height),c=Math.floor(e.width*o),d=Math.floor(e.height*o);return o===1?{image:e,width:c,height:d}:(n.canvas.height=d,n.canvas.width=c,n.clearRect(0,0,c,d),n.drawImage(e,0,0,e.width,e.height,0,0,c,d),{image:n.canvas,width:c,height:d})}function pg(n){return n&&(n.id||n.url)}function $9(n,e,t,i){const{width:o,height:c,device:d}=n,a=d.createTexture({format:"rgba8unorm",width:e,height:t,sampler:i,mipmaps:!0}),v=d.createCommandEncoder();return v.copyTextureToTexture({sourceTexture:n,destinationTexture:a,width:o,height:c}),v.finish(),n.destroy(),a}function VS(n,e,t){for(let i=0;i<e.length;i++){const{icon:o,xOffset:c}=e[i],d=pg(o);n[d]={...o,x:c,y:t}}}function W9({icons:n,buffer:e,mapping:t={},xOffset:i=0,yOffset:o=0,rowHeight:c=0,canvasWidth:d}){let a=[];for(let v=0;v<n.length;v++){const A=n[v],E=pg(A);if(!t[E]){const{height:k,width:L}=A;i+L+e>d&&(VS(t,a,o),i=0,o=c+o+e,c=0,a=[]),a.push({icon:A,xOffset:i}),i=i+L+e,c=Math.max(c,k)}}return a.length>0&&VS(t,a,o),{mapping:t,rowHeight:c,xOffset:i,yOffset:o,canvasWidth:d,canvasHeight:j9(c+o+e)}}function H9(n,e,t){if(!n||!e)return null;t=t||{};const i={},{iterable:o,objectInfo:c}=Vy(n);for(const d of o){c.index++;const a=e(d,c),v=pg(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[v]&&(!t[v]||a.url!==t[v].url)&&(i[v]={...a,source:d,sourceIndex:c.index})}return i}class Z9{constructor(e,{onUpdate:t=US,onError:i=US}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=z9,this._canvasWidth=B9,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?pg(e):e;return this._mapping[t]||U9}setProps({loadOptions:e,autoPacking:t,iconAtlas:i,iconMapping:o,textureParameters:c}){e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),o&&(this._mapping=o),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),c&&(this._samplerParameters=c)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(H9(e,t,this._mapping)||{});if(i.length>0){const{mapping:o,xOffset:c,yOffset:d,rowHeight:a,canvasHeight:v}=W9({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=o,this._xOffset=c,this._yOffset=d,this._canvasHeight=v,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||jS,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=$9(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||jS)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,ty(i.url,this._loadOptions).then(o=>{const c=pg(i),d=this._mapping[c],{x:a,y:v,width:A,height:E}=d,{image:k,width:L,height:z}=V9(t,o,A,E);this._texture?.copyExternalImage({image:k,x:a+(A-L)/2,y:v+(E-z)/2,width:L,height:z}),d.width=L,d.height=z,this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}}const j3=[0,0,0,255],X9={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:j3},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class rw extends Mu{getShaders(){return super.getShaders({vs:F9,fs:N9,modules:[Bp,zy,L9]})}initializeState(){this.state={iconManager:new Z9(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:j3},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:o}=e,c=this.getAttributeManager(),{iconAtlas:d,iconMapping:a,data:v,getIcon:A,textureParameters:E}=t,{iconManager:k}=this.state;if(typeof d=="string")return;const L=d||this.internalState.isAsyncPropLoading("iconAtlas");k.setProps({loadOptions:t.loadOptions,autoPacking:!L,iconAtlas:d,iconMapping:L?a:null,textureParameters:E}),L?i.iconMapping!==t.iconMapping&&c.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&k.packIcons(v,A),o.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),c.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:i,sizeMaxPixels:o,sizeUnits:c,billboard:d,alphaCutoff:a}=this.props,{iconManager:v}=this.state,A=v.getTexture();if(A){const E=this.state.model,k={iconsTexture:A,iconsTextureDim:[A.width,A.height],sizeUnits:Mh[c],sizeScale:t,sizeMinPixels:i,sizeMaxPixels:o,billboard:d,alphaCutoff:a};E.shaderInputs.setProps({icon:k}),E.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Oa(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new fg({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):xi.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:i,anchorX:o=t/2,anchorY:c=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-o,i/2-c]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:i,width:o,height:c}=this.state.iconManager.getIconMapping(e);return[t,i,o,c]}}rw.defaultProps=X9;rw.layerName="IconLayer";const $S=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,q9={name:"scatterplot",vs:$S,fs:$S,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},G9=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Y9=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,K9=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,WS=[0,0,0,255],J9={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:WS},getLineColor:{type:"accessor",value:WS},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class vy extends Mu{getShaders(){return super.getShaders({vs:G9,fs:Y9,source:K9,modules:[Bp,zy,q9]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:o,radiusMaxPixels:c,stroked:d,filled:a,billboard:v,antialiasing:A,lineWidthUnits:E,lineWidthScale:k,lineWidthMinPixels:L,lineWidthMaxPixels:z}=this.props,q={stroked:d,filled:a,billboard:v,antialiasing:A,radiusUnits:Mh[t],radiusScale:i,radiusMinPixels:o,radiusMaxPixels:c,lineWidthUnits:Mh[E],lineWidthScale:k,lineWidthMinPixels:L,lineWidthMaxPixels:z},Y=this.state.model;Y.shaderInputs.setProps({scatterplot:q}),Y.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Oa(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new fg({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}vy.defaultProps=J9;vy.layerName="ScatterplotLayer";const V3={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function $3(n,e,t={}){return Q9(n,t)!==e?(t7(n,t),!0):!1}function Q9(n,e={}){return Math.sign(e7(n,e))}const HS={x:0,y:1,z:2};function e7(n,e={}){const{start:t=0,end:i=n.length,plane:o="xy"}=e,c=e.size||2;let d=0;const a=HS[o[0]],v=HS[o[1]];for(let A=t,E=i-c;A<i;A+=c)d+=(n[A+a]-n[E+a])*(n[A+v]+n[E+v]),E=A;return d/2}function t7(n,e){const{start:t=0,end:i=n.length,size:o=2}=e,c=(i-t)/o,d=Math.floor(c/2);for(let a=0;a<d;++a){const v=t+a*o,A=t+(c-1-a)*o;for(let E=0;E<o;++E){const k=n[v+E];n[v+E]=n[A+E],n[A+E]=k}}}function Pl(n,e){const t=e.length,i=n.length;if(i>0){let o=!0;for(let c=0;c<t;c++)if(n[i-t+c]!==e[c]){o=!1;break}if(o)return!1}for(let o=0;o<t;o++)n[i+o]=e[o];return!0}function Ix(n,e){const t=e.length;for(let i=0;i<t;i++)n[i]=e[i]}function mg(n,e,t,i,o=[]){const c=i+e*t;for(let d=0;d<t;d++)o[d]=n[c+d];return o}function Mx(n,e,t,i,o=[]){let c,d;if(t&8)c=(i[3]-n[1])/(e[1]-n[1]),d=3;else if(t&4)c=(i[1]-n[1])/(e[1]-n[1]),d=1;else if(t&2)c=(i[2]-n[0])/(e[0]-n[0]),d=2;else if(t&1)c=(i[0]-n[0])/(e[0]-n[0]),d=0;else return null;for(let a=0;a<n.length;a++)o[a]=(d&1)===a?i[d]:c*(e[a]-n[a])+n[a];return o}function W_(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function W3(n,e){const{size:t=2,broken:i=!1,gridResolution:o=10,gridOffset:c=[0,0],startIndex:d=0,endIndex:a=n.length}=e||{},v=(a-d)/t;let A=[];const E=[A],k=mg(n,0,t,d);let L,z;const q=Z3(k,o,c,[]),Y=[];Pl(A,k);for(let ne=1;ne<v;ne++){for(L=mg(n,ne,t,d,L),z=W_(L,q);z;){Mx(k,L,z,q,Y);const ue=W_(Y,q);ue&&(Mx(k,Y,ue,q,Y),z=ue),Pl(A,Y),Ix(k,Y),i7(q,o,z),i&&A.length>t&&(A=[],E.push(A),Pl(A,k)),z=W_(L,q)}Pl(A,L),Ix(k,L)}return i?E:E[0]}const ZS=0,n7=1;function H3(n,e=null,t){if(!n.length)return[];const{size:i=2,gridResolution:o=10,gridOffset:c=[0,0],edgeTypes:d=!1}=t||{},a=[],v=[{pos:n,types:d?new Array(n.length/i).fill(n7):null,holes:e||[]}],A=[[],[]];let E=[];for(;v.length;){const{pos:k,types:L,holes:z}=v.shift();r7(k,i,z[0]||k.length,A),E=Z3(A[0],o,c,E);const q=W_(A[1],E);if(q){let Y=XS(k,L,i,0,z[0]||k.length,E,q);const ne={pos:Y[0].pos,types:Y[0].types,holes:[]},ue={pos:Y[1].pos,types:Y[1].types,holes:[]};v.push(ne,ue);for(let ve=0;ve<z.length;ve++)Y=XS(k,L,i,z[ve],z[ve+1]||k.length,E,q),Y[0]&&(ne.holes.push(ne.pos.length),ne.pos=A_(ne.pos,Y[0].pos),d&&(ne.types=A_(ne.types,Y[0].types))),Y[1]&&(ue.holes.push(ue.pos.length),ue.pos=A_(ue.pos,Y[1].pos),d&&(ue.types=A_(ue.types,Y[1].types)))}else{const Y={positions:k};d&&(Y.edgeTypes=L),z.length&&(Y.holeIndices=z),a.push(Y)}}return a}function XS(n,e,t,i,o,c,d){const a=(o-i)/t,v=[],A=[],E=[],k=[],L=[];let z,q,Y;const ne=mg(n,a-1,t,i);let ue=Math.sign(d&8?ne[1]-c[3]:ne[0]-c[2]),ve=e&&e[a-1],se=0,Se=0;for(let Ne=0;Ne<a;Ne++)z=mg(n,Ne,t,i,z),q=Math.sign(d&8?z[1]-c[3]:z[0]-c[2]),Y=e&&e[i/t+Ne],q&&ue&&ue!==q&&(Mx(ne,z,d,c,L),Pl(v,L)&&E.push(ve),Pl(A,L)&&k.push(ve)),q<=0?(Pl(v,z)&&E.push(Y),se-=q):E.length&&(E[E.length-1]=ZS),q>=0?(Pl(A,z)&&k.push(Y),Se+=q):k.length&&(k[k.length-1]=ZS),Ix(ne,z),ue=q,ve=Y;return[se?{pos:v,types:e&&E}:null,Se?{pos:A,types:e&&k}:null]}function Z3(n,e,t,i){const o=Math.floor((n[0]-t[0])/e)*e+t[0],c=Math.floor((n[1]-t[1])/e)*e+t[1];return i[0]=o,i[1]=c,i[2]=o+e,i[3]=c+e,i}function i7(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function r7(n,e,t,i){let o=1/0,c=-1/0,d=1/0,a=-1/0;for(let v=0;v<t;v+=e){const A=n[v],E=n[v+1];o=A<o?A:o,c=A>c?A:c,d=E<d?E:d,a=E>a?E:a}return i[0][0]=o,i[0][1]=d,i[1][0]=c,i[1][1]=a,i}function A_(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const s7=85.051129;function o7(n,e){const{size:t=2,startIndex:i=0,endIndex:o=n.length,normalize:c=!0}=e||{},d=n.slice(i,o);X3(d,t,0,o-i);const a=W3(d,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(c)for(const v of a)q3(v,t);return a}function a7(n,e=null,t){const{size:i=2,normalize:o=!0,edgeTypes:c=!1}=t||{};e=e||[];const d=[],a=[];let v=0,A=0;for(let k=0;k<=e.length;k++){const L=e[k]||n.length,z=A,q=l7(n,i,v,L);for(let Y=q;Y<L;Y++)d[A++]=n[Y];for(let Y=v;Y<q;Y++)d[A++]=n[Y];X3(d,i,z,A),c7(d,i,z,A,t?.maxLatitude),v=L,a[k]=A}a.pop();const E=H3(d,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:c});if(o)for(const k of E)q3(k.positions,i);return E}function l7(n,e,t,i){let o=-1,c=-1;for(let d=t+1;d<i;d+=e){const a=Math.abs(n[d]);a>o&&(o=a,c=d-1)}return c}function c7(n,e,t,i,o=s7){const c=n[t],d=n[i-e];if(Math.abs(c-d)>180){const a=mg(n,0,e,t);a[0]+=Math.round((d-c)/360)*360,Pl(n,a),a[1]=Math.sign(a[1])*o,Pl(n,a),a[0]=c,Pl(n,a)}}function X3(n,e,t,i){let o=n[0],c;for(let d=t;d<i;d+=e){c=n[d];const a=c-o;(a>180||a<-180)&&(c-=Math.round(a/360)*360),n[d]=o=c}}function q3(n,e){let t;const i=n.length/e;for(let c=0;c<i&&(t=n[c*e],(t+180)%360===0);c++);const o=-Math.round(t/360)*360;if(o!==0)for(let c=0;c<i;c++)n[c*e]+=o}function u7(n,e,t,i){let o;if(Array.isArray(n[0])){const c=n.length*e;o=new Array(c);for(let d=0;d<n.length;d++)for(let a=0;a<e;a++)o[d*e+a]=n[d][a]||0}else o=n;return t?W3(o,{size:e,gridResolution:t}):i?o7(o,{size:e}):o}const h7=1,d7=2,b0=4;class f7 extends B3{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?u7(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(qS(e)){let i=0;for(const o of e)i+=this.getGeometrySize(o);return i}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&qS(e))for(const i of e){const o=this.getGeometrySize(i);t.geometrySize=o,this.updateGeometryAttributes(i,t),t.vertexStart+=o}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const i=this.attributes.segmentTypes,o=e?this.isClosed(e):!1,{vertexStart:c,geometrySize:d}=t;i.fill(0,c,c+d),o?(i[c]=b0,i[c+d-2]=b0):(i[c]+=h7,i[c+d-2]+=d7),i[c+d-1]=b0}_updatePositions(e,t){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:o,geometrySize:c}=t,d=new Array(3);for(let a=o,v=0;v<c;a++,v++)this.getPointOnPath(e,v,d),i[a*3]=d[0],i[a*3+1]=d[1],i[a*3+2]=d[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){const{positionSize:o}=this;t*o>=e.length&&(t+=1-e.length/o);const c=t*o;return i[0]=e[c],i[1]=e[c+1],i[2]=o===3&&e[c+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(t===2||e[2]===e[i+2])}}function qS(n){return Array.isArray(n[0])}const GS=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,p7={name:"path",vs:GS,fs:GS,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},m7=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,g7=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,G3=[0,0,0,255],_7={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:G3},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},w0={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class sw extends Mu{getShaders(){return super.getShaders({vs:m7,fs:g7,modules:[Bp,zy,p7]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:w0,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:w0,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:w0,defaultValue:G3},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:o,target:c})=>this.encodePickingColor(i&&i.__source?i.__source.index:o,c)}}),this.setState({pathTesselator:new f7({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:i}=e,o=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:d}=this.state,a=t.data.attributes||{};d.updateGeometry({data:t.data,geometryBuffer:a.getPath,buffers:a,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:d.instanceCount,startIndices:d.vertexStarts}),i.dataChanged||o.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,o=this.props.data;return o[0]&&o[0].__source&&(t.object=o.find(c=>c.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:i,billboard:o,miterLimit:c,widthUnits:d,widthScale:a,widthMinPixels:v,widthMaxPixels:A}=this.props,E=this.state.model,k={jointType:Number(t),capType:Number(i),billboard:o,widthUnits:Mh[d],widthScale:a,miterLimit:c,widthMinPixels:v,widthMaxPixels:A};E.shaderInputs.setProps({path:k}),E.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Oa(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new fg({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}sw.defaultProps=_7;sw.layerName="PathLayer";var E_={exports:{}},YS;function y7(){if(YS)return E_.exports;YS=1,E_.exports=n,E_.exports.default=n;function n(Pe,ke,ge){ge=ge||2;var Ue=ke&&ke.length,$e=Ue?ke[0]*ge:Pe.length,de=e(Pe,0,$e,ge,!0),De=[];if(!de||de.next===de.prev)return De;var ut,Et,It,$t,Qt,Ut,an;if(Ue&&(de=v(Pe,ke,de,ge)),Pe.length>80*ge){ut=It=Pe[0],Et=$t=Pe[1];for(var _n=ge;_n<$e;_n+=ge)Qt=Pe[_n],Ut=Pe[_n+1],Qt<ut&&(ut=Qt),Ut<Et&&(Et=Ut),Qt>It&&(It=Qt),Ut>$t&&($t=Ut);an=Math.max(It-ut,$t-Et),an=an!==0?32767/an:0}return i(de,De,ge,ut,Et,an,0),De}function e(Pe,ke,ge,Ue,$e){var de,De;if($e===kn(Pe,ke,ge,Ue)>0)for(de=ke;de<ge;de+=Ue)De=pn(de,Pe[de],Pe[de+1],De);else for(de=ge-Ue;de>=ke;de-=Ue)De=pn(de,Pe[de],Pe[de+1],De);return De&&Se(De,De.next)&&(sn(De),De=De.next),De}function t(Pe,ke){if(!Pe)return Pe;ke||(ke=Pe);var ge=Pe,Ue;do if(Ue=!1,!ge.steiner&&(Se(ge,ge.next)||se(ge.prev,ge,ge.next)===0)){if(sn(ge),ge=ke=ge.prev,ge===ge.next)break;Ue=!0}else ge=ge.next;while(Ue||ge!==ke);return ke}function i(Pe,ke,ge,Ue,$e,de,De){if(Pe){!De&&de&&z(Pe,Ue,$e,de);for(var ut=Pe,Et,It;Pe.prev!==Pe.next;){if(Et=Pe.prev,It=Pe.next,de?c(Pe,Ue,$e,de):o(Pe)){ke.push(Et.i/ge|0),ke.push(Pe.i/ge|0),ke.push(It.i/ge|0),sn(Pe),Pe=It.next,ut=It.next;continue}if(Pe=It,Pe===ut){De?De===1?(Pe=d(t(Pe),ke,ge),i(Pe,ke,ge,Ue,$e,de,2)):De===2&&a(Pe,ke,ge,Ue,$e,de):i(t(Pe),ke,ge,Ue,$e,de,1);break}}}}function o(Pe){var ke=Pe.prev,ge=Pe,Ue=Pe.next;if(se(ke,ge,Ue)>=0)return!1;for(var $e=ke.x,de=ge.x,De=Ue.x,ut=ke.y,Et=ge.y,It=Ue.y,$t=$e<de?$e<De?$e:De:de<De?de:De,Qt=ut<Et?ut<It?ut:It:Et<It?Et:It,Ut=$e>de?$e>De?$e:De:de>De?de:De,an=ut>Et?ut>It?ut:It:Et>It?Et:It,_n=Ue.next;_n!==ke;){if(_n.x>=$t&&_n.x<=Ut&&_n.y>=Qt&&_n.y<=an&&ue($e,ut,de,Et,De,It,_n.x,_n.y)&&se(_n.prev,_n,_n.next)>=0)return!1;_n=_n.next}return!0}function c(Pe,ke,ge,Ue){var $e=Pe.prev,de=Pe,De=Pe.next;if(se($e,de,De)>=0)return!1;for(var ut=$e.x,Et=de.x,It=De.x,$t=$e.y,Qt=de.y,Ut=De.y,an=ut<Et?ut<It?ut:It:Et<It?Et:It,_n=$t<Qt?$t<Ut?$t:Ut:Qt<Ut?Qt:Ut,Gi=ut>Et?ut>It?ut:It:Et>It?Et:It,Ii=$t>Qt?$t>Ut?$t:Ut:Qt>Ut?Qt:Ut,Hn=Y(an,_n,ke,ge,Ue),ri=Y(Gi,Ii,ke,ge,Ue),xt=Pe.prevZ,Pt=Pe.nextZ;xt&&xt.z>=Hn&&Pt&&Pt.z<=ri;){if(xt.x>=an&&xt.x<=Gi&&xt.y>=_n&&xt.y<=Ii&&xt!==$e&&xt!==De&&ue(ut,$t,Et,Qt,It,Ut,xt.x,xt.y)&&se(xt.prev,xt,xt.next)>=0||(xt=xt.prevZ,Pt.x>=an&&Pt.x<=Gi&&Pt.y>=_n&&Pt.y<=Ii&&Pt!==$e&&Pt!==De&&ue(ut,$t,Et,Qt,It,Ut,Pt.x,Pt.y)&&se(Pt.prev,Pt,Pt.next)>=0))return!1;Pt=Pt.nextZ}for(;xt&&xt.z>=Hn;){if(xt.x>=an&&xt.x<=Gi&&xt.y>=_n&&xt.y<=Ii&&xt!==$e&&xt!==De&&ue(ut,$t,Et,Qt,It,Ut,xt.x,xt.y)&&se(xt.prev,xt,xt.next)>=0)return!1;xt=xt.prevZ}for(;Pt&&Pt.z<=ri;){if(Pt.x>=an&&Pt.x<=Gi&&Pt.y>=_n&&Pt.y<=Ii&&Pt!==$e&&Pt!==De&&ue(ut,$t,Et,Qt,It,Ut,Pt.x,Pt.y)&&se(Pt.prev,Pt,Pt.next)>=0)return!1;Pt=Pt.nextZ}return!0}function d(Pe,ke,ge){var Ue=Pe;do{var $e=Ue.prev,de=Ue.next.next;!Se($e,de)&&Ne($e,Ue,Ue.next,de)&&vt($e,de)&&vt(de,$e)&&(ke.push($e.i/ge|0),ke.push(Ue.i/ge|0),ke.push(de.i/ge|0),sn(Ue),sn(Ue.next),Ue=Pe=de),Ue=Ue.next}while(Ue!==Pe);return t(Ue)}function a(Pe,ke,ge,Ue,$e,de){var De=Pe;do{for(var ut=De.next.next;ut!==De.prev;){if(De.i!==ut.i&&ve(De,ut)){var Et=Wt(De,ut);De=t(De,De.next),Et=t(Et,Et.next),i(De,ke,ge,Ue,$e,de,0),i(Et,ke,ge,Ue,$e,de,0);return}ut=ut.next}De=De.next}while(De!==Pe)}function v(Pe,ke,ge,Ue){var $e=[],de,De,ut,Et,It;for(de=0,De=ke.length;de<De;de++)ut=ke[de]*Ue,Et=de<De-1?ke[de+1]*Ue:Pe.length,It=e(Pe,ut,Et,Ue,!1),It===It.next&&(It.steiner=!0),$e.push(ne(It));for($e.sort(A),de=0;de<$e.length;de++)ge=E($e[de],ge);return ge}function A(Pe,ke){return Pe.x-ke.x}function E(Pe,ke){var ge=k(Pe,ke);if(!ge)return ke;var Ue=Wt(ge,Pe);return t(Ue,Ue.next),t(ge,ge.next)}function k(Pe,ke){var ge=ke,Ue=Pe.x,$e=Pe.y,de=-1/0,De;do{if($e<=ge.y&&$e>=ge.next.y&&ge.next.y!==ge.y){var ut=ge.x+($e-ge.y)*(ge.next.x-ge.x)/(ge.next.y-ge.y);if(ut<=Ue&&ut>de&&(de=ut,De=ge.x<ge.next.x?ge:ge.next,ut===Ue))return De}ge=ge.next}while(ge!==ke);if(!De)return null;var Et=De,It=De.x,$t=De.y,Qt=1/0,Ut;ge=De;do Ue>=ge.x&&ge.x>=It&&Ue!==ge.x&&ue($e<$t?Ue:de,$e,It,$t,$e<$t?de:Ue,$e,ge.x,ge.y)&&(Ut=Math.abs($e-ge.y)/(Ue-ge.x),vt(ge,Pe)&&(Ut<Qt||Ut===Qt&&(ge.x>De.x||ge.x===De.x&&L(De,ge)))&&(De=ge,Qt=Ut)),ge=ge.next;while(ge!==Et);return De}function L(Pe,ke){return se(Pe.prev,Pe,ke.prev)<0&&se(ke.next,Pe,Pe.next)<0}function z(Pe,ke,ge,Ue){var $e=Pe;do $e.z===0&&($e.z=Y($e.x,$e.y,ke,ge,Ue)),$e.prevZ=$e.prev,$e.nextZ=$e.next,$e=$e.next;while($e!==Pe);$e.prevZ.nextZ=null,$e.prevZ=null,q($e)}function q(Pe){var ke,ge,Ue,$e,de,De,ut,Et,It=1;do{for(ge=Pe,Pe=null,de=null,De=0;ge;){for(De++,Ue=ge,ut=0,ke=0;ke<It&&(ut++,Ue=Ue.nextZ,!!Ue);ke++);for(Et=It;ut>0||Et>0&&Ue;)ut!==0&&(Et===0||!Ue||ge.z<=Ue.z)?($e=ge,ge=ge.nextZ,ut--):($e=Ue,Ue=Ue.nextZ,Et--),de?de.nextZ=$e:Pe=$e,$e.prevZ=de,de=$e;ge=Ue}de.nextZ=null,It*=2}while(De>1);return Pe}function Y(Pe,ke,ge,Ue,$e){return Pe=(Pe-ge)*$e|0,ke=(ke-Ue)*$e|0,Pe=(Pe|Pe<<8)&16711935,Pe=(Pe|Pe<<4)&252645135,Pe=(Pe|Pe<<2)&858993459,Pe=(Pe|Pe<<1)&1431655765,ke=(ke|ke<<8)&16711935,ke=(ke|ke<<4)&252645135,ke=(ke|ke<<2)&858993459,ke=(ke|ke<<1)&1431655765,Pe|ke<<1}function ne(Pe){var ke=Pe,ge=Pe;do(ke.x<ge.x||ke.x===ge.x&&ke.y<ge.y)&&(ge=ke),ke=ke.next;while(ke!==Pe);return ge}function ue(Pe,ke,ge,Ue,$e,de,De,ut){return($e-De)*(ke-ut)>=(Pe-De)*(de-ut)&&(Pe-De)*(Ue-ut)>=(ge-De)*(ke-ut)&&(ge-De)*(de-ut)>=($e-De)*(Ue-ut)}function ve(Pe,ke){return Pe.next.i!==ke.i&&Pe.prev.i!==ke.i&&!gt(Pe,ke)&&(vt(Pe,ke)&&vt(ke,Pe)&&Ft(Pe,ke)&&(se(Pe.prev,Pe,ke.prev)||se(Pe,ke.prev,ke))||Se(Pe,ke)&&se(Pe.prev,Pe,Pe.next)>0&&se(ke.prev,ke,ke.next)>0)}function se(Pe,ke,ge){return(ke.y-Pe.y)*(ge.x-ke.x)-(ke.x-Pe.x)*(ge.y-ke.y)}function Se(Pe,ke){return Pe.x===ke.x&&Pe.y===ke.y}function Ne(Pe,ke,ge,Ue){var $e=dt(se(Pe,ke,ge)),de=dt(se(Pe,ke,Ue)),De=dt(se(ge,Ue,Pe)),ut=dt(se(ge,Ue,ke));return!!($e!==de&&De!==ut||$e===0&&nt(Pe,ge,ke)||de===0&&nt(Pe,Ue,ke)||De===0&&nt(ge,Pe,Ue)||ut===0&&nt(ge,ke,Ue))}function nt(Pe,ke,ge){return ke.x<=Math.max(Pe.x,ge.x)&&ke.x>=Math.min(Pe.x,ge.x)&&ke.y<=Math.max(Pe.y,ge.y)&&ke.y>=Math.min(Pe.y,ge.y)}function dt(Pe){return Pe>0?1:Pe<0?-1:0}function gt(Pe,ke){var ge=Pe;do{if(ge.i!==Pe.i&&ge.next.i!==Pe.i&&ge.i!==ke.i&&ge.next.i!==ke.i&&Ne(ge,ge.next,Pe,ke))return!0;ge=ge.next}while(ge!==Pe);return!1}function vt(Pe,ke){return se(Pe.prev,Pe,Pe.next)<0?se(Pe,ke,Pe.next)>=0&&se(Pe,Pe.prev,ke)>=0:se(Pe,ke,Pe.prev)<0||se(Pe,Pe.next,ke)<0}function Ft(Pe,ke){var ge=Pe,Ue=!1,$e=(Pe.x+ke.x)/2,de=(Pe.y+ke.y)/2;do ge.y>de!=ge.next.y>de&&ge.next.y!==ge.y&&$e<(ge.next.x-ge.x)*(de-ge.y)/(ge.next.y-ge.y)+ge.x&&(Ue=!Ue),ge=ge.next;while(ge!==Pe);return Ue}function Wt(Pe,ke){var ge=new rn(Pe.i,Pe.x,Pe.y),Ue=new rn(ke.i,ke.x,ke.y),$e=Pe.next,de=ke.prev;return Pe.next=ke,ke.prev=Pe,ge.next=$e,$e.prev=ge,Ue.next=ge,ge.prev=Ue,de.next=Ue,Ue.prev=de,Ue}function pn(Pe,ke,ge,Ue){var $e=new rn(Pe,ke,ge);return Ue?($e.next=Ue.next,$e.prev=Ue,Ue.next.prev=$e,Ue.next=$e):($e.prev=$e,$e.next=$e),$e}function sn(Pe){Pe.next.prev=Pe.prev,Pe.prev.next=Pe.next,Pe.prevZ&&(Pe.prevZ.nextZ=Pe.nextZ),Pe.nextZ&&(Pe.nextZ.prevZ=Pe.prevZ)}function rn(Pe,ke,ge){this.i=Pe,this.x=ke,this.y=ge,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(Pe,ke,ge,Ue){var $e=ke&&ke.length,de=$e?ke[0]*ge:Pe.length,De=Math.abs(kn(Pe,0,de,ge));if($e)for(var ut=0,Et=ke.length;ut<Et;ut++){var It=ke[ut]*ge,$t=ut<Et-1?ke[ut+1]*ge:Pe.length;De-=Math.abs(kn(Pe,It,$t,ge))}var Qt=0;for(ut=0;ut<Ue.length;ut+=3){var Ut=Ue[ut]*ge,an=Ue[ut+1]*ge,_n=Ue[ut+2]*ge;Qt+=Math.abs((Pe[Ut]-Pe[_n])*(Pe[an+1]-Pe[Ut+1])-(Pe[Ut]-Pe[an])*(Pe[_n+1]-Pe[Ut+1]))}return De===0&&Qt===0?0:Math.abs((Qt-De)/De)};function kn(Pe,ke,ge,Ue){for(var $e=0,de=ke,De=ge-Ue;de<ge;de+=Ue)$e+=(Pe[De]-Pe[de])*(Pe[de+1]+Pe[De+1]),De=de;return $e}return n.flatten=function(Pe){for(var ke=Pe[0][0].length,ge={vertices:[],holes:[],dimensions:ke},Ue=0,$e=0;$e<Pe.length;$e++){for(var de=0;de<Pe[$e].length;de++)for(var De=0;De<ke;De++)ge.vertices.push(Pe[$e][de][De]);$e>0&&(Ue+=Pe[$e-1].length,ge.holes.push(Ue))}return ge},E_.exports}var v7=y7();const x7=Rx(v7),P_=V3.CLOCKWISE,KS=V3.COUNTER_CLOCKWISE,Th={};function b7(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function jm(n){return"positions"in n?n.positions:n}function H_(n){return"holeIndices"in n?n.holeIndices:null}function w7(n){return Array.isArray(n[0])}function T7(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function S7(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function A7(n,e,t,i){for(let o=0;o<e;o++)if(n[t+o]!==n[i-e+o])return!1;return!0}function JS(n,e,t,i,o){let c=e;const d=t.length;for(let a=0;a<d;a++)for(let v=0;v<i;v++)n[c++]=t[a][v]||0;if(!S7(t))for(let a=0;a<i;a++)n[c++]=t[0][a]||0;return Th.start=e,Th.end=c,Th.size=i,$3(n,o,Th),c}function QS(n,e,t,i,o=0,c,d){c=c||t.length;const a=c-o;if(a<=0)return e;let v=e;for(let A=0;A<a;A++)n[v++]=t[o+A];if(!A7(t,i,o,c))for(let A=0;A<i;A++)n[v++]=t[o+A];return Th.start=e,Th.end=v,Th.size=i,$3(n,d,Th),v}function Y3(n,e){b7(n);const t=[],i=[];if("positions"in n){const{positions:o,holeIndices:c}=n;if(c){let d=0;for(let a=0;a<=c.length;a++)d=QS(t,d,o,e,c[a-1],c[a],a===0?P_:KS),i.push(d);return i.pop(),{positions:t,holeIndices:i}}n=o}if(!w7(n))return QS(t,0,n,e,0,t.length,P_),t;if(!T7(n)){let o=0;for(const[c,d]of n.entries())o=JS(t,o,d,e,c===0?P_:KS),i.push(o);return i.pop(),{positions:t,holeIndices:i}}return JS(t,0,n,e,P_),t}function T0(n,e,t){const i=n.length/3;let o=0;for(let c=0;c<i;c++){const d=(c+1)%i;o+=n[c*3+e]*n[d*3+t],o-=n[d*3+e]*n[c*3+t]}return Math.abs(o/2)}function eA(n,e,t,i){const o=n.length/3;for(let c=0;c<o;c++){const d=c*3,a=n[d+0],v=n[d+1],A=n[d+2];n[d+e]=a,n[d+t]=v,n[d+i]=A}}function E7(n,e,t,i){let o=H_(n);o&&(o=o.map(a=>a/e));let c=jm(n);const d=i&&e===3;if(t){const a=c.length;c=c.slice();const v=[];for(let A=0;A<a;A+=e){v[0]=c[A],v[1]=c[A+1],d&&(v[2]=c[A+2]);const E=t(v);c[A]=E[0],c[A+1]=E[1],d&&(c[A+2]=E[2])}}if(d){const a=T0(c,0,1),v=T0(c,0,2),A=T0(c,1,2);if(!a&&!v&&!A)return[];a>v&&a>A||(v>A?(t||(c=c.slice()),eA(c,0,2,1)):(t||(c=c.slice()),eA(c,2,0,1)))}return x7(c,o,e)}class P7 extends B3{constructor(e){const{fp64:t,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=Y3(e,this.positionSize);return this.opts.resolution?H3(jm(t),H_(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?a7(jm(t),H_(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(tA(e)){let t=0;for(const i of e)t+=this.getGeometrySize(i);return t}return jm(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&tA(e))for(const i of e){const o=this.getGeometrySize(i);t.geometrySize=o,this.updateGeometryAttributes(i,t),t.vertexStart+=o,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const i=e;this._updateIndices(i,t),this._updatePositions(i,t),this._updateVertexValid(i,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:i,indexStart:o}){const{attributes:c,indexStarts:d,typedArrayManager:a}=this;let v=c.indices;if(!v||!e)return;let A=o;const E=E7(e,this.positionSize,this.opts.preproject,this.opts.full3d);v=a.allocate(v,o+E.length,{copy:!0});for(let k=0;k<E.length;k++)v[A++]=E[k]+i;d[t+1]=o+E.length,c.indices=v}_updatePositions(e,{vertexStart:t,geometrySize:i}){const{attributes:{positions:o},positionSize:c}=this;if(!o||!e)return;const d=jm(e);for(let a=t,v=0;v<i;a++,v++){const A=d[v*c],E=d[v*c+1],k=c>2?d[v*c+2]:0;o[a*3]=A,o[a*3+1]=E,o[a*3+2]=k}}_updateVertexValid(e,{vertexStart:t,geometrySize:i}){const{positionSize:o}=this,c=this.attributes.vertexValid,d=e&&H_(e);if(e&&e.edgeTypes?c.set(e.edgeTypes,t):c.fill(1,t,t+i),d)for(let a=0;a<d.length;a++)c[t+d[a]/o-1]=0;c[t+i-1]=0}}function tA(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const nA=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,C7={name:"solidPolygon",vs:nA,fs:nA,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},K3=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,I7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${K3}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,M7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${K3}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,R7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,xy=[0,0,0,255],k7={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:xy},getLineColor:{type:"accessor",value:xy},material:!0},C_={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class ow extends Mu{getShaders(e){return super.getShaders({vs:e==="top"?I7:M7,fs:R7,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Bp,RC,zy,C7]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:i}=this.props;e.isGeospatial&&t===Wn.DEFAULT&&(t=Wn.LNGLAT);let o;t===Wn.LNGLAT&&(i?o=e.projectPosition.bind(e):o=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new P7({preproject:o,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const c=this.getAttributeManager(),d=!0;c.remove(["instancePickingColors"]),c.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:d},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:C_,accessor:"getPolygon",update:this.calculatePositions,noAlloc:d,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:d},elevations:{size:1,stepMode:"dynamic",transition:C_,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:C_,accessor:"getFillColor",defaultValue:xy},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:C_,accessor:"getLineColor",defaultValue:xy},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:v,target:A})=>this.encodePickingColor(a&&a.__source?a.__source.index:v,A)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,o=this.props.data;return o[0]&&o[0].__source&&(t.object=o.find(c=>c.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:i,wireframe:o,elevationScale:c}=this.props,{topModel:d,sideModel:a,wireframeModel:v,polygonTesselator:A}=this.state,E={extruded:!!t,elevationScale:c,isWireframe:!1};v&&o&&(v.setInstanceCount(A.instanceCount-1),v.shaderInputs.setProps({solidPolygon:{...E,isWireframe:!0}}),v.draw(this.context.renderPass)),a&&i&&(a.setInstanceCount(A.instanceCount-1),a.shaderInputs.setProps({solidPolygon:E}),a.draw(this.context.renderPass)),d&&i&&(d.setVertexCount(A.vertexCount),d.shaderInputs.setProps({solidPolygon:E}),d.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:i,changeFlags:o}=e,c=this.getAttributeManager();(o.extensionsChanged||t.filled!==i.filled||t.extruded!==i.extruded)&&(this.state.models?.forEach(a=>a.destroy()),this.setState(this._getModels()),c.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:c}=this.state,d=e.data.attributes||{};c.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:d.getPolygon,buffers:d,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:i}=this.props;let o,c,d;if(t){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const v=this.getAttributeManager().getBufferLayouts({isInstanced:!1});o=new Oa(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",bufferLayout:v,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});c=new Oa(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,geometry:new fg({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),d=new Oa(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,geometry:new fg({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[c,d,o].filter(Boolean),topModel:o,sideModel:c,wireframeModel:d}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}ow.defaultProps=k7;ow.layerName="SolidPolygonLayer";function D7({data:n,getIndex:e,dataRange:t,replace:i}){const{startRow:o=0,endRow:c=1/0}=t,d=n.length;let a=d,v=d;for(let L=0;L<d;L++){const z=e(n[L]);if(a>L&&z>=o&&(a=L),z>=c){v=L;break}}let A=a;const k=v-a!==i.length?n.slice(v):void 0;for(let L=0;L<i.length;L++)n[A++]=i[L];if(k){for(let L=0;L<k.length;L++)n[A++]=k[L];n.length=A}return{startRow:a,endRow:a+i.length}}const J3=[0,0,0,255],O7=[0,0,0,255],L7={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:n=>n.polygon},getFillColor:{type:"accessor",value:O7},getLineColor:{type:"accessor",value:J3},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class aw extends iw{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&xi.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const i=this.state.paths.slice(),o=e.dataChanged.map(c=>D7({data:i,getIndex:d=>d.__source.index,dataRange:c,replace:this._getPaths(c)}));this.setState({paths:i,pathsDiff:o})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:i,positionFormat:o,_normalize:c}=this.props,d=[],a=o==="XY"?2:3,{startRow:v,endRow:A}=e,{iterable:E,objectInfo:k}=Vy(t,v,A);for(const L of E){k.index++;let z=i(L,k);c&&(z=Y3(z,a));const{holeIndices:q}=z,Y=z.positions||z;if(q)for(let ne=0;ne<=q.length;ne++){const ue=Y.slice(q[ne-1]||0,q[ne]||Y.length);d.push(this.getSubLayerRow({path:ue},L,k.index))}else d.push(this.getSubLayerRow({path:Y},L,k.index))}return d}renderLayers(){const{data:e,_dataDiff:t,stroked:i,filled:o,extruded:c,wireframe:d,_normalize:a,_windingOrder:v,elevationScale:A,transitions:E,positionFormat:k}=this.props,{lineWidthUnits:L,lineWidthScale:z,lineWidthMinPixels:q,lineWidthMaxPixels:Y,lineJointRounded:ne,lineMiterLimit:ue,lineDashJustified:ve}=this.props,{getFillColor:se,getLineColor:Se,getLineWidth:Ne,getLineDashArray:nt,getElevation:dt,getPolygon:gt,updateTriggers:vt,material:Ft}=this.props,{paths:Wt,pathsDiff:pn}=this.state,sn=this.getSubLayerClass("fill",ow),rn=this.getSubLayerClass("stroke",sw),kn=this.shouldRenderSubLayer("fill",Wt)&&new sn({_dataDiff:t,extruded:c,elevationScale:A,filled:o,wireframe:d,_normalize:a,_windingOrder:v,getElevation:dt,getFillColor:se,getLineColor:c&&d?Se:J3,material:Ft,transitions:E},this.getSubLayerProps({id:"fill",updateTriggers:vt&&{getPolygon:vt.getPolygon,getElevation:vt.getElevation,getFillColor:vt.getFillColor,lineColors:c&&d,getLineColor:vt.getLineColor}}),{data:e,positionFormat:k,getPolygon:gt}),Pe=!c&&i&&this.shouldRenderSubLayer("stroke",Wt)&&new rn({_dataDiff:pn&&(()=>pn),widthUnits:L,widthScale:z,widthMinPixels:q,widthMaxPixels:Y,jointRounded:ne,miterLimit:ue,dashJustified:ve,_pathType:"loop",transitions:E&&{getWidth:E.getLineWidth,getColor:E.getLineColor,getPath:E.getPolygon},getColor:this.getSubLayerAccessor(Se),getWidth:this.getSubLayerAccessor(Ne),getDashArray:this.getSubLayerAccessor(nt)},this.getSubLayerProps({id:"stroke",updateTriggers:vt&&{getWidth:vt.getLineWidth,getColor:vt.getLineColor,getDashArray:vt.getLineDashArray}}),{data:Wt,positionFormat:k,getPath:ke=>ke.path});return[!c&&kn,Pe,c&&kn]}}aw.layerName="PolygonLayer";aw.defaultProps=L7;function F7(n){const e=n.map(a=>a[0]),t=n.map(a=>a[1]),i=Math.min.apply(null,e),o=Math.max.apply(null,e),c=Math.min.apply(null,t),d=Math.max.apply(null,t);return[i,c,o,d]}function N7(n,e){return e[0]>=n[0]&&e[2]<=n[2]&&e[1]>=n[1]&&e[3]<=n[3]}const iA=new Float32Array(12);function rA(n,e=2){let t=0;for(const i of n)for(let o=0;o<e;o++)iA[t++]=i[o]||0;return iA}function B7(n,e,t){const[i,o,c,d]=n,a=c-i,v=d-o;let A=a,E=v;a/v<e/t?A=e/t*v:E=t/e*a,A<e&&(A=e,E=t);const k=(c+i)/2,L=(d+o)/2;return[k-A/2,L-E/2,k+A/2,L+E/2]}function z7(n,e){const[t,i,o,c]=e;return[(n[0]-t)/(o-t),(n[1]-i)/(c-i)]}const U7=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,j7=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,sA=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,V7={name:"triangle",vs:sA,fs:sA,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class Q3 extends Mu{getShaders(){return super.getShaders({vs:U7,fs:j7,modules:[Bp,V7]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:i}=this.props;return new Oa(e,{...this.getShaders(),id:this.props.id,attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:i,intensity:o,threshold:c,colorTexture:d,maxTexture:a,weightsTexture:v}=this.props,A={aggregationMode:t,colorDomain:i,intensity:o,threshold:c,colorTexture:d,maxTexture:a,weightsTexture:v};e.shaderInputs.setProps({triangle:A}),e.draw(this.context.renderPass)}}Q3.layerName="TriangleLayer";function $7(n,e){const t={};for(const i in n)e.includes(i)||(t[i]=n[i]);return t}class eI extends iw{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:$7(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:i,oldProps:o,changeFlags:c}=e,{compareAll:d=!1,dimension:a}=t,{ignoreProps:v}=this.state,{props:A,accessors:E=[]}=a,{updateTriggersChanged:k}=c;if(c.dataChanged)return!0;if(k){if(k.all)return!0;for(const L of E)if(k[L])return!0}if(d)return c.extensionsChanged?!0:tw({oldProps:o,newProps:i,ignoreProps:v,propTypes:this.constructor._propTypes});for(const L of A)if(i[L]!==o[L])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!W7(t)}_getAttributeManager(){return new ew(this.context.device,{id:this.props.id,stats:this.context.stats})}}eI.layerName="AggregationLayer";function W7(n){let e=!0;for(const t in n){e=!1;break}return e}const oA=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,aA=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,H7=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,Z7=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,X7=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,q7={name:"weight",vs:X7,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},G7={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},Y7=2,S0={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},lA=[0,0],K7={SUM:0,MEAN:1},J7={getPosition:{type:"accessor",value:n=>n.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:D9,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},Q7=["float32-renderable-webgl","texture-blend-float-webgl"],eH={data:{props:["radiusPixels"]}};class lw extends eI{getShaders(e){let t=[Bp];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(eH),this.setState({colorDomain:lA}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:i}=e,o=this._getChangeFlags(e);(o.dataChanged||o.viewportChanged)&&(o.boundsChanged=this._updateBounds(o.dataChanged),this._updateTextureRenderingBounds()),o.dataChanged||o.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):o.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:i,maxWeightsTexture:o,colorTexture:c,colorDomain:d}=this.state,{updateTriggers:a,intensity:v,threshold:A,aggregation:E}=this.props,k=this.getSubLayerClass("triangle",Q3);return new k(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:Wn.DEFAULT,data:{attributes:{positions:t,texCoords:i}},vertexCount:4,maxTexture:o,colorTexture:c,aggregationMode:K7[E]||0,weightsTexture:e,intensity:v,threshold:A,colorDomain:d})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:i,maxWeightTransform:o,maxWeightsTexture:c,triPositionBuffer:d,triTexCoordBuffer:a,colorTexture:v,updateTimer:A}=this.state;t?.destroy(),i?.destroy(),o?.destroy(),c?.destroy(),d?.destroy(),a?.destroy(),v?.destroy(),A&&clearTimeout(A)}_getAttributeManager(){return new ew(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:i}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:o}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==o)&&(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...S0,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...S0,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,i=Math.min(t,e.limits.maxTextureDimension2D),o=Q7.every(a=>e.features.has(a)),c=o?"rgba32float":"rgba8unorm",d=o?1:1/255;this.setState({textureSize:i,format:c,weightsScale:d}),o||xi.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:i}=this.state,o=this.getAttributeManager();t?.destroy(),t=new lS(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:o.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,q7]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:i,maxWeightsTexture:o}=this.state,c=this.getShaders({vs:oA,fs:aA});this._createWeightsTransform(c);const d=this.getShaders({vs:H7,fs:Z7,modules:[G7]}),a=new lS(e,{id:`${this.id}-max-weights-transform`,targetTexture:o,...d,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),v={inTexture:i,textureSize:t};a.model.shaderInputs.setProps({maxWeight:v}),this.setState({weightsTexture:i,maxWeightsTexture:o,maxWeightTransform:a,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:oA,fs:aA,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,i=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(a=>a.map(Math.fround)),o=F7(i),c={visibleWorldBounds:o,viewportCorners:i};let d=!1;if(e||!this.state.worldBounds||!N7(this.state.worldBounds,o)){const a=this._worldToCommonBounds(o),v=this._commonToWorldBounds(a);this.props.coordinateSystem===Wn.LNGLAT&&(v[1]=Math.max(v[1],-85.051129),v[3]=Math.min(v[3],85.051129),v[0]=Math.max(v[0],-360),v[2]=Math.min(v[2],360));const A=this._worldToCommonBounds(v);c.worldBounds=v,c.normalizedCommonBounds=A,d=!0}return this.setState(c),d}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:i,viewportCorners:o}=this.state,{viewport:c}=this.context;e.write(rA(o,3));const d=o.map(a=>z7(c.projectPosition(a),i));t.write(rA(d,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:i}=this.state;const o=O9(t,!1,Uint8Array);i&&i?.width===t.length?i.setTexture2DData({data:o}):(i?.destroy(),i=this.context.device.createTexture({...S0,data:o,width:t.length,height:1})),this.setState({colorTexture:i})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:i}=this.props,{worldBounds:o,textureSize:c,weightsScale:d,weightsTexture:a}=this.state,v=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const A=this._worldToCommonBounds(o,{useLayerCoordinateSystem:!0});if(t&&i==="SUM"){const{viewport:se}=this.context,Se=se.distanceScales.metersPerUnit[2]*(A[2]-A[0])/c;this.state.colorDomain=t.map(Ne=>Ne*Se*d)}else this.state.colorDomain=t||lA;const k=this.getAttributeManager().getAttributes(),L=this.getModuleSettings();this._setModelAttributes(v.model,k),v.model.setVertexCount(this.getNumInstances());const z={radiusPixels:e,commonBounds:A,textureWidth:c,weightsScale:d,weightsTexture:a},{viewport:q,devicePixelRatio:Y,coordinateSystem:ne,coordinateOrigin:ue}=L,{modelMatrix:ve}=this.props;v.model.shaderInputs.setProps({project:{viewport:q,devicePixelRatio:Y,modelMatrix:ve,coordinateSystem:ne,coordinateOrigin:ue},weight:z}),v.run({parameters:{viewport:[0,0,c,c]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:i}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:i=!1}=t,[o,c,d,a]=e,{viewport:v}=this.context,{textureSize:A}=this.state,{coordinateSystem:E}=this.props,k=i&&(E===Wn.LNGLAT_OFFSETS||E===Wn.METER_OFFSETS),L=k?v.projectPosition(this.props.coordinateOrigin):[0,0],z=A*Y7/v.scale;let q,Y;return i&&!k?(q=this.projectPosition([o,c,0]),Y=this.projectPosition([d,a,0])):(q=v.projectPosition([o,c,0]),Y=v.projectPosition([d,a,0])),B7([q[0]-L[0],q[1]-L[1],Y[0]-L[0],Y[1]-L[1]],z,z)}_commonToWorldBounds(e){const[t,i,o,c]=e,{viewport:d}=this.context,a=d.unprojectPosition([t,i]),v=d.unprojectPosition([o,c]);return a.slice(0,2).concat(v.slice(0,2))}}lw.layerName="HeatmapLayer";lw.defaultProps=J7;function tH(){const[n,e]=ye.useState(null),[t,i]=ye.useState(!1),o=ye.useCallback(()=>{e(null),i(!1)},[]),c=ye.useCallback(v=>A=>{const E=A;if(E&&E.object){const k=E.object,L=v(k,A)||{},z=E.x??0,q=E.y??0;e({x:z,y:q,...L}),i(!0)}else e(null),i(!1);return!1},[]),d=ye.useCallback(()=>v=>{const A=v;return A&&A.object?i(!0):i(!1),!1},[]);return{tooltip:n,makeHoverHandler:c,makeHoverHandlerSilent:d,clear:o,cursor:t||n?"pointer":"default"}}function nH(){const{selectedView:n}=Iy(),t={Temperature:"temperature",Salinity:"salinity","Ocean Topography":"topography","Ocean Currents":"currents",Biomass:"biomass",default:"default"}[n??"default"]??"default",i=ap[t]||ap.default,c=`linear-gradient(90deg, ${i.map((d,a)=>{const v=Math.round(a/(i.length-1)*100);return`rgb(${d[0]}, ${d[1]}, ${d[2]}) ${v}%`}).join(", ")})`;return ye.useEffect(()=>{console.log(`Selected view changed to: ${n}`)},[n]),he.jsxs("div",{className:"ml-2 w-full",children:[he.jsx("div",{className:"h-4 rounded-sm",style:{backgroundImage:c}}),he.jsx("div",{className:"w-full font-medium flex flex-row justify-between h-fit",children:[0,50,100].map(d=>he.jsx("span",{className:"text-md",children:d},d))})]})}function iH(){return he.jsx("div",{className:"w-full absolute top-0 bg-zinc-400 text-black h-12 z-[1001]",children:he.jsxs("div",{className:"grid grid-cols-[minmax(220px,1fr)minmax(220px,300px)] items-center gap-2 h-full",children:[he.jsx("div",{className:"flex items-center",children:he.jsx(nH,{})}),he.jsx("div",{className:"text-center",children:he.jsx("p",{className:"text-lg font-medium",style:{fontSize:"1.125rem"},children:"Probability of Sharks (%)"})})]})})}const Om="https://defendersofwildlife-360365372.imgix.net/sites/default/files/2024-09/2018.10.26%20-%20Shark%20Baring%20Teeth%20Near%20Water%20Surface%20-%20Isla%20Guadalupe%20-%20Mexico%20-%20Valeria%20Mas.jpg?fit=max&ixlib=php-4.1.0&w=2000%201x",rH=[[-73.935242,40.73061,{question:"Which shark species is commonly found off the coast of New York?",answer:"Sand tiger shark",options:["Great white shark","Sand tiger shark","Hammerhead shark","Tiger shark"],image:Om}],[151.2093,-33.8688,{question:"What is the primary diet of the reef shark?",answer:"Small fish and invertebrates",options:["Seals and sea lions","Plankton","Small fish and invertebrates","Sea birds"],image:Om}],[-157.8583,21.3069,{question:"Which behavior helps sharks detect prey at night?",answer:"Ampullae of Lorenzini electroreception",options:["Sonar clicks","Ampullae of Lorenzini electroreception","Bioluminescence","Infrared vision"],image:Om}],[18.4241,-33.9249,{question:"True or False: Most shark species are threatened by overfishing.",answer:"True",options:["True","False"],image:Om}],[115.8575,-31.9505,{question:"What adaptation helps fast pelagic sharks maintain high speeds?",answer:"Heterocercal tail (large upper lobe)",options:["Flattened body","Heterocercal tail (large upper lobe)","External gill slits","Suction cup fins"],image:Om}]],tI=64,nI=128,sH=[-180,-90,180,90],oH=(()=>{const n=tI,e=nI,t=Array.from({length:n},()=>Array(e).fill(0)),i=[{r:Math.floor(n*.18),c:Math.floor(e*.2),s:Math.min(n,e)*.18,v:.9},{r:Math.floor(n*.35),c:Math.floor(e*.7),s:Math.min(n,e)*.12,v:.7},{r:Math.floor(n*.7),c:Math.floor(e*.5),s:Math.min(n,e)*.14,v:.6},{r:Math.floor(n*.2),c:Math.floor(e*.85),s:Math.min(n,e)*.08,v:.5}];for(let o=0;o<n;o++)for(let c=0;c<e;c++){let d=0;for(const a of i){const v=(o-a.r)/a.s,A=(c-a.c)/a.s,E=Math.sqrt(v*v+A*A);E<1&&(d+=a.v*(1-E)*(1-E))}t[o][c]=Math.min(1,d*(.9+Math.random()*.2))}return t})(),cA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAADECAYAAAAyNhmLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiMAAC4jAXilP3YAAAz5SURBVHhe7Z1LjGRHVoa/P25mVbe759XurLJRw9gzLS9sPGIELEAjWoiHBAghMRok85DYjRAgkKVZgGC6jNjwkEVLA0xXd2uwJTb2ggUSSGzaC4TYzGZGHiQvZgESBnuYrq7qrspHZRwWEZF5MzNu1rvrBuKXqrsy7iPjz/OfE+dERN4ShcF7v+e9vwAgCTPDe7/7/vvvX3PzJ7cZZvYJYFUSkuqHulVVuaLIAB8zM19vqBMrh8xN3C//3U/9gjef67NdunRpnDvQSqw/y5f+7Tvf3HDOKVkjWUSSUYplerf5HOL39rYef8zM5g8DaFvbaj2Za3e4Isc9Ex/trw5lzJKJFnJCLSdzEzeE28B1QHhDzEQxCIQ61z56rWo1md41vmjw84CTgRsuhOQJ+v3+xdaSWd/kJeCPZKykNmcTh6+fCsDFixfbGQDW3+SSiTdlPI0QBhqLle5FXPSMeUJm+Zh97rA+fwZ8ZkIE0BgG+3sz580Ral8A6N3m8yZ+HaOTiGAgg7Hfx+Zic228sVaRefY23ydxS56QSBKJjIW86G672JJHa8i8+BYr+/A14NlJ/DXAhAw6e0IzWdksJF1uDZkPH/D7Ej+WPuDkDfLBX/ATHS1YJkmvFWSu3uaG4FUZlWpEEjSOhupAoLUIMxudO5lrd7jixD3B5RS9oPb5q/Z7+L+Kr+ZxzqH5Jm7ouSN4PkukDotya4Ck8y0Bes/yRXP8nIHLEiCQqHDIK8msEedGZu2rvIz4Y3lW5n0kRDGQFxh48yCwULYsnJ5wLmTW3+QSjjckPr6QBsf+ygIRhZfxWCMPOC8yvs/riJeb3j8YICL+bjJk7NaOzMDMnnwG0LvLFxC/hk2jUtZdotQmB4OhDNifT2kiniyZ9b/mOXn+QsaFBXlloGSl+NMZ6AJQaT5lDniCxdltur7ia4hn6kRyg+QEFv3ECD40bpbZEx1neo4vS3xuwU/qUsq0T/zHJjrKZgBPTGbrd/lxGb8DLB8pYiQjRbE5dPqigTqSzn5G83ve4GnzbAKX54/lULfETDtgFU8tWDbi7KPZW1SjIXdI6UoOc05TH0pk09cmcMPAaXrGDM7WMr2H/Abws6gxOVzoWrKMaUpk0tZhZ3rmLCSdnWXW7vAZjI367EoWc/YypaJ/pjEEANlg8YoAMzub0Nz7Cpcx3hRcaZRXDg1nmrNUZY7mjyUMBoMzktkqrwPffyQiDVAMzzLAMWyiPBgMTn925uomvwT8alPUmUG9W5kuptHfBG40mQPIjjOj0ahz8BseAeubPO/g1mHTFaL/N42bCfLCjUSknCVzqpOA12+xavA3iLXDEsliWrfMNnuQXAfozh9LODUyD5/iDxA/eqR7LvZ5EZZmaIRQd8lVpxOa1+7yE4Lfraf1h8Iy+xngg5/Ix9fSlfnTajh5AHjmHj3zbGJcOpG8ZhBuM7mZDy8UJJZ9j5P7zE3c2HNH4rljE8lcNe8yMuE7hu82KQykE66cXb3Gb2H8zJH8JIc6odjfDEd8J3R6vp1gmeP7zNW7fNbBRjT96aNmhMkcs2+2zLEDQO8rXJbxBpaZXTkjmAO/bOb8uPLQCrdkvHjqRDSrr3o5YB0DJ+Z3aCQcS2Zrm7xi4pWlaf0xkUQ0yZxTThZLZrnYmMGRA8DaPT4FvC4Li0GnimSVaI1Jl226LuPMYdaYzhzeMtdvsYo/hXRlGeLE2ORlFVJ/jYUbASOj6b2PZJnti2wAP3JcPzsUFFMXH3qsKC+3H9doQjTLkuGwHVu7zU8Cv3nkdOWwmDhLGCDla7lx8p/puVmZra6uHiyz9b9izVycXWkw8YmQBsmYg01+kuNrmqOZGWkH08wt4mztcjJvUfku9wSfPBMiESJ03I01sYi54PzUiMZOZy1zYABY2+K3MX76QNInQCIiH4gki2gcFeann6G5kFDWr6+hmczVu3wW8eUzS1eIEkudn4wpYW1GFtLkmUG/EmD9Wksd+Wj29F0+8iTTlcnCkg9r/kSOGsd1TDexShRdHlkylT+jdKWOZA2v2QWxWIhN5SbMWQjRJqT8PNzq6upiPbO2ya+Y8cqSJerlqHdk0uFphJKB2xfVUHT2HNVAVIMYjmvXuH3COX2FMWbSU2XJaL426H2VTzv4ZzfUOkKKFR5ByqBlXhYm69w4zqREMSjtrEjXKg7zJlxcCk/3nloLtB+IdB67yT0c4lt/ujeQtFp/X++9DYfDT026dv0Wq0684fa1JlCIIlOuScvThkXnTREpnZ+uSZaa+IUX1SjMhSUruVGwUGcvEOjshbbgN7W5gAbXoH5g5wKv4vVD8rj6RELaUUTqWJLDGNwYqpFwQ9HZFd3Horvr6DwSnV1HZy/8VP0oqySpWgddJOJGQX54hQzZh/OcF24/Ep/OnS3AzILrPXOPng31j/L8gBvhZFLaDeHGQvtRHek2cYYxvGn81JnmURCtZDESKTgwdTmNQ+dNsVYBfBXvvQ+dx26GpFUgxDf+8vFY0ow/e+9tZ2fnerBMn+e0z2U30LjTd6w8dNZ95Fjdqug8Fp2+oxpEZx1OP91qKBRlUg1E95Gju+Po7Dq6j+LrbcfKtgsW2w1WTPLSOPjNysOK7iPHhQfT66tBICIfpOeGkw9qQWYS+ubDr4cNp9VWd7Cyra3VLdfvbjtL2nWjuEjiwQ0J0qn9VHuiGztYDWt1xyhIM0nV7QcZdvYc3UeR3I4LstxxuCFU/fB+nb1wboh+QQqdPcfqw4rujmOqg1msX/jesEj4yZtcqKzzJTy/2HnkPi3ouH2tMsY7Ux/PRWezn8jkjgLz7BFUAGIFhd9Nhol9cyBsGxgFuerjuEyBZzWPqPnohe926O4IM/y//v32UNLF+mUpms06kyE2UDSlZwNDWK0dXovxyuqhLrYcHuJmuOr6d+k+vhLGNH8Zrf8XfOPf6f/gJ3Bff4C/8SJa+9YXDN7mP4yVf3nLf0fSU/Wbee9tMBg8n40MbYOZKaX+3vv/0dw0bSTz3IIztRFzNczRcrOWI7uXoN/vF0kmjmQLyJcAbYakbH11pNmZtiBlLfM4sGxuKbJ9fiJ7Z84A2XrmTJbOnwCyG4JLtUwuNBtN+ms5GvvceKDFyPa5yNA8P2+RmmliWSDK9JncnmYzK3bQXED83ll5PpMrAuNSR5HjzAIZCs7NsiXA/xmZJZRIJlvPlCqzBcQAUKTMmlAkmeF8Q0SRMsv2udRxZjDfQMEBYGESsJVfoT8kFifcA4oMANlxhiZnajlmZJYqglLHmZl0JhWepQaAmT7Xa7USySxEM0qRWWZueWYSMFmmCJltbGwsJZNQhGXmMd2hsIjiyJjZzOJsai510MzNNWvyT5tRX2kmrCz7+qym9x4z81tbWy+33jK53bI5FBcAYvTNkbOTf7PpycM1uUaJxdlCf51zuEhj4WCbYWaN+0YvXbp0/s9qOgokNe1pZmVlpf3pTB0xsuUCAKWWzY0okUw2mlEomWw9w1k/Q+OoOGlJcqKLzwlNfT7ZJ3GaMLMLChv2j4tW5WaND/s4JNpDZlkFeVi0hswpoD0+cwpoj8wOi4a9M1CizHLbTRKKI7Ms6pVIJiuzEucAqiYDmFlZZOJCU5PPFDehMW4iU5zMYvqfJVOczGLK05iMFkUmorHPjQdajGxobl2leRDiKlqTzIqLZp0GyxiFyiwHlZg1q2FN0xVXz0SfyY4zxQWAaIFcACjSZ1xDAIDSyEjaA2ae0lBHaWT8smd7FEUms/UkoTyfieszTWVzceMMS8iUZZmI3DhjJY4zLAnNZWUAB6AsMgctRi092EI8tURmxUWzqiEAUCKZvYZEU5QmM0nDJUuFyx2qMBQnM5Y84LAsmR2QaJZlmbffftstCc1lWebBgwdL+7v0YEvRNM78P5lWorj1mRdeeKHJKlbEtzQSloTlhHKKs83Nzc57772nJaG5nFWAJRJLKMcy77zzTkpjcumMzvSvaZ02NjY2kmVyZMpboI3ILWmUNQlY++5Z7hkarqhE86WXXmqKYhRnmV6vl8g0TZyXEwBqaOpzOTKrISu3onKzDz/80OLA2SSzRpO1GR+Zbygu0UyIS4ELKEpmB6HIDMDMcjKjqNyMGASayubiLBMHzmyiSaHRLGsZCiWTy5o59wxg2ZdIl6DxmnMlw+EmKiaIAaCdZD744IOZ5/sfhBgAcjJz5y6z9fX1R/Nth0BTADj/ceawDy94991303lNsjxfyxwTTeNME8n2wcx0//79jvd+z8zMe28J3vuR9/6HS7RMkyyLlNnOfENCMWRSoDCzb88fA0aSxsWQSfDe/7mZbc01f9vM/rM4MltbW/9kZn9rZrvR/0fAHUn/XRyZ+/fv7w4Ggz8B/gH4Q+BVSfcU/5hZMbh//34n5mf0ej3duHGjcs5NnqtZlGUSkfT7a6+9NrNf838BB4ck2ACxeS4AAAAASUVORK5CYII=",aH=({open:n,title:e,onClose:t,footer:i,options:o,correctAnswer:c,onAnswer:d,image:a})=>{ye.useEffect(()=>{const z=q=>{q.key==="Escape"&&t()};return n&&document.addEventListener("keydown",z),()=>document.removeEventListener("keydown",z)},[n,t]);const[v,A]=Dd.useState(null),[E,k]=Dd.useState(null);if(Dd.useEffect(()=>{console.log(a),n&&(A(null),k(null))},[n]),!n)return null;const L=z=>{A(z);const q=z===c;k(q),d&&d(q,z)};return he.jsxs("div",{"aria-modal":!0,role:"dialog",className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:[he.jsx("div",{className:"absolute inset-0 bg-black/50 pointer-events-none"}),he.jsxs("div",{className:"relative z-10 w-full max-w-xl rounded-md bg-blue-800 shadow-lg pointer-events-auto",children:[he.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[he.jsx("div",{className:"text-lg font-semibold",children:e}),he.jsx(rP,{className:"w-6 h-6 border border-white rounded-full cursor-pointer",onClick:t})]}),he.jsx("div",{className:"p-4",children:he.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[he.jsx("div",{className:"md:w-1/3 flex items-center justify-center",children:a?he.jsx("img",{src:a,alt:"dialog",className:"max-w-full max-h-48 object-contain rounded"}):he.jsx("div",{className:"w-full h-40 bg-white/5 rounded flex items-center justify-center text-sm text-white/60",children:"No image"})}),he.jsxs("div",{className:"md:w-2/3",children:[he.jsx("div",{className:"space-y-2",children:o?.map(z=>{const q=E===!0&&z===c,Y=E===!1&&z===v;return he.jsx("button",{onClick:()=>L(z),className:`w-full text-left p-2 rounded ${q?"bg-green-600 text-white":Y?"bg-red-600 text-white":"bg-white/10 text-white"}`,children:z},z)})}),E!==null&&he.jsx("div",{className:"mt-3",children:E?he.jsx("div",{className:"text-sm text-green-200",children:"Correct "}):he.jsx("div",{className:"text-sm text-red-200",children:"Incorrect "})})]})]})}),i&&he.jsx("div",{className:"border-t px-4 py-3",children:i})]})]})},lH=void 0;async function I_(n,e={}){const t=await fetch(`${lH}${n}`,{headers:{"Content-Type":"application/json"},...e});if(!t.ok){const i=await t.text();throw new Error(`HTTP ${t.status}: ${i}`)}return t.json()}const cH={get:n=>I_(n),post:(n,e)=>I_(n,{method:"POST",body:JSON.stringify(e)}),put:(n,e)=>I_(n,{method:"PUT",body:JSON.stringify(e)}),del:n=>I_(n,{method:"DELETE"})};async function uH(n){return cH.post("/model",n)}const iI=ye.createContext(void 0),hH=({children:n})=>{const[o,c]=ye.useState(null),[d,a]=ye.useState(59),[v,A]=ye.useState(1e3),{selectedView:E}=Iy(),k=ye.useCallback(async L=>{try{const z=L?.year??2020+Math.floor(d/12),q=L?.month??d%12+1,Y=L?.depth??v;let ne=[];if(L?.acceptMock)ne=((((await q0(()=>import("./mockModelDataByYear-BTOKhBYq.js"),[])).modelDataByYear||{})[z]||{})[q]||[]).filter(se=>(se[3]??0)<=Y);else try{const ue=await uH({year:z,month:q,depth:Y,view:E});let ve=[];Array.isArray(ue)?ve=ue:ue&&Array.isArray(ue.data)&&(ve=ue.data),ne=ve.map(se=>Array.isArray(se)?se.length>=4?[Number(se[0]),Number(se[1]),Number(se[2]),Number(se[3])]:se.length===3?[Number(se[0]),Number(se[1]),Number(se[2]),0]:null:null).filter(Boolean),ne=ne.filter(se=>(typeof se[3]=="number"?se[3]:0)<=Y)}catch{ne=((((await q0(()=>import("./mockModelDataByYear-BTOKhBYq.js"),[])).modelDataByYear||{})[z]||{})[q]||[]).filter(Se=>(Se[3]??0)<=Y)}return c(ne),ne}catch(z){return console.error("fetchModelData failed",z),c([]),[]}},[d,v,E]);return ye.useEffect(()=>{const L=2020+Math.floor(d/12),z=d%12+1;k({year:L,month:z,depth:v,acceptMock:!0})},[d,v,E,k]),he.jsx(iI.Provider,{value:{modelData:o,monthIndex:d,setMonthIndex:a,depth:v,setDepth:A,fetchModelData:k},children:n})};function dH(){const n=ye.useContext(iI);if(!n)throw new Error("useModelData must be used within ModelDataProvider");return n}const fH="https://raw.githubusercontent.com/visgl/deck.gl-data/master/examples/screen-grid/uber-pickup-locations.json",pH={longitude:0,latitude:0,zoom:1.2,pitch:0,bearing:0},mH="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json";function gH({modelData:n=fH,intensity:e=1,threshold:t=.03,radiusPixels:i=30,mapStyle:o=mH,quizData:c=rH,mapMode:d,enabled:a}){const[v,A]=ye.useState(pH),[E]=ye.useState(!1),k=typeof a=="boolean"?a:E,L=d??"research",{modelData:z,monthIndex:q,setMonthIndex:Y,depth:ne,setDepth:ue}=dH(),ve=2020,se=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Se=60,{selectedView:Ne,colorblindMode:nt}=Iy(),vt={Temperature:"temperature",Salinity:"salinity","Ocean Topography":"topography","Ocean Currents":"currents",Biomass:"biomass",default:"default"}[Ne??"default"]??"default",Ft=`${vt}_cb`,Wt=nt&&ap[Ft]?ap[Ft]:ap[vt]||ap.default,pn=ye.useMemo(()=>!z||typeof z=="string"?[]:z.map(xt=>({position:[xt[0],xt[1]],weight:xt[2]})),[z]),[sn,rn]=ye.useState(q),[kn,Pe]=ye.useState(ne);ye.useEffect(()=>rn(q),[q]),ye.useEffect(()=>Pe(ne),[ne]),ye.useEffect(()=>{const xt=setTimeout(()=>{sn!==q&&Y(sn)},350);return()=>clearTimeout(xt)},[sn,q,Y]),ye.useEffect(()=>{const xt=setTimeout(()=>{kn!==ne&&ue(kn)},300);return()=>clearTimeout(xt)},[kn,ne,ue]);const{tooltip:ke,makeHoverHandler:ge,makeHoverHandlerSilent:Ue,cursor:$e}=tH(),[de,De]=ye.useState(!1),[ut,Et]=ye.useState(null),[It,$t]=ye.useState(null),[Qt,Ut]=ye.useState(null),[an,_n]=ye.useState(0);ye.useEffect(()=>{let xt=0,Pt=null;const Yt=1200,Sn=Nn=>{Pt||(Pt=Nn);const Yn=(Math.sin((Nn-Pt)/Yt*Math.PI*2)+1)/2;_n(Yn),xt=requestAnimationFrame(Sn)};return xt=requestAnimationFrame(Sn),()=>cancelAnimationFrame(xt)},[]);const Gi=ye.useMemo(()=>{if(typeof window>"u")return[];const xt=nI,Pt=tI,[Yt,Sn,Nn,Yn]=sH,yi=(Nn-Yt)/xt,hs=(Yn-Sn)/Pt,Es=[];for(let ds=0;ds<Pt;ds++)for(let Kr=0;Kr<xt;Kr++){const Zs=Math.max(0,Math.min(1,oH[ds]?.[Kr]??0)),Jr=Yt+Kr*yi,Ps=Jr+yi,Le=Yn-ds*hs,K=Le-hs,J=[[Jr,K],[Ps,K],[Ps,Le],[Jr,Le]];Es.push({polygon:J,value:Zs})}return Es},[vt]);ye.useEffect(()=>{const xt=new Image;xt.onload=()=>{const Pt=xt.width||64,Yt=xt.height||64;$t({flag:{x:0,y:0,width:Pt,height:Yt,anchorY:Yt,anchorX:Math.floor(Pt/2)}}),Ut(xt)},xt.onerror=()=>{$t({flag:{x:0,y:0,width:64,height:64,anchorY:64,anchorX:32}})},xt.src=cA},[]);const Ii=ye.useCallback(xt=>{if(!xt||!xt.coordinate||!Array.isArray(xt.coordinate))return;const Pt=xt.coordinate;if(Pt.length<2)return;const Yt=Pt[0],Sn=Pt[1];A(Nn=>({...Nn,longitude:Yt,latitude:Sn,zoom:Math.max(Nn.zoom??1,8),transitionDuration:1e3,transitionInterpolator:new S_}))},[]),Hn=[(()=>{const xt=Wt,Pt=Array.isArray(xt)?xt.map(Yt=>[Yt[0],Yt[1],Yt[2],255]):[];return new lw({data:z||[],id:"heatmap-layer",pickable:!0,getPosition:Yt=>[Yt[0],Yt[1]],getWeight:Yt=>Yt[2],radiusPixels:i,intensity:e,threshold:t,onClick:Yt=>{if(!Yt||!Yt.coordinate||!Array.isArray(Yt.coordinate))return!0;const Sn=Yt.coordinate;if(Sn.length<2)return!0;const Nn=Sn[0],Yn=Sn[1];return A(yi=>({...yi,longitude:Nn,latitude:Yn,zoom:Math.max(yi.zoom??1,8),transitionDuration:1e3,transitionInterpolator:new S_})),!0},colorRange:Pt,onHover:ge((Yt,Sn)=>{const Nn=Sn?.coordinate?.[0]??Yt[0]??NaN,Yn=Sn?.coordinate?.[1]??Yt[1]??NaN;return{weight:Yt[2],lon:Nn,lat:Yn}})})})(),new vy({id:"heat-dots",data:pn,pickable:!0,radiusUnits:"pixels",getPosition:xt=>xt.position,getRadius:xt=>4,getFillColor:xt=>{const Pt=Math.max(0,Math.min(1,(xt.weight||0)/10)),[Yt,Sn,Nn]=A2(Wt,Pt);return[Yt,Sn,Nn,200]},onClick:Ii,onHover:ge((xt,Pt)=>{const Yt=(xt.position&&xt.position[0])??Pt?.coordinate?.[0]??NaN,Sn=(xt.position&&xt.position[1])??Pt?.coordinate?.[1]??NaN;return{weight:xt.weight,lon:Yt,lat:Sn}})})];if(k&&Gi&&Gi.length&&Hn.unshift(new aw({id:"aerosol-polygons",data:Gi,pickable:!1,stroked:!0,filled:!0,getPolygon:xt=>xt.polygon,getFillColor:xt=>{const Pt=Math.max(0,Math.min(1,xt.value||0)),[Yt,Sn,Nn]=A2(Wt,Pt);return[255-Math.round(Yt),255-Math.round(Sn),255-Math.round(Nn),100]},getLineColor:()=>[0,0,0,255],lineWidthMinPixels:1})),L==="student"){const xt=(typeof c=="string"?[]:c).map(Pt=>({position:[Pt[0],Pt[1]],question:Pt[2]}));Hn.push(new vy({id:"quiz-halo",data:xt,pickable:!0,getPosition:Pt=>Pt.position,getRadius:Pt=>{const Yt=It?.flag?.width??64,Sn=Math.max(16,Math.floor(Yt/.75)),Nn=Math.max(6,Math.floor(Sn*.4));return Math.round(Nn*(1+an*.12))},radiusUnits:"pixels",getFillColor:()=>[255,200,0,40],opacity:1,onClick:Pt=>{const Yt=Pt?.object;if(!Yt)return;const Sn=Pt.coordinate?.[0]??Yt.position?.[0]??NaN,Nn=Pt.coordinate?.[1]??Yt.position?.[1]??NaN;A(yi=>({...yi,longitude:Sn,latitude:Nn,zoom:Math.max(yi.zoom??1,6),transitionDuration:500,transitionInterpolator:new S_}));const Yn=Yt.question;console.log(Yn),Et({questionText:Yn.question,options:Yn.options,answer:Yn.answer,image:Yn.image}),De(!0)},onHover:Ue()})),Hn.push(new rw({id:"quiz-flags",data:xt,pickable:!0,iconAtlas:Qt||cA,sizeUnits:"pixels",iconMapping:It||{flag:{x:0,y:0,width:64,height:64,anchorY:64,anchorX:32}},getIcon:Pt=>"flag",sizeScale:1,getSize:Pt=>{const Yt=It?.flag?.width??64,Sn=Math.max(16,Math.floor(Yt/.75)),Nn=.85+an*.3;return Math.round(Sn*Nn)},getPosition:Pt=>Pt.position,onClick:Pt=>{const Yt=Pt?.object;if(!Yt)return;const Sn=Pt.coordinate?.[0]??Yt.position?.[0]??NaN,Nn=Pt.coordinate?.[1]??Yt.position?.[1]??NaN;A(yi=>({...yi,longitude:Sn,latitude:Nn,zoom:Math.max(yi.zoom??1,6),transitionDuration:500,transitionInterpolator:new S_}));const Yn=Yt.question;Et({questionText:Yn.question,options:Yn.options,answer:Yn.answer}),De(!0)}}))}const ri=$e;return he.jsxs("div",{style:{position:"relative",width:"100%",minHeight:"100vh",height:"100%",cursor:ri},children:[he.jsx(iH,{}),he.jsx(k9,{style:{zIndex:"0"},viewState:v,controller:!0,onViewStateChange:xt=>A(xt.viewState),layers:Hn,children:he.jsx(LL,{reuseMaps:!0,mapStyle:o,mapLib:hP,attributionControl:!1})}),ke&&he.jsxs("div",{style:{position:"absolute",left:ke.x+12,top:ke.y+12,background:"rgba(0,0,0,0.75)",color:"white",padding:"6px 8px",borderRadius:4,pointerEvents:"none",fontSize:12},children:[he.jsxs("div",{children:[he.jsx("strong",{children:"Intensity:"})," ",String(ke.weight)]}),he.jsxs("div",{style:{fontSize:11,opacity:.9},children:[he.jsx("strong",{children:"Lon:"})," ",typeof ke.lon=="number"&&Number.isFinite(ke.lon)?ke.lon.toFixed(4):"n/a"," ",he.jsx("strong",{children:"Lat:"})," ",typeof ke.lat=="number"&&Number.isFinite(ke.lat)?ke.lat.toFixed(4):"n/a"]})]}),he.jsxs("div",{className:"absolute bottom-[15%] rotate-[270deg] right-1 z-2003 flex items-center",children:[he.jsxs("div",{style:{writingMode:"vertical-rl",color:"white",fontSize:11,opacity:.9},children:[kn," m"]}),he.jsx("input",{type:"range",min:0,max:3e3,step:10,value:kn,onChange:xt=>Pe(Number(xt.target.value)),style:{height:140},"aria-label":"Depth (m)",className:"rounded-lg bg-white/80 cursor-pointer"})]}),he.jsxs("div",{className:"absolute left-12 right-12 bottom-2 z-2002 px-3 py-0 rounded-2xl text-black bg-zinc-400/60",children:[he.jsx("div",{className:"flex items-center gap-6 ",children:he.jsx("input",{type:"range",min:0,max:Se-1,value:sn,onChange:xt=>rn(Number(xt.target.value)),style:{flex:1},className:"rounded-lg bg-white/80 cursor-pointer"})}),he.jsxs("div",{className:"relative h-2 mt-6",children:[he.jsx("div",{className:"absolute left-6 right-6 bottom-[50px] h-4",children:Array.from({length:5}).map((xt,Pt)=>{const Yt=ve+Pt,Sn=Pt/4*100;return he.jsx("div",{style:{position:"absolute",left:`calc(${Sn}% )`,transform:"translateX(-50%)",top:0,fontSize:12,fontWeight:600},className:"text-white",children:Yt},Yt)})}),he.jsx("div",{style:{position:"absolute",left:6,right:6,top:-20,height:5},children:Array.from({length:12}).map((xt,Pt)=>{const Yt=Pt/11*100,Sn=Math.round(Pt/11*(Se-1)),Nn=se[Sn%12];return he.jsx("div",{style:{position:"absolute",left:`calc(${Yt}% )`,transform:"translateX(-50%)",fontSize:14,fontWeight:500},children:Nn},Pt)})})]})]}),he.jsx(aH,{open:de,onClose:()=>De(!1),title:ut?.questionText||"Question",image:ut?.image,options:ut?.options,correctAnswer:ut?.answer,onAnswer:(xt,Pt)=>{xt&&setTimeout(()=>De(!1),900),console.info("Answer selected:",Pt,"correct:",xt)}})]})}const _H=()=>(BM(),he.jsx(hH,{children:he.jsx(yL,{children:he.jsx(gH,{})})})),yH="/assets/logo-9Bi82sjj.svg",vH=()=>he.jsxs("div",{className:"relative min-h-screen flex items-center justify-center overflow-hidden bg-black",children:[he.jsx(fn.div,{className:"absolute inset-0 bg-gradient-to-br from-[#00111F] via-[#003B5C] to-[#005C99]",animate:{backgroundPosition:["0% 0%","100% 100%","0% 0%"]},transition:{duration:20,repeat:1/0,ease:"linear"},style:{backgroundSize:"400% 400%"}}),he.jsx(fn.div,{className:"absolute inset-0 bg-[radial-gradient(circle_at_top_center,rgba(255,255,255,0.12)_0%,transparent_70%)]",animate:{opacity:[.4,.6,.4],rotate:[0,5,-5,0]},transition:{duration:12,repeat:1/0,ease:"easeInOut"}}),he.jsx(fn.div,{className:"absolute top-8 left-8 z-20",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:1,delay:.3},children:he.jsx("img",{src:yH,alt:"Developers Logo",className:"h-12 w-auto"})}),[...Array(30)].map((n,e)=>he.jsx(fn.div,{className:"absolute bg-blue-100 rounded-full opacity-20 blur-sm",style:{width:Math.random()*8+3,height:Math.random()*8+3,top:`${Math.random()*100}%`,left:`${Math.random()*100}%`},animate:{y:[0,-150,0],opacity:[.05,.3,.05]},transition:{duration:8+Math.random()*5,repeat:1/0,ease:"easeInOut"}},e)),he.jsx(fn.div,{className:"absolute top-1/3 left-[-20%] w-[200px] h-[80px] bg-[url('/shark-silhouette.png')] bg-no-repeat bg-contain opacity-20",animate:{x:["-20%","120%"],y:[0,10,-10,0],opacity:[.2,.25,.2]},transition:{duration:40,repeat:1/0,ease:"easeInOut"},style:{filter:"blur(2px)"}}),he.jsxs("div",{className:"relative z-10 text-center text-white px-6",children:[he.jsx(fn.h1,{className:"text-6xl md:text-8xl font-extrabold mb-8 bg-gradient-to-r from-blue-100 via-cyan-300 to-blue-200 bg-clip-text text-transparent drop-shadow-[0_0_25px_rgba(59,130,246,0.3)]",initial:{opacity:0,y:60,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:1.4,ease:"easeOut"},children:"Shark Seer"}),he.jsx(fn.p,{className:"text-lg md:text-2xl text-blue-100/80 mb-10 max-w-2xl mx-auto leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.2,delay:.6},children:"Dive into the data that drives the oceans. Explore temperature, salinity, and shark migration like never before."}),he.jsxs(fn.button,{className:"relative px-10 py-4 text-xl font-semibold rounded-full overflow-hidden text-white bg-gradient-to-r from-blue-500 to-cyan-400 shadow-lg hover:shadow-2xl transition-all duration-300",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:1,delay:1},whileHover:{scale:1.08,boxShadow:"0 0 30px rgba(56,189,248,0.4)"},whileTap:{scale:.95},children:[he.jsx("span",{className:"relative z-10",children:"Start Exploring"}),he.jsx(fn.span,{className:"absolute inset-0 bg-gradient-to-r from-cyan-400 to-blue-500 opacity-0",whileHover:{opacity:.2},transition:{duration:.3}})]})]})]});function xH(){return he.jsx(Y4,{children:he.jsx(NM,{children:he.jsx(OM,{children:he.jsxs(M_,{path:"/",children:[he.jsx(M_,{index:!0,element:he.jsx(_H,{})}),he.jsx(M_,{path:"cover",element:he.jsx(vH,{})})]})})})})}jI.createRoot(document.getElementById("root")).render(he.jsx(ye.StrictMode,{children:he.jsx(X4,{children:he.jsx(xH,{})})}));
