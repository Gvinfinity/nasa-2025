function eA(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in n)){const c=Object.getOwnPropertyDescriptor(r,o);c&&Object.defineProperty(n,o,c.get?c:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function t(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=t(o);fetch(o.href,c)}})();function Tx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var dv={exports:{}},Tm={},fv={exports:{}},Un={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zw;function AI(){if(zw)return Un;zw=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),d=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),A=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),k=Symbol.iterator;function L(ue){return ue===null||typeof ue!="object"?null:(ue=k&&ue[k]||ue["@@iterator"],typeof ue=="function"?ue:null)}var z={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},G=Object.assign,te={};function re(ue,De,dt){this.props=ue,this.context=De,this.refs=te,this.updater=dt||z}re.prototype.isReactComponent={},re.prototype.setState=function(ue,De){if(typeof ue!="object"&&typeof ue!="function"&&ue!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ue,De,"setState")},re.prototype.forceUpdate=function(ue){this.updater.enqueueForceUpdate(this,ue,"forceUpdate")};function fe(){}fe.prototype=re.prototype;function ve(ue,De,dt){this.props=ue,this.context=De,this.refs=te,this.updater=dt||z}var le=ve.prototype=new fe;le.constructor=ve,G(le,re.prototype),le.isPureReactComponent=!0;var Se=Array.isArray,Ne=Object.prototype.hasOwnProperty,nt={current:null},pt={key:!0,ref:!0,__self:!0,__source:!0};function mt(ue,De,dt){var Et,kt={},ht=null,vt=null;if(De!=null)for(Et in De.ref!==void 0&&(vt=De.ref),De.key!==void 0&&(ht=""+De.key),De)Ne.call(De,Et)&&!pt.hasOwnProperty(Et)&&(kt[Et]=De[Et]);var ut=arguments.length-2;if(ut===1)kt.children=dt;else if(1<ut){for(var Bt=Array(ut),Wt=0;Wt<ut;Wt++)Bt[Wt]=arguments[Wt+2];kt.children=Bt}if(ue&&ue.defaultProps)for(Et in ut=ue.defaultProps,ut)kt[Et]===void 0&&(kt[Et]=ut[Et]);return{$$typeof:n,type:ue,key:ht,ref:vt,props:kt,_owner:nt.current}}function Tt(ue,De){return{$$typeof:n,type:ue.type,key:De,ref:ue.ref,props:ue.props,_owner:ue._owner}}function Mt(ue){return typeof ue=="object"&&ue!==null&&ue.$$typeof===n}function Zt(ue){var De={"=":"=0",":":"=2"};return"$"+ue.replace(/[=:]/g,function(dt){return De[dt]})}var hn=/\/+/g;function on(ue,De){return typeof ue=="object"&&ue!==null&&ue.key!=null?Zt(""+ue.key):De.toString(36)}function nn(ue,De,dt,Et,kt){var ht=typeof ue;(ht==="undefined"||ht==="boolean")&&(ue=null);var vt=!1;if(ue===null)vt=!0;else switch(ht){case"string":case"number":vt=!0;break;case"object":switch(ue.$$typeof){case n:case e:vt=!0}}if(vt)return vt=ue,kt=kt(vt),ue=Et===""?"."+on(vt,0):Et,Se(kt)?(dt="",ue!=null&&(dt=ue.replace(hn,"$&/")+"/"),nn(kt,De,dt,"",function(Wt){return Wt})):kt!=null&&(Mt(kt)&&(kt=Tt(kt,dt+(!kt.key||vt&&vt.key===kt.key?"":(""+kt.key).replace(hn,"$&/")+"/")+ue)),De.push(kt)),1;if(vt=0,Et=Et===""?".":Et+":",Se(ue))for(var ut=0;ut<ue.length;ut++){ht=ue[ut];var Bt=Et+on(ht,ut);vt+=nn(ht,De,dt,Bt,kt)}else if(Bt=L(ue),typeof Bt=="function")for(ue=Bt.call(ue),ut=0;!(ht=ue.next()).done;)ht=ht.value,Bt=Et+on(ht,ut++),vt+=nn(ht,De,dt,Bt,kt);else if(ht==="object")throw De=String(ue),Error("Objects are not valid as a React child (found: "+(De==="[object Object]"?"object with keys {"+Object.keys(ue).join(", ")+"}":De)+"). If you meant to render a collection of children, use an array instead.");return vt}function Rn(ue,De,dt){if(ue==null)return ue;var Et=[],kt=0;return nn(ue,Et,"","",function(ht){return De.call(dt,ht,kt++)}),Et}function Ee(ue){if(ue._status===-1){var De=ue._result;De=De(),De.then(function(dt){(ue._status===0||ue._status===-1)&&(ue._status=1,ue._result=dt)},function(dt){(ue._status===0||ue._status===-1)&&(ue._status=2,ue._result=dt)}),ue._status===-1&&(ue._status=0,ue._result=De)}if(ue._status===1)return ue._result.default;throw ue._result}var Oe={current:null},me={transition:null},ze={ReactCurrentDispatcher:Oe,ReactCurrentBatchConfig:me,ReactCurrentOwner:nt};function $e(){throw Error("act(...) is not supported in production builds of React.")}return Un.Children={map:Rn,forEach:function(ue,De,dt){Rn(ue,function(){De.apply(this,arguments)},dt)},count:function(ue){var De=0;return Rn(ue,function(){De++}),De},toArray:function(ue){return Rn(ue,function(De){return De})||[]},only:function(ue){if(!Mt(ue))throw Error("React.Children.only expected to receive a single React element child.");return ue}},Un.Component=re,Un.Fragment=t,Un.Profiler=o,Un.PureComponent=ve,Un.StrictMode=r,Un.Suspense=v,Un.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ze,Un.act=$e,Un.cloneElement=function(ue,De,dt){if(ue==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ue+".");var Et=G({},ue.props),kt=ue.key,ht=ue.ref,vt=ue._owner;if(De!=null){if(De.ref!==void 0&&(ht=De.ref,vt=nt.current),De.key!==void 0&&(kt=""+De.key),ue.type&&ue.type.defaultProps)var ut=ue.type.defaultProps;for(Bt in De)Ne.call(De,Bt)&&!pt.hasOwnProperty(Bt)&&(Et[Bt]=De[Bt]===void 0&&ut!==void 0?ut[Bt]:De[Bt])}var Bt=arguments.length-2;if(Bt===1)Et.children=dt;else if(1<Bt){ut=Array(Bt);for(var Wt=0;Wt<Bt;Wt++)ut[Wt]=arguments[Wt+2];Et.children=ut}return{$$typeof:n,type:ue.type,key:kt,ref:ht,props:Et,_owner:vt}},Un.createContext=function(ue){return ue={$$typeof:d,_currentValue:ue,_currentValue2:ue,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ue.Provider={$$typeof:c,_context:ue},ue.Consumer=ue},Un.createElement=mt,Un.createFactory=function(ue){var De=mt.bind(null,ue);return De.type=ue,De},Un.createRef=function(){return{current:null}},Un.forwardRef=function(ue){return{$$typeof:a,render:ue}},Un.isValidElement=Mt,Un.lazy=function(ue){return{$$typeof:P,_payload:{_status:-1,_result:ue},_init:Ee}},Un.memo=function(ue,De){return{$$typeof:A,type:ue,compare:De===void 0?null:De}},Un.startTransition=function(ue){var De=me.transition;me.transition={};try{ue()}finally{me.transition=De}},Un.unstable_act=$e,Un.useCallback=function(ue,De){return Oe.current.useCallback(ue,De)},Un.useContext=function(ue){return Oe.current.useContext(ue)},Un.useDebugValue=function(){},Un.useDeferredValue=function(ue){return Oe.current.useDeferredValue(ue)},Un.useEffect=function(ue,De){return Oe.current.useEffect(ue,De)},Un.useId=function(){return Oe.current.useId()},Un.useImperativeHandle=function(ue,De,dt){return Oe.current.useImperativeHandle(ue,De,dt)},Un.useInsertionEffect=function(ue,De){return Oe.current.useInsertionEffect(ue,De)},Un.useLayoutEffect=function(ue,De){return Oe.current.useLayoutEffect(ue,De)},Un.useMemo=function(ue,De){return Oe.current.useMemo(ue,De)},Un.useReducer=function(ue,De,dt){return Oe.current.useReducer(ue,De,dt)},Un.useRef=function(ue){return Oe.current.useRef(ue)},Un.useState=function(ue){return Oe.current.useState(ue)},Un.useSyncExternalStore=function(ue,De,dt){return Oe.current.useSyncExternalStore(ue,De,dt)},Un.useTransition=function(){return Oe.current.useTransition()},Un.version="18.3.1",Un}var Uw;function Sx(){return Uw||(Uw=1,fv.exports=AI()),fv.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vw;function PI(){if(Vw)return Tm;Vw=1;var n=Sx(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(a,v,A){var P,k={},L=null,z=null;A!==void 0&&(L=""+A),v.key!==void 0&&(L=""+v.key),v.ref!==void 0&&(z=v.ref);for(P in v)r.call(v,P)&&!c.hasOwnProperty(P)&&(k[P]=v[P]);if(a&&a.defaultProps)for(P in v=a.defaultProps,v)k[P]===void 0&&(k[P]=v[P]);return{$$typeof:e,type:a,key:L,ref:z,props:k,_owner:o.current}}return Tm.Fragment=t,Tm.jsx=d,Tm.jsxs=d,Tm}var jw;function EI(){return jw||(jw=1,dv.exports=PI()),dv.exports}var Pe=EI(),Ae=Sx();const Dd=Tx(Ae),CI=eA({__proto__:null,default:Dd},[Ae]);var Qg={},pv={exports:{}},bo={},mv={exports:{}},gv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $w;function II(){return $w||($w=1,(function(n){function e(me,ze){var $e=me.length;me.push(ze);e:for(;0<$e;){var ue=$e-1>>>1,De=me[ue];if(0<o(De,ze))me[ue]=ze,me[$e]=De,$e=ue;else break e}}function t(me){return me.length===0?null:me[0]}function r(me){if(me.length===0)return null;var ze=me[0],$e=me.pop();if($e!==ze){me[0]=$e;e:for(var ue=0,De=me.length,dt=De>>>1;ue<dt;){var Et=2*(ue+1)-1,kt=me[Et],ht=Et+1,vt=me[ht];if(0>o(kt,$e))ht<De&&0>o(vt,kt)?(me[ue]=vt,me[ht]=$e,ue=ht):(me[ue]=kt,me[Et]=$e,ue=Et);else if(ht<De&&0>o(vt,$e))me[ue]=vt,me[ht]=$e,ue=ht;else break e}}return ze}function o(me,ze){var $e=me.sortIndex-ze.sortIndex;return $e!==0?$e:me.id-ze.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;n.unstable_now=function(){return c.now()}}else{var d=Date,a=d.now();n.unstable_now=function(){return d.now()-a}}var v=[],A=[],P=1,k=null,L=3,z=!1,G=!1,te=!1,re=typeof setTimeout=="function"?setTimeout:null,fe=typeof clearTimeout=="function"?clearTimeout:null,ve=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(me){for(var ze=t(A);ze!==null;){if(ze.callback===null)r(A);else if(ze.startTime<=me)r(A),ze.sortIndex=ze.expirationTime,e(v,ze);else break;ze=t(A)}}function Se(me){if(te=!1,le(me),!G)if(t(v)!==null)G=!0,Ee(Ne);else{var ze=t(A);ze!==null&&Oe(Se,ze.startTime-me)}}function Ne(me,ze){G=!1,te&&(te=!1,fe(mt),mt=-1),z=!0;var $e=L;try{for(le(ze),k=t(v);k!==null&&(!(k.expirationTime>ze)||me&&!Zt());){var ue=k.callback;if(typeof ue=="function"){k.callback=null,L=k.priorityLevel;var De=ue(k.expirationTime<=ze);ze=n.unstable_now(),typeof De=="function"?k.callback=De:k===t(v)&&r(v),le(ze)}else r(v);k=t(v)}if(k!==null)var dt=!0;else{var Et=t(A);Et!==null&&Oe(Se,Et.startTime-ze),dt=!1}return dt}finally{k=null,L=$e,z=!1}}var nt=!1,pt=null,mt=-1,Tt=5,Mt=-1;function Zt(){return!(n.unstable_now()-Mt<Tt)}function hn(){if(pt!==null){var me=n.unstable_now();Mt=me;var ze=!0;try{ze=pt(!0,me)}finally{ze?on():(nt=!1,pt=null)}}else nt=!1}var on;if(typeof ve=="function")on=function(){ve(hn)};else if(typeof MessageChannel<"u"){var nn=new MessageChannel,Rn=nn.port2;nn.port1.onmessage=hn,on=function(){Rn.postMessage(null)}}else on=function(){re(hn,0)};function Ee(me){pt=me,nt||(nt=!0,on())}function Oe(me,ze){mt=re(function(){me(n.unstable_now())},ze)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(me){me.callback=null},n.unstable_continueExecution=function(){G||z||(G=!0,Ee(Ne))},n.unstable_forceFrameRate=function(me){0>me||125<me?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Tt=0<me?Math.floor(1e3/me):5},n.unstable_getCurrentPriorityLevel=function(){return L},n.unstable_getFirstCallbackNode=function(){return t(v)},n.unstable_next=function(me){switch(L){case 1:case 2:case 3:var ze=3;break;default:ze=L}var $e=L;L=ze;try{return me()}finally{L=$e}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(me,ze){switch(me){case 1:case 2:case 3:case 4:case 5:break;default:me=3}var $e=L;L=me;try{return ze()}finally{L=$e}},n.unstable_scheduleCallback=function(me,ze,$e){var ue=n.unstable_now();switch(typeof $e=="object"&&$e!==null?($e=$e.delay,$e=typeof $e=="number"&&0<$e?ue+$e:ue):$e=ue,me){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=$e+De,me={id:P++,callback:ze,priorityLevel:me,startTime:$e,expirationTime:De,sortIndex:-1},$e>ue?(me.sortIndex=$e,e(A,me),t(v)===null&&me===t(A)&&(te?(fe(mt),mt=-1):te=!0,Oe(Se,$e-ue))):(me.sortIndex=De,e(v,me),G||z||(G=!0,Ee(Ne))),me},n.unstable_shouldYield=Zt,n.unstable_wrapCallback=function(me){var ze=L;return function(){var $e=L;L=ze;try{return me.apply(this,arguments)}finally{L=$e}}}})(gv)),gv}var Ww;function MI(){return Ww||(Ww=1,mv.exports=II()),mv.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hw;function RI(){if(Hw)return bo;Hw=1;var n=Sx(),e=MI();function t(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,S=1;S<arguments.length;S++)g+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,o={};function c(f,g){d(f,g),d(f+"Capture",g)}function d(f,g){for(o[f]=g,f=0;f<g.length;f++)r.add(g[f])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,A=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,P={},k={};function L(f){return v.call(k,f)?!0:v.call(P,f)?!1:A.test(f)?k[f]=!0:(P[f]=!0,!1)}function z(f,g,S,I){if(S!==null&&S.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return I?!1:S!==null?!S.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function G(f,g,S,I){if(g===null||typeof g>"u"||z(f,g,S,I))return!0;if(I)return!1;if(S!==null)switch(S.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function te(f,g,S,I,N,j,Q){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=I,this.attributeNamespace=N,this.mustUseProperty=S,this.propertyName=f,this.type=g,this.sanitizeURL=j,this.removeEmptyString=Q}var re={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){re[f]=new te(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];re[g]=new te(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){re[f]=new te(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){re[f]=new te(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){re[f]=new te(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){re[f]=new te(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){re[f]=new te(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){re[f]=new te(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){re[f]=new te(f,5,!1,f.toLowerCase(),null,!1,!1)});var fe=/[\-:]([a-z])/g;function ve(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(fe,ve);re[g]=new te(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(fe,ve);re[g]=new te(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(fe,ve);re[g]=new te(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){re[f]=new te(f,1,!1,f.toLowerCase(),null,!1,!1)}),re.xlinkHref=new te("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){re[f]=new te(f,1,!1,f.toLowerCase(),null,!0,!0)});function le(f,g,S,I){var N=re.hasOwnProperty(g)?re[g]:null;(N!==null?N.type!==0:I||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(G(g,S,N,I)&&(S=null),I||N===null?L(g)&&(S===null?f.removeAttribute(g):f.setAttribute(g,""+S)):N.mustUseProperty?f[N.propertyName]=S===null?N.type===3?!1:"":S:(g=N.attributeName,I=N.attributeNamespace,S===null?f.removeAttribute(g):(N=N.type,S=N===3||N===4&&S===!0?"":""+S,I?f.setAttributeNS(I,g,S):f.setAttribute(g,S))))}var Se=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ne=Symbol.for("react.element"),nt=Symbol.for("react.portal"),pt=Symbol.for("react.fragment"),mt=Symbol.for("react.strict_mode"),Tt=Symbol.for("react.profiler"),Mt=Symbol.for("react.provider"),Zt=Symbol.for("react.context"),hn=Symbol.for("react.forward_ref"),on=Symbol.for("react.suspense"),nn=Symbol.for("react.suspense_list"),Rn=Symbol.for("react.memo"),Ee=Symbol.for("react.lazy"),Oe=Symbol.for("react.offscreen"),me=Symbol.iterator;function ze(f){return f===null||typeof f!="object"?null:(f=me&&f[me]||f["@@iterator"],typeof f=="function"?f:null)}var $e=Object.assign,ue;function De(f){if(ue===void 0)try{throw Error()}catch(S){var g=S.stack.trim().match(/\n( *(at )?)/);ue=g&&g[1]||""}return`
`+ue+f}var dt=!1;function Et(f,g){if(!f||dt)return"";dt=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(ot){var I=ot}Reflect.construct(f,[],g)}else{try{g.call()}catch(ot){I=ot}f.call(g.prototype)}else{try{throw Error()}catch(ot){I=ot}f()}}catch(ot){if(ot&&I&&typeof ot.stack=="string"){for(var N=ot.stack.split(`
`),j=I.stack.split(`
`),Q=N.length-1,Te=j.length-1;1<=Q&&0<=Te&&N[Q]!==j[Te];)Te--;for(;1<=Q&&0<=Te;Q--,Te--)if(N[Q]!==j[Te]){if(Q!==1||Te!==1)do if(Q--,Te--,0>Te||N[Q]!==j[Te]){var ke=`
`+N[Q].replace(" at new "," at ");return f.displayName&&ke.includes("<anonymous>")&&(ke=ke.replace("<anonymous>",f.displayName)),ke}while(1<=Q&&0<=Te);break}}}finally{dt=!1,Error.prepareStackTrace=S}return(f=f?f.displayName||f.name:"")?De(f):""}function kt(f){switch(f.tag){case 5:return De(f.type);case 16:return De("Lazy");case 13:return De("Suspense");case 19:return De("SuspenseList");case 0:case 2:case 15:return f=Et(f.type,!1),f;case 11:return f=Et(f.type.render,!1),f;case 1:return f=Et(f.type,!0),f;default:return""}}function ht(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case pt:return"Fragment";case nt:return"Portal";case Tt:return"Profiler";case mt:return"StrictMode";case on:return"Suspense";case nn:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case Zt:return(f.displayName||"Context")+".Consumer";case Mt:return(f._context.displayName||"Context")+".Provider";case hn:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case Rn:return g=f.displayName||null,g!==null?g:ht(f.type)||"Memo";case Ee:g=f._payload,f=f._init;try{return ht(f(g))}catch{}}return null}function vt(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ht(g);case 8:return g===mt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ut(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Bt(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Wt(f){var g=Bt(f)?"checked":"value",S=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),I=""+f[g];if(!f.hasOwnProperty(g)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var N=S.get,j=S.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return N.call(this)},set:function(Q){I=""+Q,j.call(this,Q)}}),Object.defineProperty(f,g,{enumerable:S.enumerable}),{getValue:function(){return I},setValue:function(Q){I=""+Q},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function jn(f){f._valueTracker||(f._valueTracker=Wt(f))}function Wn(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var S=g.getValue(),I="";return f&&(I=Bt(f)?f.checked?"true":"false":f.value),f=I,f!==S?(g.setValue(f),!0):!1}function qn(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function Jn(f,g){var S=g.checked;return $e({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S??f._wrapperState.initialChecked})}function pn(f,g){var S=g.defaultValue==null?"":g.defaultValue,I=g.checked!=null?g.checked:g.defaultChecked;S=ut(g.value!=null?g.value:S),f._wrapperState={initialChecked:I,initialValue:S,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function mn(f,g){g=g.checked,g!=null&&le(f,"checked",g,!1)}function Us(f,g){mn(f,g);var S=ut(g.value),I=g.type;if(S!=null)I==="number"?(S===0&&f.value===""||f.value!=S)&&(f.value=""+S):f.value!==""+S&&(f.value=""+S);else if(I==="submit"||I==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?Di(f,g.type,S):g.hasOwnProperty("defaultValue")&&Di(f,g.type,ut(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function ki(f,g,S){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var I=g.type;if(!(I!=="submit"&&I!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,S||g===f.value||(f.value=g),f.defaultValue=g}S=f.name,S!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,S!==""&&(f.name=S)}function Di(f,g,S){(g!=="number"||qn(f.ownerDocument)!==f)&&(S==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+S&&(f.defaultValue=""+S))}var Gi=Array.isArray;function mi(f,g,S,I){if(f=f.options,g){g={};for(var N=0;N<S.length;N++)g["$"+S[N]]=!0;for(S=0;S<f.length;S++)N=g.hasOwnProperty("$"+f[S].value),f[S].selected!==N&&(f[S].selected=N),N&&I&&(f[S].defaultSelected=!0)}else{for(S=""+ut(S),g=null,N=0;N<f.length;N++){if(f[N].value===S){f[N].selected=!0,I&&(f[N].defaultSelected=!0);return}g!==null||f[N].disabled||(g=f[N])}g!==null&&(g.selected=!0)}}function bs(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(t(91));return $e({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function To(f,g){var S=g.value;if(S==null){if(S=g.children,g=g.defaultValue,S!=null){if(g!=null)throw Error(t(92));if(Gi(S)){if(1<S.length)throw Error(t(93));S=S[0]}g=S}g==null&&(g=""),S=g}f._wrapperState={initialValue:ut(S)}}function ea(f,g){var S=ut(g.value),I=ut(g.defaultValue);S!=null&&(S=""+S,S!==f.value&&(f.value=S),g.defaultValue==null&&f.defaultValue!==S&&(f.defaultValue=S)),I!=null&&(f.defaultValue=""+I)}function So(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function Ao(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function so(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?Ao(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var Po,Le=(function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,S,I,N){MSApp.execUnsafeLocalFunction(function(){return f(g,S,I,N)})}:f})(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(Po=Po||document.createElement("div"),Po.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Po.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function Y(f,g){if(g){var S=f.firstChild;if(S&&S===f.lastChild&&S.nodeType===3){S.nodeValue=g;return}}f.textContent=g}var K={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ne=["Webkit","ms","Moz","O"];Object.keys(K).forEach(function(f){ne.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),K[g]=K[f]})});function xe(f,g,S){return g==null||typeof g=="boolean"||g===""?"":S||typeof g!="number"||g===0||K.hasOwnProperty(f)&&K[f]?(""+g).trim():g+"px"}function Ce(f,g){f=f.style;for(var S in g)if(g.hasOwnProperty(S)){var I=S.indexOf("--")===0,N=xe(S,g[S],I);S==="float"&&(S="cssFloat"),I?f.setProperty(S,N):f[S]=N}}var Fe=$e({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ke(f,g){if(g){if(Fe[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(t(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(t(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(t(61))}if(g.style!=null&&typeof g.style!="object")throw Error(t(62))}}function Ue(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var it=null;function yt(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var at=null,Vt=null,Be=null;function ln(f){if(f=Qa(f)){if(typeof at!="function")throw Error(t(280));var g=f.stateNode;g&&(g=nu(g),at(f.stateNode,f.type,g))}}function Mn(f){Vt?Be?Be.push(f):Be=[f]:Vt=f}function qt(){if(Vt){var f=Vt,g=Be;if(Be=Vt=null,ln(f),g)for(f=0;f<g.length;f++)ln(g[f])}}function _n(f,g){return f(g)}function sr(){}var Tr=!1;function zr(f,g,S){if(Tr)return f(g,S);Tr=!0;try{return _n(f,g,S)}finally{Tr=!1,(Vt!==null||Be!==null)&&(sr(),qt())}}function Sr(f,g){var S=f.stateNode;if(S===null)return null;var I=nu(S);if(I===null)return null;S=I[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(f=f.type,I=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!I;break e;default:f=!1}if(f)return null;if(S&&typeof S!="function")throw Error(t(231,g,typeof S));return S}var Rr=!1;if(a)try{var Gn={};Object.defineProperty(Gn,"passive",{get:function(){Rr=!0}}),window.addEventListener("test",Gn,Gn),window.removeEventListener("test",Gn,Gn)}catch{Rr=!1}function kr(f,g,S,I,N,j,Q,Te,ke){var ot=Array.prototype.slice.call(arguments,3);try{g.apply(S,ot)}catch(At){this.onError(At)}}var lt=!1,yr=null,gi=!1,Eo=null,_i={onError:function(f){lt=!0,yr=f}};function St(f,g,S,I,N,j,Q,Te,ke){lt=!1,yr=null,kr.apply(_i,arguments)}function bn(f,g,S,I,N,j,Q,Te,ke){if(St.apply(this,arguments),lt){if(lt){var ot=yr;lt=!1,yr=null}else throw Error(t(198));gi||(gi=!0,Eo=ot)}}function dn(f){var g=f,S=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(S=g.return),f=g.return;while(f)}return g.tag===3?S:null}function Yr(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function ta(f){if(dn(f)!==f)throw Error(t(188))}function na(f){var g=f.alternate;if(!g){if(g=dn(f),g===null)throw Error(t(188));return g!==f?null:f}for(var S=f,I=g;;){var N=S.return;if(N===null)break;var j=N.alternate;if(j===null){if(I=N.return,I!==null){S=I;continue}break}if(N.child===j.child){for(j=N.child;j;){if(j===S)return ta(N),f;if(j===I)return ta(N),g;j=j.sibling}throw Error(t(188))}if(S.return!==I.return)S=N,I=j;else{for(var Q=!1,Te=N.child;Te;){if(Te===S){Q=!0,S=N,I=j;break}if(Te===I){Q=!0,I=N,S=j;break}Te=Te.sibling}if(!Q){for(Te=j.child;Te;){if(Te===S){Q=!0,S=j,I=N;break}if(Te===I){Q=!0,I=j,S=N;break}Te=Te.sibling}if(!Q)throw Error(t(189))}}if(S.alternate!==I)throw Error(t(190))}if(S.tag!==3)throw Error(t(188));return S.stateNode.current===S?f:g}function yn(f){return f=na(f),f!==null?Mc(f):null}function Mc(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=Mc(f);if(g!==null)return g;f=f.sibling}return null}var Co=e.unstable_scheduleCallback,Rc=e.unstable_cancelCallback,oo=e.unstable_shouldYield,Il=e.unstable_requestPaint,An=e.unstable_now,ku=e.unstable_getCurrentPriorityLevel,yi=e.unstable_ImmediatePriority,Qn=e.unstable_UserBlockingPriority,kc=e.unstable_NormalPriority,Dc=e.unstable_LowPriority,Du=e.unstable_IdlePriority,Vs=null,ai=null;function Oh(f){if(ai&&typeof ai.onCommitFiberRoot=="function")try{ai.onCommitFiberRoot(Vs,f,void 0,(f.current.flags&128)===128)}catch{}}var ws=Math.clz32?Math.clz32:Yd,Gd=Math.log,Ml=Math.LN2;function Yd(f){return f>>>=0,f===0?32:31-(Gd(f)/Ml|0)|0}var Ou=64,Lu=4194304;function Oc(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Rl(f,g){var S=f.pendingLanes;if(S===0)return 0;var I=0,N=f.suspendedLanes,j=f.pingedLanes,Q=S&268435455;if(Q!==0){var Te=Q&~N;Te!==0?I=Oc(Te):(j&=Q,j!==0&&(I=Oc(j)))}else Q=S&~N,Q!==0?I=Oc(Q):j!==0&&(I=Oc(j));if(I===0)return 0;if(g!==0&&g!==I&&(g&N)===0&&(N=I&-I,j=g&-g,N>=j||N===16&&(j&4194240)!==0))return g;if((I&4)!==0&&(I|=S&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=I;0<g;)S=31-ws(g),N=1<<S,I|=f[S],g&=~N;return I}function kl(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lh(f,g){for(var S=f.suspendedLanes,I=f.pingedLanes,N=f.expirationTimes,j=f.pendingLanes;0<j;){var Q=31-ws(j),Te=1<<Q,ke=N[Q];ke===-1?((Te&S)===0||(Te&I)!==0)&&(N[Q]=kl(Te,g)):ke<=g&&(f.expiredLanes|=Te),j&=~Te}}function Lc(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function Ba(){var f=Ou;return Ou<<=1,(Ou&4194240)===0&&(Ou=64),f}function Fc(f){for(var g=[],S=0;31>S;S++)g.push(f);return g}function za(f,g,S){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-ws(g),f[g]=S}function Lp(f,g){var S=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var I=f.eventTimes;for(f=f.expirationTimes;0<S;){var N=31-ws(S),j=1<<N;g[N]=0,I[N]=-1,f[N]=-1,S&=~j}}function ra(f,g){var S=f.entangledLanes|=g;for(f=f.entanglements;S;){var I=31-ws(S),N=1<<I;N&g|f[I]&g&&(f[I]|=g),S&=~N}}var $n=0;function Ts(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var Pn,Io,Mo,ao,ia,Tn=!1,lo=[],js=null,$s=null,Pr=null,Er=new Map,Hr=new Map,or=[],rr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Fh(f,g){switch(f){case"focusin":case"focusout":js=null;break;case"dragenter":case"dragleave":$s=null;break;case"mouseover":case"mouseout":Pr=null;break;case"pointerover":case"pointerout":Er.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hr.delete(g.pointerId)}}function Zr(f,g,S,I,N,j){return f===null||f.nativeEvent!==j?(f={blockedOn:g,domEventName:S,eventSystemFlags:I,nativeEvent:j,targetContainers:[N]},g!==null&&(g=Qa(g),g!==null&&Io(g)),f):(f.eventSystemFlags|=I,g=f.targetContainers,N!==null&&g.indexOf(N)===-1&&g.push(N),f)}function ls(f,g,S,I,N){switch(g){case"focusin":return js=Zr(js,f,g,S,I,N),!0;case"dragenter":return $s=Zr($s,f,g,S,I,N),!0;case"mouseover":return Pr=Zr(Pr,f,g,S,I,N),!0;case"pointerover":var j=N.pointerId;return Er.set(j,Zr(Er.get(j)||null,f,g,S,I,N)),!0;case"gotpointercapture":return j=N.pointerId,Hr.set(j,Zr(Hr.get(j)||null,f,g,S,I,N)),!0}return!1}function li(f){var g=Gs(f.target);if(g!==null){var S=dn(g);if(S!==null){if(g=S.tag,g===13){if(g=Yr(S),g!==null){f.blockedOn=g,ia(f.priority,function(){Mo(S)});return}}else if(g===3&&S.stateNode.current.memoizedState.isDehydrated){f.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}f.blockedOn=null}function er(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var S=oa(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(S===null){S=f.nativeEvent;var I=new S.constructor(S.type,S);it=I,S.target.dispatchEvent(I),it=null}else return g=Qa(S),g!==null&&Io(g),f.blockedOn=S,!1;g.shift()}return!0}function sa(f,g,S){er(f)&&S.delete(g)}function rn(){Tn=!1,js!==null&&er(js)&&(js=null),$s!==null&&er($s)&&($s=null),Pr!==null&&er(Pr)&&(Pr=null),Er.forEach(sa),Hr.forEach(sa)}function cn(f,g){f.blockedOn===g&&(f.blockedOn=null,Tn||(Tn=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,rn)))}function cs(f){function g(N){return cn(N,f)}if(0<lo.length){cn(lo[0],f);for(var S=1;S<lo.length;S++){var I=lo[S];I.blockedOn===f&&(I.blockedOn=null)}}for(js!==null&&cn(js,f),$s!==null&&cn($s,f),Pr!==null&&cn(Pr,f),Er.forEach(g),Hr.forEach(g),S=0;S<or.length;S++)I=or[S],I.blockedOn===f&&(I.blockedOn=null);for(;0<or.length&&(S=or[0],S.blockedOn===null);)li(S),S.blockedOn===null&&or.shift()}var En=Se.ReactCurrentBatchConfig,vi=!0;function co(f,g,S,I){var N=$n,j=En.transition;En.transition=null;try{$n=1,Dl(f,g,S,I)}finally{$n=N,En.transition=j}}function uo(f,g,S,I){var N=$n,j=En.transition;En.transition=null;try{$n=4,Dl(f,g,S,I)}finally{$n=N,En.transition=j}}function Dl(f,g,S,I){if(vi){var N=oa(f,g,S,I);if(N===null)Xa(f,g,I,Ol,S),Fh(f,I);else if(ls(N,f,g,S,I))I.stopPropagation();else if(Fh(f,I),g&4&&-1<rr.indexOf(f)){for(;N!==null;){var j=Qa(N);if(j!==null&&Pn(j),j=oa(f,g,S,I),j===null&&Xa(f,g,I,Ol,S),j===N)break;N=j}N!==null&&I.stopPropagation()}else Xa(f,g,I,null,S)}}var Ol=null;function oa(f,g,S,I){if(Ol=null,f=yt(I),f=Gs(f),f!==null)if(g=dn(f),g===null)f=null;else if(S=g.tag,S===13){if(f=Yr(g),f!==null)return f;f=null}else if(S===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return Ol=f,null}function Ll(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ku()){case yi:return 1;case Qn:return 4;case kc:case Dc:return 16;case Du:return 536870912;default:return 16}default:return 16}}var Ws=null,Fl=null,Ua=null;function Ss(){if(Ua)return Ua;var f,g=Fl,S=g.length,I,N="value"in Ws?Ws.value:Ws.textContent,j=N.length;for(f=0;f<S&&g[f]===N[f];f++);var Q=S-f;for(I=1;I<=Q&&g[S-I]===N[j-I];I++);return Ua=N.slice(f,1<I?1-I:void 0)}function Dr(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function Ro(){return!0}function Nl(){return!1}function Xr(f){function g(S,I,N,j,Q){this._reactName=S,this._targetInst=N,this.type=I,this.nativeEvent=j,this.target=Q,this.currentTarget=null;for(var Te in f)f.hasOwnProperty(Te)&&(S=f[Te],this[Te]=S?S(j):j[Te]);return this.isDefaultPrevented=(j.defaultPrevented!=null?j.defaultPrevented:j.returnValue===!1)?Ro:Nl,this.isPropagationStopped=Nl,this}return $e(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=Ro)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=Ro)},persist:function(){},isPersistent:Ro}),g}var ar={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fu=Xr(ar),ko=$e({},ar,{view:0,detail:0}),Nh=Xr(ko),Bh,aa,Or,la=$e({},ko,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bl,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Or&&(Or&&f.type==="mousemove"?(Bh=f.screenX-Or.screenX,aa=f.screenY-Or.screenY):aa=Bh=0,Or=f),Bh)},movementY:function(f){return"movementY"in f?f.movementY:aa}}),Hs=Xr(la),Nc=$e({},la,{dataTransfer:0}),Bc=Xr(Nc),zc=$e({},ko,{relatedTarget:0}),Kr=Xr(zc),Kd=$e({},ar,{animationName:0,elapsedTime:0,pseudoElement:0}),Nu=Xr(Kd),Fp=$e({},ar,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),zh=Xr(Fp),Np=$e({},ar,{data:0}),Jd=Xr(Np),Bu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Uh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Va={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vh(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=Va[f])?!!g[f]:!1}function Bl(){return Vh}var Zs=$e({},ko,{key:function(f){if(f.key){var g=Bu[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=Dr(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Uh[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bl,charCode:function(f){return f.type==="keypress"?Dr(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Dr(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),Bp=Xr(Zs),zu=$e({},la,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zl=Xr(zu),Uc=$e({},ko,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bl}),zp=Xr(Uc),Uu=$e({},ar,{propertyName:0,elapsedTime:0,pseudoElement:0}),Up=Xr(Uu),ja=$e({},la,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Qd=Xr(ja),jh=[9,13,27,32],$h=a&&"CompositionEvent"in window,Ul=null;a&&"documentMode"in document&&(Ul=document.documentMode);var Wh=a&&"TextEvent"in window&&!Ul,Hh=a&&(!$h||Ul&&8<Ul&&11>=Ul),Vc=" ",Zh=!1;function Xh(f,g){switch(f){case"keyup":return jh.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ca(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var ua=!1;function qh(f,g){switch(f){case"compositionend":return ca(g);case"keypress":return g.which!==32?null:(Zh=!0,Vc);case"textInput":return f=g.data,f===Vc&&Zh?null:f;default:return null}}function jc(f,g){if(ua)return f==="compositionend"||!$h&&Xh(f,g)?(f=Ss(),Ua=Fl=Ws=null,ua=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Hh&&g.locale!=="ko"?null:g.data;default:return null}}var Vp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vl(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!Vp[f.type]:g==="textarea"}function Gh(f,g,S,I){Mn(I),g=Kc(g,"onChange"),0<g.length&&(S=new Fu("onChange","change",null,S,I),f.push({event:S,listeners:g}))}var $c=null,jl=null;function ef(f){sf(f,0)}function $l(f){var g=el(f);if(Wn(g))return f}function Yh(f,g){if(f==="change")return g}var Kh=!1;if(a){var Wl;if(a){var Xs="oninput"in document;if(!Xs){var Fn=document.createElement("div");Fn.setAttribute("oninput","return;"),Xs=typeof Fn.oninput=="function"}Wl=Xs}else Wl=!1;Kh=Wl&&(!document.documentMode||9<document.documentMode)}function Vu(){$c&&($c.detachEvent("onpropertychange",ju),jl=$c=null)}function ju(f){if(f.propertyName==="value"&&$l(jl)){var g=[];Gh(g,jl,f,yt(f)),zr(ef,g)}}function tf(f,g,S){f==="focusin"?(Vu(),$c=g,jl=S,$c.attachEvent("onpropertychange",ju)):f==="focusout"&&Vu()}function Jh(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return $l(jl)}function $a(f,g){if(f==="click")return $l(g)}function Qh(f,g){if(f==="input"||f==="change")return $l(g)}function jp(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var qs=typeof Object.is=="function"?Object.is:jp;function Wc(f,g){if(qs(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var S=Object.keys(f),I=Object.keys(g);if(S.length!==I.length)return!1;for(I=0;I<S.length;I++){var N=S[I];if(!v.call(g,N)||!qs(f[N],g[N]))return!1}return!0}function nf(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function ed(f,g){var S=nf(f);f=0;for(var I;S;){if(S.nodeType===3){if(I=f+S.textContent.length,f<=g&&I>=g)return{node:S,offset:g-f};f=I}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=nf(S)}}function rf(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?rf(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function td(){for(var f=window,g=qn();g instanceof f.HTMLIFrameElement;){try{var S=typeof g.contentWindow.location.href=="string"}catch{S=!1}if(S)f=g.contentWindow;else break;g=qn(f.document)}return g}function Hl(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function $u(f){var g=td(),S=f.focusedElem,I=f.selectionRange;if(g!==S&&S&&S.ownerDocument&&rf(S.ownerDocument.documentElement,S)){if(I!==null&&Hl(S)){if(g=I.start,f=I.end,f===void 0&&(f=g),"selectionStart"in S)S.selectionStart=g,S.selectionEnd=Math.min(f,S.value.length);else if(f=(g=S.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var N=S.textContent.length,j=Math.min(I.start,N);I=I.end===void 0?j:Math.min(I.end,N),!f.extend&&j>I&&(N=I,I=j,j=N),N=ed(S,j);var Q=ed(S,I);N&&Q&&(f.rangeCount!==1||f.anchorNode!==N.node||f.anchorOffset!==N.offset||f.focusNode!==Q.node||f.focusOffset!==Q.offset)&&(g=g.createRange(),g.setStart(N.node,N.offset),f.removeAllRanges(),j>I?(f.addRange(g),f.extend(Q.node,Q.offset)):(g.setEnd(Q.node,Q.offset),f.addRange(g)))}}for(g=[],f=S;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<g.length;S++)f=g[S],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var Wu=a&&"documentMode"in document&&11>=document.documentMode,ha=null,Do=null,Oo=null,da=!1;function us(f,g,S){var I=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;da||ha==null||ha!==qn(I)||(I=ha,"selectionStart"in I&&Hl(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),Oo&&Wc(Oo,I)||(Oo=I,I=Kc(Do,"onSelect"),0<I.length&&(g=new Fu("onSelect","select",null,g,S),f.push({event:g,listeners:I}),g.target=ha)))}function Hc(f,g){var S={};return S[f.toLowerCase()]=g.toLowerCase(),S["Webkit"+f]="webkit"+g,S["Moz"+f]="moz"+g,S}var Wa={animationend:Hc("Animation","AnimationEnd"),animationiteration:Hc("Animation","AnimationIteration"),animationstart:Hc("Animation","AnimationStart"),transitionend:Hc("Transition","TransitionEnd")},Zc={},fa={};a&&(fa=document.createElement("div").style,"AnimationEvent"in window||(delete Wa.animationend.animation,delete Wa.animationiteration.animation,delete Wa.animationstart.animation),"TransitionEvent"in window||delete Wa.transitionend.transition);function Ha(f){if(Zc[f])return Zc[f];if(!Wa[f])return f;var g=Wa[f],S;for(S in g)if(g.hasOwnProperty(S)&&S in fa)return Zc[f]=g[S];return f}var Xc=Ha("animationend"),Zl=Ha("animationiteration"),qc=Ha("animationstart"),nd=Ha("transitionend"),Za=new Map,Lo="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fo(f,g){Za.set(f,g),c(g,[f])}for(var Gc=0;Gc<Lo.length;Gc++){var Cn=Lo[Gc],Yc=Cn.toLowerCase(),$p=Cn[0].toUpperCase()+Cn.slice(1);Fo(Yc,"on"+$p)}Fo(Xc,"onAnimationEnd"),Fo(Zl,"onAnimationIteration"),Fo(qc,"onAnimationStart"),Fo("dblclick","onDoubleClick"),Fo("focusin","onFocus"),Fo("focusout","onBlur"),Fo(nd,"onTransitionEnd"),d("onMouseEnter",["mouseout","mouseover"]),d("onMouseLeave",["mouseout","mouseover"]),d("onPointerEnter",["pointerout","pointerover"]),d("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pa=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xl));function rd(f,g,S){var I=f.type||"unknown-event";f.currentTarget=S,bn(I,g,void 0,f),f.currentTarget=null}function sf(f,g){g=(g&4)!==0;for(var S=0;S<f.length;S++){var I=f[S],N=I.event;I=I.listeners;e:{var j=void 0;if(g)for(var Q=I.length-1;0<=Q;Q--){var Te=I[Q],ke=Te.instance,ot=Te.currentTarget;if(Te=Te.listener,ke!==j&&N.isPropagationStopped())break e;rd(N,Te,ot),j=ke}else for(Q=0;Q<I.length;Q++){if(Te=I[Q],ke=Te.instance,ot=Te.currentTarget,Te=Te.listener,ke!==j&&N.isPropagationStopped())break e;rd(N,Te,ot),j=ke}}}if(gi)throw f=Eo,gi=!1,Eo=null,f}function hr(f,g){var S=g[tu];S===void 0&&(S=g[tu]=new Set);var I=f+"__bubble";S.has(I)||(Gl(g,f,2,!1),S.add(I))}function id(f,g,S){var I=0;g&&(I|=4),Gl(S,f,I,g)}var ql="_reactListening"+Math.random().toString(36).slice(2);function ma(f){if(!f[ql]){f[ql]=!0,r.forEach(function(S){S!=="selectionchange"&&(pa.has(S)||id(S,!1,f),id(S,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[ql]||(g[ql]=!0,id("selectionchange",!1,g))}}function Gl(f,g,S,I){switch(Ll(g)){case 1:var N=co;break;case 4:N=uo;break;default:N=Dl}S=N.bind(null,g,S,f),N=void 0,!Rr||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(N=!0),I?N!==void 0?f.addEventListener(g,S,{capture:!0,passive:N}):f.addEventListener(g,S,!0):N!==void 0?f.addEventListener(g,S,{passive:N}):f.addEventListener(g,S,!1)}function Xa(f,g,S,I,N){var j=I;if((g&1)===0&&(g&2)===0&&I!==null)e:for(;;){if(I===null)return;var Q=I.tag;if(Q===3||Q===4){var Te=I.stateNode.containerInfo;if(Te===N||Te.nodeType===8&&Te.parentNode===N)break;if(Q===4)for(Q=I.return;Q!==null;){var ke=Q.tag;if((ke===3||ke===4)&&(ke=Q.stateNode.containerInfo,ke===N||ke.nodeType===8&&ke.parentNode===N))return;Q=Q.return}for(;Te!==null;){if(Q=Gs(Te),Q===null)return;if(ke=Q.tag,ke===5||ke===6){I=j=Q;continue e}Te=Te.parentNode}}I=I.return}zr(function(){var ot=j,At=yt(S),Ct=[];e:{var bt=Za.get(f);if(bt!==void 0){var Ht=Fu,Kt=f;switch(f){case"keypress":if(Dr(S)===0)break e;case"keydown":case"keyup":Ht=Bp;break;case"focusin":Kt="focus",Ht=Kr;break;case"focusout":Kt="blur",Ht=Kr;break;case"beforeblur":case"afterblur":Ht=Kr;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ht=Hs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ht=Bc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ht=zp;break;case Xc:case Zl:case qc:Ht=Nu;break;case nd:Ht=Up;break;case"scroll":Ht=Nh;break;case"wheel":Ht=Qd;break;case"copy":case"cut":case"paste":Ht=zh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ht=zl}var Jt=(g&4)!==0,qr=!Jt&&f==="scroll",Qe=Jt?bt!==null?bt+"Capture":null:bt;Jt=[];for(var je=ot,rt;je!==null;){rt=je;var Nt=rt.stateNode;if(rt.tag===5&&Nt!==null&&(rt=Nt,Qe!==null&&(Nt=Sr(je,Qe),Nt!=null&&Jt.push(qa(je,Nt,rt)))),qr)break;je=je.return}0<Jt.length&&(bt=new Ht(bt,Kt,null,S,At),Ct.push({event:bt,listeners:Jt}))}}if((g&7)===0){e:{if(bt=f==="mouseover"||f==="pointerover",Ht=f==="mouseout"||f==="pointerout",bt&&S!==it&&(Kt=S.relatedTarget||S.fromElement)&&(Gs(Kt)||Kt[Ps]))break e;if((Ht||bt)&&(bt=At.window===At?At:(bt=At.ownerDocument)?bt.defaultView||bt.parentWindow:window,Ht?(Kt=S.relatedTarget||S.toElement,Ht=ot,Kt=Kt?Gs(Kt):null,Kt!==null&&(qr=dn(Kt),Kt!==qr||Kt.tag!==5&&Kt.tag!==6)&&(Kt=null)):(Ht=null,Kt=ot),Ht!==Kt)){if(Jt=Hs,Nt="onMouseLeave",Qe="onMouseEnter",je="mouse",(f==="pointerout"||f==="pointerover")&&(Jt=zl,Nt="onPointerLeave",Qe="onPointerEnter",je="pointer"),qr=Ht==null?bt:el(Ht),rt=Kt==null?bt:el(Kt),bt=new Jt(Nt,je+"leave",Ht,S,At),bt.target=qr,bt.relatedTarget=rt,Nt=null,Gs(At)===ot&&(Jt=new Jt(Qe,je+"enter",Kt,S,At),Jt.target=rt,Jt.relatedTarget=qr,Nt=Jt),qr=Nt,Ht&&Kt)t:{for(Jt=Ht,Qe=Kt,je=0,rt=Jt;rt;rt=ho(rt))je++;for(rt=0,Nt=Qe;Nt;Nt=ho(Nt))rt++;for(;0<je-rt;)Jt=ho(Jt),je--;for(;0<rt-je;)Qe=ho(Qe),rt--;for(;je--;){if(Jt===Qe||Qe!==null&&Jt===Qe.alternate)break t;Jt=ho(Jt),Qe=ho(Qe)}Jt=null}else Jt=null;Ht!==null&&Yl(Ct,bt,Ht,Jt,!1),Kt!==null&&qr!==null&&Yl(Ct,qr,Kt,Jt,!0)}}e:{if(bt=ot?el(ot):window,Ht=bt.nodeName&&bt.nodeName.toLowerCase(),Ht==="select"||Ht==="input"&&bt.type==="file")var Qt=Yh;else if(Vl(bt))if(Kh)Qt=Qh;else{Qt=Jh;var un=tf}else(Ht=bt.nodeName)&&Ht.toLowerCase()==="input"&&(bt.type==="checkbox"||bt.type==="radio")&&(Qt=$a);if(Qt&&(Qt=Qt(f,ot))){Gh(Ct,Qt,S,At);break e}un&&un(f,bt,ot),f==="focusout"&&(un=bt._wrapperState)&&un.controlled&&bt.type==="number"&&Di(bt,"number",bt.value)}switch(un=ot?el(ot):window,f){case"focusin":(Vl(un)||un.contentEditable==="true")&&(ha=un,Do=ot,Oo=null);break;case"focusout":Oo=Do=ha=null;break;case"mousedown":da=!0;break;case"contextmenu":case"mouseup":case"dragend":da=!1,us(Ct,S,At);break;case"selectionchange":if(Wu)break;case"keydown":case"keyup":us(Ct,S,At)}var tn;if($h)e:{switch(f){case"compositionstart":var an="onCompositionStart";break e;case"compositionend":an="onCompositionEnd";break e;case"compositionupdate":an="onCompositionUpdate";break e}an=void 0}else ua?Xh(f,S)&&(an="onCompositionEnd"):f==="keydown"&&S.keyCode===229&&(an="onCompositionStart");an&&(Hh&&S.locale!=="ko"&&(ua||an!=="onCompositionStart"?an==="onCompositionEnd"&&ua&&(tn=Ss()):(Ws=At,Fl="value"in Ws?Ws.value:Ws.textContent,ua=!0)),un=Kc(ot,an),0<un.length&&(an=new Jd(an,f,null,S,At),Ct.push({event:an,listeners:un}),tn?an.data=tn:(tn=ca(S),tn!==null&&(an.data=tn)))),(tn=Wh?qh(f,S):jc(f,S))&&(ot=Kc(ot,"onBeforeInput"),0<ot.length&&(At=new Jd("onBeforeInput","beforeinput",null,S,At),Ct.push({event:At,listeners:ot}),At.data=tn))}sf(Ct,g)})}function qa(f,g,S){return{instance:f,listener:g,currentTarget:S}}function Kc(f,g){for(var S=g+"Capture",I=[];f!==null;){var N=f,j=N.stateNode;N.tag===5&&j!==null&&(N=j,j=Sr(f,S),j!=null&&I.unshift(qa(f,j,N)),j=Sr(f,g),j!=null&&I.push(qa(f,j,N))),f=f.return}return I}function ho(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function Yl(f,g,S,I,N){for(var j=g._reactName,Q=[];S!==null&&S!==I;){var Te=S,ke=Te.alternate,ot=Te.stateNode;if(ke!==null&&ke===I)break;Te.tag===5&&ot!==null&&(Te=ot,N?(ke=Sr(S,j),ke!=null&&Q.unshift(qa(S,ke,Te))):N||(ke=Sr(S,j),ke!=null&&Q.push(qa(S,ke,Te)))),S=S.return}Q.length!==0&&f.push({event:g,listeners:Q})}var Jc=/\r\n?/g,Ga=/\u0000|\uFFFD/g;function Kl(f){return(typeof f=="string"?f:""+f).replace(Jc,`
`).replace(Ga,"")}function Jl(f,g,S){if(g=Kl(g),Kl(f)!==g&&S)throw Error(t(425))}function fo(){}var Qc=null,Ya=null;function Ql(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var eu=typeof setTimeout=="function"?setTimeout:void 0,of=typeof clearTimeout=="function"?clearTimeout:void 0,sd=typeof Promise=="function"?Promise:void 0,Hu=typeof queueMicrotask=="function"?queueMicrotask:typeof sd<"u"?function(f){return sd.resolve(null).then(f).catch(od)}:eu;function od(f){setTimeout(function(){throw f})}function Zu(f,g){var S=g,I=0;do{var N=S.nextSibling;if(f.removeChild(S),N&&N.nodeType===8)if(S=N.data,S==="/$"){if(I===0){f.removeChild(N),cs(g);return}I--}else S!=="$"&&S!=="$?"&&S!=="$!"||I++;S=N}while(S);cs(g)}function po(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function dr(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var S=f.data;if(S==="$"||S==="$!"||S==="$?"){if(g===0)return f;g--}else S==="/$"&&g++}f=f.previousSibling}return null}var As=Math.random().toString(36).slice(2),Cr="__reactFiber$"+As,ga="__reactProps$"+As,Ps="__reactContainer$"+As,tu="__reactEvents$"+As,Ka="__reactListeners$"+As,Ja="__reactHandles$"+As;function Gs(f){var g=f[Cr];if(g)return g;for(var S=f.parentNode;S;){if(g=S[Ps]||S[Cr]){if(S=g.alternate,g.child!==null||S!==null&&S.child!==null)for(f=dr(f);f!==null;){if(S=f[Cr])return S;f=dr(f)}return g}f=S,S=f.parentNode}return null}function Qa(f){return f=f[Cr]||f[Ps],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function el(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(t(33))}function nu(f){return f[ga]||null}var Xu=[],tl=-1;function hs(f){return{current:f}}function Nn(f){0>tl||(f.current=Xu[tl],Xu[tl]=null,tl--)}function Dn(f,g){tl++,Xu[tl]=f.current,f.current=g}var ds={},Jr=hs(ds),Oi=hs(!1),_a=ds;function Ys(f,g){var S=f.type.contextTypes;if(!S)return ds;var I=f.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===g)return I.__reactInternalMemoizedMaskedChildContext;var N={},j;for(j in S)N[j]=g[j];return I&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=N),N}function xi(f){return f=f.childContextTypes,f!=null}function nl(){Nn(Oi),Nn(Jr)}function ru(f,g,S){if(Jr.current!==ds)throw Error(t(168));Dn(Jr,g),Dn(Oi,S)}function iu(f,g,S){var I=f.stateNode;if(g=g.childContextTypes,typeof I.getChildContext!="function")return S;I=I.getChildContext();for(var N in I)if(!(N in g))throw Error(t(108,vt(f)||"Unknown",N));return $e({},S,I)}function Li(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||ds,_a=Jr.current,Dn(Jr,f),Dn(Oi,Oi.current),!0}function bi(f,g,S){var I=f.stateNode;if(!I)throw Error(t(169));S?(f=iu(f,g,_a),I.__reactInternalMemoizedMergedChildContext=f,Nn(Oi),Nn(Jr),Dn(Jr,f)):Nn(Oi),Dn(Oi,S)}var mo=null,Yi=!1,ya=!1;function ec(f){mo===null?mo=[f]:mo.push(f)}function Wp(f){Yi=!0,ec(f)}function va(){if(!ya&&mo!==null){ya=!0;var f=0,g=$n;try{var S=mo;for($n=1;f<S.length;f++){var I=S[f];do I=I(!0);while(I!==null)}mo=null,Yi=!1}catch(N){throw mo!==null&&(mo=mo.slice(f+1)),Co(yi,va),N}finally{$n=g,ya=!1}}return null}var No=[],rl=0,go=null,Fi=0,It=[],Ki=0,_o=null,Ks=1,Ni="";function Es(f,g){No[rl++]=Fi,No[rl++]=go,go=f,Fi=g}function qu(f,g,S){It[Ki++]=Ks,It[Ki++]=Ni,It[Ki++]=_o,_o=f;var I=Ks;f=Ni;var N=32-ws(I)-1;I&=~(1<<N),S+=1;var j=32-ws(g)+N;if(30<j){var Q=N-N%5;j=(I&(1<<Q)-1).toString(32),I>>=Q,N-=Q,Ks=1<<32-ws(g)+N|S<<N|I,Ni=j+f}else Ks=1<<j|S<<N|I,Ni=f}function In(f){f.return!==null&&(Es(f,1),qu(f,1,0))}function su(f){for(;f===go;)go=No[--rl],No[rl]=null,Fi=No[--rl],No[rl]=null;for(;f===_o;)_o=It[--Ki],It[Ki]=null,Ni=It[--Ki],It[Ki]=null,Ks=It[--Ki],It[Ki]=null}var Ji=null,Bi=null,gr=!1,Cs=null;function ad(f,g){var S=xo(5,null,null,0);S.elementType="DELETED",S.stateNode=g,S.return=f,g=f.deletions,g===null?(f.deletions=[S],f.flags|=16):g.push(S)}function Gu(f,g){switch(f.tag){case 5:var S=f.type;return g=g.nodeType!==1||S.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,Ji=f,Bi=po(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,Ji=f,Bi=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(S=_o!==null?{id:Ks,overflow:Ni}:null,f.memoizedState={dehydrated:g,treeContext:S,retryLane:1073741824},S=xo(18,null,null,0),S.stateNode=g,S.return=f,f.child=S,Ji=f,Bi=null,!0):!1;default:return!1}}function ou(f){return(f.mode&1)!==0&&(f.flags&128)===0}function Yu(f){if(gr){var g=Bi;if(g){var S=g;if(!Gu(f,g)){if(ou(f))throw Error(t(418));g=po(S.nextSibling);var I=Ji;g&&Gu(f,g)?ad(I,S):(f.flags=f.flags&-4097|2,gr=!1,Ji=f)}}else{if(ou(f))throw Error(t(418));f.flags=f.flags&-4097|2,gr=!1,Ji=f}}}function Ku(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;Ji=f}function au(f){if(f!==Ji)return!1;if(!gr)return Ku(f),gr=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!Ql(f.type,f.memoizedProps)),g&&(g=Bi)){if(ou(f))throw lu(),Error(t(418));for(;g;)ad(f,g),g=po(g.nextSibling)}if(Ku(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(t(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var S=f.data;if(S==="/$"){if(g===0){Bi=po(f.nextSibling);break e}g--}else S!=="$"&&S!=="$!"&&S!=="$?"||g++}f=f.nextSibling}Bi=null}}else Bi=Ji?po(f.stateNode.nextSibling):null;return!0}function lu(){for(var f=Bi;f;)f=po(f.nextSibling)}function fs(){Bi=Ji=null,gr=!1}function Hn(f){Cs===null?Cs=[f]:Cs.push(f)}var Hp=Se.ReactCurrentBatchConfig;function xa(f,g,S){if(f=S.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(t(309));var I=S.stateNode}if(!I)throw Error(t(147,f));var N=I,j=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===j?g.ref:(g=function(Q){var Te=N.refs;Q===null?delete Te[j]:Te[j]=Q},g._stringRef=j,g)}if(typeof f!="string")throw Error(t(284));if(!S._owner)throw Error(t(290,f))}return f}function il(f,g){throw f=Object.prototype.toString.call(g),Error(t(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function Ju(f){var g=f._init;return g(f._payload)}function Qu(f){function g(Qe,je){if(f){var rt=Qe.deletions;rt===null?(Qe.deletions=[je],Qe.flags|=16):rt.push(je)}}function S(Qe,je){if(!f)return null;for(;je!==null;)g(Qe,je),je=je.sibling;return null}function I(Qe,je){for(Qe=new Map;je!==null;)je.key!==null?Qe.set(je.key,je):Qe.set(je.index,je),je=je.sibling;return Qe}function N(Qe,je){return Qe=gc(Qe,je),Qe.index=0,Qe.sibling=null,Qe}function j(Qe,je,rt){return Qe.index=rt,f?(rt=Qe.alternate,rt!==null?(rt=rt.index,rt<je?(Qe.flags|=2,je):rt):(Qe.flags|=2,je)):(Qe.flags|=1048576,je)}function Q(Qe){return f&&Qe.alternate===null&&(Qe.flags|=2),Qe}function Te(Qe,je,rt,Nt){return je===null||je.tag!==6?(je=fm(rt,Qe.mode,Nt),je.return=Qe,je):(je=N(je,rt),je.return=Qe,je)}function ke(Qe,je,rt,Nt){var Qt=rt.type;return Qt===pt?At(Qe,je,rt.props.children,Nt,rt.key):je!==null&&(je.elementType===Qt||typeof Qt=="object"&&Qt!==null&&Qt.$$typeof===Ee&&Ju(Qt)===je.type)?(Nt=N(je,rt.props),Nt.ref=xa(Qe,je,rt),Nt.return=Qe,Nt):(Nt=Rf(rt.type,rt.key,rt.props,null,Qe.mode,Nt),Nt.ref=xa(Qe,je,rt),Nt.return=Qe,Nt)}function ot(Qe,je,rt,Nt){return je===null||je.tag!==4||je.stateNode.containerInfo!==rt.containerInfo||je.stateNode.implementation!==rt.implementation?(je=xu(rt,Qe.mode,Nt),je.return=Qe,je):(je=N(je,rt.children||[]),je.return=Qe,je)}function At(Qe,je,rt,Nt,Qt){return je===null||je.tag!==7?(je=_c(rt,Qe.mode,Nt,Qt),je.return=Qe,je):(je=N(je,rt),je.return=Qe,je)}function Ct(Qe,je,rt){if(typeof je=="string"&&je!==""||typeof je=="number")return je=fm(""+je,Qe.mode,rt),je.return=Qe,je;if(typeof je=="object"&&je!==null){switch(je.$$typeof){case Ne:return rt=Rf(je.type,je.key,je.props,null,Qe.mode,rt),rt.ref=xa(Qe,null,je),rt.return=Qe,rt;case nt:return je=xu(je,Qe.mode,rt),je.return=Qe,je;case Ee:var Nt=je._init;return Ct(Qe,Nt(je._payload),rt)}if(Gi(je)||ze(je))return je=_c(je,Qe.mode,rt,null),je.return=Qe,je;il(Qe,je)}return null}function bt(Qe,je,rt,Nt){var Qt=je!==null?je.key:null;if(typeof rt=="string"&&rt!==""||typeof rt=="number")return Qt!==null?null:Te(Qe,je,""+rt,Nt);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case Ne:return rt.key===Qt?ke(Qe,je,rt,Nt):null;case nt:return rt.key===Qt?ot(Qe,je,rt,Nt):null;case Ee:return Qt=rt._init,bt(Qe,je,Qt(rt._payload),Nt)}if(Gi(rt)||ze(rt))return Qt!==null?null:At(Qe,je,rt,Nt,null);il(Qe,rt)}return null}function Ht(Qe,je,rt,Nt,Qt){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Qe=Qe.get(rt)||null,Te(je,Qe,""+Nt,Qt);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case Ne:return Qe=Qe.get(Nt.key===null?rt:Nt.key)||null,ke(je,Qe,Nt,Qt);case nt:return Qe=Qe.get(Nt.key===null?rt:Nt.key)||null,ot(je,Qe,Nt,Qt);case Ee:var un=Nt._init;return Ht(Qe,je,rt,un(Nt._payload),Qt)}if(Gi(Nt)||ze(Nt))return Qe=Qe.get(rt)||null,At(je,Qe,Nt,Qt,null);il(je,Nt)}return null}function Kt(Qe,je,rt,Nt){for(var Qt=null,un=null,tn=je,an=je=0,hi=null;tn!==null&&an<rt.length;an++){tn.index>an?(hi=tn,tn=null):hi=tn.sibling;var Xn=bt(Qe,tn,rt[an],Nt);if(Xn===null){tn===null&&(tn=hi);break}f&&tn&&Xn.alternate===null&&g(Qe,tn),je=j(Xn,je,an),un===null?Qt=Xn:un.sibling=Xn,un=Xn,tn=hi}if(an===rt.length)return S(Qe,tn),gr&&Es(Qe,an),Qt;if(tn===null){for(;an<rt.length;an++)tn=Ct(Qe,rt[an],Nt),tn!==null&&(je=j(tn,je,an),un===null?Qt=tn:un.sibling=tn,un=tn);return gr&&Es(Qe,an),Qt}for(tn=I(Qe,tn);an<rt.length;an++)hi=Ht(tn,Qe,an,rt[an],Nt),hi!==null&&(f&&hi.alternate!==null&&tn.delete(hi.key===null?an:hi.key),je=j(hi,je,an),un===null?Qt=hi:un.sibling=hi,un=hi);return f&&tn.forEach(function(yc){return g(Qe,yc)}),gr&&Es(Qe,an),Qt}function Jt(Qe,je,rt,Nt){var Qt=ze(rt);if(typeof Qt!="function")throw Error(t(150));if(rt=Qt.call(rt),rt==null)throw Error(t(151));for(var un=Qt=null,tn=je,an=je=0,hi=null,Xn=rt.next();tn!==null&&!Xn.done;an++,Xn=rt.next()){tn.index>an?(hi=tn,tn=null):hi=tn.sibling;var yc=bt(Qe,tn,Xn.value,Nt);if(yc===null){tn===null&&(tn=hi);break}f&&tn&&yc.alternate===null&&g(Qe,tn),je=j(yc,je,an),un===null?Qt=yc:un.sibling=yc,un=yc,tn=hi}if(Xn.done)return S(Qe,tn),gr&&Es(Qe,an),Qt;if(tn===null){for(;!Xn.done;an++,Xn=rt.next())Xn=Ct(Qe,Xn.value,Nt),Xn!==null&&(je=j(Xn,je,an),un===null?Qt=Xn:un.sibling=Xn,un=Xn);return gr&&Es(Qe,an),Qt}for(tn=I(Qe,tn);!Xn.done;an++,Xn=rt.next())Xn=Ht(tn,Qe,an,Xn.value,Nt),Xn!==null&&(f&&Xn.alternate!==null&&tn.delete(Xn.key===null?an:Xn.key),je=j(Xn,je,an),un===null?Qt=Xn:un.sibling=Xn,un=Xn);return f&&tn.forEach(function(Nf){return g(Qe,Nf)}),gr&&Es(Qe,an),Qt}function qr(Qe,je,rt,Nt){if(typeof rt=="object"&&rt!==null&&rt.type===pt&&rt.key===null&&(rt=rt.props.children),typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case Ne:e:{for(var Qt=rt.key,un=je;un!==null;){if(un.key===Qt){if(Qt=rt.type,Qt===pt){if(un.tag===7){S(Qe,un.sibling),je=N(un,rt.props.children),je.return=Qe,Qe=je;break e}}else if(un.elementType===Qt||typeof Qt=="object"&&Qt!==null&&Qt.$$typeof===Ee&&Ju(Qt)===un.type){S(Qe,un.sibling),je=N(un,rt.props),je.ref=xa(Qe,un,rt),je.return=Qe,Qe=je;break e}S(Qe,un);break}else g(Qe,un);un=un.sibling}rt.type===pt?(je=_c(rt.props.children,Qe.mode,Nt,rt.key),je.return=Qe,Qe=je):(Nt=Rf(rt.type,rt.key,rt.props,null,Qe.mode,Nt),Nt.ref=xa(Qe,je,rt),Nt.return=Qe,Qe=Nt)}return Q(Qe);case nt:e:{for(un=rt.key;je!==null;){if(je.key===un)if(je.tag===4&&je.stateNode.containerInfo===rt.containerInfo&&je.stateNode.implementation===rt.implementation){S(Qe,je.sibling),je=N(je,rt.children||[]),je.return=Qe,Qe=je;break e}else{S(Qe,je);break}else g(Qe,je);je=je.sibling}je=xu(rt,Qe.mode,Nt),je.return=Qe,Qe=je}return Q(Qe);case Ee:return un=rt._init,qr(Qe,je,un(rt._payload),Nt)}if(Gi(rt))return Kt(Qe,je,rt,Nt);if(ze(rt))return Jt(Qe,je,rt,Nt);il(Qe,rt)}return typeof rt=="string"&&rt!==""||typeof rt=="number"?(rt=""+rt,je!==null&&je.tag===6?(S(Qe,je.sibling),je=N(je,rt),je.return=Qe,Qe=je):(S(Qe,je),je=fm(rt,Qe.mode,Nt),je.return=Qe,Qe=je),Q(Qe)):S(Qe,je)}return qr}var sl=Qu(!0),af=Qu(!1),ps=hs(null),ol=null,jt=null,Gt=null;function al(){Gt=jt=ol=null}function eh(f){var g=ps.current;Nn(ps),f._currentValue=g}function tc(f,g,S){for(;f!==null;){var I=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,I!==null&&(I.childLanes|=g)):I!==null&&(I.childLanes&g)!==g&&(I.childLanes|=g),f===S)break;f=f.return}}function Lr(f,g){ol=f,Gt=jt=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(ti=!0),f.firstContext=null)}function ms(f){var g=f._currentValue;if(Gt!==f)if(f={context:f,memoizedValue:g,next:null},jt===null){if(ol===null)throw Error(t(308));jt=f,ol.dependencies={lanes:0,firstContext:f}}else jt=jt.next=f;return g}var ci=null;function Bo(f){ci===null?ci=[f]:ci.push(f)}function ll(f,g,S,I){var N=g.interleaved;return N===null?(S.next=S,Bo(g)):(S.next=N.next,N.next=S),g.interleaved=S,zn(f,I)}function zn(f,g){f.lanes|=g;var S=f.alternate;for(S!==null&&(S.lanes|=g),S=f,f=f.return;f!==null;)f.childLanes|=g,S=f.alternate,S!==null&&(S.childLanes|=g),S=f,f=f.return;return S.tag===3?S.stateNode:null}var Yn=!1;function nc(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function rc(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function zi(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function Qi(f,g,S){var I=f.updateQueue;if(I===null)return null;if(I=I.shared,(Bn&2)!==0){var N=I.pending;return N===null?g.next=g:(g.next=N.next,N.next=g),I.pending=g,zn(f,S)}return N=I.interleaved,N===null?(g.next=g,Bo(I)):(g.next=N.next,N.next=g),I.interleaved=g,zn(f,S)}function ic(f,g,S){if(g=g.updateQueue,g!==null&&(g=g.shared,(S&4194240)!==0)){var I=g.lanes;I&=f.pendingLanes,S|=I,g.lanes=S,ra(f,S)}}function cu(f,g){var S=f.updateQueue,I=f.alternate;if(I!==null&&(I=I.updateQueue,S===I)){var N=null,j=null;if(S=S.firstBaseUpdate,S!==null){do{var Q={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};j===null?N=j=Q:j=j.next=Q,S=S.next}while(S!==null);j===null?N=j=g:j=j.next=g}else N=j=g;S={baseState:I.baseState,firstBaseUpdate:N,lastBaseUpdate:j,shared:I.shared,effects:I.effects},f.updateQueue=S;return}f=S.lastBaseUpdate,f===null?S.firstBaseUpdate=g:f.next=g,S.lastBaseUpdate=g}function Is(f,g,S,I){var N=f.updateQueue;Yn=!1;var j=N.firstBaseUpdate,Q=N.lastBaseUpdate,Te=N.shared.pending;if(Te!==null){N.shared.pending=null;var ke=Te,ot=ke.next;ke.next=null,Q===null?j=ot:Q.next=ot,Q=ke;var At=f.alternate;At!==null&&(At=At.updateQueue,Te=At.lastBaseUpdate,Te!==Q&&(Te===null?At.firstBaseUpdate=ot:Te.next=ot,At.lastBaseUpdate=ke))}if(j!==null){var Ct=N.baseState;Q=0,At=ot=ke=null,Te=j;do{var bt=Te.lane,Ht=Te.eventTime;if((I&bt)===bt){At!==null&&(At=At.next={eventTime:Ht,lane:0,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null});e:{var Kt=f,Jt=Te;switch(bt=g,Ht=S,Jt.tag){case 1:if(Kt=Jt.payload,typeof Kt=="function"){Ct=Kt.call(Ht,Ct,bt);break e}Ct=Kt;break e;case 3:Kt.flags=Kt.flags&-65537|128;case 0:if(Kt=Jt.payload,bt=typeof Kt=="function"?Kt.call(Ht,Ct,bt):Kt,bt==null)break e;Ct=$e({},Ct,bt);break e;case 2:Yn=!0}}Te.callback!==null&&Te.lane!==0&&(f.flags|=64,bt=N.effects,bt===null?N.effects=[Te]:bt.push(Te))}else Ht={eventTime:Ht,lane:bt,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},At===null?(ot=At=Ht,ke=Ct):At=At.next=Ht,Q|=bt;if(Te=Te.next,Te===null){if(Te=N.shared.pending,Te===null)break;bt=Te,Te=bt.next,bt.next=null,N.lastBaseUpdate=bt,N.shared.pending=null}}while(!0);if(At===null&&(ke=Ct),N.baseState=ke,N.firstBaseUpdate=ot,N.lastBaseUpdate=At,g=N.shared.interleaved,g!==null){N=g;do Q|=N.lane,N=N.next;while(N!==g)}else j===null&&(N.shared.lanes=0);dc|=Q,f.lanes=Q,f.memoizedState=Ct}}function th(f,g,S){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var I=f[g],N=I.callback;if(N!==null){if(I.callback=null,I=S,typeof N!="function")throw Error(t(191,N));N.call(I)}}}var cl={},gs=hs(cl),ul=hs(cl),x=hs(cl);function i(f){if(f===cl)throw Error(t(174));return f}function h(f,g){switch(Dn(x,g),Dn(ul,f),Dn(gs,cl),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:so(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=so(g,f)}Nn(gs),Dn(gs,g)}function m(){Nn(gs),Nn(ul),Nn(x)}function y(f){i(x.current);var g=i(gs.current),S=so(g,f.type);g!==S&&(Dn(ul,f),Dn(gs,S))}function w(f){ul.current===f&&(Nn(gs),Nn(ul))}var E=hs(0);function R(f){for(var g=f;g!==null;){if(g.tag===13){var S=g.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var D=[];function B(){for(var f=0;f<D.length;f++)D[f]._workInProgressVersionPrimary=null;D.length=0}var U=Se.ReactCurrentDispatcher,W=Se.ReactCurrentBatchConfig,$=0,Z=null,J=null,ie=null,oe=!1,ae=!1,de=0,ye=0;function he(){throw Error(t(321))}function we(f,g){if(g===null)return!1;for(var S=0;S<g.length&&S<f.length;S++)if(!qs(f[S],g[S]))return!1;return!0}function Me(f,g,S,I,N,j){if($=j,Z=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,U.current=f===null||f.memoizedState===null?pr:nh,f=S(I,N),ae){j=0;do{if(ae=!1,de=0,25<=j)throw Error(t(301));j+=1,ie=J=null,g.updateQueue=null,U.current=lf,f=S(I,N)}while(ae)}if(U.current=ei,g=J!==null&&J.next!==null,$=0,ie=J=Z=null,oe=!1,g)throw Error(t(300));return f}function _e(){var f=de!==0;return de=0,f}function Re(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ie===null?Z.memoizedState=ie=f:ie=ie.next=f,ie}function Ge(){if(J===null){var f=Z.alternate;f=f!==null?f.memoizedState:null}else f=J.next;var g=ie===null?Z.memoizedState:ie.next;if(g!==null)ie=g,J=f;else{if(f===null)throw Error(t(310));J=f,f={memoizedState:J.memoizedState,baseState:J.baseState,baseQueue:J.baseQueue,queue:J.queue,next:null},ie===null?Z.memoizedState=ie=f:ie=ie.next=f}return ie}function qe(f,g){return typeof g=="function"?g(f):g}function Ye(f){var g=Ge(),S=g.queue;if(S===null)throw Error(t(311));S.lastRenderedReducer=f;var I=J,N=I.baseQueue,j=S.pending;if(j!==null){if(N!==null){var Q=N.next;N.next=j.next,j.next=Q}I.baseQueue=N=j,S.pending=null}if(N!==null){j=N.next,I=I.baseState;var Te=Q=null,ke=null,ot=j;do{var At=ot.lane;if(($&At)===At)ke!==null&&(ke=ke.next={lane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),I=ot.hasEagerState?ot.eagerState:f(I,ot.action);else{var Ct={lane:At,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null};ke===null?(Te=ke=Ct,Q=I):ke=ke.next=Ct,Z.lanes|=At,dc|=At}ot=ot.next}while(ot!==null&&ot!==j);ke===null?Q=I:ke.next=Te,qs(I,g.memoizedState)||(ti=!0),g.memoizedState=I,g.baseState=Q,g.baseQueue=ke,S.lastRenderedState=I}if(f=S.interleaved,f!==null){N=f;do j=N.lane,Z.lanes|=j,dc|=j,N=N.next;while(N!==f)}else N===null&&(S.lanes=0);return[g.memoizedState,S.dispatch]}function tt(f){var g=Ge(),S=g.queue;if(S===null)throw Error(t(311));S.lastRenderedReducer=f;var I=S.dispatch,N=S.pending,j=g.memoizedState;if(N!==null){S.pending=null;var Q=N=N.next;do j=f(j,Q.action),Q=Q.next;while(Q!==N);qs(j,g.memoizedState)||(ti=!0),g.memoizedState=j,g.baseQueue===null&&(g.baseState=j),S.lastRenderedState=j}return[j,I]}function wt(){}function xt(f,g){var S=Z,I=Ge(),N=g(),j=!qs(I.memoizedState,N);if(j&&(I.memoizedState=N,ti=!0),I=I.queue,fr(vn.bind(null,S,I,f),[f]),I.getSnapshot!==g||j||ie!==null&&ie.memoizedState.tag&1){if(S.flags|=2048,tr(9,Ut.bind(null,S,I,N,g),void 0,null),Ti===null)throw Error(t(349));($&30)!==0||ft(S,g,N)}return N}function ft(f,g,S){f.flags|=16384,f={getSnapshot:g,value:S},g=Z.updateQueue,g===null?(g={lastEffect:null,stores:null},Z.updateQueue=g,g.stores=[f]):(S=g.stores,S===null?g.stores=[f]:S.push(f))}function Ut(f,g,S,I){g.value=S,g.getSnapshot=I,Zn(g)&&lr(f)}function vn(f,g,S){return S(function(){Zn(g)&&lr(f)})}function Zn(f){var g=f.getSnapshot;f=f.value;try{var S=g();return!qs(f,S)}catch{return!0}}function lr(f){var g=zn(f,1);g!==null&&Ho(g,f,1,-1)}function ir(f){var g=Re();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qe,lastRenderedState:f},g.queue=f,f=f.dispatch=Uo.bind(null,Z,f),[g.memoizedState,f]}function tr(f,g,S,I){return f={tag:f,create:g,destroy:S,deps:I,next:null},g=Z.updateQueue,g===null?(g={lastEffect:null,stores:null},Z.updateQueue=g,g.lastEffect=f.next=f):(S=g.lastEffect,S===null?g.lastEffect=f.next=f:(I=S.next,S.next=f,f.next=I,g.lastEffect=f)),f}function cr(){return Ge().memoizedState}function Ir(f,g,S,I){var N=Re();Z.flags|=f,N.memoizedState=tr(1|g,S,void 0,I===void 0?null:I)}function nr(f,g,S,I){var N=Ge();I=I===void 0?null:I;var j=void 0;if(J!==null){var Q=J.memoizedState;if(j=Q.destroy,I!==null&&we(I,Q.deps)){N.memoizedState=tr(g,S,j,I);return}}Z.flags|=f,N.memoizedState=tr(1|g,S,j,I)}function Kn(f,g){return Ir(8390656,8,f,g)}function fr(f,g){return nr(2048,8,f,g)}function Sn(f,g){return nr(4,2,f,g)}function Qr(f,g){return nr(4,4,f,g)}function yo(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function ba(f,g,S){return S=S!=null?S.concat([f]):null,nr(4,4,yo.bind(null,g,f),S)}function vo(){}function wa(f,g){var S=Ge();g=g===void 0?null:g;var I=S.memoizedState;return I!==null&&g!==null&&we(g,I[1])?I[0]:(S.memoizedState=[f,g],f)}function sc(f,g){var S=Ge();g=g===void 0?null:g;var I=S.memoizedState;return I!==null&&g!==null&&we(g,I[1])?I[0]:(f=f(),S.memoizedState=[f,g],f)}function zo(f,g,S){return($&21)===0?(f.baseState&&(f.baseState=!1,ti=!0),f.memoizedState=S):(qs(S,g)||(S=Ba(),Z.lanes|=S,dc|=S,f.baseState=!0),g)}function hl(f,g){var S=$n;$n=S!==0&&4>S?S:4,f(!0);var I=W.transition;W.transition={};try{f(!1),g()}finally{$n=S,W.transition=I}}function es(){return Ge().memoizedState}function Ta(f,g,S){var I=pc(f);if(S={lane:I,action:S,hasEagerState:!1,eagerState:null,next:null},Vo(f))Fr(g,S);else if(S=ll(f,g,S,I),S!==null){var N=_s();Ho(S,f,I,N),Nr(S,g,I)}}function Uo(f,g,S){var I=pc(f),N={lane:I,action:S,hasEagerState:!1,eagerState:null,next:null};if(Vo(f))Fr(g,N);else{var j=f.alternate;if(f.lanes===0&&(j===null||j.lanes===0)&&(j=g.lastRenderedReducer,j!==null))try{var Q=g.lastRenderedState,Te=j(Q,S);if(N.hasEagerState=!0,N.eagerState=Te,qs(Te,Q)){var ke=g.interleaved;ke===null?(N.next=N,Bo(g)):(N.next=ke.next,ke.next=N),g.interleaved=N;return}}catch{}finally{}S=ll(f,g,N,I),S!==null&&(N=_s(),Ho(S,f,I,N),Nr(S,g,I))}}function Vo(f){var g=f.alternate;return f===Z||g!==null&&g===Z}function Fr(f,g){ae=oe=!0;var S=f.pending;S===null?g.next=g:(g.next=S.next,S.next=g),f.pending=g}function Nr(f,g,S){if((S&4194240)!==0){var I=g.lanes;I&=f.pendingLanes,S|=I,g.lanes=S,ra(f,S)}}var ei={readContext:ms,useCallback:he,useContext:he,useEffect:he,useImperativeHandle:he,useInsertionEffect:he,useLayoutEffect:he,useMemo:he,useReducer:he,useRef:he,useState:he,useDebugValue:he,useDeferredValue:he,useTransition:he,useMutableSource:he,useSyncExternalStore:he,useId:he,unstable_isNewReconciler:!1},pr={readContext:ms,useCallback:function(f,g){return Re().memoizedState=[f,g===void 0?null:g],f},useContext:ms,useEffect:Kn,useImperativeHandle:function(f,g,S){return S=S!=null?S.concat([f]):null,Ir(4194308,4,yo.bind(null,g,f),S)},useLayoutEffect:function(f,g){return Ir(4194308,4,f,g)},useInsertionEffect:function(f,g){return Ir(4,2,f,g)},useMemo:function(f,g){var S=Re();return g=g===void 0?null:g,f=f(),S.memoizedState=[f,g],f},useReducer:function(f,g,S){var I=Re();return g=S!==void 0?S(g):g,I.memoizedState=I.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},I.queue=f,f=f.dispatch=Ta.bind(null,Z,f),[I.memoizedState,f]},useRef:function(f){var g=Re();return f={current:f},g.memoizedState=f},useState:ir,useDebugValue:vo,useDeferredValue:function(f){return Re().memoizedState=f},useTransition:function(){var f=ir(!1),g=f[0];return f=hl.bind(null,f[1]),Re().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,S){var I=Z,N=Re();if(gr){if(S===void 0)throw Error(t(407));S=S()}else{if(S=g(),Ti===null)throw Error(t(349));($&30)!==0||ft(I,g,S)}N.memoizedState=S;var j={value:S,getSnapshot:g};return N.queue=j,Kn(vn.bind(null,I,j,f),[f]),I.flags|=2048,tr(9,Ut.bind(null,I,j,S,g),void 0,null),S},useId:function(){var f=Re(),g=Ti.identifierPrefix;if(gr){var S=Ni,I=Ks;S=(I&~(1<<32-ws(I)-1)).toString(32)+S,g=":"+g+"R"+S,S=de++,0<S&&(g+="H"+S.toString(32)),g+=":"}else S=ye++,g=":"+g+"r"+S.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},nh={readContext:ms,useCallback:wa,useContext:ms,useEffect:fr,useImperativeHandle:ba,useInsertionEffect:Sn,useLayoutEffect:Qr,useMemo:sc,useReducer:Ye,useRef:cr,useState:function(){return Ye(qe)},useDebugValue:vo,useDeferredValue:function(f){var g=Ge();return zo(g,J.memoizedState,f)},useTransition:function(){var f=Ye(qe)[0],g=Ge().memoizedState;return[f,g]},useMutableSource:wt,useSyncExternalStore:xt,useId:es,unstable_isNewReconciler:!1},lf={readContext:ms,useCallback:wa,useContext:ms,useEffect:fr,useImperativeHandle:ba,useInsertionEffect:Sn,useLayoutEffect:Qr,useMemo:sc,useReducer:tt,useRef:cr,useState:function(){return tt(qe)},useDebugValue:vo,useDeferredValue:function(f){var g=Ge();return J===null?g.memoizedState=f:zo(g,J.memoizedState,f)},useTransition:function(){var f=tt(qe)[0],g=Ge().memoizedState;return[f,g]},useMutableSource:wt,useSyncExternalStore:xt,useId:es,unstable_isNewReconciler:!1};function Ms(f,g){if(f&&f.defaultProps){g=$e({},g),f=f.defaultProps;for(var S in f)g[S]===void 0&&(g[S]=f[S]);return g}return g}function ld(f,g,S,I){g=f.memoizedState,S=S(I,g),S=S==null?g:$e({},g,S),f.memoizedState=S,f.lanes===0&&(f.updateQueue.baseState=S)}var oc={isMounted:function(f){return(f=f._reactInternals)?dn(f)===f:!1},enqueueSetState:function(f,g,S){f=f._reactInternals;var I=_s(),N=pc(f),j=zi(I,N);j.payload=g,S!=null&&(j.callback=S),g=Qi(f,j,N),g!==null&&(Ho(g,f,N,I),ic(g,f,N))},enqueueReplaceState:function(f,g,S){f=f._reactInternals;var I=_s(),N=pc(f),j=zi(I,N);j.tag=1,j.payload=g,S!=null&&(j.callback=S),g=Qi(f,j,N),g!==null&&(Ho(g,f,N,I),ic(g,f,N))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var S=_s(),I=pc(f),N=zi(S,I);N.tag=2,g!=null&&(N.callback=g),g=Qi(f,N,I),g!==null&&(Ho(g,f,I,S),ic(g,f,I))}};function ac(f,g,S,I,N,j,Q){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(I,j,Q):g.prototype&&g.prototype.isPureReactComponent?!Wc(S,I)||!Wc(N,j):!0}function ts(f,g,S){var I=!1,N=ds,j=g.contextType;return typeof j=="object"&&j!==null?j=ms(j):(N=xi(g)?_a:Jr.current,I=g.contextTypes,j=(I=I!=null)?Ys(f,N):ds),g=new g(S,j),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=oc,f.stateNode=g,g._reactInternals=f,I&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=N,f.__reactInternalMemoizedMaskedChildContext=j),g}function Js(f,g,S,I){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(S,I),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(S,I),g.state!==f&&oc.enqueueReplaceState(g,g.state,null)}function ns(f,g,S,I){var N=f.stateNode;N.props=S,N.state=f.memoizedState,N.refs={},nc(f);var j=g.contextType;typeof j=="object"&&j!==null?N.context=ms(j):(j=xi(g)?_a:Jr.current,N.context=Ys(f,j)),N.state=f.memoizedState,j=g.getDerivedStateFromProps,typeof j=="function"&&(ld(f,g,j,S),N.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(g=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),g!==N.state&&oc.enqueueReplaceState(N,N.state,null),Is(f,S,N,I),N.state=f.memoizedState),typeof N.componentDidMount=="function"&&(f.flags|=4194308)}function rs(f,g){try{var S="",I=g;do S+=kt(I),I=I.return;while(I);var N=S}catch(j){N=`
Error generating stack: `+j.message+`
`+j.stack}return{value:f,source:g,stack:N,digest:null}}function lc(f,g,S){return{value:f,source:null,stack:S??null,digest:g??null}}function uu(f,g){try{console.error(g.value)}catch(S){setTimeout(function(){throw S})}}var rh=typeof WeakMap=="function"?WeakMap:Map;function cc(f,g,S){S=zi(-1,S),S.tag=3,S.payload={element:null};var I=g.value;return S.callback=function(){wf||(wf=!0,Tf=I),uu(f,g)},S}function xg(f,g,S){S=zi(-1,S),S.tag=3;var I=f.type.getDerivedStateFromError;if(typeof I=="function"){var N=g.value;S.payload=function(){return I(N)},S.callback=function(){uu(f,g)}}var j=f.stateNode;return j!==null&&typeof j.componentDidCatch=="function"&&(S.callback=function(){uu(f,g),typeof I!="function"&&(ks===null?ks=new Set([this]):ks.add(this));var Q=g.stack;this.componentDidCatch(g.value,{componentStack:Q!==null?Q:""})}),S}function Zp(f,g,S){var I=f.pingCache;if(I===null){I=f.pingCache=new rh;var N=new Set;I.set(g,N)}else N=I.get(g),N===void 0&&(N=new Set,I.set(g,N));N.has(S)||(N.add(S),f=Bg.bind(null,f,g,S),g.then(f,f))}function cf(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function Xp(f,g,S,I,N){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(g=zi(-1,1),g.tag=2,Qi(S,g,1))),S.lanes|=1),f):(f.flags|=65536,f.lanes=N,f)}var hu=Se.ReactCurrentOwner,ti=!1;function is(f,g,S,I){g.child=f===null?af(g,null,S,I):sl(g,f.child,S,I)}function bg(f,g,S,I,N){S=S.render;var j=g.ref;return Lr(g,N),I=Me(f,g,S,I,j,N),S=_e(),f!==null&&!ti?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~N,Sa(f,g,N)):(gr&&S&&In(g),g.flags|=1,is(f,g,I,N),g.child)}function uf(f,g,S,I,N){if(f===null){var j=S.type;return typeof j=="function"&&!Mf(j)&&j.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(g.tag=15,g.type=j,qp(f,g,j,I,N)):(f=Rf(S.type,null,I,g,g.mode,N),f.ref=g.ref,f.return=g,g.child=f)}if(j=f.child,(f.lanes&N)===0){var Q=j.memoizedProps;if(S=S.compare,S=S!==null?S:Wc,S(Q,I)&&f.ref===g.ref)return Sa(f,g,N)}return g.flags|=1,f=gc(j,I),f.ref=g.ref,f.return=g,g.child=f}function qp(f,g,S,I,N){if(f!==null){var j=f.memoizedProps;if(Wc(j,I)&&f.ref===g.ref)if(ti=!1,g.pendingProps=I=j,(f.lanes&N)!==0)(f.flags&131072)!==0&&(ti=!0);else return g.lanes=f.lanes,Sa(f,g,N)}return Yp(f,g,S,I,N)}function cd(f,g,S){var I=g.pendingProps,N=I.children,j=f!==null?f.memoizedState:null;if(I.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dn(dl,Rs),Rs|=S;else{if((S&1073741824)===0)return f=j!==null?j.baseLanes|S:S,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,Dn(dl,Rs),Rs|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=j!==null?j.baseLanes:S,Dn(dl,Rs),Rs|=I}else j!==null?(I=j.baseLanes|S,g.memoizedState=null):I=S,Dn(dl,Rs),Rs|=I;return is(f,g,N,S),g.child}function Gp(f,g){var S=g.ref;(f===null&&S!==null||f!==null&&f.ref!==S)&&(g.flags|=512,g.flags|=2097152)}function Yp(f,g,S,I,N){var j=xi(S)?_a:Jr.current;return j=Ys(g,j),Lr(g,N),S=Me(f,g,S,I,j,N),I=_e(),f!==null&&!ti?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~N,Sa(f,g,N)):(gr&&I&&In(g),g.flags|=1,is(f,g,S,N),g.child)}function hf(f,g,S,I,N){if(xi(S)){var j=!0;Li(g)}else j=!1;if(Lr(g,N),g.stateNode===null)mf(f,g),ts(g,S,I),ns(g,S,I,N),I=!0;else if(f===null){var Q=g.stateNode,Te=g.memoizedProps;Q.props=Te;var ke=Q.context,ot=S.contextType;typeof ot=="object"&&ot!==null?ot=ms(ot):(ot=xi(S)?_a:Jr.current,ot=Ys(g,ot));var At=S.getDerivedStateFromProps,Ct=typeof At=="function"||typeof Q.getSnapshotBeforeUpdate=="function";Ct||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(Te!==I||ke!==ot)&&Js(g,Q,I,ot),Yn=!1;var bt=g.memoizedState;Q.state=bt,Is(g,I,Q,N),ke=g.memoizedState,Te!==I||bt!==ke||Oi.current||Yn?(typeof At=="function"&&(ld(g,S,At,I),ke=g.memoizedState),(Te=Yn||ac(g,S,Te,I,bt,ke,ot))?(Ct||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(g.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=I,g.memoizedState=ke),Q.props=I,Q.state=ke,Q.context=ot,I=Te):(typeof Q.componentDidMount=="function"&&(g.flags|=4194308),I=!1)}else{Q=g.stateNode,rc(f,g),Te=g.memoizedProps,ot=g.type===g.elementType?Te:Ms(g.type,Te),Q.props=ot,Ct=g.pendingProps,bt=Q.context,ke=S.contextType,typeof ke=="object"&&ke!==null?ke=ms(ke):(ke=xi(S)?_a:Jr.current,ke=Ys(g,ke));var Ht=S.getDerivedStateFromProps;(At=typeof Ht=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(Te!==Ct||bt!==ke)&&Js(g,Q,I,ke),Yn=!1,bt=g.memoizedState,Q.state=bt,Is(g,I,Q,N);var Kt=g.memoizedState;Te!==Ct||bt!==Kt||Oi.current||Yn?(typeof Ht=="function"&&(ld(g,S,Ht,I),Kt=g.memoizedState),(ot=Yn||ac(g,S,ot,I,bt,Kt,ke)||!1)?(At||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(I,Kt,ke),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(I,Kt,ke)),typeof Q.componentDidUpdate=="function"&&(g.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof Q.componentDidUpdate!="function"||Te===f.memoizedProps&&bt===f.memoizedState||(g.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||Te===f.memoizedProps&&bt===f.memoizedState||(g.flags|=1024),g.memoizedProps=I,g.memoizedState=Kt),Q.props=I,Q.state=Kt,Q.context=ke,I=ot):(typeof Q.componentDidUpdate!="function"||Te===f.memoizedProps&&bt===f.memoizedState||(g.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||Te===f.memoizedProps&&bt===f.memoizedState||(g.flags|=1024),I=!1)}return Kp(f,g,S,I,j,N)}function Kp(f,g,S,I,N,j){Gp(f,g);var Q=(g.flags&128)!==0;if(!I&&!Q)return N&&bi(g,S,!1),Sa(f,g,j);I=g.stateNode,hu.current=g;var Te=Q&&typeof S.getDerivedStateFromError!="function"?null:I.render();return g.flags|=1,f!==null&&Q?(g.child=sl(g,f.child,null,j),g.child=sl(g,null,Te,j)):is(f,g,Te,j),g.memoizedState=I.state,N&&bi(g,S,!0),g.child}function df(f){var g=f.stateNode;g.pendingContext?ru(f,g.pendingContext,g.pendingContext!==g.context):g.context&&ru(f,g.context,!1),h(f,g.containerInfo)}function Jp(f,g,S,I,N){return fs(),Hn(N),g.flags|=256,is(f,g,S,I),g.child}var ff={dehydrated:null,treeContext:null,retryLane:0};function uc(f){return{baseLanes:f,cachePool:null,transitions:null}}function wg(f,g,S){var I=g.pendingProps,N=E.current,j=!1,Q=(g.flags&128)!==0,Te;if((Te=Q)||(Te=f!==null&&f.memoizedState===null?!1:(N&2)!==0),Te?(j=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(N|=1),Dn(E,N&1),f===null)return Yu(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(Q=I.children,f=I.fallback,j?(I=g.mode,j=g.child,Q={mode:"hidden",children:Q},(I&1)===0&&j!==null?(j.childLanes=0,j.pendingProps=Q):j=kf(Q,I,0,null),f=_c(f,I,S,null),j.return=g,f.return=g,j.sibling=f,g.child=j,g.child.memoizedState=uc(S),g.memoizedState=ff,f):hc(g,Q));if(N=f.memoizedState,N!==null&&(Te=N.dehydrated,Te!==null))return pf(f,g,Q,I,Te,N,S);if(j){j=I.fallback,Q=g.mode,N=f.child,Te=N.sibling;var ke={mode:"hidden",children:I.children};return(Q&1)===0&&g.child!==N?(I=g.child,I.childLanes=0,I.pendingProps=ke,g.deletions=null):(I=gc(N,ke),I.subtreeFlags=N.subtreeFlags&14680064),Te!==null?j=gc(Te,j):(j=_c(j,Q,S,null),j.flags|=2),j.return=g,I.return=g,I.sibling=j,g.child=I,I=j,j=g.child,Q=f.child.memoizedState,Q=Q===null?uc(S):{baseLanes:Q.baseLanes|S,cachePool:null,transitions:Q.transitions},j.memoizedState=Q,j.childLanes=f.childLanes&~S,g.memoizedState=ff,I}return j=f.child,f=j.sibling,I=gc(j,{mode:"visible",children:I.children}),(g.mode&1)===0&&(I.lanes=S),I.return=g,I.sibling=null,f!==null&&(S=g.deletions,S===null?(g.deletions=[f],g.flags|=16):S.push(f)),g.child=I,g.memoizedState=null,I}function hc(f,g){return g=kf({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function du(f,g,S,I){return I!==null&&Hn(I),sl(g,f.child,null,S),f=hc(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function pf(f,g,S,I,N,j,Q){if(S)return g.flags&256?(g.flags&=-257,I=lc(Error(t(422))),du(f,g,Q,I)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(j=I.fallback,N=g.mode,I=kf({mode:"visible",children:I.children},N,0,null),j=_c(j,N,Q,null),j.flags|=2,I.return=g,j.return=g,I.sibling=j,g.child=I,(g.mode&1)!==0&&sl(g,f.child,null,Q),g.child.memoizedState=uc(Q),g.memoizedState=ff,j);if((g.mode&1)===0)return du(f,g,Q,null);if(N.data==="$!"){if(I=N.nextSibling&&N.nextSibling.dataset,I)var Te=I.dgst;return I=Te,j=Error(t(419)),I=lc(j,I,void 0),du(f,g,Q,I)}if(Te=(Q&f.childLanes)!==0,ti||Te){if(I=Ti,I!==null){switch(Q&-Q){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}N=(N&(I.suspendedLanes|Q))!==0?0:N,N!==0&&N!==j.retryLane&&(j.retryLane=N,zn(f,N),Ho(I,f,N,-1))}return Ef(),I=lc(Error(t(421))),du(f,g,Q,I)}return N.data==="$?"?(g.flags|=128,g.child=f.child,g=zg.bind(null,f),N._reactRetry=g,null):(f=j.treeContext,Bi=po(N.nextSibling),Ji=g,gr=!0,Cs=null,f!==null&&(It[Ki++]=Ks,It[Ki++]=Ni,It[Ki++]=_o,Ks=f.id,Ni=f.overflow,_o=g),g=hc(g,I.children),g.flags|=4096,g)}function Tg(f,g,S){f.lanes|=g;var I=f.alternate;I!==null&&(I.lanes|=g),tc(f.return,g,S)}function Qp(f,g,S,I,N){var j=f.memoizedState;j===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:I,tail:S,tailMode:N}:(j.isBackwards=g,j.rendering=null,j.renderingStartTime=0,j.last=I,j.tail=S,j.tailMode=N)}function Sg(f,g,S){var I=g.pendingProps,N=I.revealOrder,j=I.tail;if(is(f,g,I.children,S),I=E.current,(I&2)!==0)I=I&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&Tg(f,S,g);else if(f.tag===19)Tg(f,S,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}I&=1}if(Dn(E,I),(g.mode&1)===0)g.memoizedState=null;else switch(N){case"forwards":for(S=g.child,N=null;S!==null;)f=S.alternate,f!==null&&R(f)===null&&(N=S),S=S.sibling;S=N,S===null?(N=g.child,g.child=null):(N=S.sibling,S.sibling=null),Qp(g,!1,N,S,j);break;case"backwards":for(S=null,N=g.child,g.child=null;N!==null;){if(f=N.alternate,f!==null&&R(f)===null){g.child=N;break}f=N.sibling,N.sibling=S,S=N,N=f}Qp(g,!0,S,null,j);break;case"together":Qp(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function mf(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function Sa(f,g,S){if(f!==null&&(g.dependencies=f.dependencies),dc|=g.lanes,(S&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(t(153));if(g.child!==null){for(f=g.child,S=gc(f,f.pendingProps),g.child=S,S.return=g;f.sibling!==null;)f=f.sibling,S=S.sibling=gc(f,f.pendingProps),S.return=g;S.sibling=null}return g.child}function em(f,g,S){switch(g.tag){case 3:df(g),fs();break;case 5:y(g);break;case 1:xi(g.type)&&Li(g);break;case 4:h(g,g.stateNode.containerInfo);break;case 10:var I=g.type._context,N=g.memoizedProps.value;Dn(ps,I._currentValue),I._currentValue=N;break;case 13:if(I=g.memoizedState,I!==null)return I.dehydrated!==null?(Dn(E,E.current&1),g.flags|=128,null):(S&g.child.childLanes)!==0?wg(f,g,S):(Dn(E,E.current&1),f=Sa(f,g,S),f!==null?f.sibling:null);Dn(E,E.current&1);break;case 19:if(I=(S&g.childLanes)!==0,(f.flags&128)!==0){if(I)return Sg(f,g,S);g.flags|=128}if(N=g.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),Dn(E,E.current),I)break;return null;case 22:case 23:return g.lanes=0,cd(f,g,S)}return Sa(f,g,S)}var tm,gf,Ag,Pg;tm=function(f,g){for(var S=g.child;S!==null;){if(S.tag===5||S.tag===6)f.appendChild(S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===g)break;for(;S.sibling===null;){if(S.return===null||S.return===g)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},gf=function(){},Ag=function(f,g,S,I){var N=f.memoizedProps;if(N!==I){f=g.stateNode,i(gs.current);var j=null;switch(S){case"input":N=Jn(f,N),I=Jn(f,I),j=[];break;case"select":N=$e({},N,{value:void 0}),I=$e({},I,{value:void 0}),j=[];break;case"textarea":N=bs(f,N),I=bs(f,I),j=[];break;default:typeof N.onClick!="function"&&typeof I.onClick=="function"&&(f.onclick=fo)}Ke(S,I);var Q;S=null;for(ot in N)if(!I.hasOwnProperty(ot)&&N.hasOwnProperty(ot)&&N[ot]!=null)if(ot==="style"){var Te=N[ot];for(Q in Te)Te.hasOwnProperty(Q)&&(S||(S={}),S[Q]="")}else ot!=="dangerouslySetInnerHTML"&&ot!=="children"&&ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&ot!=="autoFocus"&&(o.hasOwnProperty(ot)?j||(j=[]):(j=j||[]).push(ot,null));for(ot in I){var ke=I[ot];if(Te=N?.[ot],I.hasOwnProperty(ot)&&ke!==Te&&(ke!=null||Te!=null))if(ot==="style")if(Te){for(Q in Te)!Te.hasOwnProperty(Q)||ke&&ke.hasOwnProperty(Q)||(S||(S={}),S[Q]="");for(Q in ke)ke.hasOwnProperty(Q)&&Te[Q]!==ke[Q]&&(S||(S={}),S[Q]=ke[Q])}else S||(j||(j=[]),j.push(ot,S)),S=ke;else ot==="dangerouslySetInnerHTML"?(ke=ke?ke.__html:void 0,Te=Te?Te.__html:void 0,ke!=null&&Te!==ke&&(j=j||[]).push(ot,ke)):ot==="children"?typeof ke!="string"&&typeof ke!="number"||(j=j||[]).push(ot,""+ke):ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&(o.hasOwnProperty(ot)?(ke!=null&&ot==="onScroll"&&hr("scroll",f),j||Te===ke||(j=[])):(j=j||[]).push(ot,ke))}S&&(j=j||[]).push("style",S);var ot=j;(g.updateQueue=ot)&&(g.flags|=4)}},Pg=function(f,g,S,I){S!==I&&(g.flags|=4)};function ih(f,g){if(!gr)switch(f.tailMode){case"hidden":g=f.tail;for(var S=null;g!==null;)g.alternate!==null&&(S=g),g=g.sibling;S===null?f.tail=null:S.sibling=null;break;case"collapsed":S=f.tail;for(var I=null;S!==null;)S.alternate!==null&&(I=S),S=S.sibling;I===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:I.sibling=null}}function Ui(f){var g=f.alternate!==null&&f.alternate.child===f.child,S=0,I=0;if(g)for(var N=f.child;N!==null;)S|=N.lanes|N.childLanes,I|=N.subtreeFlags&14680064,I|=N.flags&14680064,N.return=f,N=N.sibling;else for(N=f.child;N!==null;)S|=N.lanes|N.childLanes,I|=N.subtreeFlags,I|=N.flags,N.return=f,N=N.sibling;return f.subtreeFlags|=I,f.childLanes=S,g}function By(f,g,S){var I=g.pendingProps;switch(su(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ui(g),null;case 1:return xi(g.type)&&nl(),Ui(g),null;case 3:return I=g.stateNode,m(),Nn(Oi),Nn(Jr),B(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(f===null||f.child===null)&&(au(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Cs!==null&&(lm(Cs),Cs=null))),gf(f,g),Ui(g),null;case 5:w(g);var N=i(x.current);if(S=g.type,f!==null&&g.stateNode!=null)Ag(f,g,S,I,N),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!I){if(g.stateNode===null)throw Error(t(166));return Ui(g),null}if(f=i(gs.current),au(g)){I=g.stateNode,S=g.type;var j=g.memoizedProps;switch(I[Cr]=g,I[ga]=j,f=(g.mode&1)!==0,S){case"dialog":hr("cancel",I),hr("close",I);break;case"iframe":case"object":case"embed":hr("load",I);break;case"video":case"audio":for(N=0;N<Xl.length;N++)hr(Xl[N],I);break;case"source":hr("error",I);break;case"img":case"image":case"link":hr("error",I),hr("load",I);break;case"details":hr("toggle",I);break;case"input":pn(I,j),hr("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!j.multiple},hr("invalid",I);break;case"textarea":To(I,j),hr("invalid",I)}Ke(S,j),N=null;for(var Q in j)if(j.hasOwnProperty(Q)){var Te=j[Q];Q==="children"?typeof Te=="string"?I.textContent!==Te&&(j.suppressHydrationWarning!==!0&&Jl(I.textContent,Te,f),N=["children",Te]):typeof Te=="number"&&I.textContent!==""+Te&&(j.suppressHydrationWarning!==!0&&Jl(I.textContent,Te,f),N=["children",""+Te]):o.hasOwnProperty(Q)&&Te!=null&&Q==="onScroll"&&hr("scroll",I)}switch(S){case"input":jn(I),ki(I,j,!0);break;case"textarea":jn(I),So(I);break;case"select":case"option":break;default:typeof j.onClick=="function"&&(I.onclick=fo)}I=N,g.updateQueue=I,I!==null&&(g.flags|=4)}else{Q=N.nodeType===9?N:N.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=Ao(S)),f==="http://www.w3.org/1999/xhtml"?S==="script"?(f=Q.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof I.is=="string"?f=Q.createElement(S,{is:I.is}):(f=Q.createElement(S),S==="select"&&(Q=f,I.multiple?Q.multiple=!0:I.size&&(Q.size=I.size))):f=Q.createElementNS(f,S),f[Cr]=g,f[ga]=I,tm(f,g,!1,!1),g.stateNode=f;e:{switch(Q=Ue(S,I),S){case"dialog":hr("cancel",f),hr("close",f),N=I;break;case"iframe":case"object":case"embed":hr("load",f),N=I;break;case"video":case"audio":for(N=0;N<Xl.length;N++)hr(Xl[N],f);N=I;break;case"source":hr("error",f),N=I;break;case"img":case"image":case"link":hr("error",f),hr("load",f),N=I;break;case"details":hr("toggle",f),N=I;break;case"input":pn(f,I),N=Jn(f,I),hr("invalid",f);break;case"option":N=I;break;case"select":f._wrapperState={wasMultiple:!!I.multiple},N=$e({},I,{value:void 0}),hr("invalid",f);break;case"textarea":To(f,I),N=bs(f,I),hr("invalid",f);break;default:N=I}Ke(S,N),Te=N;for(j in Te)if(Te.hasOwnProperty(j)){var ke=Te[j];j==="style"?Ce(f,ke):j==="dangerouslySetInnerHTML"?(ke=ke?ke.__html:void 0,ke!=null&&Le(f,ke)):j==="children"?typeof ke=="string"?(S!=="textarea"||ke!=="")&&Y(f,ke):typeof ke=="number"&&Y(f,""+ke):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(o.hasOwnProperty(j)?ke!=null&&j==="onScroll"&&hr("scroll",f):ke!=null&&le(f,j,ke,Q))}switch(S){case"input":jn(f),ki(f,I,!1);break;case"textarea":jn(f),So(f);break;case"option":I.value!=null&&f.setAttribute("value",""+ut(I.value));break;case"select":f.multiple=!!I.multiple,j=I.value,j!=null?mi(f,!!I.multiple,j,!1):I.defaultValue!=null&&mi(f,!!I.multiple,I.defaultValue,!0);break;default:typeof N.onClick=="function"&&(f.onclick=fo)}switch(S){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return Ui(g),null;case 6:if(f&&g.stateNode!=null)Pg(f,g,f.memoizedProps,I);else{if(typeof I!="string"&&g.stateNode===null)throw Error(t(166));if(S=i(x.current),i(gs.current),au(g)){if(I=g.stateNode,S=g.memoizedProps,I[Cr]=g,(j=I.nodeValue!==S)&&(f=Ji,f!==null))switch(f.tag){case 3:Jl(I.nodeValue,S,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&Jl(I.nodeValue,S,(f.mode&1)!==0)}j&&(g.flags|=4)}else I=(S.nodeType===9?S:S.ownerDocument).createTextNode(I),I[Cr]=g,g.stateNode=I}return Ui(g),null;case 13:if(Nn(E),I=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(gr&&Bi!==null&&(g.mode&1)!==0&&(g.flags&128)===0)lu(),fs(),g.flags|=98560,j=!1;else if(j=au(g),I!==null&&I.dehydrated!==null){if(f===null){if(!j)throw Error(t(318));if(j=g.memoizedState,j=j!==null?j.dehydrated:null,!j)throw Error(t(317));j[Cr]=g}else fs(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;Ui(g),j=!1}else Cs!==null&&(lm(Cs),Cs=null),j=!0;if(!j)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=S,g):(I=I!==null,I!==(f!==null&&f.memoizedState!==null)&&I&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(E.current&1)!==0?Vr===0&&(Vr=3):Ef())),g.updateQueue!==null&&(g.flags|=4),Ui(g),null);case 4:return m(),gf(f,g),f===null&&ma(g.stateNode.containerInfo),Ui(g),null;case 10:return eh(g.type._context),Ui(g),null;case 17:return xi(g.type)&&nl(),Ui(g),null;case 19:if(Nn(E),j=g.memoizedState,j===null)return Ui(g),null;if(I=(g.flags&128)!==0,Q=j.rendering,Q===null)if(I)ih(j,!1);else{if(Vr!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(Q=R(f),Q!==null){for(g.flags|=128,ih(j,!1),I=Q.updateQueue,I!==null&&(g.updateQueue=I,g.flags|=4),g.subtreeFlags=0,I=S,S=g.child;S!==null;)j=S,f=I,j.flags&=14680066,Q=j.alternate,Q===null?(j.childLanes=0,j.lanes=f,j.child=null,j.subtreeFlags=0,j.memoizedProps=null,j.memoizedState=null,j.updateQueue=null,j.dependencies=null,j.stateNode=null):(j.childLanes=Q.childLanes,j.lanes=Q.lanes,j.child=Q.child,j.subtreeFlags=0,j.deletions=null,j.memoizedProps=Q.memoizedProps,j.memoizedState=Q.memoizedState,j.updateQueue=Q.updateQueue,j.type=Q.type,f=Q.dependencies,j.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),S=S.sibling;return Dn(E,E.current&1|2),g.child}f=f.sibling}j.tail!==null&&An()>Wo&&(g.flags|=128,I=!0,ih(j,!1),g.lanes=4194304)}else{if(!I)if(f=R(Q),f!==null){if(g.flags|=128,I=!0,S=f.updateQueue,S!==null&&(g.updateQueue=S,g.flags|=4),ih(j,!0),j.tail===null&&j.tailMode==="hidden"&&!Q.alternate&&!gr)return Ui(g),null}else 2*An()-j.renderingStartTime>Wo&&S!==1073741824&&(g.flags|=128,I=!0,ih(j,!1),g.lanes=4194304);j.isBackwards?(Q.sibling=g.child,g.child=Q):(S=j.last,S!==null?S.sibling=Q:g.child=Q,j.last=Q)}return j.tail!==null?(g=j.tail,j.rendering=g,j.tail=g.sibling,j.renderingStartTime=An(),g.sibling=null,S=E.current,Dn(E,I?S&1|2:S&1),g):(Ui(g),null);case 22:case 23:return yu(),I=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==I&&(g.flags|=8192),I&&(g.mode&1)!==0?(Rs&1073741824)!==0&&(Ui(g),g.subtreeFlags&6&&(g.flags|=8192)):Ui(g),null;case 24:return null;case 25:return null}throw Error(t(156,g.tag))}function nm(f,g){switch(su(g),g.tag){case 1:return xi(g.type)&&nl(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return m(),Nn(Oi),Nn(Jr),B(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return w(g),null;case 13:if(Nn(E),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(t(340));fs()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return Nn(E),null;case 4:return m(),null;case 10:return eh(g.type._context),null;case 22:case 23:return yu(),null;case 24:return null;default:return null}}var ud=!1,wi=!1,hd=typeof WeakSet=="function"?WeakSet:Set,zt=null;function fu(f,g){var S=f.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(I){jr(f,g,I)}else S.current=null}function dd(f,g,S){try{S()}catch(I){jr(f,g,I)}}var Eg=!1;function Cg(f,g){if(Qc=vi,f=td(),Hl(f)){if("selectionStart"in f)var S={start:f.selectionStart,end:f.selectionEnd};else e:{S=(S=f.ownerDocument)&&S.defaultView||window;var I=S.getSelection&&S.getSelection();if(I&&I.rangeCount!==0){S=I.anchorNode;var N=I.anchorOffset,j=I.focusNode;I=I.focusOffset;try{S.nodeType,j.nodeType}catch{S=null;break e}var Q=0,Te=-1,ke=-1,ot=0,At=0,Ct=f,bt=null;t:for(;;){for(var Ht;Ct!==S||N!==0&&Ct.nodeType!==3||(Te=Q+N),Ct!==j||I!==0&&Ct.nodeType!==3||(ke=Q+I),Ct.nodeType===3&&(Q+=Ct.nodeValue.length),(Ht=Ct.firstChild)!==null;)bt=Ct,Ct=Ht;for(;;){if(Ct===f)break t;if(bt===S&&++ot===N&&(Te=Q),bt===j&&++At===I&&(ke=Q),(Ht=Ct.nextSibling)!==null)break;Ct=bt,bt=Ct.parentNode}Ct=Ht}S=Te===-1||ke===-1?null:{start:Te,end:ke}}else S=null}S=S||{start:0,end:0}}else S=null;for(Ya={focusedElem:f,selectionRange:S},vi=!1,zt=g;zt!==null;)if(g=zt,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,zt=f;else for(;zt!==null;){g=zt;try{var Kt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Kt!==null){var Jt=Kt.memoizedProps,qr=Kt.memoizedState,Qe=g.stateNode,je=Qe.getSnapshotBeforeUpdate(g.elementType===g.type?Jt:Ms(g.type,Jt),qr);Qe.__reactInternalSnapshotBeforeUpdate=je}break;case 3:var rt=g.stateNode.containerInfo;rt.nodeType===1?rt.textContent="":rt.nodeType===9&&rt.documentElement&&rt.removeChild(rt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Nt){jr(g,g.return,Nt)}if(f=g.sibling,f!==null){f.return=g.return,zt=f;break}zt=g.return}return Kt=Eg,Eg=!1,Kt}function fd(f,g,S){var I=g.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var N=I=I.next;do{if((N.tag&f)===f){var j=N.destroy;N.destroy=void 0,j!==void 0&&dd(g,S,j)}N=N.next}while(N!==I)}}function _f(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var S=g=g.next;do{if((S.tag&f)===f){var I=S.create;S.destroy=I()}S=S.next}while(S!==g)}}function yf(f){var g=f.ref;if(g!==null){var S=f.stateNode;switch(f.tag){case 5:f=S;break;default:f=S}typeof g=="function"?g(f):g.current=f}}function Ig(f){var g=f.alternate;g!==null&&(f.alternate=null,Ig(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[Cr],delete g[ga],delete g[tu],delete g[Ka],delete g[Ja])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function vf(f){return f.tag===5||f.tag===3||f.tag===4}function rm(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||vf(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function xf(f,g,S){var I=f.tag;if(I===5||I===6)f=f.stateNode,g?S.nodeType===8?S.parentNode.insertBefore(f,g):S.insertBefore(f,g):(S.nodeType===8?(g=S.parentNode,g.insertBefore(f,S)):(g=S,g.appendChild(f)),S=S._reactRootContainer,S!=null||g.onclick!==null||(g.onclick=fo));else if(I!==4&&(f=f.child,f!==null))for(xf(f,g,S),f=f.sibling;f!==null;)xf(f,g,S),f=f.sibling}function im(f,g,S){var I=f.tag;if(I===5||I===6)f=f.stateNode,g?S.insertBefore(f,g):S.appendChild(f);else if(I!==4&&(f=f.child,f!==null))for(im(f,g,S),f=f.sibling;f!==null;)im(f,g,S),f=f.sibling}var Vi=null,jo=!1;function $o(f,g,S){for(S=S.child;S!==null;)bf(f,g,S),S=S.sibling}function bf(f,g,S){if(ai&&typeof ai.onCommitFiberUnmount=="function")try{ai.onCommitFiberUnmount(Vs,S)}catch{}switch(S.tag){case 5:wi||fu(S,g);case 6:var I=Vi,N=jo;Vi=null,$o(f,g,S),Vi=I,jo=N,Vi!==null&&(jo?(f=Vi,S=S.stateNode,f.nodeType===8?f.parentNode.removeChild(S):f.removeChild(S)):Vi.removeChild(S.stateNode));break;case 18:Vi!==null&&(jo?(f=Vi,S=S.stateNode,f.nodeType===8?Zu(f.parentNode,S):f.nodeType===1&&Zu(f,S),cs(f)):Zu(Vi,S.stateNode));break;case 4:I=Vi,N=jo,Vi=S.stateNode.containerInfo,jo=!0,$o(f,g,S),Vi=I,jo=N;break;case 0:case 11:case 14:case 15:if(!wi&&(I=S.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){N=I=I.next;do{var j=N,Q=j.destroy;j=j.tag,Q!==void 0&&((j&2)!==0||(j&4)!==0)&&dd(S,g,Q),N=N.next}while(N!==I)}$o(f,g,S);break;case 1:if(!wi&&(fu(S,g),I=S.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=S.memoizedProps,I.state=S.memoizedState,I.componentWillUnmount()}catch(Te){jr(S,g,Te)}$o(f,g,S);break;case 21:$o(f,g,S);break;case 22:S.mode&1?(wi=(I=wi)||S.memoizedState!==null,$o(f,g,S),wi=I):$o(f,g,S);break;default:$o(f,g,S)}}function sm(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var S=f.stateNode;S===null&&(S=f.stateNode=new hd),g.forEach(function(I){var N=Ug.bind(null,f,I);S.has(I)||(S.add(I),I.then(N,N))})}}function ji(f,g){var S=g.deletions;if(S!==null)for(var I=0;I<S.length;I++){var N=S[I];try{var j=f,Q=g,Te=Q;e:for(;Te!==null;){switch(Te.tag){case 5:Vi=Te.stateNode,jo=!1;break e;case 3:Vi=Te.stateNode.containerInfo,jo=!0;break e;case 4:Vi=Te.stateNode.containerInfo,jo=!0;break e}Te=Te.return}if(Vi===null)throw Error(t(160));bf(j,Q,N),Vi=null,jo=!1;var ke=N.alternate;ke!==null&&(ke.return=null),N.return=null}catch(ot){jr(N,g,ot)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)sh(g,f),g=g.sibling}function sh(f,g){var S=f.alternate,I=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(ji(g,f),Aa(f),I&4){try{fd(3,f,f.return),_f(3,f)}catch(Jt){jr(f,f.return,Jt)}try{fd(5,f,f.return)}catch(Jt){jr(f,f.return,Jt)}}break;case 1:ji(g,f),Aa(f),I&512&&S!==null&&fu(S,S.return);break;case 5:if(ji(g,f),Aa(f),I&512&&S!==null&&fu(S,S.return),f.flags&32){var N=f.stateNode;try{Y(N,"")}catch(Jt){jr(f,f.return,Jt)}}if(I&4&&(N=f.stateNode,N!=null)){var j=f.memoizedProps,Q=S!==null?S.memoizedProps:j,Te=f.type,ke=f.updateQueue;if(f.updateQueue=null,ke!==null)try{Te==="input"&&j.type==="radio"&&j.name!=null&&mn(N,j),Ue(Te,Q);var ot=Ue(Te,j);for(Q=0;Q<ke.length;Q+=2){var At=ke[Q],Ct=ke[Q+1];At==="style"?Ce(N,Ct):At==="dangerouslySetInnerHTML"?Le(N,Ct):At==="children"?Y(N,Ct):le(N,At,Ct,ot)}switch(Te){case"input":Us(N,j);break;case"textarea":ea(N,j);break;case"select":var bt=N._wrapperState.wasMultiple;N._wrapperState.wasMultiple=!!j.multiple;var Ht=j.value;Ht!=null?mi(N,!!j.multiple,Ht,!1):bt!==!!j.multiple&&(j.defaultValue!=null?mi(N,!!j.multiple,j.defaultValue,!0):mi(N,!!j.multiple,j.multiple?[]:"",!1))}N[ga]=j}catch(Jt){jr(f,f.return,Jt)}}break;case 6:if(ji(g,f),Aa(f),I&4){if(f.stateNode===null)throw Error(t(162));N=f.stateNode,j=f.memoizedProps;try{N.nodeValue=j}catch(Jt){jr(f,f.return,Jt)}}break;case 3:if(ji(g,f),Aa(f),I&4&&S!==null&&S.memoizedState.isDehydrated)try{cs(g.containerInfo)}catch(Jt){jr(f,f.return,Jt)}break;case 4:ji(g,f),Aa(f);break;case 13:ji(g,f),Aa(f),N=f.child,N.flags&8192&&(j=N.memoizedState!==null,N.stateNode.isHidden=j,!j||N.alternate!==null&&N.alternate.memoizedState!==null||(ah=An())),I&4&&sm(f);break;case 22:if(At=S!==null&&S.memoizedState!==null,f.mode&1?(wi=(ot=wi)||At,ji(g,f),wi=ot):ji(g,f),Aa(f),I&8192){if(ot=f.memoizedState!==null,(f.stateNode.isHidden=ot)&&!At&&(f.mode&1)!==0)for(zt=f,At=f.child;At!==null;){for(Ct=zt=At;zt!==null;){switch(bt=zt,Ht=bt.child,bt.tag){case 0:case 11:case 14:case 15:fd(4,bt,bt.return);break;case 1:fu(bt,bt.return);var Kt=bt.stateNode;if(typeof Kt.componentWillUnmount=="function"){I=bt,S=bt.return;try{g=I,Kt.props=g.memoizedProps,Kt.state=g.memoizedState,Kt.componentWillUnmount()}catch(Jt){jr(I,S,Jt)}}break;case 5:fu(bt,bt.return);break;case 22:if(bt.memoizedState!==null){kg(Ct);continue}}Ht!==null?(Ht.return=bt,zt=Ht):kg(Ct)}At=At.sibling}e:for(At=null,Ct=f;;){if(Ct.tag===5){if(At===null){At=Ct;try{N=Ct.stateNode,ot?(j=N.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none"):(Te=Ct.stateNode,ke=Ct.memoizedProps.style,Q=ke!=null&&ke.hasOwnProperty("display")?ke.display:null,Te.style.display=xe("display",Q))}catch(Jt){jr(f,f.return,Jt)}}}else if(Ct.tag===6){if(At===null)try{Ct.stateNode.nodeValue=ot?"":Ct.memoizedProps}catch(Jt){jr(f,f.return,Jt)}}else if((Ct.tag!==22&&Ct.tag!==23||Ct.memoizedState===null||Ct===f)&&Ct.child!==null){Ct.child.return=Ct,Ct=Ct.child;continue}if(Ct===f)break e;for(;Ct.sibling===null;){if(Ct.return===null||Ct.return===f)break e;At===Ct&&(At=null),Ct=Ct.return}At===Ct&&(At=null),Ct.sibling.return=Ct.return,Ct=Ct.sibling}}break;case 19:ji(g,f),Aa(f),I&4&&sm(f);break;case 21:break;default:ji(g,f),Aa(f)}}function Aa(f){var g=f.flags;if(g&2){try{e:{for(var S=f.return;S!==null;){if(vf(S)){var I=S;break e}S=S.return}throw Error(t(160))}switch(I.tag){case 5:var N=I.stateNode;I.flags&32&&(Y(N,""),I.flags&=-33);var j=rm(f);im(f,j,N);break;case 3:case 4:var Q=I.stateNode.containerInfo,Te=rm(f);xf(f,Te,Q);break;default:throw Error(t(161))}}catch(ke){jr(f,f.return,ke)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function zy(f,g,S){zt=f,Mg(f)}function Mg(f,g,S){for(var I=(f.mode&1)!==0;zt!==null;){var N=zt,j=N.child;if(N.tag===22&&I){var Q=N.memoizedState!==null||ud;if(!Q){var Te=N.alternate,ke=Te!==null&&Te.memoizedState!==null||wi;Te=ud;var ot=wi;if(ud=Q,(wi=ke)&&!ot)for(zt=N;zt!==null;)Q=zt,ke=Q.child,Q.tag===22&&Q.memoizedState!==null?Dg(N):ke!==null?(ke.return=Q,zt=ke):Dg(N);for(;j!==null;)zt=j,Mg(j),j=j.sibling;zt=N,ud=Te,wi=ot}Rg(f)}else(N.subtreeFlags&8772)!==0&&j!==null?(j.return=N,zt=j):Rg(f)}}function Rg(f){for(;zt!==null;){var g=zt;if((g.flags&8772)!==0){var S=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:wi||_f(5,g);break;case 1:var I=g.stateNode;if(g.flags&4&&!wi)if(S===null)I.componentDidMount();else{var N=g.elementType===g.type?S.memoizedProps:Ms(g.type,S.memoizedProps);I.componentDidUpdate(N,S.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var j=g.updateQueue;j!==null&&th(g,j,I);break;case 3:var Q=g.updateQueue;if(Q!==null){if(S=null,g.child!==null)switch(g.child.tag){case 5:S=g.child.stateNode;break;case 1:S=g.child.stateNode}th(g,Q,S)}break;case 5:var Te=g.stateNode;if(S===null&&g.flags&4){S=Te;var ke=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":ke.autoFocus&&S.focus();break;case"img":ke.src&&(S.src=ke.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var ot=g.alternate;if(ot!==null){var At=ot.memoizedState;if(At!==null){var Ct=At.dehydrated;Ct!==null&&cs(Ct)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}wi||g.flags&512&&yf(g)}catch(bt){jr(g,g.return,bt)}}if(g===f){zt=null;break}if(S=g.sibling,S!==null){S.return=g.return,zt=S;break}zt=g.return}}function kg(f){for(;zt!==null;){var g=zt;if(g===f){zt=null;break}var S=g.sibling;if(S!==null){S.return=g.return,zt=S;break}zt=g.return}}function Dg(f){for(;zt!==null;){var g=zt;try{switch(g.tag){case 0:case 11:case 15:var S=g.return;try{_f(4,g)}catch(ke){jr(g,S,ke)}break;case 1:var I=g.stateNode;if(typeof I.componentDidMount=="function"){var N=g.return;try{I.componentDidMount()}catch(ke){jr(g,N,ke)}}var j=g.return;try{yf(g)}catch(ke){jr(g,j,ke)}break;case 5:var Q=g.return;try{yf(g)}catch(ke){jr(g,Q,ke)}}}catch(ke){jr(g,g.return,ke)}if(g===f){zt=null;break}var Te=g.sibling;if(Te!==null){Te.return=g.return,zt=Te;break}zt=g.return}}var Uy=Math.ceil,oh=Se.ReactCurrentDispatcher,om=Se.ReactCurrentOwner,Qs=Se.ReactCurrentBatchConfig,Bn=0,Ti=null,kn=null,Ur=0,Rs=0,dl=hs(0),Vr=0,fl=null,dc=0,pd=0,pu=0,mu=null,ui=null,ah=0,Wo=1/0,eo=null,wf=!1,Tf=null,ks=null,Sf=!1,pl=null,fc=0,gu=0,Af=null,md=-1,Pf=0;function _s(){return(Bn&6)!==0?An():md!==-1?md:md=An()}function pc(f){return(f.mode&1)===0?1:(Bn&2)!==0&&Ur!==0?Ur&-Ur:Hp.transition!==null?(Pf===0&&(Pf=Ba()),Pf):(f=$n,f!==0||(f=window.event,f=f===void 0?16:Ll(f.type)),f)}function Ho(f,g,S,I){if(50<gu)throw gu=0,Af=null,Error(t(185));za(f,S,I),((Bn&2)===0||f!==Ti)&&(f===Ti&&((Bn&2)===0&&(pd|=S),Vr===4&&mc(f,Ur)),Ds(f,I),S===1&&Bn===0&&(g.mode&1)===0&&(Wo=An()+500,Yi&&va()))}function Ds(f,g){var S=f.callbackNode;Lh(f,g);var I=Rl(f,f===Ti?Ur:0);if(I===0)S!==null&&Rc(S),f.callbackNode=null,f.callbackPriority=0;else if(g=I&-I,f.callbackPriority!==g){if(S!=null&&Rc(S),g===1)f.tag===0?Wp(cm.bind(null,f)):ec(cm.bind(null,f)),Hu(function(){(Bn&6)===0&&va()}),S=null;else{switch(Ts(I)){case 1:S=yi;break;case 4:S=Qn;break;case 16:S=kc;break;case 536870912:S=Du;break;default:S=kc}S=Vg(S,_u.bind(null,f))}f.callbackPriority=g,f.callbackNode=S}}function _u(f,g){if(md=-1,Pf=0,(Bn&6)!==0)throw Error(t(327));var S=f.callbackNode;if(ch()&&f.callbackNode!==S)return null;var I=Rl(f,f===Ti?Ur:0);if(I===0)return null;if((I&30)!==0||(I&f.expiredLanes)!==0||g)g=gd(f,I);else{g=I;var N=Bn;Bn|=2;var j=Fg();(Ti!==f||Ur!==g)&&(eo=null,Wo=An()+500,gl(f,g));do try{jy();break}catch(Te){Lg(f,Te)}while(!0);al(),oh.current=j,Bn=N,kn!==null?g=0:(Ti=null,Ur=0,g=Vr)}if(g!==0){if(g===2&&(N=Lc(f),N!==0&&(I=N,g=am(f,N))),g===1)throw S=fl,gl(f,0),mc(f,I),Ds(f,An()),S;if(g===6)mc(f,I);else{if(N=f.current.alternate,(I&30)===0&&!Og(N)&&(g=gd(f,I),g===2&&(j=Lc(f),j!==0&&(I=j,g=am(f,j))),g===1))throw S=fl,gl(f,0),mc(f,I),Ds(f,An()),S;switch(f.finishedWork=N,f.finishedLanes=I,g){case 0:case 1:throw Error(t(345));case 2:vu(f,ui,eo);break;case 3:if(mc(f,I),(I&130023424)===I&&(g=ah+500-An(),10<g)){if(Rl(f,0)!==0)break;if(N=f.suspendedLanes,(N&I)!==I){_s(),f.pingedLanes|=f.suspendedLanes&N;break}f.timeoutHandle=eu(vu.bind(null,f,ui,eo),g);break}vu(f,ui,eo);break;case 4:if(mc(f,I),(I&4194240)===I)break;for(g=f.eventTimes,N=-1;0<I;){var Q=31-ws(I);j=1<<Q,Q=g[Q],Q>N&&(N=Q),I&=~j}if(I=N,I=An()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*Uy(I/1960))-I,10<I){f.timeoutHandle=eu(vu.bind(null,f,ui,eo),I);break}vu(f,ui,eo);break;case 5:vu(f,ui,eo);break;default:throw Error(t(329))}}}return Ds(f,An()),f.callbackNode===S?_u.bind(null,f):null}function am(f,g){var S=mu;return f.current.memoizedState.isDehydrated&&(gl(f,g).flags|=256),f=gd(f,g),f!==2&&(g=ui,ui=S,g!==null&&lm(g)),f}function lm(f){ui===null?ui=f:ui.push.apply(ui,f)}function Og(f){for(var g=f;;){if(g.flags&16384){var S=g.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var I=0;I<S.length;I++){var N=S[I],j=N.getSnapshot;N=N.value;try{if(!qs(j(),N))return!1}catch{return!1}}}if(S=g.child,g.subtreeFlags&16384&&S!==null)S.return=g,g=S;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function mc(f,g){for(g&=~pu,g&=~pd,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var S=31-ws(g),I=1<<S;f[S]=-1,g&=~I}}function cm(f){if((Bn&6)!==0)throw Error(t(327));ch();var g=Rl(f,0);if((g&1)===0)return Ds(f,An()),null;var S=gd(f,g);if(f.tag!==0&&S===2){var I=Lc(f);I!==0&&(g=I,S=am(f,I))}if(S===1)throw S=fl,gl(f,0),mc(f,g),Ds(f,An()),S;if(S===6)throw Error(t(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,vu(f,ui,eo),Ds(f,An()),null}function um(f,g){var S=Bn;Bn|=1;try{return f(g)}finally{Bn=S,Bn===0&&(Wo=An()+500,Yi&&va())}}function ml(f){pl!==null&&pl.tag===0&&(Bn&6)===0&&ch();var g=Bn;Bn|=1;var S=Qs.transition,I=$n;try{if(Qs.transition=null,$n=1,f)return f()}finally{$n=I,Qs.transition=S,Bn=g,(Bn&6)===0&&va()}}function yu(){Rs=dl.current,Nn(dl)}function gl(f,g){f.finishedWork=null,f.finishedLanes=0;var S=f.timeoutHandle;if(S!==-1&&(f.timeoutHandle=-1,of(S)),kn!==null)for(S=kn.return;S!==null;){var I=S;switch(su(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&nl();break;case 3:m(),Nn(Oi),Nn(Jr),B();break;case 5:w(I);break;case 4:m();break;case 13:Nn(E);break;case 19:Nn(E);break;case 10:eh(I.type._context);break;case 22:case 23:yu()}S=S.return}if(Ti=f,kn=f=gc(f.current,null),Ur=Rs=g,Vr=0,fl=null,pu=pd=dc=0,ui=mu=null,ci!==null){for(g=0;g<ci.length;g++)if(S=ci[g],I=S.interleaved,I!==null){S.interleaved=null;var N=I.next,j=S.pending;if(j!==null){var Q=j.next;j.next=N,I.next=Q}S.pending=I}ci=null}return f}function Lg(f,g){do{var S=kn;try{if(al(),U.current=ei,oe){for(var I=Z.memoizedState;I!==null;){var N=I.queue;N!==null&&(N.pending=null),I=I.next}oe=!1}if($=0,ie=J=Z=null,ae=!1,de=0,om.current=null,S===null||S.return===null){Vr=1,fl=g,kn=null;break}e:{var j=f,Q=S.return,Te=S,ke=g;if(g=Ur,Te.flags|=32768,ke!==null&&typeof ke=="object"&&typeof ke.then=="function"){var ot=ke,At=Te,Ct=At.tag;if((At.mode&1)===0&&(Ct===0||Ct===11||Ct===15)){var bt=At.alternate;bt?(At.updateQueue=bt.updateQueue,At.memoizedState=bt.memoizedState,At.lanes=bt.lanes):(At.updateQueue=null,At.memoizedState=null)}var Ht=cf(Q);if(Ht!==null){Ht.flags&=-257,Xp(Ht,Q,Te,j,g),Ht.mode&1&&Zp(j,ot,g),g=Ht,ke=ot;var Kt=g.updateQueue;if(Kt===null){var Jt=new Set;Jt.add(ke),g.updateQueue=Jt}else Kt.add(ke);break e}else{if((g&1)===0){Zp(j,ot,g),Ef();break e}ke=Error(t(426))}}else if(gr&&Te.mode&1){var qr=cf(Q);if(qr!==null){(qr.flags&65536)===0&&(qr.flags|=256),Xp(qr,Q,Te,j,g),Hn(rs(ke,Te));break e}}j=ke=rs(ke,Te),Vr!==4&&(Vr=2),mu===null?mu=[j]:mu.push(j),j=Q;do{switch(j.tag){case 3:j.flags|=65536,g&=-g,j.lanes|=g;var Qe=cc(j,ke,g);cu(j,Qe);break e;case 1:Te=ke;var je=j.type,rt=j.stateNode;if((j.flags&128)===0&&(typeof je.getDerivedStateFromError=="function"||rt!==null&&typeof rt.componentDidCatch=="function"&&(ks===null||!ks.has(rt)))){j.flags|=65536,g&=-g,j.lanes|=g;var Nt=xg(j,Te,g);cu(j,Nt);break e}}j=j.return}while(j!==null)}hm(S)}catch(Qt){g=Qt,kn===S&&S!==null&&(kn=S=S.return);continue}break}while(!0)}function Fg(){var f=oh.current;return oh.current=ei,f===null?ei:f}function Ef(){(Vr===0||Vr===3||Vr===2)&&(Vr=4),Ti===null||(dc&268435455)===0&&(pd&268435455)===0||mc(Ti,Ur)}function gd(f,g){var S=Bn;Bn|=2;var I=Fg();(Ti!==f||Ur!==g)&&(eo=null,gl(f,g));do try{Vy();break}catch(N){Lg(f,N)}while(!0);if(al(),Bn=S,oh.current=I,kn!==null)throw Error(t(261));return Ti=null,Ur=0,Vr}function Vy(){for(;kn!==null;)lh(kn)}function jy(){for(;kn!==null&&!oo();)lh(kn)}function lh(f){var g=dm(f.alternate,f,Rs);f.memoizedProps=f.pendingProps,g===null?hm(f):kn=g,om.current=null}function hm(f){var g=f;do{var S=g.alternate;if(f=g.return,(g.flags&32768)===0){if(S=By(S,g,Rs),S!==null){kn=S;return}}else{if(S=nm(S,g),S!==null){S.flags&=32767,kn=S;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{Vr=6,kn=null;return}}if(g=g.sibling,g!==null){kn=g;return}kn=g=f}while(g!==null);Vr===0&&(Vr=5)}function vu(f,g,S){var I=$n,N=Qs.transition;try{Qs.transition=null,$n=1,$y(f,g,S,I)}finally{Qs.transition=N,$n=I}return null}function $y(f,g,S,I){do ch();while(pl!==null);if((Bn&6)!==0)throw Error(t(327));S=f.finishedWork;var N=f.finishedLanes;if(S===null)return null;if(f.finishedWork=null,f.finishedLanes=0,S===f.current)throw Error(t(177));f.callbackNode=null,f.callbackPriority=0;var j=S.lanes|S.childLanes;if(Lp(f,j),f===Ti&&(kn=Ti=null,Ur=0),(S.subtreeFlags&2064)===0&&(S.flags&2064)===0||Sf||(Sf=!0,Vg(kc,function(){return ch(),null})),j=(S.flags&15990)!==0,(S.subtreeFlags&15990)!==0||j){j=Qs.transition,Qs.transition=null;var Q=$n;$n=1;var Te=Bn;Bn|=4,om.current=null,Cg(f,S),sh(S,f),$u(Ya),vi=!!Qc,Ya=Qc=null,f.current=S,zy(S),Il(),Bn=Te,$n=Q,Qs.transition=j}else f.current=S;if(Sf&&(Sf=!1,pl=f,fc=N),j=f.pendingLanes,j===0&&(ks=null),Oh(S.stateNode),Ds(f,An()),g!==null)for(I=f.onRecoverableError,S=0;S<g.length;S++)N=g[S],I(N.value,{componentStack:N.stack,digest:N.digest});if(wf)throw wf=!1,f=Tf,Tf=null,f;return(fc&1)!==0&&f.tag!==0&&ch(),j=f.pendingLanes,(j&1)!==0?f===Af?gu++:(gu=0,Af=f):gu=0,va(),null}function ch(){if(pl!==null){var f=Ts(fc),g=Qs.transition,S=$n;try{if(Qs.transition=null,$n=16>f?16:f,pl===null)var I=!1;else{if(f=pl,pl=null,fc=0,(Bn&6)!==0)throw Error(t(331));var N=Bn;for(Bn|=4,zt=f.current;zt!==null;){var j=zt,Q=j.child;if((zt.flags&16)!==0){var Te=j.deletions;if(Te!==null){for(var ke=0;ke<Te.length;ke++){var ot=Te[ke];for(zt=ot;zt!==null;){var At=zt;switch(At.tag){case 0:case 11:case 15:fd(8,At,j)}var Ct=At.child;if(Ct!==null)Ct.return=At,zt=Ct;else for(;zt!==null;){At=zt;var bt=At.sibling,Ht=At.return;if(Ig(At),At===ot){zt=null;break}if(bt!==null){bt.return=Ht,zt=bt;break}zt=Ht}}}var Kt=j.alternate;if(Kt!==null){var Jt=Kt.child;if(Jt!==null){Kt.child=null;do{var qr=Jt.sibling;Jt.sibling=null,Jt=qr}while(Jt!==null)}}zt=j}}if((j.subtreeFlags&2064)!==0&&Q!==null)Q.return=j,zt=Q;else e:for(;zt!==null;){if(j=zt,(j.flags&2048)!==0)switch(j.tag){case 0:case 11:case 15:fd(9,j,j.return)}var Qe=j.sibling;if(Qe!==null){Qe.return=j.return,zt=Qe;break e}zt=j.return}}var je=f.current;for(zt=je;zt!==null;){Q=zt;var rt=Q.child;if((Q.subtreeFlags&2064)!==0&&rt!==null)rt.return=Q,zt=rt;else e:for(Q=je;zt!==null;){if(Te=zt,(Te.flags&2048)!==0)try{switch(Te.tag){case 0:case 11:case 15:_f(9,Te)}}catch(Qt){jr(Te,Te.return,Qt)}if(Te===Q){zt=null;break e}var Nt=Te.sibling;if(Nt!==null){Nt.return=Te.return,zt=Nt;break e}zt=Te.return}}if(Bn=N,va(),ai&&typeof ai.onPostCommitFiberRoot=="function")try{ai.onPostCommitFiberRoot(Vs,f)}catch{}I=!0}return I}finally{$n=S,Qs.transition=g}}return!1}function Ng(f,g,S){g=rs(S,g),g=cc(f,g,1),f=Qi(f,g,1),g=_s(),f!==null&&(za(f,1,g),Ds(f,g))}function jr(f,g,S){if(f.tag===3)Ng(f,f,S);else for(;g!==null;){if(g.tag===3){Ng(g,f,S);break}else if(g.tag===1){var I=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(ks===null||!ks.has(I))){f=rs(S,f),f=xg(g,f,1),g=Qi(g,f,1),f=_s(),g!==null&&(za(g,1,f),Ds(g,f));break}}g=g.return}}function Bg(f,g,S){var I=f.pingCache;I!==null&&I.delete(g),g=_s(),f.pingedLanes|=f.suspendedLanes&S,Ti===f&&(Ur&S)===S&&(Vr===4||Vr===3&&(Ur&130023424)===Ur&&500>An()-ah?gl(f,0):pu|=S),Ds(f,g)}function Cf(f,g){g===0&&((f.mode&1)===0?g=1:(g=Lu,Lu<<=1,(Lu&130023424)===0&&(Lu=4194304)));var S=_s();f=zn(f,g),f!==null&&(za(f,g,S),Ds(f,S))}function zg(f){var g=f.memoizedState,S=0;g!==null&&(S=g.retryLane),Cf(f,S)}function Ug(f,g){var S=0;switch(f.tag){case 13:var I=f.stateNode,N=f.memoizedState;N!==null&&(S=N.retryLane);break;case 19:I=f.stateNode;break;default:throw Error(t(314))}I!==null&&I.delete(g),Cf(f,S)}var dm;dm=function(f,g,S){if(f!==null)if(f.memoizedProps!==g.pendingProps||Oi.current)ti=!0;else{if((f.lanes&S)===0&&(g.flags&128)===0)return ti=!1,em(f,g,S);ti=(f.flags&131072)!==0}else ti=!1,gr&&(g.flags&1048576)!==0&&qu(g,Fi,g.index);switch(g.lanes=0,g.tag){case 2:var I=g.type;mf(f,g),f=g.pendingProps;var N=Ys(g,Jr.current);Lr(g,S),N=Me(null,g,I,f,N,S);var j=_e();return g.flags|=1,typeof N=="object"&&N!==null&&typeof N.render=="function"&&N.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,xi(I)?(j=!0,Li(g)):j=!1,g.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,nc(g),N.updater=oc,g.stateNode=N,N._reactInternals=g,ns(g,I,f,S),g=Kp(null,g,I,!0,j,S)):(g.tag=0,gr&&j&&In(g),is(null,g,N,S),g=g.child),g;case 16:I=g.elementType;e:{switch(mf(f,g),f=g.pendingProps,N=I._init,I=N(I._payload),g.type=I,N=g.tag=Wy(I),f=Ms(I,f),N){case 0:g=Yp(null,g,I,f,S);break e;case 1:g=hf(null,g,I,f,S);break e;case 11:g=bg(null,g,I,f,S);break e;case 14:g=uf(null,g,I,Ms(I.type,f),S);break e}throw Error(t(306,I,""))}return g;case 0:return I=g.type,N=g.pendingProps,N=g.elementType===I?N:Ms(I,N),Yp(f,g,I,N,S);case 1:return I=g.type,N=g.pendingProps,N=g.elementType===I?N:Ms(I,N),hf(f,g,I,N,S);case 3:e:{if(df(g),f===null)throw Error(t(387));I=g.pendingProps,j=g.memoizedState,N=j.element,rc(f,g),Is(g,I,null,S);var Q=g.memoizedState;if(I=Q.element,j.isDehydrated)if(j={element:I,isDehydrated:!1,cache:Q.cache,pendingSuspenseBoundaries:Q.pendingSuspenseBoundaries,transitions:Q.transitions},g.updateQueue.baseState=j,g.memoizedState=j,g.flags&256){N=rs(Error(t(423)),g),g=Jp(f,g,I,S,N);break e}else if(I!==N){N=rs(Error(t(424)),g),g=Jp(f,g,I,S,N);break e}else for(Bi=po(g.stateNode.containerInfo.firstChild),Ji=g,gr=!0,Cs=null,S=af(g,null,I,S),g.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(fs(),I===N){g=Sa(f,g,S);break e}is(f,g,I,S)}g=g.child}return g;case 5:return y(g),f===null&&Yu(g),I=g.type,N=g.pendingProps,j=f!==null?f.memoizedProps:null,Q=N.children,Ql(I,N)?Q=null:j!==null&&Ql(I,j)&&(g.flags|=32),Gp(f,g),is(f,g,Q,S),g.child;case 6:return f===null&&Yu(g),null;case 13:return wg(f,g,S);case 4:return h(g,g.stateNode.containerInfo),I=g.pendingProps,f===null?g.child=sl(g,null,I,S):is(f,g,I,S),g.child;case 11:return I=g.type,N=g.pendingProps,N=g.elementType===I?N:Ms(I,N),bg(f,g,I,N,S);case 7:return is(f,g,g.pendingProps,S),g.child;case 8:return is(f,g,g.pendingProps.children,S),g.child;case 12:return is(f,g,g.pendingProps.children,S),g.child;case 10:e:{if(I=g.type._context,N=g.pendingProps,j=g.memoizedProps,Q=N.value,Dn(ps,I._currentValue),I._currentValue=Q,j!==null)if(qs(j.value,Q)){if(j.children===N.children&&!Oi.current){g=Sa(f,g,S);break e}}else for(j=g.child,j!==null&&(j.return=g);j!==null;){var Te=j.dependencies;if(Te!==null){Q=j.child;for(var ke=Te.firstContext;ke!==null;){if(ke.context===I){if(j.tag===1){ke=zi(-1,S&-S),ke.tag=2;var ot=j.updateQueue;if(ot!==null){ot=ot.shared;var At=ot.pending;At===null?ke.next=ke:(ke.next=At.next,At.next=ke),ot.pending=ke}}j.lanes|=S,ke=j.alternate,ke!==null&&(ke.lanes|=S),tc(j.return,S,g),Te.lanes|=S;break}ke=ke.next}}else if(j.tag===10)Q=j.type===g.type?null:j.child;else if(j.tag===18){if(Q=j.return,Q===null)throw Error(t(341));Q.lanes|=S,Te=Q.alternate,Te!==null&&(Te.lanes|=S),tc(Q,S,g),Q=j.sibling}else Q=j.child;if(Q!==null)Q.return=j;else for(Q=j;Q!==null;){if(Q===g){Q=null;break}if(j=Q.sibling,j!==null){j.return=Q.return,Q=j;break}Q=Q.return}j=Q}is(f,g,N.children,S),g=g.child}return g;case 9:return N=g.type,I=g.pendingProps.children,Lr(g,S),N=ms(N),I=I(N),g.flags|=1,is(f,g,I,S),g.child;case 14:return I=g.type,N=Ms(I,g.pendingProps),N=Ms(I.type,N),uf(f,g,I,N,S);case 15:return qp(f,g,g.type,g.pendingProps,S);case 17:return I=g.type,N=g.pendingProps,N=g.elementType===I?N:Ms(I,N),mf(f,g),g.tag=1,xi(I)?(f=!0,Li(g)):f=!1,Lr(g,S),ts(g,I,N),ns(g,I,N,S),Kp(null,g,I,!0,f,S);case 19:return Sg(f,g,S);case 22:return cd(f,g,S)}throw Error(t(156,g.tag))};function Vg(f,g){return Co(f,g)}function If(f,g,S,I){this.tag=f,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xo(f,g,S,I){return new If(f,g,S,I)}function Mf(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Wy(f){if(typeof f=="function")return Mf(f)?1:0;if(f!=null){if(f=f.$$typeof,f===hn)return 11;if(f===Rn)return 14}return 2}function gc(f,g){var S=f.alternate;return S===null?(S=xo(f.tag,g,f.key,f.mode),S.elementType=f.elementType,S.type=f.type,S.stateNode=f.stateNode,S.alternate=f,f.alternate=S):(S.pendingProps=g,S.type=f.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=f.flags&14680064,S.childLanes=f.childLanes,S.lanes=f.lanes,S.child=f.child,S.memoizedProps=f.memoizedProps,S.memoizedState=f.memoizedState,S.updateQueue=f.updateQueue,g=f.dependencies,S.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},S.sibling=f.sibling,S.index=f.index,S.ref=f.ref,S}function Rf(f,g,S,I,N,j){var Q=2;if(I=f,typeof f=="function")Mf(f)&&(Q=1);else if(typeof f=="string")Q=5;else e:switch(f){case pt:return _c(S.children,N,j,g);case mt:Q=8,N|=8;break;case Tt:return f=xo(12,S,g,N|2),f.elementType=Tt,f.lanes=j,f;case on:return f=xo(13,S,g,N),f.elementType=on,f.lanes=j,f;case nn:return f=xo(19,S,g,N),f.elementType=nn,f.lanes=j,f;case Oe:return kf(S,N,j,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case Mt:Q=10;break e;case Zt:Q=9;break e;case hn:Q=11;break e;case Rn:Q=14;break e;case Ee:Q=16,I=null;break e}throw Error(t(130,f==null?f:typeof f,""))}return g=xo(Q,S,g,N),g.elementType=f,g.type=I,g.lanes=j,g}function _c(f,g,S,I){return f=xo(7,f,I,g),f.lanes=S,f}function kf(f,g,S,I){return f=xo(22,f,I,g),f.elementType=Oe,f.lanes=S,f.stateNode={isHidden:!1},f}function fm(f,g,S){return f=xo(6,f,null,g),f.lanes=S,f}function xu(f,g,S){return g=xo(4,f.children!==null?f.children:[],f.key,g),g.lanes=S,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function ni(f,g,S,I,N){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Fc(0),this.expirationTimes=Fc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fc(0),this.identifierPrefix=I,this.onRecoverableError=N,this.mutableSourceEagerHydrationData=null}function _d(f,g,S,I,N,j,Q,Te,ke){return f=new ni(f,g,S,Te,ke),g===1?(g=1,j===!0&&(g|=8)):g=0,j=xo(3,null,null,g),f.current=j,j.stateNode=f,j.memoizedState={element:I,isDehydrated:S,cache:null,transitions:null,pendingSuspenseBoundaries:null},nc(j),f}function jg(f,g,S){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:nt,key:I==null?null:""+I,children:f,containerInfo:g,implementation:S}}function pm(f){if(!f)return ds;f=f._reactInternals;e:{if(dn(f)!==f||f.tag!==1)throw Error(t(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(xi(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(t(171))}if(f.tag===1){var S=f.type;if(xi(S))return iu(f,S,g)}return g}function Df(f,g,S,I,N,j,Q,Te,ke){return f=_d(S,I,!0,f,N,j,Q,Te,ke),f.context=pm(null),S=f.current,I=_s(),N=pc(S),j=zi(I,N),j.callback=g??null,Qi(S,j,N),f.current.lanes=N,za(f,N,I),Ds(f,I),f}function _l(f,g,S,I){var N=g.current,j=_s(),Q=pc(N);return S=pm(S),g.context===null?g.context=S:g.pendingContext=S,g=zi(j,Q),g.payload={element:f},I=I===void 0?null:I,I!==null&&(g.callback=I),f=Qi(N,g,Q),f!==null&&(Ho(f,N,Q,j),ic(f,N,Q)),Q}function yd(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function $g(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var S=f.retryLane;f.retryLane=S!==0&&S<g?S:g}}function mm(f,g){$g(f,g),(f=f.alternate)&&$g(f,g)}function Hy(){return null}var Wg=typeof reportError=="function"?reportError:function(f){console.error(f)};function gm(f){this._internalRoot=f}Of.prototype.render=gm.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(t(409));_l(f,g,null,null)},Of.prototype.unmount=gm.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;ml(function(){_l(null,f,null,null)}),g[Ps]=null}};function Of(f){this._internalRoot=f}Of.prototype.unstable_scheduleHydration=function(f){if(f){var g=ao();f={blockedOn:null,target:f,priority:g};for(var S=0;S<or.length&&g!==0&&g<or[S].priority;S++);or.splice(S,0,f),S===0&&li(f)}};function _m(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function Lf(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function Hg(){}function Zy(f,g,S,I,N){if(N){if(typeof I=="function"){var j=I;I=function(){var ot=yd(Q);j.call(ot)}}var Q=Df(g,I,f,0,null,!1,!1,"",Hg);return f._reactRootContainer=Q,f[Ps]=Q.current,ma(f.nodeType===8?f.parentNode:f),ml(),Q}for(;N=f.lastChild;)f.removeChild(N);if(typeof I=="function"){var Te=I;I=function(){var ot=yd(ke);Te.call(ot)}}var ke=_d(f,0,!1,null,null,!1,!1,"",Hg);return f._reactRootContainer=ke,f[Ps]=ke.current,ma(f.nodeType===8?f.parentNode:f),ml(function(){_l(g,ke,S,I)}),ke}function Ff(f,g,S,I,N){var j=S._reactRootContainer;if(j){var Q=j;if(typeof N=="function"){var Te=N;N=function(){var ke=yd(Q);Te.call(ke)}}_l(g,Q,f,N)}else Q=Zy(S,g,f,N,I);return yd(Q)}Pn=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var S=Oc(g.pendingLanes);S!==0&&(ra(g,S|1),Ds(g,An()),(Bn&6)===0&&(Wo=An()+500,va()))}break;case 13:ml(function(){var I=zn(f,1);if(I!==null){var N=_s();Ho(I,f,1,N)}}),mm(f,1)}},Io=function(f){if(f.tag===13){var g=zn(f,134217728);if(g!==null){var S=_s();Ho(g,f,134217728,S)}mm(f,134217728)}},Mo=function(f){if(f.tag===13){var g=pc(f),S=zn(f,g);if(S!==null){var I=_s();Ho(S,f,g,I)}mm(f,g)}},ao=function(){return $n},ia=function(f,g){var S=$n;try{return $n=f,g()}finally{$n=S}},at=function(f,g,S){switch(g){case"input":if(Us(f,S),g=S.name,S.type==="radio"&&g!=null){for(S=f;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<S.length;g++){var I=S[g];if(I!==f&&I.form===f.form){var N=nu(I);if(!N)throw Error(t(90));Wn(I),Us(I,N)}}}break;case"textarea":ea(f,S);break;case"select":g=S.value,g!=null&&mi(f,!!S.multiple,g,!1)}},_n=um,sr=ml;var Xy={usingClientEntryPoint:!1,Events:[Qa,el,nu,Mn,qt,um]},uh={findFiberByHostInstance:Gs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ym={bundleType:uh.bundleType,version:uh.version,rendererPackageName:uh.rendererPackageName,rendererConfig:uh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Se.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=yn(f),f===null?null:f.stateNode},findFiberByHostInstance:uh.findFiberByHostInstance||Hy,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vd.isDisabled&&vd.supportsFiber)try{Vs=vd.inject(ym),ai=vd}catch{}}return bo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Xy,bo.createPortal=function(f,g){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_m(g))throw Error(t(200));return jg(f,g,null,S)},bo.createRoot=function(f,g){if(!_m(f))throw Error(t(299));var S=!1,I="",N=Wg;return g!=null&&(g.unstable_strictMode===!0&&(S=!0),g.identifierPrefix!==void 0&&(I=g.identifierPrefix),g.onRecoverableError!==void 0&&(N=g.onRecoverableError)),g=_d(f,1,!1,null,null,S,!1,I,N),f[Ps]=g.current,ma(f.nodeType===8?f.parentNode:f),new gm(g)},bo.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(t(188)):(f=Object.keys(f).join(","),Error(t(268,f)));return f=yn(g),f=f===null?null:f.stateNode,f},bo.flushSync=function(f){return ml(f)},bo.hydrate=function(f,g,S){if(!Lf(g))throw Error(t(200));return Ff(null,f,g,!0,S)},bo.hydrateRoot=function(f,g,S){if(!_m(f))throw Error(t(405));var I=S!=null&&S.hydratedSources||null,N=!1,j="",Q=Wg;if(S!=null&&(S.unstable_strictMode===!0&&(N=!0),S.identifierPrefix!==void 0&&(j=S.identifierPrefix),S.onRecoverableError!==void 0&&(Q=S.onRecoverableError)),g=Df(g,null,f,1,S??null,N,!1,j,Q),f[Ps]=g.current,ma(f),I)for(f=0;f<I.length;f++)S=I[f],N=S._getVersion,N=N(S._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[S,N]:g.mutableSourceEagerHydrationData.push(S,N);return new Of(g)},bo.render=function(f,g,S){if(!Lf(g))throw Error(t(200));return Ff(null,f,g,!1,S)},bo.unmountComponentAtNode=function(f){if(!Lf(f))throw Error(t(40));return f._reactRootContainer?(ml(function(){Ff(null,null,f,!1,function(){f._reactRootContainer=null,f[Ps]=null})}),!0):!1},bo.unstable_batchedUpdates=um,bo.unstable_renderSubtreeIntoContainer=function(f,g,S,I){if(!Lf(S))throw Error(t(200));if(f==null||f._reactInternals===void 0)throw Error(t(38));return Ff(f,g,S,!1,I)},bo.version="18.3.1-next-f1338f8080-20240426",bo}var Zw;function tA(){if(Zw)return pv.exports;Zw=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),pv.exports=RI(),pv.exports}var Xw;function kI(){if(Xw)return Qg;Xw=1;var n=tA();return Qg.createRoot=n.createRoot,Qg.hydrateRoot=n.hydrateRoot,Qg}var DI=kI(),nA=tA();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function qm(){return qm=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},qm.apply(this,arguments)}var vh;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(vh||(vh={}));const qw="popstate";function OI(n){n===void 0&&(n={});function e(r,o){let{pathname:c,search:d,hash:a}=r.location;return y0("",{pathname:c,search:d,hash:a},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function t(r,o){return typeof o=="string"?o:iA(o)}return FI(e,t,null,n)}function qi(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function rA(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function LI(){return Math.random().toString(36).substr(2,8)}function Gw(n,e){return{usr:n.state,key:n.key,idx:e}}function y0(n,e,t,r){return t===void 0&&(t=null),qm({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Cp(e):e,{state:t,key:e&&e.key||r||LI()})}function iA(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Cp(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function FI(n,e,t,r){r===void 0&&(r={});let{window:o=document.defaultView,v5Compat:c=!1}=r,d=o.history,a=vh.Pop,v=null,A=P();A==null&&(A=0,d.replaceState(qm({},d.state,{idx:A}),""));function P(){return(d.state||{idx:null}).idx}function k(){a=vh.Pop;let re=P(),fe=re==null?null:re-A;A=re,v&&v({action:a,location:te.location,delta:fe})}function L(re,fe){a=vh.Push;let ve=y0(te.location,re,fe);A=P()+1;let le=Gw(ve,A),Se=te.createHref(ve);try{d.pushState(le,"",Se)}catch(Ne){if(Ne instanceof DOMException&&Ne.name==="DataCloneError")throw Ne;o.location.assign(Se)}c&&v&&v({action:a,location:te.location,delta:1})}function z(re,fe){a=vh.Replace;let ve=y0(te.location,re,fe);A=P();let le=Gw(ve,A),Se=te.createHref(ve);d.replaceState(le,"",Se),c&&v&&v({action:a,location:te.location,delta:0})}function G(re){let fe=o.location.origin!=="null"?o.location.origin:o.location.href,ve=typeof re=="string"?re:iA(re);return ve=ve.replace(/ $/,"%20"),qi(fe,"No window.location.(origin|href) available to create URL for href: "+ve),new URL(ve,fe)}let te={get action(){return a},get location(){return n(o,d)},listen(re){if(v)throw new Error("A history only accepts one active listener");return o.addEventListener(qw,k),v=re,()=>{o.removeEventListener(qw,k),v=null}},createHref(re){return e(o,re)},createURL:G,encodeLocation(re){let fe=G(re);return{pathname:fe.pathname,search:fe.search,hash:fe.hash}},push:L,replace:z,go(re){return d.go(re)}};return te}var Yw;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Yw||(Yw={}));function NI(n,e,t){return t===void 0&&(t="/"),BI(n,e,t)}function BI(n,e,t,r){let o=typeof e=="string"?Cp(e):e,c=aA(o.pathname||"/",t);if(c==null)return null;let d=sA(n);zI(d);let a=null;for(let v=0;a==null&&v<d.length;++v){let A=KI(c);a=qI(d[v],A)}return a}function sA(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let o=(c,d,a)=>{let v={relativePath:a===void 0?c.path||"":a,caseSensitive:c.caseSensitive===!0,childrenIndex:d,route:c};v.relativePath.startsWith("/")&&(qi(v.relativePath.startsWith(r),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(r.length));let A=Od([r,v.relativePath]),P=t.concat(v);c.children&&c.children.length>0&&(qi(c.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+A+'".')),sA(c.children,e,P,A)),!(c.path==null&&!c.index)&&e.push({path:A,score:ZI(A,c.index),routesMeta:P})};return n.forEach((c,d)=>{var a;if(c.path===""||!((a=c.path)!=null&&a.includes("?")))o(c,d);else for(let v of oA(c.path))o(c,d,v)}),e}function oA(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,o=t.endsWith("?"),c=t.replace(/\?$/,"");if(r.length===0)return o?[c,""]:[c];let d=oA(r.join("/")),a=[];return a.push(...d.map(v=>v===""?c:[c,v].join("/"))),o&&a.push(...d),a.map(v=>n.startsWith("/")&&v===""?"/":v)}function zI(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:XI(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const UI=/^:[\w-]+$/,VI=3,jI=2,$I=1,WI=10,HI=-2,Kw=n=>n==="*";function ZI(n,e){let t=n.split("/"),r=t.length;return t.some(Kw)&&(r+=HI),e&&(r+=jI),t.filter(o=>!Kw(o)).reduce((o,c)=>o+(UI.test(c)?VI:c===""?$I:WI),r)}function XI(n,e){return n.length===e.length&&n.slice(0,-1).every((r,o)=>r===e[o])?n[n.length-1]-e[e.length-1]:0}function qI(n,e,t){let{routesMeta:r}=n,o={},c="/",d=[];for(let a=0;a<r.length;++a){let v=r[a],A=a===r.length-1,P=c==="/"?e:e.slice(c.length)||"/",k=GI({path:v.relativePath,caseSensitive:v.caseSensitive,end:A},P),L=v.route;if(!k)return null;Object.assign(o,k.params),d.push({params:o,pathname:Od([c,k.pathname]),pathnameBase:rM(Od([c,k.pathnameBase])),route:L}),k.pathnameBase!=="/"&&(c=Od([c,k.pathnameBase]))}return d}function GI(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=YI(n.path,n.caseSensitive,n.end),o=e.match(t);if(!o)return null;let c=o[0],d=c.replace(/(.)\/+$/,"$1"),a=o.slice(1);return{params:r.reduce((A,P,k)=>{let{paramName:L,isOptional:z}=P;if(L==="*"){let te=a[k]||"";d=c.slice(0,c.length-te.length).replace(/(.)\/+$/,"$1")}const G=a[k];return z&&!G?A[L]=void 0:A[L]=(G||"").replace(/%2F/g,"/"),A},{}),pathname:c,pathnameBase:d,pattern:n}}function YI(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),rA(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,a,v)=>(r.push({paramName:a,isOptional:v!=null}),v?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,e?void 0:"i"),r]}function KI(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return rA(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function aA(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function JI(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:o=""}=typeof n=="string"?Cp(n):n;return{pathname:t?t.startsWith("/")?t:QI(t,e):e,search:iM(r),hash:sM(o)}}function QI(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?t.length>1&&t.pop():o!=="."&&t.push(o)}),t.length>1?t.join("/"):"/"}function _v(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function eM(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function tM(n,e){let t=eM(n);return e?t.map((r,o)=>o===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function nM(n,e,t,r){r===void 0&&(r=!1);let o;typeof n=="string"?o=Cp(n):(o=qm({},n),qi(!o.pathname||!o.pathname.includes("?"),_v("?","pathname","search",o)),qi(!o.pathname||!o.pathname.includes("#"),_v("#","pathname","hash",o)),qi(!o.search||!o.search.includes("#"),_v("#","search","hash",o)));let c=n===""||o.pathname==="",d=c?"/":o.pathname,a;if(d==null)a=t;else{let k=e.length-1;if(!r&&d.startsWith("..")){let L=d.split("/");for(;L[0]==="..";)L.shift(),k-=1;o.pathname=L.join("/")}a=k>=0?e[k]:"/"}let v=JI(o,a),A=d&&d!=="/"&&d.endsWith("/"),P=(c||d===".")&&t.endsWith("/");return!v.pathname.endsWith("/")&&(A||P)&&(v.pathname+="/"),v}const Od=n=>n.join("/").replace(/\/\/+/g,"/"),rM=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),iM=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,sM=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function oM(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const lA=["post","put","patch","delete"];new Set(lA);const aM=["get",...lA];new Set(aM);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Gm(){return Gm=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Gm.apply(this,arguments)}const Ax=Ae.createContext(null),lM=Ae.createContext(null),py=Ae.createContext(null),my=Ae.createContext(null),Ip=Ae.createContext({outlet:null,matches:[],isDataRoute:!1}),cA=Ae.createContext(null);function gy(){return Ae.useContext(my)!=null}function uA(){return gy()||qi(!1),Ae.useContext(my).location}function hA(n){Ae.useContext(py).static||Ae.useLayoutEffect(n)}function cM(){let{isDataRoute:n}=Ae.useContext(Ip);return n?wM():uM()}function uM(){gy()||qi(!1);let n=Ae.useContext(Ax),{basename:e,future:t,navigator:r}=Ae.useContext(py),{matches:o}=Ae.useContext(Ip),{pathname:c}=uA(),d=JSON.stringify(tM(o,t.v7_relativeSplatPath)),a=Ae.useRef(!1);return hA(()=>{a.current=!0}),Ae.useCallback(function(A,P){if(P===void 0&&(P={}),!a.current)return;if(typeof A=="number"){r.go(A);return}let k=nM(A,JSON.parse(d),c,P.relative==="path");n==null&&e!=="/"&&(k.pathname=k.pathname==="/"?e:Od([e,k.pathname])),(P.replace?r.replace:r.push)(k,P.state,P)},[e,r,d,c,n])}function hM(n,e){return dM(n,e)}function dM(n,e,t,r){gy()||qi(!1);let{navigator:o}=Ae.useContext(py),{matches:c}=Ae.useContext(Ip),d=c[c.length-1],a=d?d.params:{};d&&d.pathname;let v=d?d.pathnameBase:"/";d&&d.route;let A=uA(),P;if(e){var k;let re=typeof e=="string"?Cp(e):e;v==="/"||(k=re.pathname)!=null&&k.startsWith(v)||qi(!1),P=re}else P=A;let L=P.pathname||"/",z=L;if(v!=="/"){let re=v.replace(/^\//,"").split("/");z="/"+L.replace(/^\//,"").split("/").slice(re.length).join("/")}let G=NI(n,{pathname:z}),te=_M(G&&G.map(re=>Object.assign({},re,{params:Object.assign({},a,re.params),pathname:Od([v,o.encodeLocation?o.encodeLocation(re.pathname).pathname:re.pathname]),pathnameBase:re.pathnameBase==="/"?v:Od([v,o.encodeLocation?o.encodeLocation(re.pathnameBase).pathname:re.pathnameBase])})),c,t,r);return e&&te?Ae.createElement(my.Provider,{value:{location:Gm({pathname:"/",search:"",hash:"",state:null,key:"default"},P),navigationType:vh.Pop}},te):te}function fM(){let n=bM(),e=oM(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Ae.createElement(Ae.Fragment,null,Ae.createElement("h2",null,"Unexpected Application Error!"),Ae.createElement("h3",{style:{fontStyle:"italic"}},e),t?Ae.createElement("pre",{style:o},t):null,null)}const pM=Ae.createElement(fM,null);class mM extends Ae.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?Ae.createElement(Ip.Provider,{value:this.props.routeContext},Ae.createElement(cA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function gM(n){let{routeContext:e,match:t,children:r}=n,o=Ae.useContext(Ax);return o&&o.static&&o.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=t.route.id),Ae.createElement(Ip.Provider,{value:e},r)}function _M(n,e,t,r){var o;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var c;if(!t)return null;if(t.errors)n=t.matches;else if((c=r)!=null&&c.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let d=n,a=(o=t)==null?void 0:o.errors;if(a!=null){let P=d.findIndex(k=>k.route.id&&a?.[k.route.id]!==void 0);P>=0||qi(!1),d=d.slice(0,Math.min(d.length,P+1))}let v=!1,A=-1;if(t&&r&&r.v7_partialHydration)for(let P=0;P<d.length;P++){let k=d[P];if((k.route.HydrateFallback||k.route.hydrateFallbackElement)&&(A=P),k.route.id){let{loaderData:L,errors:z}=t,G=k.route.loader&&L[k.route.id]===void 0&&(!z||z[k.route.id]===void 0);if(k.route.lazy||G){v=!0,A>=0?d=d.slice(0,A+1):d=[d[0]];break}}}return d.reduceRight((P,k,L)=>{let z,G=!1,te=null,re=null;t&&(z=a&&k.route.id?a[k.route.id]:void 0,te=k.route.errorElement||pM,v&&(A<0&&L===0?(TM("route-fallback"),G=!0,re=null):A===L&&(G=!0,re=k.route.hydrateFallbackElement||null)));let fe=e.concat(d.slice(0,L+1)),ve=()=>{let le;return z?le=te:G?le=re:k.route.Component?le=Ae.createElement(k.route.Component,null):k.route.element?le=k.route.element:le=P,Ae.createElement(gM,{match:k,routeContext:{outlet:P,matches:fe,isDataRoute:t!=null},children:le})};return t&&(k.route.ErrorBoundary||k.route.errorElement||L===0)?Ae.createElement(mM,{location:t.location,revalidation:t.revalidation,component:te,error:z,children:ve(),routeContext:{outlet:null,matches:fe,isDataRoute:!0}}):ve()},null)}var dA=(function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n})(dA||{}),fA=(function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n})(fA||{});function yM(n){let e=Ae.useContext(Ax);return e||qi(!1),e}function vM(n){let e=Ae.useContext(lM);return e||qi(!1),e}function xM(n){let e=Ae.useContext(Ip);return e||qi(!1),e}function pA(n){let e=xM(),t=e.matches[e.matches.length-1];return t.route.id||qi(!1),t.route.id}function bM(){var n;let e=Ae.useContext(cA),t=vM(),r=pA();return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function wM(){let{router:n}=yM(dA.UseNavigateStable),e=pA(fA.UseNavigateStable),t=Ae.useRef(!1);return hA(()=>{t.current=!0}),Ae.useCallback(function(o,c){c===void 0&&(c={}),t.current&&(typeof o=="number"?n.navigate(o):n.navigate(o,Gm({fromRouteId:e},c)))},[n,e])}const Jw={};function TM(n,e,t){Jw[n]||(Jw[n]=!0)}function SM(n,e){n?.v7_startTransition,n?.v7_relativeSplatPath}function T_(n){qi(!1)}function AM(n){let{basename:e="/",children:t=null,location:r,navigationType:o=vh.Pop,navigator:c,static:d=!1,future:a}=n;gy()&&qi(!1);let v=e.replace(/^\/*/,"/"),A=Ae.useMemo(()=>({basename:v,navigator:c,static:d,future:Gm({v7_relativeSplatPath:!1},a)}),[v,a,c,d]);typeof r=="string"&&(r=Cp(r));let{pathname:P="/",search:k="",hash:L="",state:z=null,key:G="default"}=r,te=Ae.useMemo(()=>{let re=aA(P,v);return re==null?null:{location:{pathname:re,search:k,hash:L,state:z,key:G},navigationType:o}},[v,P,k,L,z,G,o]);return te==null?null:Ae.createElement(py.Provider,{value:A},Ae.createElement(my.Provider,{children:t,value:te}))}function PM(n){let{children:e,location:t}=n;return hM(v0(e),t)}new Promise(()=>{});function v0(n,e){e===void 0&&(e=[]);let t=[];return Ae.Children.forEach(n,(r,o)=>{if(!Ae.isValidElement(r))return;let c=[...e,o];if(r.type===Ae.Fragment){t.push.apply(t,v0(r.props.children,c));return}r.type!==T_&&qi(!1),!r.props.index||!r.props.children||qi(!1);let d={id:r.props.id||c.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(d.children=v0(r.props.children,c)),t.push(d)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const EM="6";try{window.__reactRouterVersion=EM}catch{}const CM="startTransition",Qw=CI[CM];function IM(n){let{basename:e,children:t,future:r,window:o}=n,c=Ae.useRef();c.current==null&&(c.current=OI({window:o,v5Compat:!0}));let d=c.current,[a,v]=Ae.useState({action:d.action,location:d.location}),{v7_startTransition:A}=r||{},P=Ae.useCallback(k=>{A&&Qw?Qw(()=>v(k)):v(k)},[v,A]);return Ae.useLayoutEffect(()=>d.listen(P),[d,P]),Ae.useEffect(()=>SM(r),[r]),Ae.createElement(AM,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:d,future:r})}var e1;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(e1||(e1={}));var t1;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(t1||(t1={}));const MM=()=>{const n=cM(),e=Ae.useCallback(()=>{console.log("Stories button clicked"),n("/stories")},[n]),t=Ae.useCallback(()=>{console.log("Simulator button clicked"),n("/simulator")},[n]),r=Ae.useCallback(()=>{console.log("Games button clicked"),n("/games")},[n]);return{handleStoriesClick:e,handleSimulatorClick:t,handleGamesClick:r}},Px=Ae.createContext({});function Ex(n){const e=Ae.useRef(null);return e.current===null&&(e.current=n()),e.current}const Cx=typeof window<"u",mA=Cx?Ae.useLayoutEffect:Ae.useEffect,_y=Ae.createContext(null);function Ix(n,e){n.indexOf(e)===-1&&n.push(e)}function Mx(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const Pu=(n,e,t)=>t>e?e:t<n?n:t;let Rx=()=>{};const Eu={},gA=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function _A(n){return typeof n=="object"&&n!==null}const yA=n=>/^0[^.\s]+$/u.test(n);function kx(n){let e;return()=>(e===void 0&&(e=n()),e)}const Ma=n=>n,RM=(n,e)=>t=>e(n(t)),ug=(...n)=>n.reduce(RM),Ym=(n,e,t)=>{const r=e-n;return r===0?1:(t-n)/r};class Dx{constructor(){this.subscriptions=[]}add(e){return Ix(this.subscriptions,e),()=>Mx(this.subscriptions,e)}notify(e,t,r){const o=this.subscriptions.length;if(o)if(o===1)this.subscriptions[0](e,t,r);else for(let c=0;c<o;c++){const d=this.subscriptions[c];d&&d(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Pc=n=>n*1e3,Ca=n=>n/1e3;function vA(n,e){return e?n*(1e3/e):0}const xA=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,kM=1e-7,DM=12;function OM(n,e,t,r,o){let c,d,a=0;do d=e+(t-e)/2,c=xA(d,r,o)-n,c>0?t=d:e=d;while(Math.abs(c)>kM&&++a<DM);return d}function hg(n,e,t,r){if(n===e&&t===r)return Ma;const o=c=>OM(c,0,1,n,t);return c=>c===0||c===1?c:xA(o(c),e,r)}const bA=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,wA=n=>e=>1-n(1-e),TA=hg(.33,1.53,.69,.99),Ox=wA(TA),SA=bA(Ox),AA=n=>(n*=2)<1?.5*Ox(n):.5*(2-Math.pow(2,-10*(n-1))),Lx=n=>1-Math.sin(Math.acos(n)),PA=wA(Lx),EA=bA(Lx),LM=hg(.42,0,1,1),FM=hg(0,0,.58,1),CA=hg(.42,0,.58,1),NM=n=>Array.isArray(n)&&typeof n[0]!="number",IA=n=>Array.isArray(n)&&typeof n[0]=="number",BM={linear:Ma,easeIn:LM,easeInOut:CA,easeOut:FM,circIn:Lx,circInOut:EA,circOut:PA,backIn:Ox,backInOut:SA,backOut:TA,anticipate:AA},zM=n=>typeof n=="string",n1=n=>{if(IA(n)){Rx(n.length===4);const[e,t,r,o]=n;return hg(e,t,r,o)}else if(zM(n))return BM[n];return n},e_=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function UM(n,e){let t=new Set,r=new Set,o=!1,c=!1;const d=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function v(P){d.has(P)&&(A.schedule(P),n()),P(a)}const A={schedule:(P,k=!1,L=!1)=>{const G=L&&o?t:r;return k&&d.add(P),G.has(P)||G.add(P),P},cancel:P=>{r.delete(P),d.delete(P)},process:P=>{if(a=P,o){c=!0;return}o=!0,[t,r]=[r,t],t.forEach(v),t.clear(),o=!1,c&&(c=!1,A.process(P))}};return A}const VM=40;function MA(n,e){let t=!1,r=!0;const o={delta:0,timestamp:0,isProcessing:!1},c=()=>t=!0,d=e_.reduce((le,Se)=>(le[Se]=UM(c),le),{}),{setup:a,read:v,resolveKeyframes:A,preUpdate:P,update:k,preRender:L,render:z,postRender:G}=d,te=()=>{const le=Eu.useManualTiming?o.timestamp:performance.now();t=!1,Eu.useManualTiming||(o.delta=r?1e3/60:Math.max(Math.min(le-o.timestamp,VM),1)),o.timestamp=le,o.isProcessing=!0,a.process(o),v.process(o),A.process(o),P.process(o),k.process(o),L.process(o),z.process(o),G.process(o),o.isProcessing=!1,t&&e&&(r=!1,n(te))},re=()=>{t=!0,r=!0,o.isProcessing||n(te)};return{schedule:e_.reduce((le,Se)=>{const Ne=d[Se];return le[Se]=(nt,pt=!1,mt=!1)=>(t||re(),Ne.schedule(nt,pt,mt)),le},{}),cancel:le=>{for(let Se=0;Se<e_.length;Se++)d[e_[Se]].cancel(le)},state:o,steps:d}}const{schedule:$r,cancel:Eh,state:vs,steps:yv}=MA(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ma,!0);let S_;function jM(){S_=void 0}const wo={now:()=>(S_===void 0&&wo.set(vs.isProcessing||Eu.useManualTiming?vs.timestamp:performance.now()),S_),set:n=>{S_=n,queueMicrotask(jM)}},RA=n=>e=>typeof e=="string"&&e.startsWith(n),Fx=RA("--"),$M=RA("var(--"),Nx=n=>$M(n)?WM.test(n.split("/*")[0].trim()):!1,WM=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Mp={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},Km={...Mp,transform:n=>Pu(0,1,n)},t_={...Mp,default:1},Fm=n=>Math.round(n*1e5)/1e5,Bx=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function HM(n){return n==null}const ZM=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,zx=(n,e)=>t=>!!(typeof t=="string"&&ZM.test(t)&&t.startsWith(n)||e&&!HM(t)&&Object.prototype.hasOwnProperty.call(t,e)),kA=(n,e,t)=>r=>{if(typeof r!="string")return r;const[o,c,d,a]=r.match(Bx);return{[n]:parseFloat(o),[e]:parseFloat(c),[t]:parseFloat(d),alpha:a!==void 0?parseFloat(a):1}},XM=n=>Pu(0,255,n),vv={...Mp,transform:n=>Math.round(XM(n))},Id={test:zx("rgb","red"),parse:kA("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:r=1})=>"rgba("+vv.transform(n)+", "+vv.transform(e)+", "+vv.transform(t)+", "+Fm(Km.transform(r))+")"};function qM(n){let e="",t="",r="",o="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),r=n.substring(5,7),o=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),r=n.substring(3,4),o=n.substring(4,5),e+=e,t+=t,r+=r,o+=o),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:o?parseInt(o,16)/255:1}}const x0={test:zx("#"),parse:qM,transform:Id.transform},dg=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),gh=dg("deg"),Ec=dg("%"),wn=dg("px"),GM=dg("vh"),YM=dg("vw"),r1={...Ec,parse:n=>Ec.parse(n)/100,transform:n=>Ec.transform(n*100)},Qf={test:zx("hsl","hue"),parse:kA("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:r=1})=>"hsla("+Math.round(n)+", "+Ec.transform(Fm(e))+", "+Ec.transform(Fm(t))+", "+Fm(Km.transform(r))+")"},Mi={test:n=>Id.test(n)||x0.test(n)||Qf.test(n),parse:n=>Id.test(n)?Id.parse(n):Qf.test(n)?Qf.parse(n):x0.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Id.transform(n):Qf.transform(n),getAnimatableNone:n=>{const e=Mi.parse(n);return e.alpha=0,Mi.transform(e)}},KM=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function JM(n){return isNaN(n)&&typeof n=="string"&&(n.match(Bx)?.length||0)+(n.match(KM)?.length||0)>0}const DA="number",OA="color",QM="var",eR="var(",i1="${}",tR=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Jm(n){const e=n.toString(),t=[],r={color:[],number:[],var:[]},o=[];let c=0;const a=e.replace(tR,v=>(Mi.test(v)?(r.color.push(c),o.push(OA),t.push(Mi.parse(v))):v.startsWith(eR)?(r.var.push(c),o.push(QM),t.push(v)):(r.number.push(c),o.push(DA),t.push(parseFloat(v))),++c,i1)).split(i1);return{values:t,split:a,indexes:r,types:o}}function LA(n){return Jm(n).values}function FA(n){const{split:e,types:t}=Jm(n),r=e.length;return o=>{let c="";for(let d=0;d<r;d++)if(c+=e[d],o[d]!==void 0){const a=t[d];a===DA?c+=Fm(o[d]):a===OA?c+=Mi.transform(o[d]):c+=o[d]}return c}}const nR=n=>typeof n=="number"?0:Mi.test(n)?Mi.getAnimatableNone(n):n;function rR(n){const e=LA(n);return FA(n)(e.map(nR))}const Ch={test:JM,parse:LA,createTransformer:FA,getAnimatableNone:rR};function xv(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function iR({hue:n,saturation:e,lightness:t,alpha:r}){n/=360,e/=100,t/=100;let o=0,c=0,d=0;if(!e)o=c=d=t;else{const a=t<.5?t*(1+e):t+e-t*e,v=2*t-a;o=xv(v,a,n+1/3),c=xv(v,a,n),d=xv(v,a,n-1/3)}return{red:Math.round(o*255),green:Math.round(c*255),blue:Math.round(d*255),alpha:r}}function z_(n,e){return t=>t>0?e:n}const Gr=(n,e,t)=>n+(e-n)*t,bv=(n,e,t)=>{const r=n*n,o=t*(e*e-r)+r;return o<0?0:Math.sqrt(o)},sR=[x0,Id,Qf],oR=n=>sR.find(e=>e.test(n));function s1(n){const e=oR(n);if(!e)return!1;let t=e.parse(n);return e===Qf&&(t=iR(t)),t}const o1=(n,e)=>{const t=s1(n),r=s1(e);if(!t||!r)return z_(n,e);const o={...t};return c=>(o.red=bv(t.red,r.red,c),o.green=bv(t.green,r.green,c),o.blue=bv(t.blue,r.blue,c),o.alpha=Gr(t.alpha,r.alpha,c),Id.transform(o))},b0=new Set(["none","hidden"]);function aR(n,e){return b0.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function lR(n,e){return t=>Gr(n,e,t)}function Ux(n){return typeof n=="number"?lR:typeof n=="string"?Nx(n)?z_:Mi.test(n)?o1:hR:Array.isArray(n)?NA:typeof n=="object"?Mi.test(n)?o1:cR:z_}function NA(n,e){const t=[...n],r=t.length,o=n.map((c,d)=>Ux(c)(c,e[d]));return c=>{for(let d=0;d<r;d++)t[d]=o[d](c);return t}}function cR(n,e){const t={...n,...e},r={};for(const o in t)n[o]!==void 0&&e[o]!==void 0&&(r[o]=Ux(n[o])(n[o],e[o]));return o=>{for(const c in r)t[c]=r[c](o);return t}}function uR(n,e){const t=[],r={color:0,var:0,number:0};for(let o=0;o<e.values.length;o++){const c=e.types[o],d=n.indexes[c][r[c]],a=n.values[d]??0;t[o]=a,r[c]++}return t}const hR=(n,e)=>{const t=Ch.createTransformer(e),r=Jm(n),o=Jm(e);return r.indexes.var.length===o.indexes.var.length&&r.indexes.color.length===o.indexes.color.length&&r.indexes.number.length>=o.indexes.number.length?b0.has(n)&&!o.values.length||b0.has(e)&&!r.values.length?aR(n,e):ug(NA(uR(r,o),o.values),t):z_(n,e)};function BA(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?Gr(n,e,t):Ux(n)(n,e)}const dR=n=>{const e=({timestamp:t})=>n(t);return{start:(t=!0)=>$r.update(e,t),stop:()=>Eh(e),now:()=>vs.isProcessing?vs.timestamp:wo.now()}},zA=(n,e,t=10)=>{let r="";const o=Math.max(Math.round(e/t),2);for(let c=0;c<o;c++)r+=Math.round(n(c/(o-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},U_=2e4;function Vx(n){let e=0;const t=50;let r=n.next(e);for(;!r.done&&e<U_;)e+=t,r=n.next(e);return e>=U_?1/0:e}function fR(n,e=100,t){const r=t({...n,keyframes:[0,e]}),o=Math.min(Vx(r),U_);return{type:"keyframes",ease:c=>r.next(o*c).value/e,duration:Ca(o)}}const pR=5;function UA(n,e,t){const r=Math.max(e-pR,0);return vA(t-n(r),e-r)}const si={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},wv=.001;function mR({duration:n=si.duration,bounce:e=si.bounce,velocity:t=si.velocity,mass:r=si.mass}){let o,c,d=1-e;d=Pu(si.minDamping,si.maxDamping,d),n=Pu(si.minDuration,si.maxDuration,Ca(n)),d<1?(o=A=>{const P=A*d,k=P*n,L=P-t,z=w0(A,d),G=Math.exp(-k);return wv-L/z*G},c=A=>{const k=A*d*n,L=k*t+t,z=Math.pow(d,2)*Math.pow(A,2)*n,G=Math.exp(-k),te=w0(Math.pow(A,2),d);return(-o(A)+wv>0?-1:1)*((L-z)*G)/te}):(o=A=>{const P=Math.exp(-A*n),k=(A-t)*n+1;return-wv+P*k},c=A=>{const P=Math.exp(-A*n),k=(t-A)*(n*n);return P*k});const a=5/n,v=_R(o,c,a);if(n=Pc(n),isNaN(v))return{stiffness:si.stiffness,damping:si.damping,duration:n};{const A=Math.pow(v,2)*r;return{stiffness:A,damping:d*2*Math.sqrt(r*A),duration:n}}}const gR=12;function _R(n,e,t){let r=t;for(let o=1;o<gR;o++)r=r-n(r)/e(r);return r}function w0(n,e){return n*Math.sqrt(1-e*e)}const yR=["duration","bounce"],vR=["stiffness","damping","mass"];function a1(n,e){return e.some(t=>n[t]!==void 0)}function xR(n){let e={velocity:si.velocity,stiffness:si.stiffness,damping:si.damping,mass:si.mass,isResolvedFromDuration:!1,...n};if(!a1(n,vR)&&a1(n,yR))if(n.visualDuration){const t=n.visualDuration,r=2*Math.PI/(t*1.2),o=r*r,c=2*Pu(.05,1,1-(n.bounce||0))*Math.sqrt(o);e={...e,mass:si.mass,stiffness:o,damping:c}}else{const t=mR(n);e={...e,...t,mass:si.mass},e.isResolvedFromDuration=!0}return e}function V_(n=si.visualDuration,e=si.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:r,restDelta:o}=t;const c=t.keyframes[0],d=t.keyframes[t.keyframes.length-1],a={done:!1,value:c},{stiffness:v,damping:A,mass:P,duration:k,velocity:L,isResolvedFromDuration:z}=xR({...t,velocity:-Ca(t.velocity||0)}),G=L||0,te=A/(2*Math.sqrt(v*P)),re=d-c,fe=Ca(Math.sqrt(v/P)),ve=Math.abs(re)<5;r||(r=ve?si.restSpeed.granular:si.restSpeed.default),o||(o=ve?si.restDelta.granular:si.restDelta.default);let le;if(te<1){const Ne=w0(fe,te);le=nt=>{const pt=Math.exp(-te*fe*nt);return d-pt*((G+te*fe*re)/Ne*Math.sin(Ne*nt)+re*Math.cos(Ne*nt))}}else if(te===1)le=Ne=>d-Math.exp(-fe*Ne)*(re+(G+fe*re)*Ne);else{const Ne=fe*Math.sqrt(te*te-1);le=nt=>{const pt=Math.exp(-te*fe*nt),mt=Math.min(Ne*nt,300);return d-pt*((G+te*fe*re)*Math.sinh(mt)+Ne*re*Math.cosh(mt))/Ne}}const Se={calculatedDuration:z&&k||null,next:Ne=>{const nt=le(Ne);if(z)a.done=Ne>=k;else{let pt=Ne===0?G:0;te<1&&(pt=Ne===0?Pc(G):UA(le,Ne,nt));const mt=Math.abs(pt)<=r,Tt=Math.abs(d-nt)<=o;a.done=mt&&Tt}return a.value=a.done?d:nt,a},toString:()=>{const Ne=Math.min(Vx(Se),U_),nt=zA(pt=>Se.next(Ne*pt).value,Ne,30);return Ne+"ms "+nt},toTransition:()=>{}};return Se}V_.applyToOptions=n=>{const e=fR(n,100,V_);return n.ease=e.ease,n.duration=Pc(e.duration),n.type="keyframes",n};function T0({keyframes:n,velocity:e=0,power:t=.8,timeConstant:r=325,bounceDamping:o=10,bounceStiffness:c=500,modifyTarget:d,min:a,max:v,restDelta:A=.5,restSpeed:P}){const k=n[0],L={done:!1,value:k},z=mt=>a!==void 0&&mt<a||v!==void 0&&mt>v,G=mt=>a===void 0?v:v===void 0||Math.abs(a-mt)<Math.abs(v-mt)?a:v;let te=t*e;const re=k+te,fe=d===void 0?re:d(re);fe!==re&&(te=fe-k);const ve=mt=>-te*Math.exp(-mt/r),le=mt=>fe+ve(mt),Se=mt=>{const Tt=ve(mt),Mt=le(mt);L.done=Math.abs(Tt)<=A,L.value=L.done?fe:Mt};let Ne,nt;const pt=mt=>{z(L.value)&&(Ne=mt,nt=V_({keyframes:[L.value,G(L.value)],velocity:UA(le,mt,L.value),damping:o,stiffness:c,restDelta:A,restSpeed:P}))};return pt(0),{calculatedDuration:null,next:mt=>{let Tt=!1;return!nt&&Ne===void 0&&(Tt=!0,Se(mt),pt(mt)),Ne!==void 0&&mt>=Ne?nt.next(mt-Ne):(!Tt&&Se(mt),L)}}}function bR(n,e,t){const r=[],o=t||Eu.mix||BA,c=n.length-1;for(let d=0;d<c;d++){let a=o(n[d],n[d+1]);if(e){const v=Array.isArray(e)?e[d]||Ma:e;a=ug(v,a)}r.push(a)}return r}function wR(n,e,{clamp:t=!0,ease:r,mixer:o}={}){const c=n.length;if(Rx(c===e.length),c===1)return()=>e[0];if(c===2&&e[0]===e[1])return()=>e[1];const d=n[0]===n[1];n[0]>n[c-1]&&(n=[...n].reverse(),e=[...e].reverse());const a=bR(e,r,o),v=a.length,A=P=>{if(d&&P<n[0])return e[0];let k=0;if(v>1)for(;k<n.length-2&&!(P<n[k+1]);k++);const L=Ym(n[k],n[k+1],P);return a[k](L)};return t?P=>A(Pu(n[0],n[c-1],P)):A}function TR(n,e){const t=n[n.length-1];for(let r=1;r<=e;r++){const o=Ym(0,e,r);n.push(Gr(t,1,o))}}function SR(n){const e=[0];return TR(e,n.length-1),e}function AR(n,e){return n.map(t=>t*e)}function PR(n,e){return n.map(()=>e||CA).splice(0,n.length-1)}function Nm({duration:n=300,keyframes:e,times:t,ease:r="easeInOut"}){const o=NM(r)?r.map(n1):n1(r),c={done:!1,value:e[0]},d=AR(t&&t.length===e.length?t:SR(e),n),a=wR(d,e,{ease:Array.isArray(o)?o:PR(e,o)});return{calculatedDuration:n,next:v=>(c.value=a(v),c.done=v>=n,c)}}const ER=n=>n!==null;function jx(n,{repeat:e,repeatType:t="loop"},r,o=1){const c=n.filter(ER),a=o<0||e&&t!=="loop"&&e%2===1?0:c.length-1;return!a||r===void 0?c[a]:r}const CR={decay:T0,inertia:T0,tween:Nm,keyframes:Nm,spring:V_};function VA(n){typeof n.type=="string"&&(n.type=CR[n.type])}class $x{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const IR=n=>n/100;class Wx extends $x{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==wo.now()&&this.tick(wo.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;VA(e);const{type:t=Nm,repeat:r=0,repeatDelay:o=0,repeatType:c,velocity:d=0}=e;let{keyframes:a}=e;const v=t||Nm;v!==Nm&&typeof a[0]!="number"&&(this.mixKeyframes=ug(IR,BA(a[0],a[1])),a=[0,100]);const A=v({...e,keyframes:a});c==="mirror"&&(this.mirroredGenerator=v({...e,keyframes:[...a].reverse(),velocity:-d})),A.calculatedDuration===null&&(A.calculatedDuration=Vx(A));const{calculatedDuration:P}=A;this.calculatedDuration=P,this.resolvedDuration=P+o,this.totalDuration=this.resolvedDuration*(r+1)-o,this.generator=A}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:r,totalDuration:o,mixKeyframes:c,mirroredGenerator:d,resolvedDuration:a,calculatedDuration:v}=this;if(this.startTime===null)return r.next(0);const{delay:A=0,keyframes:P,repeat:k,repeatType:L,repeatDelay:z,type:G,onUpdate:te,finalKeyframe:re}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-o/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const fe=this.currentTime-A*(this.playbackSpeed>=0?1:-1),ve=this.playbackSpeed>=0?fe<0:fe>o;this.currentTime=Math.max(fe,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=o);let le=this.currentTime,Se=r;if(k){const mt=Math.min(this.currentTime,o)/a;let Tt=Math.floor(mt),Mt=mt%1;!Mt&&mt>=1&&(Mt=1),Mt===1&&Tt--,Tt=Math.min(Tt,k+1),!!(Tt%2)&&(L==="reverse"?(Mt=1-Mt,z&&(Mt-=z/a)):L==="mirror"&&(Se=d)),le=Pu(0,1,Mt)*a}const Ne=ve?{done:!1,value:P[0]}:Se.next(le);c&&(Ne.value=c(Ne.value));let{done:nt}=Ne;!ve&&v!==null&&(nt=this.playbackSpeed>=0?this.currentTime>=o:this.currentTime<=0);const pt=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&nt);return pt&&G!==T0&&(Ne.value=jx(P,this.options,re,this.speed)),te&&te(Ne.value),pt&&this.finish(),Ne}then(e,t){return this.finished.then(e,t)}get duration(){return Ca(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ca(e)}get time(){return Ca(this.currentTime)}set time(e){e=Pc(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(wo.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Ca(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=dR,startTime:t}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),this.options.onPlay?.();const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=t??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(wo.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function MR(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const Md=n=>n*180/Math.PI,S0=n=>{const e=Md(Math.atan2(n[1],n[0]));return A0(e)},RR={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:S0,rotateZ:S0,skewX:n=>Md(Math.atan(n[1])),skewY:n=>Md(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},A0=n=>(n=n%360,n<0&&(n+=360),n),l1=S0,c1=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),u1=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),kR={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:c1,scaleY:u1,scale:n=>(c1(n)+u1(n))/2,rotateX:n=>A0(Md(Math.atan2(n[6],n[5]))),rotateY:n=>A0(Md(Math.atan2(-n[2],n[0]))),rotateZ:l1,rotate:l1,skewX:n=>Md(Math.atan(n[4])),skewY:n=>Md(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function P0(n){return n.includes("scale")?1:0}function E0(n,e){if(!n||n==="none")return P0(e);const t=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,o;if(t)r=kR,o=t;else{const a=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=RR,o=a}if(!o)return P0(e);const c=r[e],d=o[1].split(",").map(OR);return typeof c=="function"?c(d):d[c]}const DR=(n,e)=>{const{transform:t="none"}=getComputedStyle(n);return E0(t,e)};function OR(n){return parseFloat(n.trim())}const Rp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],kp=new Set(Rp),h1=n=>n===Mp||n===wn,LR=new Set(["x","y","z"]),FR=Rp.filter(n=>!LR.has(n));function NR(n){const e=[];return FR.forEach(t=>{const r=n.getValue(t);r!==void 0&&(e.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),e}const Ld={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>E0(e,"x"),y:(n,{transform:e})=>E0(e,"y")};Ld.translateX=Ld.x;Ld.translateY=Ld.y;const Fd=new Set;let C0=!1,I0=!1,M0=!1;function jA(){if(I0){const n=Array.from(Fd).filter(r=>r.needsMeasurement),e=new Set(n.map(r=>r.element)),t=new Map;e.forEach(r=>{const o=NR(r);o.length&&(t.set(r,o),r.render())}),n.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const o=t.get(r);o&&o.forEach(([c,d])=>{r.getValue(c)?.set(d)})}),n.forEach(r=>r.measureEndState()),n.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}I0=!1,C0=!1,Fd.forEach(n=>n.complete(M0)),Fd.clear()}function $A(){Fd.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(I0=!0)})}function BR(){M0=!0,$A(),jA(),M0=!1}class Hx{constructor(e,t,r,o,c,d=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=o,this.element=c,this.isAsync=d}scheduleResolve(){this.state="scheduled",this.isAsync?(Fd.add(this),C0||(C0=!0,$r.read($A),$r.resolveKeyframes(jA))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:r,motionValue:o}=this;if(e[0]===null){const c=o?.get(),d=e[e.length-1];if(c!==void 0)e[0]=c;else if(r&&t){const a=r.readValue(t,d);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=d),o&&c===void 0&&o.set(e[0])}MR(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Fd.delete(this)}cancel(){this.state==="scheduled"&&(Fd.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const zR=n=>n.startsWith("--");function UR(n,e,t){zR(e)?n.style.setProperty(e,t):n.style[e]=t}const VR=kx(()=>window.ScrollTimeline!==void 0),jR={};function $R(n,e){const t=kx(n);return()=>jR[e]??t()}const WA=$R(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Im=([n,e,t,r])=>`cubic-bezier(${n}, ${e}, ${t}, ${r})`,d1={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Im([0,.65,.55,1]),circOut:Im([.55,0,1,.45]),backIn:Im([.31,.01,.66,-.59]),backOut:Im([.33,1.53,.69,.99])};function HA(n,e){if(n)return typeof n=="function"?WA()?zA(n,e):"ease-out":IA(n)?Im(n):Array.isArray(n)?n.map(t=>HA(t,e)||d1.easeOut):d1[n]}function WR(n,e,t,{delay:r=0,duration:o=300,repeat:c=0,repeatType:d="loop",ease:a="easeOut",times:v}={},A=void 0){const P={[e]:t};v&&(P.offset=v);const k=HA(a,o);Array.isArray(k)&&(P.easing=k);const L={delay:r,duration:o,easing:Array.isArray(k)?"linear":k,fill:"both",iterations:c+1,direction:d==="reverse"?"alternate":"normal"};return A&&(L.pseudoElement=A),n.animate(P,L)}function ZA(n){return typeof n=="function"&&"applyToOptions"in n}function HR({type:n,...e}){return ZA(n)&&WA()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class ZR extends $x{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:r,keyframes:o,pseudoElement:c,allowFlatten:d=!1,finalKeyframe:a,onComplete:v}=e;this.isPseudoElement=!!c,this.allowFlatten=d,this.options=e,Rx(typeof e.type!="string");const A=HR(e);this.animation=WR(t,r,o,A,c),A.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!c){const P=jx(o,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(P):UR(t,r,P),this.animation.cancel()}v?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return Ca(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ca(e)}get time(){return Ca(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Pc(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&VR()?(this.animation.timeline=e,Ma):t(this)}}const XA={anticipate:AA,backInOut:SA,circInOut:EA};function XR(n){return n in XA}function qR(n){typeof n.ease=="string"&&XR(n.ease)&&(n.ease=XA[n.ease])}const f1=10;class GR extends ZR{constructor(e){qR(e),VA(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:r,onComplete:o,element:c,...d}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const a=new Wx({...d,autoplay:!1}),v=Pc(this.finishedTime??this.time);t.setWithVelocity(a.sample(v-f1).value,a.sample(v).value,f1),a.stop()}}const p1=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Ch.test(n)||n==="0")&&!n.startsWith("url("));function YR(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function KR(n,e,t,r){const o=n[0];if(o===null)return!1;if(e==="display"||e==="visibility")return!0;const c=n[n.length-1],d=p1(o,e),a=p1(c,e);return!d||!a?!1:YR(n)||(t==="spring"||ZA(t))&&r}function R0(n){n.duration=0,n.type="keyframes"}const JR=new Set(["opacity","clipPath","filter","transform"]),QR=kx(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function ek(n){const{motionValue:e,name:t,repeatDelay:r,repeatType:o,damping:c,type:d}=n;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:A}=e.owner.getProps();return QR()&&t&&JR.has(t)&&(t!=="transform"||!A)&&!v&&!r&&o!=="mirror"&&c!==0&&d!=="inertia"}const tk=40;class nk extends $x{constructor({autoplay:e=!0,delay:t=0,type:r="keyframes",repeat:o=0,repeatDelay:c=0,repeatType:d="loop",keyframes:a,name:v,motionValue:A,element:P,...k}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=wo.now();const L={autoplay:e,delay:t,type:r,repeat:o,repeatDelay:c,repeatType:d,name:v,motionValue:A,element:P,...k},z=P?.KeyframeResolver||Hx;this.keyframeResolver=new z(a,(G,te,re)=>this.onKeyframesResolved(G,te,L,!re),v,A,P),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,r,o){this.keyframeResolver=void 0;const{name:c,type:d,velocity:a,delay:v,isHandoff:A,onUpdate:P}=r;this.resolvedAt=wo.now(),KR(e,c,d,a)||((Eu.instantAnimations||!v)&&P?.(jx(e,r,t)),e[0]=e[e.length-1],R0(r),r.repeat=0);const L={startTime:o?this.resolvedAt?this.resolvedAt-this.createdAt>tk?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...r,keyframes:e},z=!A&&ek(L)?new GR({...L,element:L.motionValue.owner.current}):new Wx(L);z.finished.then(()=>this.notifyFinished()).catch(Ma),this.pendingTimeline&&(this.stopTimeline=z.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=z}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),BR()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const rk=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function ik(n){const e=rk.exec(n);if(!e)return[,];const[,t,r,o]=e;return[`--${t??r}`,o]}function qA(n,e,t=1){const[r,o]=ik(n);if(!r)return;const c=window.getComputedStyle(e).getPropertyValue(r);if(c){const d=c.trim();return gA(d)?parseFloat(d):d}return Nx(o)?qA(o,e,t+1):o}function Zx(n,e){return n?.[e]??n?.default??n}const GA=new Set(["width","height","top","left","right","bottom",...Rp]),sk={test:n=>n==="auto",parse:n=>n},YA=n=>e=>e.test(n),KA=[Mp,wn,Ec,gh,YM,GM,sk],m1=n=>KA.find(YA(n));function ok(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||yA(n):!0}const ak=new Set(["brightness","contrast","saturate","opacity"]);function lk(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[r]=t.match(Bx)||[];if(!r)return n;const o=t.replace(r,"");let c=ak.has(e)?1:0;return r!==t&&(c*=100),e+"("+c+o+")"}const ck=/\b([a-z-]*)\(.*?\)/gu,k0={...Ch,getAnimatableNone:n=>{const e=n.match(ck);return e?e.map(lk).join(" "):n}},g1={...Mp,transform:Math.round},uk={rotate:gh,rotateX:gh,rotateY:gh,rotateZ:gh,scale:t_,scaleX:t_,scaleY:t_,scaleZ:t_,skew:gh,skewX:gh,skewY:gh,distance:wn,translateX:wn,translateY:wn,translateZ:wn,x:wn,y:wn,z:wn,perspective:wn,transformPerspective:wn,opacity:Km,originX:r1,originY:r1,originZ:wn},Xx={borderWidth:wn,borderTopWidth:wn,borderRightWidth:wn,borderBottomWidth:wn,borderLeftWidth:wn,borderRadius:wn,radius:wn,borderTopLeftRadius:wn,borderTopRightRadius:wn,borderBottomRightRadius:wn,borderBottomLeftRadius:wn,width:wn,maxWidth:wn,height:wn,maxHeight:wn,top:wn,right:wn,bottom:wn,left:wn,padding:wn,paddingTop:wn,paddingRight:wn,paddingBottom:wn,paddingLeft:wn,margin:wn,marginTop:wn,marginRight:wn,marginBottom:wn,marginLeft:wn,backgroundPositionX:wn,backgroundPositionY:wn,...uk,zIndex:g1,fillOpacity:Km,strokeOpacity:Km,numOctaves:g1},hk={...Xx,color:Mi,backgroundColor:Mi,outlineColor:Mi,fill:Mi,stroke:Mi,borderColor:Mi,borderTopColor:Mi,borderRightColor:Mi,borderBottomColor:Mi,borderLeftColor:Mi,filter:k0,WebkitFilter:k0},JA=n=>hk[n];function QA(n,e){let t=JA(n);return t!==k0&&(t=Ch),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const dk=new Set(["auto","none","0"]);function fk(n,e,t){let r=0,o;for(;r<n.length&&!o;){const c=n[r];typeof c=="string"&&!dk.has(c)&&Jm(c).values.length&&(o=n[r]),r++}if(o&&t)for(const c of e)n[c]=QA(t,o)}class pk extends Hx{constructor(e,t,r,o,c){super(e,t,r,o,c,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let v=0;v<e.length;v++){let A=e[v];if(typeof A=="string"&&(A=A.trim(),Nx(A))){const P=qA(A,t.current);P!==void 0&&(e[v]=P),v===e.length-1&&(this.finalKeyframe=A)}}if(this.resolveNoneKeyframes(),!GA.has(r)||e.length!==2)return;const[o,c]=e,d=m1(o),a=m1(c);if(d!==a)if(h1(d)&&h1(a))for(let v=0;v<e.length;v++){const A=e[v];typeof A=="string"&&(e[v]=parseFloat(A))}else Ld[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,r=[];for(let o=0;o<e.length;o++)(e[o]===null||ok(e[o]))&&r.push(o);r.length&&fk(e,r,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ld[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const o=t[t.length-1];o!==void 0&&e.getValue(r,o).jump(o,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const o=e.getValue(t);o&&o.jump(this.measuredOrigin,!1);const c=r.length-1,d=r[c];r[c]=Ld[t](e.measureViewportBox(),window.getComputedStyle(e.current)),d!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=d),this.removedTransforms?.length&&this.removedTransforms.forEach(([a,v])=>{e.getValue(a).set(v)}),this.resolveNoneKeyframes()}}function mk(n,e,t){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let r=document;const o=t?.[n]??r.querySelectorAll(n);return o?Array.from(o):[]}return Array.from(n)}const eP=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function tP(n){return _A(n)&&"offsetHeight"in n}const _1=30,gk=n=>!isNaN(parseFloat(n));class _k{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{const o=wo.now();if(this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const c of this.dependents)c.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=wo.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=gk(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Dx);const r=this.events[e].add(t);return e==="change"?()=>{r(),$r.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=wo.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>_1)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,_1);return vA(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function pp(n,e){return new _k(n,e)}const{schedule:qx}=MA(queueMicrotask,!1),Sl={x:!1,y:!1};function nP(){return Sl.x||Sl.y}function yk(n){return n==="x"||n==="y"?Sl[n]?null:(Sl[n]=!0,()=>{Sl[n]=!1}):Sl.x||Sl.y?null:(Sl.x=Sl.y=!0,()=>{Sl.x=Sl.y=!1})}function rP(n,e){const t=mk(n),r=new AbortController,o={passive:!0,...e,signal:r.signal};return[t,o,()=>r.abort()]}function y1(n){return!(n.pointerType==="touch"||nP())}function vk(n,e,t={}){const[r,o,c]=rP(n,t),d=a=>{if(!y1(a))return;const{target:v}=a,A=e(v,a);if(typeof A!="function"||!v)return;const P=k=>{y1(k)&&(A(k),v.removeEventListener("pointerleave",P))};v.addEventListener("pointerleave",P,o)};return r.forEach(a=>{a.addEventListener("pointerenter",d,o)}),c}const iP=(n,e)=>e?n===e?!0:iP(n,e.parentElement):!1,Gx=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,xk=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function bk(n){return xk.has(n.tagName)||n.tabIndex!==-1}const A_=new WeakSet;function v1(n){return e=>{e.key==="Enter"&&n(e)}}function Tv(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const wk=(n,e)=>{const t=n.currentTarget;if(!t)return;const r=v1(()=>{if(A_.has(t))return;Tv(t,"down");const o=v1(()=>{Tv(t,"up")}),c=()=>Tv(t,"cancel");t.addEventListener("keyup",o,e),t.addEventListener("blur",c,e)});t.addEventListener("keydown",r,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",r),e)};function x1(n){return Gx(n)&&!nP()}function Tk(n,e,t={}){const[r,o,c]=rP(n,t),d=a=>{const v=a.currentTarget;if(!x1(a))return;A_.add(v);const A=e(v,a),P=(z,G)=>{window.removeEventListener("pointerup",k),window.removeEventListener("pointercancel",L),A_.has(v)&&A_.delete(v),x1(z)&&typeof A=="function"&&A(z,{success:G})},k=z=>{P(z,v===window||v===document||t.useGlobalTarget||iP(v,z.target))},L=z=>{P(z,!1)};window.addEventListener("pointerup",k,o),window.addEventListener("pointercancel",L,o)};return r.forEach(a=>{(t.useGlobalTarget?window:a).addEventListener("pointerdown",d,o),tP(a)&&(a.addEventListener("focus",A=>wk(A,o)),!bk(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),c}function sP(n){return _A(n)&&"ownerSVGElement"in n}function Sk(n){return sP(n)&&n.tagName==="svg"}const zs=n=>!!(n&&n.getVelocity),Ak=[...KA,Mi,Ch],Pk=n=>Ak.find(YA(n)),Yx=Ae.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function b1(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function Ek(...n){return e=>{let t=!1;const r=n.map(o=>{const c=b1(o,e);return!t&&typeof c=="function"&&(t=!0),c});if(t)return()=>{for(let o=0;o<r.length;o++){const c=r[o];typeof c=="function"?c():b1(n[o],null)}}}}function Ck(...n){return Ae.useCallback(Ek(...n),n)}class Ik extends Ae.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const r=t.offsetParent,o=tP(r)&&r.offsetWidth||0,c=this.props.sizeRef.current;c.height=t.offsetHeight||0,c.width=t.offsetWidth||0,c.top=t.offsetTop,c.left=t.offsetLeft,c.right=o-c.width-c.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Mk({children:n,isPresent:e,anchorX:t,root:r}){const o=Ae.useId(),c=Ae.useRef(null),d=Ae.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=Ae.useContext(Yx),v=Ck(c,n?.ref);return Ae.useInsertionEffect(()=>{const{width:A,height:P,top:k,left:L,right:z}=d.current;if(e||!c.current||!A||!P)return;const G=t==="left"?`left: ${L}`:`right: ${z}`;c.current.dataset.motionPopId=o;const te=document.createElement("style");a&&(te.nonce=a);const re=r??document.head;return re.appendChild(te),te.sheet&&te.sheet.insertRule(`
          [data-motion-pop-id="${o}"] {
            position: absolute !important;
            width: ${A}px !important;
            height: ${P}px !important;
            ${G}px !important;
            top: ${k}px !important;
          }
        `),()=>{re.contains(te)&&re.removeChild(te)}},[e]),Pe.jsx(Ik,{isPresent:e,childRef:c,sizeRef:d,children:Ae.cloneElement(n,{ref:v})})}const Rk=({children:n,initial:e,isPresent:t,onExitComplete:r,custom:o,presenceAffectsLayout:c,mode:d,anchorX:a,root:v})=>{const A=Ex(kk),P=Ae.useId();let k=!0,L=Ae.useMemo(()=>(k=!1,{id:P,initial:e,isPresent:t,custom:o,onExitComplete:z=>{A.set(z,!0);for(const G of A.values())if(!G)return;r&&r()},register:z=>(A.set(z,!1),()=>A.delete(z))}),[t,A,r]);return c&&k&&(L={...L}),Ae.useMemo(()=>{A.forEach((z,G)=>A.set(G,!1))},[t]),Ae.useEffect(()=>{!t&&!A.size&&r&&r()},[t]),d==="popLayout"&&(n=Pe.jsx(Mk,{isPresent:t,anchorX:a,root:v,children:n})),Pe.jsx(_y.Provider,{value:L,children:n})};function kk(){return new Map}function oP(n=!0){const e=Ae.useContext(_y);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:o}=e,c=Ae.useId();Ae.useEffect(()=>{if(n)return o(c)},[n]);const d=Ae.useCallback(()=>n&&r&&r(c),[c,r,n]);return!t&&r?[!1,d]:[!0]}const n_=n=>n.key||"";function w1(n){const e=[];return Ae.Children.forEach(n,t=>{Ae.isValidElement(t)&&e.push(t)}),e}const aP=({children:n,custom:e,initial:t=!0,onExitComplete:r,presenceAffectsLayout:o=!0,mode:c="sync",propagate:d=!1,anchorX:a="left",root:v})=>{const[A,P]=oP(d),k=Ae.useMemo(()=>w1(n),[n]),L=d&&!A?[]:k.map(n_),z=Ae.useRef(!0),G=Ae.useRef(k),te=Ex(()=>new Map),[re,fe]=Ae.useState(k),[ve,le]=Ae.useState(k);mA(()=>{z.current=!1,G.current=k;for(let nt=0;nt<ve.length;nt++){const pt=n_(ve[nt]);L.includes(pt)?te.delete(pt):te.get(pt)!==!0&&te.set(pt,!1)}},[ve,L.length,L.join("-")]);const Se=[];if(k!==re){let nt=[...k];for(let pt=0;pt<ve.length;pt++){const mt=ve[pt],Tt=n_(mt);L.includes(Tt)||(nt.splice(pt,0,mt),Se.push(mt))}return c==="wait"&&Se.length&&(nt=Se),le(w1(nt)),fe(k),null}const{forceRender:Ne}=Ae.useContext(Px);return Pe.jsx(Pe.Fragment,{children:ve.map(nt=>{const pt=n_(nt),mt=d&&!A?!1:k===ve||L.includes(pt),Tt=()=>{if(te.has(pt))te.set(pt,!0);else return;let Mt=!0;te.forEach(Zt=>{Zt||(Mt=!1)}),Mt&&(Ne?.(),le(G.current),d&&P?.(),r&&r())};return Pe.jsx(Rk,{isPresent:mt,initial:!z.current||t?void 0:!1,custom:e,presenceAffectsLayout:o,mode:c,root:v,onExitComplete:mt?void 0:Tt,anchorX:a,children:nt},pt)})})},lP=Ae.createContext({strict:!1}),T1={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},mp={};for(const n in T1)mp[n]={isEnabled:e=>T1[n].some(t=>!!e[t])};function Dk(n){for(const e in n)mp[e]={...mp[e],...n[e]}}const Ok=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function j_(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||Ok.has(n)}let cP=n=>!j_(n);function Lk(n){typeof n=="function"&&(cP=e=>e.startsWith("on")?!j_(e):n(e))}try{Lk(require("@emotion/is-prop-valid").default)}catch{}function Fk(n,e,t){const r={};for(const o in n)o==="values"&&typeof n.values=="object"||(cP(o)||t===!0&&j_(o)||!e&&!j_(o)||n.draggable&&o.startsWith("onDrag"))&&(r[o]=n[o]);return r}const yy=Ae.createContext({});function vy(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function Qm(n){return typeof n=="string"||Array.isArray(n)}const Kx=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Jx=["initial",...Kx];function xy(n){return vy(n.animate)||Jx.some(e=>Qm(n[e]))}function uP(n){return!!(xy(n)||n.variants)}function Nk(n,e){if(xy(n)){const{initial:t,animate:r}=n;return{initial:t===!1||Qm(t)?t:void 0,animate:Qm(r)?r:void 0}}return n.inherit!==!1?e:{}}function Bk(n){const{initial:e,animate:t}=Nk(n,Ae.useContext(yy));return Ae.useMemo(()=>({initial:e,animate:t}),[S1(e),S1(t)])}function S1(n){return Array.isArray(n)?n.join(" "):n}const eg={};function zk(n){for(const e in n)eg[e]=n[e],Fx(e)&&(eg[e].isCSSVariable=!0)}function hP(n,{layout:e,layoutId:t}){return kp.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!eg[n]||n==="opacity")}const Uk={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Vk=Rp.length;function jk(n,e,t){let r="",o=!0;for(let c=0;c<Vk;c++){const d=Rp[c],a=n[d];if(a===void 0)continue;let v=!0;if(typeof a=="number"?v=a===(d.startsWith("scale")?1:0):v=parseFloat(a)===0,!v||t){const A=eP(a,Xx[d]);if(!v){o=!1;const P=Uk[d]||d;r+=`${P}(${A}) `}t&&(e[d]=A)}}return r=r.trim(),t?r=t(e,o?"":r):o&&(r="none"),r}function Qx(n,e,t){const{style:r,vars:o,transformOrigin:c}=n;let d=!1,a=!1;for(const v in e){const A=e[v];if(kp.has(v)){d=!0;continue}else if(Fx(v)){o[v]=A;continue}else{const P=eP(A,Xx[v]);v.startsWith("origin")?(a=!0,c[v]=P):r[v]=P}}if(e.transform||(d||t?r.transform=jk(e,n.transform,t):r.transform&&(r.transform="none")),a){const{originX:v="50%",originY:A="50%",originZ:P=0}=c;r.transformOrigin=`${v} ${A} ${P}`}}const eb=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function dP(n,e,t){for(const r in e)!zs(e[r])&&!hP(r,t)&&(n[r]=e[r])}function $k({transformTemplate:n},e){return Ae.useMemo(()=>{const t=eb();return Qx(t,e,n),Object.assign({},t.vars,t.style)},[e])}function Wk(n,e){const t=n.style||{},r={};return dP(r,t,n),Object.assign(r,$k(n,e)),r}function Hk(n,e){const t={},r=Wk(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=r,t}const Zk={offset:"stroke-dashoffset",array:"stroke-dasharray"},Xk={offset:"strokeDashoffset",array:"strokeDasharray"};function qk(n,e,t=1,r=0,o=!0){n.pathLength=1;const c=o?Zk:Xk;n[c.offset]=wn.transform(-r);const d=wn.transform(e),a=wn.transform(t);n[c.array]=`${d} ${a}`}function fP(n,{attrX:e,attrY:t,attrScale:r,pathLength:o,pathSpacing:c=1,pathOffset:d=0,...a},v,A,P){if(Qx(n,a,A),v){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:k,style:L}=n;k.transform&&(L.transform=k.transform,delete k.transform),(L.transform||k.transformOrigin)&&(L.transformOrigin=k.transformOrigin??"50% 50%",delete k.transformOrigin),L.transform&&(L.transformBox=P?.transformBox??"fill-box",delete k.transformBox),e!==void 0&&(k.x=e),t!==void 0&&(k.y=t),r!==void 0&&(k.scale=r),o!==void 0&&qk(k,o,c,d,!1)}const pP=()=>({...eb(),attrs:{}}),mP=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Gk(n,e,t,r){const o=Ae.useMemo(()=>{const c=pP();return fP(c,e,mP(r),n.transformTemplate,n.style),{...c.attrs,style:{...c.style}}},[e]);if(n.style){const c={};dP(c,n.style,n),o.style={...c,...o.style}}return o}const Yk=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function tb(n){return typeof n!="string"||n.includes("-")?!1:!!(Yk.indexOf(n)>-1||/[A-Z]/u.test(n))}function Kk(n,e,t,{latestValues:r},o,c=!1){const a=(tb(n)?Gk:Hk)(e,r,o,n),v=Fk(e,typeof n=="string",c),A=n!==Ae.Fragment?{...v,...a,ref:t}:{},{children:P}=e,k=Ae.useMemo(()=>zs(P)?P.get():P,[P]);return Ae.createElement(n,{...A,children:k})}function A1(n){const e=[{},{}];return n?.values.forEach((t,r)=>{e[0][r]=t.get(),e[1][r]=t.getVelocity()}),e}function nb(n,e,t,r){if(typeof e=="function"){const[o,c]=A1(r);e=e(t!==void 0?t:n.custom,o,c)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[o,c]=A1(r);e=e(t!==void 0?t:n.custom,o,c)}return e}function P_(n){return zs(n)?n.get():n}function Jk({scrapeMotionValuesFromProps:n,createRenderState:e},t,r,o){return{latestValues:Qk(t,r,o,n),renderState:e()}}function Qk(n,e,t,r){const o={},c=r(n,{});for(const L in c)o[L]=P_(c[L]);let{initial:d,animate:a}=n;const v=xy(n),A=uP(n);e&&A&&!v&&n.inherit!==!1&&(d===void 0&&(d=e.initial),a===void 0&&(a=e.animate));let P=t?t.initial===!1:!1;P=P||d===!1;const k=P?a:d;if(k&&typeof k!="boolean"&&!vy(k)){const L=Array.isArray(k)?k:[k];for(let z=0;z<L.length;z++){const G=nb(n,L[z]);if(G){const{transitionEnd:te,transition:re,...fe}=G;for(const ve in fe){let le=fe[ve];if(Array.isArray(le)){const Se=P?le.length-1:0;le=le[Se]}le!==null&&(o[ve]=le)}for(const ve in te)o[ve]=te[ve]}}}return o}const gP=n=>(e,t)=>{const r=Ae.useContext(yy),o=Ae.useContext(_y),c=()=>Jk(n,e,r,o);return t?c():Ex(c)};function rb(n,e,t){const{style:r}=n,o={};for(const c in r)(zs(r[c])||e.style&&zs(e.style[c])||hP(c,n)||t?.getValue(c)?.liveStyle!==void 0)&&(o[c]=r[c]);return o}const eD=gP({scrapeMotionValuesFromProps:rb,createRenderState:eb});function _P(n,e,t){const r=rb(n,e,t);for(const o in n)if(zs(n[o])||zs(e[o])){const c=Rp.indexOf(o)!==-1?"attr"+o.charAt(0).toUpperCase()+o.substring(1):o;r[c]=n[o]}return r}const tD=gP({scrapeMotionValuesFromProps:_P,createRenderState:pP}),nD=Symbol.for("motionComponentSymbol");function ep(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function rD(n,e,t){return Ae.useCallback(r=>{r&&n.onMount&&n.onMount(r),e&&(r?e.mount(r):e.unmount()),t&&(typeof t=="function"?t(r):ep(t)&&(t.current=r))},[e])}const ib=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),iD="framerAppearId",yP="data-"+ib(iD),vP=Ae.createContext({});function sD(n,e,t,r,o){const{visualElement:c}=Ae.useContext(yy),d=Ae.useContext(lP),a=Ae.useContext(_y),v=Ae.useContext(Yx).reducedMotion,A=Ae.useRef(null);r=r||d.renderer,!A.current&&r&&(A.current=r(n,{visualState:e,parent:c,props:t,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:v}));const P=A.current,k=Ae.useContext(vP);P&&!P.projection&&o&&(P.type==="html"||P.type==="svg")&&oD(A.current,t,o,k);const L=Ae.useRef(!1);Ae.useInsertionEffect(()=>{P&&L.current&&P.update(t,a)});const z=t[yP],G=Ae.useRef(!!z&&!window.MotionHandoffIsComplete?.(z)&&window.MotionHasOptimisedAnimation?.(z));return mA(()=>{P&&(L.current=!0,window.MotionIsMounted=!0,P.updateFeatures(),P.scheduleRenderMicrotask(),G.current&&P.animationState&&P.animationState.animateChanges())}),Ae.useEffect(()=>{P&&(!G.current&&P.animationState&&P.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(z)}),G.current=!1),P.enteringChildren=void 0)}),P}function oD(n,e,t,r){const{layoutId:o,layout:c,drag:d,dragConstraints:a,layoutScroll:v,layoutRoot:A,layoutCrossfade:P}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:xP(n.parent)),n.projection.setOptions({layoutId:o,layout:c,alwaysMeasureLayout:!!d||a&&ep(a),visualElement:n,animationType:typeof c=="string"?c:"both",initialPromotionConfig:r,crossfade:P,layoutScroll:v,layoutRoot:A})}function xP(n){if(n)return n.options.allowProjection!==!1?n.projection:xP(n.parent)}function Sv(n,{forwardMotionProps:e=!1}={},t,r){t&&Dk(t);const o=tb(n)?tD:eD;function c(a,v){let A;const P={...Ae.useContext(Yx),...a,layoutId:aD(a)},{isStatic:k}=P,L=Bk(a),z=o(a,k);if(!k&&Cx){lD();const G=cD(P);A=G.MeasureLayout,L.visualElement=sD(n,z,P,r,G.ProjectionNode)}return Pe.jsxs(yy.Provider,{value:L,children:[A&&L.visualElement?Pe.jsx(A,{visualElement:L.visualElement,...P}):null,Kk(n,a,rD(z,L.visualElement,v),z,k,e)]})}c.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const d=Ae.forwardRef(c);return d[nD]=n,d}function aD({layoutId:n}){const e=Ae.useContext(Px).id;return e&&n!==void 0?e+"-"+n:n}function lD(n,e){Ae.useContext(lP).strict}function cD(n){const{drag:e,layout:t}=mp;if(!e&&!t)return{};const r={...e,...t};return{MeasureLayout:e?.isEnabled(n)||t?.isEnabled(n)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function uD(n,e){if(typeof Proxy>"u")return Sv;const t=new Map,r=(c,d)=>Sv(c,d,n,e),o=(c,d)=>r(c,d);return new Proxy(o,{get:(c,d)=>d==="create"?r:(t.has(d)||t.set(d,Sv(d,void 0,n,e)),t.get(d))})}function bP({top:n,left:e,right:t,bottom:r}){return{x:{min:e,max:t},y:{min:n,max:r}}}function hD({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function dD(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),r=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}function Av(n){return n===void 0||n===1}function D0({scale:n,scaleX:e,scaleY:t}){return!Av(n)||!Av(e)||!Av(t)}function Ed(n){return D0(n)||wP(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function wP(n){return P1(n.x)||P1(n.y)}function P1(n){return n&&n!=="0%"}function $_(n,e,t){const r=n-t,o=e*r;return t+o}function E1(n,e,t,r,o){return o!==void 0&&(n=$_(n,o,r)),$_(n,t,r)+e}function O0(n,e=0,t=1,r,o){n.min=E1(n.min,e,t,r,o),n.max=E1(n.max,e,t,r,o)}function TP(n,{x:e,y:t}){O0(n.x,e.translate,e.scale,e.originPoint),O0(n.y,t.translate,t.scale,t.originPoint)}const C1=.999999999999,I1=1.0000000000001;function fD(n,e,t,r=!1){const o=t.length;if(!o)return;e.x=e.y=1;let c,d;for(let a=0;a<o;a++){c=t[a],d=c.projectionDelta;const{visualElement:v}=c.options;v&&v.props.style&&v.props.style.display==="contents"||(r&&c.options.layoutScroll&&c.scroll&&c!==c.root&&np(n,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),d&&(e.x*=d.x.scale,e.y*=d.y.scale,TP(n,d)),r&&Ed(c.latestValues)&&np(n,c.latestValues))}e.x<I1&&e.x>C1&&(e.x=1),e.y<I1&&e.y>C1&&(e.y=1)}function tp(n,e){n.min=n.min+e,n.max=n.max+e}function M1(n,e,t,r,o=.5){const c=Gr(n.min,n.max,o);O0(n,e,t,c,r)}function np(n,e){M1(n.x,e.x,e.scaleX,e.scale,e.originX),M1(n.y,e.y,e.scaleY,e.scale,e.originY)}function SP(n,e){return bP(dD(n.getBoundingClientRect(),e))}function pD(n,e,t){const r=SP(n,t),{scroll:o}=e;return o&&(tp(r.x,o.offset.x),tp(r.y,o.offset.y)),r}const R1=()=>({translate:0,scale:1,origin:0,originPoint:0}),rp=()=>({x:R1(),y:R1()}),k1=()=>({min:0,max:0}),pi=()=>({x:k1(),y:k1()}),L0={current:null},AP={current:!1};function mD(){if(AP.current=!0,!!Cx)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>L0.current=n.matches;n.addEventListener("change",e),e()}else L0.current=!1}const gD=new WeakMap;function _D(n,e,t){for(const r in e){const o=e[r],c=t[r];if(zs(o))n.addValue(r,o);else if(zs(c))n.addValue(r,pp(o,{owner:n}));else if(c!==o)if(n.hasValue(r)){const d=n.getValue(r);d.liveStyle===!0?d.jump(o):d.hasAnimated||d.set(o)}else{const d=n.getStaticValue(r);n.addValue(r,pp(d!==void 0?d:o,{owner:n}))}}for(const r in t)e[r]===void 0&&n.removeValue(r);return e}const D1=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class yD{scrapeMotionValuesFromProps(e,t,r){return{}}constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:o,blockInitialAnimation:c,visualState:d},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Hx,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=wo.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,$r.render(this.render,!1,!0))};const{latestValues:v,renderState:A}=d;this.latestValues=v,this.baseTarget={...v},this.initialValues=t.initial?{...v}:{},this.renderState=A,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=o,this.options=a,this.blockInitialAnimation=!!c,this.isControllingVariants=xy(t),this.isVariantNode=uP(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:P,...k}=this.scrapeMotionValuesFromProps(t,{},this);for(const L in k){const z=k[L];v[L]!==void 0&&zs(z)&&z.set(v[L])}}mount(e){this.current=e,gD.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,r)=>this.bindToMotionValue(r,t)),AP.current||mD(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:L0.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Eh(this.notifyUpdate),Eh(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=kp.has(e);r&&this.onBindTransform&&this.onBindTransform();const o=t.on("change",d=>{this.latestValues[e]=d,this.props.onUpdate&&$r.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let c;window.MotionCheckAppearSync&&(c=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{o(),c&&c(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in mp){const t=mp[e];if(!t)continue;const{isEnabled:r,Feature:o}=t;if(!this.features[e]&&o&&r(this.props)&&(this.features[e]=new o(this)),this.features[e]){const c=this.features[e];c.isMounted?c.update():(c.mount(),c.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):pi()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<D1.length;r++){const o=D1[r];this.propEventSubscriptions[o]&&(this.propEventSubscriptions[o](),delete this.propEventSubscriptions[o]);const c="on"+o,d=e[c];d&&(this.propEventSubscriptions[o]=this.on(o,d))}this.prevMotionValues=_D(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&t!==void 0&&(r=pp(t===null?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(gA(r)||yA(r))?r=parseFloat(r):!Pk(r)&&Ch.test(t)&&(r=QA(e,t)),this.setBaseTarget(e,zs(r)?r.get():r)),zs(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let r;if(typeof t=="string"||typeof t=="object"){const c=nb(this.props,t,this.presenceContext?.custom);c&&(r=c[e])}if(t&&r!==void 0)return r;const o=this.getBaseTargetFromProps(this.props,e);return o!==void 0&&!zs(o)?o:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new Dx),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){qx.render(this.render)}}class PP extends yD{constructor(){super(...arguments),this.KeyframeResolver=pk}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;zs(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function EP(n,{style:e,vars:t},r,o){const c=n.style;let d;for(d in e)c[d]=e[d];o?.applyProjectionStyles(c,r);for(d in t)c.setProperty(d,t[d])}function vD(n){return window.getComputedStyle(n)}class xD extends PP{constructor(){super(...arguments),this.type="html",this.renderInstance=EP}readValueFromInstance(e,t){if(kp.has(t))return this.projection?.isProjecting?P0(t):DR(e,t);{const r=vD(e),o=(Fx(t)?r.getPropertyValue(t):r[t])||0;return typeof o=="string"?o.trim():o}}measureInstanceViewportBox(e,{transformPagePoint:t}){return SP(e,t)}build(e,t,r){Qx(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return rb(e,t,r)}}const CP=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function bD(n,e,t,r){EP(n,e,void 0,r);for(const o in e.attrs)n.setAttribute(CP.has(o)?o:ib(o),e.attrs[o])}class wD extends PP{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=pi}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(kp.has(t)){const r=JA(t);return r&&r.default||0}return t=CP.has(t)?t:ib(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return _P(e,t,r)}build(e,t,r){fP(e,t,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,t,r,o){bD(e,t,r,o)}mount(e){this.isSVGTag=mP(e.tagName),super.mount(e)}}const TD=(n,e)=>tb(n)?new wD(e):new xD(e,{allowProjection:n!==Ae.Fragment});function hp(n,e,t){const r=n.getProps();return nb(r,e,t!==void 0?t:r.custom,n)}const F0=n=>Array.isArray(n);function SD(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,pp(t))}function AD(n){return F0(n)?n[n.length-1]||0:n}function PD(n,e){const t=hp(n,e);let{transitionEnd:r={},transition:o={},...c}=t||{};c={...c,...r};for(const d in c){const a=AD(c[d]);SD(n,d,a)}}function ED(n){return!!(zs(n)&&n.add)}function N0(n,e){const t=n.getValue("willChange");if(ED(t))return t.add(e);if(!t&&Eu.WillChange){const r=new Eu.WillChange("auto");n.addValue("willChange",r),r.add(e)}}function IP(n){return n.props[yP]}const CD=n=>n!==null;function ID(n,{repeat:e,repeatType:t="loop"},r){const o=n.filter(CD),c=e&&t!=="loop"&&e%2===1?0:o.length-1;return o[c]}const MD={type:"spring",stiffness:500,damping:25,restSpeed:10},RD=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),kD={type:"keyframes",duration:.8},DD={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},OD=(n,{keyframes:e})=>e.length>2?kD:kp.has(n)?n.startsWith("scale")?RD(e[1]):MD:DD;function LD({when:n,delay:e,delayChildren:t,staggerChildren:r,staggerDirection:o,repeat:c,repeatType:d,repeatDelay:a,from:v,elapsed:A,...P}){return!!Object.keys(P).length}const sb=(n,e,t,r={},o,c)=>d=>{const a=Zx(r,n)||{},v=a.delay||r.delay||0;let{elapsed:A=0}=r;A=A-Pc(v);const P={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-A,onUpdate:L=>{e.set(L),a.onUpdate&&a.onUpdate(L)},onComplete:()=>{d(),a.onComplete&&a.onComplete()},name:n,motionValue:e,element:c?void 0:o};LD(a)||Object.assign(P,OD(n,P)),P.duration&&(P.duration=Pc(P.duration)),P.repeatDelay&&(P.repeatDelay=Pc(P.repeatDelay)),P.from!==void 0&&(P.keyframes[0]=P.from);let k=!1;if((P.type===!1||P.duration===0&&!P.repeatDelay)&&(R0(P),P.delay===0&&(k=!0)),(Eu.instantAnimations||Eu.skipAnimations)&&(k=!0,R0(P),P.delay=0),P.allowFlatten=!a.type&&!a.ease,k&&!c&&e.get()!==void 0){const L=ID(P.keyframes,a);if(L!==void 0){$r.update(()=>{P.onUpdate(L),P.onComplete()});return}}return a.isSync?new Wx(P):new nk(P)};function FD({protectedKeys:n,needsAnimating:e},t){const r=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,r}function MP(n,e,{delay:t=0,transitionOverride:r,type:o}={}){let{transition:c=n.getDefaultTransition(),transitionEnd:d,...a}=e;r&&(c=r);const v=[],A=o&&n.animationState&&n.animationState.getState()[o];for(const P in a){const k=n.getValue(P,n.latestValues[P]??null),L=a[P];if(L===void 0||A&&FD(A,P))continue;const z={delay:t,...Zx(c||{},P)},G=k.get();if(G!==void 0&&!k.isAnimating&&!Array.isArray(L)&&L===G&&!z.velocity)continue;let te=!1;if(window.MotionHandoffAnimation){const fe=IP(n);if(fe){const ve=window.MotionHandoffAnimation(fe,P,$r);ve!==null&&(z.startTime=ve,te=!0)}}N0(n,P),k.start(sb(P,k,L,n.shouldReduceMotion&&GA.has(P)?{type:!1}:z,n,te));const re=k.animation;re&&v.push(re)}return d&&Promise.all(v).then(()=>{$r.update(()=>{d&&PD(n,d)})}),v}function RP(n,e,t,r=0,o=1){const c=Array.from(n).sort((A,P)=>A.sortNodePosition(P)).indexOf(e),d=n.size,a=(d-1)*r;return typeof t=="function"?t(c,d):o===1?c*r:a-c*r}function B0(n,e,t={}){const r=hp(n,e,t.type==="exit"?n.presenceContext?.custom:void 0);let{transition:o=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(o=t.transitionOverride);const c=r?()=>Promise.all(MP(n,r,t)):()=>Promise.resolve(),d=n.variantChildren&&n.variantChildren.size?(v=0)=>{const{delayChildren:A=0,staggerChildren:P,staggerDirection:k}=o;return ND(n,e,v,A,P,k,t)}:()=>Promise.resolve(),{when:a}=o;if(a){const[v,A]=a==="beforeChildren"?[c,d]:[d,c];return v().then(()=>A())}else return Promise.all([c(),d(t.delay)])}function ND(n,e,t=0,r=0,o=0,c=1,d){const a=[];for(const v of n.variantChildren)v.notify("AnimationStart",e),a.push(B0(v,e,{...d,delay:t+(typeof r=="function"?0:r)+RP(n.variantChildren,v,r,o,c)}).then(()=>v.notify("AnimationComplete",e)));return Promise.all(a)}function BD(n,e,t={}){n.notify("AnimationStart",e);let r;if(Array.isArray(e)){const o=e.map(c=>B0(n,c,t));r=Promise.all(o)}else if(typeof e=="string")r=B0(n,e,t);else{const o=typeof e=="function"?hp(n,e,t.custom):e;r=Promise.all(MP(n,o,t))}return r.then(()=>{n.notify("AnimationComplete",e)})}function kP(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}const zD=Jx.length;function DP(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?DP(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<zD;t++){const r=Jx[t],o=n.props[r];(Qm(o)||o===!1)&&(e[r]=o)}return e}const UD=[...Kx].reverse(),VD=Kx.length;function jD(n){return e=>Promise.all(e.map(({animation:t,options:r})=>BD(n,t,r)))}function $D(n){let e=jD(n),t=O1(),r=!0;const o=v=>(A,P)=>{const k=hp(n,P,v==="exit"?n.presenceContext?.custom:void 0);if(k){const{transition:L,transitionEnd:z,...G}=k;A={...A,...G,...z}}return A};function c(v){e=v(n)}function d(v){const{props:A}=n,P=DP(n.parent)||{},k=[],L=new Set;let z={},G=1/0;for(let re=0;re<VD;re++){const fe=UD[re],ve=t[fe],le=A[fe]!==void 0?A[fe]:P[fe],Se=Qm(le),Ne=fe===v?ve.isActive:null;Ne===!1&&(G=re);let nt=le===P[fe]&&le!==A[fe]&&Se;if(nt&&r&&n.manuallyAnimateOnMount&&(nt=!1),ve.protectedKeys={...z},!ve.isActive&&Ne===null||!le&&!ve.prevProp||vy(le)||typeof le=="boolean")continue;const pt=WD(ve.prevProp,le);let mt=pt||fe===v&&ve.isActive&&!nt&&Se||re>G&&Se,Tt=!1;const Mt=Array.isArray(le)?le:[le];let Zt=Mt.reduce(o(fe),{});Ne===!1&&(Zt={});const{prevResolvedValues:hn={}}=ve,on={...hn,...Zt},nn=Oe=>{mt=!0,L.has(Oe)&&(Tt=!0,L.delete(Oe)),ve.needsAnimating[Oe]=!0;const me=n.getValue(Oe);me&&(me.liveStyle=!1)};for(const Oe in on){const me=Zt[Oe],ze=hn[Oe];if(z.hasOwnProperty(Oe))continue;let $e=!1;F0(me)&&F0(ze)?$e=!kP(me,ze):$e=me!==ze,$e?me!=null?nn(Oe):L.add(Oe):me!==void 0&&L.has(Oe)?nn(Oe):ve.protectedKeys[Oe]=!0}ve.prevProp=le,ve.prevResolvedValues=Zt,ve.isActive&&(z={...z,...Zt}),r&&n.blockInitialAnimation&&(mt=!1);const Rn=nt&&pt;mt&&(!Rn||Tt)&&k.push(...Mt.map(Oe=>{const me={type:fe};if(typeof Oe=="string"&&r&&!Rn&&n.manuallyAnimateOnMount&&n.parent){const{parent:ze}=n,$e=hp(ze,Oe);if(ze.enteringChildren&&$e){const{delayChildren:ue}=$e.transition||{};me.delay=RP(ze.enteringChildren,n,ue)}}return{animation:Oe,options:me}}))}if(L.size){const re={};if(typeof A.initial!="boolean"){const fe=hp(n,Array.isArray(A.initial)?A.initial[0]:A.initial);fe&&fe.transition&&(re.transition=fe.transition)}L.forEach(fe=>{const ve=n.getBaseTarget(fe),le=n.getValue(fe);le&&(le.liveStyle=!0),re[fe]=ve??null}),k.push({animation:re})}let te=!!k.length;return r&&(A.initial===!1||A.initial===A.animate)&&!n.manuallyAnimateOnMount&&(te=!1),r=!1,te?e(k):Promise.resolve()}function a(v,A){if(t[v].isActive===A)return Promise.resolve();n.variantChildren?.forEach(k=>k.animationState?.setActive(v,A)),t[v].isActive=A;const P=d(v);for(const k in t)t[k].protectedKeys={};return P}return{animateChanges:d,setActive:a,setAnimateFunction:c,getState:()=>t,reset:()=>{t=O1(),r=!0}}}function WD(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!kP(e,n):!1}function Sd(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function O1(){return{animate:Sd(!0),whileInView:Sd(),whileHover:Sd(),whileTap:Sd(),whileDrag:Sd(),whileFocus:Sd(),exit:Sd()}}class Rh{constructor(e){this.isMounted=!1,this.node=e}update(){}}class HD extends Rh{constructor(e){super(e),e.animationState||(e.animationState=$D(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();vy(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let ZD=0;class XD extends Rh{constructor(){super(...arguments),this.id=ZD++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const o=this.node.animationState.setActive("exit",!e);t&&!e&&o.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const qD={animation:{Feature:HD},exit:{Feature:XD}};function tg(n,e,t,r={passive:!0}){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t)}function fg(n){return{point:{x:n.pageX,y:n.pageY}}}const GD=n=>e=>Gx(e)&&n(e,fg(e));function Bm(n,e,t,r){return tg(n,e,GD(t),r)}const OP=1e-4,YD=1-OP,KD=1+OP,LP=.01,JD=0-LP,QD=0+LP;function io(n){return n.max-n.min}function eO(n,e,t){return Math.abs(n-e)<=t}function L1(n,e,t,r=.5){n.origin=r,n.originPoint=Gr(e.min,e.max,n.origin),n.scale=io(t)/io(e),n.translate=Gr(t.min,t.max,n.origin)-n.originPoint,(n.scale>=YD&&n.scale<=KD||isNaN(n.scale))&&(n.scale=1),(n.translate>=JD&&n.translate<=QD||isNaN(n.translate))&&(n.translate=0)}function zm(n,e,t,r){L1(n.x,e.x,t.x,r?r.originX:void 0),L1(n.y,e.y,t.y,r?r.originY:void 0)}function F1(n,e,t){n.min=t.min+e.min,n.max=n.min+io(e)}function tO(n,e,t){F1(n.x,e.x,t.x),F1(n.y,e.y,t.y)}function N1(n,e,t){n.min=e.min-t.min,n.max=n.min+io(e)}function Um(n,e,t){N1(n.x,e.x,t.x),N1(n.y,e.y,t.y)}function Ea(n){return[n("x"),n("y")]}const FP=({current:n})=>n?n.ownerDocument.defaultView:null,B1=(n,e)=>Math.abs(n-e);function nO(n,e){const t=B1(n.x,e.x),r=B1(n.y,e.y);return Math.sqrt(t**2+r**2)}class NP{constructor(e,t,{transformPagePoint:r,contextWindow:o=window,dragSnapToOrigin:c=!1,distanceThreshold:d=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=Ev(this.lastMoveEventInfo,this.history),z=this.startEvent!==null,G=nO(L.offset,{x:0,y:0})>=this.distanceThreshold;if(!z&&!G)return;const{point:te}=L,{timestamp:re}=vs;this.history.push({...te,timestamp:re});const{onStart:fe,onMove:ve}=this.handlers;z||(fe&&fe(this.lastMoveEvent,L),this.startEvent=this.lastMoveEvent),ve&&ve(this.lastMoveEvent,L)},this.handlePointerMove=(L,z)=>{this.lastMoveEvent=L,this.lastMoveEventInfo=Pv(z,this.transformPagePoint),$r.update(this.updatePoint,!0)},this.handlePointerUp=(L,z)=>{this.end();const{onEnd:G,onSessionEnd:te,resumeAnimation:re}=this.handlers;if(this.dragSnapToOrigin&&re&&re(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const fe=Ev(L.type==="pointercancel"?this.lastMoveEventInfo:Pv(z,this.transformPagePoint),this.history);this.startEvent&&G&&G(L,fe),te&&te(L,fe)},!Gx(e))return;this.dragSnapToOrigin=c,this.handlers=t,this.transformPagePoint=r,this.distanceThreshold=d,this.contextWindow=o||window;const a=fg(e),v=Pv(a,this.transformPagePoint),{point:A}=v,{timestamp:P}=vs;this.history=[{...A,timestamp:P}];const{onSessionStart:k}=t;k&&k(e,Ev(v,this.history)),this.removeListeners=ug(Bm(this.contextWindow,"pointermove",this.handlePointerMove),Bm(this.contextWindow,"pointerup",this.handlePointerUp),Bm(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Eh(this.updatePoint)}}function Pv(n,e){return e?{point:e(n.point)}:n}function z1(n,e){return{x:n.x-e.x,y:n.y-e.y}}function Ev({point:n},e){return{point:n,delta:z1(n,BP(e)),offset:z1(n,rO(e)),velocity:iO(e,.1)}}function rO(n){return n[0]}function BP(n){return n[n.length-1]}function iO(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,r=null;const o=BP(n);for(;t>=0&&(r=n[t],!(o.timestamp-r.timestamp>Pc(e)));)t--;if(!r)return{x:0,y:0};const c=Ca(o.timestamp-r.timestamp);if(c===0)return{x:0,y:0};const d={x:(o.x-r.x)/c,y:(o.y-r.y)/c};return d.x===1/0&&(d.x=0),d.y===1/0&&(d.y=0),d}function sO(n,{min:e,max:t},r){return e!==void 0&&n<e?n=r?Gr(e,n,r.min):Math.max(n,e):t!==void 0&&n>t&&(n=r?Gr(t,n,r.max):Math.min(n,t)),n}function U1(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function oO(n,{top:e,left:t,bottom:r,right:o}){return{x:U1(n.x,t,o),y:U1(n.y,e,r)}}function V1(n,e){let t=e.min-n.min,r=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,r]=[r,t]),{min:t,max:r}}function aO(n,e){return{x:V1(n.x,e.x),y:V1(n.y,e.y)}}function lO(n,e){let t=.5;const r=io(n),o=io(e);return o>r?t=Ym(e.min,e.max-r,n.min):r>o&&(t=Ym(n.min,n.max-o,e.min)),Pu(0,1,t)}function cO(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const z0=.35;function uO(n=z0){return n===!1?n=0:n===!0&&(n=z0),{x:j1(n,"left","right"),y:j1(n,"top","bottom")}}function j1(n,e,t){return{min:$1(n,e),max:$1(n,t)}}function $1(n,e){return typeof n=="number"?n:n[e]||0}const hO=new WeakMap;class dO{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=pi(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:r}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const c=k=>{const{dragSnapToOrigin:L}=this.getProps();L?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(fg(k).point)},d=(k,L)=>{const{drag:z,dragPropagation:G,onDragStart:te}=this.getProps();if(z&&!G&&(this.openDragLock&&this.openDragLock(),this.openDragLock=yk(z),!this.openDragLock))return;this.latestPointerEvent=k,this.latestPanInfo=L,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ea(fe=>{let ve=this.getAxisMotionValue(fe).get()||0;if(Ec.test(ve)){const{projection:le}=this.visualElement;if(le&&le.layout){const Se=le.layout.layoutBox[fe];Se&&(ve=io(Se)*(parseFloat(ve)/100))}}this.originPoint[fe]=ve}),te&&$r.postRender(()=>te(k,L)),N0(this.visualElement,"transform");const{animationState:re}=this.visualElement;re&&re.setActive("whileDrag",!0)},a=(k,L)=>{this.latestPointerEvent=k,this.latestPanInfo=L;const{dragPropagation:z,dragDirectionLock:G,onDirectionLock:te,onDrag:re}=this.getProps();if(!z&&!this.openDragLock)return;const{offset:fe}=L;if(G&&this.currentDirection===null){this.currentDirection=fO(fe),this.currentDirection!==null&&te&&te(this.currentDirection);return}this.updateAxis("x",L.point,fe),this.updateAxis("y",L.point,fe),this.visualElement.render(),re&&re(k,L)},v=(k,L)=>{this.latestPointerEvent=k,this.latestPanInfo=L,this.stop(k,L),this.latestPointerEvent=null,this.latestPanInfo=null},A=()=>Ea(k=>this.getAnimationState(k)==="paused"&&this.getAxisMotionValue(k).animation?.play()),{dragSnapToOrigin:P}=this.getProps();this.panSession=new NP(e,{onSessionStart:c,onStart:d,onMove:a,onSessionEnd:v,resumeAnimation:A},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:P,distanceThreshold:r,contextWindow:FP(this.visualElement)})}stop(e,t){const r=e||this.latestPointerEvent,o=t||this.latestPanInfo,c=this.isDragging;if(this.cancel(),!c||!o||!r)return;const{velocity:d}=o;this.startAnimation(d);const{onDragEnd:a}=this.getProps();a&&$r.postRender(()=>a(r,o))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:o}=this.getProps();if(!r||!r_(e,o,this.currentDirection))return;const c=this.getAxisMotionValue(e);let d=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(d=sO(d,this.constraints[e],this.elastic[e])),c.set(d)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,o=this.constraints;e&&ep(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=oO(r.layoutBox,e):this.constraints=!1,this.elastic=uO(t),o!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Ea(c=>{this.constraints!==!1&&this.getAxisMotionValue(c)&&(this.constraints[c]=cO(r.layoutBox[c],this.constraints[c]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!ep(e))return!1;const r=e.current,{projection:o}=this.visualElement;if(!o||!o.layout)return!1;const c=pD(r,o.root,this.visualElement.getTransformPagePoint());let d=aO(o.layout.layoutBox,c);if(t){const a=t(hD(d));this.hasMutatedConstraints=!!a,a&&(d=bP(a))}return d}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:o,dragTransition:c,dragSnapToOrigin:d,onDragTransitionEnd:a}=this.getProps(),v=this.constraints||{},A=Ea(P=>{if(!r_(P,t,this.currentDirection))return;let k=v&&v[P]||{};d&&(k={min:0,max:0});const L=o?200:1e6,z=o?40:1e7,G={type:"inertia",velocity:r?e[P]:0,bounceStiffness:L,bounceDamping:z,timeConstant:750,restDelta:1,restSpeed:10,...c,...k};return this.startAxisValueAnimation(P,G)});return Promise.all(A).then(a)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return N0(this.visualElement,e),r.start(sb(e,r,0,t,this.visualElement,!1))}stopAnimation(){Ea(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Ea(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),o=r[t];return o||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){Ea(t=>{const{drag:r}=this.getProps();if(!r_(t,r,this.currentDirection))return;const{projection:o}=this.visualElement,c=this.getAxisMotionValue(t);if(o&&o.layout){const{min:d,max:a}=o.layout.layoutBox[t];c.set(e[t]-Gr(d,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!ep(t)||!r||!this.constraints)return;this.stopAnimation();const o={x:0,y:0};Ea(d=>{const a=this.getAxisMotionValue(d);if(a&&this.constraints!==!1){const v=a.get();o[d]=lO({min:v,max:v},this.constraints[d])}});const{transformTemplate:c}=this.visualElement.getProps();this.visualElement.current.style.transform=c?c({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Ea(d=>{if(!r_(d,e,null))return;const a=this.getAxisMotionValue(d),{min:v,max:A}=this.constraints[d];a.set(Gr(v,A,o[d]))})}addListeners(){if(!this.visualElement.current)return;hO.set(this.visualElement,this);const e=this.visualElement.current,t=Bm(e,"pointerdown",v=>{const{drag:A,dragListener:P=!0}=this.getProps();A&&P&&this.start(v)}),r=()=>{const{dragConstraints:v}=this.getProps();ep(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:o}=this.visualElement,c=o.addEventListener("measure",r);o&&!o.layout&&(o.root&&o.root.updateScroll(),o.updateLayout()),$r.read(r);const d=tg(window,"resize",()=>this.scalePositionWithinConstraints()),a=o.addEventListener("didUpdate",(({delta:v,hasLayoutChanged:A})=>{this.isDragging&&A&&(Ea(P=>{const k=this.getAxisMotionValue(P);k&&(this.originPoint[P]+=v[P].translate,k.set(k.get()+v[P].translate))}),this.visualElement.render())}));return()=>{d(),t(),c(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:o=!1,dragConstraints:c=!1,dragElastic:d=z0,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:o,dragConstraints:c,dragElastic:d,dragMomentum:a}}}function r_(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function fO(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class pO extends Rh{constructor(e){super(e),this.removeGroupControls=Ma,this.removeListeners=Ma,this.controls=new dO(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ma}unmount(){this.removeGroupControls(),this.removeListeners()}}const W1=n=>(e,t)=>{n&&$r.postRender(()=>n(e,t))};class mO extends Rh{constructor(){super(...arguments),this.removePointerDownListener=Ma}onPointerDown(e){this.session=new NP(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:FP(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:o}=this.node.getProps();return{onSessionStart:W1(e),onStart:W1(t),onMove:r,onEnd:(c,d)=>{delete this.session,o&&$r.postRender(()=>o(c,d))}}}mount(){this.removePointerDownListener=Bm(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const E_={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function H1(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Sm={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(wn.test(n))n=parseFloat(n);else return n;const t=H1(n,e.target.x),r=H1(n,e.target.y);return`${t}% ${r}%`}},gO={correct:(n,{treeScale:e,projectionDelta:t})=>{const r=n,o=Ch.parse(n);if(o.length>5)return r;const c=Ch.createTransformer(n),d=typeof o[0]!="number"?1:0,a=t.x.scale*e.x,v=t.y.scale*e.y;o[0+d]/=a,o[1+d]/=v;const A=Gr(a,v,.5);return typeof o[2+d]=="number"&&(o[2+d]/=A),typeof o[3+d]=="number"&&(o[3+d]/=A),c(o)}};let Cv=!1;class _O extends Ae.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:o}=this.props,{projection:c}=e;zk(yO),c&&(t.group&&t.group.add(c),r&&r.register&&o&&r.register(c),Cv&&c.root.didUpdate(),c.addEventListener("animationComplete",()=>{this.safeToRemove()}),c.setOptions({...c.options,onExitComplete:()=>this.safeToRemove()})),E_.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:o,isPresent:c}=this.props,{projection:d}=r;return d&&(d.isPresent=c,Cv=!0,o||e.layoutDependency!==t||t===void 0||e.isPresent!==c?d.willUpdate():this.safeToRemove(),e.isPresent!==c&&(c?d.promote():d.relegate()||$r.postRender(()=>{const a=d.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),qx.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:o}=e;Cv=!0,o&&(o.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(o),r&&r.deregister&&r.deregister(o))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function zP(n){const[e,t]=oP(),r=Ae.useContext(Px);return Pe.jsx(_O,{...n,layoutGroup:r,switchLayoutGroup:Ae.useContext(vP),isPresent:e,safeToRemove:t})}const yO={borderRadius:{...Sm,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Sm,borderTopRightRadius:Sm,borderBottomLeftRadius:Sm,borderBottomRightRadius:Sm,boxShadow:gO};function vO(n,e,t){const r=zs(n)?n:pp(n);return r.start(sb("",r,e,t)),r.animation}const xO=(n,e)=>n.depth-e.depth;class bO{constructor(){this.children=[],this.isDirty=!1}add(e){Ix(this.children,e),this.isDirty=!0}remove(e){Mx(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(xO),this.isDirty=!1,this.children.forEach(e)}}function wO(n,e){const t=wo.now(),r=({timestamp:o})=>{const c=o-t;c>=e&&(Eh(r),n(c-e))};return $r.setup(r,!0),()=>Eh(r)}const UP=["TopLeft","TopRight","BottomLeft","BottomRight"],TO=UP.length,Z1=n=>typeof n=="string"?parseFloat(n):n,X1=n=>typeof n=="number"||wn.test(n);function SO(n,e,t,r,o,c){o?(n.opacity=Gr(0,t.opacity??1,AO(r)),n.opacityExit=Gr(e.opacity??1,0,PO(r))):c&&(n.opacity=Gr(e.opacity??1,t.opacity??1,r));for(let d=0;d<TO;d++){const a=`border${UP[d]}Radius`;let v=q1(e,a),A=q1(t,a);if(v===void 0&&A===void 0)continue;v||(v=0),A||(A=0),v===0||A===0||X1(v)===X1(A)?(n[a]=Math.max(Gr(Z1(v),Z1(A),r),0),(Ec.test(A)||Ec.test(v))&&(n[a]+="%")):n[a]=A}(e.rotate||t.rotate)&&(n.rotate=Gr(e.rotate||0,t.rotate||0,r))}function q1(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const AO=VP(0,.5,PA),PO=VP(.5,.95,Ma);function VP(n,e,t){return r=>r<n?0:r>e?1:t(Ym(n,e,r))}function G1(n,e){n.min=e.min,n.max=e.max}function Pa(n,e){G1(n.x,e.x),G1(n.y,e.y)}function Y1(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function K1(n,e,t,r,o){return n-=e,n=$_(n,1/t,r),o!==void 0&&(n=$_(n,1/o,r)),n}function EO(n,e=0,t=1,r=.5,o,c=n,d=n){if(Ec.test(e)&&(e=parseFloat(e),e=Gr(d.min,d.max,e/100)-d.min),typeof e!="number")return;let a=Gr(c.min,c.max,r);n===c&&(a-=e),n.min=K1(n.min,e,t,a,o),n.max=K1(n.max,e,t,a,o)}function J1(n,e,[t,r,o],c,d){EO(n,e[t],e[r],e[o],e.scale,c,d)}const CO=["x","scaleX","originX"],IO=["y","scaleY","originY"];function Q1(n,e,t,r){J1(n.x,e,CO,t?t.x:void 0,r?r.x:void 0),J1(n.y,e,IO,t?t.y:void 0,r?r.y:void 0)}function eT(n){return n.translate===0&&n.scale===1}function jP(n){return eT(n.x)&&eT(n.y)}function tT(n,e){return n.min===e.min&&n.max===e.max}function MO(n,e){return tT(n.x,e.x)&&tT(n.y,e.y)}function nT(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function $P(n,e){return nT(n.x,e.x)&&nT(n.y,e.y)}function rT(n){return io(n.x)/io(n.y)}function iT(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class RO{constructor(){this.members=[]}add(e){Ix(this.members,e),e.scheduleRender()}remove(e){if(Mx(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(o=>e===o);if(t===0)return!1;let r;for(let o=t;o>=0;o--){const c=this.members[o];if(c.isPresent!==!1){r=c;break}}return r?(this.promote(r),!0):!1}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:o}=e.options;o===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function kO(n,e,t){let r="";const o=n.x.translate/e.x,c=n.y.translate/e.y,d=t?.z||0;if((o||c||d)&&(r=`translate3d(${o}px, ${c}px, ${d}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:A,rotate:P,rotateX:k,rotateY:L,skewX:z,skewY:G}=t;A&&(r=`perspective(${A}px) ${r}`),P&&(r+=`rotate(${P}deg) `),k&&(r+=`rotateX(${k}deg) `),L&&(r+=`rotateY(${L}deg) `),z&&(r+=`skewX(${z}deg) `),G&&(r+=`skewY(${G}deg) `)}const a=n.x.scale*e.x,v=n.y.scale*e.y;return(a!==1||v!==1)&&(r+=`scale(${a}, ${v})`),r||"none"}const Iv=["","X","Y","Z"],DO=1e3;let OO=0;function Mv(n,e,t,r){const{latestValues:o}=e;o[n]&&(t[n]=o[n],e.setStaticValue(n,0),r&&(r[n]=0))}function WP(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=IP(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:o,layoutId:c}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",$r,!(o||c))}const{parent:r}=n;r&&!r.hasCheckedOptimisedAppear&&WP(r)}function HP({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:r,resetTransform:o}){return class{constructor(d={},a=e?.()){this.id=OO++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(NO),this.nodes.forEach(VO),this.nodes.forEach(jO),this.nodes.forEach(BO)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=d,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new bO)}addEventListener(d,a){return this.eventHandlers.has(d)||this.eventHandlers.set(d,new Dx),this.eventHandlers.get(d).add(a)}notifyListeners(d,...a){const v=this.eventHandlers.get(d);v&&v.notify(...a)}hasListeners(d){return this.eventHandlers.has(d)}mount(d){if(this.instance)return;this.isSVG=sP(d)&&!Sk(d),this.instance=d;const{layoutId:a,layout:v,visualElement:A}=this.options;if(A&&!A.current&&A.mount(d),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(v||a)&&(this.isLayoutDirty=!0),n){let P,k=0;const L=()=>this.root.updateBlockedByResize=!1;$r.read(()=>{k=window.innerWidth}),n(d,()=>{const z=window.innerWidth;z!==k&&(k=z,this.root.updateBlockedByResize=!0,P&&P(),P=wO(L,250),E_.hasAnimatedSinceResize&&(E_.hasAnimatedSinceResize=!1,this.nodes.forEach(aT)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&A&&(a||v)&&this.addEventListener("didUpdate",({delta:P,hasLayoutChanged:k,hasRelativeLayoutChanged:L,layout:z})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const G=this.options.transition||A.getDefaultTransition()||XO,{onLayoutAnimationStart:te,onLayoutAnimationComplete:re}=A.getProps(),fe=!this.targetLayout||!$P(this.targetLayout,z),ve=!k&&L;if(this.options.layoutRoot||this.resumeFrom||ve||k&&(fe||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const le={...Zx(G,"layout"),onPlay:te,onComplete:re};(A.shouldReduceMotion||this.options.layoutRoot)&&(le.delay=0,le.type=!1),this.startAnimation(le),this.setAnimationOrigin(P,ve)}else k||aT(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=z})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const d=this.getStack();d&&d.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Eh(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach($O),this.animationId++)}getTransformTemplate(){const{visualElement:d}=this.options;return d&&d.getProps().transformTemplate}willUpdate(d=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&WP(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let P=0;P<this.path.length;P++){const k=this.path[P];k.shouldResetTransform=!0,k.updateScroll("snapshot"),k.options.layoutRoot&&k.willUpdate(!1)}const{layoutId:a,layout:v}=this.options;if(a===void 0&&!v)return;const A=this.getTransformTemplate();this.prevTransformTemplateValue=A?A(this.latestValues,""):void 0,this.updateSnapshot(),d&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(sT);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(oT);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(UO),this.nodes.forEach(LO),this.nodes.forEach(FO)):this.nodes.forEach(oT),this.clearAllSnapshots();const a=wo.now();vs.delta=Pu(0,1e3/60,a-vs.timestamp),vs.timestamp=a,vs.isProcessing=!0,yv.update.process(vs),yv.preRender.process(vs),yv.render.process(vs),vs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,qx.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(zO),this.sharedNodes.forEach(WO)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,$r.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){$r.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!io(this.snapshot.measuredBox.x)&&!io(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const d=this.layout;this.layout=this.measure(!1),this.layoutCorrected=pi(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,d?d.layoutBox:void 0)}updateScroll(d="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===d&&(a=!1),a&&this.instance){const v=r(this.instance);this.scroll={animationId:this.root.animationId,phase:d,isRoot:v,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!o)return;const d=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!jP(this.projectionDelta),v=this.getTransformTemplate(),A=v?v(this.latestValues,""):void 0,P=A!==this.prevTransformTemplateValue;d&&this.instance&&(a||Ed(this.latestValues)||P)&&(o(this.instance,A),this.shouldResetTransform=!1,this.scheduleRender())}measure(d=!0){const a=this.measurePageBox();let v=this.removeElementScroll(a);return d&&(v=this.removeTransform(v)),qO(v),{animationId:this.root.animationId,measuredBox:a,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:d}=this.options;if(!d)return pi();const a=d.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(GO))){const{scroll:A}=this.root;A&&(tp(a.x,A.offset.x),tp(a.y,A.offset.y))}return a}removeElementScroll(d){const a=pi();if(Pa(a,d),this.scroll?.wasRoot)return a;for(let v=0;v<this.path.length;v++){const A=this.path[v],{scroll:P,options:k}=A;A!==this.root&&P&&k.layoutScroll&&(P.wasRoot&&Pa(a,d),tp(a.x,P.offset.x),tp(a.y,P.offset.y))}return a}applyTransform(d,a=!1){const v=pi();Pa(v,d);for(let A=0;A<this.path.length;A++){const P=this.path[A];!a&&P.options.layoutScroll&&P.scroll&&P!==P.root&&np(v,{x:-P.scroll.offset.x,y:-P.scroll.offset.y}),Ed(P.latestValues)&&np(v,P.latestValues)}return Ed(this.latestValues)&&np(v,this.latestValues),v}removeTransform(d){const a=pi();Pa(a,d);for(let v=0;v<this.path.length;v++){const A=this.path[v];if(!A.instance||!Ed(A.latestValues))continue;D0(A.latestValues)&&A.updateSnapshot();const P=pi(),k=A.measurePageBox();Pa(P,k),Q1(a,A.latestValues,A.snapshot?A.snapshot.layoutBox:void 0,P)}return Ed(this.latestValues)&&Q1(a,this.latestValues),a}setTargetDelta(d){this.targetDelta=d,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(d){this.options={...this.options,...d,crossfade:d.crossfade!==void 0?d.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==vs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(d=!1){const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const v=!!this.resumingFrom||this!==a;if(!(d||v&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:P,layoutId:k}=this.options;if(!(!this.layout||!(P||k))){if(this.resolvedRelativeTargetAt=vs.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=pi(),this.relativeTargetOrigin=pi(),Um(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),Pa(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=pi(),this.targetWithTransforms=pi()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),tO(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Pa(this.target,this.layout.layoutBox),TP(this.target,this.targetDelta)):Pa(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=pi(),this.relativeTargetOrigin=pi(),Um(this.relativeTargetOrigin,this.target,L.target),Pa(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||D0(this.parent.latestValues)||wP(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const d=this.getLead(),a=!!this.resumingFrom||this!==d;let v=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(v=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(v=!1),this.resolvedRelativeTargetAt===vs.timestamp&&(v=!1),v)return;const{layout:A,layoutId:P}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(A||P))return;Pa(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,L=this.treeScale.y;fD(this.layoutCorrected,this.treeScale,this.path,a),d.layout&&!d.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(d.target=d.layout.layoutBox,d.targetWithTransforms=pi());const{target:z}=d;if(!z){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Y1(this.prevProjectionDelta.x,this.projectionDelta.x),Y1(this.prevProjectionDelta.y,this.projectionDelta.y)),zm(this.projectionDelta,this.layoutCorrected,z,this.latestValues),(this.treeScale.x!==k||this.treeScale.y!==L||!iT(this.projectionDelta.x,this.prevProjectionDelta.x)||!iT(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",z))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(d=!0){if(this.options.visualElement?.scheduleRender(),d){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=rp(),this.projectionDelta=rp(),this.projectionDeltaWithTransform=rp()}setAnimationOrigin(d,a=!1){const v=this.snapshot,A=v?v.latestValues:{},P={...this.latestValues},k=rp();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const L=pi(),z=v?v.source:void 0,G=this.layout?this.layout.source:void 0,te=z!==G,re=this.getStack(),fe=!re||re.members.length<=1,ve=!!(te&&!fe&&this.options.crossfade===!0&&!this.path.some(ZO));this.animationProgress=0;let le;this.mixTargetDelta=Se=>{const Ne=Se/1e3;lT(k.x,d.x,Ne),lT(k.y,d.y,Ne),this.setTargetDelta(k),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Um(L,this.layout.layoutBox,this.relativeParent.layout.layoutBox),HO(this.relativeTarget,this.relativeTargetOrigin,L,Ne),le&&MO(this.relativeTarget,le)&&(this.isProjectionDirty=!1),le||(le=pi()),Pa(le,this.relativeTarget)),te&&(this.animationValues=P,SO(P,A,this.latestValues,Ne,ve,fe)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Ne},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(d){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Eh(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=$r.update(()=>{E_.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=pp(0)),this.currentAnimation=vO(this.motionValue,[0,1e3],{...d,velocity:0,isSync:!0,onUpdate:a=>{this.mixTargetDelta(a),d.onUpdate&&d.onUpdate(a)},onStop:()=>{},onComplete:()=>{d.onComplete&&d.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const d=this.getStack();d&&d.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(DO),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const d=this.getLead();let{targetWithTransforms:a,target:v,layout:A,latestValues:P}=d;if(!(!a||!v||!A)){if(this!==d&&this.layout&&A&&ZP(this.options.animationType,this.layout.layoutBox,A.layoutBox)){v=this.target||pi();const k=io(this.layout.layoutBox.x);v.x.min=d.target.x.min,v.x.max=v.x.min+k;const L=io(this.layout.layoutBox.y);v.y.min=d.target.y.min,v.y.max=v.y.min+L}Pa(a,v),np(a,P),zm(this.projectionDeltaWithTransform,this.layoutCorrected,a,P)}}registerSharedNode(d,a){this.sharedNodes.has(d)||this.sharedNodes.set(d,new RO),this.sharedNodes.get(d).add(a);const A=a.options.initialPromotionConfig;a.promote({transition:A?A.transition:void 0,preserveFollowOpacity:A&&A.shouldPreserveFollowOpacity?A.shouldPreserveFollowOpacity(a):void 0})}isLead(){const d=this.getStack();return d?d.lead===this:!0}getLead(){const{layoutId:d}=this.options;return d?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:d}=this.options;return d?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:d}=this.options;if(d)return this.root.sharedNodes.get(d)}promote({needsReset:d,transition:a,preserveFollowOpacity:v}={}){const A=this.getStack();A&&A.promote(this,v),d&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const d=this.getStack();return d?d.relegate(this):!1}resetSkewAndRotation(){const{visualElement:d}=this.options;if(!d)return;let a=!1;const{latestValues:v}=d;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(a=!0),!a)return;const A={};v.z&&Mv("z",d,A,this.animationValues);for(let P=0;P<Iv.length;P++)Mv(`rotate${Iv[P]}`,d,A,this.animationValues),Mv(`skew${Iv[P]}`,d,A,this.animationValues);d.render();for(const P in A)d.setStaticValue(P,A[P]),this.animationValues&&(this.animationValues[P]=A[P]);d.scheduleRender()}applyProjectionStyles(d,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){d.visibility="hidden";return}const v=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,d.visibility="",d.opacity="",d.pointerEvents=P_(a?.pointerEvents)||"",d.transform=v?v(this.latestValues,""):"none";return}const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){this.options.layoutId&&(d.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,d.pointerEvents=P_(a?.pointerEvents)||""),this.hasProjected&&!Ed(this.latestValues)&&(d.transform=v?v({},""):"none",this.hasProjected=!1);return}d.visibility="";const P=A.animationValues||A.latestValues;this.applyTransformsToTarget();let k=kO(this.projectionDeltaWithTransform,this.treeScale,P);v&&(k=v(P,k)),d.transform=k;const{x:L,y:z}=this.projectionDelta;d.transformOrigin=`${L.origin*100}% ${z.origin*100}% 0`,A.animationValues?d.opacity=A===this?P.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:P.opacityExit:d.opacity=A===this?P.opacity!==void 0?P.opacity:"":P.opacityExit!==void 0?P.opacityExit:0;for(const G in eg){if(P[G]===void 0)continue;const{correct:te,applyTo:re,isCSSVariable:fe}=eg[G],ve=k==="none"?P[G]:te(P[G],A);if(re){const le=re.length;for(let Se=0;Se<le;Se++)d[re[Se]]=ve}else fe?this.options.visualElement.renderState.vars[G]=ve:d[G]=ve}this.options.layoutId&&(d.pointerEvents=A===this?P_(a?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(d=>d.currentAnimation?.stop()),this.root.nodes.forEach(sT),this.root.sharedNodes.clear()}}}function LO(n){n.updateLayout()}function FO(n){const e=n.resumeFrom?.snapshot||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:r}=n.layout,{animationType:o}=n.options,c=e.source!==n.layout.source;o==="size"?Ea(P=>{const k=c?e.measuredBox[P]:e.layoutBox[P],L=io(k);k.min=t[P].min,k.max=k.min+L}):ZP(o,e.layoutBox,t)&&Ea(P=>{const k=c?e.measuredBox[P]:e.layoutBox[P],L=io(t[P]);k.max=k.min+L,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[P].max=n.relativeTarget[P].min+L)});const d=rp();zm(d,t,e.layoutBox);const a=rp();c?zm(a,n.applyTransform(r,!0),e.measuredBox):zm(a,t,e.layoutBox);const v=!jP(d);let A=!1;if(!n.resumeFrom){const P=n.getClosestProjectingParent();if(P&&!P.resumeFrom){const{snapshot:k,layout:L}=P;if(k&&L){const z=pi();Um(z,e.layoutBox,k.layoutBox);const G=pi();Um(G,t,L.layoutBox),$P(z,G)||(A=!0),P.options.layoutRoot&&(n.relativeTarget=G,n.relativeTargetOrigin=z,n.relativeParent=P)}}}n.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:a,layoutDelta:d,hasLayoutChanged:v,hasRelativeLayoutChanged:A})}else if(n.isLead()){const{onExitComplete:t}=n.options;t&&t()}n.options.transition=void 0}function NO(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function BO(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function zO(n){n.clearSnapshot()}function sT(n){n.clearMeasurements()}function oT(n){n.isLayoutDirty=!1}function UO(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function aT(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function VO(n){n.resolveTargetDelta()}function jO(n){n.calcProjection()}function $O(n){n.resetSkewAndRotation()}function WO(n){n.removeLeadSnapshot()}function lT(n,e,t){n.translate=Gr(e.translate,0,t),n.scale=Gr(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function cT(n,e,t,r){n.min=Gr(e.min,t.min,r),n.max=Gr(e.max,t.max,r)}function HO(n,e,t,r){cT(n.x,e.x,t.x,r),cT(n.y,e.y,t.y,r)}function ZO(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const XO={duration:.45,ease:[.4,0,.1,1]},uT=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),hT=uT("applewebkit/")&&!uT("chrome/")?Math.round:Ma;function dT(n){n.min=hT(n.min),n.max=hT(n.max)}function qO(n){dT(n.x),dT(n.y)}function ZP(n,e,t){return n==="position"||n==="preserve-aspect"&&!eO(rT(e),rT(t),.2)}function GO(n){return n!==n.root&&n.scroll?.wasRoot}const YO=HP({attachResizeListener:(n,e)=>tg(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Rv={current:void 0},XP=HP({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!Rv.current){const n=new YO({});n.mount(window),n.setOptions({layoutScroll:!0}),Rv.current=n}return Rv.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),KO={pan:{Feature:mO},drag:{Feature:pO,ProjectionNode:XP,MeasureLayout:zP}};function fT(n,e,t){const{props:r}=n;n.animationState&&r.whileHover&&n.animationState.setActive("whileHover",t==="Start");const o="onHover"+t,c=r[o];c&&$r.postRender(()=>c(e,fg(e)))}class JO extends Rh{mount(){const{current:e}=this.node;e&&(this.unmount=vk(e,(t,r)=>(fT(this.node,r,"Start"),o=>fT(this.node,o,"End"))))}unmount(){}}class QO extends Rh{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ug(tg(this.node.current,"focus",()=>this.onFocus()),tg(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function pT(n,e,t){const{props:r}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&r.whileTap&&n.animationState.setActive("whileTap",t==="Start");const o="onTap"+(t==="End"?"":t),c=r[o];c&&$r.postRender(()=>c(e,fg(e)))}class e4 extends Rh{mount(){const{current:e}=this.node;e&&(this.unmount=Tk(e,(t,r)=>(pT(this.node,r,"Start"),(o,{success:c})=>pT(this.node,o,c?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const U0=new WeakMap,kv=new WeakMap,t4=n=>{const e=U0.get(n.target);e&&e(n)},n4=n=>{n.forEach(t4)};function r4({root:n,...e}){const t=n||document;kv.has(t)||kv.set(t,{});const r=kv.get(t),o=JSON.stringify(e);return r[o]||(r[o]=new IntersectionObserver(n4,{root:n,...e})),r[o]}function i4(n,e,t){const r=r4(e);return U0.set(n,t),r.observe(n),()=>{U0.delete(n),r.unobserve(n)}}const s4={some:0,all:1};class o4 extends Rh{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:o="some",once:c}=e,d={root:t?t.current:void 0,rootMargin:r,threshold:typeof o=="number"?o:s4[o]},a=v=>{const{isIntersecting:A}=v;if(this.isInView===A||(this.isInView=A,c&&!A&&this.hasEnteredView))return;A&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",A);const{onViewportEnter:P,onViewportLeave:k}=this.node.getProps(),L=A?P:k;L&&L(v)};return i4(this.node.current,d,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(a4(e,t))&&this.startObserver()}unmount(){}}function a4({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const l4={inView:{Feature:o4},tap:{Feature:e4},focus:{Feature:QO},hover:{Feature:JO}},c4={layout:{ProjectionNode:XP,MeasureLayout:zP}},u4={...qD,...l4,...KO,...c4},gn=uD(u4,TD);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h4=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),d4=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),mT=n=>{const e=d4(n);return e.charAt(0).toUpperCase()+e.slice(1)},qP=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),f4=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var p4={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m4=Ae.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:o="",children:c,iconNode:d,...a},v)=>Ae.createElement("svg",{ref:v,...p4,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:qP("lucide",o),...!c&&!f4(a)&&{"aria-hidden":"true"},...a},[...d.map(([A,P])=>Ae.createElement(A,P)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iu=(n,e)=>{const t=Ae.forwardRef(({className:r,...o},c)=>Ae.createElement(m4,{ref:c,iconNode:e,className:qP(`lucide-${h4(mT(n))}`,`lucide-${n}`,r),...o}));return t.displayName=mT(n),t};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g4=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],_4=Iu("book-open",g4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y4=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],v4=Iu("brain",y4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x4=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],GP=Iu("chevron-down",x4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b4=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],YP=Iu("layers",b4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w4=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],T4=Iu("map",w4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S4=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],A4=Iu("users",S4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P4=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],E4=Iu("volume-2",P4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C4=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}]],I4=Iu("volume",C4);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M4=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],R4=Iu("x",M4),W_={salinity:[[237,248,251],[204,236,230],[153,216,201],[102,194,164],[35,139,69]],topography:[[255,255,204],[255,237,160],[254,204,92],[253,141,60],[240,59,32]],biomass:[[255,245,240],[254,224,210],[252,187,161],[252,146,114],[215,48,31]],temperature:[[49,54,149],[69,117,180],[116,173,209],[171,217,233],[255,255,191],[254,153,41],[204,76,2]],currents:[[229,245,249],[153,216,201],[44,162,95],[0,109,44]],default:[[255,255,178],[254,204,92],[253,141,60],[240,59,32]]};function gT(n,e){const t=n.length,o=Math.max(0,Math.min(1,e))*(t-1),c=Math.floor(o),d=Math.min(t-1,Math.ceil(o)),a=o-c,v=n[c],A=n[d],P=Math.round(v[0]+(A[0]-v[0])*a),k=Math.round(v[1]+(A[1]-v[1])*a),L=Math.round(v[2]+(A[2]-v[2])*a);return[P,k,L]}const k4=["Temperature","Salinity","Ocean Topography","Ocean Currents","Biomass"],KP=Ae.createContext(void 0),D4=({children:n})=>{const[e,t]=Ae.useState(k4[0]);return Ae.useEffect(()=>{console.log("PaletteContext: selectedView changed to",e)},[e]),Pe.jsx(KP.Provider,{value:{selectedView:e,setSelectedView:t},children:n})},by=()=>{const n=Ae.useContext(KP);if(!n)throw new Error("usePalette must be used within PaletteProvider");return n},O4=()=>{const[n,e]=Ae.useState(!1),t={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0}},[r,o]=Ae.useState([{name:"Temperature",icon:"",selected:!1,color:[255,0,0]},{name:"Salinity",icon:"",selected:!1,color:[0,0,255]},{name:"Ocean Topography",icon:"",selected:!1,color:[0,255,0]},{name:"Ocean Currents",icon:"",selected:!1,color:[255,255,0]},{name:"Biomass",icon:"",selected:!1,color:[255,165,0]}]),{setSelectedView:c}=by(),d=a=>{const v=r[a];c(v.name),o(A=>A.map((P,k)=>({...P,selected:k===a})))};return Pe.jsxs("div",{className:"flex flex-col w-full",children:[Pe.jsxs("button",{onClick:()=>e(!n),className:"flex items-center justify-between gap-2 p-2 rounded-lg hover:bg-blue-800/40 transition-all",children:[Pe.jsxs("div",{className:"flex items-center gap-3",children:[Pe.jsx(T4,{size:20}),Pe.jsx("span",{className:"font-medium text-blue-100",children:"Shark Map"})]}),Pe.jsx(gn.div,{animate:{rotate:n?180:0},transition:{duration:.3},children:Pe.jsx(GP,{size:18})})]}),Pe.jsx(aP,{children:n&&Pe.jsx(gn.ul,{initial:"hidden",animate:"visible",exit:"hidden",variants:{visible:{opacity:1,height:"auto"},hidden:{opacity:0,height:0}},transition:{duration:.3},className:"ml-4 mt-3 grid grid-cols-2 gap-2 overflow-hidden",children:r.map((a,v)=>Pe.jsxs(gn.li,{variants:t,initial:"hidden",animate:"visible",transition:{delay:v*.05},onClick:()=>d(v),className:`
                  cursor-pointer
                  flex flex-col items-center justify-center
                  p-4 rounded-xl border backdrop-blur-sm
                  transition-all duration-300
                  shadow-md
                  ${a.selected?"bg-gradient-to-b from-blue-600 to-blue-800 border-blue-500 text-white shadow-lg shadow-blue-700/30":"bg-gradient-to-b from-blue-950/40 to-blue-900/20 border-blue-800/50 text-blue-100 hover:from-blue-900/50 hover:to-blue-800/40 hover:border-blue-700"}
                `,children:[a.icon&&Pe.jsx("span",{className:"text-3xl mb-2 opacity-90 drop-shadow-md",children:a.icon}),Pe.jsx("span",{className:`text-sm font-medium tracking-wide ${a.selected?"text-white":"text-blue-100/90"}`,children:a.name}),a.selected&&Pe.jsx(gn.div,{layoutId:"selectedIndicator",className:"mt-2 w-2.5 h-2.5 bg-blue-300 rounded-full shadow-inner"})]},v))})})]})},JP=Ae.createContext(void 0),wy=({children:n,initialSlide:e=0})=>{const t=Ae.Children.toArray(n),r=t.length,[o,c]=Ae.useState(e),A={currentSlide:o,totalSlides:r,nextSlide:()=>{c(P=>(P+1)%r)},prevSlide:()=>{c(P=>(P-1+r)%r)},goToSlide:P=>{P>=0&&P<r&&c(P)}};return Pe.jsx(JP.Provider,{value:A,children:t[o]})},kh=()=>{const n=Ae.useContext(JP);if(n===void 0)throw new Error("useSliderProvider must be used within a SliderProvider");return n},Dh=()=>Pe.jsxs(gn.div,{className:"absolute inset-0 overflow-hidden",children:[Pe.jsx(gn.div,{className:"absolute inset-0 bg-gradient-to-br from-[#00111F] via-[#002B44] to-[#004B70] animate-gradient-move",style:{backgroundSize:"400% 400%",filter:"brightness(0.9)"}}),[...Array(25)].map((n,e)=>Pe.jsx(gn.div,{className:"absolute bg-blue-200 rounded-full opacity-10 blur-sm",style:{width:Math.random()*6+4,height:Math.random()*6+4,top:`${Math.random()*100}%`,left:`${Math.random()*100}%`},animate:{y:[0,-120,0],opacity:[.05,.3,.05]},transition:{duration:6+Math.random()*4,repeat:1/0,ease:"easeInOut"}},e))]}),La=({onClick:n,children:e})=>Pe.jsx(gn.button,{onClick:n,className:"px-8 py-3 rounded-full bg-blue-500/20 backdrop-blur-md border border-blue-400/40 text-blue-100 font-semibold text-lg hover:bg-blue-500/30 hover:scale-105 transition-all shadow-lg shadow-blue-900/40",initial:{opacity:.8,scale:.8},animate:{opacity:1,scale:[1,1.05,1]},transition:{duration:1.8,delay:1,repeat:1/0,repeatType:"mirror"},children:e}),L4=()=>{const{nextSlide:n}=kh();return Pe.jsxs(gn.div,{className:"relative w-full h-screen flex items-center justify-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[Pe.jsx(Dh,{}),Pe.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center px-8",children:[Pe.jsx(gn.h1,{className:"text-white text-5xl md:text-6xl font-extrabold tracking-tight drop-shadow-[0_0_20px_rgba(0,100,255,0.3)]",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:1,ease:"easeOut"},children:"Why Sharks Are Important?"}),Pe.jsx(gn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:"In the deep blue, sharks keep the ocean in balance  vital to ecosystems, silent guardians of marine life."}),Pe.jsx("br",{}),Pe.jsx(La,{onClick:n,children:"Start"})]})]})},QP=Ae.createContext(void 0),F4=({children:n})=>{const[e,t]=Ae.useState(null),[r,o]=Ae.useState(!1);Ae.useEffect(()=>{const a=()=>{const v=window.speechSynthesis.getVoices();if(v.length>0){const A=v.find(P=>/Wavenet|Neural/i.test(P.name))||v.find(P=>/(Google UK English Female|Google US English|Microsoft Sonia Online|Microsoft Jenny)/i.test(P.name))||v.find(P=>P.lang.startsWith("en"))||v[0];t(A),console.log("Selected voice:",A?.name)}};a(),window.speechSynthesis.onvoiceschanged=a},[]);const c=(a,v)=>{if(r&&d(),!a.trim())return;const A=new SpeechSynthesisUtterance(a);if(v){const P=window.speechSynthesis.getVoices().find(k=>k.name===v);P&&(A.voice=P)}else e&&(A.voice=e);A.pitch=1,A.rate=1,A.volume=1,A.onstart=()=>{console.log("Speech started"),o(!0)},A.onend=()=>{console.log("Speech ended"),o(!1)},A.onerror=()=>{console.log("Speech error"),o(!1)},window.speechSynthesis.speak(A)},d=()=>{console.log("Speech stopped"),window.speechSynthesis.cancel(),o(!1)};return Pe.jsx(QP.Provider,{value:{play:c,stop:d,isPlaying:r},children:n})},N4=()=>{const n=Ae.useContext(QP);if(!n)throw new Error("useSound must be used within a SoundProvider");return n},Ty=({text:n,title:e,voiceName:t,hasBackground:r=!1})=>{const{play:o,stop:c,isPlaying:d}=N4(),a=()=>{console.log("isPlaying before toggle:",d),d?c():o(n,t)};Ae.useEffect(()=>(n.trim()&&(console.log("Playing speech for text:",n),o(n,t)),()=>c()),[n,t]);const v={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:[.25,.46,.45,.94]}}},A={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.8,delay:.3,ease:[.25,.46,.45,.94]}}},P=Pe.jsxs(Pe.Fragment,{children:[Pe.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e&&Pe.jsx(gn.h3,{className:"text-xl font-semibold text-blue-100 drop-shadow-[0_0_8px_rgba(0,200,255,0.4)]",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:e}),Pe.jsx(gn.button,{onClick:a,className:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-500/20 border border-blue-400/30 text-blue-100 backdrop-blur-sm hover:bg-blue-500/30 hover:scale-110 transition-all shadow-[0_0_15px_rgba(0,150,255,0.3)]",whileTap:{scale:.9},initial:{opacity:0,rotate:-180},animate:{opacity:1,rotate:0},transition:{duration:.5,delay:.4},children:d?Pe.jsx(E4,{className:"w-5 h-5"}):Pe.jsx(I4,{className:"w-5 h-5"})})]}),Pe.jsx(gn.p,{className:"text-blue-100/90 leading-relaxed text-lg",variants:A,initial:"hidden",animate:"visible",children:n})]});return r?Pe.jsxs(gn.div,{className:"relative backdrop-blur-md bg-white/10 border border-blue-400/30 rounded-2xl p-6 text-blue-100 shadow-[0_0_25px_rgba(0,100,255,0.15)]",variants:v,initial:"hidden",animate:"visible",whileHover:{scale:1.02,boxShadow:"0 0 40px rgba(0,150,255,0.25)",transition:{duration:.3}},children:[P,Pe.jsx(gn.div,{className:"absolute inset-0 rounded-2xl pointer-events-none",animate:{boxShadow:["0 0 25px rgba(0,100,255,0.1)","0 0 50px rgba(0,150,255,0.2)","0 0 25px rgba(0,100,255,0.1)"]},transition:{duration:4,repeat:1/0,repeatType:"mirror"}})]}):Pe.jsx("div",{className:"text-blue-100",children:P})},B4=()=>{const{prevSlide:n,nextSlide:e}=kh();return Pe.jsxs(gn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[Pe.jsx(Dh,{}),Pe.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:Pe.jsxs(gn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:[Pe.jsx(gn.img,{src:"/path/to/your/image.jpg",alt:"Sharks in ocean",className:"w-64 h-48 object-cover rounded-lg mb-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.3}}),Pe.jsx(Ty,{text:`In the deep blue, sharks keep the ocean in balance  vital to
          ecosystems, silent guardians of marine life.`})]})}),Pe.jsxs("div",{className:"bottom-8 left-0 right-0 flex w-full justify-between px-8 z-20 mb-8",children:[Pe.jsx(La,{onClick:n,children:"Back"}),Pe.jsx(La,{onClick:e,children:"Next"})]})]})},z4=()=>Pe.jsxs(wy,{children:[Pe.jsx(L4,{}),Pe.jsx(B4,{})]}),U4=()=>{const{nextSlide:n}=kh();return Pe.jsxs(gn.div,{className:"relative w-full h-screen flex items-center justify-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[Pe.jsx(Dh,{}),Pe.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center px-8",children:[Pe.jsx(gn.h1,{className:"text-white text-5xl md:text-6xl font-extrabold tracking-tight drop-shadow-[0_0_20px_rgba(0,100,255,0.3)]",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:1,ease:"easeOut"},children:"Why Sharks Are Important?"}),Pe.jsx(gn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:"In the deep blue, sharks keep the ocean in balance  vital to ecosystems, silent guardians of marine life."}),Pe.jsx("br",{}),Pe.jsx(La,{onClick:n,children:"Start"})]})]})},V4=()=>{const{prevSlide:n,nextSlide:e}=kh();return Pe.jsxs(gn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[Pe.jsx(Dh,{}),Pe.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:Pe.jsxs(gn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:[Pe.jsx(gn.img,{src:"/path/to/your/image.jpg",alt:"Sharks in ocean",className:"w-64 h-48 object-cover rounded-lg mb-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.3}}),Pe.jsx(Ty,{text:`In the deep blue, sharks keep the ocean in balance  vital to
          ecosystems, silent guardians of marine life.`})]})}),Pe.jsxs("div",{className:"bottom-8 left-0 right-0 flex w-full justify-between px-8 z-20 mb-8",children:[Pe.jsx(La,{onClick:n,children:"Back"}),Pe.jsx(La,{onClick:e,children:"Next"})]})]})},_T=()=>Pe.jsxs(wy,{children:[Pe.jsx(U4,{}),Pe.jsx(V4,{})]}),j4=()=>{const{nextSlide:n}=kh();return Pe.jsxs(gn.div,{className:"relative w-full h-screen flex items-center justify-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[Pe.jsx(Dh,{}),Pe.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center px-8",children:[Pe.jsx(gn.h1,{className:"text-white text-5xl md:text-6xl font-extrabold tracking-tight drop-shadow-[0_0_20px_rgba(0,100,255,0.3)]",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:1,ease:"easeOut"},children:"Why Sharks Are Important?"}),Pe.jsx(gn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:"In the deep blue, sharks keep the ocean in balance  vital to ecosystems, silent guardians of marine life."}),Pe.jsx("br",{}),Pe.jsx(La,{onClick:n,children:"Start"})]})]})},$4=()=>{const{prevSlide:n,nextSlide:e}=kh();return Pe.jsxs(gn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[Pe.jsx(Dh,{}),Pe.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:Pe.jsxs(gn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:[Pe.jsx(gn.img,{src:"/path/to/your/image.jpg",alt:"Sharks in ocean",className:"w-64 h-48 object-cover rounded-lg mb-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.3}}),Pe.jsx(Ty,{text:`In the deep blue, sharks keep the ocean in balance  vital to
          ecosystems, silent guardians of marine life.`})]})}),Pe.jsxs("div",{className:"bottom-8 left-0 right-0 flex w-full justify-between px-8 z-20 mb-8",children:[Pe.jsx(La,{onClick:n,children:"Back"}),Pe.jsx(La,{onClick:e,children:"Next"})]})]})},W4=()=>Pe.jsxs(wy,{children:[Pe.jsx(j4,{}),Pe.jsx($4,{})]}),H4=()=>{const{nextSlide:n}=kh();return Pe.jsxs(gn.div,{className:"relative w-full h-screen flex items-center justify-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[Pe.jsx(Dh,{}),Pe.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center px-8",children:[Pe.jsx(gn.h1,{className:"text-white text-5xl md:text-6xl font-extrabold tracking-tight drop-shadow-[0_0_20px_rgba(0,100,255,0.3)]",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:1,ease:"easeOut"},children:"Why Sharks Are Important?"}),Pe.jsx(gn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:"In the deep blue, sharks keep the ocean in balance  vital to ecosystems, silent guardians of marine life."}),Pe.jsx("br",{}),Pe.jsx(La,{onClick:n,children:"Start"})]})]})},Z4=()=>{const{prevSlide:n,nextSlide:e}=kh();return Pe.jsxs(gn.div,{className:"relative w-full h-screen flex flex-col justify-between items-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[Pe.jsx(Dh,{}),Pe.jsx("div",{className:"relative z-10 h-full justify-center flex flex-col items-center text-center px-8 ",children:Pe.jsxs(gn.p,{className:"text-blue-100 text-lg md:text-xl mt-6 max-w-2xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,delay:.5},children:[Pe.jsx(gn.img,{src:"/path/to/your/image.jpg",alt:"Sharks in ocean",className:"w-64 h-48 object-cover rounded-lg mb-6",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.3}}),Pe.jsx(Ty,{text:`In the deep blue, sharks keep the ocean in balance  vital to
          ecosystems, silent guardians of marine life.`})]})}),Pe.jsxs("div",{className:"bottom-8 left-0 right-0 flex w-full justify-between px-8 z-20 mb-8",children:[Pe.jsx(La,{onClick:n,children:"Back"}),Pe.jsx(La,{onClick:e,children:"Next"})]})]})},X4=()=>Pe.jsxs(wy,{children:[Pe.jsx(H4,{}),Pe.jsx(Z4,{})]}),q4=n=>{const[e,t]=Ae.useState(!1),[r,o]=Ae.useState([{name:"What are Sharks",icon:"",selected:!1},{name:"Shark Lives Matter",icon:"",selected:!1},{name:"Sharks in the Food Chain",icon:"",selected:!1},{name:"Foraging Habitat",icon:"",selected:!1},{name:"Sharks are in Danger",icon:"",selected:!1}]),c=Ae.useCallback(()=>{t(!e)},[e]),d=Ae.useCallback(a=>{const v=r[a];switch(console.log(`${v.name} button clicked`),v.name){case"What are Sharks":n(Pe.jsx(z4,{}));break;case"Shark Lives Matter":n(Pe.jsx(_T,{}));break;case"Sharks in the Food Chain":n(Pe.jsx(W4,{}));break;case"Foraging Habitat":n(Pe.jsx(X4,{}));break;case"Sharks are in Danger":n(Pe.jsx(_T,{}));break;default:n(Pe.jsx("div",{children:"Default Component"}))}o(A=>A.map((P,k)=>({...P,selected:k===a})))},[r,n]);return{handleStoriesClick:c,handleItemClick:d,openMenu:e,knowledgeOptions:r}},G4=({setChildren:n})=>{const{handleStoriesClick:e,handleItemClick:t,openMenu:r,knowledgeOptions:o}=q4(n),c={hidden:{opacity:0,y:-6},visible:{opacity:1,y:0}};return Pe.jsxs("div",{className:"flex flex-col w-full",children:[Pe.jsxs("button",{onClick:e,className:"flex items-center justify-between gap-2 p-3 rounded-lg hover:bg-blue-800/40 transition-colors",children:[Pe.jsxs("div",{className:"flex items-center gap-3",children:[Pe.jsx(_4,{size:22,className:"text-neutral-100"}),Pe.jsx("span",{className:"font-semibold text-neutral-100 tracking-wide",children:"Knowledge Hub"})]}),Pe.jsx(gn.div,{animate:{rotate:r?180:0},transition:{duration:.3},children:Pe.jsx(GP,{size:18,className:"text-neutral-400"})})]}),Pe.jsx(aP,{children:r&&Pe.jsx(gn.ul,{initial:"hidden",animate:"visible",exit:"hidden",variants:{visible:{opacity:1,height:"auto"},hidden:{opacity:0,height:0}},transition:{duration:.35},className:"ml-4 mt-4 grid grid-cols-1 gap-3 overflow-hidden",children:o.map((d,a)=>Pe.jsxs(gn.li,{variants:c,initial:"hidden",animate:"visible",transition:{delay:a*.05},onClick:()=>t(a),className:`
                  relative cursor-pointer overflow-hidden
                  flex flex-col items-center justify-center
                  p-5 rounded-xl border backdrop-blur-sm
                  transition-colors duration-300 shadow-md
                  ${d.selected?"bg-gradient-to-br from-amber-400/70 to-yellow-300/40 border-yellow-400 text-neutral-900 shadow-lg shadow-yellow-500/20":"bg-gradient-to-br from-neutral-900/50 to-neutral-800/30 border-neutral-700 text-neutral-100 hover:from-neutral-800/60 hover:to-neutral-700/40"}
                `,children:[Pe.jsx("div",{className:`absolute left-0 top-0 h-full w-1 ${d.selected?"bg-yellow-300/70":"bg-neutral-700/50"}`}),Pe.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-white/10 to-transparent pointer-events-none"}),d.icon&&Pe.jsx("span",{className:`text-3xl mb-2 ${d.selected?"text-yellow-900":"text-amber-200"}`,children:d.icon}),Pe.jsx("span",{className:`text-sm font-medium tracking-wide text-center ${d.selected?"text-yellow-950":"text-neutral-100/90"}`,children:d.name}),d.selected&&Pe.jsx(gn.div,{layoutId:"selectedIndicator",className:"absolute bottom-2 right-3 w-2.5 h-2.5 bg-yellow-300 rounded-full shadow-inner"})]},a))})})]})},Y4=()=>Pe.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-blue-800/40 cursor-pointer",children:[Pe.jsx(YP,{size:20}),Pe.jsx("span",{className:"font-medium",children:"Which Shark Are You?"})]}),K4=()=>Pe.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-blue-800/40 cursor-pointer",children:[Pe.jsx(v4,{size:20}),Pe.jsx("span",{className:"font-medium",children:"How We Predict Shark Movement"})]}),J4=()=>Pe.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-blue-800/40 cursor-pointer",children:[Pe.jsx(YP,{size:20}),Pe.jsx("span",{className:"font-medium",children:"NASA Data Used"})]}),Q4=()=>Pe.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-blue-800/40 cursor-pointer",children:[Pe.jsx(A4,{size:20}),Pe.jsx("span",{className:"font-medium",children:"Meet the Developers"})]}),eL=({children:n})=>{const[e,t]=Ae.useState("research"),r=n&&Dd.Children.map(n,d=>Dd.isValidElement(d)?Dd.cloneElement(d,{mapMode:e}):d),[o,c]=Ae.useState(r);return Pe.jsxs("div",{className:"flex",children:[Pe.jsxs("aside",{className:"w-72 h-screen bg-gradient-to-b from-blue-900 to-blue-950 text-white flex flex-col items-start p-4 shadow-2xl relative overflow-hidden",children:[Pe.jsxs("nav",{className:"flex flex-col gap-3 w-full text-sm mt-6",children:[Pe.jsx(O4,{}),Pe.jsx(G4,{setChildren:c}),Pe.jsx(Y4,{}),Pe.jsx(K4,{}),Pe.jsx(J4,{}),Pe.jsx(Q4,{})]}),Pe.jsx("button",{onClick:()=>t(d=>d==="research"?"student":"research"),className:"absolute bottom-6 left-4 w-fit px-3 py-1 cursor-pointer rounded-lg bg-blue-800/70 hover:bg-blue-700/80 text-sm",children:e==="research"?"Student Mode":"Research Mode"}),Pe.jsx(gn.div,{className:"absolute bottom-0 left-0 w-full h-40 bg-blue-700/30 blur-3xl rounded-t-full pointer-events-none",animate:{y:[0,-10,0],opacity:[.5,.7,.5]},transition:{duration:6,repeat:1/0}})]}),Pe.jsx("div",{className:"flex-1 bg-black min-h-screen",children:Pe.jsx("div",{className:"w-full h-full",children:o})})]})};var C_={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.8.0/LICENSE.txt
 */var tL=C_.exports,yT;function nL(){return yT||(yT=1,(function(n,e){(function(t,r){n.exports=r()})(tL,(function(){var t={},r={};function o(d,a,v){if(r[d]=v,d==="index"){var A="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",P={};return r.shared(P),r.index(t,P),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([A],{type:"text/javascript"}))),t}}o("shared",["exports"],(function(d){function a(u,s,l,p){return new(l||(l=Promise))((function(_,b){function T(O){try{M(p.next(O))}catch(F){b(F)}}function C(O){try{M(p.throw(O))}catch(F){b(F)}}function M(O){var F;O.done?_(O.value):(F=O.value,F instanceof l?F:new l((function(V){V(F)}))).then(T,C)}M((p=p.apply(u,s||[])).next())}))}function v(u,s){this.x=u,this.y=s}function A(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var P,k;typeof SuppressedError=="function"&&SuppressedError,v.prototype={clone(){return new v(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,s){return this.clone()._rotateAround(u,s)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const s=u.x-this.x,l=u.y-this.y;return s*s+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,s){return Math.atan2(this.x*s-this.y*u,this.x*u+this.y*s)},_matMult(u){const s=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=s,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const s=Math.cos(u),l=Math.sin(u),p=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=p,this},_rotateAround(u,s){const l=Math.cos(u),p=Math.sin(u),_=s.y+p*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-p*(this.y-s.y),this.y=_,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:v},v.convert=function(u){if(u instanceof v)return u;if(Array.isArray(u))return new v(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new v(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};var L=(function(){if(k)return P;function u(s,l,p,_){this.cx=3*s,this.bx=3*(p-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(_-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=p,this.p2y=_}return k=1,P=u,u.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(l===void 0&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var p=s,_=0;_<8;_++){var b=this.sampleCurveX(p)-s;if(Math.abs(b)<l)return p;var T=this.sampleCurveDerivativeX(p);if(Math.abs(T)<1e-6)break;p-=b/T}var C=0,M=1;for(p=s,_=0;_<20&&(b=this.sampleCurveX(p),!(Math.abs(b-s)<l));_++)s>b?C=p:M=p,p=.5*(M-C)+C;return p},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},P})(),z=A(L);let G,te;function re(){return G==null&&(G=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),G}function fe(){if(te==null&&(te=!1,re())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let p=0;p<25;p++){const _=4*p;s.fillStyle=`rgb(${_},${_+1},${_+2})`,s.fillRect(p%5,Math.floor(p/5),1,1)}const l=s.getImageData(0,0,5,5).data;for(let p=0;p<100;p++)if(p%4!=3&&l[p]!==p){te=!0;break}}}return te||!1}var ve=1e-6,le=typeof Float32Array<"u"?Float32Array:Array;function Se(){var u=new le(9);return le!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function Ne(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function nt(){var u=new le(3);return le!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function pt(u){var s=u[0],l=u[1],p=u[2];return Math.sqrt(s*s+l*l+p*p)}function mt(u,s,l){var p=new le(3);return p[0]=u,p[1]=s,p[2]=l,p}function Tt(u,s,l){return u[0]=s[0]+l[0],u[1]=s[1]+l[1],u[2]=s[2]+l[2],u}function Mt(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u[2]=s[2]*l,u}function Zt(u,s,l){var p=s[0],_=s[1],b=s[2],T=l[0],C=l[1],M=l[2];return u[0]=_*M-b*C,u[1]=b*T-p*M,u[2]=p*C-_*T,u}var hn,on=pt;function nn(u,s,l){var p=s[0],_=s[1],b=s[2],T=s[3];return u[0]=l[0]*p+l[4]*_+l[8]*b+l[12]*T,u[1]=l[1]*p+l[5]*_+l[9]*b+l[13]*T,u[2]=l[2]*p+l[6]*_+l[10]*b+l[14]*T,u[3]=l[3]*p+l[7]*_+l[11]*b+l[15]*T,u}function Rn(){var u=new le(4);return le!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Ee(u,s,l,p){var _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",b=Math.PI/360;s*=b,p*=b,l*=b;var T=Math.sin(s),C=Math.cos(s),M=Math.sin(l),O=Math.cos(l),F=Math.sin(p),V=Math.cos(p);switch(_){case"xyz":u[0]=T*O*V+C*M*F,u[1]=C*M*V-T*O*F,u[2]=C*O*F+T*M*V,u[3]=C*O*V-T*M*F;break;case"xzy":u[0]=T*O*V-C*M*F,u[1]=C*M*V-T*O*F,u[2]=C*O*F+T*M*V,u[3]=C*O*V+T*M*F;break;case"yxz":u[0]=T*O*V+C*M*F,u[1]=C*M*V-T*O*F,u[2]=C*O*F-T*M*V,u[3]=C*O*V+T*M*F;break;case"yzx":u[0]=T*O*V+C*M*F,u[1]=C*M*V+T*O*F,u[2]=C*O*F-T*M*V,u[3]=C*O*V-T*M*F;break;case"zxy":u[0]=T*O*V-C*M*F,u[1]=C*M*V+T*O*F,u[2]=C*O*F+T*M*V,u[3]=C*O*V-T*M*F;break;case"zyx":u[0]=T*O*V-C*M*F,u[1]=C*M*V+T*O*F,u[2]=C*O*F-T*M*V,u[3]=C*O*V+T*M*F;break;default:throw new Error("Unknown angle order "+_)}return u}function Oe(){var u=new le(2);return le!=Float32Array&&(u[0]=0,u[1]=0),u}function me(u,s){var l=new le(2);return l[0]=u,l[1]=s,l}nt(),hn=new le(4),le!=Float32Array&&(hn[0]=0,hn[1]=0,hn[2]=0,hn[3]=0),nt(),mt(1,0,0),mt(0,1,0),Rn(),Rn(),Se(),Oe();const ze=8192;function $e(u,s,l){return s*(ze/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}function ue(u,s){return(u%s+s)%s}function De(u,s,l){return u*(1-l)+s*l}function dt(u){if(u<=0)return 0;if(u>=1)return 1;const s=u*u,l=s*u;return 4*(u<.5?l:3*(u-s)+l-.75)}function Et(u,s,l,p){const _=new z(u,s,l,p);return b=>_.solve(b)}const kt=Et(.25,.1,.25,1);function ht(u,s,l){return Math.min(l,Math.max(s,u))}function vt(u,s,l){const p=l-s,_=((u-s)%p+p)%p+s;return _===s?l:_}function ut(u,...s){for(const l of s)for(const p in l)u[p]=l[p];return u}let Bt=1;function Wt(u,s,l){const p={};for(const _ in u)p[_]=s.call(this,u[_],_,u);return p}function jn(u,s,l){const p={};for(const _ in u)s.call(this,u[_],_,u)&&(p[_]=u[_]);return p}function Wn(u){return Array.isArray(u)?u.map(Wn):typeof u=="object"&&u?Wt(u,Wn):u}const qn={};function Jn(u){qn[u]||(typeof console<"u"&&console.warn(u),qn[u]=!0)}function pn(u,s,l){return(l.y-u.y)*(s.x-u.x)>(s.y-u.y)*(l.x-u.x)}function mn(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let Us=null;function ki(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Di="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Gi(u,s,l,p,_){return a(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(u,{timestamp:0});try{const T=b?.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const C=T.startsWith("BGR"),M=new Uint8ClampedArray(p*_*4);if(yield b.copyTo(M,(function(O,F,V,H,X){const q=4*Math.max(-F,0),ee=(Math.max(0,V)-V)*H*4+q,se=4*H,pe=Math.max(0,F),Ve=Math.max(0,V);return{rect:{x:pe,y:Ve,width:Math.min(O.width,F+H)-pe,height:Math.min(O.height,V+X)-Ve},layout:[{offset:ee,stride:se}]}})(u,s,l,p,_)),C)for(let O=0;O<M.length;O+=4){const F=M[O];M[O]=M[O+2],M[O+2]=F}return M}finally{b.close()}}))}let mi,bs;function To(u,s,l,p){return u.addEventListener(s,l,p),{unsubscribe:()=>{u.removeEventListener(s,l,p)}}}function ea(u){return u*Math.PI/180}function So(u){return u/Math.PI*180}const Ao={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},so={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Po="AbortError";function Le(){return new Error(Po)}const Y={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function K(u){return Y.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const ne="global-dispatcher";class xe extends Error{constructor(s,l,p,_){super(`AJAXError: ${l} (${s}): ${p}`),this.status=s,this.statusText=l,this.url=p,this.body=_}}const Ce=()=>mn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Fe=function(u,s){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const p=K(u.url);if(p)return p(u,s);if(mn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:ne},s)}if(!(/^file:/.test(l=u.url)||/^file:/.test(Ce())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(p,_){return a(this,void 0,void 0,(function*(){const b=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:Ce(),signal:_.signal});let T,C;p.type!=="json"||b.headers.has("Accept")||b.headers.set("Accept","application/json");try{T=yield fetch(b)}catch(O){throw new xe(0,O.message,p.url,new Blob)}if(!T.ok){const O=yield T.blob();throw new xe(T.status,T.statusText,p.url,O)}C=p.type==="arrayBuffer"||p.type==="image"?T.arrayBuffer():p.type==="json"?T.json():T.text();const M=yield C;if(_.signal.aborted)throw Le();return{data:M,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}}))})(u,s);if(mn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:ne},s)}var l;return(function(p,_){return new Promise(((b,T)=>{var C;const M=new XMLHttpRequest;M.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(M.responseType="arraybuffer");for(const O in p.headers)M.setRequestHeader(O,p.headers[O]);p.type==="json"&&(M.responseType="text",!((C=p.headers)===null||C===void 0)&&C.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=p.credentials==="include",M.onerror=()=>{T(new Error(M.statusText))},M.onload=()=>{if(!_.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let O=M.response;if(p.type==="json")try{O=JSON.parse(M.response)}catch(F){return void T(F)}b({data:O,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const O=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});T(new xe(M.status,M.statusText,p.url,O))}},_.signal.addEventListener("abort",(()=>{M.abort(),T(Le())})),M.send(p.body)}))})(u,s)};function Ke(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const s=new URL(u),l=window.location;return s.protocol===l.protocol&&s.host===l.host}function Ue(u,s,l){l[u]&&l[u].indexOf(s)!==-1||(l[u]=l[u]||[],l[u].push(s))}function it(u,s,l){if(l&&l[u]){const p=l[u].indexOf(s);p!==-1&&l[u].splice(p,1)}}class yt{constructor(s,l={}){ut(this,l),this.type=s}}class at extends yt{constructor(s,l={}){super("error",ut({error:s},l))}}class Vt{on(s,l){return this._listeners=this._listeners||{},Ue(s,l,this._listeners),{unsubscribe:()=>{this.off(s,l)}}}off(s,l){return it(s,l,this._listeners),it(s,l,this._oneTimeListeners),this}once(s,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Ue(s,l,this._oneTimeListeners),this):new Promise((p=>this.once(s,p)))}fire(s,l){typeof s=="string"&&(s=new yt(s,l||{}));const p=s.type;if(this.listens(p)){s.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const C of _)C.call(this,s);const b=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const C of b)it(p,C,this._oneTimeListeners),C.call(this,s);const T=this._eventedParent;T&&(ut(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(s))}else s instanceof at&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,l){return this._eventedParent=s,this._eventedParentData=l,this}}var Be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ln=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Mn(u,s){const l={};for(const p in u)p!=="ref"&&(l[p]=u[p]);return ln.forEach((p=>{p in s&&(l[p]=s[p])})),l}function qt(u,s){if(Array.isArray(u)){if(!Array.isArray(s)||u.length!==s.length)return!1;for(let l=0;l<u.length;l++)if(!qt(u[l],s[l]))return!1;return!0}if(typeof u=="object"&&u!==null&&s!==null){if(typeof s!="object"||Object.keys(u).length!==Object.keys(s).length)return!1;for(const l in u)if(!qt(u[l],s[l]))return!1;return!0}return u===s}function _n(u,s){u.push(s)}function sr(u,s,l){_n(l,{command:"addSource",args:[u,s[u]]})}function Tr(u,s,l){_n(s,{command:"removeSource",args:[u]}),l[u]=!0}function zr(u,s,l,p){Tr(u,l,p),sr(u,s,l)}function Sr(u,s,l){let p;for(p in u[l])if(Object.prototype.hasOwnProperty.call(u[l],p)&&p!=="data"&&!qt(u[l][p],s[l][p]))return!1;for(p in s[l])if(Object.prototype.hasOwnProperty.call(s[l],p)&&p!=="data"&&!qt(u[l][p],s[l][p]))return!1;return!0}function Rr(u,s,l,p,_,b){u=u||{},s=s||{};for(const T in u)Object.prototype.hasOwnProperty.call(u,T)&&(qt(u[T],s[T])||l.push({command:b,args:[p,T,s[T],_]}));for(const T in s)Object.prototype.hasOwnProperty.call(s,T)&&!Object.prototype.hasOwnProperty.call(u,T)&&(qt(u[T],s[T])||l.push({command:b,args:[p,T,s[T],_]}))}function Gn(u){return u.id}function kr(u,s){return u[s.id]=s,u}class lt{constructor(s,l,p,_){this.message=(s?`${s}: `:"")+p,_&&(this.identifier=_),l!=null&&l.__line__&&(this.line=l.__line__)}}function yr(u,...s){for(const l of s)for(const p in l)u[p]=l[p];return u}class gi extends Error{constructor(s,l){super(l),this.message=l,this.key=s}}class Eo{constructor(s,l=[]){this.parent=s,this.bindings={};for(const[p,_]of l)this.bindings[p]=_}concat(s){return new Eo(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const _i={kind:"null"},St={kind:"number"},bn={kind:"string"},dn={kind:"boolean"},Yr={kind:"color"},ta={kind:"projectionDefinition"},na={kind:"object"},yn={kind:"value"},Mc={kind:"collator"},Co={kind:"formatted"},Rc={kind:"padding"},oo={kind:"colorArray"},Il={kind:"numberArray"},An={kind:"resolvedImage"},ku={kind:"variableAnchorOffsetCollection"};function yi(u,s){return{kind:"array",itemType:u,N:s}}function Qn(u){if(u.kind==="array"){const s=Qn(u.itemType);return typeof u.N=="number"?`array<${s}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${s}>`}return u.kind}const kc=[_i,St,bn,dn,Yr,ta,Co,na,yi(yn),Rc,Il,oo,An,ku];function Dc(u,s){if(s.kind==="error")return null;if(u.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Dc(u.itemType,s.itemType))&&(typeof u.N!="number"||u.N===s.N))return null}else{if(u.kind===s.kind)return null;if(u.kind==="value"){for(const l of kc)if(!Dc(l,s))return null}}return`Expected ${Qn(u)} but found ${Qn(s)} instead.`}function Du(u,s){return s.some((l=>l.kind===u.kind))}function Vs(u,s){return s.some((l=>l==="null"?u===null:l==="array"?Array.isArray(u):l==="object"?u&&!Array.isArray(u)&&typeof u=="object":l===typeof u))}function ai(u,s){return u.kind==="array"&&s.kind==="array"?u.itemType.kind===s.itemType.kind&&typeof u.N=="number":u.kind===s.kind}const Oh=.96422,ws=.82521,Gd=4/29,Ml=6/29,Yd=3*Ml*Ml,Ou=Ml*Ml*Ml,Lu=Math.PI/180,Oc=180/Math.PI;function Rl(u){return(u%=360)<0&&(u+=360),u}function kl([u,s,l,p]){let _,b;const T=Lc((.2225045*(u=Lh(u))+.7168786*(s=Lh(s))+.0606169*(l=Lh(l)))/1);u===s&&s===l?_=b=T:(_=Lc((.4360747*u+.3850649*s+.1430804*l)/Oh),b=Lc((.0139322*u+.0971045*s+.7141733*l)/ws));const C=116*T-16;return[C<0?0:C,500*(_-T),200*(T-b),p]}function Lh(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Lc(u){return u>Ou?Math.pow(u,1/3):u/Yd+Gd}function Ba([u,s,l,p]){let _=(u+16)/116,b=isNaN(s)?_:_+s/500,T=isNaN(l)?_:_-l/200;return _=1*za(_),b=Oh*za(b),T=ws*za(T),[Fc(3.1338561*b-1.6168667*_-.4906146*T),Fc(-.9787684*b+1.9161415*_+.033454*T),Fc(.0719453*b-.2289914*_+1.4052427*T),p]}function Fc(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function za(u){return u>Ml?u*u*u:Yd*(u-Gd)}const Lp=Object.hasOwn||function(u,s){return Object.prototype.hasOwnProperty.call(u,s)};function ra(u,s){return Lp(u,s)?u[s]:void 0}function $n(u){return parseInt(u.padEnd(2,u),16)/255}function Ts(u,s){return Pn(s?u/100:u,0,1)}function Pn(u,s,l){return Math.min(Math.max(s,u),l)}function Io(u){return!u.some(Number.isNaN)}const Mo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ao(u,s,l){return u+l*(s-u)}function ia(u,s,l){return u.map(((p,_)=>ao(p,s[_],l)))}class Tn{constructor(s,l,p,_=1,b=!0){this.r=s,this.g=l,this.b=p,this.a=_,b||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[s,l,p,_]))}static parse(s){if(s instanceof Tn)return s;if(typeof s!="string")return;const l=(function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=ra(Mo,p);if(_){const[T,C,M]=_;return[T/255,C/255,M/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const T=p.length<6?1:2;let C=1;return[$n(p.slice(C,C+=T)),$n(p.slice(C,C+=T)),$n(p.slice(C,C+=T)),$n(p.slice(C,C+T)||"ff")]}if(p.startsWith("rgb")){const T=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[C,M,O,F,V,H,X,q,ee,se,pe,Ve]=T,be=[F||" ",X||" ",se].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const Ie=[O,H,ee].join(""),Je=Ie==="%%%"?100:Ie===""?255:0;if(Je){const st=[Pn(+M/Je,0,1),Pn(+V/Je,0,1),Pn(+q/Je,0,1),pe?Ts(+pe,Ve):1];if(Io(st))return st}}return}}const b=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[T,C,M,O,F,V,H,X,q]=b,ee=[M||" ",F||" ",H].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const se=[+C,Pn(+O,0,100),Pn(+V,0,100),X?Ts(+X,q):1];if(Io(se))return(function([pe,Ve,be,Ie]){function Je(st){const gt=(st+pe/30)%12,Ft=Ve*Math.min(be,1-be);return be-Ft*Math.max(-1,Math.min(gt-3,9-gt,1))}return pe=Rl(pe),Ve/=100,be/=100,[Je(0),Je(8),Je(4),Ie]})(se)}}})(s);return l?new Tn(...l,!1):void 0}get rgb(){const{r:s,g:l,b:p,a:_}=this,b=_||1/0;return this.overwriteGetter("rgb",[s/b,l/b,p/b,_])}get hcl(){return this.overwriteGetter("hcl",(function(s){const[l,p,_,b]=kl(s),T=Math.sqrt(p*p+_*_);return[Math.round(1e4*T)?Rl(Math.atan2(_,p)*Oc):NaN,T,l,b]})(this.rgb))}get lab(){return this.overwriteGetter("lab",kl(this.rgb))}overwriteGetter(s,l){return Object.defineProperty(this,s,{value:l}),l}toString(){const[s,l,p,_]=this.rgb;return`rgba(${[s,l,p].map((b=>Math.round(255*b))).join(",")},${_})`}static interpolate(s,l,p,_="rgb"){switch(_){case"rgb":{const[b,T,C,M]=ia(s.rgb,l.rgb,p);return new Tn(b,T,C,M,!1)}case"hcl":{const[b,T,C,M]=s.hcl,[O,F,V,H]=l.hcl;let X,q;if(isNaN(b)||isNaN(O))isNaN(b)?isNaN(O)?X=NaN:(X=O,C!==1&&C!==0||(q=F)):(X=b,V!==1&&V!==0||(q=T));else{let be=O-b;O>b&&be>180?be-=360:O<b&&b-O>180&&(be+=360),X=b+p*be}const[ee,se,pe,Ve]=(function([be,Ie,Je,st]){return be=isNaN(be)?0:be*Lu,Ba([Je,Math.cos(be)*Ie,Math.sin(be)*Ie,st])})([X,q??ao(T,F,p),ao(C,V,p),ao(M,H,p)]);return new Tn(ee,se,pe,Ve,!1)}case"lab":{const[b,T,C,M]=Ba(ia(s.lab,l.lab,p));return new Tn(b,T,C,M,!1)}}}}Tn.black=new Tn(0,0,0,1),Tn.white=new Tn(1,1,1,1),Tn.transparent=new Tn(0,0,0,0),Tn.red=new Tn(1,0,0,1);class lo{constructor(s,l,p){this.sensitivity=s?l?"variant":"case":l?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,l){return this.collator.compare(s,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const js=["bottom","center","top"];class $s{constructor(s,l,p,_,b,T){this.text=s,this.image=l,this.scale=p,this.fontStack=_,this.textColor=b,this.verticalAlign=T}}class Pr{constructor(s){this.sections=s}static fromString(s){return new Pr([new $s(s,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((s=>s.text.length!==0||s.image&&s.image.name.length!==0))}static factory(s){return s instanceof Pr?s:Pr.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map((s=>s.text)).join("")}}class Er{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Er)return s;if(typeof s=="number")return new Er([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const l of s)if(typeof l!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new Er(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,p){return new Er(ia(s.values,l.values,p))}}class Hr{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Hr)return s;if(typeof s=="number")return new Hr([s]);if(Array.isArray(s)){for(const l of s)if(typeof l!="number")return;return new Hr(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,p){return new Hr(ia(s.values,l.values,p))}}class or{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof or)return s;if(typeof s=="string"){const p=Tn.parse(s);return p?new or([p]):void 0}if(!Array.isArray(s))return;const l=[];for(const p of s){if(typeof p!="string")return;const _=Tn.parse(p);if(!_)return;l.push(_)}return new or(l)}toString(){return JSON.stringify(this.values)}static interpolate(s,l,p,_="rgb"){const b=[];if(s.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${s.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let T=0;T<s.values.length;T++)b.push(Tn.interpolate(s.values[T],l.values[T],p,_));return new or(b)}}class rr extends Error{constructor(s){super(s),this.name="RuntimeError"}toJSON(){return this.message}}const Fh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Zr{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Zr)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let l=0;l<s.length;l+=2){const p=s[l],_=s[l+1];if(typeof p!="string"||!Fh.has(p)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Zr(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,p){const _=s.values,b=l.values;if(_.length!==b.length)throw new rr(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${l.toString()}`);const T=[];for(let C=0;C<_.length;C+=2){if(_[C]!==b[C])throw new rr(`Cannot interpolate values containing mismatched anchors. from[${C}]: ${_[C]}, to[${C}]: ${b[C]}`);T.push(_[C]);const[M,O]=_[C+1],[F,V]=b[C+1];T.push([ao(M,F,p),ao(O,V,p)])}return new Zr(T)}}class ls{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new ls({name:s,available:!1}):null}}class li{constructor(s,l,p){this.from=s,this.to=l,this.transition=p}static interpolate(s,l,p){return new li(s,l,p)}static parse(s){return s instanceof li?s:Array.isArray(s)&&s.length===3&&typeof s[0]=="string"&&typeof s[1]=="string"&&typeof s[2]=="number"?new li(s[0],s[1],s[2]):typeof s=="object"&&typeof s.from=="string"&&typeof s.to=="string"&&typeof s.transition=="number"?new li(s.from,s.to,s.transition):typeof s=="string"?new li(s,s,1):void 0}}function er(u,s,l,p){return typeof u=="number"&&u>=0&&u<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,s,l,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,s,l,p]:[u,s,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sa(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof li||u instanceof Tn||u instanceof lo||u instanceof Pr||u instanceof Er||u instanceof Hr||u instanceof or||u instanceof Zr||u instanceof ls)return!0;if(Array.isArray(u)){for(const s of u)if(!sa(s))return!1;return!0}if(typeof u=="object"){for(const s in u)if(!sa(u[s]))return!1;return!0}return!1}function rn(u){if(u===null)return _i;if(typeof u=="string")return bn;if(typeof u=="boolean")return dn;if(typeof u=="number")return St;if(u instanceof Tn)return Yr;if(u instanceof li)return ta;if(u instanceof lo)return Mc;if(u instanceof Pr)return Co;if(u instanceof Er)return Rc;if(u instanceof Hr)return Il;if(u instanceof or)return oo;if(u instanceof Zr)return ku;if(u instanceof ls)return An;if(Array.isArray(u)){const s=u.length;let l;for(const p of u){const _=rn(p);if(l){if(l===_)continue;l=yn;break}l=_}return yi(l||yn,s)}return na}function cn(u){const s=typeof u;return u===null?"":s==="string"||s==="number"||s==="boolean"?String(u):u instanceof Tn||u instanceof li||u instanceof Pr||u instanceof Er||u instanceof Hr||u instanceof or||u instanceof Zr||u instanceof ls?u.toString():JSON.stringify(u)}class cs{constructor(s,l){this.type=s,this.value=l}static parse(s,l){if(s.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!sa(s[1]))return l.error("invalid value");const p=s[1];let _=rn(p);const b=l.expectedType;return _.kind!=="array"||_.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(_=b),new cs(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const En={string:bn,number:St,boolean:dn,object:na};class vi{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let p,_=1;const b=s[0];if(b==="array"){let C,M;if(s.length>2){const O=s[1];if(typeof O!="string"||!(O in En)||O==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);C=En[O],_++}else C=yn;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=s[2],_++}p=yi(C,M)}else{if(!En[b])throw new Error(`Types doesn't contain name = ${b}`);p=En[b]}const T=[];for(;_<s.length;_++){const C=l.parse(s[_],_,yn);if(!C)return null;T.push(C)}return new vi(p,T)}evaluate(s){for(let l=0;l<this.args.length;l++){const p=this.args[l].evaluate(s);if(!Dc(this.type,rn(p)))return p;if(l===this.args.length-1)throw new rr(`Expected value to be of type ${Qn(this.type)}, but found ${Qn(rn(p))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every((s=>s.outputDefined()))}}const co={"to-boolean":dn,"to-color":Yr,"to-number":St,"to-string":bn};class uo{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const p=s[0];if(!co[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&s.length!==2)return l.error("Expected one argument.");const _=co[p],b=[];for(let T=1;T<s.length;T++){const C=l.parse(s[T],T,yn);if(!C)return null;b.push(C)}return new uo(_,b)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let l,p;for(const _ of this.args){if(l=_.evaluate(s),p=null,l instanceof Tn)return l;if(typeof l=="string"){const b=s.parseColor(l);if(b)return b}else if(Array.isArray(l)&&(p=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:er(l[0],l[1],l[2],l[3]),!p))return new Tn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new rr(p||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const p of this.args){l=p.evaluate(s);const _=Er.parse(l);if(_)return _}throw new rr(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(const p of this.args){l=p.evaluate(s);const _=Hr.parse(l);if(_)return _}throw new rr(`Could not parse numberArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(const p of this.args){l=p.evaluate(s);const _=or.parse(l);if(_)return _}throw new rr(`Could not parse colorArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const p of this.args){l=p.evaluate(s);const _=Zr.parse(l);if(_)return _}throw new rr(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const p of this.args){if(l=p.evaluate(s),l===null)return 0;const _=Number(l);if(!isNaN(_))return _}throw new rr(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Pr.fromString(cn(this.args[0].evaluate(s)));case"resolvedImage":return ls.fromString(cn(this.args[0].evaluate(s)));case"projectionDefinition":return this.args[0].evaluate(s);default:return cn(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every((s=>s.outputDefined()))}}const Dl=["Unknown","Point","LineString","Polygon"];class Ol{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Dl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let l=this._parseColorCache.get(s);return l||(l=Tn.parse(s),this._parseColorCache.set(s,l)),l}}class oa{constructor(s,l,p=[],_,b=new Eo,T=[]){this.registry=s,this.path=p,this.key=p.map((C=>`[${C}]`)).join(""),this.scope=b,this.errors=T,this.expectedType=_,this._isConstant=l}parse(s,l,p,_,b={}){return l?this.concat(l,p,_)._parse(s,b):this._parse(s,b)}_parse(s,l){function p(_,b,T){return T==="assert"?new vi(b,[_]):T==="coerce"?new uo(b,[_]):_}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=s[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[_];if(b){let T=b.parse(s,this);if(!T)return null;if(this.expectedType){const C=this.expectedType,M=T.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||M.kind!=="value"){if(C.kind==="projectionDefinition"&&["string","array"].includes(M.kind)||["color","formatted","resolvedImage"].includes(C.kind)&&["value","string"].includes(M.kind)||["padding","numberArray"].includes(C.kind)&&["value","number","array"].includes(M.kind)||C.kind==="colorArray"&&["value","string","array"].includes(M.kind)||C.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(M.kind))T=p(T,C,l.typeAnnotation||"coerce");else if(this.checkSubtype(C,M))return null}else T=p(T,C,l.typeAnnotation||"assert")}if(!(T instanceof cs)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const C=new Ol;try{T=new cs(T.type,T.evaluate(C))}catch(M){return this.error(M.message),null}}return T}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,l,p){const _=typeof s=="number"?this.path.concat(s):this.path,b=p?this.scope.concat(p):this.scope;return new oa(this.registry,this._isConstant,_,l||null,b,this.errors)}error(s,...l){const p=`${this.key}${l.map((_=>`[${_}]`)).join("")}`;this.errors.push(new gi(p,s))}checkSubtype(s,l){const p=Dc(s,l);return p&&this.error(p),p}}class Ll{constructor(s,l){this.type=l.type,this.bindings=[].concat(s),this.result=l}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const l of this.bindings)s(l[1]);s(this.result)}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const p=[];for(let b=1;b<s.length-1;b+=2){const T=s[b];if(typeof T!="string")return l.error(`Expected string, but found ${typeof T} instead.`,b);if(/[^a-zA-Z0-9_]/.test(T))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);const C=l.parse(s[b+1],b+1);if(!C)return null;p.push([T,C])}const _=l.parse(s[s.length-1],s.length-1,l.expectedType,p);return _?new Ll(p,_):null}outputDefined(){return this.result.outputDefined()}}class Ws{constructor(s,l){this.type=l.type,this.name=s,this.boundExpression=l}static parse(s,l){if(s.length!==2||typeof s[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const p=s[1];return l.scope.has(p)?new Ws(p,l.scope.get(p)):l.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Fl{constructor(s,l,p){this.type=s,this.index=l,this.input=p}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const p=l.parse(s[1],1,St),_=l.parse(s[2],2,yi(l.expectedType||yn));return p&&_?new Fl(_.type.itemType,p,_):null}evaluate(s){const l=this.index.evaluate(s),p=this.input.evaluate(s);if(l<0)throw new rr(`Array index out of bounds: ${l} < 0.`);if(l>=p.length)throw new rr(`Array index out of bounds: ${l} > ${p.length-1}.`);if(l!==Math.floor(l))throw new rr(`Array index must be an integer, but found ${l} instead.`);return p[l]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class Ua{constructor(s,l){this.type=dn,this.needle=s,this.haystack=l}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const p=l.parse(s[1],1,yn),_=l.parse(s[2],2,yn);return p&&_?Du(p.type,[dn,bn,St,_i,yn])?new Ua(p,_):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(p.type)} instead`):null}evaluate(s){const l=this.needle.evaluate(s),p=this.haystack.evaluate(s);if(!p)return!1;if(!Vs(l,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(rn(l))} instead.`);if(!Vs(p,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${Qn(rn(p))} instead.`);return p.indexOf(l)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Ss{constructor(s,l,p){this.type=St,this.needle=s,this.haystack=l,this.fromIndex=p}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${s.length-1} instead.`);const p=l.parse(s[1],1,yn),_=l.parse(s[2],2,yn);if(!p||!_)return null;if(!Du(p.type,[dn,bn,St,_i,yn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(p.type)} instead`);if(s.length===4){const b=l.parse(s[3],3,St);return b?new Ss(p,_,b):null}return new Ss(p,_)}evaluate(s){const l=this.needle.evaluate(s),p=this.haystack.evaluate(s);if(!Vs(l,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${Qn(rn(l))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(s)),Vs(p,["string"])){const b=p.indexOf(l,_);return b===-1?-1:[...p.slice(0,b)].length}if(Vs(p,["array"]))return p.indexOf(l,_);throw new rr(`Expected second argument to be of type array or string, but found ${Qn(rn(p))} instead.`)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Dr{constructor(s,l,p,_,b,T){this.inputType=s,this.type=l,this.input=p,this.cases=_,this.outputs=b,this.otherwise=T}static parse(s,l){if(s.length<5)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return l.error("Expected an even number of arguments.");let p,_;l.expectedType&&l.expectedType.kind!=="value"&&(_=l.expectedType);const b={},T=[];for(let O=2;O<s.length-1;O+=2){let F=s[O];const V=s[O+1];Array.isArray(F)||(F=[F]);const H=l.concat(O);if(F.length===0)return H.error("Expected at least one branch label.");for(const q of F){if(typeof q!="number"&&typeof q!="string")return H.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return H.error("Numeric branch labels must be integer values.");if(p){if(H.checkSubtype(p,rn(q)))return null}else p=rn(q);if(b[String(q)]!==void 0)return H.error("Branch labels must be unique.");b[String(q)]=T.length}const X=l.parse(V,O,_);if(!X)return null;_=_||X.type,T.push(X)}const C=l.parse(s[1],1,yn);if(!C)return null;const M=l.parse(s[s.length-1],s.length-1,_);return M?C.type.kind!=="value"&&l.concat(1).checkSubtype(p,C.type)?null:new Dr(p,_,C,b,T,M):null}evaluate(s){const l=this.input.evaluate(s);return(rn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every((s=>s.outputDefined()))&&this.otherwise.outputDefined()}}class Ro{constructor(s,l,p){this.type=s,this.branches=l,this.otherwise=p}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return l.error("Expected an odd number of arguments.");let p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const _=[];for(let T=1;T<s.length-1;T+=2){const C=l.parse(s[T],T,dn);if(!C)return null;const M=l.parse(s[T+1],T+1,p);if(!M)return null;_.push([C,M]),p=p||M.type}const b=l.parse(s[s.length-1],s.length-1,p);if(!b)return null;if(!p)throw new Error("Can't infer output type");return new Ro(p,_,b)}evaluate(s){for(const[l,p]of this.branches)if(l.evaluate(s))return p.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[l,p]of this.branches)s(l),s(p);s(this.otherwise)}outputDefined(){return this.branches.every((([s,l])=>l.outputDefined()))&&this.otherwise.outputDefined()}}class Nl{constructor(s,l,p,_){this.type=s,this.input=l,this.beginIndex=p,this.endIndex=_}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${s.length-1} instead.`);const p=l.parse(s[1],1,yn),_=l.parse(s[2],2,St);if(!p||!_)return null;if(!Du(p.type,[yi(yn),bn,yn]))return l.error(`Expected first argument to be of type array or string, but found ${Qn(p.type)} instead`);if(s.length===4){const b=l.parse(s[3],3,St);return b?new Nl(p.type,p,_,b):null}return new Nl(p.type,p,_)}evaluate(s){const l=this.input.evaluate(s),p=this.beginIndex.evaluate(s);let _;if(this.endIndex&&(_=this.endIndex.evaluate(s)),Vs(l,["string"]))return[...l].slice(p,_).join("");if(Vs(l,["array"]))return l.slice(p,_);throw new rr(`Expected first argument to be of type array or string, but found ${Qn(rn(l))} instead.`)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Xr(u,s){const l=u.length-1;let p,_,b=0,T=l,C=0;for(;b<=T;)if(C=Math.floor((b+T)/2),p=u[C],_=u[C+1],p<=s){if(C===l||s<_)return C;b=C+1}else{if(!(p>s))throw new rr("Input is not a number.");T=C-1}return 0}class ar{constructor(s,l,p){this.type=s,this.input=l,this.labels=[],this.outputs=[];for(const[_,b]of p)this.labels.push(_),this.outputs.push(b)}static parse(s,l){if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");const p=l.parse(s[1],1,St);if(!p)return null;const _=[];let b=null;l.expectedType&&l.expectedType.kind!=="value"&&(b=l.expectedType);for(let T=1;T<s.length;T+=2){const C=T===1?-1/0:s[T],M=s[T+1],O=T,F=T+1;if(typeof C!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(_.length&&_[_.length-1][0]>=C)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const V=l.parse(M,F,b);if(!V)return null;b=b||V.type,_.push([C,V])}return new ar(b,p,_)}evaluate(s){const l=this.labels,p=this.outputs;if(l.length===1)return p[0].evaluate(s);const _=this.input.evaluate(s);if(_<=l[0])return p[0].evaluate(s);const b=l.length;return _>=l[b-1]?p[b-1].evaluate(s):p[Xr(l,_)].evaluate(s)}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every((s=>s.outputDefined()))}}function Fu(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var ko,Nh,Bh=(function(){if(Nh)return ko;function u(s,l,p,_){this.cx=3*s,this.bx=3*(p-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(_-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=p,this.p2y=_}return Nh=1,ko=u,u.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(l===void 0&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var p=s,_=0;_<8;_++){var b=this.sampleCurveX(p)-s;if(Math.abs(b)<l)return p;var T=this.sampleCurveDerivativeX(p);if(Math.abs(T)<1e-6)break;p-=b/T}var C=0,M=1;for(p=s,_=0;_<20&&(b=this.sampleCurveX(p),!(Math.abs(b-s)<l));_++)s>b?C=p:M=p,p=.5*(M-C)+C;return p},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},ko})(),aa=Fu(Bh);class Or{constructor(s,l,p,_,b){this.type=s,this.operator=l,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[T,C]of b)this.labels.push(T),this.outputs.push(C)}static interpolationFactor(s,l,p,_){let b=0;if(s.name==="exponential")b=la(l,s.base,p,_);else if(s.name==="linear")b=la(l,1,p,_);else if(s.name==="cubic-bezier"){const T=s.controlPoints;b=new aa(T[0],T[1],T[2],T[3]).solve(la(l,1,p,_))}return b}static parse(s,l){let[p,_,b,...T]=s;if(!Array.isArray(_)||_.length===0)return l.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const O=_[1];if(typeof O!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:O}}else{if(_[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const O=_.slice(1);if(O.length!==4||O.some((F=>typeof F!="number"||F<0||F>1)))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:O}}}if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(b=l.parse(b,2,St),!b)return null;const C=[];let M=null;p!=="interpolate-hcl"&&p!=="interpolate-lab"||l.expectedType==oo?l.expectedType&&l.expectedType.kind!=="value"&&(M=l.expectedType):M=Yr;for(let O=0;O<T.length;O+=2){const F=T[O],V=T[O+1],H=O+3,X=O+4;if(typeof F!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(C.length&&C[C.length-1][0]>=F)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const q=l.parse(V,X,M);if(!q)return null;M=M||q.type,C.push([F,q])}return ai(M,St)||ai(M,ta)||ai(M,Yr)||ai(M,Rc)||ai(M,Il)||ai(M,oo)||ai(M,ku)||ai(M,yi(St))?new Or(M,p,_,b,C):l.error(`Type ${Qn(M)} is not interpolatable.`)}evaluate(s){const l=this.labels,p=this.outputs;if(l.length===1)return p[0].evaluate(s);const _=this.input.evaluate(s);if(_<=l[0])return p[0].evaluate(s);const b=l.length;if(_>=l[b-1])return p[b-1].evaluate(s);const T=Xr(l,_),C=Or.interpolationFactor(this.interpolation,_,l[T],l[T+1]),M=p[T].evaluate(s),O=p[T+1].evaluate(s);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ao(M,O,C);case"color":return Tn.interpolate(M,O,C);case"padding":return Er.interpolate(M,O,C);case"colorArray":return or.interpolate(M,O,C);case"numberArray":return Hr.interpolate(M,O,C);case"variableAnchorOffsetCollection":return Zr.interpolate(M,O,C);case"array":return ia(M,O,C);case"projectionDefinition":return li.interpolate(M,O,C)}case"interpolate-hcl":switch(this.type.kind){case"color":return Tn.interpolate(M,O,C,"hcl");case"colorArray":return or.interpolate(M,O,C,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Tn.interpolate(M,O,C,"lab");case"colorArray":return or.interpolate(M,O,C,"lab")}}}eachChild(s){s(this.input);for(const l of this.outputs)s(l)}outputDefined(){return this.outputs.every((s=>s.outputDefined()))}}function la(u,s,l,p){const _=p-l,b=u-l;return _===0?0:s===1?b/_:(Math.pow(s,b)-1)/(Math.pow(s,_)-1)}const Hs={color:Tn.interpolate,number:ao,padding:Er.interpolate,numberArray:Hr.interpolate,colorArray:or.interpolate,variableAnchorOffsetCollection:Zr.interpolate,array:ia};class Nc{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let p=null;const _=l.expectedType;_&&_.kind!=="value"&&(p=_);const b=[];for(const C of s.slice(1)){const M=l.parse(C,1+b.length,p,void 0,{typeAnnotation:"omit"});if(!M)return null;p=p||M.type,b.push(M)}if(!p)throw new Error("No output type");const T=_&&b.some((C=>Dc(_,C.type)));return new Nc(T?yn:p,b)}evaluate(s){let l,p=null,_=0;for(const b of this.args)if(_++,p=b.evaluate(s),p&&p instanceof ls&&!p.available&&(l||(l=p.name),p=null,_===this.args.length&&(p=l)),p!==null)break;return p}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every((s=>s.outputDefined()))}}function Bc(u,s){return u==="=="||u==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function zc(u,s,l,p){return p.compare(s,l)===0}function Kr(u,s,l){const p=u!=="=="&&u!=="!=";return class eE{constructor(b,T,C){this.type=dn,this.lhs=b,this.rhs=T,this.collator=C,this.hasUntypedArgument=b.type.kind==="value"||T.type.kind==="value"}static parse(b,T){if(b.length!==3&&b.length!==4)return T.error("Expected two or three arguments.");const C=b[0];let M=T.parse(b[1],1,yn);if(!M)return null;if(!Bc(C,M.type))return T.concat(1).error(`"${C}" comparisons are not supported for type '${Qn(M.type)}'.`);let O=T.parse(b[2],2,yn);if(!O)return null;if(!Bc(C,O.type))return T.concat(2).error(`"${C}" comparisons are not supported for type '${Qn(O.type)}'.`);if(M.type.kind!==O.type.kind&&M.type.kind!=="value"&&O.type.kind!=="value")return T.error(`Cannot compare types '${Qn(M.type)}' and '${Qn(O.type)}'.`);p&&(M.type.kind==="value"&&O.type.kind!=="value"?M=new vi(O.type,[M]):M.type.kind!=="value"&&O.type.kind==="value"&&(O=new vi(M.type,[O])));let F=null;if(b.length===4){if(M.type.kind!=="string"&&O.type.kind!=="string"&&M.type.kind!=="value"&&O.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(F=T.parse(b[3],3,Mc),!F)return null}return new eE(M,O,F)}evaluate(b){const T=this.lhs.evaluate(b),C=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){const M=rn(T),O=rn(C);if(M.kind!==O.kind||M.kind!=="string"&&M.kind!=="number")throw new rr(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${M.kind}, ${O.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const M=rn(T),O=rn(C);if(M.kind!=="string"||O.kind!=="string")return s(b,T,C)}return this.collator?l(b,T,C,this.collator.evaluate(b)):s(b,T,C)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const Kd=Kr("==",(function(u,s,l){return s===l}),zc),Nu=Kr("!=",(function(u,s,l){return s!==l}),(function(u,s,l,p){return!zc(0,s,l,p)})),Fp=Kr("<",(function(u,s,l){return s<l}),(function(u,s,l,p){return p.compare(s,l)<0})),zh=Kr(">",(function(u,s,l){return s>l}),(function(u,s,l,p){return p.compare(s,l)>0})),Np=Kr("<=",(function(u,s,l){return s<=l}),(function(u,s,l,p){return p.compare(s,l)<=0})),Jd=Kr(">=",(function(u,s,l){return s>=l}),(function(u,s,l,p){return p.compare(s,l)>=0}));class Bu{constructor(s,l,p){this.type=Mc,this.locale=p,this.caseSensitive=s,this.diacriticSensitive=l}static parse(s,l){if(s.length!==2)return l.error("Expected one argument.");const p=s[1];if(typeof p!="object"||Array.isArray(p))return l.error("Collator options argument must be an object.");const _=l.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,dn);if(!_)return null;const b=l.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,dn);if(!b)return null;let T=null;return p.locale&&(T=l.parse(p.locale,1,bn),!T)?null:new Bu(_,b,T)}evaluate(s){return new lo(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}class Uh{constructor(s,l,p,_,b){this.type=bn,this.number=s,this.locale=l,this.currency=p,this.minFractionDigits=_,this.maxFractionDigits=b}static parse(s,l){if(s.length!==3)return l.error("Expected two arguments.");const p=l.parse(s[1],1,St);if(!p)return null;const _=s[2];if(typeof _!="object"||Array.isArray(_))return l.error("NumberFormat options argument must be an object.");let b=null;if(_.locale&&(b=l.parse(_.locale,1,bn),!b))return null;let T=null;if(_.currency&&(T=l.parse(_.currency,1,bn),!T))return null;let C=null;if(_["min-fraction-digits"]&&(C=l.parse(_["min-fraction-digits"],1,St),!C))return null;let M=null;return _["max-fraction-digits"]&&(M=l.parse(_["max-fraction-digits"],1,St),!M)?null:new Uh(p,b,T,C,M)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Va{constructor(s){this.type=Co,this.sections=s}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");const p=s[1];if(!Array.isArray(p)&&typeof p=="object")return l.error("First argument must be an image or text section.");const _=[];let b=!1;for(let T=1;T<=s.length-1;++T){const C=s[T];if(b&&typeof C=="object"&&!Array.isArray(C)){b=!1;let M=null;if(C["font-scale"]&&(M=l.parse(C["font-scale"],1,St),!M))return null;let O=null;if(C["text-font"]&&(O=l.parse(C["text-font"],1,yi(bn)),!O))return null;let F=null;if(C["text-color"]&&(F=l.parse(C["text-color"],1,Yr),!F))return null;let V=null;if(C["vertical-align"]){if(typeof C["vertical-align"]=="string"&&!js.includes(C["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${C["vertical-align"]}' instead.`);if(V=l.parse(C["vertical-align"],1,bn),!V)return null}const H=_[_.length-1];H.scale=M,H.font=O,H.textColor=F,H.verticalAlign=V}else{const M=l.parse(s[T],1,yn);if(!M)return null;const O=M.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,_.push({content:M,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Va(_)}evaluate(s){return new Pr(this.sections.map((l=>{const p=l.content.evaluate(s);return rn(p)===An?new $s("",p,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(s):null):new $s(cn(p),null,l.scale?l.scale.evaluate(s):null,l.font?l.font.evaluate(s).join(","):null,l.textColor?l.textColor.evaluate(s):null,l.verticalAlign?l.verticalAlign.evaluate(s):null)})))}eachChild(s){for(const l of this.sections)s(l.content),l.scale&&s(l.scale),l.font&&s(l.font),l.textColor&&s(l.textColor),l.verticalAlign&&s(l.verticalAlign)}outputDefined(){return!1}}class Vh{constructor(s){this.type=An,this.input=s}static parse(s,l){if(s.length!==2)return l.error("Expected two arguments.");const p=l.parse(s[1],1,bn);return p?new Vh(p):l.error("No image name provided.")}evaluate(s){const l=this.input.evaluate(s),p=ls.fromString(l);return p&&s.availableImages&&(p.available=s.availableImages.indexOf(l)>-1),p}eachChild(s){s(this.input)}outputDefined(){return!1}}class Bl{constructor(s){this.type=St,this.input=s}static parse(s,l){if(s.length!==2)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);const p=l.parse(s[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Qn(p.type)} instead.`):new Bl(p):null}evaluate(s){const l=this.input.evaluate(s);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new rr(`Expected value to be of type string or array, but found ${Qn(rn(l))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const Zs=8192;function Bp(u,s){const l=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(l*_*Zs),Math.round(p*_*Zs)]}function zu(u,s){const l=Math.pow(2,s.z);return[(_=(u[0]/Zs+s.x)/l,360*_-180),(p=(u[1]/Zs+s.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,_}function zl(u,s){u[0]=Math.min(u[0],s[0]),u[1]=Math.min(u[1],s[1]),u[2]=Math.max(u[2],s[0]),u[3]=Math.max(u[3],s[1])}function Uc(u,s){return!(u[0]<=s[0]||u[2]>=s[2]||u[1]<=s[1]||u[3]>=s[3])}function zp(u,s,l){const p=u[0]-s[0],_=u[1]-s[1],b=u[0]-l[0],T=u[1]-l[1];return p*T-b*_==0&&p*b<=0&&_*T<=0}function Uu(u,s,l,p){return(_=[p[0]-l[0],p[1]-l[1]])[0]*(b=[s[0]-u[0],s[1]-u[1]])[1]-_[1]*b[0]!=0&&!(!Ul(u,s,l,p)||!Ul(l,p,u,s));var _,b}function Up(u,s,l){for(const p of l)for(let _=0;_<p.length-1;++_)if(Uu(u,s,p[_],p[_+1]))return!0;return!1}function ja(u,s,l=!1){let p=!1;for(const C of s)for(let M=0;M<C.length-1;M++){if(zp(u,C[M],C[M+1]))return l;(b=C[M])[1]>(_=u)[1]!=(T=C[M+1])[1]>_[1]&&_[0]<(T[0]-b[0])*(_[1]-b[1])/(T[1]-b[1])+b[0]&&(p=!p)}var _,b,T;return p}function Qd(u,s){for(const l of s)if(ja(u,l))return!0;return!1}function jh(u,s){for(const l of u)if(!ja(l,s))return!1;for(let l=0;l<u.length-1;++l)if(Up(u[l],u[l+1],s))return!1;return!0}function $h(u,s){for(const l of s)if(jh(u,l))return!0;return!1}function Ul(u,s,l,p){const _=p[0]-l[0],b=p[1]-l[1],T=(u[0]-l[0])*b-_*(u[1]-l[1]),C=(s[0]-l[0])*b-_*(s[1]-l[1]);return T>0&&C<0||T<0&&C>0}function Wh(u,s,l){const p=[];for(let _=0;_<u.length;_++){const b=[];for(let T=0;T<u[_].length;T++){const C=Bp(u[_][T],l);zl(s,C),b.push(C)}p.push(b)}return p}function Hh(u,s,l){const p=[];for(let _=0;_<u.length;_++){const b=Wh(u[_],s,l);p.push(b)}return p}function Vc(u,s,l,p){if(u[0]<l[0]||u[0]>l[2]){const _=.5*p;let b=u[0]-l[0]>_?-p:l[0]-u[0]>_?p:0;b===0&&(b=u[0]-l[2]>_?-p:l[2]-u[0]>_?p:0),u[0]+=b}zl(s,u)}function Zh(u,s,l,p){const _=Math.pow(2,p.z)*Zs,b=[p.x*Zs,p.y*Zs],T=[];for(const C of u)for(const M of C){const O=[M.x+b[0],M.y+b[1]];Vc(O,s,l,_),T.push(O)}return T}function Xh(u,s,l,p){const _=Math.pow(2,p.z)*Zs,b=[p.x*Zs,p.y*Zs],T=[];for(const M of u){const O=[];for(const F of M){const V=[F.x+b[0],F.y+b[1]];zl(s,V),O.push(V)}T.push(O)}if(s[2]-s[0]<=_/2){(C=s)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const M of T)for(const O of M)Vc(O,s,l,_)}var C;return T}class ca{constructor(s,l){this.type=dn,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(sa(s[1])){const p=s[1];if(p.type==="FeatureCollection"){const _=[];for(const b of p.features){const{type:T,coordinates:C}=b.geometry;T==="Polygon"&&_.push(C),T==="MultiPolygon"&&_.push(...C)}if(_.length)return new ca(p,{type:"MultiPolygon",coordinates:_})}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ca(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ca(p,p)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return(function(l,p){const _=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],T=l.canonicalID();if(p.type==="Polygon"){const C=Wh(p.coordinates,b,T),M=Zh(l.geometry(),_,b,T);if(!Uc(_,b))return!1;for(const O of M)if(!ja(O,C))return!1}if(p.type==="MultiPolygon"){const C=Hh(p.coordinates,b,T),M=Zh(l.geometry(),_,b,T);if(!Uc(_,b))return!1;for(const O of M)if(!Qd(O,C))return!1}return!0})(s,this.geometries);if(s.geometryType()==="LineString")return(function(l,p){const _=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],T=l.canonicalID();if(p.type==="Polygon"){const C=Wh(p.coordinates,b,T),M=Xh(l.geometry(),_,b,T);if(!Uc(_,b))return!1;for(const O of M)if(!jh(O,C))return!1}if(p.type==="MultiPolygon"){const C=Hh(p.coordinates,b,T),M=Xh(l.geometry(),_,b,T);if(!Uc(_,b))return!1;for(const O of M)if(!$h(O,C))return!1}return!0})(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ua=class{constructor(u=[],s=(l,p)=>l<p?-1:l>p?1:0){if(this.data=u,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(this.length===0)return;const u=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:s,compare:l}=this,p=s[u];for(;u>0;){const _=u-1>>1,b=s[_];if(l(p,b)>=0)break;s[u]=b,u=_}s[u]=p}_down(u){const{data:s,compare:l}=this,p=this.length>>1,_=s[u];for(;u<p;){let b=1+(u<<1);const T=b+1;if(T<this.length&&l(s[T],s[b])<0&&(b=T),l(s[b],_)>=0)break;s[u]=s[b],u=b}s[u]=_}};function qh(u,s,l=0,p=u.length-1,_=Vp){for(;p>l;){if(p-l>600){const M=p-l+1,O=s-l+1,F=Math.log(M),V=.5*Math.exp(2*F/3),H=.5*Math.sqrt(F*V*(M-V)/M)*(O-M/2<0?-1:1);qh(u,s,Math.max(l,Math.floor(s-O*V/M+H)),Math.min(p,Math.floor(s+(M-O)*V/M+H)),_)}const b=u[s];let T=l,C=p;for(jc(u,l,s),_(u[p],b)>0&&jc(u,l,p);T<C;){for(jc(u,T,C),T++,C--;_(u[T],b)<0;)T++;for(;_(u[C],b)>0;)C--}_(u[l],b)===0?jc(u,l,C):(C++,jc(u,C,p)),C<=s&&(l=C+1),s<=C&&(p=C-1)}}function jc(u,s,l){const p=u[s];u[s]=u[l],u[l]=p}function Vp(u,s){return u<s?-1:u>s?1:0}function Vl(u,s){if(u.length<=1)return[u];const l=[];let p,_;for(const b of u){const T=$c(b);T!==0&&(b.area=Math.abs(T),_===void 0&&(_=T<0),_===T<0?(p&&l.push(p),p=[b]):p.push(b))}if(p&&l.push(p),s>1)for(let b=0;b<l.length;b++)l[b].length<=s||(qh(l[b],s,1,l[b].length-1,Gh),l[b]=l[b].slice(0,s));return l}function Gh(u,s){return s.area-u.area}function $c(u){let s=0;for(let l,p,_=0,b=u.length,T=b-1;_<b;T=_++)l=u[_],p=u[T],s+=(p.x-l.x)*(l.y+p.y);return s}const jl=1/298.257223563,ef=jl*(2-jl),$l=Math.PI/180;class Yh{constructor(s){const l=6378.137*$l*1e3,p=Math.cos(s*$l),_=1/(1-ef*(1-p*p)),b=Math.sqrt(_);this.kx=l*b*p,this.ky=l*b*_*(1-ef)}distance(s,l){const p=this.wrap(s[0]-l[0])*this.kx,_=(s[1]-l[1])*this.ky;return Math.sqrt(p*p+_*_)}pointOnLine(s,l){let p,_,b,T,C=1/0;for(let M=0;M<s.length-1;M++){let O=s[M][0],F=s[M][1],V=this.wrap(s[M+1][0]-O)*this.kx,H=(s[M+1][1]-F)*this.ky,X=0;V===0&&H===0||(X=(this.wrap(l[0]-O)*this.kx*V+(l[1]-F)*this.ky*H)/(V*V+H*H),X>1?(O=s[M+1][0],F=s[M+1][1]):X>0&&(O+=V/this.kx*X,F+=H/this.ky*X)),V=this.wrap(l[0]-O)*this.kx,H=(l[1]-F)*this.ky;const q=V*V+H*H;q<C&&(C=q,p=O,_=F,b=M,T=X)}return{point:[p,_],index:b,t:Math.max(0,Math.min(1,T))}}wrap(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}}function Kh(u,s){return s[0]-u[0]}function Wl(u){return u[1]-u[0]+1}function Xs(u,s){return u[1]>=u[0]&&u[1]<s}function Fn(u,s){if(u[0]>u[1])return[null,null];const l=Wl(u);if(s){if(l===2)return[u,null];const _=Math.floor(l/2);return[[u[0],u[0]+_],[u[0]+_,u[1]]]}if(l===1)return[u,null];const p=Math.floor(l/2)-1;return[[u[0],u[0]+p],[u[0]+p+1,u[1]]]}function Vu(u,s){if(!Xs(s,u.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let p=s[0];p<=s[1];++p)zl(l,u[p]);return l}function ju(u){const s=[1/0,1/0,-1/0,-1/0];for(const l of u)for(const p of l)zl(s,p);return s}function tf(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function Jh(u,s,l){if(!tf(u)||!tf(s))return NaN;let p=0,_=0;return u[2]<s[0]&&(p=s[0]-u[2]),u[0]>s[2]&&(p=u[0]-s[2]),u[1]>s[3]&&(_=u[1]-s[3]),u[3]<s[1]&&(_=s[1]-u[3]),l.distance([0,0],[p,_])}function $a(u,s,l){const p=l.pointOnLine(s,u);return l.distance(u,p.point)}function Qh(u,s,l,p,_){const b=Math.min($a(u,[l,p],_),$a(s,[l,p],_)),T=Math.min($a(l,[u,s],_),$a(p,[u,s],_));return Math.min(b,T)}function jp(u,s,l,p,_){if(!Xs(s,u.length)||!Xs(p,l.length))return 1/0;let b=1/0;for(let T=s[0];T<s[1];++T){const C=u[T],M=u[T+1];for(let O=p[0];O<p[1];++O){const F=l[O],V=l[O+1];if(Uu(C,M,F,V))return 0;b=Math.min(b,Qh(C,M,F,V,_))}}return b}function qs(u,s,l,p,_){if(!Xs(s,u.length)||!Xs(p,l.length))return NaN;let b=1/0;for(let T=s[0];T<=s[1];++T)for(let C=p[0];C<=p[1];++C)if(b=Math.min(b,_.distance(u[T],l[C])),b===0)return b;return b}function Wc(u,s,l){if(ja(u,s,!0))return 0;let p=1/0;for(const _ of s){const b=_[0],T=_[_.length-1];if(b!==T&&(p=Math.min(p,$a(u,[T,b],l)),p===0))return p;const C=l.pointOnLine(_,u);if(p=Math.min(p,l.distance(u,C.point)),p===0)return p}return p}function nf(u,s,l,p){if(!Xs(s,u.length))return NaN;for(let b=s[0];b<=s[1];++b)if(ja(u[b],l,!0))return 0;let _=1/0;for(let b=s[0];b<s[1];++b){const T=u[b],C=u[b+1];for(const M of l)for(let O=0,F=M.length,V=F-1;O<F;V=O++){const H=M[V],X=M[O];if(Uu(T,C,H,X))return 0;_=Math.min(_,Qh(T,C,H,X,p))}}return _}function ed(u,s){for(const l of u)for(const p of l)if(ja(p,s,!0))return!0;return!1}function rf(u,s,l,p=1/0){const _=ju(u),b=ju(s);if(p!==1/0&&Jh(_,b,l)>=p)return p;if(Uc(_,b)){if(ed(u,s))return 0}else if(ed(s,u))return 0;let T=1/0;for(const C of u)for(let M=0,O=C.length,F=O-1;M<O;F=M++){const V=C[F],H=C[M];for(const X of s)for(let q=0,ee=X.length,se=ee-1;q<ee;se=q++){const pe=X[se],Ve=X[q];if(Uu(V,H,pe,Ve))return 0;T=Math.min(T,Qh(V,H,pe,Ve,l))}}return T}function td(u,s,l,p,_,b){if(!b)return;const T=Jh(Vu(p,b),_,l);T<s&&u.push([T,b,[0,0]])}function Hl(u,s,l,p,_,b,T){if(!b||!T)return;const C=Jh(Vu(p,b),Vu(_,T),l);C<s&&u.push([C,b,T])}function $u(u,s,l,p,_=1/0){let b=Math.min(p.distance(u[0],l[0][0]),_);if(b===0)return b;const T=new ua([[0,[0,u.length-1],[0,0]]],Kh),C=ju(l);for(;T.length>0;){const M=T.pop();if(M[0]>=b)continue;const O=M[1],F=s?50:100;if(Wl(O)<=F){if(!Xs(O,u.length))return NaN;if(s){const V=nf(u,O,l,p);if(isNaN(V)||V===0)return V;b=Math.min(b,V)}else for(let V=O[0];V<=O[1];++V){const H=Wc(u[V],l,p);if(b=Math.min(b,H),b===0)return 0}}else{const V=Fn(O,s);td(T,b,p,u,C,V[0]),td(T,b,p,u,C,V[1])}}return b}function Wu(u,s,l,p,_,b=1/0){let T=Math.min(b,_.distance(u[0],l[0]));if(T===0)return T;const C=new ua([[0,[0,u.length-1],[0,l.length-1]]],Kh);for(;C.length>0;){const M=C.pop();if(M[0]>=T)continue;const O=M[1],F=M[2],V=s?50:100,H=p?50:100;if(Wl(O)<=V&&Wl(F)<=H){if(!Xs(O,u.length)&&Xs(F,l.length))return NaN;let X;if(s&&p)X=jp(u,O,l,F,_),T=Math.min(T,X);else if(s&&!p){const q=u.slice(O[0],O[1]+1);for(let ee=F[0];ee<=F[1];++ee)if(X=$a(l[ee],q,_),T=Math.min(T,X),T===0)return T}else if(!s&&p){const q=l.slice(F[0],F[1]+1);for(let ee=O[0];ee<=O[1];++ee)if(X=$a(u[ee],q,_),T=Math.min(T,X),T===0)return T}else X=qs(u,O,l,F,_),T=Math.min(T,X)}else{const X=Fn(O,s),q=Fn(F,p);Hl(C,T,_,u,l,X[0],q[0]),Hl(C,T,_,u,l,X[0],q[1]),Hl(C,T,_,u,l,X[1],q[0]),Hl(C,T,_,u,l,X[1],q[1])}}return T}function ha(u){return u.type==="MultiPolygon"?u.coordinates.map((s=>({type:"Polygon",coordinates:s}))):u.type==="MultiLineString"?u.coordinates.map((s=>({type:"LineString",coordinates:s}))):u.type==="MultiPoint"?u.coordinates.map((s=>({type:"Point",coordinates:s}))):[u]}class Do{constructor(s,l){this.type=St,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${s.length-1} instead.`);if(sa(s[1])){const p=s[1];if(p.type==="FeatureCollection")return new Do(p,p.features.map((_=>ha(_.geometry))).flat());if(p.type==="Feature")return new Do(p,ha(p.geometry));if("type"in p&&"coordinates"in p)return new Do(p,ha(p))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return(function(l,p){const _=l.geometry(),b=_.flat().map((M=>zu([M.x,M.y],l.canonical)));if(_.length===0)return NaN;const T=new Yh(b[0][1]);let C=1/0;for(const M of p){switch(M.type){case"Point":C=Math.min(C,Wu(b,!1,[M.coordinates],!1,T,C));break;case"LineString":C=Math.min(C,Wu(b,!1,M.coordinates,!0,T,C));break;case"Polygon":C=Math.min(C,$u(b,!1,M.coordinates,T,C))}if(C===0)return C}return C})(s,this.geometries);if(s.geometryType()==="LineString")return(function(l,p){const _=l.geometry(),b=_.flat().map((M=>zu([M.x,M.y],l.canonical)));if(_.length===0)return NaN;const T=new Yh(b[0][1]);let C=1/0;for(const M of p){switch(M.type){case"Point":C=Math.min(C,Wu(b,!0,[M.coordinates],!1,T,C));break;case"LineString":C=Math.min(C,Wu(b,!0,M.coordinates,!0,T,C));break;case"Polygon":C=Math.min(C,$u(b,!0,M.coordinates,T,C))}if(C===0)return C}return C})(s,this.geometries);if(s.geometryType()==="Polygon")return(function(l,p){const _=l.geometry();if(_.length===0||_[0].length===0)return NaN;const b=Vl(_,0).map((M=>M.map((O=>O.map((F=>zu([F.x,F.y],l.canonical))))))),T=new Yh(b[0][0][0][1]);let C=1/0;for(const M of p)for(const O of b){switch(M.type){case"Point":C=Math.min(C,$u([M.coordinates],!1,O,T,C));break;case"LineString":C=Math.min(C,$u(M.coordinates,!0,O,T,C));break;case"Polygon":C=Math.min(C,rf(O,M.coordinates,T,C))}if(C===0)return C}return C})(s,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Oo{constructor(s){this.type=yn,this.key=s}static parse(s,l){if(s.length!==2)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);const p=s[1];return p==null?l.error("Global state property must be defined."):typeof p!="string"?l.error(`Global state property must be string, but found ${typeof s[1]} instead.`):new Oo(p)}evaluate(s){var l;const p=(l=s.globals)===null||l===void 0?void 0:l.globalState;return p&&Object.keys(p).length!==0?ra(p,this.key):null}eachChild(){}outputDefined(){return!1}}const da={"==":Kd,"!=":Nu,">":zh,"<":Fp,">=":Jd,"<=":Np,array:vi,at:Fl,boolean:vi,case:Ro,coalesce:Nc,collator:Bu,format:Va,image:Vh,in:Ua,"index-of":Ss,interpolate:Or,"interpolate-hcl":Or,"interpolate-lab":Or,length:Bl,let:Ll,literal:cs,match:Dr,number:vi,"number-format":Uh,object:vi,slice:Nl,step:ar,string:vi,"to-boolean":uo,"to-color":uo,"to-number":uo,"to-string":uo,var:Ws,within:ca,distance:Do,"global-state":Oo};class us{constructor(s,l,p,_){this.name=s,this.type=l,this._evaluate=p,this.args=_}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,l){const p=s[0],_=us.definitions[p];if(!_)return l.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(_)?_[0]:_.type,T=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,C=T.filter((([O])=>!Array.isArray(O)||O.length===s.length-1));let M=null;for(const[O,F]of C){M=new oa(l.registry,Ha,l.path,null,l.scope);const V=[];let H=!1;for(let X=1;X<s.length;X++){const q=s[X],ee=Array.isArray(O)?O[X-1]:O.type,se=M.parse(q,1+V.length,ee);if(!se){H=!0;break}V.push(se)}if(!H)if(Array.isArray(O)&&O.length!==V.length)M.error(`Expected ${O.length} arguments, but found ${V.length} instead.`);else{for(let X=0;X<V.length;X++){const q=Array.isArray(O)?O[X]:O.type,ee=V[X];M.concat(X+1).checkSubtype(q,ee.type)}if(M.errors.length===0)return new us(p,b,F,V)}}if(C.length===1)l.errors.push(...M.errors);else{const O=(C.length?C:T).map((([V])=>{return H=V,Array.isArray(H)?`(${H.map(Qn).join(", ")})`:`(${Qn(H.type)}...)`;var H})).join(" | "),F=[];for(let V=1;V<s.length;V++){const H=l.parse(s[V],1+F.length);if(!H)return null;F.push(Qn(H.type))}l.error(`Expected arguments of type ${O}, but found (${F.join(", ")}) instead.`)}return null}static register(s,l){us.definitions=l;for(const p in l)s[p]=us}}function Hc(u,[s,l,p,_]){s=s.evaluate(u),l=l.evaluate(u),p=p.evaluate(u);const b=_?_.evaluate(u):1,T=er(s,l,p,b);if(T)throw new rr(T);return new Tn(s/255,l/255,p/255,b,!1)}function Wa(u,s){return u in s}function Zc(u,s){const l=s[u];return l===void 0?null:l}function fa(u){return{type:u}}function Ha(u){if(u instanceof Ws)return Ha(u.boundExpression);if(u instanceof us&&u.name==="error"||u instanceof Bu||u instanceof ca||u instanceof Do||u instanceof Oo)return!1;const s=u instanceof uo||u instanceof vi;let l=!0;return u.eachChild((p=>{l=s?l&&Ha(p):l&&p instanceof cs})),!!l&&Xc(u)&&qc(u,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Xc(u){if(u instanceof us&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof ca||u instanceof Do)return!1;let s=!0;return u.eachChild((l=>{s&&!Xc(l)&&(s=!1)})),s}function Zl(u){if(u instanceof us&&u.name==="feature-state")return!1;let s=!0;return u.eachChild((l=>{s&&!Zl(l)&&(s=!1)})),s}function qc(u,s){if(u instanceof us&&s.indexOf(u.name)>=0)return!1;let l=!0;return u.eachChild((p=>{l&&!qc(p,s)&&(l=!1)})),l}function nd(u){return{result:"success",value:u}}function Za(u){return{result:"error",value:u}}function Lo(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Fo(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Gc(u){return!!u.expression&&u.expression.interpolated}function Cn(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Yc(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)&&rn(u)===na}function $p(u){return u}function Xl(u,s){const l=u.stops&&typeof u.stops[0][0]=="object",p=l||!(l||u.property!==void 0),_=u.type||(Gc(s)?"exponential":"interval"),b=(function(F){switch(F.type){case"color":return Tn.parse;case"padding":return Er.parse;case"numberArray":return Hr.parse;case"colorArray":return or.parse;default:return null}})(s);if(b&&((u=yr({},u)).stops&&(u.stops=u.stops.map((F=>[F[0],b(F[1])]))),u.default=b(u.default?u.default:s.default)),u.colorSpace&&(T=u.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var T;const C=(function(F){switch(F){case"exponential":return hr;case"interval":return sf;case"categorical":return rd;case"identity":return id;default:throw new Error(`Unknown function type "${F}"`)}})(_);let M,O;if(_==="categorical"){M=Object.create(null);for(const F of u.stops)M[F[0]]=F[1];O=typeof u.stops[0][0]}if(l){const F={},V=[];for(let q=0;q<u.stops.length;q++){const ee=u.stops[q],se=ee[0].zoom;F[se]===void 0&&(F[se]={zoom:se,type:u.type,property:u.property,default:u.default,stops:[]},V.push(se)),F[se].stops.push([ee[0].value,ee[1]])}const H=[];for(const q of V)H.push([F[q].zoom,Xl(F[q],s)]);const X={name:"linear"};return{kind:"composite",interpolationType:X,interpolationFactor:Or.interpolationFactor.bind(void 0,X),zoomStops:H.map((q=>q[0])),evaluate:({zoom:q},ee)=>hr({stops:H,base:u.base},s,q).evaluate(q,ee)}}if(p){const F=_==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:Or.interpolationFactor.bind(void 0,F),zoomStops:u.stops.map((V=>V[0])),evaluate:({zoom:V})=>C(u,s,V,M,O)}}return{kind:"source",evaluate(F,V){const H=V&&V.properties?V.properties[u.property]:void 0;return H===void 0?pa(u.default,s.default):C(u,s,H,M,O)}}}function pa(u,s,l){return u!==void 0?u:s!==void 0?s:l!==void 0?l:void 0}function rd(u,s,l,p,_){return pa(typeof l===_?p[l]:void 0,u.default,s.default)}function sf(u,s,l){if(Cn(l)!=="number")return pa(u.default,s.default);const p=u.stops.length;if(p===1||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[p-1][0])return u.stops[p-1][1];const _=Xr(u.stops.map((b=>b[0])),l);return u.stops[_][1]}function hr(u,s,l){const p=u.base!==void 0?u.base:1;if(Cn(l)!=="number")return pa(u.default,s.default);const _=u.stops.length;if(_===1||l<=u.stops[0][0])return u.stops[0][1];if(l>=u.stops[_-1][0])return u.stops[_-1][1];const b=Xr(u.stops.map((F=>F[0])),l),T=(function(F,V,H,X){const q=X-H,ee=F-H;return q===0?0:V===1?ee/q:(Math.pow(V,ee)-1)/(Math.pow(V,q)-1)})(l,p,u.stops[b][0],u.stops[b+1][0]),C=u.stops[b][1],M=u.stops[b+1][1],O=Hs[s.type]||$p;return typeof C.evaluate=="function"?{evaluate(...F){const V=C.evaluate.apply(void 0,F),H=M.evaluate.apply(void 0,F);if(V!==void 0&&H!==void 0)return O(V,H,T,u.colorSpace)}}:O(C,M,T,u.colorSpace)}function id(u,s,l){switch(s.type){case"color":l=Tn.parse(l);break;case"formatted":l=Pr.fromString(l.toString());break;case"resolvedImage":l=ls.fromString(l.toString());break;case"padding":l=Er.parse(l);break;case"colorArray":l=or.parse(l);break;case"numberArray":l=Hr.parse(l);break;default:Cn(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0)}return pa(l,u.default,s.default)}us.register(da,{error:[{kind:"error"},[bn],(u,[s])=>{throw new rr(s.evaluate(u))}],typeof:[bn,[yn],(u,[s])=>Qn(rn(s.evaluate(u)))],"to-rgba":[yi(St,4),[Yr],(u,[s])=>{const[l,p,_,b]=s.evaluate(u).rgb;return[255*l,255*p,255*_,b]}],rgb:[Yr,[St,St,St],Hc],rgba:[Yr,[St,St,St,St],Hc],has:{type:dn,overloads:[[[bn],(u,[s])=>Wa(s.evaluate(u),u.properties())],[[bn,na],(u,[s,l])=>Wa(s.evaluate(u),l.evaluate(u))]]},get:{type:yn,overloads:[[[bn],(u,[s])=>Zc(s.evaluate(u),u.properties())],[[bn,na],(u,[s,l])=>Zc(s.evaluate(u),l.evaluate(u))]]},"feature-state":[yn,[bn],(u,[s])=>Zc(s.evaluate(u),u.featureState||{})],properties:[na,[],u=>u.properties()],"geometry-type":[bn,[],u=>u.geometryType()],id:[yn,[],u=>u.id()],zoom:[St,[],u=>u.globals.zoom],"heatmap-density":[St,[],u=>u.globals.heatmapDensity||0],elevation:[St,[],u=>u.globals.elevation||0],"line-progress":[St,[],u=>u.globals.lineProgress||0],accumulated:[yn,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[St,fa(St),(u,s)=>{let l=0;for(const p of s)l+=p.evaluate(u);return l}],"*":[St,fa(St),(u,s)=>{let l=1;for(const p of s)l*=p.evaluate(u);return l}],"-":{type:St,overloads:[[[St,St],(u,[s,l])=>s.evaluate(u)-l.evaluate(u)],[[St],(u,[s])=>-s.evaluate(u)]]},"/":[St,[St,St],(u,[s,l])=>s.evaluate(u)/l.evaluate(u)],"%":[St,[St,St],(u,[s,l])=>s.evaluate(u)%l.evaluate(u)],ln2:[St,[],()=>Math.LN2],pi:[St,[],()=>Math.PI],e:[St,[],()=>Math.E],"^":[St,[St,St],(u,[s,l])=>Math.pow(s.evaluate(u),l.evaluate(u))],sqrt:[St,[St],(u,[s])=>Math.sqrt(s.evaluate(u))],log10:[St,[St],(u,[s])=>Math.log(s.evaluate(u))/Math.LN10],ln:[St,[St],(u,[s])=>Math.log(s.evaluate(u))],log2:[St,[St],(u,[s])=>Math.log(s.evaluate(u))/Math.LN2],sin:[St,[St],(u,[s])=>Math.sin(s.evaluate(u))],cos:[St,[St],(u,[s])=>Math.cos(s.evaluate(u))],tan:[St,[St],(u,[s])=>Math.tan(s.evaluate(u))],asin:[St,[St],(u,[s])=>Math.asin(s.evaluate(u))],acos:[St,[St],(u,[s])=>Math.acos(s.evaluate(u))],atan:[St,[St],(u,[s])=>Math.atan(s.evaluate(u))],min:[St,fa(St),(u,s)=>Math.min(...s.map((l=>l.evaluate(u))))],max:[St,fa(St),(u,s)=>Math.max(...s.map((l=>l.evaluate(u))))],abs:[St,[St],(u,[s])=>Math.abs(s.evaluate(u))],round:[St,[St],(u,[s])=>{const l=s.evaluate(u);return l<0?-Math.round(-l):Math.round(l)}],floor:[St,[St],(u,[s])=>Math.floor(s.evaluate(u))],ceil:[St,[St],(u,[s])=>Math.ceil(s.evaluate(u))],"filter-==":[dn,[bn,yn],(u,[s,l])=>u.properties()[s.value]===l.value],"filter-id-==":[dn,[yn],(u,[s])=>u.id()===s.value],"filter-type-==":[dn,[bn],(u,[s])=>u.geometryType()===s.value],"filter-<":[dn,[bn,yn],(u,[s,l])=>{const p=u.properties()[s.value],_=l.value;return typeof p==typeof _&&p<_}],"filter-id-<":[dn,[yn],(u,[s])=>{const l=u.id(),p=s.value;return typeof l==typeof p&&l<p}],"filter->":[dn,[bn,yn],(u,[s,l])=>{const p=u.properties()[s.value],_=l.value;return typeof p==typeof _&&p>_}],"filter-id->":[dn,[yn],(u,[s])=>{const l=u.id(),p=s.value;return typeof l==typeof p&&l>p}],"filter-<=":[dn,[bn,yn],(u,[s,l])=>{const p=u.properties()[s.value],_=l.value;return typeof p==typeof _&&p<=_}],"filter-id-<=":[dn,[yn],(u,[s])=>{const l=u.id(),p=s.value;return typeof l==typeof p&&l<=p}],"filter->=":[dn,[bn,yn],(u,[s,l])=>{const p=u.properties()[s.value],_=l.value;return typeof p==typeof _&&p>=_}],"filter-id->=":[dn,[yn],(u,[s])=>{const l=u.id(),p=s.value;return typeof l==typeof p&&l>=p}],"filter-has":[dn,[yn],(u,[s])=>s.value in u.properties()],"filter-has-id":[dn,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[dn,[yi(bn)],(u,[s])=>s.value.indexOf(u.geometryType())>=0],"filter-id-in":[dn,[yi(yn)],(u,[s])=>s.value.indexOf(u.id())>=0],"filter-in-small":[dn,[bn,yi(yn)],(u,[s,l])=>l.value.indexOf(u.properties()[s.value])>=0],"filter-in-large":[dn,[bn,yi(yn)],(u,[s,l])=>(function(p,_,b,T){for(;b<=T;){const C=b+T>>1;if(_[C]===p)return!0;_[C]>p?T=C-1:b=C+1}return!1})(u.properties()[s.value],l.value,0,l.value.length-1)],all:{type:dn,overloads:[[[dn,dn],(u,[s,l])=>s.evaluate(u)&&l.evaluate(u)],[fa(dn),(u,s)=>{for(const l of s)if(!l.evaluate(u))return!1;return!0}]]},any:{type:dn,overloads:[[[dn,dn],(u,[s,l])=>s.evaluate(u)||l.evaluate(u)],[fa(dn),(u,s)=>{for(const l of s)if(l.evaluate(u))return!0;return!1}]]},"!":[dn,[dn],(u,[s])=>!s.evaluate(u)],"is-supported-script":[dn,[bn],(u,[s])=>{const l=u.globals&&u.globals.isSupportedScript;return!l||l(s.evaluate(u))}],upcase:[bn,[bn],(u,[s])=>s.evaluate(u).toUpperCase()],downcase:[bn,[bn],(u,[s])=>s.evaluate(u).toLowerCase()],concat:[bn,fa(yn),(u,s)=>s.map((l=>cn(l.evaluate(u)))).join("")],"resolved-locale":[bn,[Mc],(u,[s])=>s.evaluate(u).resolvedLocale()]});class ql{constructor(s,l,p){this.expression=s,this._warningHistory={},this._evaluator=new Ol,this._defaultValue=l?(function(_){if(_.type==="color"&&Yc(_.default))return new Tn(0,0,0,0);switch(_.type){case"color":return Tn.parse(_.default)||null;case"padding":return Er.parse(_.default)||null;case"numberArray":return Hr.parse(_.default)||null;case"colorArray":return or.parse(_.default)||null;case"variableAnchorOffsetCollection":return Zr.parse(_.default)||null;case"projectionDefinition":return li.parse(_.default)||null;default:return _.default===void 0?null:_.default}})(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this._globalState=p}evaluateWithoutErrorHandling(s,l,p,_,b,T){return this._globalState&&(s=Ga(s,this._globalState)),this._evaluator.globals=s,this._evaluator.feature=l,this._evaluator.featureState=p,this._evaluator.canonical=_,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(s,l,p,_,b,T){this._globalState&&(s=Ga(s,this._globalState)),this._evaluator.globals=s,this._evaluator.feature=l||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=T||null;try{const C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new rr(`Expected value to be one of ${Object.keys(this._enumValues).map((M=>JSON.stringify(M))).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}}function ma(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in da}function Gl(u,s,l){const p=new oa(da,Ha,[],s?(function(b){const T={color:Yr,string:bn,number:St,enum:bn,boolean:dn,formatted:Co,padding:Rc,numberArray:Il,colorArray:oo,projectionDefinition:ta,resolvedImage:An,variableAnchorOffsetCollection:ku};return b.type==="array"?yi(T[b.value]||yn,b.length):T[b.type]})(s):void 0),_=p.parse(u,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?nd(new ql(_,s,l)):Za(p.errors)}class Xa{constructor(s,l,p){this.kind=s,this._styleExpression=l,this.isStateDependent=s!=="constant"&&!Zl(l.expression),this.globalStateRefs=Jc(l.expression),this._globalState=p}evaluateWithoutErrorHandling(s,l,p,_,b,T){return this._globalState&&(s=Ga(s,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(s,l,p,_,b,T)}evaluate(s,l,p,_,b,T){return this._globalState&&(s=Ga(s,this._globalState)),this._styleExpression.evaluate(s,l,p,_,b,T)}}class qa{constructor(s,l,p,_,b){this.kind=s,this.zoomStops=p,this._styleExpression=l,this.isStateDependent=s!=="camera"&&!Zl(l.expression),this.globalStateRefs=Jc(l.expression),this.interpolationType=_,this._globalState=b}evaluateWithoutErrorHandling(s,l,p,_,b,T){return this._globalState&&(s=Ga(s,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(s,l,p,_,b,T)}evaluate(s,l,p,_,b,T){return this._globalState&&(s=Ga(s,this._globalState)),this._styleExpression.evaluate(s,l,p,_,b,T)}interpolationFactor(s,l,p){return this.interpolationType?Or.interpolationFactor(this.interpolationType,s,l,p):0}}function Kc(u,s,l){const p=Gl(u,s,l);if(p.result==="error")return p;const _=p.value.expression,b=Xc(_);if(!b&&!Lo(s))return Za([new gi("","data expressions not supported")]);const T=qc(_,["zoom"]);if(!T&&!Fo(s))return Za([new gi("","zoom expressions not supported")]);const C=Yl(_);return C||T?C instanceof gi?Za([C]):C instanceof Or&&!Gc(s)?Za([new gi("",'"interpolate" expressions cannot be used with this property')]):nd(C?new qa(b?"camera":"composite",p.value,C.labels,C instanceof Or?C.interpolation:void 0,l):new Xa(b?"constant":"source",p.value,l)):Za([new gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ho{constructor(s,l){this._parameters=s,this._specification=l,yr(this,Xl(this._parameters,this._specification))}static deserialize(s){return new ho(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Yl(u){let s=null;if(u instanceof Ll)s=Yl(u.result);else if(u instanceof Nc){for(const l of u.args)if(s=Yl(l),s)break}else(u instanceof ar||u instanceof Or)&&u.input instanceof us&&u.input.name==="zoom"&&(s=u);return s instanceof gi||u.eachChild((l=>{const p=Yl(l);p instanceof gi?s=p:!s&&p?s=new gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&p&&s!==p&&(s=new gi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),s}function Jc(u,s=new Set){return u instanceof Oo&&s.add(u.key),u.eachChild((l=>{Jc(l,s)})),s}function Ga(u,s){const{zoom:l,heatmapDensity:p,elevation:_,lineProgress:b,isSupportedScript:T,accumulated:C}=u??{};return{zoom:l,heatmapDensity:p,elevation:_,lineProgress:b,isSupportedScript:T,accumulated:C,globalState:s}}function Kl(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const s of u.slice(1))if(!Kl(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Jl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fo(u,s){if(u==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Kl(u)||(u=Ql(u));const l=Gl(u,Jl,s);if(l.result==="error")throw new Error(l.value.map((p=>`${p.key}: ${p.message}`)).join(", "));return{filter:(p,_,b)=>l.value.evaluate(p,_,{},b),needGeometry:Ya(u),getGlobalStateRefs:()=>Jc(l.value.expression)}}function Qc(u,s){return u<s?-1:u>s?1:0}function Ya(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let s=1;s<u.length;s++)if(Ya(u[s]))return!0;return!1}function Ql(u){if(!u)return!0;const s=u[0];return u.length<=1?s!=="any":s==="=="?eu(u[1],u[2],"=="):s==="!="?Hu(eu(u[1],u[2],"==")):s==="<"||s===">"||s==="<="||s===">="?eu(u[1],u[2],s):s==="any"?(l=u.slice(1),["any"].concat(l.map(Ql))):s==="all"?["all"].concat(u.slice(1).map(Ql)):s==="none"?["all"].concat(u.slice(1).map(Ql).map(Hu)):s==="in"?of(u[1],u.slice(2)):s==="!in"?Hu(of(u[1],u.slice(2))):s==="has"?sd(u[1]):s!=="!has"||Hu(sd(u[1]));var l}function eu(u,s,l){switch(u){case"$type":return[`filter-type-${l}`,s];case"$id":return[`filter-id-${l}`,s];default:return[`filter-${l}`,u,s]}}function of(u,s){if(s.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some((l=>typeof l!=typeof s[0]))?["filter-in-large",u,["literal",s.sort(Qc)]]:["filter-in-small",u,["literal",s]]}}function sd(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Hu(u){return["!",u]}function od(u){const s=typeof u;if(s==="number"||s==="boolean"||s==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let _="[";for(const b of u)_+=`${od(b)},`;return`${_}]`}const l=Object.keys(u).sort();let p="{";for(let _=0;_<l.length;_++)p+=`${JSON.stringify(l[_])}:${od(u[l[_]])},`;return`${p}}`}function Zu(u){let s="";for(const l of ln)s+=`/${od(u[l])}`;return s}function po(u){const s=u.value;return s?[new lt(u.key,s,"constants have been deprecated as of v8")]:[]}function dr(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function As(u){if(Array.isArray(u))return u.map(As);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const s={};for(const l in u)s[l]=As(u[l]);return s}return dr(u)}function Cr(u){const s=u.key,l=u.value,p=u.valueSpec||{},_=u.objectElementValidators||{},b=u.style,T=u.styleSpec,C=u.validateSpec;let M=[];const O=Cn(l);if(O!=="object")return[new lt(s,l,`object expected, ${O} found`)];for(const F in l){const V=F.split(".")[0],H=ra(p,V)||p["*"];let X;if(ra(_,V))X=_[V];else if(ra(p,V))X=C;else if(_["*"])X=_["*"];else{if(!p["*"]){M.push(new lt(s,l[F],`unknown property "${F}"`));continue}X=C}M=M.concat(X({key:(s&&`${s}.`)+F,value:l[F],valueSpec:H,style:b,styleSpec:T,object:l,objectKey:F,validateSpec:C},l))}for(const F in p)_[F]||p[F].required&&p[F].default===void 0&&l[F]===void 0&&M.push(new lt(s,l,`missing required property "${F}"`));return M}function ga(u){const s=u.value,l=u.valueSpec,p=u.style,_=u.styleSpec,b=u.key,T=u.arrayElementValidator||u.validateSpec;if(Cn(s)!=="array")return[new lt(b,s,`array expected, ${Cn(s)} found`)];if(l.length&&s.length!==l.length)return[new lt(b,s,`array length ${l.length} expected, length ${s.length} found`)];if(l["min-length"]&&s.length<l["min-length"])return[new lt(b,s,`array length at least ${l["min-length"]} expected, length ${s.length} found`)];let C={type:l.value,values:l.values};_.$version<7&&(C.function=l.function),Cn(l.value)==="object"&&(C=l.value);let M=[];for(let O=0;O<s.length;O++)M=M.concat(T({array:s,arrayIndex:O,value:s[O],valueSpec:C,validateSpec:u.validateSpec,style:p,styleSpec:_,key:`${b}[${O}]`}));return M}function Ps(u){const s=u.key,l=u.value,p=u.valueSpec;let _=Cn(l);return _==="number"&&l!=l&&(_="NaN"),_!=="number"?[new lt(s,l,`number expected, ${_} found`)]:"minimum"in p&&l<p.minimum?[new lt(s,l,`${l} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&l>p.maximum?[new lt(s,l,`${l} is greater than the maximum value ${p.maximum}`)]:[]}function tu(u){const s=u.valueSpec,l=dr(u.value.type);let p,_,b,T={};const C=l!=="categorical"&&u.value.property===void 0,M=!C,O=Cn(u.value.stops)==="array"&&Cn(u.value.stops[0])==="array"&&Cn(u.value.stops[0][0])==="object",F=Cr({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(X){if(l==="identity")return[new lt(X.key,X.value,'identity function may not have a "stops" property')];let q=[];const ee=X.value;return q=q.concat(ga({key:X.key,value:ee,valueSpec:X.valueSpec,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:V})),Cn(ee)==="array"&&ee.length===0&&q.push(new lt(X.key,ee,"array must have at least one stop")),q},default:function(X){return X.validateSpec({key:X.key,value:X.value,valueSpec:s,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec})}}});return l==="identity"&&C&&F.push(new lt(u.key,u.value,'missing required property "property"')),l==="identity"||u.value.stops||F.push(new lt(u.key,u.value,'missing required property "stops"')),l==="exponential"&&u.valueSpec.expression&&!Gc(u.valueSpec)&&F.push(new lt(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(M&&!Lo(u.valueSpec)?F.push(new lt(u.key,u.value,"property functions not supported")):C&&!Fo(u.valueSpec)&&F.push(new lt(u.key,u.value,"zoom functions not supported"))),l!=="categorical"&&!O||u.value.property!==void 0||F.push(new lt(u.key,u.value,'"property" property is required')),F;function V(X){let q=[];const ee=X.value,se=X.key;if(Cn(ee)!=="array")return[new lt(se,ee,`array expected, ${Cn(ee)} found`)];if(ee.length!==2)return[new lt(se,ee,`array length 2 expected, length ${ee.length} found`)];if(O){if(Cn(ee[0])!=="object")return[new lt(se,ee,`object expected, ${Cn(ee[0])} found`)];if(ee[0].zoom===void 0)return[new lt(se,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new lt(se,ee,"object stop key must have value")];if(b&&b>dr(ee[0].zoom))return[new lt(se,ee[0].zoom,"stop zoom values must appear in ascending order")];dr(ee[0].zoom)!==b&&(b=dr(ee[0].zoom),_=void 0,T={}),q=q.concat(Cr({key:`${se}[0]`,value:ee[0],valueSpec:{zoom:{}},validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:Ps,value:H}}))}else q=q.concat(H({key:`${se}[0]`,value:ee[0],validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec},ee));return ma(As(ee[1]))?q.concat([new lt(`${se}[1]`,ee[1],"expressions are not allowed in function stops.")]):q.concat(X.validateSpec({key:`${se}[1]`,value:ee[1],valueSpec:s,validateSpec:X.validateSpec,style:X.style,styleSpec:X.styleSpec}))}function H(X,q){const ee=Cn(X.value),se=dr(X.value),pe=X.value!==null?X.value:q;if(p){if(ee!==p)return[new lt(X.key,pe,`${ee} stop domain type must match previous stop domain type ${p}`)]}else p=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean")return[new lt(X.key,pe,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&l!=="categorical"){let Ve=`number expected, ${ee} found`;return Lo(s)&&l===void 0&&(Ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(X.key,pe,Ve)]}return l!=="categorical"||ee!=="number"||isFinite(se)&&Math.floor(se)===se?l!=="categorical"&&ee==="number"&&_!==void 0&&se<_?[new lt(X.key,pe,"stop domain values must appear in ascending order")]:(_=se,l==="categorical"&&se in T?[new lt(X.key,pe,"stop domain values must be unique")]:(T[se]=!0,[])):[new lt(X.key,pe,`integer expected, found ${se}`)]}}function Ka(u){const s=(u.expressionContext==="property"?Kc:Gl)(As(u.value),u.valueSpec);if(s.result==="error")return s.value.map((p=>new lt(`${u.key}${p.key}`,u.value,p.message)));const l=s.value.expression||s.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!l.outputDefined())return[new lt(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!Zl(l))return[new lt(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!Zl(l))return[new lt(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!qc(l,["zoom","feature-state"]))return[new lt(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Xc(l))return[new lt(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ja(u){const s=u.key,l=u.value,p=Cn(l);return p!=="string"?[new lt(s,l,`color expected, ${p} found`)]:Tn.parse(String(l))?[]:[new lt(s,l,`color expected, "${l}" found`)]}function Gs(u){const s=u.key,l=u.value,p=u.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(dr(l))===-1&&_.push(new lt(s,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(dr(l))===-1&&_.push(new lt(s,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),_}function Qa(u){return Kl(As(u.value))?Ka(yr({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):el(u)}function el(u){const s=u.value,l=u.key;if(Cn(s)!=="array")return[new lt(l,s,`array expected, ${Cn(s)} found`)];const p=u.styleSpec;let _,b=[];if(s.length<1)return[new lt(l,s,"filter array must have at least 1 element")];switch(b=b.concat(Gs({key:`${l}[0]`,value:s[0],valueSpec:p.filter_operator,style:u.style,styleSpec:u.styleSpec})),dr(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&dr(s[1])==="$type"&&b.push(new lt(l,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&b.push(new lt(l,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(_=Cn(s[1]),_!=="string"&&b.push(new lt(`${l}[1]`,s[1],`string expected, ${_} found`)));for(let T=2;T<s.length;T++)_=Cn(s[T]),dr(s[1])==="$type"?b=b.concat(Gs({key:`${l}[${T}]`,value:s[T],valueSpec:p.geometry_type,style:u.style,styleSpec:u.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&b.push(new lt(`${l}[${T}]`,s[T],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let T=1;T<s.length;T++)b=b.concat(el({key:`${l}[${T}]`,value:s[T],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":_=Cn(s[1]),s.length!==2?b.push(new lt(l,s,`filter array for "${s[0]}" operator must have 2 elements`)):_!=="string"&&b.push(new lt(`${l}[1]`,s[1],`string expected, ${_} found`))}return b}function nu(u,s){const l=u.key,p=u.validateSpec,_=u.style,b=u.styleSpec,T=u.value,C=u.objectKey,M=b[`${s}_${u.layerType}`];if(!M)return[];const O=C.match(/^(.*)-transition$/);if(s==="paint"&&O&&M[O[1]]&&M[O[1]].transition)return p({key:l,value:T,valueSpec:b.transition,style:_,styleSpec:b});const F=u.valueSpec||M[C];if(!F)return[new lt(l,T,`unknown property "${C}"`)];let V;if(Cn(T)==="string"&&Lo(F)&&!F.tokens&&(V=/^{([^}]+)}$/.exec(T)))return[new lt(l,T,`"${C}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(V[1])} }\`.`)];const H=[];return u.layerType==="symbol"&&(C==="text-field"&&_&&!_.glyphs&&H.push(new lt(l,T,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&Yc(As(T))&&dr(T.type)==="identity"&&H.push(new lt(l,T,'"text-font" does not support identity functions'))),H.concat(p({key:u.key,value:T,valueSpec:F,style:_,styleSpec:b,expressionContext:"property",propertyType:s,propertyKey:C}))}function Xu(u){return nu(u,"paint")}function tl(u){return nu(u,"layout")}function hs(u){let s=[];const l=u.value,p=u.key,_=u.style,b=u.styleSpec;if(Cn(l)!=="object")return[new lt(p,l,`object expected, ${Cn(l)} found`)];l.type||l.ref||s.push(new lt(p,l,'either "type" or "ref" is required'));let T=dr(l.type);const C=dr(l.ref);if(l.id){const M=dr(l.id);for(let O=0;O<u.arrayIndex;O++){const F=_.layers[O];dr(F.id)===M&&s.push(new lt(p,l.id,`duplicate layer id "${l.id}", previously used at line ${F.id.__line__}`))}}if("ref"in l){let M;["type","source","source-layer","filter","layout"].forEach((O=>{O in l&&s.push(new lt(p,l[O],`"${O}" is prohibited for ref layers`))})),_.layers.forEach((O=>{dr(O.id)===C&&(M=O)})),M?M.ref?s.push(new lt(p,l.ref,"ref cannot reference another ref layer")):T=dr(M.type):s.push(new lt(p,l.ref,`ref layer "${C}" not found`))}else if(T!=="background")if(l.source){const M=_.sources&&_.sources[l.source],O=M&&dr(M.type);M?O==="vector"&&T==="raster"?s.push(new lt(p,l.source,`layer "${l.id}" requires a raster source`)):O!=="raster-dem"&&T==="hillshade"||O!=="raster-dem"&&T==="color-relief"?s.push(new lt(p,l.source,`layer "${l.id}" requires a raster-dem source`)):O==="raster"&&T!=="raster"?s.push(new lt(p,l.source,`layer "${l.id}" requires a vector source`)):O!=="vector"||l["source-layer"]?O==="raster-dem"&&T!=="hillshade"&&T!=="color-relief"?s.push(new lt(p,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):T!=="line"||!l.paint||!l.paint["line-gradient"]||O==="geojson"&&M.lineMetrics||s.push(new lt(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new lt(p,l,`layer "${l.id}" must specify a "source-layer"`)):s.push(new lt(p,l.source,`source "${l.source}" not found`))}else s.push(new lt(p,l,'missing required property "source"'));return s=s.concat(Cr({key:p,value:l,valueSpec:b.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${p}.type`,value:l.type,valueSpec:b.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:l,objectKey:"type"}),filter:Qa,layout:M=>Cr({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":O=>tl(yr({layerType:T},O))}}),paint:M=>Cr({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":O=>Xu(yr({layerType:T},O))}})}})),s}function Nn(u){const s=u.value,l=u.key,p=Cn(s);return p!=="string"?[new lt(l,s,`string expected, ${p} found`)]:[]}const Dn={promoteId:function({key:u,value:s}){if(Cn(s)==="string")return Nn({key:u,value:s});{const l=[];for(const p in s)l.push(...Nn({key:`${u}.${p}`,value:s[p]}));return l}}};function ds(u){const s=u.value,l=u.key,p=u.styleSpec,_=u.style,b=u.validateSpec;if(!s.type)return[new lt(l,s,'"type" is required')];const T=dr(s.type);let C;switch(T){case"vector":case"raster":return C=Cr({key:l,value:s,valueSpec:p[`source_${T.replace("-","_")}`],style:u.style,styleSpec:p,objectElementValidators:Dn,validateSpec:b}),C;case"raster-dem":return C=(function(M){var O;const F=(O=M.sourceName)!==null&&O!==void 0?O:"",V=M.value,H=M.styleSpec,X=H.source_raster_dem,q=M.style;let ee=[];const se=Cn(V);if(V===void 0)return ee;if(se!=="object")return ee.push(new lt("source_raster_dem",V,`object expected, ${se} found`)),ee;const pe=dr(V.encoding)==="custom",Ve=["redFactor","greenFactor","blueFactor","baseShift"],be=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const Ie in V)!pe&&Ve.includes(Ie)?ee.push(new lt(Ie,V[Ie],`In "${F}": "${Ie}" is only valid when "encoding" is set to "custom". ${be} encoding found`)):X[Ie]?ee=ee.concat(M.validateSpec({key:Ie,value:V[Ie],valueSpec:X[Ie],validateSpec:M.validateSpec,style:q,styleSpec:H})):ee.push(new lt(Ie,V[Ie],`unknown property "${Ie}"`));return ee})({sourceName:l,value:s,style:u.style,styleSpec:p,validateSpec:b}),C;case"geojson":if(C=Cr({key:l,value:s,valueSpec:p.source_geojson,style:_,styleSpec:p,validateSpec:b,objectElementValidators:Dn}),s.cluster)for(const M in s.clusterProperties){const[O,F]=s.clusterProperties[M],V=typeof O=="string"?[O,["accumulated"],["get",M]]:O;C.push(...Ka({key:`${l}.${M}.map`,value:F,expressionContext:"cluster-map"})),C.push(...Ka({key:`${l}.${M}.reduce`,value:V,expressionContext:"cluster-reduce"}))}return C;case"video":return Cr({key:l,value:s,valueSpec:p.source_video,style:_,validateSpec:b,styleSpec:p});case"image":return Cr({key:l,value:s,valueSpec:p.source_image,style:_,validateSpec:b,styleSpec:p});case"canvas":return[new lt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gs({key:`${l}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Jr(u){const s=u.value,l=u.styleSpec,p=l.light,_=u.style;let b=[];const T=Cn(s);if(s===void 0)return b;if(T!=="object")return b=b.concat([new lt("light",s,`object expected, ${T} found`)]),b;for(const C in s){const M=C.match(/^(.*)-transition$/);b=b.concat(M&&p[M[1]]&&p[M[1]].transition?u.validateSpec({key:C,value:s[C],valueSpec:l.transition,validateSpec:u.validateSpec,style:_,styleSpec:l}):p[C]?u.validateSpec({key:C,value:s[C],valueSpec:p[C],validateSpec:u.validateSpec,style:_,styleSpec:l}):[new lt(C,s[C],`unknown property "${C}"`)])}return b}function Oi(u){const s=u.value,l=u.styleSpec,p=l.sky,_=u.style,b=Cn(s);if(s===void 0)return[];if(b!=="object")return[new lt("sky",s,`object expected, ${b} found`)];let T=[];for(const C in s)T=T.concat(p[C]?u.validateSpec({key:C,value:s[C],valueSpec:p[C],style:_,styleSpec:l}):[new lt(C,s[C],`unknown property "${C}"`)]);return T}function _a(u){const s=u.value,l=u.styleSpec,p=l.terrain,_=u.style;let b=[];const T=Cn(s);if(s===void 0)return b;if(T!=="object")return b=b.concat([new lt("terrain",s,`object expected, ${T} found`)]),b;for(const C in s)b=b.concat(p[C]?u.validateSpec({key:C,value:s[C],valueSpec:p[C],validateSpec:u.validateSpec,style:_,styleSpec:l}):[new lt(C,s[C],`unknown property "${C}"`)]);return b}function Ys(u){let s=[];const l=u.value,p=u.key;if(Array.isArray(l)){const _=[],b=[];for(const T in l)l[T].id&&_.includes(l[T].id)&&s.push(new lt(p,l,`all the sprites' ids must be unique, but ${l[T].id} is duplicated`)),_.push(l[T].id),l[T].url&&b.includes(l[T].url)&&s.push(new lt(p,l,`all the sprites' URLs must be unique, but ${l[T].url} is duplicated`)),b.push(l[T].url),s=s.concat(Cr({key:`${p}[${T}]`,value:l[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return s}return Nn({key:p,value:l})}function xi(u){return s=u.value,s&&s.constructor===Object?[]:[new lt(u.key,u.value,`object expected, ${Cn(u.value)} found`)];var s}const nl={"*":()=>[],array:ga,boolean:function(u){const s=u.value,l=u.key,p=Cn(s);return p!=="boolean"?[new lt(l,s,`boolean expected, ${p} found`)]:[]},number:Ps,color:Ja,constants:po,enum:Gs,filter:Qa,function:tu,layer:hs,object:Cr,source:ds,light:Jr,sky:Oi,terrain:_a,projection:function(u){const s=u.value,l=u.styleSpec,p=l.projection,_=u.style,b=Cn(s);if(s===void 0)return[];if(b!=="object")return[new lt("projection",s,`object expected, ${b} found`)];let T=[];for(const C in s)T=T.concat(p[C]?u.validateSpec({key:C,value:s[C],valueSpec:p[C],style:_,styleSpec:l}):[new lt(C,s[C],`unknown property "${C}"`)]);return T},projectionDefinition:function(u){const s=u.key;let l=u.value;l=l instanceof String?l.valueOf():l;const p=Cn(l);return p!=="array"||(function(_){return Array.isArray(_)&&_.length===3&&typeof _[0]=="string"&&typeof _[1]=="string"&&typeof _[2]=="number"})(l)||(function(_){return!!["interpolate","step","literal"].includes(_[0])})(l)?["array","string"].includes(p)?[]:[new lt(s,l,`projection expected, invalid type "${p}" found`)]:[new lt(s,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]},string:Nn,formatted:function(u){return Nn(u).length===0?[]:Ka(u)},resolvedImage:function(u){return Nn(u).length===0?[]:Ka(u)},padding:function(u){const s=u.key,l=u.value;if(Cn(l)==="array"){if(l.length<1||l.length>4)return[new lt(s,l,`padding requires 1 to 4 values; ${l.length} values found`)];const p={type:"number"};let _=[];for(let b=0;b<l.length;b++)_=_.concat(u.validateSpec({key:`${s}[${b}]`,value:l[b],validateSpec:u.validateSpec,valueSpec:p}));return _}return Ps({key:s,value:l,valueSpec:{}})},numberArray:function(u){const s=u.key,l=u.value;if(Cn(l)==="array"){const p={type:"number"};if(l.length<1)return[new lt(s,l,"array length at least 1 expected, length 0 found")];let _=[];for(let b=0;b<l.length;b++)_=_.concat(u.validateSpec({key:`${s}[${b}]`,value:l[b],validateSpec:u.validateSpec,valueSpec:p}));return _}return Ps({key:s,value:l,valueSpec:{}})},colorArray:function(u){const s=u.key,l=u.value;if(Cn(l)==="array"){if(l.length<1)return[new lt(s,l,"array length at least 1 expected, length 0 found")];let p=[];for(let _=0;_<l.length;_++)p=p.concat(Ja({key:`${s}[${_}]`,value:l[_]}));return p}return Ja({key:s,value:l})},variableAnchorOffsetCollection:function(u){const s=u.key,l=u.value,p=Cn(l),_=u.styleSpec;if(p!=="array"||l.length<1||l.length%2!=0)return[new lt(s,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let T=0;T<l.length;T+=2)b=b.concat(Gs({key:`${s}[${T}]`,value:l[T],valueSpec:_.layout_symbol["text-anchor"]})),b=b.concat(ga({key:`${s}[${T+1}]`,value:l[T+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:_}));return b},sprite:Ys,state:xi};function ru(u){const s=u.value,l=u.valueSpec,p=u.styleSpec;return u.validateSpec=ru,l.expression&&Yc(dr(s))?tu(u):l.expression&&ma(As(s))?Ka(u):l.type&&nl[l.type]?nl[l.type](u):Cr(yr({},u,{valueSpec:l.type?p[l.type]:l}))}function iu(u){const s=u.value,l=u.key,p=Nn(u);return p.length||(s.indexOf("{fontstack}")===-1&&p.push(new lt(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&p.push(new lt(l,s,'"glyphs" url must include a "{range}" token'))),p}function Li(u,s=Be){let l=[];return l=l.concat(ru({key:"",value:u,valueSpec:s.$root,styleSpec:s,style:u,validateSpec:ru,objectElementValidators:{glyphs:iu,"*":()=>[]}})),u.constants&&(l=l.concat(po({key:"constants",value:u.constants}))),mo(l)}function bi(u){return function(s){return u(Object.assign({},s,{validateSpec:ru}))}}function mo(u){return[].concat(u).sort(((s,l)=>s.line-l.line))}function Yi(u){return function(...s){return mo(u.apply(this,s))}}Li.source=Yi(bi(ds)),Li.sprite=Yi(bi(Ys)),Li.glyphs=Yi(bi(iu)),Li.light=Yi(bi(Jr)),Li.sky=Yi(bi(Oi)),Li.terrain=Yi(bi(_a)),Li.state=Yi(bi(xi)),Li.layer=Yi(bi(hs)),Li.filter=Yi(bi(Qa)),Li.paintProperty=Yi(bi(Xu)),Li.layoutProperty=Yi(bi(tl));const ya=Li,ec=ya.light,Wp=ya.sky,va=ya.paintProperty,No=ya.layoutProperty;function rl(u,s){let l=!1;if(s&&s.length)for(const p of s)u.fire(new at(new Error(p.message))),l=!0;return l}class go{constructor(s,l,p){const _=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const T=new Int32Array(this.arrayBuffer);s=T[0],this.d=(l=T[1])+2*(p=T[2]);for(let M=0;M<this.d*this.d;M++){const O=T[3+M],F=T[3+M+1];_.push(O===F?null:T.subarray(O,F))}const C=T[3+_.length+1];this.keys=T.subarray(T[3+_.length],C),this.bboxes=T.subarray(C),this.insert=this._insertReadonly}else{this.d=l+2*p;for(let T=0;T<this.d*this.d;T++)_.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=s,this.padding=p,this.scale=l/s,this.uid=0;const b=p/l*s;this.min=-b,this.max=s+b}insert(s,l,p,_,b){this._forEachCell(l,p,_,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,l,p,_,b,T){this.cells[b].push(T)}query(s,l,p,_,b){const T=this.min,C=this.max;if(s<=T&&l<=T&&C<=p&&C<=_&&!b)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(s,l,p,_,this._queryCell,M,{},b),M}}_queryCell(s,l,p,_,b,T,C,M){const O=this.cells[b];if(O!==null){const F=this.keys,V=this.bboxes;for(let H=0;H<O.length;H++){const X=O[H];if(C[X]===void 0){const q=4*X;(M?M(V[q+0],V[q+1],V[q+2],V[q+3]):s<=V[q+2]&&l<=V[q+3]&&p>=V[q+0]&&_>=V[q+1])?(C[X]=!0,T.push(F[X])):C[X]=!1}}}}_forEachCell(s,l,p,_,b,T,C,M){const O=this._convertToCellCoord(s),F=this._convertToCellCoord(l),V=this._convertToCellCoord(p),H=this._convertToCellCoord(_);for(let X=O;X<=V;X++)for(let q=F;q<=H;q++){const ee=this.d*q+X;if((!M||M(this._convertFromCellCoord(X),this._convertFromCellCoord(q),this._convertFromCellCoord(X+1),this._convertFromCellCoord(q+1)))&&b.call(this,s,l,p,_,ee,T,C,M))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,l=3+this.cells.length+1+1;let p=0;for(let T=0;T<this.cells.length;T++)p+=this.cells[T].length;const _=new Int32Array(l+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let b=l;for(let T=0;T<s.length;T++){const C=s[T];_[3+T]=b,_.set(C,b),b+=C.length}return _[3+s.length]=b,_.set(this.keys,b),b+=this.keys.length,_[3+s.length+1]=b,_.set(this.bboxes,b),b+=this.bboxes.length,_.buffer}static serialize(s,l){const p=s.toArrayBuffer();return l&&l.push(p),{buffer:p}}static deserialize(s){return new go(s.buffer)}}const Fi={};function It(u,s,l={}){if(Fi[u])throw new Error(`${u} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:u,writeable:!1}),Fi[u]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}It("Object",Object),It("Set",Set),It("TransferableGridIndex",go),It("Color",Tn),It("Error",Error),It("AJAXError",xe),It("ResolvedImage",ls),It("StylePropertyFunction",ho),It("StyleExpression",ql,{omit:["_evaluator"]}),It("ZoomDependentExpression",qa),It("ZoomConstantExpression",Xa),It("CompoundExpression",us,{omit:["_evaluate"]});for(const u in da)da[u]._classRegistryKey||It(`Expression_${u}`,da[u]);function Ki(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function _o(u){return u.$name||u.constructor._classRegistryKey}function Ks(u){return!(function(s){if(s===null||typeof s!="object")return!1;const l=_o(s);return!(!l||l==="Object")})(u)&&(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||Ki(u)||ki(u)||ArrayBuffer.isView(u)||u instanceof ImageData)}function Ni(u,s){if(Ks(u))return(Ki(u)||ki(u))&&s&&s.push(u),ArrayBuffer.isView(u)&&s&&s.push(u.buffer),u instanceof ImageData&&s&&s.push(u.data.buffer),u;if(Array.isArray(u)){const b=[];for(const T of u)b.push(Ni(T,s));return b}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);const l=_o(u);if(!l)throw new Error(`can't serialize object of unregistered class ${u.constructor.name}`);if(!Fi[l])throw new Error(`${l} is not registered.`);const{klass:p}=Fi[l],_=p.serialize?p.serialize(u,s):{};if(p.serialize){if(s&&_===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in u){if(!u.hasOwnProperty(b)||Fi[l].omit.indexOf(b)>=0)continue;const T=u[b];_[b]=Fi[l].shallow.indexOf(b)>=0?T:Ni(T,s)}u instanceof Error&&(_.message=u.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(_.$name=l),_}function Es(u){if(Ks(u))return u;if(Array.isArray(u))return u.map(Es);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);const s=_o(u)||"Object";if(!Fi[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:l}=Fi[s];if(!l)throw new Error(`can't deserialize unregistered class ${s}`);if(l.deserialize)return l.deserialize(u);const p=Object.create(l.prototype);for(const _ of Object.keys(u)){if(_==="$name")continue;const b=u[_];p[_]=Fi[s].shallow.indexOf(_)>=0?b:Es(b)}return p}class qu{constructor(){this.first=!0}update(s,l){const p=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=l),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=p,!0))}}const In={"Latin-1 Supplement":u=>u>=128&&u<=255,"Hangul Jamo":u=>u>=4352&&u<=4607,Khmer:u=>u>=6016&&u<=6143,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Kanbun:u=>u>=12688&&u<=12703,"CJK Strokes":u=>u>=12736&&u<=12783,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Hangul Syllables":u=>u>=44032&&u<=55215,"Private Use Area":u=>u>=57344&&u<=63743,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function su(u){for(const s of u)if(Gu(s.charCodeAt(0)))return!0;return!1}function Ji(u){for(const s of u)if(!Cs(s.charCodeAt(0)))return!1;return!0}function Bi(u){const s=u.map((l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}})).filter((l=>l));return new RegExp(s.join("|"),"u")}const gr=Bi(["Arab","Dupl","Mong","Ougr","Syrc"]);function Cs(u){return!gr.test(String.fromCodePoint(u))}const ad=Bi(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Gu(u){return!(u!==746&&u!==747&&(u<4352||!(In["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||In["CJK Compatibility"](u)||In["CJK Strokes"](u)||!(!In["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||In["Enclosed CJK Letters and Months"](u)||In["Ideographic Description Characters"](u)||In.Kanbun(u)||In.Katakana(u)&&u!==12540||!(!In["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!In["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||In["Vertical Forms"](u)||In["Yijing Hexagram Symbols"](u)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(u))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(u))||ad.test(String.fromCodePoint(u)))))}function ou(u){return!(Gu(u)||(function(s){return!!(In["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||In["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||In["Letterlike Symbols"](s)||In["Number Forms"](s)||In["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||In["Control Pictures"](s)&&s!==9251||In["Optical Character Recognition"](s)||In["Enclosed Alphanumerics"](s)||In["Geometric Shapes"](s)||In["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||In["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||In["CJK Symbols and Punctuation"](s)||In.Katakana(s)||In["Private Use Area"](s)||In["CJK Compatibility Forms"](s)||In["Small Form Variants"](s)||In["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)})(u))}const Yu=Bi(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ku(u){return Yu.test(String.fromCodePoint(u))}function au(u,s){return!(!s&&Ku(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||In.Khmer(u))}function lu(u){for(const s of u)if(Ku(s.charCodeAt(0)))return!0;return!1}const fs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){if(fs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(u,s){return a(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(u.pluginStatus!=="loading")return this.setState(u),u;const l=u.pluginURL,p=new Promise((b=>{this.loadScriptResolve=b}));s(l);const _=new Promise((b=>setTimeout((()=>b()),this.TIMEOUT)));if(yield Promise.race([p,_]),this.isParsed()){const b={pluginStatus:"loaded",pluginURL:l};return this.setState(b),b}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${l}`)}))}};class Hn{constructor(s,l){this.isSupportedScript=Hp,this.zoom=s,l?(this.now=l.now||0,this.fadeDuration=l.fadeDuration||0,this.zoomHistory=l.zoomHistory||new qu,this.transition=l.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qu,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,l=s-Math.floor(s),p=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*l}}}function Hp(u){return(function(s,l){for(const p of s)if(!au(p.charCodeAt(0),l))return!1;return!0})(u,fs.getRTLTextPluginStatus()==="loaded")}class xa{constructor(s,l,p){this.property=s,this.value=l,this.expression=(function(_,b,T){if(Yc(_))return new ho(_,b);if(ma(_)){const C=Kc(_,b,T);if(C.result==="error")throw new Error(C.value.map((M=>`${M.key}: ${M.message}`)).join(", "));return C.value}{let C=_;return b.type==="color"&&typeof _=="string"?C=Tn.parse(_):b.type!=="padding"||typeof _!="number"&&!Array.isArray(_)?b.type!=="numberArray"||typeof _!="number"&&!Array.isArray(_)?b.type!=="colorArray"||typeof _!="string"&&!Array.isArray(_)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(_)?C=Zr.parse(_):b.type==="projectionDefinition"&&typeof _=="string"&&(C=li.parse(_)):C=or.parse(_):C=Hr.parse(_):C=Er.parse(_),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>C}}})(l===void 0?s.specification.default:l,s.specification,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(s,l,p){return this.property.possiblyEvaluate(this,s,l,p)}}class il{constructor(s,l){this.property=s,this.value=new xa(s,void 0,l)}transitioned(s,l){return new Qu(this.property,this.value,l,ut({},s.transition,this.transition),s.now)}untransitioned(){return new Qu(this.property,this.value,null,{},0)}}class Ju{constructor(s,l){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._globalState=l}getValue(s){return Wn(this._values[s].value.value)}setValue(s,l){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new il(this._values[s].property,this._globalState)),this._values[s].value=new xa(this._values[s].property,l===null?void 0:Wn(l),this._globalState)}getTransition(s){return Wn(this._values[s].transition)}setTransition(s,l){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new il(this._values[s].property,this._globalState)),this._values[s].transition=Wn(l)||void 0}serialize(){const s={};for(const l of Object.keys(this._values)){const p=this.getValue(l);p!==void 0&&(s[l]=p);const _=this.getTransition(l);_!==void 0&&(s[`${l}-transition`]=_)}return s}transitioned(s,l){const p=new sl(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(s,l._values[_]);return p}untransitioned(){const s=new sl(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].untransitioned();return s}}class Qu{constructor(s,l,p,_,b){this.property=s,this.value=l,this.begin=b+_.delay||0,this.end=this.begin+_.duration||0,s.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(s,l,p){const _=s.now||0,b=this.value.possiblyEvaluate(s,l,p),T=this.prior;if(T){if(_>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(_<this.begin)return T.possiblyEvaluate(s,l,p);{const C=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(s,l,p),b,dt(C))}}return b}}class sl{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,l,p){const _=new ol(this._properties);for(const b of Object.keys(this._values))_._values[b]=this._values[b].possiblyEvaluate(s,l,p);return _}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class af{constructor(s,l){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._globalState=l}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Wn(this._values[s].value)}setValue(s,l){this._values[s]=new xa(this._values[s].property,l===null?void 0:Wn(l),this._globalState)}serialize(){const s={};for(const l of Object.keys(this._values)){const p=this.getValue(l);p!==void 0&&(s[l]=p)}return s}possiblyEvaluate(s,l,p){const _=new ol(this._properties);for(const b of Object.keys(this._values))_._values[b]=this._values[b].possiblyEvaluate(s,l,p);return _}}class ps{constructor(s,l,p){this.property=s,this.value=l,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,l,p,_){return this.property.evaluate(this.value,this.parameters,s,l,p,_)}}class ol{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class jt{constructor(s){this.specification=s}possiblyEvaluate(s,l){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(l)}interpolate(s,l,p){const _=Hs[this.specification.type];return _?_(s,l,p):s}}class Gt{constructor(s,l){this.specification=s,this.overrides=l}possiblyEvaluate(s,l,p,_){return new ps(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(l,null,{},p,_)}:s.expression,l)}interpolate(s,l,p){if(s.value.kind!=="constant"||l.value.kind!=="constant")return s;if(s.value.value===void 0||l.value.value===void 0)return new ps(this,{kind:"constant",value:void 0},s.parameters);const _=Hs[this.specification.type];if(_){const b=_(s.value.value,l.value.value,p);return new ps(this,{kind:"constant",value:b},s.parameters)}return s}evaluate(s,l,p,_,b,T){return s.kind==="constant"?s.value:s.evaluate(l,p,_,b,T)}}class al extends Gt{possiblyEvaluate(s,l,p,_){if(s.value===void 0)return new ps(this,{kind:"constant",value:void 0},l);if(s.expression.kind==="constant"){const b=s.expression.evaluate(l,null,{},p,_),T=s.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,C=this._calculate(T,T,T,l);return new ps(this,{kind:"constant",value:C},l)}if(s.expression.kind==="camera"){const b=this._calculate(s.expression.evaluate({zoom:l.zoom-1}),s.expression.evaluate({zoom:l.zoom}),s.expression.evaluate({zoom:l.zoom+1}),l);return new ps(this,{kind:"constant",value:b},l)}return new ps(this,s.expression,l)}evaluate(s,l,p,_,b,T){if(s.kind==="source"){const C=s.evaluate(l,p,_,b,T);return this._calculate(C,C,C,l)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(l.zoom)-1},p,_),s.evaluate({zoom:Math.floor(l.zoom)},p,_),s.evaluate({zoom:Math.floor(l.zoom)+1},p,_),l):s.value}_calculate(s,l,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:p,to:l}}interpolate(s){return s}}class eh{constructor(s){this.specification=s}possiblyEvaluate(s,l,p,_){if(s.value!==void 0){if(s.expression.kind==="constant"){const b=s.expression.evaluate(l,null,{},p,_);return this._calculate(b,b,b,l)}return this._calculate(s.expression.evaluate(new Hn(Math.floor(l.zoom-1),l)),s.expression.evaluate(new Hn(Math.floor(l.zoom),l)),s.expression.evaluate(new Hn(Math.floor(l.zoom+1),l)),l)}}_calculate(s,l,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:p,to:l}}interpolate(s){return s}}class tc{constructor(s){this.specification=s}possiblyEvaluate(s,l,p,_){return!!s.expression.evaluate(l,null,{},p,_)}interpolate(){return!1}}class Lr{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in s){const p=s[l];p.specification.overridable&&this.overridableProperties.push(l);const _=this.defaultPropertyValues[l]=new xa(p,void 0,void 0),b=this.defaultTransitionablePropertyValues[l]=new il(p,void 0);this.defaultTransitioningPropertyValues[l]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=_.possiblyEvaluate({})}}}It("DataDrivenProperty",Gt),It("DataConstantProperty",jt),It("CrossFadedDataDrivenProperty",al),It("CrossFadedProperty",eh),It("ColorRampProperty",tc);const ms="-transition";class ci extends Vt{constructor(s,l,p){if(super(),this.id=s.id,this.type=s.type,this._globalState=p,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter,this._featureFilter=fo(s.filter,p)),l.layout&&(this._unevaluatedLayout=new af(l.layout,p)),l.paint)){this._transitionablePaint=new Ju(l.paint,p);for(const _ in s.paint)this.setPaintProperty(_,s.paint[_],{validate:!1});for(const _ in s.layout)this.setLayoutProperty(_,s.layout[_],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ol(l.paint)}}setFilter(s){this.filter=s,this._featureFilter=fo(s,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}getLayoutAffectingGlobalStateRefs(){const s=new Set;if(this._unevaluatedLayout)for(const l in this._unevaluatedLayout._values){const p=this._unevaluatedLayout._values[l];for(const _ of p.getGlobalStateRefs())s.add(_)}for(const l of this._featureFilter.getGlobalStateRefs())s.add(l);return s}getPaintAffectingGlobalStateRefs(){var s;const l=new globalThis.Map;if(this._transitionablePaint)for(const p in this._transitionablePaint._values){const _=this._transitionablePaint._values[p].value;for(const b of _.getGlobalStateRefs()){const T=(s=l.get(b))!==null&&s!==void 0?s:[];T.push({name:p,value:_.value}),l.set(b,T)}}return l}setLayoutProperty(s,l,p={}){l!=null&&this._validate(No,`layers.${this.id}.layout.${s}`,s,l,p)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,l):this.visibility=l)}getPaintProperty(s){return s.endsWith(ms)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,l,p={}){if(l!=null&&this._validate(va,`layers.${this.id}.paint.${s}`,s,l,p))return!1;if(s.endsWith(ms))return this._transitionablePaint.setTransition(s.slice(0,-11),l||void 0),!1;{const _=this._transitionablePaint._values[s],b=_.property.specification["property-type"]==="cross-faded-data-driven",T=_.value.isDataDriven(),C=_.value;this._transitionablePaint.setValue(s,l),this._handleSpecialPaintPropertyUpdate(s);const M=this._transitionablePaint._values[s].value;return M.isDataDriven()||T||b||this._handleOverridablePaintPropertyUpdate(s,C,M)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,l,p){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,l){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,l)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),jn(s,((l,p)=>!(l===void 0||p==="layout"&&!Object.keys(l).length||p==="paint"&&!Object.keys(l).length)))}_validate(s,l,p,_,b={}){return(!b||b.validate!==!1)&&rl(this,s.call(ya,{key:l,layerType:this.type,objectKey:p,value:_,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const l=this.paint.get(s);if(l instanceof ps&&Lo(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const Bo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ll{constructor(s,l){this._structArray=s,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,l){return s._trim(),l&&(s.isTransferred=!0,l.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const l=Object.create(this.prototype);return l.arrayBuffer=s.arrayBuffer,l.length=s.length,l.capacity=s.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Yn(u,s=1){let l=0,p=0;return{members:u.map((_=>{const b=Bo[_.type].BYTES_PER_ELEMENT,T=l=nc(l,Math.max(s,b)),C=_.components||1;return p=Math.max(p,b),l+=b*C,{name:_.name,type:_.type,components:C,offset:T}})),size:nc(l,Math.max(p,s)),alignment:s}}function nc(u,s){return Math.ceil(u/s)*s}class rc extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l){const p=this.length;return this.resize(p+1),this.emplace(p,s,l)}emplace(s,l,p){const _=2*s;return this.int16[_+0]=l,this.int16[_+1]=p,s}}rc.prototype.bytesPerElement=4,It("StructArrayLayout2i4",rc);class zi extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,l,p)}emplace(s,l,p,_){const b=3*s;return this.int16[b+0]=l,this.int16[b+1]=p,this.int16[b+2]=_,s}}zi.prototype.bytesPerElement=6,It("StructArrayLayout3i6",zi);class Qi extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,s,l,p,_)}emplace(s,l,p,_,b){const T=4*s;return this.int16[T+0]=l,this.int16[T+1]=p,this.int16[T+2]=_,this.int16[T+3]=b,s}}Qi.prototype.bytesPerElement=8,It("StructArrayLayout4i8",Qi);class ic extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T){const C=this.length;return this.resize(C+1),this.emplace(C,s,l,p,_,b,T)}emplace(s,l,p,_,b,T,C){const M=6*s;return this.int16[M+0]=l,this.int16[M+1]=p,this.int16[M+2]=_,this.int16[M+3]=b,this.int16[M+4]=T,this.int16[M+5]=C,s}}ic.prototype.bytesPerElement=12,It("StructArrayLayout2i4i12",ic);class cu extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T){const C=this.length;return this.resize(C+1),this.emplace(C,s,l,p,_,b,T)}emplace(s,l,p,_,b,T,C){const M=4*s,O=8*s;return this.int16[M+0]=l,this.int16[M+1]=p,this.uint8[O+4]=_,this.uint8[O+5]=b,this.uint8[O+6]=T,this.uint8[O+7]=C,s}}cu.prototype.bytesPerElement=8,It("StructArrayLayout2i4ub8",cu);class Is extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l){const p=this.length;return this.resize(p+1),this.emplace(p,s,l)}emplace(s,l,p){const _=2*s;return this.float32[_+0]=l,this.float32[_+1]=p,s}}Is.prototype.bytesPerElement=8,It("StructArrayLayout2f8",Is);class th extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M,O,F){const V=this.length;return this.resize(V+1),this.emplace(V,s,l,p,_,b,T,C,M,O,F)}emplace(s,l,p,_,b,T,C,M,O,F,V){const H=10*s;return this.uint16[H+0]=l,this.uint16[H+1]=p,this.uint16[H+2]=_,this.uint16[H+3]=b,this.uint16[H+4]=T,this.uint16[H+5]=C,this.uint16[H+6]=M,this.uint16[H+7]=O,this.uint16[H+8]=F,this.uint16[H+9]=V,s}}th.prototype.bytesPerElement=20,It("StructArrayLayout10ui20",th);class cl extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M){const O=this.length;return this.resize(O+1),this.emplace(O,s,l,p,_,b,T,C,M)}emplace(s,l,p,_,b,T,C,M,O){const F=8*s;return this.uint16[F+0]=l,this.uint16[F+1]=p,this.uint16[F+2]=_,this.uint16[F+3]=b,this.uint16[F+4]=T,this.uint16[F+5]=C,this.uint16[F+6]=M,this.uint16[F+7]=O,s}}cl.prototype.bytesPerElement=16,It("StructArrayLayout8ui16",cl);class gs extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M,O,F,V,H){const X=this.length;return this.resize(X+1),this.emplace(X,s,l,p,_,b,T,C,M,O,F,V,H)}emplace(s,l,p,_,b,T,C,M,O,F,V,H,X){const q=12*s;return this.int16[q+0]=l,this.int16[q+1]=p,this.int16[q+2]=_,this.int16[q+3]=b,this.uint16[q+4]=T,this.uint16[q+5]=C,this.uint16[q+6]=M,this.uint16[q+7]=O,this.int16[q+8]=F,this.int16[q+9]=V,this.int16[q+10]=H,this.int16[q+11]=X,s}}gs.prototype.bytesPerElement=24,It("StructArrayLayout4i4ui4i24",gs);class ul extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,l,p)}emplace(s,l,p,_){const b=3*s;return this.float32[b+0]=l,this.float32[b+1]=p,this.float32[b+2]=_,s}}ul.prototype.bytesPerElement=12,It("StructArrayLayout3f12",ul);class x extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint32[1*s+0]=l,s}}x.prototype.bytesPerElement=4,It("StructArrayLayout1ul4",x);class i extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M,O){const F=this.length;return this.resize(F+1),this.emplace(F,s,l,p,_,b,T,C,M,O)}emplace(s,l,p,_,b,T,C,M,O,F){const V=10*s,H=5*s;return this.int16[V+0]=l,this.int16[V+1]=p,this.int16[V+2]=_,this.int16[V+3]=b,this.int16[V+4]=T,this.int16[V+5]=C,this.uint32[H+3]=M,this.uint16[V+8]=O,this.uint16[V+9]=F,s}}i.prototype.bytesPerElement=20,It("StructArrayLayout6i1ul2ui20",i);class h extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T){const C=this.length;return this.resize(C+1),this.emplace(C,s,l,p,_,b,T)}emplace(s,l,p,_,b,T,C){const M=6*s;return this.int16[M+0]=l,this.int16[M+1]=p,this.int16[M+2]=_,this.int16[M+3]=b,this.int16[M+4]=T,this.int16[M+5]=C,s}}h.prototype.bytesPerElement=12,It("StructArrayLayout2i2i2i12",h);class m extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,s,l,p,_,b)}emplace(s,l,p,_,b,T){const C=4*s,M=8*s;return this.float32[C+0]=l,this.float32[C+1]=p,this.float32[C+2]=_,this.int16[M+6]=b,this.int16[M+7]=T,s}}m.prototype.bytesPerElement=16,It("StructArrayLayout2f1f2i16",m);class y extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T){const C=this.length;return this.resize(C+1),this.emplace(C,s,l,p,_,b,T)}emplace(s,l,p,_,b,T,C){const M=16*s,O=4*s,F=8*s;return this.uint8[M+0]=l,this.uint8[M+1]=p,this.float32[O+1]=_,this.float32[O+2]=b,this.int16[F+6]=T,this.int16[F+7]=C,s}}y.prototype.bytesPerElement=16,It("StructArrayLayout2ub2f2i16",y);class w extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,l,p)}emplace(s,l,p,_){const b=3*s;return this.uint16[b+0]=l,this.uint16[b+1]=p,this.uint16[b+2]=_,s}}w.prototype.bytesPerElement=6,It("StructArrayLayout3ui6",w);class E extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M,O,F,V,H,X,q,ee,se,pe){const Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,s,l,p,_,b,T,C,M,O,F,V,H,X,q,ee,se,pe)}emplace(s,l,p,_,b,T,C,M,O,F,V,H,X,q,ee,se,pe,Ve){const be=24*s,Ie=12*s,Je=48*s;return this.int16[be+0]=l,this.int16[be+1]=p,this.uint16[be+2]=_,this.uint16[be+3]=b,this.uint32[Ie+2]=T,this.uint32[Ie+3]=C,this.uint32[Ie+4]=M,this.uint16[be+10]=O,this.uint16[be+11]=F,this.uint16[be+12]=V,this.float32[Ie+7]=H,this.float32[Ie+8]=X,this.uint8[Je+36]=q,this.uint8[Je+37]=ee,this.uint8[Je+38]=se,this.uint32[Ie+10]=pe,this.int16[be+22]=Ve,s}}E.prototype.bytesPerElement=48,It("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",E);class R extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,p,_,b,T,C,M,O,F,V,H,X,q,ee,se,pe,Ve,be,Ie,Je,st,gt,Ft,Pt,Dt,Yt,Rt){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,s,l,p,_,b,T,C,M,O,F,V,H,X,q,ee,se,pe,Ve,be,Ie,Je,st,gt,Ft,Pt,Dt,Yt,Rt)}emplace(s,l,p,_,b,T,C,M,O,F,V,H,X,q,ee,se,pe,Ve,be,Ie,Je,st,gt,Ft,Pt,Dt,Yt,Rt,Ot){const ct=32*s,sn=16*s;return this.int16[ct+0]=l,this.int16[ct+1]=p,this.int16[ct+2]=_,this.int16[ct+3]=b,this.int16[ct+4]=T,this.int16[ct+5]=C,this.int16[ct+6]=M,this.int16[ct+7]=O,this.uint16[ct+8]=F,this.uint16[ct+9]=V,this.uint16[ct+10]=H,this.uint16[ct+11]=X,this.uint16[ct+12]=q,this.uint16[ct+13]=ee,this.uint16[ct+14]=se,this.uint16[ct+15]=pe,this.uint16[ct+16]=Ve,this.uint16[ct+17]=be,this.uint16[ct+18]=Ie,this.uint16[ct+19]=Je,this.uint16[ct+20]=st,this.uint16[ct+21]=gt,this.uint16[ct+22]=Ft,this.uint32[sn+12]=Pt,this.float32[sn+13]=Dt,this.float32[sn+14]=Yt,this.uint16[ct+30]=Rt,this.uint16[ct+31]=Ot,s}}R.prototype.bytesPerElement=64,It("StructArrayLayout8i15ui1ul2f2ui64",R);class D extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.float32[1*s+0]=l,s}}D.prototype.bytesPerElement=4,It("StructArrayLayout1f4",D);class B extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,l,p)}emplace(s,l,p,_){const b=3*s;return this.uint16[6*s+0]=l,this.float32[b+1]=p,this.float32[b+2]=_,s}}B.prototype.bytesPerElement=12,It("StructArrayLayout1ui2f12",B);class U extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,l,p)}emplace(s,l,p,_){const b=4*s;return this.uint32[2*s+0]=l,this.uint16[b+2]=p,this.uint16[b+3]=_,s}}U.prototype.bytesPerElement=8,It("StructArrayLayout1ul2ui8",U);class W extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l){const p=this.length;return this.resize(p+1),this.emplace(p,s,l)}emplace(s,l,p){const _=2*s;return this.uint16[_+0]=l,this.uint16[_+1]=p,s}}W.prototype.bytesPerElement=4,It("StructArrayLayout2ui4",W);class $ extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint16[1*s+0]=l,s}}$.prototype.bytesPerElement=2,It("StructArrayLayout1ui2",$);class Z extends zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,s,l,p,_)}emplace(s,l,p,_,b){const T=4*s;return this.float32[T+0]=l,this.float32[T+1]=p,this.float32[T+2]=_,this.float32[T+3]=b,s}}Z.prototype.bytesPerElement=16,It("StructArrayLayout4f16",Z);class J extends ll{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new v(this.anchorPointX,this.anchorPointY)}}J.prototype.size=20;class ie extends i{get(s){return new J(this,s)}}It("CollisionBoxArray",ie);class oe extends ll{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}oe.prototype.size=48;class ae extends E{get(s){return new oe(this,s)}}It("PlacedSymbolArray",ae);class de extends ll{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}de.prototype.size=64;class ye extends R{get(s){return new de(this,s)}}It("SymbolInstanceArray",ye);class he extends D{getoffsetX(s){return this.float32[1*s+0]}}It("GlyphOffsetArray",he);class we extends zi{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}It("SymbolLineVertexArray",we);class Me extends ll{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Me.prototype.size=12;class _e extends B{get(s){return new Me(this,s)}}It("TextAnchorOffsetArray",_e);class Re extends ll{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Re.prototype.size=8;class Ge extends U{get(s){return new Re(this,s)}}It("FeatureIndexArray",Ge);class qe extends rc{}class Ye extends rc{}class tt extends rc{}class wt extends ic{}class xt extends cu{}class ft extends Is{}class Ut extends th{}class vn extends cl{}class Zn extends gs{}class lr extends ul{}class ir extends x{}class tr extends h{}class cr extends y{}class Ir extends w{}class nr extends W{}const Kn=Yn([{name:"a_pos",components:2,type:"Int16"}],4),{members:fr}=Kn;class Sn{constructor(s=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=s}prepareSegment(s,l,p,_){const b=this.segments[this.segments.length-1];return s>Sn.MAX_VERTEX_ARRAY_LENGTH&&Jn(`Max vertices per segment is ${Sn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Sn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!b||b.vertexLength+s>Sn.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==_?this.createNewSegment(l,p,_):b}createNewSegment(s,l,p){const _={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(_.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(_),_}getOrCreateLatestSegment(s,l,p){return this.prepareSegment(0,s,l,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const s of this.segments)for(const l in s.vaos)s.vaos[l].destroy()}static simpleSegment(s,l,p,_){return new Sn([{vertexOffset:s,primitiveOffset:l,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function Qr(u,s){return 256*(u=ht(Math.floor(u),0,255))+ht(Math.floor(s),0,255)}Sn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,It("SegmentVector",Sn);const yo=Yn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ba=Yn([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var vo,wa,sc,zo={exports:{}},hl={exports:{}},es={exports:{}},Ta=(function(){if(sc)return zo.exports;sc=1;var u=(vo||(vo=1,hl.exports=function(l,p){var _,b,T,C,M,O,F,V;for(b=l.length-(_=3&l.length),T=p,M=3432918353,O=461845907,V=0;V<b;)F=255&l.charCodeAt(V)|(255&l.charCodeAt(++V))<<8|(255&l.charCodeAt(++V))<<16|(255&l.charCodeAt(++V))<<24,++V,T=27492+(65535&(C=5*(65535&(T=(T^=F=(65535&(F=(F=(65535&F)*M+(((F>>>16)*M&65535)<<16)&4294967295)<<15|F>>>17))*O+(((F>>>16)*O&65535)<<16)&4294967295)<<13|T>>>19))+((5*(T>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(F=0,_){case 3:F^=(255&l.charCodeAt(V+2))<<16;case 2:F^=(255&l.charCodeAt(V+1))<<8;case 1:T^=F=(65535&(F=(F=(65535&(F^=255&l.charCodeAt(V)))*M+(((F>>>16)*M&65535)<<16)&4294967295)<<15|F>>>17))*O+(((F>>>16)*O&65535)<<16)&4294967295}return T^=l.length,T=2246822507*(65535&(T^=T>>>16))+((2246822507*(T>>>16)&65535)<<16)&4294967295,T=3266489909*(65535&(T^=T>>>13))+((3266489909*(T>>>16)&65535)<<16)&4294967295,(T^=T>>>16)>>>0}),hl.exports),s=(wa||(wa=1,es.exports=function(l,p){for(var _,b=l.length,T=p^b,C=0;b>=4;)_=1540483477*(65535&(_=255&l.charCodeAt(C)|(255&l.charCodeAt(++C))<<8|(255&l.charCodeAt(++C))<<16|(255&l.charCodeAt(++C))<<24))+((1540483477*(_>>>16)&65535)<<16),T=1540483477*(65535&T)+((1540483477*(T>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),b-=4,++C;switch(b){case 3:T^=(255&l.charCodeAt(C+2))<<16;case 2:T^=(255&l.charCodeAt(C+1))<<8;case 1:T=1540483477*(65535&(T^=255&l.charCodeAt(C)))+((1540483477*(T>>>16)&65535)<<16)}return T=1540483477*(65535&(T^=T>>>13))+((1540483477*(T>>>16)&65535)<<16),(T^=T>>>15)>>>0}),es.exports);return zo.exports=u,zo.exports.murmur3=u,zo.exports.murmur2=s,zo.exports})(),Uo=A(Ta);class Vo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,l,p,_){this.ids.push(Fr(s)),this.positions.push(l,p,_)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Fr(s);let p=0,_=this.ids.length-1;for(;p<_;){const T=p+_>>1;this.ids[T]>=l?_=T:p=T+1}const b=[];for(;this.ids[p]===l;)b.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return b}static serialize(s,l){const p=new Float64Array(s.ids),_=new Uint32Array(s.positions);return Nr(p,_,0,p.length-1),l&&l.push(p.buffer,_.buffer),{ids:p,positions:_}}static deserialize(s){const l=new Vo;return l.ids=s.ids,l.positions=s.positions,l.indexed=!0,l}}function Fr(u){const s=+u;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:Uo(String(u))}function Nr(u,s,l,p){for(;l<p;){const _=u[l+p>>1];let b=l-1,T=p+1;for(;;){do b++;while(u[b]<_);do T--;while(u[T]>_);if(b>=T)break;ei(u,b,T),ei(s,3*b,3*T),ei(s,3*b+1,3*T+1),ei(s,3*b+2,3*T+2)}T-l<p-T?(Nr(u,s,l,T),l=T+1):(Nr(u,s,T+1,p),p=T)}}function ei(u,s,l){const p=u[s];u[s]=u[l],u[l]=p}It("FeaturePositionMap",Vo);class pr{constructor(s,l){this.gl=s.gl,this.location=l}}class nh extends pr{constructor(s,l){super(s,l),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class lf extends pr{constructor(s,l){super(s,l),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class Ms extends pr{constructor(s,l){super(s,l),this.current=Tn.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const ld=new Float32Array(16);function oc(u){return[Qr(255*u.r,255*u.g),Qr(255*u.b,255*u.a)]}class ac{constructor(s,l,p){this.value=s,this.uniformNames=l.map((_=>`u_${_}`)),this.type=p}setUniform(s,l,p){s.set(p.constantOr(this.value))}getBinding(s,l,p){return this.type==="color"?new Ms(s,l):new nh(s,l)}}class ts{constructor(s,l){this.uniformNames=l.map((p=>`u_${p}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=s.tlbr}setConstantDashPositions(s,l){this.dashTo=[0,s.y,s.height,s.width],this.dashFrom=[0,l.y,l.height,l.width]}setUniform(s,l,p,_){let b=null;_==="u_pattern_to"?b=this.patternTo:_==="u_pattern_from"?b=this.patternFrom:_==="u_dasharray_to"?b=this.dashTo:_==="u_dasharray_from"?b=this.dashFrom:_==="u_pixel_ratio_to"?b=this.pixelRatioTo:_==="u_pixel_ratio_from"&&(b=this.pixelRatioFrom),b!==null&&s.set(b)}getBinding(s,l,p){return p.substr(0,9)==="u_pattern"||p.substr(0,12)==="u_dasharray_"?new lf(s,l):new nh(s,l)}}class Js{constructor(s,l,p,_){this.expression=s,this.type=p,this.maxValue=0,this.paintVertexAttributes=l.map((b=>({name:`a_${b}`,type:"Float32",components:p==="color"?2:1,offset:0}))),this.paintVertexArray=new _}populatePaintArray(s,l,p){const _=this.paintVertexArray.length,b=this.expression.evaluate(new Hn(0,p),l,{},p.canonical,[],p.formattedSection);this.paintVertexArray.resize(s),this._setPaintValue(_,s,b)}updatePaintArray(s,l,p,_,b){const T=this.expression.evaluate(new Hn(0,b),p,_);this._setPaintValue(s,l,T)}_setPaintValue(s,l,p){if(this.type==="color"){const _=oc(p);for(let b=s;b<l;b++)this.paintVertexArray.emplace(b,_[0],_[1])}else{for(let _=s;_<l;_++)this.paintVertexArray.emplace(_,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ns{constructor(s,l,p,_,b,T){this.expression=s,this.uniformNames=l.map((C=>`u_${C}_t`)),this.type=p,this.useIntegerZoom=_,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=l.map((C=>({name:`a_${C}`,type:"Float32",components:p==="color"?4:2,offset:0}))),this.paintVertexArray=new T}populatePaintArray(s,l,p){const _=this.expression.evaluate(new Hn(this.zoom,p),l,{},p.canonical,[],p.formattedSection),b=this.expression.evaluate(new Hn(this.zoom+1,p),l,{},p.canonical,[],p.formattedSection),T=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(T,s,_,b)}updatePaintArray(s,l,p,_,b){const T=this.expression.evaluate(new Hn(this.zoom,b),p,_),C=this.expression.evaluate(new Hn(this.zoom+1,b),p,_);this._setPaintValue(s,l,T,C)}_setPaintValue(s,l,p,_){if(this.type==="color"){const b=oc(p),T=oc(_);for(let C=s;C<l;C++)this.paintVertexArray.emplace(C,b[0],b[1],T[0],T[1])}else{for(let b=s;b<l;b++)this.paintVertexArray.emplace(b,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,l){const p=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,_=ht(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);s.set(_)}getBinding(s,l,p){return new nh(s,l)}}class rs{constructor(s,l,p,_,b,T){this.expression=s,this.type=l,this.useIntegerZoom=p,this.zoom=_,this.layerId=T,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(s,l,p){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(_,s,this.getPositionIds(l),p)}updatePaintArray(s,l,p,_,b){this._setPaintValues(s,l,this.getPositionIds(p),b)}_setPaintValues(s,l,p,_){const b=this.getPositions(_);if(!b||!p)return;const T=b[p.min],C=b[p.mid],M=b[p.max];if(T&&C&&M)for(let O=s;O<l;O++)this.emplace(this.zoomInPaintVertexArray,O,C,T),this.emplace(this.zoomOutPaintVertexArray,O,C,M)}upload(s){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const l=this.getVertexAttributes();this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,l,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,l,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class lc extends rs{getPositions(s){return s.imagePositions}getPositionIds(s){return s.patterns&&s.patterns[this.layerId]}getVertexAttributes(){return yo.members}emplace(s,l,p,_){s.emplace(l,p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],_.tlbr[0],_.tlbr[1],_.tlbr[2],_.tlbr[3],p.pixelRatio,_.pixelRatio)}}class uu extends rs{getPositions(s){return s.dashPositions}getPositionIds(s){return s.dashes&&s.dashes[this.layerId]}getVertexAttributes(){return ba.members}emplace(s,l,p,_){s.emplace(l,0,p.y,p.height,p.width,0,_.y,_.height,_.width)}}class rh{constructor(s,l,p){this.binders={},this._buffers=[];const _=[];for(const b in s.paint._values){if(!p(b))continue;const T=s.paint.get(b);if(!(T instanceof ps&&Lo(T.property.specification)))continue;const C=xg(b,s.type),M=T.value,O=T.property.specification.type,F=T.property.useIntegerZoom,V=T.property.specification["property-type"],H=V==="cross-faded"||V==="cross-faded-data-driven";if(M.kind==="constant")this.binders[b]=H?new ts(M.value,C):new ac(M.value,C,O),_.push(`/u_${b}`);else if(M.kind==="source"||H){const X=Zp(b,O,"source");this.binders[b]=H?b==="line-dasharray"?new uu(M,O,F,l,X,s.id):new lc(M,O,F,l,X,s.id):new Js(M,C,O,X),_.push(`/a_${b}`)}else{const X=Zp(b,O,"composite");this.binders[b]=new ns(M,C,O,F,l,X),_.push(`/z_${b}`)}}this.cacheKey=_.sort().join("")}getMaxValue(s){const l=this.binders[s];return l instanceof Js||l instanceof ns?l.maxValue:0}populatePaintArrays(s,l,p){for(const _ in this.binders){const b=this.binders[_];(b instanceof Js||b instanceof ns||b instanceof rs)&&b.populatePaintArray(s,l,p)}}setConstantPatternPositions(s,l){for(const p in this.binders){const _=this.binders[p];_ instanceof ts&&_.setConstantPatternPositions(s,l)}}setConstantDashPositions(s,l){for(const p in this.binders){const _=this.binders[p];_ instanceof ts&&_.setConstantDashPositions(s,l)}}updatePaintArrays(s,l,p,_,b){let T=!1;for(const C in s){const M=l.getPositions(C);for(const O of M){const F=p.feature(O.index);for(const V in this.binders){const H=this.binders[V];if((H instanceof Js||H instanceof ns||H instanceof rs)&&H.expression.isStateDependent===!0){const X=_.paint.get(V);H.expression=X.value,H.updatePaintArray(O.start,O.end,F,s[C],b),T=!0}}}}return T}defines(){const s=[];for(const l in this.binders){const p=this.binders[l];(p instanceof ac||p instanceof ts)&&s.push(...p.uniformNames.map((_=>`#define HAS_UNIFORM_${_}`)))}return s}getBinderAttributes(){const s=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof Js||p instanceof ns)for(let _=0;_<p.paintVertexAttributes.length;_++)s.push(p.paintVertexAttributes[_].name);else if(p instanceof rs){const _=p.getVertexAttributes();for(const b of _)s.push(b.name)}}return s}getBinderUniforms(){const s=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof ac||p instanceof ts||p instanceof ns)for(const _ of p.uniformNames)s.push(_)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,l){const p=[];for(const _ in this.binders){const b=this.binders[_];if(b instanceof ac||b instanceof ts||b instanceof ns){for(const T of b.uniformNames)if(l[T]){const C=b.getBinding(s,l[T],T);p.push({name:T,property:_,binding:C})}}}return p}setUniforms(s,l,p,_){for(const{name:b,property:T,binding:C}of l)this.binders[T].setUniform(C,_,p.get(T),b)}updatePaintBuffers(s){this._buffers=[];for(const l in this.binders){const p=this.binders[l];if(s&&p instanceof rs){const _=s.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(p instanceof Js||p instanceof ns)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(s){for(const l in this.binders){const p=this.binders[l];(p instanceof Js||p instanceof ns||p instanceof rs)&&p.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const l=this.binders[s];(l instanceof Js||l instanceof ns||l instanceof rs)&&l.destroy()}}}class cc{constructor(s,l,p=()=>!0){this.programConfigurations={};for(const _ of s)this.programConfigurations[_.id]=new rh(_,l,p);this.needsUpload=!1,this._featureMap=new Vo,this._bufferOffset=0}populatePaintArrays(s,l,p,_){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(s,l,_);l.id!==void 0&&this._featureMap.add(l.id,p,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,l,p,_){for(const b of p)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(s,this._featureMap,l,b,_)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function xg(u,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${s}-`,"").replace(/-/g,"_")]}function Zp(u,s,l){const p={color:{source:Is,composite:Z},number:{source:D,composite:Is}},_=(function(b){return{"line-pattern":{source:Ut,composite:Ut},"fill-pattern":{source:Ut,composite:Ut},"fill-extrusion-pattern":{source:Ut,composite:Ut},"line-dasharray":{source:vn,composite:vn}}[b]})(u);return _&&_[l]||p[s][l]}It("ConstantBinder",ac),It("CrossFadedConstantBinder",ts),It("SourceExpressionBinder",Js),It("CrossFadedPatternBinder",lc),It("CrossFadedDasharrayBinder",uu),It("CompositeExpressionBinder",ns),It("ProgramConfiguration",rh,{omit:["_buffers"]}),It("ProgramConfigurationSet",cc);const cf=Math.pow(2,14)-1,Xp=-cf-1;function hu(u){const s=ze/u.extent,l=u.loadGeometry();for(let p=0;p<l.length;p++){const _=l[p];for(let b=0;b<_.length;b++){const T=_[b],C=Math.round(T.x*s),M=Math.round(T.y*s);T.x=ht(C,Xp,cf),T.y=ht(M,Xp,cf),(C<T.x||C>T.x+1||M<T.y||M>T.y+1)&&Jn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function ti(u,s){return{type:u.type,id:u.id,properties:u.properties,geometry:s?hu(u):[]}}const is=-32768;function bg(u,s,l,p,_){u.emplaceBack(is+8*s+p,is+8*l+_)}class uf{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=s.index,this.hasDependencies=!1,this.layoutVertexArray=new Ye,this.indexArray=new Ir,this.segments=new Sn,this.programConfigurations=new cc(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(s,l,p){const _=this.layers[0],b=[];let T=null,C=!1,M=_.type==="heatmap";if(_.type==="circle"){const F=_;T=F.layout.get("circle-sort-key"),C=!T.isConstant(),M=M||F.paint.get("circle-pitch-alignment")==="map"}const O=M?l.subdivisionGranularity.circle:1;for(const{feature:F,id:V,index:H,sourceLayerIndex:X}of s){const q=this.layers[0]._featureFilter.needGeometry,ee=ti(F,q);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),ee,p))continue;const se=C?T.evaluate(ee,{},p):void 0,pe={id:V,properties:F.properties,type:F.type,sourceLayerIndex:X,index:H,geometry:q?ee.geometry:hu(F),patterns:{},sortKey:se};b.push(pe)}C&&b.sort(((F,V)=>F.sortKey-V.sortKey));for(const F of b){const{geometry:V,index:H,sourceLayerIndex:X}=F,q=s[H].feature;this.addFeature(F,V,H,p,O),l.featureIndex.insert(q,V,H,X,this.index)}}update(s,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:p})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,fr),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,l,p,_,b=1){let T;switch(b){case 1:T=[0,7];break;case 3:T=[0,2,5,7];break;case 5:T=[0,1,3,4,6,7];break;case 7:T=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${b}; valid values are 1, 3, 5, 7.`)}const C=T.length;for(const M of l)for(const O of M){const F=O.x,V=O.y;if(F<0||F>=ze||V<0||V>=ze)continue;const H=this.segments.prepareSegment(C*C,this.layoutVertexArray,this.indexArray,s.sortKey),X=H.vertexLength;for(let q=0;q<C;q++)for(let ee=0;ee<C;ee++)bg(this.layoutVertexArray,F,V,T[ee],T[q]);for(let q=0;q<C-1;q++)for(let ee=0;ee<C-1;ee++){const se=X+q*C+ee,pe=X+(q+1)*C+ee;this.indexArray.emplaceBack(se,pe+1,se+1),this.indexArray.emplaceBack(se,pe,pe+1)}H.vertexLength+=C*C,H.primitiveLength+=(C-1)*(C-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,{imagePositions:{},canonical:_})}}function qp(u,s){for(let l=0;l<u.length;l++)if(uc(s,u[l]))return!0;for(let l=0;l<s.length;l++)if(uc(u,s[l]))return!0;return!!hf(u,s)}function cd(u,s,l){return!!uc(u,s)||!!df(s,u,l)}function Gp(u,s){if(u.length===1)return ff(s,u[0]);for(let l=0;l<s.length;l++){const p=s[l];for(let _=0;_<p.length;_++)if(uc(u,p[_]))return!0}for(let l=0;l<u.length;l++)if(ff(s,u[l]))return!0;for(let l=0;l<s.length;l++)if(hf(u,s[l]))return!0;return!1}function Yp(u,s,l){if(u.length>1){if(hf(u,s))return!0;for(let p=0;p<s.length;p++)if(df(s[p],u,l))return!0}for(let p=0;p<u.length;p++)if(df(u[p],s,l))return!0;return!1}function hf(u,s){if(u.length===0||s.length===0)return!1;for(let l=0;l<u.length-1;l++){const p=u[l],_=u[l+1];for(let b=0;b<s.length-1;b++)if(Kp(p,_,s[b],s[b+1]))return!0}return!1}function Kp(u,s,l,p){return pn(u,l,p)!==pn(s,l,p)&&pn(u,s,l)!==pn(u,s,p)}function df(u,s,l){const p=l*l;if(s.length===1)return u.distSqr(s[0])<p;for(let _=1;_<s.length;_++)if(Jp(u,s[_-1],s[_])<p)return!0;return!1}function Jp(u,s,l){const p=s.distSqr(l);if(p===0)return u.distSqr(s);const _=((u.x-s.x)*(l.x-s.x)+(u.y-s.y)*(l.y-s.y))/p;return u.distSqr(_<0?s:_>1?l:l.sub(s)._mult(_)._add(s))}function ff(u,s){let l,p,_,b=!1;for(let T=0;T<u.length;T++){l=u[T];for(let C=0,M=l.length-1;C<l.length;M=C++)p=l[C],_=l[M],p.y>s.y!=_.y>s.y&&s.x<(_.x-p.x)*(s.y-p.y)/(_.y-p.y)+p.x&&(b=!b)}return b}function uc(u,s){let l=!1;for(let p=0,_=u.length-1;p<u.length;_=p++){const b=u[p],T=u[_];b.y>s.y!=T.y>s.y&&s.x<(T.x-b.x)*(s.y-b.y)/(T.y-b.y)+b.x&&(l=!l)}return l}function wg(u,s,l){const p=l[0],_=l[2];if(u.x<p.x&&s.x<p.x||u.x>_.x&&s.x>_.x||u.y<p.y&&s.y<p.y||u.y>_.y&&s.y>_.y)return!1;const b=pn(u,s,l[0]);return b!==pn(u,s,l[1])||b!==pn(u,s,l[2])||b!==pn(u,s,l[3])}function hc(u,s,l){const p=s.paint.get(u).value;return p.kind==="constant"?p.value:l.programConfigurations.get(s.id).getMaxValue(u)}function du(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function pf(u,s,l,p,_){if(!s[0]&&!s[1])return u;const b=v.convert(s)._mult(_);l==="viewport"&&b._rotate(-p);const T=[];for(let C=0;C<u.length;C++)T.push(u[C].sub(b));return T}function Tg({queryGeometry:u,size:s},l){return cd(u,l,s)}function Qp({queryGeometry:u,size:s,transform:l,unwrappedTileID:p,getElevation:_},b){return cd(u,b,s*(l.projectTileCoordinates(b.x,b.y,p,_).signedDistanceFromCamera/l.cameraToCenterDistance))}function Sg({queryGeometry:u,size:s,transform:l,unwrappedTileID:p,getElevation:_},b){const T=l.projectTileCoordinates(b.x,b.y,p,_).signedDistanceFromCamera,C=s*(l.cameraToCenterDistance/T);return cd(u,em(b,l,p,_),C)}function mf({queryGeometry:u,size:s,transform:l,unwrappedTileID:p,getElevation:_},b){return cd(u,em(b,l,p,_),s)}function Sa({queryGeometry:u,size:s,transform:l,unwrappedTileID:p,getElevation:_,pitchAlignment:b="map",pitchScale:T="map"},C){const M=b==="map"?T==="map"?Tg:Qp:T==="map"?Sg:mf,O={queryGeometry:u,size:s,transform:l,unwrappedTileID:p,getElevation:_};for(const F of C)for(const V of F)if(M(O,V))return!0;return!1}function em(u,s,l,p){const _=s.projectTileCoordinates(u.x,u.y,l,p).point;return new v((.5*_.x+.5)*s.width,(.5*-_.y+.5)*s.height)}let tm,gf;It("CircleBucket",uf,{omit:["layers"]});var Ag={get paint(){return gf=gf||new Lr({"circle-radius":new Gt(Be.paint_circle["circle-radius"]),"circle-color":new Gt(Be.paint_circle["circle-color"]),"circle-blur":new Gt(Be.paint_circle["circle-blur"]),"circle-opacity":new Gt(Be.paint_circle["circle-opacity"]),"circle-translate":new jt(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(Be.paint_circle["circle-stroke-opacity"])})},get layout(){return tm=tm||new Lr({"circle-sort-key":new Gt(Be.layout_circle["circle-sort-key"])})}};class Pg extends ci{constructor(s,l){super(s,Ag,l)}createBucket(s){return new uf(s)}queryRadius(s){const l=s;return hc("circle-radius",this,l)+hc("circle-stroke-width",this,l)+du(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:p,geometry:_,transform:b,pixelsToTileUnits:T,unwrappedTileID:C,getElevation:M}){const O=pf(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-b.bearingInRadians,T),F=this.paint.get("circle-radius").evaluate(l,p)+this.paint.get("circle-stroke-width").evaluate(l,p),V=this.paint.get("circle-pitch-scale"),H=this.paint.get("circle-pitch-alignment");let X,q;return H==="map"?(X=O,q=F*T):(X=(function(ee,se,pe,Ve){return ee.map((be=>em(be,se,pe,Ve)))})(O,b,C,M),q=F),Sa({queryGeometry:X,size:q,transform:b,unwrappedTileID:C,getElevation:M,pitchAlignment:H,pitchScale:V},_)}}class ih extends uf{}let Ui;It("HeatmapBucket",ih,{omit:["layers"]});var By={get paint(){return Ui=Ui||new Lr({"heatmap-radius":new Gt(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tc(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(Be.paint_heatmap["heatmap-opacity"])})}};function nm(u,{width:s,height:l},p,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==s*l*p)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${s*l*p}`)}else _=new Uint8Array(s*l*p);return u.width=s,u.height=l,u.data=_,u}function ud(u,{width:s,height:l},p){if(s===u.width&&l===u.height)return;const _=nm({},{width:s,height:l},p);wi(u,_,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,s),height:Math.min(u.height,l)},p),u.width=s,u.height=l,u.data=_.data}function wi(u,s,l,p,_,b){if(_.width===0||_.height===0)return s;if(_.width>u.width||_.height>u.height||l.x>u.width-_.width||l.y>u.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||p.x>s.width-_.width||p.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const T=u.data,C=s.data;if(T===C)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<_.height;M++){const O=((l.y+M)*u.width+l.x)*b,F=((p.y+M)*s.width+p.x)*b;for(let V=0;V<_.width*b;V++)C[F+V]=T[O+V]}return s}class hd{constructor(s,l){nm(this,s,1,l)}resize(s){ud(this,s,1)}clone(){return new hd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,p,_,b){wi(s,l,p,_,b,1)}}class zt{constructor(s,l){nm(this,s,4,l)}resize(s){ud(this,s,4)}replace(s,l){l?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new zt({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,p,_,b){wi(s,l,p,_,b,4)}setPixel(s,l,p){const _=4*(s*this.width+l);this.data[_+0]=Math.round(255*p.r/p.a),this.data[_+1]=Math.round(255*p.g/p.a),this.data[_+2]=Math.round(255*p.b/p.a),this.data[_+3]=Math.round(255*p.a)}}function fu(u){const s={},l=u.resolution||256,p=u.clips?u.clips.length:1,_=u.image||new zt({width:l,height:p});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const b=(T,C,M)=>{s[u.evaluationKey]=M;const O=u.expression.evaluate(s);_.setPixel(T/4/l,C/4,O)};if(u.clips)for(let T=0,C=0;T<p;++T,C+=4*l)for(let M=0,O=0;M<l;M++,O+=4){const F=M/(l-1),{start:V,end:H}=u.clips[T];b(C,O,V*(1-F)+H*F)}else for(let T=0,C=0;T<l;T++,C+=4)b(0,C,T/(l-1));return _}It("AlphaImage",hd),It("RGBAImage",zt);const dd="big-fb";class Eg extends ci{createBucket(s){return new ih(s)}constructor(s,l){super(s,By,l),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(dd)&&this.heatmapFbos.delete(dd)}queryRadius(s){return hc("heatmap-radius",this,s)}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:p,geometry:_,transform:b,pixelsToTileUnits:T,unwrappedTileID:C,getElevation:M}){return Sa({queryGeometry:s,size:this.paint.get("heatmap-radius").evaluate(l,p)*T,transform:b,unwrappedTileID:C,getElevation:M},_)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Cg;var fd={get paint(){return Cg=Cg||new Lr({"hillshade-illumination-direction":new jt(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new jt(Be.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new jt(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(Be.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new jt(Be.paint_hillshade["hillshade-method"])})}};class _f extends ci{constructor(s,l){super(s,fd,l),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let s=this.paint.get("hillshade-illumination-direction").values,l=this.paint.get("hillshade-illumination-altitude").values,p=this.paint.get("hillshade-highlight-color").values,_=this.paint.get("hillshade-shadow-color").values;const b=Math.max(s.length,l.length,p.length,_.length);s=s.concat(Array(b-s.length).fill(s.at(-1))),l=l.concat(Array(b-l.length).fill(l.at(-1))),p=p.concat(Array(b-p.length).fill(p.at(-1))),_=_.concat(Array(b-_.length).fill(_.at(-1)));const T=l.map(ea);return{directionRadians:s.map(ea),altitudeRadians:T,shadowColor:_,highlightColor:p}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let yf;var Ig={get paint(){return yf=yf||new Lr({"color-relief-opacity":new jt(Be["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new tc(Be["paint_color-relief"]["color-relief-color"])})}};class vf{constructor(s,l,p,_){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(l,_)}update(s,l,p){const{width:_,height:b}=s,T=!(this.size&&this.size[0]===_&&this.size[1]===b||p),{context:C}=this,{gl:M}=C;if(this.useMipmap=!!(l&&l.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!l||l.premultiply!==!1)),T)this.size=[_,b],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ki(s)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,s):M.texImage2D(M.TEXTURE_2D,0,this.format,_,b,0,this.format,M.UNSIGNED_BYTE,s.data);else{const{x:O,y:F}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ki(s)?M.texSubImage2D(M.TEXTURE_2D,0,O,F,M.RGBA,M.UNSIGNED_BYTE,s):M.texSubImage2D(M.TEXTURE_2D,0,O,F,_,b,M.RGBA,M.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D),C.pixelStoreUnpackFlipY.setDefault(),C.pixelStoreUnpack.setDefault(),C.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(s,l,p){const{context:_}=this,{gl:b}=_;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),s!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||s),this.filter=s),l!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,l),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class rm{constructor(s,l,p,_=1,b=1,T=1,C=0){if(this.uid=s,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void Jn(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const M=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=b,this.blueFactor=T,this.baseShift=C;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<M;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(M,O)]=this.data[this._idx(M-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,M)]=this.data[this._idx(O,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<M;O++)for(let F=0;F<M;F++){const V=this.get(O,F);V>this.max&&(this.max=V),V<this.min&&(this.min=V)}}get(s,l){const p=new Uint8Array(this.data.buffer),_=4*this._idx(s,l);return this.unpack(p[_],p[_+1],p[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,l){if(s<-1||s>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(s+1)}unpack(s,l,p){return s*this.redFactor+l*this.greenFactor+p*this.blueFactor-this.baseShift}pack(s){return xf(s,this.getUnpackVector())}getPixels(){return new zt({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,l,p){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let _=l*this.dim,b=l*this.dim+this.dim,T=p*this.dim,C=p*this.dim+this.dim;switch(l){case-1:_=b-1;break;case 1:b=_+1}switch(p){case-1:T=C-1;break;case 1:C=T+1}const M=-l*this.dim,O=-p*this.dim;for(let F=T;F<C;F++)for(let V=_;V<b;V++)this.data[this._idx(V,F)]=s.data[this._idx(V+M,F+O)]}}function xf(u,s){const l=s[0],p=s[1],_=s[2],b=s[3],T=Math.min(l,p,_),C=Math.round((u+b)/T);return{r:Math.floor(C*T/l)%256,g:Math.floor(C*T/p)%256,b:Math.floor(C*T/_)%256}}It("DEMData",rm);class im extends ci{constructor(s,l){super(s,Ig,l)}_createColorRamp(s){const l={elevationStops:[],colorStops:[]},p=this._transitionablePaint._values["color-relief-color"].value.expression;if(p instanceof Xa&&p._styleExpression.expression instanceof Or){this.colorRampExpression=p;const T=p._styleExpression.expression;l.elevationStops=T.labels,l.colorStops=[];for(const C of l.elevationStops)l.colorStops.push(T.evaluate({globals:{elevation:C}}))}if(l.elevationStops.length<1&&(l.elevationStops=[0],l.colorStops=[Tn.transparent]),l.elevationStops.length<2&&(l.elevationStops.push(l.elevationStops[0]+1),l.colorStops.push(l.colorStops[0])),l.elevationStops.length<=s)return l;const _={elevationStops:[],colorStops:[]},b=(l.elevationStops.length-1)/(s-1);for(let T=0;T<l.elevationStops.length-.5;T+=b)_.elevationStops.push(l.elevationStops[Math.round(T)]),_.colorStops.push(l.colorStops[Math.round(T)]);return Jn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),_}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(s,l,p){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const _=this._createColorRamp(l),b=new zt({width:_.colorStops.length,height:1}),T=new zt({width:_.colorStops.length,height:1});for(let C=0;C<_.elevationStops.length;C++){const M=xf(_.elevationStops[C],p);T.setPixel(0,C,new Tn(M.r/255,M.g/255,M.b/255,1)),b.setPixel(0,C,_.colorStops[C])}return this.colorRampTextures={elevationTexture:new vf(s,T,s.gl.RGBA),colorTexture:new vf(s,b,s.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Vi=Yn([{name:"a_pos",components:2,type:"Int16"}],4),{members:jo}=Vi;function $o(u,s,l){const p=l.patternDependencies;let _=!1;for(const b of s){const T=b.paint.get(`${u}-pattern`);T.isConstant()||(_=!0);const C=T.constantOr(null);C&&(_=!0,p[C.to]=!0,p[C.from]=!0)}return _}function bf(u,s,l,p,_){const{zoom:b}=p,T=_.patternDependencies;for(const C of s){const M=C.paint.get(`${u}-pattern`).value;if(M.kind!=="constant"){let O=M.evaluate({zoom:b-1},l,{},_.availableImages),F=M.evaluate({zoom:b},l,{},_.availableImages),V=M.evaluate({zoom:b+1},l,{},_.availableImages);O=O&&O.name?O.name:O,F=F&&F.name?F.name:F,V=V&&V.name?V.name:V,T[O]=!0,T[F]=!0,T[V]=!0,l.patterns[C.id]={min:O,mid:F,max:V}}}return l}function sm(u,s,l,p,_){let b;if(_===(function(T,C,M,O){let F=0;for(let V=C,H=M-O;V<M;V+=O)F+=(T[H]-T[V])*(T[V+1]+T[H+1]),H=V;return F})(u,s,l,p)>0)for(let T=s;T<l;T+=p)b=pd(T/p|0,u[T],u[T+1],b);else for(let T=l-p;T>=s;T-=p)b=pd(T/p|0,u[T],u[T+1],b);return b&&Ur(b,b.next)&&(pu(b),b=b.next),b}function ji(u,s){if(!u)return u;s||(s=u);let l,p=u;do if(l=!1,p.steiner||!Ur(p,p.next)&&kn(p.prev,p,p.next)!==0)p=p.next;else{if(pu(p),p=s=p.prev,p===p.next)break;l=!0}while(l||p!==s);return s}function sh(u,s,l,p,_,b,T){if(!u)return;!T&&b&&(function(M,O,F,V){let H=M;do H.z===0&&(H.z=oh(H.x,H.y,O,F,V)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==M);H.prevZ.nextZ=null,H.prevZ=null,(function(X){let q,ee=1;do{let se,pe=X;X=null;let Ve=null;for(q=0;pe;){q++;let be=pe,Ie=0;for(let st=0;st<ee&&(Ie++,be=be.nextZ,be);st++);let Je=ee;for(;Ie>0||Je>0&&be;)Ie!==0&&(Je===0||!be||pe.z<=be.z)?(se=pe,pe=pe.nextZ,Ie--):(se=be,be=be.nextZ,Je--),Ve?Ve.nextZ=se:X=se,se.prevZ=Ve,Ve=se;pe=be}Ve.nextZ=null,ee*=2}while(q>1)})(H)})(u,p,_,b);let C=u;for(;u.prev!==u.next;){const M=u.prev,O=u.next;if(b?zy(u,p,_,b):Aa(u))s.push(M.i,u.i,O.i),pu(u),u=O.next,C=O.next;else if((u=O)===C){T?T===1?sh(u=Mg(ji(u),s),s,l,p,_,b,2):T===2&&Rg(u,s,l,p,_,b):sh(ji(u),s,l,p,_,b,1);break}}}function Aa(u){const s=u.prev,l=u,p=u.next;if(kn(s,l,p)>=0)return!1;const _=s.x,b=l.x,T=p.x,C=s.y,M=l.y,O=p.y,F=Math.min(_,b,T),V=Math.min(C,M,O),H=Math.max(_,b,T),X=Math.max(C,M,O);let q=p.next;for(;q!==s;){if(q.x>=F&&q.x<=H&&q.y>=V&&q.y<=X&&Bn(_,C,b,M,T,O,q.x,q.y)&&kn(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function zy(u,s,l,p){const _=u.prev,b=u,T=u.next;if(kn(_,b,T)>=0)return!1;const C=_.x,M=b.x,O=T.x,F=_.y,V=b.y,H=T.y,X=Math.min(C,M,O),q=Math.min(F,V,H),ee=Math.max(C,M,O),se=Math.max(F,V,H),pe=oh(X,q,s,l,p),Ve=oh(ee,se,s,l,p);let be=u.prevZ,Ie=u.nextZ;for(;be&&be.z>=pe&&Ie&&Ie.z<=Ve;){if(be.x>=X&&be.x<=ee&&be.y>=q&&be.y<=se&&be!==_&&be!==T&&Bn(C,F,M,V,O,H,be.x,be.y)&&kn(be.prev,be,be.next)>=0||(be=be.prevZ,Ie.x>=X&&Ie.x<=ee&&Ie.y>=q&&Ie.y<=se&&Ie!==_&&Ie!==T&&Bn(C,F,M,V,O,H,Ie.x,Ie.y)&&kn(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;be&&be.z>=pe;){if(be.x>=X&&be.x<=ee&&be.y>=q&&be.y<=se&&be!==_&&be!==T&&Bn(C,F,M,V,O,H,be.x,be.y)&&kn(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;Ie&&Ie.z<=Ve;){if(Ie.x>=X&&Ie.x<=ee&&Ie.y>=q&&Ie.y<=se&&Ie!==_&&Ie!==T&&Bn(C,F,M,V,O,H,Ie.x,Ie.y)&&kn(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function Mg(u,s){let l=u;do{const p=l.prev,_=l.next.next;!Ur(p,_)&&Rs(p,l,l.next,_)&&fl(p,_)&&fl(_,p)&&(s.push(p.i,l.i,_.i),pu(l),pu(l.next),l=u=_),l=l.next}while(l!==u);return ji(l)}function Rg(u,s,l,p,_,b){let T=u;do{let C=T.next.next;for(;C!==T.prev;){if(T.i!==C.i&&Ti(T,C)){let M=dc(T,C);return T=ji(T,T.next),M=ji(M,M.next),sh(T,s,l,p,_,b,0),void sh(M,s,l,p,_,b,0)}C=C.next}T=T.next}while(T!==u)}function kg(u,s){let l=u.x-s.x;return l===0&&(l=u.y-s.y,l===0)&&(l=(u.next.y-u.y)/(u.next.x-u.x)-(s.next.y-s.y)/(s.next.x-s.x)),l}function Dg(u,s){const l=(function(_,b){let T=b;const C=_.x,M=_.y;let O,F=-1/0;if(Ur(_,T))return T;do{if(Ur(_,T.next))return T.next;if(M<=T.y&&M>=T.next.y&&T.next.y!==T.y){const ee=T.x+(M-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(ee<=C&&ee>F&&(F=ee,O=T.x<T.next.x?T:T.next,ee===C))return O}T=T.next}while(T!==b);if(!O)return null;const V=O,H=O.x,X=O.y;let q=1/0;T=O;do{if(C>=T.x&&T.x>=H&&C!==T.x&&Qs(M<X?C:F,M,H,X,M<X?F:C,M,T.x,T.y)){const ee=Math.abs(M-T.y)/(C-T.x);fl(T,_)&&(ee<q||ee===q&&(T.x>O.x||T.x===O.x&&Uy(O,T)))&&(O=T,q=ee)}T=T.next}while(T!==V);return O})(u,s);if(!l)return s;const p=dc(l,u);return ji(p,p.next),ji(l,l.next)}function Uy(u,s){return kn(u.prev,u,s.prev)<0&&kn(s.next,u,u.next)<0}function oh(u,s,l,p,_){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-l)*_|0)|u<<8))|u<<4))|u<<2))|u<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-p)*_|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function om(u){let s=u,l=u;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==u);return l}function Qs(u,s,l,p,_,b,T,C){return(_-T)*(s-C)>=(u-T)*(b-C)&&(u-T)*(p-C)>=(l-T)*(s-C)&&(l-T)*(b-C)>=(_-T)*(p-C)}function Bn(u,s,l,p,_,b,T,C){return!(u===T&&s===C)&&Qs(u,s,l,p,_,b,T,C)}function Ti(u,s){return u.next.i!==s.i&&u.prev.i!==s.i&&!(function(l,p){let _=l;do{if(_.i!==l.i&&_.next.i!==l.i&&_.i!==p.i&&_.next.i!==p.i&&Rs(_,_.next,l,p))return!0;_=_.next}while(_!==l);return!1})(u,s)&&(fl(u,s)&&fl(s,u)&&(function(l,p){let _=l,b=!1;const T=(l.x+p.x)/2,C=(l.y+p.y)/2;do _.y>C!=_.next.y>C&&_.next.y!==_.y&&T<(_.next.x-_.x)*(C-_.y)/(_.next.y-_.y)+_.x&&(b=!b),_=_.next;while(_!==l);return b})(u,s)&&(kn(u.prev,u,s.prev)||kn(u,s.prev,s))||Ur(u,s)&&kn(u.prev,u,u.next)>0&&kn(s.prev,s,s.next)>0)}function kn(u,s,l){return(s.y-u.y)*(l.x-s.x)-(s.x-u.x)*(l.y-s.y)}function Ur(u,s){return u.x===s.x&&u.y===s.y}function Rs(u,s,l,p){const _=Vr(kn(u,s,l)),b=Vr(kn(u,s,p)),T=Vr(kn(l,p,u)),C=Vr(kn(l,p,s));return _!==b&&T!==C||!(_!==0||!dl(u,l,s))||!(b!==0||!dl(u,p,s))||!(T!==0||!dl(l,u,p))||!(C!==0||!dl(l,s,p))}function dl(u,s,l){return s.x<=Math.max(u.x,l.x)&&s.x>=Math.min(u.x,l.x)&&s.y<=Math.max(u.y,l.y)&&s.y>=Math.min(u.y,l.y)}function Vr(u){return u>0?1:u<0?-1:0}function fl(u,s){return kn(u.prev,u,u.next)<0?kn(u,s,u.next)>=0&&kn(u,u.prev,s)>=0:kn(u,s,u.prev)<0||kn(u,u.next,s)<0}function dc(u,s){const l=mu(u.i,u.x,u.y),p=mu(s.i,s.x,s.y),_=u.next,b=s.prev;return u.next=s,s.prev=u,l.next=_,_.prev=l,p.next=l,l.prev=p,b.next=p,p.prev=b,p}function pd(u,s,l,p){const _=mu(u,s,l);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function pu(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function mu(u,s,l){return{i:u,x:s,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ui{constructor(s,l){if(l>s)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=s,this._minGranularity=l}getGranularityForZoomLevel(s){return Math.max(Math.floor(this._baseZoomGranularity/(1<<s)),this._minGranularity,1)}}class ah{constructor(s){this.fill=s.fill,this.line=s.line,this.tile=s.tile,this.stencil=s.stencil,this.circle=s.circle}}ah.noSubdivision=new ah({fill:new ui(0,0),line:new ui(0,0),tile:new ui(0,0),stencil:new ui(0,0),circle:1}),It("SubdivisionGranularityExpression",ui),It("SubdivisionGranularitySetting",ah);const Wo=-32768,eo=32767;class wf{constructor(s,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=s,this._granularityCellSize=ze/s,this._canonical=l}_getKey(s,l){return(s+=32768)<<16|l+32768}_vertexToIndex(s,l){if(s<-32768||l<-32768||s>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(s),_=0|Math.round(l),b=this._getKey(p,_);if(this._vertexDictionary.has(b))return this._vertexDictionary.get(b);const T=this._vertexBuffer.length/2;return this._vertexDictionary.set(b,T),this._vertexBuffer.push(p,_),T}_subdivideTrianglesScanline(s){if(this._granularity<2)return(function(_,b){const T=[];for(let C=0;C<b.length;C+=3){const M=b[C],O=b[C+1],F=b[C+2],V=_[2*M],H=_[2*M+1];(_[2*O]-V)*(_[2*F+1]-H)-(_[2*O+1]-H)*(_[2*F]-V)>0?(T.push(M),T.push(F),T.push(O)):(T.push(M),T.push(O),T.push(F))}return T})(this._vertexBuffer,s);const l=[],p=s.length;for(let _=0;_<p;_+=3){const b=[s[_+0],s[_+1],s[_+2]],T=[this._vertexBuffer[2*s[_+0]+0],this._vertexBuffer[2*s[_+0]+1],this._vertexBuffer[2*s[_+1]+0],this._vertexBuffer[2*s[_+1]+1],this._vertexBuffer[2*s[_+2]+0],this._vertexBuffer[2*s[_+2]+1]];let C=1/0,M=1/0,O=-1/0,F=-1/0;for(let ee=0;ee<3;ee++){const se=T[2*ee],pe=T[2*ee+1];C=Math.min(C,se),O=Math.max(O,se),M=Math.min(M,pe),F=Math.max(F,pe)}if(C===O||M===F)continue;const V=Math.floor(C/this._granularityCellSize),H=Math.ceil(O/this._granularityCellSize),X=Math.floor(M/this._granularityCellSize),q=Math.ceil(F/this._granularityCellSize);if(V!==H||X!==q)for(let ee=X;ee<q;ee++){const se=this._scanlineGenerateVertexRingForCellRow(ee,T,b);Sf(this._vertexBuffer,se,l)}else l.push(...b)}return l}_scanlineGenerateVertexRingForCellRow(s,l,p){const _=s*this._granularityCellSize,b=_+this._granularityCellSize,T=[];for(let C=0;C<3;C++){const M=l[2*C],O=l[2*C+1],F=l[2*(C+1)%6],V=l[(2*(C+1)+1)%6],H=l[2*(C+2)%6],X=l[(2*(C+2)+1)%6],q=F-M,ee=V-O,se=q===0,pe=ee===0,Ve=(_-O)/ee,be=(b-O)/ee,Ie=Math.min(Ve,be),Je=Math.max(Ve,be);if(!pe&&(Ie>=1||Je<=0)||pe&&(O<_||O>b)){V>=_&&V<=b&&T.push(p[(C+1)%3]);continue}!pe&&Ie>0&&T.push(this._vertexToIndex(M+q*Ie,O+ee*Ie));const st=M+q*Math.max(Ie,0),gt=M+q*Math.min(Je,1);se||this._generateIntraEdgeVertices(T,M,O,F,V,st,gt),!pe&&Je<1&&T.push(this._vertexToIndex(M+q*Je,O+ee*Je)),(pe||V>=_&&V<=b)&&T.push(p[(C+1)%3]),!pe&&(V<=_||V>=b)&&this._generateInterEdgeVertices(T,M,O,F,V,H,X,gt,_,b)}return T}_generateIntraEdgeVertices(s,l,p,_,b,T,C){const M=_-l,O=b-p,F=O===0,V=F?Math.min(l,_):Math.min(T,C),H=F?Math.max(l,_):Math.max(T,C),X=Math.floor(V/this._granularityCellSize)+1,q=Math.ceil(H/this._granularityCellSize)-1;if(F?l<_:T<C)for(let ee=X;ee<=q;ee++){const se=ee*this._granularityCellSize;s.push(this._vertexToIndex(se,p+O*(se-l)/M))}else for(let ee=q;ee>=X;ee--){const se=ee*this._granularityCellSize;s.push(this._vertexToIndex(se,p+O*(se-l)/M))}}_generateInterEdgeVertices(s,l,p,_,b,T,C,M,O,F){const V=b-p,H=T-_,X=C-b,q=(O-b)/X,ee=(F-b)/X,se=Math.min(q,ee),pe=Math.max(q,ee),Ve=_+H*se;let be=Math.floor(Math.min(Ve,M)/this._granularityCellSize)+1,Ie=Math.ceil(Math.max(Ve,M)/this._granularityCellSize)-1,Je=M<Ve;const st=X===0;if(st&&(C===O||C===F))return;if(st||se>=1||pe<=0){const Ft=p-C,Pt=T+(l-T)*Math.min((O-C)/Ft,(F-C)/Ft);be=Math.floor(Math.min(Pt,M)/this._granularityCellSize)+1,Ie=Math.ceil(Math.max(Pt,M)/this._granularityCellSize)-1,Je=M<Pt}const gt=V>0?F:O;if(Je)for(let Ft=be;Ft<=Ie;Ft++)s.push(this._vertexToIndex(Ft*this._granularityCellSize,gt));else for(let Ft=Ie;Ft>=be;Ft--)s.push(this._vertexToIndex(Ft*this._granularityCellSize,gt))}_generateOutline(s){const l=[];for(const p of s){const _=ks(p,this._granularity,!0),b=this._pointArrayToIndices(_),T=[];for(let C=1;C<b.length;C++)T.push(b[C-1]),T.push(b[C]);l.push(T)}return l}_handlePoles(s){let l=!1,p=!1;this._canonical&&(this._canonical.y===0&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(l||p)&&this._fillPoles(s,l,p)}_ensureNoPoleVertices(){const s=this._vertexBuffer;for(let l=0;l<s.length;l+=2){const p=s[l+1];p===Wo&&(s[l+1]=-32767),p===eo&&(s[l+1]=32766)}}_generatePoleQuad(s,l,p,_,b,T){_>b!=(T===Wo)?(s.push(l),s.push(p),s.push(this._vertexToIndex(_,T)),s.push(p),s.push(this._vertexToIndex(b,T)),s.push(this._vertexToIndex(_,T))):(s.push(p),s.push(l),s.push(this._vertexToIndex(_,T)),s.push(this._vertexToIndex(b,T)),s.push(p),s.push(this._vertexToIndex(_,T)))}_fillPoles(s,l,p){const _=this._vertexBuffer,b=ze,T=s.length;for(let C=2;C<T;C+=3){const M=s[C-2],O=s[C-1],F=s[C],V=_[2*M],H=_[2*M+1],X=_[2*O],q=_[2*O+1],ee=_[2*F],se=_[2*F+1];l&&(H===0&&q===0&&this._generatePoleQuad(s,M,O,V,X,Wo),q===0&&se===0&&this._generatePoleQuad(s,O,F,X,ee,Wo),se===0&&H===0&&this._generatePoleQuad(s,F,M,ee,V,Wo)),p&&(H===b&&q===b&&this._generatePoleQuad(s,M,O,V,X,eo),q===b&&se===b&&this._generatePoleQuad(s,O,F,X,ee,eo),se===b&&H===b&&this._generatePoleQuad(s,F,M,ee,V,eo))}}_initializeVertices(s){for(let l=0;l<s.length;l+=2)this._vertexToIndex(s[l],s[l+1])}subdividePolygonInternal(s,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:_}=(function(C){const M=[],O=[];for(const F of C)if(F.length!==0){F!==C[0]&&M.push(O.length/2);for(let V=0;V<F.length;V++)O.push(F[V].x),O.push(F[V].y)}return{flattened:O,holeIndices:M}})(s);let b;this._initializeVertices(p);try{const C=(function(O,F,V=2){const H=F&&F.length,X=H?F[0]*V:O.length;let q=sm(O,0,X,V,!0);const ee=[];if(!q||q.next===q.prev)return ee;let se,pe,Ve;if(H&&(q=(function(be,Ie,Je,st){const gt=[];for(let Ft=0,Pt=Ie.length;Ft<Pt;Ft++){const Dt=sm(be,Ie[Ft]*st,Ft<Pt-1?Ie[Ft+1]*st:be.length,st,!1);Dt===Dt.next&&(Dt.steiner=!0),gt.push(om(Dt))}gt.sort(kg);for(let Ft=0;Ft<gt.length;Ft++)Je=Dg(gt[Ft],Je);return Je})(O,F,q,V)),O.length>80*V){se=O[0],pe=O[1];let be=se,Ie=pe;for(let Je=V;Je<X;Je+=V){const st=O[Je],gt=O[Je+1];st<se&&(se=st),gt<pe&&(pe=gt),st>be&&(be=st),gt>Ie&&(Ie=gt)}Ve=Math.max(be-se,Ie-pe),Ve=Ve!==0?32767/Ve:0}return sh(q,ee,V,se,pe,Ve,0),ee})(p,_),M=this._convertIndices(p,C);b=this._subdivideTrianglesScanline(M)}catch(C){console.error(C)}let T=[];return l&&(T=this._generateOutline(s)),this._ensureNoPoleVertices(),this._handlePoles(b),{verticesFlattened:this._vertexBuffer,indicesTriangles:b,indicesLineList:T}}_convertIndices(s,l){const p=[];for(let _=0;_<l.length;_++)p.push(this._vertexToIndex(s[2*l[_]],s[2*l[_]+1]));return p}_pointArrayToIndices(s){const l=[];for(let p=0;p<s.length;p++){const _=s[p];l.push(this._vertexToIndex(_.x,_.y))}return l}}function Tf(u,s,l,p=!0){return new wf(l,s).subdividePolygonInternal(u,p)}function ks(u,s,l=!1){if(!u||u.length<1)return[];if(u.length<2)return[];const p=u[0],_=u[u.length-1],b=l&&(p.x!==_.x||p.y!==_.y);if(s<2)return b?[...u,u[0]]:[...u];const T=Math.floor(ze/s),C=[];C.push(new v(u[0].x,u[0].y));const M=u.length,O=b?M:M-1;for(let F=0;F<O;F++){const V=u[F],H=F<M-1?u[F+1]:u[0],X=V.x,q=V.y,ee=H.x,se=H.y,pe=X!==ee,Ve=q!==se;if(!pe&&!Ve)continue;const be=ee-X,Ie=se-q,Je=Math.abs(be),st=Math.abs(Ie);let gt=X,Ft=q;for(;;){const Dt=be>0?(Math.floor(gt/T)+1)*T:(Math.ceil(gt/T)-1)*T,Yt=Ie>0?(Math.floor(Ft/T)+1)*T:(Math.ceil(Ft/T)-1)*T,Rt=Math.abs(gt-Dt),Ot=Math.abs(Ft-Yt),ct=Math.abs(gt-ee),sn=Math.abs(Ft-se),fn=pe?Rt/Je:Number.POSITIVE_INFINITY,en=Ve?Ot/st:Number.POSITIVE_INFINITY;if((ct<=Rt||!pe)&&(sn<=Ot||!Ve))break;if(fn<en&&pe||!Ve){gt=Dt,Ft+=Ie*fn;const Xt=new v(gt,Math.round(Ft));C[C.length-1].x===Xt.x&&C[C.length-1].y===Xt.y||C.push(Xt)}else{gt+=be*en,Ft=Yt;const Xt=new v(Math.round(gt),Ft);C[C.length-1].x===Xt.x&&C[C.length-1].y===Xt.y||C.push(Xt)}}const Pt=new v(ee,se);C[C.length-1].x===Pt.x&&C[C.length-1].y===Pt.y||C.push(Pt)}return C}function Sf(u,s,l){if(s.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,_=u[2*s[0]];for(let M=1;M<s.length;M++){const O=u[2*s[M]];O<_&&(_=O,p=M)}const b=s.length;let T=p,C=(T+1)%b;for(;;){const M=T-1>=0?T-1:b-1,O=(C+1)%b,F=u[2*s[M]],V=u[2*s[O]],H=u[2*s[T]],X=u[2*s[T]+1],q=u[2*s[C]+1];let ee=!1;if(F<V)ee=!0;else if(F>V)ee=!1;else{const se=q-X,pe=-(u[2*s[C]]-H),Ve=X<q?1:-1;((F-H)*se+(u[2*s[M]+1]-X)*pe)*Ve>((V-H)*se+(u[2*s[O]+1]-X)*pe)*Ve&&(ee=!0)}if(ee){const se=s[M],pe=s[T],Ve=s[C];se!==pe&&se!==Ve&&pe!==Ve&&l.push(Ve,pe,se),T--,T<0&&(T=b-1)}else{const se=s[O],pe=s[T],Ve=s[C];se!==pe&&se!==Ve&&pe!==Ve&&l.push(Ve,pe,se),C++,C>=b&&(C=0)}if(M===O)break}}function pl(u,s,l,p,_,b,T,C,M){const O=_.length/2,F=T&&C&&M;if(O<Sn.MAX_VERTEX_ARRAY_LENGTH){const V=s.prepareSegment(O,l,p),H=V.vertexLength;for(let ee=0;ee<b.length;ee+=3)p.emplaceBack(H+b[ee],H+b[ee+1],H+b[ee+2]);let X,q;V.vertexLength+=O,V.primitiveLength+=b.length/3,F&&(q=T.prepareSegment(O,l,C),X=q.vertexLength,q.vertexLength+=O);for(let ee=0;ee<_.length;ee+=2)u(_[ee],_[ee+1]);if(F)for(let ee=0;ee<M.length;ee++){const se=M[ee];for(let pe=1;pe<se.length;pe+=2)C.emplaceBack(X+se[pe-1],X+se[pe]);q.primitiveLength+=se.length/2}}else(function(V,H,X,q,ee,se){const pe=[];for(let st=0;st<q.length/2;st++)pe.push(-1);const Ve={count:0};let be=0,Ie=V.getOrCreateLatestSegment(H,X),Je=Ie.vertexLength;for(let st=2;st<ee.length;st+=3){const gt=ee[st-2],Ft=ee[st-1],Pt=ee[st];let Dt=pe[gt]<be,Yt=pe[Ft]<be,Rt=pe[Pt]<be;Ie.vertexLength+((Dt?1:0)+(Yt?1:0)+(Rt?1:0))>Sn.MAX_VERTEX_ARRAY_LENGTH&&(Ie=V.createNewSegment(H,X),be=Ve.count,Dt=!0,Yt=!0,Rt=!0,Je=0);const Ot=fc(pe,q,se,Ve,gt,Dt,Ie),ct=fc(pe,q,se,Ve,Ft,Yt,Ie),sn=fc(pe,q,se,Ve,Pt,Rt,Ie);X.emplaceBack(Je+Ot-be,Je+ct-be,Je+sn-be),Ie.primitiveLength++}})(s,l,p,_,b,u),F&&(function(V,H,X,q,ee,se){const pe=[];for(let st=0;st<q.length/2;st++)pe.push(-1);const Ve={count:0};let be=0,Ie=V.getOrCreateLatestSegment(H,X),Je=Ie.vertexLength;for(let st=0;st<ee.length;st++){const gt=ee[st];for(let Ft=1;Ft<ee[st].length;Ft+=2){const Pt=gt[Ft-1],Dt=gt[Ft];let Yt=pe[Pt]<be,Rt=pe[Dt]<be;Ie.vertexLength+((Yt?1:0)+(Rt?1:0))>Sn.MAX_VERTEX_ARRAY_LENGTH&&(Ie=V.createNewSegment(H,X),be=Ve.count,Yt=!0,Rt=!0,Je=0);const Ot=fc(pe,q,se,Ve,Pt,Yt,Ie),ct=fc(pe,q,se,Ve,Dt,Rt,Ie);X.emplaceBack(Je+Ot-be,Je+ct-be),Ie.primitiveLength++}}})(T,l,C,_,M,u),s.forceNewSegmentOnNextPrepare(),T?.forceNewSegmentOnNextPrepare()}function fc(u,s,l,p,_,b,T){if(b){const C=p.count;return l(s[2*_],s[2*_+1]),u[_]=p.count,p.count++,T.vertexLength++,C}return u[_]}class gu{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=s.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new tt,this.indexArray=new Ir,this.indexArray2=new nr,this.programConfigurations=new cc(s.layers,s.zoom),this.segments=new Sn,this.segments2=new Sn,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(s,l,p){this.hasDependencies=$o("fill",this.layers,l);const _=this.layers[0].layout.get("fill-sort-key"),b=!_.isConstant(),T=[];for(const{feature:C,id:M,index:O,sourceLayerIndex:F}of s){const V=this.layers[0]._featureFilter.needGeometry,H=ti(C,V);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),H,p))continue;const X=b?_.evaluate(H,{},p,l.availableImages):void 0,q={id:M,properties:C.properties,type:C.type,sourceLayerIndex:F,index:O,geometry:V?H.geometry:hu(C),patterns:{},sortKey:X};T.push(q)}b&&T.sort(((C,M)=>C.sortKey-M.sortKey));for(const C of T){const{geometry:M,index:O,sourceLayerIndex:F}=C;if(this.hasDependencies){const V=bf("fill",this.layers,C,{zoom:this.zoom},l);this.patternFeatures.push(V)}else this.addFeature(C,M,O,p,{},l.subdivisionGranularity);l.featureIndex.insert(s[O].feature,M,O,F,this.index)}}update(s,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:p})}addFeatures(s,l,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,l,p,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,jo),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,l,p,_,b,T){for(const C of Vl(l,500)){const M=Tf(C,_,T.fill.getGranularityForZoomLevel(_.z)),O=this.layoutVertexArray;pl(((F,V)=>{O.emplaceBack(F,V)}),this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles,this.segments2,this.indexArray2,M.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,{imagePositions:b,canonical:_})}}let Af,md;It("FillBucket",gu,{omit:["layers","patternFeatures"]});var Pf={get paint(){return md=md||new Lr({"fill-antialias":new jt(Be.paint_fill["fill-antialias"]),"fill-opacity":new Gt(Be.paint_fill["fill-opacity"]),"fill-color":new Gt(Be.paint_fill["fill-color"]),"fill-outline-color":new Gt(Be.paint_fill["fill-outline-color"]),"fill-translate":new jt(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new al(Be.paint_fill["fill-pattern"])})},get layout(){return Af=Af||new Lr({"fill-sort-key":new Gt(Be.layout_fill["fill-sort-key"])})}};class _s extends ci{constructor(s,l){super(s,Pf,l)}recalculate(s,l){super.recalculate(s,l);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new gu(s)}queryRadius(){return du(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:s,geometry:l,transform:p,pixelsToTileUnits:_}){return Gp(pf(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,_),l)}isTileClipped(){return!0}}const pc=Yn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ho=Yn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ds}=pc;class _u{constructor(s,l,p,_,b){this.properties={},this.extent=p,this.type=0,this.id=void 0,this._pbf=s,this._geometry=-1,this._keys=_,this._values=b,s.readFields(am,this,l)}loadGeometry(){const s=this._pbf;s.pos=this._geometry;const l=s.readVarint()+s.pos,p=[];let _,b=1,T=0,C=0,M=0;for(;s.pos<l;){if(T<=0){const O=s.readVarint();b=7&O,T=O>>3}if(T--,b===1||b===2)C+=s.readSVarint(),M+=s.readSVarint(),b===1&&(_&&p.push(_),_=[]),_&&_.push(new v(C,M));else{if(b!==7)throw new Error(`unknown command ${b}`);_&&_.push(_[0].clone())}}return _&&p.push(_),p}bbox(){const s=this._pbf;s.pos=this._geometry;const l=s.readVarint()+s.pos;let p=1,_=0,b=0,T=0,C=1/0,M=-1/0,O=1/0,F=-1/0;for(;s.pos<l;){if(_<=0){const V=s.readVarint();p=7&V,_=V>>3}if(_--,p===1||p===2)b+=s.readSVarint(),T+=s.readSVarint(),b<C&&(C=b),b>M&&(M=b),T<O&&(O=T),T>F&&(F=T);else if(p!==7)throw new Error(`unknown command ${p}`)}return[C,O,M,F]}toGeoJSON(s,l,p){const _=this.extent*Math.pow(2,p),b=this.extent*s,T=this.extent*l,C=this.loadGeometry();function M(H){return[360*(H.x+b)/_-180,360/Math.PI*Math.atan(Math.exp((1-2*(H.y+T)/_)*Math.PI))-90]}function O(H){return H.map(M)}let F;if(this.type===1){const H=[];for(const q of C)H.push(q[0]);const X=O(H);F=H.length===1?{type:"Point",coordinates:X[0]}:{type:"MultiPoint",coordinates:X}}else if(this.type===2){const H=C.map(O);F=H.length===1?{type:"LineString",coordinates:H[0]}:{type:"MultiLineString",coordinates:H}}else{if(this.type!==3)throw new Error("unknown feature type");{const H=(function(q){const ee=q.length;if(ee<=1)return[q];const se=[];let pe,Ve;for(let be=0;be<ee;be++){const Ie=lm(q[be]);Ie!==0&&(Ve===void 0&&(Ve=Ie<0),Ve===Ie<0?(pe&&se.push(pe),pe=[q[be]]):pe&&pe.push(q[be]))}return pe&&se.push(pe),se})(C),X=[];for(const q of H)X.push(q.map(O));F=X.length===1?{type:"Polygon",coordinates:X[0]}:{type:"MultiPolygon",coordinates:X}}}const V={type:"Feature",geometry:F,properties:this.properties};return this.id!=null&&(V.id=this.id),V}}function am(u,s,l){u===1?s.id=l.readVarint():u===2?(function(p,_){const b=p.readVarint()+p.pos;for(;p.pos<b;){const T=_._keys[p.readVarint()],C=_._values[p.readVarint()];_.properties[T]=C}})(l,s):u===3?s.type=l.readVarint():u===4&&(s._geometry=l.pos)}function lm(u){let s=0;for(let l,p,_=0,b=u.length,T=b-1;_<b;T=_++)l=u[_],p=u[T],s+=(p.x-l.x)*(l.y+p.y);return s}_u.types=["Unknown","Point","LineString","Polygon"];class Og{constructor(s,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(mc,this,l),this.length=this._features.length}feature(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];const l=this._pbf.readVarint()+this._pbf.pos;return new _u(this._pbf,l,this.extent,this._keys,this._values)}}function mc(u,s,l){u===15?s.version=l.readVarint():u===1?s.name=l.readString():u===5?s.extent=l.readVarint():u===2?s._features.push(l.pos):u===3?s._keys.push(l.readString()):u===4&&s._values.push((function(p){let _=null;const b=p.readVarint()+p.pos;for(;p.pos<b;){const T=p.readVarint()>>3;_=T===1?p.readString():T===2?p.readFloat():T===3?p.readDouble():T===4?p.readVarint64():T===5?p.readVarint():T===6?p.readSVarint():T===7?p.readBoolean():null}if(_==null)throw new Error("unknown feature value");return _})(l))}class cm{constructor(s,l){this.layers=s.readFields(um,{},l)}}function um(u,s,l){if(u===3){const p=new Og(l,l.readVarint()+l.pos);p.length&&(s[p.name]=p)}}const ml=Math.pow(2,13);function yu(u,s,l,p,_,b,T,C){u.emplaceBack(s,l,2*Math.floor(p*ml)+T,_*ml*2,b*ml*2,Math.round(C))}class gl{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=s.index,this.hasDependencies=!1,this.layoutVertexArray=new wt,this.centroidVertexArray=new qe,this.indexArray=new Ir,this.programConfigurations=new cc(s.layers,s.zoom),this.segments=new Sn,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(s,l,p){this.features=[],this.hasDependencies=$o("fill-extrusion",this.layers,l);for(const{feature:_,id:b,index:T,sourceLayerIndex:C}of s){const M=this.layers[0]._featureFilter.needGeometry,O=ti(_,M);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),O,p))continue;const F={id:b,sourceLayerIndex:C,index:T,geometry:M?O.geometry:hu(_),properties:_.properties,type:_.type,patterns:{}};this.hasDependencies?this.features.push(bf("fill-extrusion",this.layers,F,{zoom:this.zoom},l)):this.addFeature(F,F.geometry,T,p,{},l.subdivisionGranularity),l.featureIndex.insert(_,F.geometry,T,C,this.index,!0)}}addFeatures(s,l,p){for(const _ of this.features){const{geometry:b}=_;this.addFeature(_,b,_.index,l,p,s.subdivisionGranularity)}}update(s,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:p})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Ds),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,Ho.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,l,p,_,b,T){for(const C of Vl(l,500)){const M={x:0,y:0,sampleCount:0},O=this.layoutVertexArray.length;this.processPolygon(M,_,s,C,T);const F=this.layoutVertexArray.length-O,V=Math.floor(M.x/M.sampleCount),H=Math.floor(M.y/M.sampleCount);for(let X=0;X<F;X++)this.centroidVertexArray.emplaceBack(V,H)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,{imagePositions:b,canonical:_})}processPolygon(s,l,p,_,b){if(_.length<1||Ef(_[0]))return;for(const V of _)V.length!==0&&Lg(s,V);const T={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},C=b.fill.getGranularityForZoomLevel(l.z),M=_u.types[p.type]==="Polygon";for(const V of _){if(V.length===0||Ef(V))continue;const H=ks(V,C,M);this._generateSideFaces(H,T)}if(!M)return;const O=Tf(_,l,C,!1),F=this.layoutVertexArray;pl(((V,H)=>{yu(F,V,H,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,O.verticesFlattened,O.indicesTriangles)}_generateSideFaces(s,l){let p=0;for(let _=1;_<s.length;_++){const b=s[_],T=s[_-1];if(Fg(b,T))continue;l.segment.vertexLength+4>Sn.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const C=b.sub(T)._perp()._unit(),M=T.dist(b);p+M>32768&&(p=0),yu(this.layoutVertexArray,b.x,b.y,C.x,C.y,0,0,p),yu(this.layoutVertexArray,b.x,b.y,C.x,C.y,0,1,p),p+=M,yu(this.layoutVertexArray,T.x,T.y,C.x,C.y,0,0,p),yu(this.layoutVertexArray,T.x,T.y,C.x,C.y,0,1,p);const O=l.segment.vertexLength;this.indexArray.emplaceBack(O,O+2,O+1),this.indexArray.emplaceBack(O+1,O+2,O+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function Lg(u,s){for(let l=0;l<s.length;l++){const p=s[l];l===s.length-1&&s[0].x===p.x&&s[0].y===p.y||(u.x+=p.x,u.y+=p.y,u.sampleCount++)}}function Fg(u,s){return u.x===s.x&&(u.x<0||u.x>ze)||u.y===s.y&&(u.y<0||u.y>ze)}function Ef(u){return u.every((s=>s.x<0))||u.every((s=>s.x>ze))||u.every((s=>s.y<0))||u.every((s=>s.y>ze))}let gd;It("FillExtrusionBucket",gl,{omit:["layers","features"]});var Vy={get paint(){return gd=gd||new Lr({"fill-extrusion-opacity":new jt(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new al(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class jy extends ci{constructor(s,l){super(s,Vy,l)}createBucket(s){return new gl(s)}queryRadius(){return du(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:p,geometry:_,transform:b,pixelsToTileUnits:T,pixelPosMatrix:C}){const M=pf(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-b.bearingInRadians,T),O=this.paint.get("fill-extrusion-height").evaluate(l,p),F=this.paint.get("fill-extrusion-base").evaluate(l,p),V=(function(X,q){const ee=[];for(const se of X){const pe=[se.x,se.y,0,1];nn(pe,pe,q),ee.push(new v(pe[0]/pe[3],pe[1]/pe[3]))}return ee})(M,C),H=(function(X,q,ee,se){const pe=[],Ve=[],be=se[8]*q,Ie=se[9]*q,Je=se[10]*q,st=se[11]*q,gt=se[8]*ee,Ft=se[9]*ee,Pt=se[10]*ee,Dt=se[11]*ee;for(const Yt of X){const Rt=[],Ot=[];for(const ct of Yt){const sn=ct.x,fn=ct.y,en=se[0]*sn+se[4]*fn+se[12],Xt=se[1]*sn+se[5]*fn+se[13],Ln=se[2]*sn+se[6]*fn+se[14],Br=se[3]*sn+se[7]*fn+se[15],di=Ln+Je,os=Br+st,Xo=en+gt,to=Xt+Ft,$i=Ln+Pt,Mr=Br+Dt,Si=new v((en+be)/os,(Xt+Ie)/os);Si.z=di/os,Rt.push(Si);const Wi=new v(Xo/Mr,to/Mr);Wi.z=$i/Mr,Ot.push(Wi)}pe.push(Rt),Ve.push(Ot)}return[pe,Ve]})(_,F,O,C);return(function(X,q,ee){let se=1/0;Gp(ee,q)&&(se=hm(ee,q[0]));for(let pe=0;pe<q.length;pe++){const Ve=q[pe],be=X[pe];for(let Ie=0;Ie<Ve.length-1;Ie++){const Je=Ve[Ie],st=[Je,Ve[Ie+1],be[Ie+1],be[Ie],Je];qp(ee,st)&&(se=Math.min(se,hm(ee,st)))}}return se!==1/0&&se})(H[0],H[1],V)}}function lh(u,s){return u.x*s.x+u.y*s.y}function hm(u,s){if(u.length===1){let l=0;const p=s[l++];let _;for(;!_||p.equals(_);)if(_=s[l++],!_)return 1/0;for(;l<s.length;l++){const b=s[l],T=u[0],C=_.sub(p),M=b.sub(p),O=T.sub(p),F=lh(C,C),V=lh(C,M),H=lh(M,M),X=lh(O,C),q=lh(O,M),ee=F*H-V*V,se=(H*X-V*q)/ee,pe=(F*q-V*X)/ee,Ve=p.z*(1-se-pe)+_.z*se+b.z*pe;if(isFinite(Ve))return Ve}return 1/0}{let l=1/0;for(const p of s)l=Math.min(l,p.z);return l}}const vu=Yn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:$y}=vu,ch=Yn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ng}=ch,jr=Math.cos(Math.PI/180*37.5),Bg=Math.pow(2,14)/.5;class Cf{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map((l=>l.id)),this.index=s.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((l=>{this.gradients[l.id]={}})),this.layoutVertexArray=new xt,this.layoutVertexArray2=new ft,this.indexArray=new Ir,this.programConfigurations=new cc(s.layers,s.zoom),this.segments=new Sn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((l=>l.isStateDependent())).map((l=>l.id))}populate(s,l,p){this.hasDependencies=$o("line",this.layers,l)||this.hasLineDasharray(this.layers);const _=this.layers[0].layout.get("line-sort-key"),b=!_.isConstant(),T=[];for(const{feature:C,id:M,index:O,sourceLayerIndex:F}of s){const V=this.layers[0]._featureFilter.needGeometry,H=ti(C,V);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),H,p))continue;const X=b?_.evaluate(H,{},p):void 0,q={id:M,properties:C.properties,type:C.type,sourceLayerIndex:F,index:O,geometry:V?H.geometry:hu(C),patterns:{},dashes:{},sortKey:X};T.push(q)}b&&T.sort(((C,M)=>C.sortKey-M.sortKey));for(const C of T){const{geometry:M,index:O,sourceLayerIndex:F}=C;this.hasDependencies?($o("line",this.layers,l)?bf("line",this.layers,C,{zoom:this.zoom},l):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,C,this.zoom,l),this.patternFeatures.push(C)):this.addFeature(C,M,O,p,{},{},l.subdivisionGranularity),l.featureIndex.insert(s[O].feature,M,O,F,this.index)}}update(s,l,p,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:p,dashPositions:_})}addFeatures(s,l,p,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,p,_,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,Ng)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,$y),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,l,p,_,b,T,C){const M=this.layers[0].layout,O=M.get("line-join").evaluate(s,{}),F=M.get("line-cap"),V=M.get("line-miter-limit"),H=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const X of l)this.addLine(X,s,O,F,V,H,_,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,p,{imagePositions:b,dashPositions:T,canonical:_})}addLine(s,l,p,_,b,T,C,M){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,s=ks(s,C?M.line.getGranularityForZoomLevel(C.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<s.length-1;be++)this.totalDistance+=s[be].dist(s[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const O=_u.types[l.type]==="Polygon";let F=s.length;for(;F>=2&&s[F-1].equals(s[F-2]);)F--;let V=0;for(;V<F-1&&s[V].equals(s[V+1]);)V++;if(F<(O?3:2))return;p==="bevel"&&(b=1.05);const H=this.overscaling<=16?122880/(512*this.overscaling):0,X=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let q,ee,se,pe,Ve;this.e1=this.e2=-1,O&&(q=s[F-2],Ve=s[V].sub(q)._unit()._perp());for(let be=V;be<F;be++){if(se=be===F-1?O?s[V+1]:void 0:s[be+1],se&&s[be].equals(se))continue;Ve&&(pe=Ve),q&&(ee=q),q=s[be],Ve=se?se.sub(q)._unit()._perp():pe,pe=pe||Ve;let Ie=pe.add(Ve);Ie.x===0&&Ie.y===0||Ie._unit();const Je=pe.x*Ve.x+pe.y*Ve.y,st=Ie.x*Ve.x+Ie.y*Ve.y,gt=st!==0?1/st:1/0,Ft=2*Math.sqrt(2-2*st),Pt=st<jr&&ee&&se,Dt=pe.x*Ve.y-pe.y*Ve.x>0;if(Pt&&be>V){const Ot=q.dist(ee);if(Ot>2*H){const ct=q.sub(q.sub(ee)._mult(H/Ot)._round());this.updateDistance(ee,ct),this.addCurrentVertex(ct,pe,0,0,X),ee=ct}}const Yt=ee&&se;let Rt=Yt?p:O?"butt":_;if(Yt&&Rt==="round"&&(gt<T?Rt="miter":gt<=2&&(Rt="fakeround")),Rt==="miter"&&gt>b&&(Rt="bevel"),Rt==="bevel"&&(gt>2&&(Rt="flipbevel"),gt<b&&(Rt="miter")),ee&&this.updateDistance(ee,q),Rt==="miter")Ie._mult(gt),this.addCurrentVertex(q,Ie,0,0,X);else if(Rt==="flipbevel"){if(gt>100)Ie=Ve.mult(-1);else{const Ot=gt*pe.add(Ve).mag()/pe.sub(Ve).mag();Ie._perp()._mult(Ot*(Dt?-1:1))}this.addCurrentVertex(q,Ie,0,0,X),this.addCurrentVertex(q,Ie.mult(-1),0,0,X)}else if(Rt==="bevel"||Rt==="fakeround"){const Ot=-Math.sqrt(gt*gt-1),ct=Dt?Ot:0,sn=Dt?0:Ot;if(ee&&this.addCurrentVertex(q,pe,ct,sn,X),Rt==="fakeround"){const fn=Math.round(180*Ft/Math.PI/20);for(let en=1;en<fn;en++){let Xt=en/fn;if(Xt!==.5){const Br=Xt-.5;Xt+=Xt*Br*(Xt-1)*((1.0904+Je*(Je*(3.55645-1.43519*Je)-3.2452))*Br*Br+(.848013+Je*(.215638*Je-1.06021)))}const Ln=Ve.sub(pe)._mult(Xt)._add(pe)._unit()._mult(Dt?-1:1);this.addHalfVertex(q,Ln.x,Ln.y,!1,Dt,0,X)}}se&&this.addCurrentVertex(q,Ve,-ct,-sn,X)}else if(Rt==="butt")this.addCurrentVertex(q,Ie,0,0,X);else if(Rt==="square"){const Ot=ee?1:-1;this.addCurrentVertex(q,Ie,Ot,Ot,X)}else Rt==="round"&&(ee&&(this.addCurrentVertex(q,pe,0,0,X),this.addCurrentVertex(q,pe,1,1,X,!0)),se&&(this.addCurrentVertex(q,Ve,-1,-1,X,!0),this.addCurrentVertex(q,Ve,0,0,X)));if(Pt&&be<F-1){const Ot=q.dist(se);if(Ot>2*H){const ct=q.add(se.sub(q)._mult(H/Ot)._round());this.updateDistance(q,ct),this.addCurrentVertex(ct,Ve,0,0,X),q=ct}}}}addCurrentVertex(s,l,p,_,b,T=!1){const C=l.y*_-l.x,M=-l.y-l.x*_;this.addHalfVertex(s,l.x+l.y*p,l.y-l.x*p,T,!1,p,b),this.addHalfVertex(s,C,M,T,!0,-_,b),this.distance>Bg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,l,p,_,b,T))}addHalfVertex({x:s,y:l},p,_,b,T,C,M){const O=.5*(this.lineClips?this.scaledDistance*(Bg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(b?1:0),(l<<1)+(T?1:0),Math.round(63*p)+128,Math.round(63*_)+128,1+(C===0?0:C<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const F=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,F,this.e2),M.primitiveLength++),T?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,l){this.distance+=s.dist(l),this.updateScaledDistance()}hasLineDasharray(s){for(const l of s){const p=l.paint.get("line-dasharray");if(p&&!p.isConstant())return!0}return!1}addLineDashDependencies(s,l,p,_){for(const b of s){const T=b.paint.get("line-dasharray");if(!T||T.value.kind==="constant")continue;const C=b.layout.get("line-cap")==="round",M={dasharray:T.value.evaluate({zoom:p-1},l,{}),round:C},O={dasharray:T.value.evaluate({zoom:p},l,{}),round:C},F={dasharray:T.value.evaluate({zoom:p+1},l,{}),round:C},V=`${M.dasharray.join(",")},${M.round}`,H=`${O.dasharray.join(",")},${O.round}`,X=`${F.dasharray.join(",")},${F.round}`;_.dashDependencies[V]=M,_.dashDependencies[H]=O,_.dashDependencies[X]=F,l.dashes[b.id]={min:V,mid:H,max:X}}}}let zg,Ug;It("LineBucket",Cf,{omit:["layers","patternFeatures"]});var dm={get paint(){return Ug=Ug||new Lr({"line-opacity":new Gt(Be.paint_line["line-opacity"]),"line-color":new Gt(Be.paint_line["line-color"]),"line-translate":new jt(Be.paint_line["line-translate"]),"line-translate-anchor":new jt(Be.paint_line["line-translate-anchor"]),"line-width":new Gt(Be.paint_line["line-width"]),"line-gap-width":new Gt(Be.paint_line["line-gap-width"]),"line-offset":new Gt(Be.paint_line["line-offset"]),"line-blur":new Gt(Be.paint_line["line-blur"]),"line-dasharray":new al(Be.paint_line["line-dasharray"]),"line-pattern":new al(Be.paint_line["line-pattern"]),"line-gradient":new tc(Be.paint_line["line-gradient"])})},get layout(){return zg=zg||new Lr({"line-cap":new jt(Be.layout_line["line-cap"]),"line-join":new Gt(Be.layout_line["line-join"]),"line-miter-limit":new jt(Be.layout_line["line-miter-limit"]),"line-round-limit":new jt(Be.layout_line["line-round-limit"]),"line-sort-key":new Gt(Be.layout_line["line-sort-key"])})}};class Vg extends Gt{possiblyEvaluate(s,l){return l=new Hn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(s,l)}evaluate(s,l,p,_){return l=ut({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(s,l,p,_)}}let If;class xo extends ci{constructor(s,l){super(s,dm,l),this.gradientVersion=0,If||(If=new Vg(dm.paint.properties["line-width"].specification),If.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!(function(p){return p._styleExpression!==void 0})(l)&&l._styleExpression.expression instanceof ar,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,l){super.recalculate(s,l),this.paint._values["line-floorwidth"]=If.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Cf(s)}queryRadius(s){const l=s,p=Mf(hc("line-width",this,l),hc("line-gap-width",this,l)),_=hc("line-offset",this,l);return p/2+Math.abs(_)+du(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:p,geometry:_,transform:b,pixelsToTileUnits:T}){const C=pf(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-b.bearingInRadians,T),M=T/2*Mf(this.paint.get("line-width").evaluate(l,p),this.paint.get("line-gap-width").evaluate(l,p)),O=this.paint.get("line-offset").evaluate(l,p);return O&&(_=(function(F,V){const H=[];for(let X=0;X<F.length;X++){const q=F[X],ee=[];for(let se=0;se<q.length;se++){const pe=q[se-1],Ve=q[se],be=q[se+1],Ie=se===0?new v(0,0):Ve.sub(pe)._unit()._perp(),Je=se===q.length-1?new v(0,0):be.sub(Ve)._unit()._perp(),st=Ie._add(Je)._unit(),gt=st.x*Je.x+st.y*Je.y;gt!==0&&st._mult(1/gt),ee.push(st._mult(V)._add(Ve))}H.push(ee)}return H})(_,O*T)),(function(F,V,H){for(let X=0;X<V.length;X++){const q=V[X];if(F.length>=3){for(let ee=0;ee<q.length;ee++)if(uc(F,q[ee]))return!0}if(Yp(F,q,H))return!0}return!1})(C,_,M)}isTileClipped(){return!0}}function Mf(u,s){return s>0?s+2*u:u}const Wy=Yn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gc=Yn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Yn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Rf=Yn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Yn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _c=Yn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kf=Yn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function fm(u,s,l){return u.sections.forEach((p=>{p.text=(function(_,b,T){const C=b.layout.get("text-transform").evaluate(T,{});return C==="uppercase"?_=_.toLocaleUpperCase():C==="lowercase"&&(_=_.toLocaleLowerCase()),fs.applyArabicShaping&&(_=fs.applyArabicShaping(_)),_})(p.text,s,l)})),u}Yn([{name:"triangle",components:3,type:"Uint16"}]),Yn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Yn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Yn([{type:"Float32",name:"offsetX"}]),Yn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Yn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const xu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ni=24;const _d=4294967296,jg=1/_d,pm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Df{constructor(s=new Uint8Array(16)){this.buf=ArrayBuffer.isView(s)?s:new Uint8Array(s),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(s,l,p=this.length){for(;this.pos<p;){const _=this.readVarint(),b=_>>3,T=this.pos;this.type=7&_,s(b,l,this),this.pos===T&&this.skip(_)}return l}readMessage(s,l){return this.readFields(s,l,this.readVarint()+this.pos)}readFixed32(){const s=this.dataView.getUint32(this.pos,!0);return this.pos+=4,s}readSFixed32(){const s=this.dataView.getInt32(this.pos,!0);return this.pos+=4,s}readFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*_d;return this.pos+=8,s}readSFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*_d;return this.pos+=8,s}readFloat(){const s=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,s}readDouble(){const s=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,s}readVarint(s){const l=this.buf;let p,_;return _=l[this.pos++],p=127&_,_<128?p:(_=l[this.pos++],p|=(127&_)<<7,_<128?p:(_=l[this.pos++],p|=(127&_)<<14,_<128?p:(_=l[this.pos++],p|=(127&_)<<21,_<128?p:(_=l[this.pos],p|=(15&_)<<28,(function(b,T,C){const M=C.buf;let O,F;if(F=M[C.pos++],O=(112&F)>>4,F<128||(F=M[C.pos++],O|=(127&F)<<3,F<128)||(F=M[C.pos++],O|=(127&F)<<10,F<128)||(F=M[C.pos++],O|=(127&F)<<17,F<128)||(F=M[C.pos++],O|=(127&F)<<24,F<128)||(F=M[C.pos++],O|=(1&F)<<31,F<128))return _l(b,O,T);throw new Error("Expected varint not more than 10 bytes")})(p,s,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const s=this.readVarint();return s%2==1?(s+1)/-2:s/2}readBoolean(){return!!this.readVarint()}readString(){const s=this.readVarint()+this.pos,l=this.pos;return this.pos=s,s-l>=12&&pm?pm.decode(this.buf.subarray(l,s)):(function(p,_,b){let T="",C=_;for(;C<b;){const M=p[C];let O,F,V,H=null,X=M>239?4:M>223?3:M>191?2:1;if(C+X>b)break;X===1?M<128&&(H=M):X===2?(O=p[C+1],(192&O)==128&&(H=(31&M)<<6|63&O,H<=127&&(H=null))):X===3?(O=p[C+1],F=p[C+2],(192&O)==128&&(192&F)==128&&(H=(15&M)<<12|(63&O)<<6|63&F,(H<=2047||H>=55296&&H<=57343)&&(H=null))):X===4&&(O=p[C+1],F=p[C+2],V=p[C+3],(192&O)==128&&(192&F)==128&&(192&V)==128&&(H=(15&M)<<18|(63&O)<<12|(63&F)<<6|63&V,(H<=65535||H>=1114112)&&(H=null))),H===null?(H=65533,X=1):H>65535&&(H-=65536,T+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),T+=String.fromCharCode(H),C+=X}return T})(this.buf,l,s)}readBytes(){const s=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,s);return this.pos=s,l}readPackedVarint(s=[],l){const p=this.readPackedEnd();for(;this.pos<p;)s.push(this.readVarint(l));return s}readPackedSVarint(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSVarint());return s}readPackedBoolean(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readBoolean());return s}readPackedFloat(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFloat());return s}readPackedDouble(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readDouble());return s}readPackedFixed32(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFixed32());return s}readPackedSFixed32(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSFixed32());return s}readPackedFixed64(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFixed64());return s}readPackedSFixed64(s=[]){const l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSFixed64());return s}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(s){const l=7&s;if(l===0)for(;this.buf[this.pos++]>127;);else if(l===2)this.pos=this.readVarint()+this.pos;else if(l===5)this.pos+=4;else{if(l!==1)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(s,l){this.writeVarint(s<<3|l)}realloc(s){let l=this.length||16;for(;l<this.pos+s;)l*=2;if(l!==this.length){const p=new Uint8Array(l);p.set(this.buf),this.buf=p,this.dataView=new DataView(p.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeSFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*jg),!0),this.pos+=8}writeSFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*jg),!0),this.pos+=8}writeVarint(s){(s=+s||0)>268435455||s<0?(function(l,p){let _,b;if(l>=0?(_=l%4294967296|0,b=l/4294967296|0):(_=~(-l%4294967296),b=~(-l/4294967296),4294967295^_?_=_+1|0:(_=0,b=b+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),(function(T,C,M){M.buf[M.pos++]=127&T|128,T>>>=7,M.buf[M.pos++]=127&T|128,T>>>=7,M.buf[M.pos++]=127&T|128,T>>>=7,M.buf[M.pos++]=127&T|128,M.buf[M.pos]=127&(T>>>=7)})(_,0,p),(function(T,C){const M=(7&T)<<4;C.buf[C.pos++]|=M|((T>>>=3)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T)))))})(b,p)})(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))}writeSVarint(s){this.writeVarint(s<0?2*-s-1:2*s)}writeBoolean(s){this.writeVarint(+s)}writeString(s){s=String(s),this.realloc(4*s.length),this.pos++;const l=this.pos;this.pos=(function(_,b,T){for(let C,M,O=0;O<b.length;O++){if(C=b.charCodeAt(O),C>55295&&C<57344){if(!M){C>56319||O+1===b.length?(_[T++]=239,_[T++]=191,_[T++]=189):M=C;continue}if(C<56320){_[T++]=239,_[T++]=191,_[T++]=189,M=C;continue}C=M-55296<<10|C-56320|65536,M=null}else M&&(_[T++]=239,_[T++]=191,_[T++]=189,M=null);C<128?_[T++]=C:(C<2048?_[T++]=C>>6|192:(C<65536?_[T++]=C>>12|224:(_[T++]=C>>18|240,_[T++]=C>>12&63|128),_[T++]=C>>6&63|128),_[T++]=63&C|128)}return T})(this.buf,s,this.pos);const p=this.pos-l;p>=128&&yd(l,p,this),this.pos=l-1,this.writeVarint(p),this.pos+=p}writeFloat(s){this.realloc(4),this.dataView.setFloat32(this.pos,s,!0),this.pos+=4}writeDouble(s){this.realloc(8),this.dataView.setFloat64(this.pos,s,!0),this.pos+=8}writeBytes(s){const l=s.length;this.writeVarint(l),this.realloc(l);for(let p=0;p<l;p++)this.buf[this.pos++]=s[p]}writeRawMessage(s,l){this.pos++;const p=this.pos;s(l,this);const _=this.pos-p;_>=128&&yd(p,_,this),this.pos=p-1,this.writeVarint(_),this.pos+=_}writeMessage(s,l,p){this.writeTag(s,2),this.writeRawMessage(l,p)}writePackedVarint(s,l){l.length&&this.writeMessage(s,$g,l)}writePackedSVarint(s,l){l.length&&this.writeMessage(s,mm,l)}writePackedBoolean(s,l){l.length&&this.writeMessage(s,gm,l)}writePackedFloat(s,l){l.length&&this.writeMessage(s,Hy,l)}writePackedDouble(s,l){l.length&&this.writeMessage(s,Wg,l)}writePackedFixed32(s,l){l.length&&this.writeMessage(s,Of,l)}writePackedSFixed32(s,l){l.length&&this.writeMessage(s,_m,l)}writePackedFixed64(s,l){l.length&&this.writeMessage(s,Lf,l)}writePackedSFixed64(s,l){l.length&&this.writeMessage(s,Hg,l)}writeBytesField(s,l){this.writeTag(s,2),this.writeBytes(l)}writeFixed32Field(s,l){this.writeTag(s,5),this.writeFixed32(l)}writeSFixed32Field(s,l){this.writeTag(s,5),this.writeSFixed32(l)}writeFixed64Field(s,l){this.writeTag(s,1),this.writeFixed64(l)}writeSFixed64Field(s,l){this.writeTag(s,1),this.writeSFixed64(l)}writeVarintField(s,l){this.writeTag(s,0),this.writeVarint(l)}writeSVarintField(s,l){this.writeTag(s,0),this.writeSVarint(l)}writeStringField(s,l){this.writeTag(s,2),this.writeString(l)}writeFloatField(s,l){this.writeTag(s,5),this.writeFloat(l)}writeDoubleField(s,l){this.writeTag(s,1),this.writeDouble(l)}writeBooleanField(s,l){this.writeVarintField(s,+l)}}function _l(u,s,l){return l?4294967296*s+(u>>>0):4294967296*(s>>>0)+(u>>>0)}function yd(u,s,l){const p=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(p);for(let _=l.pos-1;_>=u;_--)l.buf[_+p]=l.buf[_]}function $g(u,s){for(let l=0;l<u.length;l++)s.writeVarint(u[l])}function mm(u,s){for(let l=0;l<u.length;l++)s.writeSVarint(u[l])}function Hy(u,s){for(let l=0;l<u.length;l++)s.writeFloat(u[l])}function Wg(u,s){for(let l=0;l<u.length;l++)s.writeDouble(u[l])}function gm(u,s){for(let l=0;l<u.length;l++)s.writeBoolean(u[l])}function Of(u,s){for(let l=0;l<u.length;l++)s.writeFixed32(u[l])}function _m(u,s){for(let l=0;l<u.length;l++)s.writeSFixed32(u[l])}function Lf(u,s){for(let l=0;l<u.length;l++)s.writeFixed64(u[l])}function Hg(u,s){for(let l=0;l<u.length;l++)s.writeSFixed64(u[l])}function Zy(u,s,l){u===1&&l.readMessage(Ff,s)}function Ff(u,s,l){if(u===3){const{id:p,bitmap:_,width:b,height:T,left:C,top:M,advance:O}=l.readMessage(Xy,{});s.push({id:p,bitmap:new hd({width:b+6,height:T+6},_),metrics:{width:b,height:T,left:C,top:M,advance:O}})}}function Xy(u,s,l){u===1?s.id=l.readVarint():u===2?s.bitmap=l.readBytes():u===3?s.width=l.readVarint():u===4?s.height=l.readVarint():u===5?s.left=l.readSVarint():u===6?s.top=l.readSVarint():u===7&&(s.advance=l.readVarint())}function uh(u){let s=0,l=0;for(const T of u)s+=T.w*T.h,l=Math.max(l,T.w);u.sort(((T,C)=>C.h-T.h));const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}];let _=0,b=0;for(const T of u)for(let C=p.length-1;C>=0;C--){const M=p[C];if(!(T.w>M.w||T.h>M.h)){if(T.x=M.x,T.y=M.y,b=Math.max(b,T.y+T.h),_=Math.max(_,T.x+T.w),T.w===M.w&&T.h===M.h){const O=p.pop();O&&C<p.length&&(p[C]=O)}else T.h===M.h?(M.x+=T.w,M.w-=T.w):T.w===M.w?(M.y+=T.h,M.h-=T.h):(p.push({x:M.x+T.w,y:M.y,w:M.w-T.w,h:T.h}),M.y+=T.h,M.h-=T.h);break}}return{w:_,h:b,fill:s/(_*b)||0}}class ym{constructor(s,{pixelRatio:l,version:p,stretchX:_,stretchY:b,content:T,textFitWidth:C,textFitHeight:M}){this.paddedRect=s,this.pixelRatio=l,this.stretchX=_,this.stretchY=b,this.content=T,this.version=p,this.textFitWidth=C,this.textFitHeight=M}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class vd{constructor(s,l){const p={},_={};this.haveRenderCallbacks=[];const b=[];this.addImages(s,p,b),this.addImages(l,_,b);const{w:T,h:C}=uh(b),M=new zt({width:T||1,height:C||1});for(const O in s){const F=s[O],V=p[O].paddedRect;zt.copy(F.data,M,{x:0,y:0},{x:V.x+1,y:V.y+1},F.data)}for(const O in l){const F=l[O],V=_[O].paddedRect,H=V.x+1,X=V.y+1,q=F.data.width,ee=F.data.height;zt.copy(F.data,M,{x:0,y:0},{x:H,y:X},F.data),zt.copy(F.data,M,{x:0,y:ee-1},{x:H,y:X-1},{width:q,height:1}),zt.copy(F.data,M,{x:0,y:0},{x:H,y:X+ee},{width:q,height:1}),zt.copy(F.data,M,{x:q-1,y:0},{x:H-1,y:X},{width:1,height:ee}),zt.copy(F.data,M,{x:0,y:0},{x:H+q,y:X},{width:1,height:ee})}this.image=M,this.iconPositions=p,this.patternPositions=_}addImages(s,l,p){for(const _ in s){const b=s[_],T={x:0,y:0,w:b.data.width+2,h:b.data.height+2};p.push(T),l[_]=new ym(T,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(s,l){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in s.updatedImages)this.patchUpdatedImage(this.iconPositions[p],s.getImage(p),l),this.patchUpdatedImage(this.patternPositions[p],s.getImage(p),l)}patchUpdatedImage(s,l,p){if(!s||!l||s.version===l.version)return;s.version=l.version;const[_,b]=s.tl;p.update(l.data,void 0,{x:_,y:b})}}var f;It("ImagePosition",ym),It("ImageAtlas",vd),d.ao=void 0,(f=d.ao||(d.ao={}))[f.none=0]="none",f[f.horizontal=1]="horizontal",f[f.vertical=2]="vertical",f[f.horizontalOnly=3]="horizontalOnly";class g{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(s,l,p){const _=new g;return _.scale=s||1,_.fontStack=l,_.verticalAlign=p||"bottom",_}static forImage(s,l){const p=new g;return p.imageName=s,p.verticalAlign=l||"bottom",p}}class S{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,l){const p=new S;for(let _=0;_<s.sections.length;_++){const b=s.sections[_];b.image?p.addImageSection(b):p.addTextSection(b,l)}return p}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=(function(s){let l="";for(let p=0;p<s.length;p++){const _=s.charCodeAt(p+1)||null,b=s.charCodeAt(p-1)||null;l+=_&&ou(_)&&!xu[s[p+1]]||b&&ou(b)&&!xu[s[p-1]]||!xu[s[p]]?s[p]:xu[s[p]]}return l})(this.text)}trim(){let s=0;for(let p=0;p<this.text.length&&N[this.text.charCodeAt(p)];p++)s++;let l=this.text.length;for(let p=this.text.length-1;p>=0&&p>=s&&N[this.text.charCodeAt(p)];p--)l--;this.text=this.text.substring(s,l),this.sectionIndex=this.sectionIndex.slice(s,l)}substring(s,l){const p=new S;return p.text=this.text.substring(s,l),p.sectionIndex=this.sectionIndex.slice(s,l),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((s,l)=>Math.max(s,this.sections[l].scale)),0)}getMaxImageSize(s){let l=0,p=0;for(let _=0;_<this.length();_++){const b=this.getSection(_);if(b.imageName){const T=s[b.imageName];if(!T)continue;const C=T.displaySize;l=Math.max(l,C[0]),p=Math.max(p,C[1])}}return{maxImageWidth:l,maxImageHeight:p}}addTextSection(s,l){this.text+=s.text,this.sections.push(g.forText(s.scale,s.fontStack||l,s.verticalAlign));const p=this.sections.length-1;for(let _=0;_<s.text.length;++_)this.sectionIndex.push(p)}addImageSection(s){const l=s.image?s.image.name:"";if(l.length===0)return void Jn("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(g.forImage(l,s.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Jn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function I(u,s,l,p,_,b,T,C,M,O,F,V,H,X,q){const ee=S.fromFeature(u,_);let se;V===d.ao.vertical&&ee.verticalizePunctuation();const{processBidirectionalText:pe,processStyledBidirectionalText:Ve}=fs;if(pe&&ee.sections.length===1){se=[];const Je=pe(ee.toString(),bt(ee,O,b,s,p,X));for(const st of Je){const gt=new S;gt.text=st,gt.sections=ee.sections;for(let Ft=0;Ft<st.length;Ft++)gt.sectionIndex.push(0);se.push(gt)}}else if(Ve){se=[];const Je=Ve(ee.text,ee.sectionIndex,bt(ee,O,b,s,p,X));for(const st of Je){const gt=new S;gt.text=st[0],gt.sectionIndex=st[1],gt.sections=ee.sections,se.push(gt)}}else se=(function(Je,st){const gt=[],Ft=Je.text;let Pt=0;for(const Dt of st)gt.push(Je.substring(Pt,Dt)),Pt=Dt;return Pt<Ft.length&&gt.push(Je.substring(Pt,Ft.length)),gt})(ee,bt(ee,O,b,s,p,X));const be=[],Ie={positionedLines:be,text:ee.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:V,iconsInText:!1,verticalizable:!1};return(function(Je,st,gt,Ft,Pt,Dt,Yt,Rt,Ot,ct,sn,fn){let en=0,Xt=0,Ln=0,Br=0;const di=Rt==="right"?1:Rt==="left"?0:.5,os=ni/fn;let Xo=0;for(const Mr of Pt){Mr.trim();const Si=Mr.getMaxScale(),Wi={positionedGlyphs:[],lineOffset:0};Je.positionedLines[Xo]=Wi;const Hi=Wi.positionedGlyphs;let Os=0;if(!Mr.length()){Xt+=Dt,++Xo;continue}const qo=Kt(Ft,Mr,os);for(let no=0;no<Mr.length();no++){const fi=Mr.getSection(no),Pi=Mr.getSectionIndex(no),Ei=Mr.getCharCode(no),ri=qr(Ot,sn,Ei);let vr;if(fi.imageName){if(Je.iconsInText=!0,fi.scale=fi.scale*os,vr=je(fi,ri,Si,qo,Ft),!vr)continue;Os=Math.max(Os,vr.imageOffset)}else if(vr=Qe(fi,Ei,ri,qo,st,gt),!vr)continue;const{rect:yl,metrics:Vf,baselineOffset:vl}=vr;Hi.push({glyph:Ei,imageName:fi.imageName,x:en,y:Xt+vl+-17,vertical:ri,scale:fi.scale,fontStack:fi.fontStack,sectionIndex:Pi,metrics:Vf,rect:yl}),ri?(Je.verticalizable=!0,en+=(fi.imageName?Vf.advance:ni)*fi.scale+ct):en+=Vf.advance*fi.scale+ct}Hi.length!==0&&(Ln=Math.max(en-ct,Ln),rt(Hi,0,Hi.length-1,di)),en=0,Wi.lineOffset=Math.max(Os,(Si-1)*ni);const Ai=Dt*Si+Os;Xt+=Ai,Br=Math.max(Ai,Br),++Xo}const{horizontalAlign:to,verticalAlign:$i}=Ht(Yt);(function(Mr,Si,Wi,Hi,Os,qo,Ai,no,fi){const Pi=(Si-Wi)*Os;let Ei=0;Ei=qo!==Ai?-no*Hi- -17:-Hi*fi*Ai+.5*Ai;for(const ri of Mr)for(const vr of ri.positionedGlyphs)vr.x+=Pi,vr.y+=Ei})(Je.positionedLines,di,to,$i,Ln,Br,Dt,Xt,Pt.length),Je.top+=-$i*Xt,Je.bottom=Je.top+Xt,Je.left+=-to*Ln,Je.right=Je.left+Ln})(Ie,s,l,p,se,T,C,M,V,O,H,q),!(function(Je){for(const st of Je)if(st.positionedGlyphs.length!==0)return!1;return!0})(be)&&Ie}const N={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},j={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Q={40:!0};function Te(u,s,l,p,_,b){if(s.imageName){const T=p[s.imageName];return T?T.displaySize[0]*s.scale*ni/b+_:0}{const T=l[s.fontStack],C=T&&T[u];return C?C.metrics.advance*s.scale+_:0}}function ke(u,s,l,p){const _=Math.pow(u-s,2);return p?u<s?_/2:2*_:_+Math.abs(l)*l}function ot(u,s,l){let p=0;return u===10&&(p-=1e4),l&&(p+=150),u!==40&&u!==65288||(p+=50),s!==41&&s!==65289||(p+=50),p}function At(u,s,l,p,_,b){let T=null,C=ke(s,l,_,b);for(const M of p){const O=ke(s-M.x,l,_,b)+M.badness;O<=C&&(T=M,C=O)}return{index:u,x:s,priorBreak:T,badness:C}}function Ct(u){return u?Ct(u.priorBreak).concat(u.index):[]}function bt(u,s,l,p,_,b){if(!u)return[];const T=[],C=(function(V,H,X,q,ee,se){let pe=0;for(let Ve=0;Ve<V.length();Ve++){const be=V.getSection(Ve);pe+=Te(V.getCharCode(Ve),be,q,ee,H,se)}return pe/Math.max(1,Math.ceil(pe/X))})(u,s,l,p,_,b),M=u.text.indexOf("")>=0;let O=0;for(let V=0;V<u.length();V++){const H=u.getSection(V),X=u.getCharCode(V);if(N[X]||(O+=Te(X,H,p,_,s,b)),V<u.length()-1){const q=!((F=X)<11904)&&(!!In["CJK Compatibility Forms"](F)||!!In["CJK Compatibility"](F)||!!In["CJK Strokes"](F)||!!In["CJK Symbols and Punctuation"](F)||!!In["Enclosed CJK Letters and Months"](F)||!!In["Halfwidth and Fullwidth Forms"](F)||!!In["Ideographic Description Characters"](F)||!!In["Vertical Forms"](F)||ad.test(String.fromCodePoint(F)));(j[X]||q||H.imageName||V!==u.length()-2&&Q[u.getCharCode(V+1)])&&T.push(At(V+1,O,C,T,ot(X,u.getCharCode(V+1),q&&M),!1))}}var F;return Ct(At(u.length(),O,C,T,0,!0))}function Ht(u){let s=.5,l=.5;switch(u){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function Kt(u,s,l){const p=s.getMaxScale()*ni,{maxImageWidth:_,maxImageHeight:b}=s.getMaxImageSize(u),T=Math.max(p,b*l);return{verticalLineContentWidth:Math.max(p,_*l),horizontalLineContentHeight:T}}function Jt(u){switch(u){case"top":return 0;case"center":return .5;default:return 1}}function qr(u,s,l){return!(u===d.ao.horizontal||!s&&!Gu(l)||s&&(N[l]||(p=l,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function Qe(u,s,l,p,_,b){const T=b[u.fontStack],C=(function(O,F,V,H){if(O&&O.rect)return O;const X=F[V.fontStack],q=X&&X[H];return q?{rect:null,metrics:q.metrics}:null})(T&&T[s],_,u,s);if(C===null)return null;let M;if(l)M=p.verticalLineContentWidth-u.scale*ni;else{const O=Jt(u.verticalAlign);M=(p.horizontalLineContentHeight-u.scale*ni)*O}return{rect:C.rect,metrics:C.metrics,baselineOffset:M}}function je(u,s,l,p,_){const b=_[u.imageName];if(!b)return null;const T=b.paddedRect,C=b.displaySize,M={width:C[0],height:C[1],left:1,top:-3,advance:s?C[1]:C[0]};let O;if(s)O=p.verticalLineContentWidth-C[1]*u.scale;else{const F=Jt(u.verticalAlign);O=(p.horizontalLineContentHeight-C[1]*u.scale)*F}return{rect:T,metrics:M,baselineOffset:O,imageOffset:(s?C[0]:C[1])*u.scale-ni*l}}function rt(u,s,l,p){if(p===0)return;const _=u[l],b=(u[l].x+_.metrics.advance*_.scale)*p;for(let T=s;T<=l;T++)u[T].x-=b}function Nt(u,s,l){const{horizontalAlign:p,verticalAlign:_}=Ht(l),b=s[0]-u.displaySize[0]*p,T=s[1]-u.displaySize[1]*_;return{image:u,top:T,bottom:T+u.displaySize[1],left:b,right:b+u.displaySize[0]}}function Qt(u){var s,l;let p=u.left,_=u.top,b=u.right-p,T=u.bottom-_;const C=(s=u.image.textFitWidth)!==null&&s!==void 0?s:"stretchOrShrink",M=(l=u.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",O=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(M==="proportional"){if(C==="stretchOnly"&&b/T<O||C==="proportional"){const F=Math.ceil(T*O);p*=F/b,b=F}}else if(C==="proportional"&&M==="stretchOnly"&&O!==0&&b/T>O){const F=Math.ceil(b/O);_*=F/T,T=F}return{x1:p,y1:_,x2:p+b,y2:_+T}}function un(u,s,l,p,_,b){const T=u.image;let C;if(T.content){const se=T.content,pe=T.pixelRatio||1;C=[se[0]/pe,se[1]/pe,T.displaySize[0]-se[2]/pe,T.displaySize[1]-se[3]/pe]}const M=s.left*b,O=s.right*b;let F,V,H,X;l==="width"||l==="both"?(X=_[0]+M-p[3],V=_[0]+O+p[1]):(X=_[0]+(M+O-T.displaySize[0])/2,V=X+T.displaySize[0]);const q=s.top*b,ee=s.bottom*b;return l==="height"||l==="both"?(F=_[1]+q-p[0],H=_[1]+ee+p[2]):(F=_[1]+(q+ee-T.displaySize[1])/2,H=F+T.displaySize[1]),{image:T,top:F,right:V,bottom:H,left:X,collisionPadding:C}}const tn=128,an=32640;function hi(u,s){const{expression:l}=s;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Hn(u+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=l;let b=0;for(;b<p.length&&p[b]<=u;)b++;b=Math.max(0,b-1);let T=b;for(;T<p.length&&p[T]<u+1;)T++;T=Math.min(p.length-1,T);const C=p[b],M=p[T];return l.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:M,interpolationType:_}:{kind:"camera",minZoom:C,maxZoom:M,minSize:l.evaluate(new Hn(C)),maxSize:l.evaluate(new Hn(M)),interpolationType:_}}}function Xn(u,s,l){let p="never";const _=u.get(s);return _?p=_:u.get(l)&&(p="always"),p}const yc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nf(u,s,l,p,_,b,T,C,M,O,F,V,H){const X=C?Math.min(an,Math.round(C[0])):0,q=C?Math.min(an,Math.round(C[1])):0;u.emplaceBack(s,l,Math.round(32*p),Math.round(32*_),b,T,(X<<1)+(M?1:0),q,16*O,16*F,256*V,256*H)}function qy(u,s,l){u.emplaceBack(s.x,s.y,l),u.emplaceBack(s.x,s.y,l),u.emplaceBack(s.x,s.y,l),u.emplaceBack(s.x,s.y,l)}function Y3(u){for(const s of u.sections)if(lu(s.text))return!0;return!1}class Gy{constructor(s){this.layoutVertexArray=new Zn,this.indexArray=new Ir,this.programConfigurations=s,this.segments=new Sn,this.dynamicLayoutVertexArray=new lr,this.opacityVertexArray=new ir,this.hasVisibleVertices=!1,this.placedSymbolArray=new ae}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,l,p,_){this.isEmpty()||(p&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Wy.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,gc.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,yc,!0),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}It("SymbolBuffers",Gy);class Yy{constructor(s,l,p){this.layoutVertexArray=new s,this.layoutAttributes=l,this.indexArray=new p,this.segments=new Sn,this.collisionVertexArray=new cr}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Rf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}It("CollisionBuffers",Yy);class Bf{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map((T=>T.id)),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hi(this.zoom,l["text-size"]),this.iconSizeData=hi(this.zoom,l["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),b=p.get("symbol-z-order");this.canOverlap=Xn(p,"text-overlap","text-allow-overlap")!=="never"||Xn(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map((T=>d.ao[T]))),this.stateDependentLayerIds=this.layers.filter((T=>T.isStateDependent())).map((T=>T.id)),this.sourceID=s.sourceID}createArrays(){this.text=new Gy(new cc(this.layers,this.zoom,(s=>/^text/.test(s)))),this.icon=new Gy(new cc(this.layers,this.zoom,(s=>/^icon/.test(s)))),this.glyphOffsetArray=new he,this.lineVertexArray=new we,this.symbolInstances=new ye,this.textAnchorOffsets=new _e}calculateGlyphDependencies(s,l,p,_,b){for(let T=0;T<s.length;T++)if(l[s.charCodeAt(T)]=!0,(p||_)&&b){const C=xu[s.charAt(T)];C&&(l[C.charCodeAt(0)]=!0)}}populate(s,l,p){const _=this.layers[0],b=_.layout,T=b.get("text-font"),C=b.get("text-field"),M=b.get("icon-image"),O=(C.value.kind!=="constant"||C.value.value instanceof Pr&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),F=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,V=b.get("symbol-sort-key");if(this.features=[],!O&&!F)return;const H=l.iconDependencies,X=l.glyphDependencies,q=l.availableImages,ee=new Hn(this.zoom);for(const{feature:se,id:pe,index:Ve,sourceLayerIndex:be}of s){const Ie=_._featureFilter.needGeometry,Je=ti(se,Ie);if(!_._featureFilter.filter(ee,Je,p))continue;let st,gt;if(Ie||(Je.geometry=hu(se)),O){const Pt=_.getValueAndResolveTokens("text-field",Je,p,q),Dt=Pr.factory(Pt),Yt=this.hasRTLText=this.hasRTLText||Y3(Dt);(!Yt||fs.getRTLTextPluginStatus()==="unavailable"||Yt&&fs.isParsed())&&(st=fm(Dt,_,Je))}if(F){const Pt=_.getValueAndResolveTokens("icon-image",Je,p,q);gt=Pt instanceof ls?Pt:ls.fromString(Pt)}if(!st&&!gt)continue;const Ft=this.sortFeaturesByKey?V.evaluate(Je,{},p):void 0;if(this.features.push({id:pe,text:st,icon:gt,index:Ve,sourceLayerIndex:be,geometry:Je.geometry,properties:se.properties,type:_u.types[se.type],sortKey:Ft}),gt&&(H[gt.name]=!0),st){const Pt=T.evaluate(Je,{},p).join(","),Dt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ao.vertical)>=0;for(const Yt of st.sections)if(Yt.image)H[Yt.image.name]=!0;else{const Rt=su(st.toString()),Ot=Yt.fontStack||Pt,ct=X[Ot]=X[Ot]||{};this.calculateGlyphDependencies(Yt.text,ct,Dt,this.allowVerticalPlacement,Rt)}}}b.get("symbol-placement")==="line"&&(this.features=(function(se){const pe={},Ve={},be=[];let Ie=0;function Je(Pt){be.push(se[Pt]),Ie++}function st(Pt,Dt,Yt){const Rt=Ve[Pt];return delete Ve[Pt],Ve[Dt]=Rt,be[Rt].geometry[0].pop(),be[Rt].geometry[0]=be[Rt].geometry[0].concat(Yt[0]),Rt}function gt(Pt,Dt,Yt){const Rt=pe[Dt];return delete pe[Dt],pe[Pt]=Rt,be[Rt].geometry[0].shift(),be[Rt].geometry[0]=Yt[0].concat(be[Rt].geometry[0]),Rt}function Ft(Pt,Dt,Yt){const Rt=Yt?Dt[0][Dt[0].length-1]:Dt[0][0];return`${Pt}:${Rt.x}:${Rt.y}`}for(let Pt=0;Pt<se.length;Pt++){const Dt=se[Pt],Yt=Dt.geometry,Rt=Dt.text?Dt.text.toString():null;if(!Rt){Je(Pt);continue}const Ot=Ft(Rt,Yt),ct=Ft(Rt,Yt,!0);if(Ot in Ve&&ct in pe&&Ve[Ot]!==pe[ct]){const sn=gt(Ot,ct,Yt),fn=st(Ot,ct,be[sn].geometry);delete pe[Ot],delete Ve[ct],Ve[Ft(Rt,be[fn].geometry,!0)]=fn,be[sn].geometry=null}else Ot in Ve?st(Ot,ct,Yt):ct in pe?gt(Ot,ct,Yt):(Je(Pt),pe[Ot]=Ie-1,Ve[ct]=Ie-1)}return be.filter((Pt=>Pt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((se,pe)=>se.sortKey-pe.sortKey))}update(s,l,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,l,this.layers,{imagePositions:p}),this.icon.programConfigurations.updatePaintArrays(s,l,this.layers,{imagePositions:p}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,l){const p=this.lineVertexArray.length;if(s.segment!==void 0){let _=s.dist(l[s.segment+1]),b=s.dist(l[s.segment]);const T={};for(let C=s.segment+1;C<l.length;C++)T[C]={x:l[C].x,y:l[C].y,tileUnitDistanceFromAnchor:_},C<l.length-1&&(_+=l[C+1].dist(l[C]));for(let C=s.segment||0;C>=0;C--)T[C]={x:l[C].x,y:l[C].y,tileUnitDistanceFromAnchor:b},C>0&&(b+=l[C-1].dist(l[C]));for(let C=0;C<l.length;C++){const M=T[C];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(s,l,p,_,b,T,C,M,O,F,V,H){const X=s.indexArray,q=s.layoutVertexArray,ee=s.segments.prepareSegment(4*l.length,q,X,this.canOverlap?T.sortKey:void 0),se=this.glyphOffsetArray.length,pe=ee.vertexLength,Ve=this.allowVerticalPlacement&&C===d.ao.vertical?Math.PI/2:0,be=T.text&&T.text.sections;for(let Ie=0;Ie<l.length;Ie++){const{tl:Je,tr:st,bl:gt,br:Ft,tex:Pt,pixelOffsetTL:Dt,pixelOffsetBR:Yt,minFontScaleX:Rt,minFontScaleY:Ot,glyphOffset:ct,isSDF:sn,sectionIndex:fn}=l[Ie],en=ee.vertexLength,Xt=ct[1];Nf(q,M.x,M.y,Je.x,Xt+Je.y,Pt.x,Pt.y,p,sn,Dt.x,Dt.y,Rt,Ot),Nf(q,M.x,M.y,st.x,Xt+st.y,Pt.x+Pt.w,Pt.y,p,sn,Yt.x,Dt.y,Rt,Ot),Nf(q,M.x,M.y,gt.x,Xt+gt.y,Pt.x,Pt.y+Pt.h,p,sn,Dt.x,Yt.y,Rt,Ot),Nf(q,M.x,M.y,Ft.x,Xt+Ft.y,Pt.x+Pt.w,Pt.y+Pt.h,p,sn,Yt.x,Yt.y,Rt,Ot),qy(s.dynamicLayoutVertexArray,M,Ve),X.emplaceBack(en,en+2,en+1),X.emplaceBack(en+1,en+2,en+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),Ie!==l.length-1&&fn===l[Ie+1].sectionIndex||s.programConfigurations.populatePaintArrays(q.length,T,T.index,{imagePositions:{},canonical:H,formattedSection:be&&be[fn]})}s.placedSymbolArray.emplaceBack(M.x,M.y,se,this.glyphOffsetArray.length-se,pe,O,F,M.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],C,0,!1,0,V)}_addCollisionDebugVertex(s,l,p,_,b,T){return l.emplaceBack(0,0),s.emplaceBack(p.x,p.y,_,b,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(s,l,p,_,b,T,C){const M=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),O=M.vertexLength,F=b.layoutVertexArray,V=b.collisionVertexArray,H=C.anchorX,X=C.anchorY;this._addCollisionDebugVertex(F,V,T,H,X,new v(s,l)),this._addCollisionDebugVertex(F,V,T,H,X,new v(p,l)),this._addCollisionDebugVertex(F,V,T,H,X,new v(p,_)),this._addCollisionDebugVertex(F,V,T,H,X,new v(s,_)),M.vertexLength+=4;const q=b.indexArray;q.emplaceBack(O,O+1),q.emplaceBack(O+1,O+2),q.emplaceBack(O+2,O+3),q.emplaceBack(O+3,O),M.primitiveLength+=4}addDebugCollisionBoxes(s,l,p,_){for(let b=s;b<l;b++){const T=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,_?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yy(tr,_c.members,nr),this.iconCollisionBox=new Yy(tr,_c.members,nr);for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(s,l,p,_,b,T,C,M,O){const F={};for(let V=l;V<p;V++){const H=s.get(V);F.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.textFeatureIndex=H.featureIndex;break}for(let V=_;V<b;V++){const H=s.get(V);F.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.verticalTextFeatureIndex=H.featureIndex;break}for(let V=T;V<C;V++){const H=s.get(V);F.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.iconFeatureIndex=H.featureIndex;break}for(let V=M;V<O;V++){const H=s.get(V);F.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.verticalIconFeatureIndex=H.featureIndex;break}return F}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const p=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,l){const p=s.placedSymbolArray.get(l),_=p.vertexStartIndex+4*p.numGlyphs;for(let b=p.vertexStartIndex;b<_;b+=4)s.indexArray.emplaceBack(b,b+2,b+1),s.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(s),p=Math.cos(s),_=[],b=[],T=[];for(let C=0;C<this.symbolInstances.length;++C){T.push(C);const M=this.symbolInstances.get(C);_.push(0|Math.round(l*M.anchorX+p*M.anchorY)),b.push(M.featureIndex)}return T.sort(((C,M)=>_[C]-_[M]||b[M]-b[C])),T}addToSortKeyRanges(s,l){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===l?p.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const p=this.symbolInstances.get(l);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(((_,b,T)=>{_>=0&&T.indexOf(_)===b&&this.addIndicesForPlacedSymbol(this.text,_)})),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ew,tw;It("SymbolBucket",Bf,{omit:["layers","collisionBoxArray","features","compareText"]}),Bf.MAX_GLYPHS=65535,Bf.addDynamicAttributes=qy;var Ky={get paint(){return tw=tw||new Lr({"icon-opacity":new Gt(Be.paint_symbol["icon-opacity"]),"icon-color":new Gt(Be.paint_symbol["icon-color"]),"icon-halo-color":new Gt(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gt(Be.paint_symbol["text-opacity"]),"text-color":new Gt(Be.paint_symbol["text-color"],{runtimeType:Yr,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Gt(Be.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(Be.paint_symbol["text-halo-blur"]),"text-translate":new jt(Be.paint_symbol["text-translate"]),"text-translate-anchor":new jt(Be.paint_symbol["text-translate-anchor"])})},get layout(){return ew=ew||new Lr({"symbol-placement":new jt(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jt(Be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new jt(Be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new jt(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(Be.layout_symbol["icon-size"]),"icon-text-fit":new jt(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jt(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(Be.layout_symbol["icon-image"]),"icon-rotate":new Gt(Be.layout_symbol["icon-rotate"]),"icon-padding":new Gt(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(Be.layout_symbol["icon-offset"]),"icon-anchor":new Gt(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(Be.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(Be.layout_symbol["text-field"]),"text-font":new Gt(Be.layout_symbol["text-font"]),"text-size":new Gt(Be.layout_symbol["text-size"]),"text-max-width":new Gt(Be.layout_symbol["text-max-width"]),"text-line-height":new jt(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(Be.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(Be.layout_symbol["text-justify"]),"text-radial-offset":new Gt(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(Be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Gt(Be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Gt(Be.layout_symbol["text-anchor"]),"text-max-angle":new jt(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(Be.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(Be.layout_symbol["text-rotate"]),"text-padding":new jt(Be.layout_symbol["text-padding"]),"text-keep-upright":new jt(Be.layout_symbol["text-keep-upright"]),"text-transform":new Gt(Be.layout_symbol["text-transform"]),"text-offset":new Gt(Be.layout_symbol["text-offset"]),"text-allow-overlap":new jt(Be.layout_symbol["text-allow-overlap"]),"text-overlap":new jt(Be.layout_symbol["text-overlap"]),"text-ignore-placement":new jt(Be.layout_symbol["text-ignore-placement"]),"text-optional":new jt(Be.layout_symbol["text-optional"])})}};class nw{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:_i,this.defaultValue=s}evaluate(s){if(s.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(s.formattedSection))return l.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}It("FormatSectionOverride",nw,{omit:["defaultValue"]});class Zg extends ci{constructor(s,l){super(s,Ky,l)}recalculate(s,l){if(super.recalculate(s,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const b of p)_.indexOf(b)<0&&_.push(b);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,l,p,_){const b=this.layout.get(s).evaluate(l,{},p,_),T=this._unevaluatedLayout._values[s];return T.isDataDriven()||ma(T.value)||!b?b:(function(C,M){return M.replace(/{([^{}]+)}/g,((O,F)=>C&&F in C?String(C[F]):""))})(l.properties,b)}createBucket(s){return new Bf(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of Ky.paint.overridableProperties){if(!Zg.hasPaintOverride(this.layout,s))continue;const l=this.paint.get(s),p=new nw(l),_=new ql(p,l.property.specification);let b=null;b=l.value.kind==="constant"||l.value.kind==="source"?new Xa("source",_):new qa("composite",_,l.value.zoomStops),this.paint._values[s]=new ps(l.property,b,l.parameters)}}_handleOverridablePaintPropertyUpdate(s,l,p){return!(!this.layout||l.isDataDriven()||p.isDataDriven())&&Zg.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,l){const p=s.get("text-field"),_=Ky.paint.properties[l];let b=!1;const T=C=>{for(const M of C)if(_.overrides&&_.overrides.hasOverride(M))return void(b=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Pr)T(p.value.value.sections);else if(p.value.kind==="source"||p.value.kind==="composite"){const C=O=>{b||(O instanceof cs&&rn(O.value)===Co?T(O.value.sections):O instanceof Va?T(O.sections):O.eachChild(C))},M=p.value;M._styleExpression&&C(M._styleExpression.expression)}return b}}let rw;var K3={get paint(){return rw=rw||new Lr({"background-color":new jt(Be.paint_background["background-color"]),"background-pattern":new eh(Be.paint_background["background-pattern"]),"background-opacity":new jt(Be.paint_background["background-opacity"])})}};class J3 extends ci{constructor(s,l){super(s,K3,l)}}let iw;var Q3={get paint(){return iw=iw||new Lr({"raster-opacity":new jt(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new jt(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(Be.paint_raster["raster-saturation"]),"raster-contrast":new jt(Be.paint_raster["raster-contrast"]),"raster-resampling":new jt(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(Be.paint_raster["raster-fade-duration"])})}};class eI extends ci{constructor(s,l){super(s,Q3,l)}}class tI extends ci{constructor(s,l){super(s,{},l),this.onAdd=p=>{this.implementation.onAdd&&this.implementation.onAdd(p,p.painter.context.gl)},this.onRemove=p=>{this.implementation.onRemove&&this.implementation.onRemove(p,p.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class nI{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const rI={once:!0},Jy=63710088e-1;class hh{constructor(s,l){if(isNaN(s)||isNaN(l))throw new Error(`Invalid LngLat object: (${s}, ${l})`);if(this.lng=+s,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new hh(vt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const l=Math.PI/180,p=this.lat*l,_=s.lat*l,b=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((s.lng-this.lng)*l);return Jy*Math.acos(Math.min(b,1))}static convert(s){if(s instanceof hh)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new hh(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new hh(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const sw=2*Math.PI*Jy;function ow(u){return sw*Math.cos(u*Math.PI/180)}function aw(u){return(180+u)/360}function lw(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function cw(u,s){return u/ow(s)}function Qy(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function uw(u,s){return u*ow(Qy(s))}class vm{constructor(s,l,p=0){this.x=+s,this.y=+l,this.z=+p}static fromLngLat(s,l=0){const p=hh.convert(s);return new vm(aw(p.lng),lw(p.lat),cw(l,p.lat))}toLngLat(){return new hh(360*this.x-180,Qy(this.y))}toAltitude(){return uw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/sw*(s=Qy(this.y),1/Math.cos(s*Math.PI/180));var s}}function hw(u,s,l){var p=2*Math.PI*6378137/256/Math.pow(2,l);return[u*p-2*Math.PI*6378137/2,s*p-2*Math.PI*6378137/2]}class ev{constructor(s,l,p){if(!(function(_,b,T){return!(_<0||_>25||T<0||T>=Math.pow(2,_)||b<0||b>=Math.pow(2,_))})(s,l,p))throw new Error(`x=${l}, y=${p}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=l,this.y=p,this.key=zf(0,s,s,l,p)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,l,p){const _=(T=this.y,C=this.z,M=hw(256*(b=this.x),256*(T=Math.pow(2,C)-T-1),C),O=hw(256*(b+1),256*(T+1),C),M[0]+","+M[1]+","+O[0]+","+O[1]);var b,T,C,M,O;const F=(function(V,H,X){let q,ee="";for(let se=V;se>0;se--)q=1<<se-1,ee+=(H&q?1:0)+(X&q?2:0);return ee})(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,_)}isChildOf(s){const l=this.z-s.z;return l>0&&s.x===this.x>>l&&s.y===this.y>>l}getTilePoint(s){const l=Math.pow(2,this.z);return new v((s.x*l-this.x)*ze,(s.y*l-this.y)*ze)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dw{constructor(s,l){this.wrap=s,this.canonical=l,this.key=zf(s,l.z,l.z,l.x,l.y)}}class Zo{constructor(s,l,p,_,b){if(this.terrainRttPosMatrix32f=null,s<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${p}`);this.overscaledZ=s,this.wrap=l,this.canonical=new ev(p,+_,+b),this.key=zf(l,s,p,_,b)}clone(){return new Zo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-s;return s>this.canonical.z?new Zo(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Zo(s,this.wrap,s,this.canonical.x>>l,this.canonical.y>>l)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(s,l){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-s;return s>this.canonical.z?zf(this.wrap*+l,s,this.canonical.z,this.canonical.x,this.canonical.y):zf(this.wrap*+l,s,s,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(s){if(s.wrap!==this.wrap||this.overscaledZ-s.overscaledZ<=0)return!1;if(s.overscaledZ===0)return this.overscaledZ>0;const l=this.canonical.z-s.canonical.z;return!(l<0)&&s.canonical.x===this.canonical.x>>l&&s.canonical.y===this.canonical.y>>l}children(s){if(this.overscaledZ>=s)return[new Zo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new Zo(l,this.wrap,l,p,_),new Zo(l,this.wrap,l,p+1,_),new Zo(l,this.wrap,l,p,_+1),new Zo(l,this.wrap,l,p+1,_+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Zo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Zo(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new vm(s.x-this.wrap,s.y))}}function zf(u,s,l,p,_){(u*=2)<0&&(u=-1*u-1);const b=1<<l;return(b*b*u+b*_+p).toString(36)+l.toString(36)+s.toString(36)}function xm(u,s){return s?u.properties[s]:u.id}It("CanonicalTileID",ev),It("OverscaledTileID",Zo,{omit:["terrainRttPosMatrix32f"]});class xd{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(s){return this.minX=Math.min(this.minX,s.x),this.minY=Math.min(this.minY,s.y),this.maxX=Math.max(this.maxX,s.x),this.maxY=Math.max(this.maxY,s.y),this}expandBy(s){return this.minX-=s,this.minY-=s,this.maxX+=s,this.maxY+=s,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(s){return this.expandBy(-s)}map(s){const l=new xd;return l.extend(s(new v(this.minX,this.minY))),l.extend(s(new v(this.maxX,this.minY))),l.extend(s(new v(this.minX,this.maxY))),l.extend(s(new v(this.maxX,this.maxY))),l}static fromPoints(s){const l=new xd;for(const p of s)l.extend(p);return l}contains(s){return s.x>=this.minX&&s.x<=this.maxX&&s.y>=this.minY&&s.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(s){return!this.empty()&&!s.empty()&&s.minX>=this.minX&&s.maxX<=this.maxX&&s.minY>=this.minY&&s.maxY<=this.maxY}intersects(s){return!this.empty()&&!s.empty()&&s.minX<=this.maxX&&s.maxX>=this.minX&&s.minY<=this.maxY&&s.maxY>=this.minY}}class fw{constructor(s){this._stringToNumber={},this._numberToString=[];for(let l=0;l<s.length;l++){const p=s[l];this._stringToNumber[p]=l,this._numberToString[l]=p}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class pw{constructor(s,l,p,_,b){this.type="Feature",this._vectorTileFeature=s,s._z=l,s._x=p,s._y=_,this.properties=s.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(s[l]=this[l]);return s}}class mw{constructor(s,l){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new go(ze,16,0),this.grid3D=new go(ze,16,0),this.featureIndexArray=new Ge,this.promoteId=l}insert(s,l,p,_,b,T){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,b);const M=T?this.grid3D:this.grid;for(let O=0;O<l.length;O++){const F=l[O],V=[1/0,1/0,-1/0,-1/0];for(let H=0;H<F.length;H++){const X=F[H];V[0]=Math.min(V[0],X.x),V[1]=Math.min(V[1],X.y),V[2]=Math.max(V[2],X.x),V[3]=Math.max(V[3],X.y)}V[0]<ze&&V[1]<ze&&V[2]>=0&&V[3]>=0&&M.insert(C,V[0],V[1],V[2],V[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new cm(new Df(this.rawTileData)).layers,this.sourceLayerCoder=new fw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,l,p,_){this.loadVTLayers();const b=s.params,T=ze/s.tileSize/s.scale,C=fo(b.filter,b.globalState),M=s.queryGeometry,O=s.queryPadding*T,F=xd.fromPoints(M),V=this.grid.query(F.minX-O,F.minY-O,F.maxX+O,F.maxY+O),H=xd.fromPoints(s.cameraQueryGeometry).expandBy(O),X=this.grid3D.query(H.minX,H.minY,H.maxX,H.maxY,((se,pe,Ve,be)=>(function(Ie,Je,st,gt,Ft){for(const Dt of Ie)if(Je<=Dt.x&&st<=Dt.y&&gt>=Dt.x&&Ft>=Dt.y)return!0;const Pt=[new v(Je,st),new v(Je,Ft),new v(gt,Ft),new v(gt,st)];if(Ie.length>2){for(const Dt of Pt)if(uc(Ie,Dt))return!0}for(let Dt=0;Dt<Ie.length-1;Dt++)if(wg(Ie[Dt],Ie[Dt+1],Pt))return!0;return!1})(s.cameraQueryGeometry,se-O,pe-O,Ve+O,be+O)));for(const se of X)V.push(se);V.sort(iI);const q={};let ee;for(let se=0;se<V.length;se++){const pe=V[se];if(pe===ee)continue;ee=pe;const Ve=this.featureIndexArray.get(pe);let be=null;this.loadMatchingFeature(q,Ve.bucketIndex,Ve.sourceLayerIndex,Ve.featureIndex,C,b.layers,b.availableImages,l,p,_,((Ie,Je,st)=>(be||(be=hu(Ie)),Je.queryIntersectsFeature({queryGeometry:M,feature:Ie,featureState:st,geometry:be,zoom:this.z,transform:s.transform,pixelsToTileUnits:T,pixelPosMatrix:s.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:s.getElevation}))))}return q}loadMatchingFeature(s,l,p,_,b,T,C,M,O,F,V){const H=this.bucketLayerIDs[l];if(T&&!H.some((se=>T.has(se))))return;const X=this.sourceLayerCoder.decode(p),q=this.vtLayers[X].feature(_);if(b.needGeometry){const se=ti(q,!0);if(!b.filter(new Hn(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!b.filter(new Hn(this.tileID.overscaledZ),q))return;const ee=this.getId(q,X);for(let se=0;se<H.length;se++){const pe=H[se];if(T&&!T.has(pe))continue;const Ve=M[pe];if(!Ve)continue;let be={};ee&&F&&(be=F.getState(Ve.sourceLayer||"_geojsonTileLayer",ee));const Ie=ut({},O[pe]);Ie.paint=gw(Ie.paint,Ve.paint,q,be,C),Ie.layout=gw(Ie.layout,Ve.layout,q,be,C);const Je=!V||V(q,Ve,be);if(!Je)continue;const st=new pw(q,this.z,this.x,this.y,ee);st.layer=Ie;let gt=s[pe];gt===void 0&&(gt=s[pe]=[]),gt.push({featureIndex:_,feature:st,intersectionZ:Je})}}lookupSymbolFeatures(s,l,p,_,b,T,C,M){const O={};this.loadVTLayers();const F=fo(b.filterSpec,b.globalState);for(const V of s)this.loadMatchingFeature(O,p,_,V,F,T,C,M,l);return O}hasLayer(s){for(const l of this.bucketLayerIDs)for(const p of l)if(s===p)return!0;return!1}getId(s,l){var p;let _=s.id;return this.promoteId&&(_=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof _=="boolean"&&(_=Number(_)),_===void 0&&(!((p=s.properties)===null||p===void 0)&&p.cluster)&&this.promoteId&&(_=Number(s.properties.cluster_id))),_}}function gw(u,s,l,p,_){return Wt(u,((b,T)=>{const C=s instanceof ol?s.get(T):null;return C&&C.evaluate?C.evaluate(l,p,_):C}))}function iI(u,s){return s-u}function _w(u,s,l,p,_){const b=[];for(let T=0;T<u.length;T++){const C=u[T];let M;for(let O=0;O<C.length-1;O++){let F=C[O],V=C[O+1];F.x<s&&V.x<s||(F.x<s?F=new v(s,F.y+(s-F.x)/(V.x-F.x)*(V.y-F.y))._round():V.x<s&&(V=new v(s,F.y+(s-F.x)/(V.x-F.x)*(V.y-F.y))._round()),F.y<l&&V.y<l||(F.y<l?F=new v(F.x+(l-F.y)/(V.y-F.y)*(V.x-F.x),l)._round():V.y<l&&(V=new v(F.x+(l-F.y)/(V.y-F.y)*(V.x-F.x),l)._round()),F.x>=p&&V.x>=p||(F.x>=p?F=new v(p,F.y+(p-F.x)/(V.x-F.x)*(V.y-F.y))._round():V.x>=p&&(V=new v(p,F.y+(p-F.x)/(V.x-F.x)*(V.y-F.y))._round()),F.y>=_&&V.y>=_||(F.y>=_?F=new v(F.x+(_-F.y)/(V.y-F.y)*(V.x-F.x),_)._round():V.y>=_&&(V=new v(F.x+(_-F.y)/(V.y-F.y)*(V.x-F.x),_)._round()),M&&F.equals(M[M.length-1])||(M=[F],b.push(M)),M.push(V)))))}}return b}It("FeatureIndex",mw,{omit:["rawTileData","sourceLayerCoder"]});class dh extends v{constructor(s,l,p,_){super(s,l),this.angle=p,_!==void 0&&(this.segment=_)}clone(){return new dh(this.x,this.y,this.angle,this.segment)}}function yw(u,s,l,p,_){if(s.segment===void 0||l===0)return!0;let b=s,T=s.segment+1,C=0;for(;C>-l/2;){if(T--,T<0)return!1;C-=u[T].dist(b),b=u[T]}C+=u[T].dist(u[T+1]),T++;const M=[];let O=0;for(;C<l/2;){const F=u[T],V=u[T+1];if(!V)return!1;let H=u[T-1].angleTo(F)-F.angleTo(V);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:C,angleDelta:H}),O+=H;C-M[0].distance>p;)O-=M.shift().angleDelta;if(O>_)return!1;T++,C+=F.dist(V)}return!0}function vw(u){let s=0;for(let l=0;l<u.length-1;l++)s+=u[l].dist(u[l+1]);return s}function xw(u,s,l){return u?.6*s*l:0}function bw(u,s){return Math.max(u?u.right-u.left:0,s?s.right-s.left:0)}function sI(u,s,l,p,_,b){const T=xw(l,_,b),C=bw(l,p)*b;let M=0;const O=vw(u)/2;for(let F=0;F<u.length-1;F++){const V=u[F],H=u[F+1],X=V.dist(H);if(M+X>O){const q=(O-M)/X,ee=Hs.number(V.x,H.x,q),se=Hs.number(V.y,H.y,q),pe=new dh(ee,se,H.angleTo(V),F);return pe._round(),!T||yw(u,pe,C,T,s)?pe:void 0}M+=X}}function oI(u,s,l,p,_,b,T,C,M){const O=xw(p,b,T),F=bw(p,_),V=F*T,H=u[0].x===0||u[0].x===M||u[0].y===0||u[0].y===M;return s-V<s/4&&(s=V+s/4),ww(u,H?s/2*C%s:(F/2+2*b)*T*C%s,s,O,l,V,H,!1,M)}function ww(u,s,l,p,_,b,T,C,M){const O=b/2,F=vw(u);let V=0,H=s-l,X=[];for(let q=0;q<u.length-1;q++){const ee=u[q],se=u[q+1],pe=ee.dist(se),Ve=se.angleTo(ee);for(;H+l<V+pe;){H+=l;const be=(H-V)/pe,Ie=Hs.number(ee.x,se.x,be),Je=Hs.number(ee.y,se.y,be);if(Ie>=0&&Ie<M&&Je>=0&&Je<M&&H-O>=0&&H+O<=F){const st=new dh(Ie,Je,Ve,q);st._round(),p&&!yw(u,st,b,p,_)||X.push(st)}}V+=pe}return C||X.length||T||(X=ww(u,V/2,l,p,_,b,T,!0,M)),X}function Tw(u,s,l,p){const _=[],b=u.image,T=b.pixelRatio,C=b.paddedRect.w-2,M=b.paddedRect.h-2;let O={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const F=b.stretchX||[[0,C]],V=b.stretchY||[[0,M]],H=(ct,sn)=>ct+sn[1]-sn[0],X=F.reduce(H,0),q=V.reduce(H,0),ee=C-X,se=M-q;let pe=0,Ve=X,be=0,Ie=q,Je=0,st=ee,gt=0,Ft=se;if(b.content&&p){const ct=b.content,sn=ct[2]-ct[0],fn=ct[3]-ct[1];(b.textFitWidth||b.textFitHeight)&&(O=Qt(u)),pe=Xg(F,0,ct[0]),be=Xg(V,0,ct[1]),Ve=Xg(F,ct[0],ct[2]),Ie=Xg(V,ct[1],ct[3]),Je=ct[0]-pe,gt=ct[1]-be,st=sn-Ve,Ft=fn-Ie}const Pt=O.x1,Dt=O.y1,Yt=O.x2-Pt,Rt=O.y2-Dt,Ot=(ct,sn,fn,en)=>{const Xt=qg(ct.stretch-pe,Ve,Yt,Pt),Ln=Gg(ct.fixed-Je,st,ct.stretch,X),Br=qg(sn.stretch-be,Ie,Rt,Dt),di=Gg(sn.fixed-gt,Ft,sn.stretch,q),os=qg(fn.stretch-pe,Ve,Yt,Pt),Xo=Gg(fn.fixed-Je,st,fn.stretch,X),to=qg(en.stretch-be,Ie,Rt,Dt),$i=Gg(en.fixed-gt,Ft,en.stretch,q),Mr=new v(Xt,Br),Si=new v(os,Br),Wi=new v(os,to),Hi=new v(Xt,to),Os=new v(Ln/T,di/T),qo=new v(Xo/T,$i/T),Ai=s*Math.PI/180;if(Ai){const Pi=Math.sin(Ai),Ei=Math.cos(Ai),ri=[Ei,-Pi,Pi,Ei];Mr._matMult(ri),Si._matMult(ri),Hi._matMult(ri),Wi._matMult(ri)}const no=ct.stretch+ct.fixed,fi=sn.stretch+sn.fixed;return{tl:Mr,tr:Si,bl:Hi,br:Wi,tex:{x:b.paddedRect.x+1+no,y:b.paddedRect.y+1+fi,w:fn.stretch+fn.fixed-no,h:en.stretch+en.fixed-fi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Os,pixelOffsetBR:qo,minFontScaleX:st/T/Yt,minFontScaleY:Ft/T/Rt,isSDF:l}};if(p&&(b.stretchX||b.stretchY)){const ct=Sw(F,ee,X),sn=Sw(V,se,q);for(let fn=0;fn<ct.length-1;fn++){const en=ct[fn],Xt=ct[fn+1];for(let Ln=0;Ln<sn.length-1;Ln++)_.push(Ot(en,sn[Ln],Xt,sn[Ln+1]))}}else _.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:M+1}));return _}function Xg(u,s,l){let p=0;for(const _ of u)p+=Math.max(s,Math.min(l,_[1]))-Math.max(s,Math.min(l,_[0]));return p}function Sw(u,s,l){const p=[{fixed:-1,stretch:0}];for(const[_,b]of u){const T=p[p.length-1];p.push({fixed:_-T.stretch,stretch:T.stretch}),p.push({fixed:_-T.stretch,stretch:T.stretch+(b-_)})}return p.push({fixed:s+1,stretch:l}),p}function qg(u,s,l,p){return u/s*l+p}function Gg(u,s,l,p){return u-s*l/p}It("Anchor",dh);class Yg{constructor(s,l,p,_,b,T,C,M,O,F){var V;if(this.boxStartIndex=s.length,O){let H=T.top,X=T.bottom;const q=T.collisionPadding;q&&(H-=q[1],X+=q[3]);let ee=X-H;ee>0&&(ee=Math.max(10,ee),this.circleDiameter=ee)}else{const H=!((V=T.image)===null||V===void 0)&&V.content&&(T.image.textFitWidth||T.image.textFitHeight)?Qt(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};H.y1=H.y1*C-M[0],H.y2=H.y2*C+M[2],H.x1=H.x1*C-M[3],H.x2=H.x2*C+M[1];const X=T.collisionPadding;if(X&&(H.x1-=X[0]*C,H.y1-=X[1]*C,H.x2+=X[2]*C,H.y2+=X[3]*C),F){const q=new v(H.x1,H.y1),ee=new v(H.x2,H.y1),se=new v(H.x1,H.y2),pe=new v(H.x2,H.y2),Ve=F*Math.PI/180;q._rotate(Ve),ee._rotate(Ve),se._rotate(Ve),pe._rotate(Ve),H.x1=Math.min(q.x,ee.x,se.x,pe.x),H.x2=Math.max(q.x,ee.x,se.x,pe.x),H.y1=Math.min(q.y,ee.y,se.y,pe.y),H.y2=Math.max(q.y,ee.y,se.y,pe.y)}s.emplaceBack(l.x,l.y,H.x1,H.y1,H.x2,H.y2,p,_,b)}this.boxEndIndex=s.length}}class aI{constructor(s=[],l=(p,_)=>p<_?-1:p>_?1:0){if(this.data=s,this.length=this.data.length,this.compare=l,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:l,compare:p}=this,_=l[s];for(;s>0;){const b=s-1>>1,T=l[b];if(p(_,T)>=0)break;l[s]=T,s=b}l[s]=_}_down(s){const{data:l,compare:p}=this,_=this.length>>1,b=l[s];for(;s<_;){let T=1+(s<<1);const C=T+1;if(C<this.length&&p(l[C],l[T])<0&&(T=C),p(l[T],b)>=0)break;l[s]=l[T],s=T}l[s]=b}}function lI(u,s=1,l=!1){const p=xd.fromPoints(u[0]),_=Math.min(p.width(),p.height());let b=_/2;const T=new aI([],cI),{minX:C,minY:M,maxX:O,maxY:F}=p;if(_===0)return new v(C,M);for(let X=C;X<O;X+=_)for(let q=M;q<F;q+=_)T.push(new Uf(X+b,q+b,b,u));let V=(function(X){let q=0,ee=0,se=0;const pe=X[0];for(let Ve=0,be=pe.length,Ie=be-1;Ve<be;Ie=Ve++){const Je=pe[Ve],st=pe[Ie],gt=Je.x*st.y-st.x*Je.y;ee+=(Je.x+st.x)*gt,se+=(Je.y+st.y)*gt,q+=3*gt}return new Uf(ee/q,se/q,0,X)})(u),H=T.length;for(;T.length;){const X=T.pop();(X.d>V.d||!V.d)&&(V=X,l&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,H)),X.max-V.d<=s||(b=X.h/2,T.push(new Uf(X.p.x-b,X.p.y-b,b,u)),T.push(new Uf(X.p.x+b,X.p.y-b,b,u)),T.push(new Uf(X.p.x-b,X.p.y+b,b,u)),T.push(new Uf(X.p.x+b,X.p.y+b,b,u)),H+=4)}return l&&(console.log(`num probes: ${H}`),console.log(`best distance: ${V.d}`)),V.p}function cI(u,s){return s.max-u.max}function Uf(u,s,l,p){this.p=new v(u,s),this.h=l,this.d=(function(_,b){let T=!1,C=1/0;for(let M=0;M<b.length;M++){const O=b[M];for(let F=0,V=O.length,H=V-1;F<V;H=F++){const X=O[F],q=O[H];X.y>_.y!=q.y>_.y&&_.x<(q.x-X.x)*(_.y-X.y)/(q.y-X.y)+X.x&&(T=!T),C=Math.min(C,Jp(_,X,q))}}return(T?1:-1)*Math.sqrt(C)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}var ss;d.aE=void 0,(ss=d.aE||(d.aE={}))[ss.center=1]="center",ss[ss.left=2]="left",ss[ss.right=3]="right",ss[ss.top=4]="top",ss[ss.bottom=5]="bottom",ss[ss["top-left"]=6]="top-left",ss[ss["top-right"]=7]="top-right",ss[ss["bottom-left"]=8]="bottom-left",ss[ss["bottom-right"]=9]="bottom-right";const tv=Number.POSITIVE_INFINITY;function Aw(u,s){return s[1]!==tv?(function(l,p,_){let b=0,T=0;switch(p=Math.abs(p),_=Math.abs(_),l){case"top-right":case"top-left":case"top":T=_-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-_}switch(l){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,T]})(u,s[0],s[1]):(function(l,p){let _=0,b=0;p<0&&(p=0);const T=p/Math.SQRT2;switch(l){case"top-right":case"top-left":b=T-7;break;case"bottom-right":case"bottom-left":b=7-T;break;case"bottom":b=7-p;break;case"top":b=p-7}switch(l){case"top-right":case"bottom-right":_=-T;break;case"top-left":case"bottom-left":_=T;break;case"left":_=p;break;case"right":_=-p}return[_,b]})(u,s[0])}function Pw(u,s,l){var p;const _=u.layout,b=(p=_.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(s,{},l);if(b){const C=b.values,M=[];for(let O=0;O<C.length;O+=2){const F=M[O]=C[O],V=C[O+1].map((H=>H*ni));F.startsWith("top")?V[1]-=7:F.startsWith("bottom")&&(V[1]+=7),M[O+1]=V}return new Zr(M)}const T=_.get("text-variable-anchor");if(T){let C;C=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(s,{},l)*ni,tv]:_.get("text-offset").evaluate(s,{},l).map((O=>O*ni));const M=[];for(const O of T)M.push(O,Aw(O,C));return new Zr(M)}return null}function nv(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uI(u,s,l,p,_,b,T,C,M,O,F,V){let H=b.textMaxSize.evaluate(s,{});H===void 0&&(H=T);const X=u.layers[0].layout,q=X.get("icon-offset").evaluate(s,{},F),ee=Cw(l.horizontal),se=T/24,pe=u.tilePixelRatio*se,Ve=u.tilePixelRatio*H/24,be=u.tilePixelRatio*C,Ie=u.tilePixelRatio*X.get("symbol-spacing"),Je=X.get("text-padding")*u.tilePixelRatio,st=(function(fn,en,Xt,Ln=1){const Br=fn.get("icon-padding").evaluate(en,{},Xt),di=Br&&Br.values;return[di[0]*Ln,di[1]*Ln,di[2]*Ln,di[3]*Ln]})(X,s,F,u.tilePixelRatio),gt=X.get("text-max-angle")/180*Math.PI,Ft=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",Pt=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",Dt=X.get("symbol-placement"),Yt=Ie/2,Rt=X.get("icon-text-fit");let Ot;p&&Rt!=="none"&&(u.allowVerticalPlacement&&l.vertical&&(Ot=un(p,l.vertical,Rt,X.get("icon-text-fit-padding"),q,se)),ee&&(p=un(p,ee,Rt,X.get("icon-text-fit-padding"),q,se)));const ct=F?V.line.getGranularityForZoomLevel(F.z):1,sn=(fn,en)=>{en.x<0||en.x>=ze||en.y<0||en.y>=ze||(function(Xt,Ln,Br,di,os,Xo,to,$i,Mr,Si,Wi,Hi,Os,qo,Ai,no,fi,Pi,Ei,ri,vr,yl,Vf,vl,fI){const jf=Xt.addToLineVertexArray(Ln,Br);let bd,$f,Wf,Hf,kw=0,Dw=0,Ow=0,Lw=0,uv=-1,hv=-1;const bu={};let Fw=Uo("");if(Xt.allowVerticalPlacement&&di.vertical){const ys=$i.layout.get("text-rotate").evaluate(vr,{},vl)+90;Wf=new Yg(Mr,Ln,Si,Wi,Hi,di.vertical,Os,qo,Ai,ys),to&&(Hf=new Yg(Mr,Ln,Si,Wi,Hi,to,fi,Pi,Ai,ys))}if(os){const ys=$i.layout.get("icon-rotate").evaluate(vr,{}),Go=$i.layout.get("icon-text-fit")!=="none",wd=Tw(os,ys,Vf,Go),bl=to?Tw(to,ys,Vf,Go):void 0;$f=new Yg(Mr,Ln,Si,Wi,Hi,os,fi,Pi,!1,ys),kw=4*wd.length;const Td=Xt.iconSizeData;let vc=null;Td.kind==="source"?(vc=[tn*$i.layout.get("icon-size").evaluate(vr,{})],vc[0]>an&&Jn(`${Xt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Td.kind==="composite"&&(vc=[tn*yl.compositeIconSizes[0].evaluate(vr,{},vl),tn*yl.compositeIconSizes[1].evaluate(vr,{},vl)],(vc[0]>an||vc[1]>an)&&Jn(`${Xt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Xt.addSymbols(Xt.icon,wd,vc,ri,Ei,vr,d.ao.none,Ln,jf.lineStartIndex,jf.lineLength,-1,vl),uv=Xt.icon.placedSymbolArray.length-1,bl&&(Dw=4*bl.length,Xt.addSymbols(Xt.icon,bl,vc,ri,Ei,vr,d.ao.vertical,Ln,jf.lineStartIndex,jf.lineLength,-1,vl),hv=Xt.icon.placedSymbolArray.length-1)}const Nw=Object.keys(di.horizontal);for(const ys of Nw){const Go=di.horizontal[ys];if(!bd){Fw=Uo(Go.text);const bl=$i.layout.get("text-rotate").evaluate(vr,{},vl);bd=new Yg(Mr,Ln,Si,Wi,Hi,Go,Os,qo,Ai,bl)}const wd=Go.positionedLines.length===1;if(Ow+=Ew(Xt,Ln,Go,Xo,$i,Ai,vr,no,jf,di.vertical?d.ao.horizontal:d.ao.horizontalOnly,wd?Nw:[ys],bu,uv,yl,vl),wd)break}di.vertical&&(Lw+=Ew(Xt,Ln,di.vertical,Xo,$i,Ai,vr,no,jf,d.ao.vertical,["vertical"],bu,hv,yl,vl));const pI=bd?bd.boxStartIndex:Xt.collisionBoxArray.length,mI=bd?bd.boxEndIndex:Xt.collisionBoxArray.length,gI=Wf?Wf.boxStartIndex:Xt.collisionBoxArray.length,_I=Wf?Wf.boxEndIndex:Xt.collisionBoxArray.length,yI=$f?$f.boxStartIndex:Xt.collisionBoxArray.length,vI=$f?$f.boxEndIndex:Xt.collisionBoxArray.length,xI=Hf?Hf.boxStartIndex:Xt.collisionBoxArray.length,bI=Hf?Hf.boxEndIndex:Xt.collisionBoxArray.length;let xl=-1;const Jg=(ys,Go)=>ys&&ys.circleDiameter?Math.max(ys.circleDiameter,Go):Go;xl=Jg(bd,xl),xl=Jg(Wf,xl),xl=Jg($f,xl),xl=Jg(Hf,xl);const Bw=xl>-1?1:0;Bw&&(xl*=fI/ni),Xt.glyphOffsetArray.length>=Bf.MAX_GLYPHS&&Jn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vr.sortKey!==void 0&&Xt.addToSortKeyRanges(Xt.symbolInstances.length,vr.sortKey);const wI=Pw($i,vr,vl),[TI,SI]=(function(ys,Go){const wd=ys.length,bl=Go?.values;if(bl?.length>0)for(let Td=0;Td<bl.length;Td+=2){const vc=bl[Td+1];ys.emplaceBack(d.aE[bl[Td]],vc[0],vc[1])}return[wd,ys.length]})(Xt.textAnchorOffsets,wI);Xt.symbolInstances.emplaceBack(Ln.x,Ln.y,bu.right>=0?bu.right:-1,bu.center>=0?bu.center:-1,bu.left>=0?bu.left:-1,bu.vertical||-1,uv,hv,Fw,pI,mI,gI,_I,yI,vI,xI,bI,Si,Ow,Lw,kw,Dw,Bw,0,Os,xl,TI,SI)})(u,en,fn,l,p,_,Ot,u.layers[0],u.collisionBoxArray,s.index,s.sourceLayerIndex,u.index,pe,[Je,Je,Je,Je],Ft,M,be,st,Pt,q,s,b,O,F,T)};if(Dt==="line")for(const fn of _w(s.geometry,0,0,ze,ze)){const en=ks(fn,ct),Xt=oI(en,Ie,gt,l.vertical||ee,p,24,Ve,u.overscaling,ze);for(const Ln of Xt)ee&&hI(u,ee.text,Yt,Ln)||sn(en,Ln)}else if(Dt==="line-center"){for(const fn of s.geometry)if(fn.length>1){const en=ks(fn,ct),Xt=sI(en,gt,l.vertical||ee,p,24,Ve);Xt&&sn(en,Xt)}}else if(s.type==="Polygon")for(const fn of Vl(s.geometry,0)){const en=lI(fn,16);sn(ks(fn[0],ct,!0),new dh(en.x,en.y,0))}else if(s.type==="LineString")for(const fn of s.geometry){const en=ks(fn,ct);sn(en,new dh(en[0].x,en[0].y,0))}else if(s.type==="Point")for(const fn of s.geometry)for(const en of fn)sn([en],new dh(en.x,en.y,0))}function Ew(u,s,l,p,_,b,T,C,M,O,F,V,H,X,q){const ee=(function(Ve,be,Ie,Je,st,gt,Ft,Pt){const Dt=Je.layout.get("text-rotate").evaluate(gt,{})*Math.PI/180,Yt=[];for(const Rt of be.positionedLines)for(const Ot of Rt.positionedGlyphs){if(!Ot.rect)continue;const ct=Ot.rect||{};let sn=4,fn=!0,en=1,Xt=0;const Ln=(st||Pt)&&Ot.vertical,Br=Ot.metrics.advance*Ot.scale/2;if(Pt&&be.verticalizable&&(Xt=Rt.lineOffset/2-(Ot.imageName?-(ni-Ot.metrics.width*Ot.scale)/2:(Ot.scale-1)*ni)),Ot.imageName){const Pi=Ft[Ot.imageName];fn=Pi.sdf,en=Pi.pixelRatio,sn=1/en}const di=st?[Ot.x+Br,Ot.y]:[0,0];let os=st?[0,0]:[Ot.x+Br+Ie[0],Ot.y+Ie[1]-Xt],Xo=[0,0];Ln&&(Xo=os,os=[0,0]);const to=Ot.metrics.isDoubleResolution?2:1,$i=(Ot.metrics.left-sn)*Ot.scale-Br+os[0],Mr=(-Ot.metrics.top-sn)*Ot.scale+os[1],Si=$i+ct.w/to*Ot.scale/en,Wi=Mr+ct.h/to*Ot.scale/en,Hi=new v($i,Mr),Os=new v(Si,Mr),qo=new v($i,Wi),Ai=new v(Si,Wi);if(Ln){const Pi=new v(-Br,Br- -17),Ei=-Math.PI/2,ri=12-Br,vr=new v(22-ri,-(Ot.imageName?ri:0)),yl=new v(...Xo);Hi._rotateAround(Ei,Pi)._add(vr)._add(yl),Os._rotateAround(Ei,Pi)._add(vr)._add(yl),qo._rotateAround(Ei,Pi)._add(vr)._add(yl),Ai._rotateAround(Ei,Pi)._add(vr)._add(yl)}if(Dt){const Pi=Math.sin(Dt),Ei=Math.cos(Dt),ri=[Ei,-Pi,Pi,Ei];Hi._matMult(ri),Os._matMult(ri),qo._matMult(ri),Ai._matMult(ri)}const no=new v(0,0),fi=new v(0,0);Yt.push({tl:Hi,tr:Os,bl:qo,br:Ai,tex:ct,writingMode:be.writingMode,glyphOffset:di,sectionIndex:Ot.sectionIndex,isSDF:fn,pixelOffsetTL:no,pixelOffsetBR:fi,minFontScaleX:0,minFontScaleY:0})}return Yt})(0,l,C,_,b,T,p,u.allowVerticalPlacement),se=u.textSizeData;let pe=null;se.kind==="source"?(pe=[tn*_.layout.get("text-size").evaluate(T,{})],pe[0]>an&&Jn(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(pe=[tn*X.compositeTextSizes[0].evaluate(T,{},q),tn*X.compositeTextSizes[1].evaluate(T,{},q)],(pe[0]>an||pe[1]>an)&&Jn(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),u.addSymbols(u.text,ee,pe,C,b,T,O,s,M.lineStartIndex,M.lineLength,H,q);for(const Ve of F)V[Ve]=u.text.placedSymbolArray.length-1;return 4*ee.length}function Cw(u){for(const s in u)return u[s];return null}function hI(u,s,l,p){const _=u.compareText;if(s in _){const b=_[s];for(let T=b.length-1;T>=0;T--)if(p.dist(b[T])<l)return!0}else _[s]=[];return _[s].push(p),!1}const Iw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class rv{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,p]=new Uint8Array(s,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const b=Iw[15&p];if(!b)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(s,2,1),[C]=new Uint32Array(s,4,1);return new rv(C,T,b,s)}constructor(s,l=64,p=Float64Array,_){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=p,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const b=Iw.indexOf(this.ArrayType),T=2*s*this.ArrayType.BYTES_PER_ELEMENT,C=s*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-C%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+C+M,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+T+C+M),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+C+M,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=s)}add(s,l){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=s,this.coords[this._pos++]=l,p}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return iv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,l,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:T,nodeSize:C}=this,M=[0,b.length-1,0],O=[];for(;M.length;){const F=M.pop()||0,V=M.pop()||0,H=M.pop()||0;if(V-H<=C){for(let se=H;se<=V;se++){const pe=T[2*se],Ve=T[2*se+1];pe>=s&&pe<=p&&Ve>=l&&Ve<=_&&O.push(b[se])}continue}const X=H+V>>1,q=T[2*X],ee=T[2*X+1];q>=s&&q<=p&&ee>=l&&ee<=_&&O.push(b[X]),(F===0?s<=q:l<=ee)&&(M.push(H),M.push(X-1),M.push(1-F)),(F===0?p>=q:_>=ee)&&(M.push(X+1),M.push(V),M.push(1-F))}return O}within(s,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:T}=this,C=[0,_.length-1,0],M=[],O=p*p;for(;C.length;){const F=C.pop()||0,V=C.pop()||0,H=C.pop()||0;if(V-H<=T){for(let se=H;se<=V;se++)Rw(b[2*se],b[2*se+1],s,l)<=O&&M.push(_[se]);continue}const X=H+V>>1,q=b[2*X],ee=b[2*X+1];Rw(q,ee,s,l)<=O&&M.push(_[X]),(F===0?s-p<=q:l-p<=ee)&&(C.push(H),C.push(X-1),C.push(1-F)),(F===0?s+p>=q:l+p>=ee)&&(C.push(X+1),C.push(V),C.push(1-F))}return M}}function iv(u,s,l,p,_,b){if(_-p<=l)return;const T=p+_>>1;Mw(u,s,T,p,_,b),iv(u,s,l,p,T-1,1-b),iv(u,s,l,T+1,_,1-b)}function Mw(u,s,l,p,_,b){for(;_>p;){if(_-p>600){const O=_-p+1,F=l-p+1,V=Math.log(O),H=.5*Math.exp(2*V/3),X=.5*Math.sqrt(V*H*(O-H)/O)*(F-O/2<0?-1:1);Mw(u,s,l,Math.max(p,Math.floor(l-F*H/O+X)),Math.min(_,Math.floor(l+(O-F)*H/O+X)),b)}const T=s[2*l+b];let C=p,M=_;for(bm(u,s,p,l),s[2*_+b]>T&&bm(u,s,p,_);C<M;){for(bm(u,s,C,M),C++,M--;s[2*C+b]<T;)C++;for(;s[2*M+b]>T;)M--}s[2*p+b]===T?bm(u,s,p,M):(M++,bm(u,s,M,_)),M<=l&&(p=M+1),l<=M&&(_=M-1)}}function bm(u,s,l,p){sv(u,l,p),sv(s,2*l,2*p),sv(s,2*l+1,2*p+1)}function sv(u,s,l){const p=u[s];u[s]=u[l],u[l]=p}function Rw(u,s,l,p){const _=u-l,b=s-p;return _*_+b*b}var ov;d.cx=void 0,(ov=d.cx||(d.cx={})).create="create",ov.load="load",ov.fullLoad="fullLoad";let Kg=null,wm=[];const av=1e3/60,lv="loadTime",cv="fullLoadTime",dI={mark(u){performance.mark(u)},frame(u){const s=u;Kg!=null&&wm.push(s-Kg),Kg=s},clearMetrics(){Kg=null,wm=[],performance.clearMeasures(lv),performance.clearMeasures(cv);for(const u in d.cx)performance.clearMarks(d.cx[u])},getPerformanceMetrics(){performance.measure(lv,d.cx.create,d.cx.load),performance.measure(cv,d.cx.create,d.cx.fullLoad);const u=performance.getEntriesByName(lv)[0].duration,s=performance.getEntriesByName(cv)[0].duration,l=wm.length,p=1/(wm.reduce(((b,T)=>b+T),0)/l/1e3),_=wm.filter((b=>b>av)).reduce(((b,T)=>b+(T-av)/av),0);return{loadTime:u,fullLoadTime:s,fps:p,percentDroppedFrames:_/(l+_)*100,totalFrames:l}}};d.$=ze,d.A=le,d.B=function([u,s,l]){return s+=90,s*=Math.PI/180,l*=Math.PI/180,{x:u*Math.cos(s)*Math.sin(l),y:u*Math.sin(s)*Math.sin(l),z:u*Math.cos(l)}},d.C=Hs,d.D=jt,d.E=Vt,d.F=Hn,d.G=Wp,d.H=function(u){if(Us==null){const s=u.navigator?u.navigator.userAgent:null;Us=!!u.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Us},d.I=ym,d.J=class{constructor(u,s){this.target=u,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new nI((()=>this.process())),this.subscription=To(this.target,"message",(l=>this.receive(l)),!1),this.globalScope=mn(self)?u:window}registerMessageHandler(u,s){this.messageHandlers[u]=s}sendAsync(u,s){return new Promise(((l,p)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10),b=s?To(s.signal,"abort",(()=>{b?.unsubscribe(),delete this.resolveRejects[_];const M={id:_,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)}),rI):null;this.resolveRejects[_]={resolve:M=>{b?.unsubscribe(),l(M)},reject:M=>{b?.unsubscribe(),p(M)}};const T=[],C=Object.assign(Object.assign({},u),{id:_,sourceMapId:this.mapId,origin:location.origin,data:Ni(u.data,T)});this.target.postMessage(C,{transfer:T})}))}receive(u){const s=u.data,l=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!=="resource://android"&&location.origin!=="resource://android"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[l];const p=this.abortControllers[l];return delete this.abortControllers[l],void(p&&p.abort())}if(mn(self)||s.mustQueue)return this.tasks[l]=s,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,s)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),s=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(u,s)}processTask(u,s){return a(this,void 0,void 0,(function*(){if(s.type==="<response>"){const _=this.resolveRejects[u];return delete this.resolveRejects[u],_?void(s.error?_.reject(Es(s.error)):_.resolve(Es(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=Es(s.data),p=new AbortController;this.abortControllers[u]=p;try{const _=yield this.messageHandlers[s.type](s.sourceMapId,l,p);this.completeTask(u,null,_)}catch(_){this.completeTask(u,_)}}))}completeTask(u,s,l){const p=[];delete this.abortControllers[u];const _={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?Ni(s):null,data:Ni(l,p)};this.target.postMessage(_,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.K=ne,d.L=function(){var u=new le(16);return le!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},d.M=function(u,s,l){var p,_,b,T,C,M,O,F,V,H,X,q,ee=l[0],se=l[1],pe=l[2];return s===u?(u[12]=s[0]*ee+s[4]*se+s[8]*pe+s[12],u[13]=s[1]*ee+s[5]*se+s[9]*pe+s[13],u[14]=s[2]*ee+s[6]*se+s[10]*pe+s[14],u[15]=s[3]*ee+s[7]*se+s[11]*pe+s[15]):(_=s[1],b=s[2],T=s[3],C=s[4],M=s[5],O=s[6],F=s[7],V=s[8],H=s[9],X=s[10],q=s[11],u[0]=p=s[0],u[1]=_,u[2]=b,u[3]=T,u[4]=C,u[5]=M,u[6]=O,u[7]=F,u[8]=V,u[9]=H,u[10]=X,u[11]=q,u[12]=p*ee+C*se+V*pe+s[12],u[13]=_*ee+M*se+H*pe+s[13],u[14]=b*ee+O*se+X*pe+s[14],u[15]=T*ee+F*se+q*pe+s[15]),u},d.N=function(u,s,l){var p=l[0],_=l[1],b=l[2];return u[0]=s[0]*p,u[1]=s[1]*p,u[2]=s[2]*p,u[3]=s[3]*p,u[4]=s[4]*_,u[5]=s[5]*_,u[6]=s[6]*_,u[7]=s[7]*_,u[8]=s[8]*b,u[9]=s[9]*b,u[10]=s[10]*b,u[11]=s[11]*b,u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},d.O=function(u,s,l){var p=s[0],_=s[1],b=s[2],T=s[3],C=s[4],M=s[5],O=s[6],F=s[7],V=s[8],H=s[9],X=s[10],q=s[11],ee=s[12],se=s[13],pe=s[14],Ve=s[15],be=l[0],Ie=l[1],Je=l[2],st=l[3];return u[0]=be*p+Ie*C+Je*V+st*ee,u[1]=be*_+Ie*M+Je*H+st*se,u[2]=be*b+Ie*O+Je*X+st*pe,u[3]=be*T+Ie*F+Je*q+st*Ve,u[4]=(be=l[4])*p+(Ie=l[5])*C+(Je=l[6])*V+(st=l[7])*ee,u[5]=be*_+Ie*M+Je*H+st*se,u[6]=be*b+Ie*O+Je*X+st*pe,u[7]=be*T+Ie*F+Je*q+st*Ve,u[8]=(be=l[8])*p+(Ie=l[9])*C+(Je=l[10])*V+(st=l[11])*ee,u[9]=be*_+Ie*M+Je*H+st*se,u[10]=be*b+Ie*O+Je*X+st*pe,u[11]=be*T+Ie*F+Je*q+st*Ve,u[12]=(be=l[12])*p+(Ie=l[13])*C+(Je=l[14])*V+(st=l[15])*ee,u[13]=be*_+Ie*M+Je*H+st*se,u[14]=be*b+Ie*O+Je*X+st*pe,u[15]=be*T+Ie*F+Je*q+st*Ve,u},d.P=v,d.Q=function(u,s){const l={};for(let p=0;p<s.length;p++){const _=s[p];_ in u&&(l[_]=u[_])}return l},d.R=zt,d.S=hh,d.T=vf,d.U=lw,d.V=aw,d.W=re,d.X=fe,d.Y=Gi,d.Z=Zo,d._=a,d.a=Y,d.a$=on,d.a0=function(u,s){var l,p,_,b,T;if(!u)return s??{};if(!s)return u;let C=Object.assign({},u);if(s.removeAll&&(C={removeAll:!0}),s.remove){const M=new Set(s.remove);C.add&&(C.add=C.add.filter((F=>!M.has(F.id)))),C.update&&(C.update=C.update.filter((F=>!M.has(F.id))));const O=new Set(((l=u.add)!==null&&l!==void 0?l:[]).map((F=>F.id)));s.remove=s.remove.filter((F=>!O.has(F)))}if(s.remove){const M=new Set(C.remove?C.remove.concat(s.remove):s.remove);C.remove=Array.from(M.values())}if(s.add){const M=C.add?C.add.concat(s.add):s.add,O=new Map(M.map((F=>[F.id,F])));C.add=Array.from(O.values())}if(s.update){const M=new Map((p=C.update)===null||p===void 0?void 0:p.map((O=>[O.id,O])));for(const O of s.update){const F=(_=M.get(O.id))!==null&&_!==void 0?_:{id:O.id};O.newGeometry&&(F.newGeometry=O.newGeometry),O.addOrUpdateProperties&&(F.addOrUpdateProperties=((b=F.addOrUpdateProperties)!==null&&b!==void 0?b:[]).concat(O.addOrUpdateProperties)),O.removeProperties&&(F.removeProperties=((T=F.removeProperties)!==null&&T!==void 0?T:[]).concat(O.removeProperties)),O.removeAllProperties&&(F.removeAllProperties=!0),M.set(O.id,F)}C.update=Array.from(M.values())}return C.remove&&C.add&&(C.remove=C.remove.filter((M=>C.add.findIndex((O=>O.id===M))===-1))),C},d.a1=vm,d.a2=xd,d.a3=25,d.a4=ev,d.a5=u=>{const s=window.document.createElement("video");return s.muted=!0,new Promise((l=>{s.onloadstart=()=>{l(s)};for(const p of u){const _=window.document.createElement("source");Ke(p)||(s.crossOrigin="Anonymous"),_.src=p,s.appendChild(_)}}))},d.a6=lt,d.a7=function(){return Bt++},d.a8=ie,d.a9=Bf,d.aA=function(u){let s=1/0,l=1/0,p=-1/0,_=-1/0;for(const b of u)s=Math.min(s,b.x),l=Math.min(l,b.y),p=Math.max(p,b.x),_=Math.max(_,b.y);return[s,l,p,_]},d.aB=ni,d.aC=$e,d.aD=function(u,s,l,p,_=!1){if(!l[0]&&!l[1])return[0,0];const b=_?p==="map"?-u.bearingInRadians:0:p==="viewport"?u.bearingInRadians:0;if(b){const T=Math.sin(b),C=Math.cos(b);l=[l[0]*C-l[1]*T,l[0]*T+l[1]*C]}return[_?l[0]:$e(s,l[0],u.zoom),_?l[1]:$e(s,l[1],u.zoom)]},d.aF=Xn,d.aG=nv,d.aH=Ht,d.aI=rv,d.aJ=Yn,d.aK=ah,d.aL=qe,d.aM=Sn,d.aN=Ir,d.aO=vt,d.aP=So,d.aQ=uw,d.aR=Mt,d.aS=Tt,d.aT=function(u){var s=new le(3);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s},d.aU=function(u,s,l){return u[0]=s[0]-l[0],u[1]=s[1]-l[1],u[2]=s[2]-l[2],u},d.aV=function(u,s){var l=s[0],p=s[1],_=s[2],b=l*l+p*p+_*_;return b>0&&(b=1/Math.sqrt(b)),u[0]=s[0]*b,u[1]=s[1]*b,u[2]=s[2]*b,u},d.aW=Zt,d.aX=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]},d.aY=function(u,s,l){return u[0]=s[0]*l[0],u[1]=s[1]*l[1],u[2]=s[2]*l[2],u[3]=s[3]*l[3],u},d.aZ=pt,d.a_=function(u,s,l){const p=s[0]*l[0]+s[1]*l[1]+s[2]*l[2];return p===0?null:(-(u[0]*l[0]+u[1]*l[1]+u[2]*l[2])-l[3])/p},d.aa=fo,d.ab=ti,d.ac=pw,d.ad=function(u){const s={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((l,p,_,b)=>{const T=_||b;return s[p]=!T||T.toLowerCase(),""})),s["max-age"]){const l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s},d.ae=ea,d.af=function(u){return Math.pow(2,u)},d.ag=Ne,d.ah=ht,d.ai=85.051129,d.aj=cw,d.ak=function(u){return Math.log(u)/Math.LN2},d.al=function(u){var s=u[0],l=u[1];return s*s+l*l},d.am=function(u,s){const l=[];for(const p in u)p in s||l.push(p);return l},d.an=function(u,s){let l=0,p=0;if(u.kind==="constant")p=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:_,minZoom:b,maxZoom:T}=u,C=_?ht(Or.interpolationFactor(_,s,b,T),0,1):0;u.kind==="camera"?p=Hs.number(u.minSize,u.maxSize,C):l=C}return{uSizeT:l,uSize:p}},d.ap=function(u,{uSize:s,uSizeT:l},{lowerSize:p,upperSize:_}){return u.kind==="source"?p/tn:u.kind==="composite"?Hs.number(p/tn,_/tn,l):s},d.aq=function(u,s){var l=s[0],p=s[1],_=s[2],b=s[3],T=s[4],C=s[5],M=s[6],O=s[7],F=s[8],V=s[9],H=s[10],X=s[11],q=s[12],ee=s[13],se=s[14],pe=s[15],Ve=l*C-p*T,be=l*M-_*T,Ie=l*O-b*T,Je=p*M-_*C,st=p*O-b*C,gt=_*O-b*M,Ft=F*ee-V*q,Pt=F*se-H*q,Dt=F*pe-X*q,Yt=V*se-H*ee,Rt=V*pe-X*ee,Ot=H*pe-X*se,ct=Ve*Ot-be*Rt+Ie*Yt+Je*Dt-st*Pt+gt*Ft;return ct?(u[0]=(C*Ot-M*Rt+O*Yt)*(ct=1/ct),u[1]=(_*Rt-p*Ot-b*Yt)*ct,u[2]=(ee*gt-se*st+pe*Je)*ct,u[3]=(H*st-V*gt-X*Je)*ct,u[4]=(M*Dt-T*Ot-O*Pt)*ct,u[5]=(l*Ot-_*Dt+b*Pt)*ct,u[6]=(se*Ie-q*gt-pe*be)*ct,u[7]=(F*gt-H*Ie+X*be)*ct,u[8]=(T*Rt-C*Dt+O*Ft)*ct,u[9]=(p*Dt-l*Rt-b*Ft)*ct,u[10]=(q*st-ee*Ie+pe*Ve)*ct,u[11]=(V*Ie-F*st-X*Ve)*ct,u[12]=(C*Pt-T*Yt-M*Ft)*ct,u[13]=(l*Yt-p*Pt+_*Ft)*ct,u[14]=(ee*be-q*Je-se*Ve)*ct,u[15]=(F*Je-V*be+H*Ve)*ct,u):null},d.ar=Oe,d.as=function(u){var s=u[0],l=u[1];return Math.sqrt(s*s+l*l)},d.at=function(u){return u[0]=0,u[1]=0,u},d.au=function(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u},d.av=qy,d.aw=nn,d.ax=function(u,s,l,p){const _=s.y-u.y,b=s.x-u.x,T=p.y-l.y,C=p.x-l.x,M=T*b-C*_;if(M===0)return null;const O=(C*(u.y-l.y)-T*(u.x-l.x))/M;return new v(u.x+O*b,u.y+O*_)},d.ay=_w,d.az=qp,d.b=ki,d.b$=class extends m{},d.b0=function(u,s,l){return u[0]=s[0]*l,u[1]=s[1]*l,u[2]=s[2]*l,u[3]=s[3]*l,u},d.b1=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]+u[3]},d.b2=dw,d.b3=zf,d.b4=function(u,s,l,p,_){var b=1/Math.tan(s/2);if(u[0]=b/l,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=b,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,_!=null&&_!==1/0){var T=1/(p-_);u[10]=(_+p)*T,u[14]=2*_*p*T}else u[10]=-1,u[14]=-2*p;return u},d.b5=function(u){var s=new le(16);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[4]=u[4],s[5]=u[5],s[6]=u[6],s[7]=u[7],s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},d.b6=function(u,s,l){var p=Math.sin(l),_=Math.cos(l),b=s[0],T=s[1],C=s[2],M=s[3],O=s[4],F=s[5],V=s[6],H=s[7];return s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=b*_+O*p,u[1]=T*_+F*p,u[2]=C*_+V*p,u[3]=M*_+H*p,u[4]=O*_-b*p,u[5]=F*_-T*p,u[6]=V*_-C*p,u[7]=H*_-M*p,u},d.b7=function(u,s,l){var p=Math.sin(l),_=Math.cos(l),b=s[4],T=s[5],C=s[6],M=s[7],O=s[8],F=s[9],V=s[10],H=s[11];return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[4]=b*_+O*p,u[5]=T*_+F*p,u[6]=C*_+V*p,u[7]=M*_+H*p,u[8]=O*_-b*p,u[9]=F*_-T*p,u[10]=V*_-C*p,u[11]=H*_-M*p,u},d.b8=function(){const u=new Float32Array(16);return Ne(u),u},d.b9=function(){const u=new Float64Array(16);return Ne(u),u},d.bA=function(u,s){const l=ue(u,360),p=ue(s,360),_=p-l,b=p>l?_-360:_+360;return Math.abs(_)<Math.abs(b)?_:b},d.bB=function(u){return u[0]=0,u[1]=0,u[2]=0,u},d.bC=function(u,s,l,p){const _=Math.sqrt(u*u+s*s),b=Math.sqrt(l*l+p*p);u/=_,s/=_,l/=b,p/=b;const T=Math.acos(u*l+s*p);return-s*l+u*p>0?T:-T},d.bD=function(u,s){const l=ue(u,2*Math.PI),p=ue(s,2*Math.PI);return Math.min(Math.abs(l-p),Math.abs(l-p+2*Math.PI),Math.abs(l-p-2*Math.PI))},d.bE=function(){const u={},s=Be.$version;for(const l in Be.$root){const p=Be.$root[l];if(p.required){let _=null;_=l==="version"?s:p.type==="array"?[]:{},_!=null&&(u[l]=_)}}return u},d.bF=qu,d.bG=Ce,d.bH=function u(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(let p=0;p<s.length;p++)if(!u(s[p],l[p]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(const p in s)if(!u(s[p],l[p]))return!1;return!0}return s===l},d.bI=function(u){u=u.slice();const s=Object.create(null);for(let l=0;l<u.length;l++)s[u[l].id]=u[l];for(let l=0;l<u.length;l++)"ref"in u[l]&&(u[l]=Mn(u[l],s[u[l].ref]));return u},d.bJ=function(u,s){if(u.type==="custom")return new tI(u,s);switch(u.type){case"background":return new J3(u,s);case"circle":return new Pg(u,s);case"color-relief":return new im(u,s);case"fill":return new _s(u,s);case"fill-extrusion":return new jy(u,s);case"heatmap":return new Eg(u,s);case"hillshade":return new _f(u,s);case"line":return new xo(u,s);case"raster":return new eI(u,s);case"symbol":return new Zg(u,s)}},d.bK=Wn,d.bL=function(u,s){if(!u)return[{command:"setStyle",args:[s]}];let l=[];try{if(!qt(u.version,s.version))return[{command:"setStyle",args:[s]}];qt(u.center,s.center)||l.push({command:"setCenter",args:[s.center]}),qt(u.state,s.state)||l.push({command:"setGlobalState",args:[s.state]}),qt(u.centerAltitude,s.centerAltitude)||l.push({command:"setCenterAltitude",args:[s.centerAltitude]}),qt(u.zoom,s.zoom)||l.push({command:"setZoom",args:[s.zoom]}),qt(u.bearing,s.bearing)||l.push({command:"setBearing",args:[s.bearing]}),qt(u.pitch,s.pitch)||l.push({command:"setPitch",args:[s.pitch]}),qt(u.roll,s.roll)||l.push({command:"setRoll",args:[s.roll]}),qt(u.sprite,s.sprite)||l.push({command:"setSprite",args:[s.sprite]}),qt(u.glyphs,s.glyphs)||l.push({command:"setGlyphs",args:[s.glyphs]}),qt(u.transition,s.transition)||l.push({command:"setTransition",args:[s.transition]}),qt(u.light,s.light)||l.push({command:"setLight",args:[s.light]}),qt(u.terrain,s.terrain)||l.push({command:"setTerrain",args:[s.terrain]}),qt(u.sky,s.sky)||l.push({command:"setSky",args:[s.sky]}),qt(u.projection,s.projection)||l.push({command:"setProjection",args:[s.projection]});const p={},_=[];(function(T,C,M,O){let F;for(F in C=C||{},T=T||{})Object.prototype.hasOwnProperty.call(T,F)&&(Object.prototype.hasOwnProperty.call(C,F)||Tr(F,M,O));for(F in C)Object.prototype.hasOwnProperty.call(C,F)&&(Object.prototype.hasOwnProperty.call(T,F)?qt(T[F],C[F])||(T[F].type==="geojson"&&C[F].type==="geojson"&&Sr(T,C,F)?_n(M,{command:"setGeoJSONSourceData",args:[F,C[F].data]}):zr(F,C,M,O)):sr(F,C,M))})(u.sources,s.sources,_,p);const b=[];u.layers&&u.layers.forEach((T=>{"source"in T&&p[T.source]?l.push({command:"removeLayer",args:[T.id]}):b.push(T)})),l=l.concat(_),(function(T,C,M){C=C||[];const O=(T=T||[]).map(Gn),F=C.map(Gn),V=T.reduce(kr,{}),H=C.reduce(kr,{}),X=O.slice(),q=Object.create(null);let ee,se,pe,Ve,be;for(let Ie=0,Je=0;Ie<O.length;Ie++)ee=O[Ie],Object.prototype.hasOwnProperty.call(H,ee)?Je++:(_n(M,{command:"removeLayer",args:[ee]}),X.splice(X.indexOf(ee,Je),1));for(let Ie=0,Je=0;Ie<F.length;Ie++)ee=F[F.length-1-Ie],X[X.length-1-Ie]!==ee&&(Object.prototype.hasOwnProperty.call(V,ee)?(_n(M,{command:"removeLayer",args:[ee]}),X.splice(X.lastIndexOf(ee,X.length-Je),1)):Je++,Ve=X[X.length-Ie],_n(M,{command:"addLayer",args:[H[ee],Ve]}),X.splice(X.length-Ie,0,ee),q[ee]=!0);for(let Ie=0;Ie<F.length;Ie++)if(ee=F[Ie],se=V[ee],pe=H[ee],!q[ee]&&!qt(se,pe))if(qt(se.source,pe.source)&&qt(se["source-layer"],pe["source-layer"])&&qt(se.type,pe.type)){for(be in Rr(se.layout,pe.layout,M,ee,null,"setLayoutProperty"),Rr(se.paint,pe.paint,M,ee,null,"setPaintProperty"),qt(se.filter,pe.filter)||_n(M,{command:"setFilter",args:[ee,pe.filter]}),qt(se.minzoom,pe.minzoom)&&qt(se.maxzoom,pe.maxzoom)||_n(M,{command:"setLayerZoomRange",args:[ee,pe.minzoom,pe.maxzoom]}),se)Object.prototype.hasOwnProperty.call(se,be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Rr(se[be],pe[be],M,ee,be.slice(6),"setPaintProperty"):qt(se[be],pe[be])||_n(M,{command:"setLayerProperty",args:[ee,be,pe[be]]}));for(be in pe)Object.prototype.hasOwnProperty.call(pe,be)&&!Object.prototype.hasOwnProperty.call(se,be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Rr(se[be],pe[be],M,ee,be.slice(6),"setPaintProperty"):qt(se[be],pe[be])||_n(M,{command:"setLayerProperty",args:[ee,be,pe[be]]}))}else _n(M,{command:"removeLayer",args:[ee]}),Ve=X[X.lastIndexOf(ee)+1],_n(M,{command:"addLayer",args:[pe,Ve]})})(b,s.layers,l)}catch(p){console.warn("Unable to compute style diff:",p),l=[{command:"setStyle",args:[s]}]}return l},d.bM=function(u){const s=[],l=u.id;return l===void 0&&s.push({message:`layers.${l}: missing required property "id"`}),u.render===void 0&&s.push({message:`layers.${l}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&s.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),s},d.bN=Wt,d.bO=jn,d.bP=class extends pr{constructor(u,s){super(u,s),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},d.bQ=Ms,d.bR=class extends pr{constructor(u,s){super(u,s),this.current=ld}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let s=1;s<16;s++)if(u[s]!==this.current[s]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},d.bS=lf,d.bT=class extends pr{constructor(u,s){super(u,s),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},d.bU=class extends pr{constructor(u,s){super(u,s),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},d.bV=Se,d.bW=function(u,s){var l=Math.sin(s),p=Math.cos(s);return u[0]=p,u[1]=l,u[2]=0,u[3]=-l,u[4]=p,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},d.bX=function(u,s,l){var p=s[0],_=s[1],b=s[2];return u[0]=p*l[0]+_*l[3]+b*l[6],u[1]=p*l[1]+_*l[4]+b*l[7],u[2]=p*l[2]+_*l[5]+b*l[8],u},d.bY=function(u,s,l,p,_,b,T){var C=1/(s-l),M=1/(p-_),O=1/(b-T);return u[0]=-2*C,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*M,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*O,u[11]=0,u[12]=(s+l)*C,u[13]=(_+p)*M,u[14]=(T+b)*O,u[15]=1,u},d.bZ=class extends pr{constructor(u,s){super(u,s),this.current=new Array}set(u){if(u!=this.current){this.current=u;const s=new Float32Array(4*u.length);for(let l=0;l<u.length;l++)s[4*l]=u[l].r,s[4*l+1]=u[l].g,s[4*l+2]=u[l].b,s[4*l+3]=u[l].a;this.gl.uniform4fv(this.location,s)}}},d.b_=class extends pr{constructor(u,s){super(u,s),this.current=new Array}set(u){if(u!=this.current){this.current=u;const s=new Float32Array(u);this.gl.uniform1fv(this.location,s)}}},d.ba=function(){return new Float64Array(16)},d.bb=function(u,s,l){const p=new Float64Array(4);return Ee(p,u,s-90,l),p},d.bc=function(u,s,l,p){var _,b,T,C,M,O=s[0],F=s[1],V=s[2],H=s[3],X=l[0],q=l[1],ee=l[2],se=l[3];return(b=O*X+F*q+V*ee+H*se)<0&&(b=-b,X=-X,q=-q,ee=-ee,se=-se),1-b>ve?(_=Math.acos(b),T=Math.sin(_),C=Math.sin((1-p)*_)/T,M=Math.sin(p*_)/T):(C=1-p,M=p),u[0]=C*O+M*X,u[1]=C*F+M*q,u[2]=C*V+M*ee,u[3]=C*H+M*se,u},d.bd=function(u){const s=new Float64Array(9);var l,p,_,b,T,C,M,O,F,V,H,X,q,ee,se,pe,Ve,be;V=(_=(p=u)[0])*(M=_+_),H=(b=p[1])*M,q=(T=p[2])*M,ee=T*(O=b+b),pe=(C=p[3])*M,Ve=C*O,be=C*(F=T+T),(l=s)[0]=1-(X=b*O)-(se=T*F),l[3]=H-be,l[6]=q+Ve,l[1]=H+be,l[4]=1-V-se,l[7]=ee-pe,l[2]=q-Ve,l[5]=ee+pe,l[8]=1-V-X;const Ie=So(-Math.asin(ht(s[2],-1,1)));let Je,st;return Math.hypot(s[5],s[8])<.001?(Je=0,st=-So(Math.atan2(s[3],s[4]))):(Je=So(s[5]===0&&s[8]===0?0:Math.atan2(s[5],s[8])),st=So(s[1]===0&&s[0]===0?0:Math.atan2(s[1],s[0]))),{roll:Je,pitch:Ie+90,bearing:st}},d.be=function(u,s){return u.roll==s.roll&&u.pitch==s.pitch&&u.bearing==s.bearing},d.bf=Tn,d.bg=nh,d.bh=Wo,d.bi=eo,d.bj=ui,d.bk=De,d.bl=dt,d.bm=li,d.bn=function(u,s,l,p,_){return De(p,_,ht((u-s)/(l-s),0,1))},d.bo=ue,d.bp=function(){return new Float64Array(3)},d.bq=function(u,s,l,p){return u[0]=s[0]+l[0]*p,u[1]=s[1]+l[1]*p,u[2]=s[2]+l[2]*p,u},d.br=Ee,d.bs=function(u,s,l){var p=l[0],_=l[1],b=l[2],T=l[3],C=s[0],M=s[1],O=s[2],F=_*O-b*M,V=b*C-p*O,H=p*M-_*C;return u[0]=C+T*(F+=F)+_*(H+=H)-b*(V+=V),u[1]=M+T*V+b*F-p*H,u[2]=O+T*H+p*V-_*F,u},d.bt=function(u,s,l){const p=(_=[u[0],u[1],u[2],s[0],s[1],s[2],l[0],l[1],l[2]])[0]*((F=_[8])*(T=_[4])-(C=_[5])*(O=_[7]))+_[1]*(-F*(b=_[3])+C*(M=_[6]))+_[2]*(O*b-T*M);var _,b,T,C,M,O,F;if(p===0)return null;const V=Zt([],[s[0],s[1],s[2]],[l[0],l[1],l[2]]),H=Zt([],[l[0],l[1],l[2]],[u[0],u[1],u[2]]),X=Zt([],[u[0],u[1],u[2]],[s[0],s[1],s[2]]),q=Mt([],V,-u[3]);return Tt(q,q,Mt([],H,-s[3])),Tt(q,q,Mt([],X,-l[3])),Mt(q,q,1/p),q},d.bu=Jy,d.bv=function(){return new Float64Array(4)},d.bw=function(u,s,l,p){var _=[],b=[];return _[0]=s[0]-l[0],_[1]=s[1]-l[1],_[2]=s[2]-l[2],b[0]=_[0]*Math.cos(p)-_[1]*Math.sin(p),b[1]=_[0]*Math.sin(p)+_[1]*Math.cos(p),b[2]=_[2],u[0]=b[0]+l[0],u[1]=b[1]+l[1],u[2]=b[2]+l[2],u},d.bx=function(u,s,l,p){var _=[],b=[];return _[0]=s[0]-l[0],_[1]=s[1]-l[1],_[2]=s[2]-l[2],b[0]=_[0],b[1]=_[1]*Math.cos(p)-_[2]*Math.sin(p),b[2]=_[1]*Math.sin(p)+_[2]*Math.cos(p),u[0]=b[0]+l[0],u[1]=b[1]+l[1],u[2]=b[2]+l[2],u},d.by=function(u,s,l,p){var _=[],b=[];return _[0]=s[0]-l[0],_[1]=s[1]-l[1],_[2]=s[2]-l[2],b[0]=_[2]*Math.sin(p)+_[0]*Math.cos(p),b[1]=_[1],b[2]=_[2]*Math.cos(p)-_[0]*Math.sin(p),u[0]=b[0]+l[0],u[1]=b[1]+l[1],u[2]=b[2]+l[2],u},d.bz=function(u,s,l){var p=Math.sin(l),_=Math.cos(l),b=s[0],T=s[1],C=s[2],M=s[3],O=s[8],F=s[9],V=s[10],H=s[11];return s!==u&&(u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=b*_-O*p,u[1]=T*_-F*p,u[2]=C*_-V*p,u[3]=M*_-H*p,u[8]=b*p+O*_,u[9]=T*p+F*_,u[10]=C*p+V*_,u[11]=M*p+H*_,u},d.c=Le,d.c0=kf,d.c1=class extends w{},d.c2=dd,d.c3=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},d.c4=fu,d.c5=function(u,s,l){var p=s[0],_=s[1],b=s[2],T=l[3]*p+l[7]*_+l[11]*b+l[15];return u[0]=(l[0]*p+l[4]*_+l[8]*b+l[12])/(T=T||1),u[1]=(l[1]*p+l[5]*_+l[9]*b+l[13])/T,u[2]=(l[2]*p+l[6]*_+l[10]*b+l[14])/T,u},d.c6=class extends Qi{},d.c7=class extends ${},d.c8=function(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]&&u[3]===s[3]&&u[4]===s[4]&&u[5]===s[5]&&u[6]===s[6]&&u[7]===s[7]&&u[8]===s[8]&&u[9]===s[9]&&u[10]===s[10]&&u[11]===s[11]&&u[12]===s[12]&&u[13]===s[13]&&u[14]===s[14]&&u[15]===s[15]},d.c9=function(u,s){var l=u[0],p=u[1],_=u[2],b=u[3],T=u[4],C=u[5],M=u[6],O=u[7],F=u[8],V=u[9],H=u[10],X=u[11],q=u[12],ee=u[13],se=u[14],pe=u[15],Ve=s[0],be=s[1],Ie=s[2],Je=s[3],st=s[4],gt=s[5],Ft=s[6],Pt=s[7],Dt=s[8],Yt=s[9],Rt=s[10],Ot=s[11],ct=s[12],sn=s[13],fn=s[14],en=s[15];return Math.abs(l-Ve)<=ve*Math.max(1,Math.abs(l),Math.abs(Ve))&&Math.abs(p-be)<=ve*Math.max(1,Math.abs(p),Math.abs(be))&&Math.abs(_-Ie)<=ve*Math.max(1,Math.abs(_),Math.abs(Ie))&&Math.abs(b-Je)<=ve*Math.max(1,Math.abs(b),Math.abs(Je))&&Math.abs(T-st)<=ve*Math.max(1,Math.abs(T),Math.abs(st))&&Math.abs(C-gt)<=ve*Math.max(1,Math.abs(C),Math.abs(gt))&&Math.abs(M-Ft)<=ve*Math.max(1,Math.abs(M),Math.abs(Ft))&&Math.abs(O-Pt)<=ve*Math.max(1,Math.abs(O),Math.abs(Pt))&&Math.abs(F-Dt)<=ve*Math.max(1,Math.abs(F),Math.abs(Dt))&&Math.abs(V-Yt)<=ve*Math.max(1,Math.abs(V),Math.abs(Yt))&&Math.abs(H-Rt)<=ve*Math.max(1,Math.abs(H),Math.abs(Rt))&&Math.abs(X-Ot)<=ve*Math.max(1,Math.abs(X),Math.abs(Ot))&&Math.abs(q-ct)<=ve*Math.max(1,Math.abs(q),Math.abs(ct))&&Math.abs(ee-sn)<=ve*Math.max(1,Math.abs(ee),Math.abs(sn))&&Math.abs(se-fn)<=ve*Math.max(1,Math.abs(se),Math.abs(fn))&&Math.abs(pe-en)<=ve*Math.max(1,Math.abs(pe),Math.abs(en))},d.cA=function(u,s){Y.REGISTERED_PROTOCOLS[u]=s},d.cB=function(u){delete Y.REGISTERED_PROTOCOLS[u]},d.cC=function(u,s){const l={};for(let _=0;_<u.length;_++){const b=s&&s[u[_].id]||Zu(u[_]);s&&(s[u[_].id]=b);let T=l[b];T||(T=l[b]=[]),T.push(u[_])}const p=[];for(const _ in l)p.push(l[_]);return p},d.cD=It,d.cE=fw,d.cF=mw,d.cG=vd,d.cH=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=ze/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const s=u.bucket.layers[0],l=s.layout,p=s._unevaluatedLayout._values,_={layoutIconSize:p["icon-size"].possiblyEvaluate(new Hn(u.bucket.zoom+1),u.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Hn(u.bucket.zoom+1),u.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Hn(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:F}=u.bucket.textSizeData;_.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Hn(O),u.canonical),p["text-size"].possiblyEvaluate(new Hn(F),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:F}=u.bucket.iconSizeData;_.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Hn(O),u.canonical),p["icon-size"].possiblyEvaluate(new Hn(F),u.canonical)]}const b=l.get("text-line-height")*ni,T=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",C=l.get("text-keep-upright"),M=l.get("text-size");for(const O of u.bucket.features){const F=l.get("text-font").evaluate(O,{},u.canonical).join(","),V=M.evaluate(O,{},u.canonical),H=_.layoutTextSize.evaluate(O,{},u.canonical),X=_.layoutIconSize.evaluate(O,{},u.canonical),q={horizontal:{},vertical:void 0},ee=O.text;let se,pe=[0,0];if(ee){const Ie=ee.toString(),Je=l.get("text-letter-spacing").evaluate(O,{},u.canonical)*ni,st=Ji(Ie)?Je:0,gt=l.get("text-anchor").evaluate(O,{},u.canonical),Ft=Pw(s,O,u.canonical);if(!Ft){const Rt=l.get("text-radial-offset").evaluate(O,{},u.canonical);pe=Rt?Aw(gt,[Rt*ni,tv]):l.get("text-offset").evaluate(O,{},u.canonical).map((Ot=>Ot*ni))}let Pt=T?"center":l.get("text-justify").evaluate(O,{},u.canonical);const Dt=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(O,{},u.canonical)*ni:1/0,Yt=()=>{u.bucket.allowVerticalPlacement&&su(Ie)&&(q.vertical=I(ee,u.glyphMap,u.glyphPositions,u.imagePositions,F,Dt,b,gt,"left",st,pe,d.ao.vertical,!0,H,V))};if(!T&&Ft){const Rt=new Set;if(Pt==="auto")for(let ct=0;ct<Ft.values.length;ct+=2)Rt.add(nv(Ft.values[ct]));else Rt.add(Pt);let Ot=!1;for(const ct of Rt)if(!q.horizontal[ct])if(Ot)q.horizontal[ct]=q.horizontal[0];else{const sn=I(ee,u.glyphMap,u.glyphPositions,u.imagePositions,F,Dt,b,"center",ct,st,pe,d.ao.horizontal,!1,H,V);sn&&(q.horizontal[ct]=sn,Ot=sn.positionedLines.length===1)}Yt()}else{Pt==="auto"&&(Pt=nv(gt));const Rt=I(ee,u.glyphMap,u.glyphPositions,u.imagePositions,F,Dt,b,gt,Pt,st,pe,d.ao.horizontal,!1,H,V);Rt&&(q.horizontal[Pt]=Rt),Yt(),su(Ie)&&T&&C&&(q.vertical=I(ee,u.glyphMap,u.glyphPositions,u.imagePositions,F,Dt,b,gt,Pt,st,pe,d.ao.vertical,!1,H,V))}}let Ve=!1;if(O.icon&&O.icon.name){const Ie=u.imageMap[O.icon.name];Ie&&(se=Nt(u.imagePositions[O.icon.name],l.get("icon-offset").evaluate(O,{},u.canonical),l.get("icon-anchor").evaluate(O,{},u.canonical)),Ve=!!Ie.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Ve:u.bucket.sdfIcons!==Ve&&Jn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ie.pixelRatio!==u.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const be=Cw(q.horizontal)||q.vertical;u.bucket.iconsInText=!!be&&be.iconsInText,(be||se)&&uI(u.bucket,O,q,se,u.imageMap,_,H,X,pe,Ve,u.canonical,u.subdivisionGranularity)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},d.cI=gu,d.cJ=gl,d.cK=Cf,d.cL=cm,d.cM=Df,d.cN=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},d.cO=function(u,s,l,p,_){return a(this,void 0,void 0,(function*(){if(fe())try{return yield Gi(u,s,l,p,_)}catch{}return(function(b,T,C,M,O){const F=b.width,V=b.height;mi&&bs||(mi=new OffscreenCanvas(F,V),bs=mi.getContext("2d",{willReadFrequently:!0})),mi.width=F,mi.height=V,bs.drawImage(b,0,0,F,V);const H=bs.getImageData(T,C,M,O);return bs.clearRect(0,0,F,V),H.data})(u,s,l,p,_)}))},d.cP=rm,d.cQ=A,d.cR=Og,d.cS=_u,d.cT=Gl,d.cU=function(u,s){const l=new Map;if(u!=null)if(u.type==="Feature")l.set(xm(u,s),u);else for(const p of u.features)l.set(xm(p,s),p);return l},d.cV=function(u,s){if(u==null)return!0;if(u.type==="Feature")return xm(u,s)!=null;if(u.type==="FeatureCollection"){const l=new Set;for(const p of u.features){const _=xm(p,s);if(_==null||l.has(_))return!1;l.add(_)}return!0}return!1},d.cW=function(u,s,l){var p,_,b,T;if(s.removeAll&&u.clear(),s.remove)for(const C of s.remove)u.delete(C);if(s.add)for(const C of s.add){const M=xm(C,l);M!=null&&u.set(M,C)}if(s.update)for(const C of s.update){let M=u.get(C.id);if(M==null)continue;const O=!C.removeAllProperties&&(((p=C.removeProperties)===null||p===void 0?void 0:p.length)>0||((_=C.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0);if((C.newGeometry||C.removeAllProperties||O)&&(M=Object.assign({},M),u.set(C.id,M),O&&(M.properties=Object.assign({},M.properties))),C.newGeometry&&(M.geometry=C.newGeometry),C.removeAllProperties)M.properties={};else if(((b=C.removeProperties)===null||b===void 0?void 0:b.length)>0)for(const F of C.removeProperties)Object.prototype.hasOwnProperty.call(M.properties,F)&&delete M.properties[F];if(((T=C.addOrUpdateProperties)===null||T===void 0?void 0:T.length)>0)for(const{key:F,value:V}of C.addOrUpdateProperties)M.properties[F]=V}},d.cX=fs,d.ca=function(u,s){return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},d.cb=u=>u.type==="symbol",d.cc=u=>u.type==="circle",d.cd=u=>u.type==="heatmap",d.ce=u=>u.type==="line",d.cf=u=>u.type==="fill",d.cg=u=>u.type==="fill-extrusion",d.ch=u=>u.type==="hillshade",d.ci=u=>u.type==="color-relief",d.cj=u=>u.type==="raster",d.ck=u=>u.type==="background",d.cl=u=>u.type==="custom",d.cm=Et,d.cn=function(u,s,l){const p=me(s.x-l.x,s.y-l.y),_=me(u.x-l.x,u.y-l.y);var b,T;return So(Math.atan2(p[0]*_[1]-p[1]*_[0],(b=p)[0]*(T=_)[0]+b[1]*T[1]))},d.co=kt,d.cp=function(u,s){return so[s]&&(u instanceof MouseEvent||u instanceof WheelEvent)},d.cq=function(u,s){return Ao[s]&&"touches"in u},d.cr=function(u){return Ao[u]||so[u]},d.cs=function(u,s,l){var p=s[0],_=s[1];return u[0]=l[0]*p+l[4]*_+l[12],u[1]=l[1]*p+l[5]*_+l[13],u},d.ct=function(u,s){const{x:l,y:p}=vm.fromLngLat(s);return!(u<0||u>25||p<0||p>=1||l<0||l>=1)},d.cu=function(u,s){return u[0]=s[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=s[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=s[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},d.cv=class extends zi{},d.cw=dI,d.cy=function(u){return u.message===Po},d.cz=xe,d.d=Ke,d.e=ut,d.f=u=>a(void 0,void 0,void 0,(function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(s)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),d.g=K,d.h=u=>new Promise(((s,l)=>{const p=new Image;p.onload=()=>{s(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame((()=>{p.src=Di}))},p.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(u)],{type:"image/png"});p.src=u.byteLength?URL.createObjectURL(_):Di})),d.i=mn,d.j=(u,s)=>Fe(ut(u,{type:"json"}),s),d.k=at,d.l=yt,d.m=Fe,d.n=(u,s)=>Fe(ut(u,{type:"arrayBuffer"}),s),d.o=function(u){return new Df(u).readFields(Zy,[])},d.p=uh,d.q=hd,d.r=Lr,d.s=To,d.t=Ju,d.u=In,d.v=Be,d.w=Jn,d.x=ec,d.y=rl,d.z=ya})),o("worker",["./shared"],(function(d){class a{constructor(Y,K){this.keyCache={},Y&&this.replace(Y,K)}replace(Y,K){this._layerConfigs={},this._layers={},this.update(Y,[],K)}update(Y,K,ne){for(const Ce of Y){this._layerConfigs[Ce.id]=Ce;const Fe=this._layers[Ce.id]=d.bJ(Ce,ne);Fe._featureFilter=d.aa(Fe.filter,ne),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id]}for(const Ce of K)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const xe=d.cC(Object.values(this._layerConfigs),this.keyCache);for(const Ce of xe){const Fe=Ce.map((Vt=>this._layers[Vt.id])),Ke=Fe[0];if(Ke.visibility==="none")continue;const Ue=Ke.source||"";let it=this.familiesBySource[Ue];it||(it=this.familiesBySource[Ue]={});const yt=Ke.sourceLayer||"_geojsonTileLayer";let at=it[yt];at||(at=it[yt]=[]),at.push(Fe)}}}class v{constructor(Y){const K={},ne=[];for(const Ke in Y){const Ue=Y[Ke],it=K[Ke]={};for(const yt in Ue){const at=Ue[+yt];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const Vt={x:0,y:0,w:at.bitmap.width+2,h:at.bitmap.height+2};ne.push(Vt),it[yt]={rect:Vt,metrics:at.metrics}}}const{w:xe,h:Ce}=d.p(ne),Fe=new d.q({width:xe||1,height:Ce||1});for(const Ke in Y){const Ue=Y[Ke];for(const it in Ue){const yt=Ue[+it];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const at=K[Ke][it].rect;d.q.copy(yt.bitmap,Fe,{x:0,y:0},{x:at.x+1,y:at.y+1},yt.bitmap)}}this.image=Fe,this.positions=K}}d.cD("GlyphAtlas",v);class A{constructor(Y){this.tileID=new d.Z(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId,this.inFlightDependencies=[]}parse(Y,K,ne,xe,Ce){return d._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Y,this.collisionBoxArray=new d.a8;const Fe=new d.cE(Object.keys(Y.layers).sort()),Ke=new d.cF(this.tileID,this.promoteId);Ke.bucketLayerIDs=[];const Ue={},it={featureIndex:Ke,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ne,subdivisionGranularity:Ce},yt=K.familiesBySource[this.source];for(const lt in yt){const yr=Y.layers[lt];if(!yr)continue;yr.version===1&&d.w(`Vector tile source "${this.source}" layer "${lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const gi=Fe.encode(lt),Eo=[];for(let _i=0;_i<yr.length;_i++){const St=yr.feature(_i),bn=Ke.getId(St,lt);Eo.push({feature:St,id:bn,index:_i,sourceLayerIndex:gi})}for(const _i of yt[lt]){const St=_i[0];St.source!==this.source&&d.w(`layer.source = ${St.source} does not equal this.source = ${this.source}`),St.minzoom&&this.zoom<Math.floor(St.minzoom)||St.maxzoom&&this.zoom>=St.maxzoom||St.visibility!=="none"&&(P(_i,this.zoom,ne),(Ue[St.id]=St.createBucket({index:Ke.bucketLayerIDs.length,layers:_i,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:gi,sourceID:this.source})).populate(Eo,it,this.tileID.canonical),Ke.bucketLayerIDs.push(_i.map((bn=>bn.id))))}}const at=d.bN(it.glyphDependencies,(lt=>Object.keys(lt).map(Number)));this.inFlightDependencies.forEach((lt=>lt?.abort())),this.inFlightDependencies=[];let Vt=Promise.resolve({});if(Object.keys(at).length){const lt=new AbortController;this.inFlightDependencies.push(lt),Vt=xe.sendAsync({type:"GG",data:{stacks:at,source:this.source,tileID:this.tileID,type:"glyphs"}},lt)}const Be=Object.keys(it.iconDependencies);let ln=Promise.resolve({});if(Be.length){const lt=new AbortController;this.inFlightDependencies.push(lt),ln=xe.sendAsync({type:"GI",data:{icons:Be,source:this.source,tileID:this.tileID,type:"icons"}},lt)}const Mn=Object.keys(it.patternDependencies);let qt=Promise.resolve({});if(Mn.length){const lt=new AbortController;this.inFlightDependencies.push(lt),qt=xe.sendAsync({type:"GI",data:{icons:Mn,source:this.source,tileID:this.tileID,type:"patterns"}},lt)}const _n=it.dashDependencies;let sr=Promise.resolve({});if(Object.keys(_n).length){const lt=new AbortController;this.inFlightDependencies.push(lt),sr=xe.sendAsync({type:"GDA",data:{dashes:_n}},lt)}const[Tr,zr,Sr,Rr]=yield Promise.all([Vt,ln,qt,sr]),Gn=new v(Tr),kr=new d.cG(zr,Sr);for(const lt in Ue){const yr=Ue[lt];yr instanceof d.a9?(P(yr.layers,this.zoom,ne),d.cH({bucket:yr,glyphMap:Tr,glyphPositions:Gn.positions,imageMap:zr,imagePositions:kr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:it.subdivisionGranularity})):yr.hasDependencies&&(yr instanceof d.cI||yr instanceof d.cJ||yr instanceof d.cK)&&(P(yr.layers,this.zoom,ne),yr.addFeatures(it,this.tileID.canonical,kr.patternPositions,Rr))}return this.status="done",{buckets:Object.values(Ue).filter((lt=>!lt.isEmpty())),featureIndex:Ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gn.image,imageAtlas:kr,dashPositions:Rr,glyphMap:this.returnDependencies?Tr:null,iconMap:this.returnDependencies?zr:null,glyphPositions:this.returnDependencies?Gn.positions:null}}))}}function P(Le,Y,K){const ne=new d.F(Y);for(const xe of Le)xe.recalculate(ne,K)}class k{constructor(Y,K,ne){this.actor=Y,this.layerIndex=K,this.availableImages=ne,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Y,K){return d._(this,void 0,void 0,(function*(){const ne=yield d.n(Y.request,K);try{return{vectorTile:new d.cL(new d.cM(ne.data)),rawData:ne.data,cacheControl:ne.cacheControl,expires:ne.expires}}catch(xe){const Ce=new Uint8Array(ne.data);let Fe=`Unable to parse the tile at ${Y.request.url}, `;throw Fe+=Ce[0]===31&&Ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${xe.message}`,new Error(Fe)}}))}loadTile(Y){return d._(this,void 0,void 0,(function*(){const K=Y.uid,ne=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new d.cN(Y.request),xe=new A(Y);this.loading[K]=xe;const Ce=new AbortController;xe.abort=Ce;try{const Fe=yield this.loadVectorTile(Y,Ce);if(delete this.loading[K],!Fe)return null;const Ke=Fe.rawData,Ue={};Fe.expires&&(Ue.expires=Fe.expires),Fe.cacheControl&&(Ue.cacheControl=Fe.cacheControl);const it={};if(ne){const at=ne.finish();at&&(it.resourceTiming=JSON.parse(JSON.stringify(at)))}xe.vectorTile=Fe.vectorTile;const yt=xe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity);this.loaded[K]=xe,this.fetching[K]={rawTileData:Ke,cacheControl:Ue,resourceTiming:it};try{const at=yield yt;return d.e({rawTileData:Ke.slice(0)},at,Ue,it)}finally{delete this.fetching[K]}}catch(Fe){throw delete this.loading[K],xe.status="done",this.loaded[K]=xe,Fe}}))}reloadTile(Y){return d._(this,void 0,void 0,(function*(){const K=Y.uid;if(!this.loaded||!this.loaded[K])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ne=this.loaded[K];if(ne.showCollisionBoxes=Y.showCollisionBoxes,ne.status==="parsing"){const xe=yield ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity);let Ce;if(this.fetching[K]){const{rawTileData:Fe,cacheControl:Ke,resourceTiming:Ue}=this.fetching[K];delete this.fetching[K],Ce=d.e({rawTileData:Fe.slice(0)},xe,Ke,Ue)}else Ce=xe;return Ce}if(ne.status==="done"&&ne.vectorTile)return ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity)}))}abortTile(Y){return d._(this,void 0,void 0,(function*(){const K=this.loading,ne=Y.uid;K&&K[ne]&&K[ne].abort&&(K[ne].abort.abort(),delete K[ne])}))}removeTile(Y){return d._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Y.uid]&&delete this.loaded[Y.uid]}))}}class L{constructor(){this.loaded={}}loadTile(Y){return d._(this,void 0,void 0,(function*(){const{uid:K,encoding:ne,rawImageData:xe,redFactor:Ce,greenFactor:Fe,blueFactor:Ke,baseShift:Ue}=Y,it=xe.width+2,yt=xe.height+2,at=d.b(xe)?new d.R({width:it,height:yt},yield d.cO(xe,-1,-1,it,yt)):xe,Vt=new d.cP(K,at,ne,Ce,Fe,Ke,Ue);return this.loaded=this.loaded||{},this.loaded[K]=Vt,Vt}))}removeTile(Y){const K=this.loaded,ne=Y.uid;K&&K[ne]&&delete K[ne]}}var z,G,te=(function(){if(G)return z;function Le(K,ne){if(K.length!==0){Y(K[0],ne);for(var xe=1;xe<K.length;xe++)Y(K[xe],!ne)}}function Y(K,ne){for(var xe=0,Ce=0,Fe=0,Ke=K.length,Ue=Ke-1;Fe<Ke;Ue=Fe++){var it=(K[Fe][0]-K[Ue][0])*(K[Ue][1]+K[Fe][1]),yt=xe+it;Ce+=Math.abs(xe)>=Math.abs(it)?xe-yt+it:it-yt+xe,xe=yt}xe+Ce>=0!=!!ne&&K.reverse()}return G=1,z=function K(ne,xe){var Ce,Fe=ne&&ne.type;if(Fe==="FeatureCollection")for(Ce=0;Ce<ne.features.length;Ce++)K(ne.features[Ce],xe);else if(Fe==="GeometryCollection")for(Ce=0;Ce<ne.geometries.length;Ce++)K(ne.geometries[Ce],xe);else if(Fe==="Feature")K(ne.geometry,xe);else if(Fe==="Polygon")Le(ne.coordinates,xe);else if(Fe==="MultiPolygon")for(Ce=0;Ce<ne.coordinates.length;Ce++)Le(ne.coordinates[Ce],xe);return ne}})(),re=d.cQ(te);class fe extends d.cS{constructor(Y,K){super(new d.cM,0,K,[],[]),this.feature=Y,this.type=Y.type,this.properties=Y.tags?Y.tags:{},"id"in Y&&(typeof Y.id=="string"?this.id=parseInt(Y.id,10):typeof Y.id!="number"||isNaN(Y.id)||(this.id=Y.id))}loadGeometry(){const Y=[],K=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const ne of K){const xe=[];for(const Ce of ne)xe.push(new d.P(Ce[0],Ce[1]));Y.push(xe)}return Y}}class ve extends d.cR{constructor(Y,K){super(new d.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=K?K.version:1,this.extent=K?K.extent:4096,this.length=Y.length,this.features=Y}feature(Y){return new fe(this.features[Y],this.extent)}}function le(Le,Y){Y.writeVarintField(15,Le.version||1),Y.writeStringField(1,Le.name||""),Y.writeVarintField(5,Le.extent||4096);const K={keys:[],values:[],keycache:{},valuecache:{}};for(let Ce=0;Ce<Le.length;Ce++)K.feature=Le.feature(Ce),Y.writeMessage(2,Se,K);const ne=K.keys;for(const Ce of ne)Y.writeStringField(3,Ce);const xe=K.values;for(const Ce of xe)Y.writeMessage(4,Tt,Ce)}function Se(Le,Y){if(!Le.feature)return;const K=Le.feature;K.id!==void 0&&Y.writeVarintField(1,K.id),Y.writeMessage(2,Ne,Le),Y.writeVarintField(3,K.type),Y.writeMessage(4,mt,K)}function Ne(Le,Y){for(const K in Le.feature?.properties){let ne=Le.feature.properties[K],xe=Le.keycache[K];if(ne===null)continue;xe===void 0&&(Le.keys.push(K),xe=Le.keys.length-1,Le.keycache[K]=xe),Y.writeVarint(xe),typeof ne!="string"&&typeof ne!="boolean"&&typeof ne!="number"&&(ne=JSON.stringify(ne));const Ce=typeof ne+":"+ne;let Fe=Le.valuecache[Ce];Fe===void 0&&(Le.values.push(ne),Fe=Le.values.length-1,Le.valuecache[Ce]=Fe),Y.writeVarint(Fe)}}function nt(Le,Y){return(Y<<3)+(7&Le)}function pt(Le){return Le<<1^Le>>31}function mt(Le,Y){const K=Le.loadGeometry(),ne=Le.type;let xe=0,Ce=0;for(const Fe of K){let Ke=1;ne===1&&(Ke=Fe.length),Y.writeVarint(nt(1,Ke));const Ue=ne===3?Fe.length-1:Fe.length;for(let it=0;it<Ue;it++){it===1&&ne!==1&&Y.writeVarint(nt(2,Ue-1));const yt=Fe[it].x-xe,at=Fe[it].y-Ce;Y.writeVarint(pt(yt)),Y.writeVarint(pt(at)),xe+=yt,Ce+=at}Le.type===3&&Y.writeVarint(nt(7,1))}}function Tt(Le,Y){const K=typeof Le;K==="string"?Y.writeStringField(1,Le):K==="boolean"?Y.writeBooleanField(7,Le):K==="number"&&(Le%1!=0?Y.writeDoubleField(3,Le):Le<0?Y.writeSVarintField(6,Le):Y.writeVarintField(5,Le))}const Mt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Le=>Le},Zt=Math.fround||(hn=new Float32Array(1),Le=>(hn[0]=+Le,hn[0]));var hn;class on{constructor(Y){this.options=Object.assign(Object.create(Mt),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:K,minZoom:ne,maxZoom:xe}=this.options;K&&console.time("total time");const Ce=`prepare ${Y.length} points`;K&&console.time(Ce),this.points=Y;const Fe=[];for(let Ue=0;Ue<Y.length;Ue++){const it=Y[Ue];if(!it.geometry)continue;const[yt,at]=it.geometry.coordinates,Vt=Zt(Ee(yt)),Be=Zt(Oe(at));Fe.push(Vt,Be,1/0,Ue,-1,1),this.options.reduce&&Fe.push(0)}let Ke=this.trees[xe+1]=this._createTree(Fe);K&&console.timeEnd(Ce);for(let Ue=xe;Ue>=ne;Ue--){const it=+Date.now();Ke=this.trees[Ue]=this._createTree(this._cluster(Ke,Ue)),K&&console.log("z%d: %d clusters in %dms",Ue,Ke.numItems,+Date.now()-it)}return K&&console.timeEnd("total time"),this}getClusters(Y,K){let ne=((Y[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,Y[1]));let Ce=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ne=-180,Ce=180;else if(ne>Ce){const at=this.getClusters([ne,xe,180,Fe],K),Vt=this.getClusters([-180,xe,Ce,Fe],K);return at.concat(Vt)}const Ke=this.trees[this._limitZoom(K)],Ue=Ke.range(Ee(ne),Oe(Fe),Ee(Ce),Oe(xe)),it=Ke.data,yt=[];for(const at of Ue){const Vt=this.stride*at;yt.push(it[Vt+5]>1?nn(it,Vt,this.clusterProps):this.points[it[Vt+3]])}return yt}getChildren(Y){const K=this._getOriginId(Y),ne=this._getOriginZoom(Y),xe="No cluster with the specified id.",Ce=this.trees[ne];if(!Ce)throw new Error(xe);const Fe=Ce.data;if(K*this.stride>=Fe.length)throw new Error(xe);const Ke=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),Ue=Ce.within(Fe[K*this.stride],Fe[K*this.stride+1],Ke),it=[];for(const yt of Ue){const at=yt*this.stride;Fe[at+4]===Y&&it.push(Fe[at+5]>1?nn(Fe,at,this.clusterProps):this.points[Fe[at+3]])}if(it.length===0)throw new Error(xe);return it}getLeaves(Y,K,ne){const xe=[];return this._appendLeaves(xe,Y,K=K||10,ne=ne||0,0),xe}getTile(Y,K,ne){const xe=this.trees[this._limitZoom(Y)],Ce=Math.pow(2,Y),{extent:Fe,radius:Ke}=this.options,Ue=Ke/Fe,it=(ne-Ue)/Ce,yt=(ne+1+Ue)/Ce,at={features:[]};return this._addTileFeatures(xe.range((K-Ue)/Ce,it,(K+1+Ue)/Ce,yt),xe.data,K,ne,Ce,at),K===0&&this._addTileFeatures(xe.range(1-Ue/Ce,it,1,yt),xe.data,Ce,ne,Ce,at),K===Ce-1&&this._addTileFeatures(xe.range(0,it,Ue/Ce,yt),xe.data,-1,ne,Ce,at),at.features.length?at:null}getClusterExpansionZoom(Y){let K=this._getOriginZoom(Y)-1;for(;K<=this.options.maxZoom;){const ne=this.getChildren(Y);if(K++,ne.length!==1)break;Y=ne[0].properties.cluster_id}return K}_appendLeaves(Y,K,ne,xe,Ce){const Fe=this.getChildren(K);for(const Ke of Fe){const Ue=Ke.properties;if(Ue&&Ue.cluster?Ce+Ue.point_count<=xe?Ce+=Ue.point_count:Ce=this._appendLeaves(Y,Ue.cluster_id,ne,xe,Ce):Ce<xe?Ce++:Y.push(Ke),Y.length===ne)break}return Ce}_createTree(Y){const K=new d.aI(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ne=0;ne<Y.length;ne+=this.stride)K.add(Y[ne],Y[ne+1]);return K.finish(),K.data=Y,K}_addTileFeatures(Y,K,ne,xe,Ce,Fe){for(const Ke of Y){const Ue=Ke*this.stride,it=K[Ue+5]>1;let yt,at,Vt;if(it)yt=Rn(K,Ue,this.clusterProps),at=K[Ue],Vt=K[Ue+1];else{const Mn=this.points[K[Ue+3]];yt=Mn.properties;const[qt,_n]=Mn.geometry.coordinates;at=Ee(qt),Vt=Oe(_n)}const Be={type:1,geometry:[[Math.round(this.options.extent*(at*Ce-ne)),Math.round(this.options.extent*(Vt*Ce-xe))]],tags:yt};let ln;ln=it||this.options.generateId?K[Ue+3]:this.points[K[Ue+3]].id,ln!==void 0&&(Be.id=ln),Fe.features.push(Be)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,K){const{radius:ne,extent:xe,reduce:Ce,minPoints:Fe}=this.options,Ke=ne/(xe*Math.pow(2,K)),Ue=Y.data,it=[],yt=this.stride;for(let at=0;at<Ue.length;at+=yt){if(Ue[at+2]<=K)continue;Ue[at+2]=K;const Vt=Ue[at],Be=Ue[at+1],ln=Y.within(Ue[at],Ue[at+1],Ke),Mn=Ue[at+5];let qt=Mn;for(const _n of ln){const sr=_n*yt;Ue[sr+2]>K&&(qt+=Ue[sr+5])}if(qt>Mn&&qt>=Fe){let _n,sr=Vt*Mn,Tr=Be*Mn,zr=-1;const Sr=(at/yt<<5)+(K+1)+this.points.length;for(const Rr of ln){const Gn=Rr*yt;if(Ue[Gn+2]<=K)continue;Ue[Gn+2]=K;const kr=Ue[Gn+5];sr+=Ue[Gn]*kr,Tr+=Ue[Gn+1]*kr,Ue[Gn+4]=Sr,Ce&&(_n||(_n=this._map(Ue,at,!0),zr=this.clusterProps.length,this.clusterProps.push(_n)),Ce(_n,this._map(Ue,Gn)))}Ue[at+4]=Sr,it.push(sr/qt,Tr/qt,1/0,Sr,-1,qt),Ce&&it.push(zr)}else{for(let _n=0;_n<yt;_n++)it.push(Ue[at+_n]);if(qt>1)for(const _n of ln){const sr=_n*yt;if(!(Ue[sr+2]<=K)){Ue[sr+2]=K;for(let Tr=0;Tr<yt;Tr++)it.push(Ue[sr+Tr])}}}}return it}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,K,ne){if(Y[K+5]>1){const Fe=this.clusterProps[Y[K+6]];return ne?Object.assign({},Fe):Fe}const xe=this.points[Y[K+3]].properties,Ce=this.options.map(xe);return ne&&Ce===xe?Object.assign({},Ce):Ce}}function nn(Le,Y,K){return{type:"Feature",id:Le[Y+3],properties:Rn(Le,Y,K),geometry:{type:"Point",coordinates:[(ne=Le[Y],360*(ne-.5)),me(Le[Y+1])]}};var ne}function Rn(Le,Y,K){const ne=Le[Y+5],xe=ne>=1e4?`${Math.round(ne/1e3)}k`:ne>=1e3?Math.round(ne/100)/10+"k":ne,Ce=Le[Y+6],Fe=Ce===-1?{}:Object.assign({},K[Ce]);return Object.assign(Fe,{cluster:!0,cluster_id:Le[Y+3],point_count:ne,point_count_abbreviated:xe})}function Ee(Le){return Le/360+.5}function Oe(Le){const Y=Math.sin(Le*Math.PI/180),K=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return K<0?0:K>1?1:K}function me(Le){const Y=(180-360*Le)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function ze(Le,Y,K,ne){let xe=ne;const Ce=Y+(K-Y>>1);let Fe,Ke=K-Y;const Ue=Le[Y],it=Le[Y+1],yt=Le[K],at=Le[K+1];for(let Vt=Y+3;Vt<K;Vt+=3){const Be=$e(Le[Vt],Le[Vt+1],Ue,it,yt,at);if(Be>xe)Fe=Vt,xe=Be;else if(Be===xe){const ln=Math.abs(Vt-Ce);ln<Ke&&(Fe=Vt,Ke=ln)}}xe>ne&&(Fe-Y>3&&ze(Le,Y,Fe,ne),Le[Fe+2]=xe,K-Fe>3&&ze(Le,Fe,K,ne))}function $e(Le,Y,K,ne,xe,Ce){let Fe=xe-K,Ke=Ce-ne;if(Fe!==0||Ke!==0){const Ue=((Le-K)*Fe+(Y-ne)*Ke)/(Fe*Fe+Ke*Ke);Ue>1?(K=xe,ne=Ce):Ue>0&&(K+=Fe*Ue,ne+=Ke*Ue)}return Fe=Le-K,Ke=Y-ne,Fe*Fe+Ke*Ke}function ue(Le,Y,K,ne){const xe={id:Le??null,type:Y,geometry:K,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")De(xe,K);else if(Y==="Polygon")De(xe,K[0]);else if(Y==="MultiLineString")for(const Ce of K)De(xe,Ce);else if(Y==="MultiPolygon")for(const Ce of K)De(xe,Ce[0]);return xe}function De(Le,Y){for(let K=0;K<Y.length;K+=3)Le.minX=Math.min(Le.minX,Y[K]),Le.minY=Math.min(Le.minY,Y[K+1]),Le.maxX=Math.max(Le.maxX,Y[K]),Le.maxY=Math.max(Le.maxY,Y[K+1])}function dt(Le,Y,K,ne){if(!Y.geometry)return;const xe=Y.geometry.coordinates;if(xe&&xe.length===0)return;const Ce=Y.geometry.type,Fe=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Ke=[],Ue=Y.id;if(K.promoteId?Ue=Y.properties[K.promoteId]:K.generateId&&(Ue=ne||0),Ce==="Point")Et(xe,Ke);else if(Ce==="MultiPoint")for(const it of xe)Et(it,Ke);else if(Ce==="LineString")kt(xe,Ke,Fe,!1);else if(Ce==="MultiLineString"){if(K.lineMetrics){for(const it of xe)Ke=[],kt(it,Ke,Fe,!1),Le.push(ue(Ue,"LineString",Ke,Y.properties));return}ht(xe,Ke,Fe,!1)}else if(Ce==="Polygon")ht(xe,Ke,Fe,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const it of Y.geometry.geometries)dt(Le,{id:Ue,geometry:it,properties:Y.properties},K,ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const it of xe){const yt=[];ht(it,yt,Fe,!0),Ke.push(yt)}}Le.push(ue(Ue,Ce,Ke,Y.properties))}function Et(Le,Y){Y.push(vt(Le[0]),ut(Le[1]),0)}function kt(Le,Y,K,ne){let xe,Ce,Fe=0;for(let Ue=0;Ue<Le.length;Ue++){const it=vt(Le[Ue][0]),yt=ut(Le[Ue][1]);Y.push(it,yt,0),Ue>0&&(Fe+=ne?(xe*yt-it*Ce)/2:Math.sqrt(Math.pow(it-xe,2)+Math.pow(yt-Ce,2))),xe=it,Ce=yt}const Ke=Y.length-3;Y[2]=1,ze(Y,0,Ke,K),Y[Ke+2]=1,Y.size=Math.abs(Fe),Y.start=0,Y.end=Y.size}function ht(Le,Y,K,ne){for(let xe=0;xe<Le.length;xe++){const Ce=[];kt(Le[xe],Ce,K,ne),Y.push(Ce)}}function vt(Le){return Le/360+.5}function ut(Le){const Y=Math.sin(Le*Math.PI/180),K=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return K<0?0:K>1?1:K}function Bt(Le,Y,K,ne,xe,Ce,Fe,Ke){if(ne/=Y,Ce>=(K/=Y)&&Fe<ne)return Le;if(Fe<K||Ce>=ne)return null;const Ue=[];for(const it of Le){const yt=it.geometry;let at=it.type;const Vt=xe===0?it.minX:it.minY,Be=xe===0?it.maxX:it.maxY;if(Vt>=K&&Be<ne){Ue.push(it);continue}if(Be<K||Vt>=ne)continue;let ln=[];if(at==="Point"||at==="MultiPoint")Wt(yt,ln,K,ne,xe);else if(at==="LineString")jn(yt,ln,K,ne,xe,!1,Ke.lineMetrics);else if(at==="MultiLineString")qn(yt,ln,K,ne,xe,!1);else if(at==="Polygon")qn(yt,ln,K,ne,xe,!0);else if(at==="MultiPolygon")for(const Mn of yt){const qt=[];qn(Mn,qt,K,ne,xe,!0),qt.length&&ln.push(qt)}if(ln.length){if(Ke.lineMetrics&&at==="LineString"){for(const Mn of ln)Ue.push(ue(it.id,at,Mn,it.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(ln.length===1?(at="LineString",ln=ln[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=ln.length===3?"Point":"MultiPoint"),Ue.push(ue(it.id,at,ln,it.tags))}}return Ue.length?Ue:null}function Wt(Le,Y,K,ne,xe){for(let Ce=0;Ce<Le.length;Ce+=3){const Fe=Le[Ce+xe];Fe>=K&&Fe<=ne&&Jn(Y,Le[Ce],Le[Ce+1],Le[Ce+2])}}function jn(Le,Y,K,ne,xe,Ce,Fe){let Ke=Wn(Le);const Ue=xe===0?pn:mn;let it,yt,at=Le.start;for(let qt=0;qt<Le.length-3;qt+=3){const _n=Le[qt],sr=Le[qt+1],Tr=Le[qt+2],zr=Le[qt+3],Sr=Le[qt+4],Rr=xe===0?_n:sr,Gn=xe===0?zr:Sr;let kr=!1;Fe&&(it=Math.sqrt(Math.pow(_n-zr,2)+Math.pow(sr-Sr,2))),Rr<K?Gn>K&&(yt=Ue(Ke,_n,sr,zr,Sr,K),Fe&&(Ke.start=at+it*yt)):Rr>ne?Gn<ne&&(yt=Ue(Ke,_n,sr,zr,Sr,ne),Fe&&(Ke.start=at+it*yt)):Jn(Ke,_n,sr,Tr),Gn<K&&Rr>=K&&(yt=Ue(Ke,_n,sr,zr,Sr,K),kr=!0),Gn>ne&&Rr<=ne&&(yt=Ue(Ke,_n,sr,zr,Sr,ne),kr=!0),!Ce&&kr&&(Fe&&(Ke.end=at+it*yt),Y.push(Ke),Ke=Wn(Le)),Fe&&(at+=it)}let Vt=Le.length-3;const Be=Le[Vt],ln=Le[Vt+1],Mn=xe===0?Be:ln;Mn>=K&&Mn<=ne&&Jn(Ke,Be,ln,Le[Vt+2]),Vt=Ke.length-3,Ce&&Vt>=3&&(Ke[Vt]!==Ke[0]||Ke[Vt+1]!==Ke[1])&&Jn(Ke,Ke[0],Ke[1],Ke[2]),Ke.length&&Y.push(Ke)}function Wn(Le){const Y=[];return Y.size=Le.size,Y.start=Le.start,Y.end=Le.end,Y}function qn(Le,Y,K,ne,xe,Ce){for(const Fe of Le)jn(Fe,Y,K,ne,xe,Ce,!1)}function Jn(Le,Y,K,ne){Le.push(Y,K,ne)}function pn(Le,Y,K,ne,xe,Ce){const Fe=(Ce-Y)/(ne-Y);return Jn(Le,Ce,K+(xe-K)*Fe,1),Fe}function mn(Le,Y,K,ne,xe,Ce){const Fe=(Ce-K)/(xe-K);return Jn(Le,Y+(ne-Y)*Fe,Ce,1),Fe}function Us(Le,Y){const K=[];for(let ne=0;ne<Le.length;ne++){const xe=Le[ne],Ce=xe.type;let Fe;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")Fe=ki(xe.geometry,Y);else if(Ce==="MultiLineString"||Ce==="Polygon"){Fe=[];for(const Ke of xe.geometry)Fe.push(ki(Ke,Y))}else if(Ce==="MultiPolygon"){Fe=[];for(const Ke of xe.geometry){const Ue=[];for(const it of Ke)Ue.push(ki(it,Y));Fe.push(Ue)}}K.push(ue(xe.id,Ce,Fe,xe.tags))}return K}function ki(Le,Y){const K=[];K.size=Le.size,Le.start!==void 0&&(K.start=Le.start,K.end=Le.end);for(let ne=0;ne<Le.length;ne+=3)K.push(Le[ne]+Y,Le[ne+1],Le[ne+2]);return K}function Di(Le,Y){if(Le.transformed)return Le;const K=1<<Le.z,ne=Le.x,xe=Le.y;for(const Ce of Le.features){const Fe=Ce.geometry,Ke=Ce.type;if(Ce.geometry=[],Ke===1)for(let Ue=0;Ue<Fe.length;Ue+=2)Ce.geometry.push(Gi(Fe[Ue],Fe[Ue+1],Y,K,ne,xe));else for(let Ue=0;Ue<Fe.length;Ue++){const it=[];for(let yt=0;yt<Fe[Ue].length;yt+=2)it.push(Gi(Fe[Ue][yt],Fe[Ue][yt+1],Y,K,ne,xe));Ce.geometry.push(it)}}return Le.transformed=!0,Le}function Gi(Le,Y,K,ne,xe,Ce){return[Math.round(K*(Le*ne-xe)),Math.round(K*(Y*ne-Ce))]}function mi(Le,Y,K,ne,xe){const Ce=Y===xe.maxZoom?0:xe.tolerance/((1<<Y)*xe.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:Le.length,source:null,x:K,y:ne,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ke of Le)bs(Fe,Ke,Ce,xe);return Fe}function bs(Le,Y,K,ne){const xe=Y.geometry,Ce=Y.type,Fe=[];if(Le.minX=Math.min(Le.minX,Y.minX),Le.minY=Math.min(Le.minY,Y.minY),Le.maxX=Math.max(Le.maxX,Y.maxX),Le.maxY=Math.max(Le.maxY,Y.maxY),Ce==="Point"||Ce==="MultiPoint")for(let Ke=0;Ke<xe.length;Ke+=3)Fe.push(xe[Ke],xe[Ke+1]),Le.numPoints++,Le.numSimplified++;else if(Ce==="LineString")To(Fe,xe,Le,K,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let Ke=0;Ke<xe.length;Ke++)To(Fe,xe[Ke],Le,K,Ce==="Polygon",Ke===0);else if(Ce==="MultiPolygon")for(let Ke=0;Ke<xe.length;Ke++){const Ue=xe[Ke];for(let it=0;it<Ue.length;it++)To(Fe,Ue[it],Le,K,!0,it===0)}if(Fe.length){let Ke=Y.tags||null;if(Ce==="LineString"&&ne.lineMetrics){Ke={};for(const it in Y.tags)Ke[it]=Y.tags[it];Ke.mapbox_clip_start=xe.start/xe.size,Ke.mapbox_clip_end=xe.end/xe.size}const Ue={geometry:Fe,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Ke};Y.id!==null&&(Ue.id=Y.id),Le.features.push(Ue)}}function To(Le,Y,K,ne,xe,Ce){const Fe=ne*ne;if(ne>0&&Y.size<(xe?Fe:ne))return void(K.numPoints+=Y.length/3);const Ke=[];for(let Ue=0;Ue<Y.length;Ue+=3)(ne===0||Y[Ue+2]>Fe)&&(K.numSimplified++,Ke.push(Y[Ue],Y[Ue+1])),K.numPoints++;xe&&(function(Ue,it){let yt=0;for(let at=0,Vt=Ue.length,Be=Vt-2;at<Vt;Be=at,at+=2)yt+=(Ue[at]-Ue[Be])*(Ue[at+1]+Ue[Be+1]);if(yt>0===it)for(let at=0,Vt=Ue.length;at<Vt/2;at+=2){const Be=Ue[at],ln=Ue[at+1];Ue[at]=Ue[Vt-2-at],Ue[at+1]=Ue[Vt-1-at],Ue[Vt-2-at]=Be,Ue[Vt-1-at]=ln}})(Ke,Ce),Le.push(Ke)}const ea={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class So{constructor(Y,K){const ne=(K=this.options=(function(Ce,Fe){for(const Ke in Fe)Ce[Ke]=Fe[Ke];return Ce})(Object.create(ea),K)).debug;if(ne&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let xe=(function(Ce,Fe){const Ke=[];if(Ce.type==="FeatureCollection")for(let Ue=0;Ue<Ce.features.length;Ue++)dt(Ke,Ce.features[Ue],Fe,Ue);else dt(Ke,Ce.type==="Feature"?Ce:{geometry:Ce},Fe);return Ke})(Y,K);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=(function(Ce,Fe){const Ke=Fe.buffer/Fe.extent;let Ue=Ce;const it=Bt(Ce,1,-1-Ke,Ke,0,-1,2,Fe),yt=Bt(Ce,1,1-Ke,2+Ke,0,-1,2,Fe);return(it||yt)&&(Ue=Bt(Ce,1,-Ke,1+Ke,0,-1,2,Fe)||[],it&&(Ue=Us(it,1).concat(Ue)),yt&&(Ue=Ue.concat(Us(yt,-1)))),Ue})(xe,K),xe.length&&this.splitTile(xe,0,0,0),ne&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,K,ne,xe,Ce,Fe,Ke){const Ue=[Y,K,ne,xe],it=this.options,yt=it.debug;for(;Ue.length;){xe=Ue.pop(),ne=Ue.pop(),K=Ue.pop(),Y=Ue.pop();const at=1<<K,Vt=Ao(K,ne,xe);let Be=this.tiles[Vt];if(!Be&&(yt>1&&console.time("creation"),Be=this.tiles[Vt]=mi(Y,K,ne,xe,it),this.tileCoords.push({z:K,x:ne,y:xe}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ne,xe,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));const kr=`z${K}`;this.stats[kr]=(this.stats[kr]||0)+1,this.total++}if(Be.source=Y,Ce==null){if(K===it.indexMaxZoom||Be.numPoints<=it.indexMaxPoints)continue}else{if(K===it.maxZoom||K===Ce)continue;if(Ce!=null){const kr=Ce-K;if(ne!==Fe>>kr||xe!==Ke>>kr)continue}}if(Be.source=null,Y.length===0)continue;yt>1&&console.time("clipping");const ln=.5*it.buffer/it.extent,Mn=.5-ln,qt=.5+ln,_n=1+ln;let sr=null,Tr=null,zr=null,Sr=null,Rr=Bt(Y,at,ne-ln,ne+qt,0,Be.minX,Be.maxX,it),Gn=Bt(Y,at,ne+Mn,ne+_n,0,Be.minX,Be.maxX,it);Y=null,Rr&&(sr=Bt(Rr,at,xe-ln,xe+qt,1,Be.minY,Be.maxY,it),Tr=Bt(Rr,at,xe+Mn,xe+_n,1,Be.minY,Be.maxY,it),Rr=null),Gn&&(zr=Bt(Gn,at,xe-ln,xe+qt,1,Be.minY,Be.maxY,it),Sr=Bt(Gn,at,xe+Mn,xe+_n,1,Be.minY,Be.maxY,it),Gn=null),yt>1&&console.timeEnd("clipping"),Ue.push(sr||[],K+1,2*ne,2*xe),Ue.push(Tr||[],K+1,2*ne,2*xe+1),Ue.push(zr||[],K+1,2*ne+1,2*xe),Ue.push(Sr||[],K+1,2*ne+1,2*xe+1)}}getTile(Y,K,ne){Y=+Y,K=+K,ne=+ne;const xe=this.options,{extent:Ce,debug:Fe}=xe;if(Y<0||Y>24)return null;const Ke=1<<Y,Ue=Ao(Y,K=K+Ke&Ke-1,ne);if(this.tiles[Ue])return Di(this.tiles[Ue],Ce);Fe>1&&console.log("drilling down to z%d-%d-%d",Y,K,ne);let it,yt=Y,at=K,Vt=ne;for(;!it&&yt>0;)yt--,at>>=1,Vt>>=1,it=this.tiles[Ao(yt,at,Vt)];return it&&it.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",yt,at,Vt),console.time("drilling down")),this.splitTile(it.source,yt,at,Vt,Y,K,ne),Fe>1&&console.timeEnd("drilling down"),this.tiles[Ue]?Di(this.tiles[Ue],Ce):null):null}}function Ao(Le,Y,K){return 32*((1<<Le)*K+Y)+Le}class so extends k{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Y,K){return d._(this,void 0,void 0,(function*(){const ne=Y.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const xe=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!xe)return null;const Ce=new ve(xe.features,{version:2,extent:d.$});let Fe=(function(Ke){const Ue=new d.cM;return(function(it,yt){for(const at in it.layers)yt.writeMessage(3,le,it.layers[at])})(Ke,Ue),Ue.finish()})(Ce);return Fe.byteOffset===0&&Fe.byteLength===Fe.buffer.byteLength||(Fe=new Uint8Array(Fe)),{vectorTile:Ce,rawData:Fe.buffer}}))}loadData(Y){return d._(this,void 0,void 0,(function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort();const ne=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new d.cN(Y.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Y,this._pendingRequest);const xe=yield this._pendingData;this._geoJSONIndex=Y.cluster?new on((function({superclusterOptions:Fe,clusterProperties:Ke}){if(!Ke||!Fe)return Fe;const Ue={},it={},yt={accumulated:null,zoom:0},at={properties:null},Vt=Object.keys(Ke);for(const Be of Vt){const[ln,Mn]=Ke[Be],qt=d.cT(Mn),_n=d.cT(typeof ln=="string"?[ln,["accumulated"],["get",Be]]:ln);Ue[Be]=qt.value,it[Be]=_n.value}return Fe.map=Be=>{at.properties=Be;const ln={};for(const Mn of Vt)ln[Mn]=Ue[Mn].evaluate(yt,at);return ln},Fe.reduce=(Be,ln)=>{at.properties=ln;for(const Mn of Vt)yt.accumulated=Be[Mn],Be[Mn]=it[Mn].evaluate(yt,at)},Fe})(Y)).load(xe.features):(function(Fe,Ke){return new So(Fe,Ke)})(xe,Y.geojsonVtOptions),this.loaded={};const Ce={data:xe};if(ne){const Fe=ne.finish();Fe&&(Ce.resourceTiming={},Ce.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Fe)))}return Ce}catch(xe){if(delete this._pendingRequest,d.cy(xe))return{abandoned:!0};throw xe}}))}getData(){return d._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Y){const K=this.loaded;return K&&K[Y.uid]?super.reloadTile(Y):this.loadTile(Y)}loadAndProcessGeoJSON(Y,K){return d._(this,void 0,void 0,(function*(){let ne=yield this.loadGeoJSON(Y,K);if(delete this._pendingRequest,typeof ne!="object")throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(re(ne,!0),Y.filter){const xe=d.cT(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xe.result==="error")throw new Error(xe.value.map((Fe=>`${Fe.key}: ${Fe.message}`)).join(", "));ne={type:"FeatureCollection",features:ne.features.filter((Fe=>xe.value.evaluate({zoom:0},Fe)))}}return ne}))}loadGeoJSON(Y,K){return d._(this,void 0,void 0,(function*(){const{promoteId:ne}=Y;if(Y.request){const xe=yield d.j(Y.request,K);return this._dataUpdateable=d.cV(xe.data,ne)?d.cU(xe.data,ne):void 0,xe.data}if(typeof Y.data=="string")try{const xe=JSON.parse(Y.data);return this._dataUpdateable=d.cV(xe,ne)?d.cU(xe,ne):void 0,xe}catch{throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`)}if(!Y.dataDiff)throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Y.source}`);return d.cW(this._dataUpdateable,Y.dataDiff,ne),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(Y){return d._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Y){return this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId)}getClusterChildren(Y){return this._geoJSONIndex.getChildren(Y.clusterId)}getClusterLeaves(Y){return this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset)}}class Po{constructor(Y){this.self=Y,this.actor=new d.J(Y),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(K,ne)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=ne},this.self.addProtocol=d.cA,this.self.removeProtocol=d.cB,this.self.registerRTLTextPlugin=K=>{d.cX.setMethods(K)},this.actor.registerMessageHandler("LDT",((K,ne)=>this._getDEMWorkerSource(K,ne.source).loadTile(ne))),this.actor.registerMessageHandler("RDT",((K,ne)=>d._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(K,ne.source).removeTile(ne)})))),this.actor.registerMessageHandler("GCEZ",((K,ne)=>d._(this,void 0,void 0,(function*(){return this._getWorkerSource(K,ne.type,ne.source).getClusterExpansionZoom(ne)})))),this.actor.registerMessageHandler("GCC",((K,ne)=>d._(this,void 0,void 0,(function*(){return this._getWorkerSource(K,ne.type,ne.source).getClusterChildren(ne)})))),this.actor.registerMessageHandler("GCL",((K,ne)=>d._(this,void 0,void 0,(function*(){return this._getWorkerSource(K,ne.type,ne.source).getClusterLeaves(ne)})))),this.actor.registerMessageHandler("LD",((K,ne)=>this._getWorkerSource(K,ne.type,ne.source).loadData(ne))),this.actor.registerMessageHandler("GD",((K,ne)=>this._getWorkerSource(K,ne.type,ne.source).getData())),this.actor.registerMessageHandler("LT",((K,ne)=>this._getWorkerSource(K,ne.type,ne.source).loadTile(ne))),this.actor.registerMessageHandler("RT",((K,ne)=>this._getWorkerSource(K,ne.type,ne.source).reloadTile(ne))),this.actor.registerMessageHandler("AT",((K,ne)=>this._getWorkerSource(K,ne.type,ne.source).abortTile(ne))),this.actor.registerMessageHandler("RMT",((K,ne)=>this._getWorkerSource(K,ne.type,ne.source).removeTile(ne))),this.actor.registerMessageHandler("RS",((K,ne)=>d._(this,void 0,void 0,(function*(){if(!this.workerSources[K]||!this.workerSources[K][ne.type]||!this.workerSources[K][ne.type][ne.source])return;const xe=this.workerSources[K][ne.type][ne.source];delete this.workerSources[K][ne.type][ne.source],xe.removeSource!==void 0&&xe.removeSource(ne)})))),this.actor.registerMessageHandler("RM",(K=>d._(this,void 0,void 0,(function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K],this.globalStates.delete(K)})))),this.actor.registerMessageHandler("SR",((K,ne)=>d._(this,void 0,void 0,(function*(){this.referrer=ne})))),this.actor.registerMessageHandler("SRPS",((K,ne)=>this._syncRTLPluginState(K,ne))),this.actor.registerMessageHandler("IS",((K,ne)=>d._(this,void 0,void 0,(function*(){this.self.importScripts(ne)})))),this.actor.registerMessageHandler("SI",((K,ne)=>this._setImages(K,ne))),this.actor.registerMessageHandler("UL",((K,ne)=>d._(this,void 0,void 0,(function*(){this._getLayerIndex(K).update(ne.layers,ne.removedIds,this._getGlobalState(K))})))),this.actor.registerMessageHandler("UGS",((K,ne)=>d._(this,void 0,void 0,(function*(){const xe=this._getGlobalState(K);for(const Ce in ne)xe[Ce]=ne[Ce]})))),this.actor.registerMessageHandler("SL",((K,ne)=>d._(this,void 0,void 0,(function*(){this._getLayerIndex(K).replace(ne,this._getGlobalState(K))}))))}_getGlobalState(Y){let K=this.globalStates.get(Y);return K||(K={},this.globalStates.set(Y,K)),K}_setImages(Y,K){return d._(this,void 0,void 0,(function*(){this.availableImages[Y]=K;for(const ne in this.workerSources[Y]){const xe=this.workerSources[Y][ne];for(const Ce in xe)xe[Ce].availableImages=K}}))}_syncRTLPluginState(Y,K){return d._(this,void 0,void 0,(function*(){return yield d.cX.syncState(K,this.self.importScripts)}))}_getAvailableImages(Y){let K=this.availableImages[Y];return K||(K=[]),K}_getLayerIndex(Y){let K=this.layerIndexes[Y];return K||(K=this.layerIndexes[Y]=new a),K}_getWorkerSource(Y,K,ne){if(this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][K]||(this.workerSources[Y][K]={}),!this.workerSources[Y][K][ne]){const xe={sendAsync:(Ce,Fe)=>(Ce.targetMapId=Y,this.actor.sendAsync(Ce,Fe))};switch(K){case"vector":this.workerSources[Y][K][ne]=new k(xe,this._getLayerIndex(Y),this._getAvailableImages(Y));break;case"geojson":this.workerSources[Y][K][ne]=new so(xe,this._getLayerIndex(Y),this._getAvailableImages(Y));break;default:this.workerSources[Y][K][ne]=new this.externalWorkerSourceTypes[K](xe,this._getLayerIndex(Y),this._getAvailableImages(Y))}}return this.workerSources[Y][K][ne]}_getDEMWorkerSource(Y,K){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][K]||(this.demWorkerSources[Y][K]=new L),this.demWorkerSources[Y][K]}}return d.i(self)&&(self.worker=new Po(self)),Po})),o("index",["exports","./shared"],(function(d,a){var v="5.8.0";function A(){var x=new a.A(4);return a.A!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}let P,k;const L={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(x,i,h){const m=requestAnimationFrame((w=>{y(),i(w)})),{unsubscribe:y}=a.s(x.signal,"abort",(()=>{y(),cancelAnimationFrame(m),h(a.c())}),!1)},frameAsync(x){return new Promise(((i,h)=>{this.frame(x,i,h)}))},getImageData(x,i=0){return this.getImageCanvasContext(x).getImageData(-i,-i,x.width+2*i,x.height+2*i)},getImageCanvasContext(x){const i=window.document.createElement("canvas"),h=i.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return i.width=x.width,i.height=x.height,h.drawImage(x,0,0,x.width,x.height),h},resolveURL:x=>(P||(P=document.createElement("a")),P.href=x,P.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class z{static testProp(i){if(!z.docStyle)return i[0];for(let h=0;h<i.length;h++)if(i[h]in z.docStyle)return i[h];return i[0]}static create(i,h,m){const y=window.document.createElement(i);return h!==void 0&&(y.className=h),m&&m.appendChild(y),y}static createNS(i,h){return window.document.createElementNS(i,h)}static disableDrag(){z.docStyle&&z.selectProp&&(z.userSelect=z.docStyle[z.selectProp],z.docStyle[z.selectProp]="none")}static enableDrag(){z.docStyle&&z.selectProp&&(z.docStyle[z.selectProp]=z.userSelect)}static setTransform(i,h){i.style[z.transformProp]=h}static addEventListener(i,h,m,y={}){i.addEventListener(h,m,"passive"in y?y:y.capture)}static removeEventListener(i,h,m,y={}){i.removeEventListener(h,m,"passive"in y?y:y.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",z.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",z.suppressClickInternal,!0)}),0)}static getScale(i){const h=i.getBoundingClientRect();return{x:h.width/i.offsetWidth||1,y:h.height/i.offsetHeight||1,boundingClientRect:h}}static getPoint(i,h,m){const y=h.boundingClientRect;return new a.P((m.clientX-y.left)/h.x-i.clientLeft,(m.clientY-y.top)/h.y-i.clientTop)}static mousePos(i,h){const m=z.getScale(i);return z.getPoint(i,m,h)}static touchPos(i,h){const m=[],y=z.getScale(i);for(let w=0;w<h.length;w++)m.push(z.getPoint(i,y,h[w]));return m}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}static sanitize(i){const h=new DOMParser().parseFromString(i,"text/html").body||document.createElement("body"),m=h.querySelectorAll("script");for(const y of m)y.remove();return z.clean(h),h.innerHTML}static isPossiblyDangerous(i,h){const m=h.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(i)||!m.includes("javascript:")&&!m.includes("data:"))||!!i.startsWith("on")||void 0}static clean(i){const h=i.children;for(const m of h)z.removeAttributes(m),z.clean(m)}static removeAttributes(i){for(const{name:h,value:m}of i.attributes)z.isPossiblyDangerous(h,m)&&i.removeAttribute(h)}}z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,z.selectProp=z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),z.transformProp=z.testProp(["transform","WebkitTransform"]);const G={supported:!1,testSupport:function(x){!fe&&re&&(ve?le(x):te=x)}};let te,re,fe=!1,ve=!1;function le(x){const i=x.createTexture();x.bindTexture(x.TEXTURE_2D,i);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,re),x.isContextLost())return;G.supported=!0}catch{}x.deleteTexture(i),fe=!0}var Se;typeof document<"u"&&(re=document.createElement("img"),re.onload=()=>{te&&le(te),te=null,ve=!0},re.onerror=()=>{fe=!0,te=null},re.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(x){let i,h,m,y;x.resetRequestQueue=()=>{i=[],h=0,m=0,y={}},x.addThrottleControl=D=>{const B=m++;return y[B]=D,B},x.removeThrottleControl=D=>{delete y[D],E()},x.getImage=(D,B,U=!0)=>new Promise(((W,$)=>{G.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),a.e(D,{type:"image"}),i.push({abortController:B,requestParameters:D,supportImageRefresh:U,state:"queued",onError:Z=>{$(Z)},onSuccess:Z=>{W(Z)}}),E()}));const w=D=>a._(this,void 0,void 0,(function*(){D.state="running";const{requestParameters:B,supportImageRefresh:U,onError:W,onSuccess:$,abortController:Z}=D,J=U===!1&&!a.i(self)&&!a.g(B.url)&&(!B.headers||Object.keys(B.headers).reduce(((ae,de)=>ae&&de==="accept"),!0));h++;const ie=J?R(B,Z):a.m(B,Z);try{const ae=yield ie;delete D.abortController,D.state="completed",ae.data instanceof HTMLImageElement||a.b(ae.data)?$(ae):ae.data&&$({data:yield(oe=ae.data,typeof createImageBitmap=="function"?a.f(oe):a.h(oe)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete D.abortController,W(ae)}finally{h--,E()}var oe})),E=()=>{const D=(()=>{for(const B of Object.keys(y))if(y[B]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let B=h;B<D&&i.length>0;B++){const U=i.shift();U.abortController.signal.aborted?B--:w(U)}},R=(D,B)=>new Promise(((U,W)=>{const $=new Image,Z=D.url,J=D.credentials;J&&J==="include"?$.crossOrigin="use-credentials":(J&&J==="same-origin"||!a.d(Z))&&($.crossOrigin="anonymous"),B.signal.addEventListener("abort",(()=>{$.src="",W(a.c())})),$.fetchPriority="high",$.onload=()=>{$.onerror=$.onload=null,U({data:$})},$.onerror=()=>{$.onerror=$.onload=null,B.signal.aborted||W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},$.src=Z}))})(Se||(Se={})),Se.resetRequestQueue();class Ne{constructor(i){this._transformRequestFn=i??null}transformRequest(i,h){return this._transformRequestFn&&this._transformRequestFn(i,h)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function nt(x){const i=[];if(typeof x=="string")i.push({id:"default",url:x});else if(x&&x.length>0){const h=[];for(const{id:m,url:y}of x){const w=`${m}${y}`;h.indexOf(w)===-1&&(h.push(w),i.push({id:m,url:y}))}}return i}function pt(x,i,h){try{const m=new URL(x);return m.pathname+=`${i}${h}`,m.toString()}catch{throw new Error(`Invalid sprite URL "${x}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function mt(x){const{userImage:i}=x;return!!(i&&i.render&&i.render())&&(x.data.replace(new Uint8Array(i.data.buffer)),!0)}class Tt extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:h,promiseResolve:m}of this.requestors)m(this._getImagesForIds(h));this.requestors=[]}}getImage(i){const h=this.images[i];if(h&&!h.data&&h.spriteData){const m=h.spriteData;h.data=new a.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),h.spriteData=null}return h}addImage(i,h){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,h)&&(this.images[i]=h)}_validate(i,h){let m=!0;const y=h.data||h.spriteData;return this._validateStretch(h.stretchX,y&&y.width)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(h.stretchY,y&&y.height)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(h.content,h)||(this.fire(new a.k(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,h){if(!i)return!0;let m=0;for(const y of i){if(y[0]<m||y[1]<y[0]||h<y[1])return!1;m=y[1]}return!0}_validateContent(i,h){if(!i)return!0;if(i.length!==4)return!1;const m=h.spriteData,y=m&&m.width||h.data.width,w=m&&m.height||h.data.height;return!(i[0]<0||y<i[0]||i[1]<0||w<i[1]||i[2]<0||y<i[2]||i[3]<0||w<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,h,m=!0){const y=this.getImage(i);if(m&&(y.data.width!==h.data.width||y.data.height!==h.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=y.version+1,this.images[i]=h,this.updatedImages[i]=!0}removeImage(i){const h=this.images[i];delete this.images[i],delete this.patterns[i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise(((h,m)=>{let y=!0;if(!this.isLoaded())for(const w of i)this.images[w]||(y=!1);this.isLoaded()||y?h(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:h})}))}_getImagesForIds(i){const h={};for(const m of i){let y=this.getImage(m);y||(this.fire(new a.l("styleimagemissing",{id:m})),y=this.getImage(m)),y?h[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:a.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:i,height:h}=this.atlasImage;return{width:i,height:h}}getPattern(i){const h=this.patterns[i],m=this.getImage(i);if(!m)return null;if(h&&h.position.version===m.version)return h.position;if(h)h.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},w=new a.I(y,m);this.patterns[i]={bin:y,position:w}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const h=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.T(i,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const w in this.patterns)i.push(this.patterns[w].bin);const{w:h,h:m}=a.p(i),y=this.atlasImage;y.resize({width:h||1,height:m||1});for(const w in this.patterns){const{bin:E}=this.patterns[w],R=E.x+1,D=E.y+1,B=this.getImage(w).data,U=B.width,W=B.height;a.R.copy(B,y,{x:0,y:0},{x:R,y:D},{width:U,height:W}),a.R.copy(B,y,{x:0,y:W-1},{x:R,y:D-1},{width:U,height:1}),a.R.copy(B,y,{x:0,y:0},{x:R,y:D+W},{width:U,height:1}),a.R.copy(B,y,{x:U-1,y:0},{x:R-1,y:D},{width:1,height:W}),a.R.copy(B,y,{x:0,y:0},{x:R+U,y:D},{width:1,height:W})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const h of i){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const m=this.getImage(h);m||a.w(`Image with ID: "${h}" was not found`),mt(m)&&this.updateImage(h,m)}}}const Mt=1e20;function Zt(x,i,h,m,y,w,E,R,D){for(let B=i;B<i+m;B++)hn(x,h*w+B,w,y,E,R,D);for(let B=h;B<h+y;B++)hn(x,B*w+i,1,m,E,R,D)}function hn(x,i,h,m,y,w,E){w[0]=0,E[0]=-Mt,E[1]=Mt,y[0]=x[i];for(let R=1,D=0,B=0;R<m;R++){y[R]=x[i+R*h];const U=R*R;do{const W=w[D];B=(y[R]-y[W]+U-W*W)/(R-W)/2}while(B<=E[D]&&--D>-1);D++,w[D]=R,E[D]=B,E[D+1]=Mt}for(let R=0,D=0;R<m;R++){for(;E[D+1]<R;)D++;const B=w[D],U=R-B;x[i+R*h]=y[B]+U*U}}class on{constructor(i,h,m){this.requestManager=i,this.localIdeographFontFamily=h,this.entries={},this.lang=m}setURL(i){this.url=i}getGlyphs(i){return a._(this,void 0,void 0,(function*(){const h=[];for(const w in i)for(const E of i[w])h.push(this._getAndCacheGlyphsPromise(w,E));const m=yield Promise.all(h),y={};for(const{stack:w,id:E,glyph:R}of m)y[w]||(y[w]={}),y[w][E]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return y}))}_getAndCacheGlyphsPromise(i,h){return a._(this,void 0,void 0,(function*(){let m=this.entries[i];m||(m=this.entries[i]={glyphs:{},requests:{},ranges:{}});let y=m.glyphs[h];if(y!==void 0)return{stack:i,id:h,glyph:y};if(y=this._tinySDF(m,i,h),y)return m.glyphs[h]=y,{stack:i,id:h,glyph:y};const w=Math.floor(h/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[w])return{stack:i,id:h,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[w]){const R=on.loadGlyphRange(i,w,this.url,this.requestManager);m.requests[w]=R}const E=yield m.requests[w];for(const R in E)this._doesCharSupportLocalGlyph(+R)||(m.glyphs[+R]=E[+R]);return m.ranges[w]=!0,{stack:i,id:h,glyph:E[h]||null}}))}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(i))||a.u["CJK Unified Ideographs"](i)||a.u["Hangul Syllables"](i)||a.u.Hiragana(i)||a.u.Katakana(i)||a.u["CJK Symbols and Punctuation"](i)||a.u["Halfwidth and Fullwidth Forms"](i))}_tinySDF(i,h,m){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(m))return;let w=i.tinySDF;if(!w){let R="400";/bold/i.test(h)?R="900":/medium/i.test(h)?R="500":/light/i.test(h)&&(R="200"),w=i.tinySDF=new on.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:y,fontWeight:R})}const E=w.draw(String.fromCharCode(m));return{id:m,bitmap:new a.q({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}on.loadGlyphRange=function(x,i,h,m){return a._(this,void 0,void 0,(function*(){const y=256*i,w=y+255,E=m.transformRequest(h.replace("{fontstack}",x).replace("{range}",`${y}-${w}`),"Glyphs"),R=yield a.n(E,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${i}, ${y}-${w}`);const D={};for(const B of a.o(R.data))D[B.id]=B;return D}))},on.TinySDF=class{constructor({fontSize:x=24,buffer:i=3,radius:h=8,cutoff:m=.25,fontFamily:y="sans-serif",fontWeight:w="normal",fontStyle:E="normal",lang:R=null}={}){this.buffer=i,this.cutoff=m,this.radius=h,this.lang=R;const D=this.size=x+4*i,B=this._createCanvas(D),U=this.ctx=B.getContext("2d",{willReadFrequently:!0});U.font=`${E} ${w} ${x}px ${y}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(x){const i=document.createElement("canvas");return i.width=i.height=x,i}draw(x){const{width:i,actualBoundingBoxAscent:h,actualBoundingBoxDescent:m,actualBoundingBoxLeft:y,actualBoundingBoxRight:w}=this.ctx.measureText(x),E=Math.ceil(h),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-y))),D=Math.min(this.size-this.buffer,E+Math.ceil(m)),B=R+2*this.buffer,U=D+2*this.buffer,W=Math.max(B*U,0),$=new Uint8ClampedArray(W),Z={data:$,width:B,height:U,glyphWidth:R,glyphHeight:D,glyphTop:E,glyphLeft:0,glyphAdvance:i};if(R===0||D===0)return Z;const{ctx:J,buffer:ie,gridInner:oe,gridOuter:ae}=this;this.lang&&(J.lang=this.lang),J.clearRect(ie,ie,R,D),J.fillText(x,ie,ie+E);const de=J.getImageData(ie,ie,R,D);ae.fill(Mt,0,W),oe.fill(0,0,W);for(let ye=0;ye<D;ye++)for(let he=0;he<R;he++){const we=de.data[4*(ye*R+he)+3]/255;if(we===0)continue;const Me=(ye+ie)*B+he+ie;if(we===1)ae[Me]=0,oe[Me]=Mt;else{const _e=.5-we;ae[Me]=_e>0?_e*_e:0,oe[Me]=_e<0?_e*_e:0}}Zt(ae,0,0,B,U,B,this.f,this.v,this.z),Zt(oe,ie,ie,R,D,B,this.f,this.v,this.z);for(let ye=0;ye<W;ye++){const he=Math.sqrt(ae[ye])-Math.sqrt(oe[ye]);$[ye]=Math.round(255-255*(he/this.radius+this.cutoff))}return Z}};class nn{constructor(){this.specification=a.v.light.position}possiblyEvaluate(i,h){return a.B(i.expression.evaluate(h))}interpolate(i,h,m){return{x:a.C.number(i.x,h.x,m),y:a.C.number(i.y,h.y,m),z:a.C.number(i.z,h.z,m)}}}let Rn;class Ee extends a.E{constructor(i){super(),Rn=Rn||new a.r({anchor:new a.D(a.v.light.anchor),position:new nn,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.t(Rn,void 0),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,h={}){if(!this._validate(a.x,i,h))for(const m in i){const y=i[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,m){return(!m||m.validate!==!1)&&a.y(this,i.call(a.z,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const Oe=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class me extends a.E{constructor(i){super(),this._transitionable=new a.t(Oe,void 0),this.setSky(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0))}setSky(i,h={}){if(!this._validate(a.G,i,h)){i||(i={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in i){const y=i[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,m={}){return m?.validate!==!1&&a.y(this,i.call(a.z,a.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class ze{constructor(i,h){this.width=i,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,h){const m=i.join(",")+String(h);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(i,h)),this.dashEntry[m]}getDashRanges(i,h,m){const y=[];let w=i.length%2==1?-i[i.length-1]*m:0,E=i[0]*m,R=!0;y.push({left:w,right:E,isDash:R,zeroLength:i[0]===0});let D=i[0];for(let B=1;B<i.length;B++){R=!R;const U=i[B];w=D*m,D+=U,E=D*m,y.push({left:w,right:E,isDash:R,zeroLength:U===0})}return y}addRoundDash(i,h,m){const y=h/2;for(let w=-m;w<=m;w++){const E=this.width*(this.nextRow+m+w);let R=0,D=i[R];for(let B=0;B<this.width;B++){B/D.right>1&&(D=i[++R]);const U=Math.abs(B-D.left),W=Math.abs(B-D.right),$=Math.min(U,W);let Z;const J=w/m*(y+1);if(D.isDash){const ie=y-Math.abs(J);Z=Math.sqrt($*$+ie*ie)}else Z=y-Math.sqrt($*$+J*J);this.data[E+B]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(i){for(let R=i.length-1;R>=0;--R){const D=i[R],B=i[R+1];D.zeroLength?i.splice(R,1):B&&B.isDash===D.isDash&&(B.left=D.left,i.splice(R,1))}const h=i[0],m=i[i.length-1];h.isDash===m.isDash&&(h.left=m.left-this.width,m.right=h.right+this.width);const y=this.width*this.nextRow;let w=0,E=i[w];for(let R=0;R<this.width;R++){R/E.right>1&&(E=i[++w]);const D=Math.abs(R-E.left),B=Math.abs(R-E.right),U=Math.min(D,B);this.data[y+R]=Math.max(0,Math.min(255,(E.isDash?U:-U)+128))}}addDash(i,h){const m=h?7:0,y=2*m+1;if(this.nextRow+y>this.height)return a.w("LineAtlas out of space"),null;let w=0;for(let R=0;R<i.length;R++)w+=i[R];if(w!==0){const R=this.width/w,D=this.getDashRanges(i,this.width,R);h?this.addRoundDash(D,R,m):this.addRegularDash(D)}const E={y:this.nextRow+m,height:2*m,width:w};return this.nextRow+=y,this.dirty=!0,E}bind(i){const h=i.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const $e="maplibre_preloaded_worker_pool";class ue{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<ue.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach((h=>{h.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[$e]}numActive(){return Object.keys(this.active).length}}const De=Math.floor(L.hardwareConcurrency/2);let dt,Et;function kt(){return dt||(dt=new ue),dt}ue.workerCount=a.H(globalThis)?Math.max(Math.min(De,3),1):1;class ht{constructor(i,h){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=h;const m=this.workerPool.acquire(h);for(let y=0;y<m.length;y++){const w=new a.J(m[y],h);w.name=`Worker ${y}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,h){const m=[];for(const y of this.actors)m.push(y.sendAsync({type:i,data:h}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach((h=>{h.remove()})),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,h){for(const m of this.actors)m.registerMessageHandler(i,h)}}function vt(){return Et||(Et=new ht(kt(),a.K),Et.registerMessageHandler("GR",((x,i,h)=>a.m(i,h)))),Et}function ut(x,i){const h=a.L();return a.M(h,h,[1,1,0]),a.N(h,h,[.5*x.width,.5*x.height,1]),x.calculatePosMatrix?a.O(h,h,x.calculatePosMatrix(i.toUnwrapped())):h}function Bt(x,i,h,m,y,w,E){var R;const D=(function($,Z,J){if($)for(const ie of $){const oe=Z[ie];if(oe&&oe.source===J&&oe.type==="fill-extrusion")return!0}else for(const ie in Z){const oe=Z[ie];if(oe.source===J&&oe.type==="fill-extrusion")return!0}return!1})((R=y?.layers)!==null&&R!==void 0?R:null,i,x.id),B=w.maxPitchScaleFactor(),U=x.tilesIn(m,B,D);U.sort(Wt);const W=[];for(const $ of U)W.push({wrappedTileID:$.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(i,h,x._state,$.queryGeometry,$.cameraQueryGeometry,$.scale,y,w,B,ut(x.transform,$.tileID),E?(Z,J)=>E($.tileID,Z,J):void 0)});return(function($,Z){for(const J in $)for(const ie of $[J])jn(ie,Z);return $})((function($){const Z={},J={};for(const ie of $){const oe=ie.queryResults,ae=ie.wrappedTileID,de=J[ae]=J[ae]||{};for(const ye in oe){const he=oe[ye],we=de[ye]=de[ye]||{},Me=Z[ye]=Z[ye]||[];for(const _e of he)we[_e.featureIndex]||(we[_e.featureIndex]=!0,Me.push(_e))}}return Z})(W),x)}function Wt(x,i){const h=x.tileID,m=i.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}function jn(x,i){const h=x.feature,m=i.getFeatureState(h.layer["source-layer"],h.id);h.source=h.layer.source,h.layer["source-layer"]&&(h.sourceLayer=h.layer["source-layer"]),h.state=m}function Wn(x,i,h){return a._(this,void 0,void 0,(function*(){let m=x;if(x.url?m=(yield a.j(i.transformRequest(x.url,"Source"),h)).data:yield L.frameAsync(h),!m)return null;const y=a.Q(a.e(m,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(y.vectorLayerIds=m.vector_layers.map((w=>w.id))),y}))}class qn{constructor(i,h){i&&(h?this.setSouthWest(i).setNorthEast(h):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof a.S?new a.S(i.lng,i.lat):a.S.convert(i),this}setSouthWest(i){return this._sw=i instanceof a.S?new a.S(i.lng,i.lat):a.S.convert(i),this}extend(i){const h=this._sw,m=this._ne;let y,w;if(i instanceof a.S)y=i,w=i;else{if(!(i instanceof qn))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(qn.convert(i)):this.extend(a.S.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(a.S.convert(i)):this;if(y=i._sw,w=i._ne,!y||!w)return this}return h||m?(h.lng=Math.min(y.lng,h.lng),h.lat=Math.min(y.lat,h.lat),m.lng=Math.max(w.lng,m.lng),m.lat=Math.max(w.lat,m.lat)):(this._sw=new a.S(y.lng,y.lat),this._ne=new a.S(w.lng,w.lat)),this}getCenter(){return new a.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.S(this.getWest(),this.getNorth())}getSouthEast(){return new a.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:h,lat:m}=a.S.convert(i);let y=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&y}static convert(i){return i instanceof qn?i:i&&new qn(i)}static fromLngLat(i,h=0){const m=360*h/40075017,y=m/Math.cos(Math.PI/180*i.lat);return new qn(new a.S(i.lng-y,i.lat-m),new a.S(i.lng+y,i.lat+m))}adjustAntiMeridian(){const i=new a.S(this._sw.lng,this._sw.lat),h=new a.S(this._ne.lng,this._ne.lat);return new qn(i,i.lng>h.lng?new a.S(h.lng+360,h.lat):h)}}class Jn{constructor(i,h,m){this.bounds=qn.convert(this.validateBounds(i)),this.minzoom=h||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const h=Math.pow(2,i.z),m=Math.floor(a.V(this.bounds.getWest())*h),y=Math.floor(a.U(this.bounds.getNorth())*h),w=Math.ceil(a.V(this.bounds.getEast())*h),E=Math.ceil(a.U(this.bounds.getSouth())*h);return i.x>=m&&i.x<w&&i.y>=y&&i.y<E}}class pn extends a.E{constructor(i,h,m,y){if(super(),this.id=i,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.Q(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Wn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(a.e(this,i),i.bounds&&(this.tileBounds=new Jn(i.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this._loaded=!0,this.fire(new a.k(i))}}))}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty((()=>{this._options.tiles=i})),this}setUrl(i){return this.setSourceProperty((()=>{this.url=i,this._options.url=i})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(i){return a._(this,void 0,void 0,(function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(h,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};m.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise(((w,E)=>{i.reloadPromise={resolve:w,reject:E}}))}else i.actor=this.dispatcher.getActor(),y="LT";i.abortController=new AbortController;try{const w=yield i.actor.sendAsync({type:y,data:m},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,w)}catch(w){if(delete i.abortController,i.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(i,null)}}))}_afterTileLoadWorkerResponse(i,h){if(h&&h.resourceTiming&&(i.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&i.setExpiryData(h),i.loadVectorData(h,this.map.painter),i.reloadPromise){const m=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(m.resolve).catch(m.reject)}}abortTile(i){return a._(this,void 0,void 0,(function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))}))}unloadTile(i){return a._(this,void 0,void 0,(function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class mn extends a.E{constructor(i,h,m,y){super(),this.id=i,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.Q(h,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,(function*(i=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const h=yield Wn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,h&&(a.e(this,h),h.bounds&&(this.tileBounds=new Jn(h.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:i})))}catch(h){this._tileJSONRequest=null,this._loaded=!0,this.fire(new a.k(h))}}))}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load(!0)}setTiles(i){return this.setSourceProperty((()=>{this._options.tiles=i})),this}setUrl(i){return this.setSourceProperty((()=>{this.url=i,this._options.url=i})),this}serialize(){return a.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return a._(this,void 0,void 0,(function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const m=yield Se.getImage(this.map._requestManager.transformRequest(h,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&i.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const y=this.map.painter.context,w=y.gl,E=m.data;i.texture=this.map.painter.getTileTexture(E.width),i.texture?i.texture.update(E,{useMipmap:!0}):(i.texture=new a.T(y,E,w.RGBA,{useMipmap:!0}),i.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),i.state="loaded"}}catch(m){if(delete i.abortController,i.aborted)i.state="unloaded";else if(m)throw i.state="errored",m}}))}abortTile(i){return a._(this,void 0,void 0,(function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)}))}unloadTile(i){return a._(this,void 0,void 0,(function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)}))}hasTransition(){return!1}}class Us extends mn{constructor(i,h,m,y){super(i,h,m,y),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(i){return a._(this,void 0,void 0,(function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(h,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const y=yield Se.getImage(m,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(y&&y.data){const w=y.data;this.map._refreshExpiredTiles&&(y.cacheControl||y.expires)&&i.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const E=a.b(w)&&a.W()?w:yield this.readImageNow(w),R={type:this.type,uid:i.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const D=yield i.actor.sendAsync({type:"LDT",data:R});i.dem=D,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(y){if(delete i.abortController,i.aborted)i.state="unloaded";else if(y)throw i.state="errored",y}}))}readImageNow(i){return a._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&a.X()){const h=i.width+2,m=i.height+2;try{return new a.R({width:h,height:m},yield a.Y(i,-1,-1,h,m))}catch{}}return L.getImageData(i,1)}))}_getNeighboringTiles(i){const h=i.canonical,m=Math.pow(2,h.z),y=(h.x-1+m)%m,w=h.x===0?i.wrap-1:i.wrap,E=(h.x+1+m)%m,R=h.x+1===m?i.wrap+1:i.wrap,D={};return D[new a.Z(i.overscaledZ,w,h.z,y,h.y).key]={backfilled:!1},D[new a.Z(i.overscaledZ,R,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(D[new a.Z(i.overscaledZ,w,h.z,y,h.y-1).key]={backfilled:!1},D[new a.Z(i.overscaledZ,i.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},D[new a.Z(i.overscaledZ,R,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<m&&(D[new a.Z(i.overscaledZ,w,h.z,y,h.y+1).key]={backfilled:!1},D[new a.Z(i.overscaledZ,i.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},D[new a.Z(i.overscaledZ,R,h.z,E,h.y+1).key]={backfilled:!1}),D}unloadTile(i){return a._(this,void 0,void 0,(function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))}))}}class ki extends a.E{constructor(i,h,m,y){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:h.data},this.actor=m.getActor(),this.setEventedParent(y),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId,h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(h.buffer!==void 0?h.buffer:128),tolerance:this._pixelsToTileUnits(h.tolerance!==void 0?h.tolerance:.375),extent:a.$,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(h.clusterMaxZoom),minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.$,radius:this._pixelsToTileUnits(h.clusterRadius||50),log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(i){return i*(a.$/this.tileSize)}_getClusterMaxZoom(i){const h=i?Math.round(i):this.maxzoom-1;return Number.isInteger(i)||i===void 0||a.w(`Integer expected for option 'clusterMaxZoom': provided value "${i}" rounded to "${h}"`),h}load(){return a._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._pendingWorkerUpdate={data:i},this._updateWorkerData(),this}updateData(i){return this._pendingWorkerUpdate.diff=a.a0(this._pendingWorkerUpdate.diff,i),this._updateWorkerData(),this}getData(){return a._(this,void 0,void 0,(function*(){const i=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})}))}getCoordinatesFromGeometry(i){return i.type==="GeometryCollection"?i.geometries.map((h=>h.coordinates)).flat(1/0):i.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,(function*(){const i=new qn,h=yield this.getData();let m;switch(h.type){case"FeatureCollection":m=h.features.map((y=>this.getCoordinatesFromGeometry(y.geometry))).flat(1/0);break;case"Feature":m=this.getCoordinatesFromGeometry(h.geometry);break;default:m=this.getCoordinatesFromGeometry(h)}if(m.length==0)return i;for(let y=0;y<m.length-1;y+=2)i.extend([m[y],m[y+1]]);return i}))}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(i.clusterRadius)),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(i.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,h,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:h,offset:m}})}_updateWorkerData(){return a._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:i,diff:h}=this._pendingWorkerUpdate;if(!i&&!h)return void a.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const m=a.e({type:this.type},this.workerOptions);i?(typeof i=="string"?(m.request=this.map._requestManager.transformRequest(L.resolveURL(i),"Source"),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(i),this._pendingWorkerUpdate.data=void 0):h&&(m.dataDiff=h,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new a.l("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:m});if(this._isUpdatingWorker=!1,this._removed||y.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));this._data=y.data;let w=null;y.resourceTiming&&y.resourceTiming[this.id]&&(w=y.resourceTiming[this.id].slice(0));const E={dataType:"source"};this._collectResourceTiming&&w&&w.length>0&&a.e(E,{resourceTiming:w}),this.fire(new a.l("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},E),{sourceDataType:"content"})))}catch(y){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(y))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(i){return a._(this,void 0,void 0,(function*(){const h=i.actor?"RT":"LT";i.actor=this.actor;const m={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};i.abortController=new AbortController;const y=yield this.actor.sendAsync({type:h,data:m},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(y,this.map.painter,h==="RT")}))}abortTile(i){return a._(this,void 0,void 0,(function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0}))}unloadTile(i){return a._(this,void 0,void 0,(function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Di extends a.E{constructor(i,h,m,y){super(),this.flippedWindingOrder=!1,this.id=i,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=h}load(i){return a._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield Se.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,i&&(this.coordinates=i),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.k(h))}}))}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const h=i.map(a.a1.fromLngLat);var m;return this.tileID=(function(y){const w=a.a2.fromPoints(y),E=w.width(),R=w.height(),D=Math.max(E,R),B=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),U=Math.pow(2,B);return new a.a4(B,Math.floor((w.minX+w.maxX)/2*U),Math.floor((w.minY+w.maxY)/2*U))})(h),this.terrainTileRanges=this._getOverlappingTileRanges(h),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=h.map((y=>this.tileID.getTilePoint(y)._round())),this.flippedWindingOrder=((m=this.tileCoords)[1].x-m[0].x)*(m[2].y-m[0].y)-(m[1].y-m[0].y)*(m[2].x-m[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,h=i.gl;this.texture||(this.texture=new a.T(i,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,m=!0)}m&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return a._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(i){const{minX:h,minY:m,maxX:y,maxY:w}=a.a2.fromPoints(i),E={};for(let R=0;R<=a.a3;R++){const D=Math.pow(2,R),B=Math.floor(h*D),U=Math.floor(m*D),W=Math.floor(y*D),$=Math.floor(w*D);E[R]={minTileX:B,minTileY:U,maxTileX:W,maxTileY:$}}return E}}class Gi extends Di{constructor(i,h,m,y){super(i,h,m,y),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const h of i.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a5(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.k(h))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const h=this.video.seekable;i<h.start(0)||i>h.end(0)?this.fire(new a.k(new a.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,h=i.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(i,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,m=!0)}m&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class mi extends Di{constructor(i,h,m,y){super(i,h,m,y),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some((w=>!Array.isArray(w)||w.length!==2||w.some((E=>typeof E!="number"))))||this.fire(new a.k(new a.a6(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a6(`sources.${i}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.k(new a.a6(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a6(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a6(`sources.${i}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,m=h.gl;this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(h,this.canvas,m.RGBA,{premultiply:!0});let y=!1;for(const w in this.tiles){const E=this.tiles[w];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,y=!0)}y&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const bs={},To=x=>{switch(x){case"geojson":return ki;case"image":return Di;case"raster":return mn;case"raster-dem":return Us;case"vector":return pn;case"video":return Gi;case"canvas":return mi}return bs[x]},ea="RTLPluginLoaded";class So extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=vt()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch((h=>{throw this.status="error",h}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return a._(this,arguments,void 0,(function*(h,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=L.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return a._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l(ea))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ao=null;function so(){return Ao||(Ao=new So),Ao}class Po{constructor(i,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=a.a7(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const h=i+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,h,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=(function(y,w){const E={};if(!w)return E;for(const R of y){const D=R.layerIds.map((B=>w.getLayer(B))).filter(Boolean);if(D.length!==0){R.layers=D,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map((B=>D.filter((U=>U.id===B))[0])));for(const B of D)E[B.id]=R}}return E})(i.buckets,h?.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const w=this.buckets[y];if(w instanceof a.a9){if(this.hasSymbolBuckets=!0,!m)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const w=this.buckets[y];if(w instanceof a.a9&&w.hasRTLText){this.hasRTLText=!0,so().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const w=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(y).queryRadius(w))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),this.dashPositions=i.dashPositions}else this.collisionBoxArray=new a.a8}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const m in this.buckets){const y=this.buckets[m];y.uploadPending()&&y.upload(i)}const h=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new a.T(i,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(i,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,h,m,y,w,E,R,D,B,U,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:w,scale:E,tileSize:this.tileSize,pixelPosMatrix:U,transform:D,params:R,queryPadding:this.queryPadding*B,getElevation:W},i,h,m):{}}querySourceFeatures(i,h){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const y=m.loadVTLayers(),w=h&&h.sourceLayer?h.sourceLayer:"",E=y._geojsonTileLayer||y[w];if(!E)return;const R=a.aa(h?.filter,h?.globalState),{z:D,x:B,y:U}=this.tileID.canonical,W={z:D,x:B,y:U};for(let $=0;$<E.length;$++){const Z=E.feature($);if(R.needGeometry){const oe=a.ab(Z,!0);if(!R.filter(new a.F(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!R.filter(new a.F(this.tileID.overscaledZ),Z))continue;const J=m.getId(Z,w),ie=new a.ac(Z,D,B,U,J);ie.tile=W,i.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const h=this.expirationTime;if(i.cacheControl){const m=a.ad(i.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const m=Date.now();let y=!1;if(this.expirationTime>m)y=!1;else if(h)if(this.expirationTime<h)y=!0;else{const w=this.expirationTime-h;w?this.expirationTime=m+Math.max(w,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!h.style.hasLayer(y))continue;const w=this.buckets[y],E=w.layers[0].sourceLayer||"_geojsonTileLayer",R=m[E],D=i[E];if(!R||!D||Object.keys(D).length===0)continue;w.update(D,R,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const B=h&&h.style&&h.style.getLayer(y);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<L.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=L.now()+i}setDependencies(i,h){const m={};for(const y of h)m[y]=!0;this.dependencies[i]=m}hasDependency(i,h){for(const m of i){const y=this.dependencies[m];if(y){for(const w of h)if(y[w])return!0}}return!1}}class Le{constructor(i,h){this.max=i,this.onRemove=h,this.reset()}reset(){for(const i in this.data)for(const h of this.data[i])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(i,h,m){const y=i.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const w={value:h,timeout:void 0};if(m!==void 0&&(w.timeout=setTimeout((()=>{this.remove(i,w)}),m)),this.data[y].push(w),this.order.push(y),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const h=this.data[i].shift();return h.timeout&&clearTimeout(h.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),h.value}getByKey(i){const h=this.data[i];return h?h[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,h){if(!this.has(i))return this;const m=i.wrapped().key,y=h===void 0?0:this.data[m].indexOf(h),w=this.data[m][y];return this.data[m].splice(y,1),w.timeout&&clearTimeout(w.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(w.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(i){const h=[];for(const m in this.data)for(const y of this.data[m])i(y.value)||h.push(y);for(const m of h)this.remove(m.value.tileID,m)}}class Y{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,h,m){const y=String(h);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][y]=this.stateChanges[i][y]||{},a.e(this.stateChanges[i][y],m),this.deletedStates[i]===null){this.deletedStates[i]={};for(const w in this.state[i])w!==y&&(this.deletedStates[i][w]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][y]===null){this.deletedStates[i][y]={};for(const w in this.state[i][y])m[w]||(this.deletedStates[i][y][w]=null)}else for(const w in m)this.deletedStates[i]&&this.deletedStates[i][y]&&this.deletedStates[i][y][w]===null&&delete this.deletedStates[i][y][w]}removeFeatureState(i,h,m){if(this.deletedStates[i]===null)return;const y=String(h);if(this.deletedStates[i]=this.deletedStates[i]||{},m&&h!==void 0)this.deletedStates[i][y]!==null&&(this.deletedStates[i][y]=this.deletedStates[i][y]||{},this.deletedStates[i][y][m]=null);else if(h!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][y])for(m in this.deletedStates[i][y]={},this.stateChanges[i][y])this.deletedStates[i][y][m]=null;else this.deletedStates[i][y]=null;else this.deletedStates[i]=null}getState(i,h){const m=String(h),y=a.e({},(this.state[i]||{})[m],(this.stateChanges[i]||{})[m]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const w=this.deletedStates[i][h];if(w===null)return{};for(const E in w)delete y[E]}return y}initializeTileState(i,h){i.setFeatureState(this.state,h)}coalesceChanges(i,h){const m={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const w={};for(const E in this.stateChanges[y])this.state[y][E]||(this.state[y][E]={}),a.e(this.state[y][E],this.stateChanges[y][E]),w[E]=this.state[y][E];m[y]=w}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const w={};if(this.deletedStates[y]===null)for(const E in this.state[y])w[E]={},this.state[y][E]={};else for(const E in this.deletedStates[y]){if(this.deletedStates[y][E]===null)this.state[y][E]={};else for(const R of Object.keys(this.deletedStates[y][E]))delete this.state[y][E][R];w[E]=this.state[y][E]}m[y]=m[y]||{},a.e(m[y],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const y in i)i[y].setFeatureState(m,h)}}const K=89.25;function ne(x,i){const h=a.ah(i.lat,-a.ai,a.ai);return new a.P(a.V(i.lng)*x,a.U(h)*x)}function xe(x,i){return new a.a1(i.x/x,i.y/x).toLngLat()}function Ce(x){return x.cameraToCenterDistance*Math.min(.85*Math.tan(a.ae(90-x.pitch)),Math.tan(a.ae(K-x.pitch)))}function Fe(x,i){const h=x.canonical,m=i/a.af(h.z),y=h.x+Math.pow(2,h.z)*x.wrap,w=a.ag(new Float64Array(16));return a.M(w,w,[y*m,h.y*m,0]),a.N(w,w,[m/a.$,m/a.$,1]),w}function Ke(x,i,h,m,y){const w=a.a1.fromLngLat(x,i),E=y*a.aj(1,x.lat),R=E*Math.cos(a.ae(h)),D=Math.sqrt(E*E-R*R),B=D*Math.sin(a.ae(-m)),U=D*Math.cos(a.ae(-m));return new a.a1(w.x+B,w.y+U,w.z+R)}function Ue(x,i,h){const m=i.intersectsFrustum(x);if(!h||m===0)return m;const y=i.intersectsPlane(h);return y===0?0:m===2&&y===2?2:1}function it(x,i,h){let m=0;const y=(h-i)/10;for(let w=0;w<10;w++)m+=y*Math.pow(Math.cos(i+(w+.5)/10*(h-i)),x);return m}function yt(x,i){return function(h,m,y,w,E){const R=2*((x-1)/a.ak(Math.cos(a.ae(K-E))/Math.cos(a.ae(K)))-1),D=Math.acos(y/w),B=2*it(R-1,0,a.ae(E/2)),U=Math.min(a.ae(K),D+a.ae(E/2)),W=it(R-1,Math.min(U,D-a.ae(E/2)),U),$=Math.atan(m/y),Z=Math.hypot(m,y);let J=h;return J+=a.ak(w/Z/Math.max(.5,Math.cos(a.ae(E/2)))),J+=R*a.ak(Math.cos($))/2,J-=a.ak(Math.max(1,W/B/i))/2,J}}const at=yt(9.314,3);function Vt(x,i){const h=(i.roundZoom?Math.round:Math.floor)(x.zoom+a.ak(x.tileSize/i.tileSize));return Math.max(0,h)}function Be(x,i){const h=x.getCameraFrustum(),m=x.getClippingPlane(),y=x.screenPointToMercatorCoordinate(x.getCameraPoint()),w=a.a1.fromLngLat(x.center,x.elevation);y.z=w.z+Math.cos(x.pitchInRadians)*x.cameraToCenterDistance/x.worldSize;const E=x.getCoveringTilesDetailsProvider(),R=E.allowVariableZoom(x,i),D=Vt(x,i),B=i.minzoom||0,U=i.maxzoom!==void 0?i.maxzoom:x.maxZoom,W=Math.min(Math.max(0,D),U),$=Math.pow(2,W),Z=[$*y.x,$*y.y,0],J=[$*w.x,$*w.y,0],ie=Math.hypot(w.x-y.x,w.y-y.y),oe=Math.abs(w.z-y.z),ae=Math.hypot(ie,oe),de=we=>({zoom:0,x:0,y:0,wrap:we,fullyVisible:!1}),ye=[],he=[];if(x.renderWorldCopies&&E.allowWorldCopies())for(let we=1;we<=3;we++)ye.push(de(-we)),ye.push(de(we));for(ye.push(de(0));ye.length>0;){const we=ye.pop(),Me=we.x,_e=we.y;let Re=we.fullyVisible;const Ge={x:Me,y:_e,z:we.zoom},qe=E.getTileBoundingVolume(Ge,we.wrap,x.elevation,i);if(!Re){const xt=Ue(h,qe,m);if(xt===0)continue;Re=xt===2}const Ye=E.distanceToTile2d(y.x,y.y,Ge,qe);let tt=D;R&&(tt=(i.calculateTileZoom||at)(x.zoom+a.ak(x.tileSize/i.tileSize),Ye,oe,ae,x.fov)),tt=(i.roundZoom?Math.round:Math.floor)(tt),tt=Math.max(0,tt);const wt=Math.min(tt,U);if(we.wrap=E.getWrap(w,Ge,we.wrap),we.zoom>=wt){if(we.zoom<B)continue;const xt=W-we.zoom,ft=Z[0]-.5-(Me<<xt),Ut=Z[1]-.5-(_e<<xt),vn=i.reparseOverscaled?Math.max(we.zoom,tt):we.zoom;he.push({tileID:new a.Z(we.zoom===U?vn:we.zoom,we.wrap,we.zoom,Me,_e),distanceSq:a.al([J[0]-.5-Me,J[1]-.5-_e]),tileDistanceToCamera:Math.sqrt(ft*ft+Ut*Ut)})}else for(let xt=0;xt<4;xt++)ye.push({zoom:we.zoom+1,x:(Me<<1)+xt%2,y:(_e<<1)+(xt>>1),wrap:we.wrap,fullyVisible:Re})}return he.sort(((we,Me)=>we.distanceSq-Me.distanceSq)).map((we=>we.tileID))}const ln=a.a2.fromPoints([new a.P(0,0),new a.P(a.$,a.$)]);class Mn extends a.E{constructor(i,h,m){super(),this.id=i,this.dispatcher=m,this.on("data",(y=>this._dataHandler(y))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((y,w,E,R)=>{const D=new(To(w.type))(y,w,E,R);if(D.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${D.id}`);return D})(i,h,m,this),this._tiles={},this._cache=new Le(0,(y=>this._unloadTile(y))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Y,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const h=this._tiles[i];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,h,m){return a._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,h,m)}catch(y){i.state="errored",y.status!==404?this._source.fire(new a.k(y,{tile:i})):this.update(this.transform,this.terrain)}}))}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new a.l("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const m=this._tiles[h];m.upload(i),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((i=>i.tileID)).sort(qt).map((i=>i.key))}getRenderableIds(i){const h=[];for(const m in this._tiles)this._isIdRenderable(m,i)&&h.push(this._tiles[m]);return i?h.sort(((m,y)=>{const w=m.tileID,E=y.tileID,R=new a.P(w.canonical.x,w.canonical.y)._rotate(-this.transform.bearingInRadians),D=new a.P(E.canonical.x,E.canonical.y)._rotate(-this.transform.bearingInRadians);return w.overscaledZ-E.overscaledZ||D.y-R.y||D.x-R.x})).map((m=>m.tileID.key)):h.map((m=>m.tileID)).sort(qt).map((m=>m.key))}hasRenderableParent(i){const h=this.findLoadedParent(i,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(i,h){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(h||!this._tiles[i].holdingForFade())}reload(i){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const h in this._tiles)i?this._reloadTile(h,"expired"):this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")}}_reloadTile(i,h){return a._(this,void 0,void 0,(function*(){const m=this._tiles[i];m&&(m.state!=="loading"&&(m.state=h),yield this._loadTile(m,i,h))}))}_tileLoaded(i,h,m){i.timeAdded=L.now(),m==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(h,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const h=this.getRenderableIds();for(let y=0;y<h.length;y++){const w=h[y];if(i.neighboringTiles&&i.neighboringTiles[w]){const E=this.getTileByID(w);m(i,E),m(E,i)}}function m(y,w){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let E=w.tileID.canonical.x-y.tileID.canonical.x;const R=w.tileID.canonical.y-y.tileID.canonical.y,D=Math.pow(2,y.tileID.canonical.z),B=w.tileID.key;E===0&&R===0||Math.abs(R)>1||(Math.abs(E)>1&&(Math.abs(E+D)===1?E+=D:Math.abs(E-D)===1&&(E-=D)),w.dem&&y.dem&&(y.dem.backfillBorder(w.dem,E,R),y.neighboringTiles&&y.neighboringTiles[B]&&(y.neighboringTiles[B].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,h){const m=Object.values(i),y=this._getLoadedDescendents(m),w={};for(const E of m){const R=y[E.key];if(!R?.length){w[E.key]=E;continue}const D=E.overscaledZ+Mn.maxUnderzooming,B=R.filter(($=>$.tileID.overscaledZ<=D));if(!B.length){w[E.key]=E;continue}const U=Math.min(...B.map(($=>$.tileID.overscaledZ))),W=B.filter(($=>$.tileID.overscaledZ===U)).map(($=>$.tileID));for(const $ of W)h[$.key]=$;this._areDescendentsComplete(W,U,E.overscaledZ)||(w[E.key]=E)}return w}_getLoadedDescendents(i){var h;const m={};for(const y in this._tiles){const w=this._tiles[y];if(w.hasData())for(const E of i)w.tileID.isChildOf(E)&&(m[h=E.key]||(m[h]=[])).push(w)}return m}_areDescendentsComplete(i,h,m){return i.length===1&&i[0].isOverscaled()?i[0].overscaledZ===h:Math.pow(4,h-m)===i.length}findLoadedParent(i,h){if(i.key in this._loadedParentTiles){const m=this._loadedParentTiles[i.key];return m&&m.tileID.overscaledZ>=h?m:null}for(let m=i.overscaledZ-1;m>=h;m--){const y=i.scaledTo(m),w=this._getLoadedTile(y);if(w)return w}}findLoadedSibling(i){return this._getLoadedTile(i)}_getLoadedTile(i){const h=this._tiles[i.key];return h&&h.hasData()?h:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const h=Math.ceil(i.width/this._source.tileSize)+1,m=Math.ceil(i.height/this._source.tileSize)+1,y=Math.floor(h*m*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(i){const h=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,h){const m={};for(const y in this._tiles){const w=this._tiles[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+h),m[w.tileID.key]=w}this._tiles=m;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}update(i,h){if(!this._sourceLoaded||this._paused)return;let m;this.transform=i,this.terrain=h,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=i.getVisibleUnwrappedCoordinates(this._source.tileID).map((B=>new a.Z(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y))):(m=Be(i,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(m=m.filter((B=>this._source.hasTile(B))))):m=[],this.usedForTerrain&&(m=this._addTerrainIdealTiles(m));const y=Vt(i,this._source),w=Math.max(y-Mn.maxOverzooming,this._source.minzoom),E=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,E&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const R=this._updateRetainedTiles(m,y);_n(this._source.type)&&!h&&this._updateFadingTiles(R,w);for(const B in R)this._tiles[B].clearFadeHold();const D=a.am(this._tiles,R);for(const B of D){const U=this._tiles[B];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(B)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}_addTerrainIdealTiles(i){const h=[];for(const m of i)if(m.canonical.z>this._source.minzoom){const y=m.scaledTo(m.canonical.z-1);h.push(y);const w=m.scaledTo(Math.max(this._source.minzoom,Math.min(m.canonical.z,5)));h.push(w)}return i.concat(h)}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,h){var m;const y={},w={},E=Math.max(h-Mn.maxOverzooming,this._source.minzoom);let R={};for(const D of i){const B=this._addTile(D);y[D.key]=D,B.hasData()||(R[D.key]=D)}R=this._retainLoadedChildren(R,y);for(const D in R){const B=R[D];let U=this._tiles[D],W=U?.wasRequested();for(let $=B.overscaledZ-1;$>=E;--$){const Z=B.scaledTo($);if(w[Z.key])break;if(w[Z.key]=!0,U=this.getTile(Z),!U&&W&&(U=this._addTile(Z)),U){const J=U.hasData();if((J||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||W)&&(y[Z.key]=Z),W=U.wasRequested(),J)break}}}return y}_updateFadingTiles(i,h){const m={},y={},w=Object.keys(i),E=L.now();for(const R of w){const D=i[R],B=this._tiles[R];if(!B||B.fadeEndTime!==0&&B.fadeEndTime<=E)continue;const U=this.findLoadedParent(D,h),W=this.findLoadedSibling(D),$=U||W||null;$&&(this._addTile($.tileID),m[$.tileID.key]=$.tileID),y[R]=D}this._retainLoadedChildren(y,i);for(const R in m)i[R]||(this._coveredTiles[R]=!0,i[R]=m[R])}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const h=[];let m,y=this._tiles[i].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){m=this._loadedParentTiles[y.key];break}h.push(y.key);const w=y.scaledTo(y.overscaledZ-1);if(m=this._getLoadedTile(w),m)break;y=w}for(const w of h)this._loadedParentTiles[w]=m}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const i in this._tiles){const h=this._tiles[i].tileID,m=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=m}}_addTile(i){let h=this._tiles[i.key];if(h)return h;h=this._cache.getAndRemove(i),h&&(this._setTileReloadTimer(i.key,h),h.tileID=i,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,h)));const m=h;return h||(h=new Po(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(h,i.key,h.state)),h.uses++,this._tiles[i.key]=h,m||this._source.fire(new a.l("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(i,h){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const m=h.getExpiryTimeout();m&&(this._timers[i]=setTimeout((()=>{this._reloadTile(i,"expired"),delete this._timers[i]}),m))}refreshTiles(i){for(const h in this._tiles)(this._isIdRenderable(h)||this._tiles[h].state=="errored")&&i.some((m=>m.equals(this._tiles[h].tileID.canonical)))&&this._reloadTile(h,"expired")}_removeTile(i){const h=this._tiles[i];h&&(h.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(i){const h=i.sourceDataType;i.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&h==="content"&&(this.reload(i.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,h,m){const y=[],w=this.transform;if(!w)return y;const E=w.getCoveringTilesDetailsProvider().allowWorldCopies(),R=m?w.getCameraQueryGeometry(i):i,D=Z=>w.screenPointToMercatorCoordinate(Z,this.terrain),B=this.transformBbox(i,D,!E),U=this.transformBbox(R,D,!E),W=this.getIds(),$=a.a2.fromPoints(U);for(let Z=0;Z<W.length;Z++){const J=this._tiles[W[Z]];if(J.holdingForFade())continue;const ie=E?[J.tileID]:[J.tileID.unwrapTo(-1),J.tileID.unwrapTo(0)],oe=Math.pow(2,w.zoom-J.tileID.overscaledZ),ae=h*J.queryPadding*a.$/J.tileSize/oe;for(const de of ie){const ye=$.map((he=>de.getTilePoint(new a.a1(he.x,he.y))));if(ye.expandBy(ae),ye.intersects(ln)){const he=B.map((Me=>de.getTilePoint(Me))),we=U.map((Me=>de.getTilePoint(Me)));y.push({tile:J,tileID:E?de:de.unwrapTo(0),queryGeometry:he,cameraQueryGeometry:we,scale:oe})}}}return y}transformBbox(i,h,m){let y=i.map(h);if(m){const w=a.a2.fromPoints(i);w.shrinkBy(.001*Math.min(w.width(),w.height()));const E=w.map(h);a.a2.fromPoints(y).covers(E)||(y=y.map((R=>R.x>.5?new a.a1(R.x-1,R.y,R.z):R)))}return y}getVisibleCoordinates(i){const h=this.getRenderableIds(i).map((m=>this._tiles[m].tileID));return this.transform&&this.transform.populateCache(h),h}hasTransition(){if(this._source.hasTransition())return!0;if(_n(this._source.type)){const i=L.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=i)return!0}return!1}setFeatureState(i,h,m){this._state.updateState(i=i||"_geojsonTileLayer",h,m)}removeFeatureState(i,h,m){this._state.removeFeatureState(i=i||"_geojsonTileLayer",h,m)}getFeatureState(i,h){return this._state.getState(i=i||"_geojsonTileLayer",h)}setDependencies(i,h,m){const y=this._tiles[i];y&&y.setDependencies(h,m)}reloadTilesForDependencies(i,h){for(const m in this._tiles)this._tiles[m].hasDependency(i,h)&&this._reloadTile(m,"reloading");this._cache.filter((m=>!m.hasDependency(i,h)))}}function qt(x,i){const h=Math.abs(2*x.wrap)-+(x.wrap<0),m=Math.abs(2*i.wrap)-+(i.wrap<0);return x.overscaledZ-i.overscaledZ||m-h||i.canonical.y-x.canonical.y||i.canonical.x-x.canonical.x}function _n(x){return x==="raster"||x==="image"||x==="video"}Mn.maxOverzooming=10,Mn.maxUnderzooming=3;class sr{constructor(i,h){this.reset(i,h)}reset(i,h){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=a.ah(i,0,1);let h=1,m=this._distances[h];const y=i*this.paddedLength+this.padding;for(;m<y&&h<this._distances.length;)m=this._distances[++h];const w=h-1,E=this._distances[w],R=m-E,D=R>0?(y-E)/R:0;return this.points[w].mult(1-D).add(this.points[h].mult(D))}}function Tr(x,i){let h=!0;return x==="always"||x!=="never"&&i!=="never"||(h=!1),h}class zr{constructor(i,h,m){const y=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(h/m);for(let E=0;E<this.xCellCount*this.yCellCount;E++)y.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=h,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,h,m,y,w){this._forEachCell(h,m,y,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(w)}insertCircle(i,h,m,y){this._forEachCell(h-y,m-y,h+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(h),this.circles.push(m),this.circles.push(y)}_insertBoxCell(i,h,m,y,w,E){this.boxCells[w].push(E)}_insertCircleCell(i,h,m,y,w,E){this.circleCells[w].push(E)}_query(i,h,m,y,w,E,R){if(m<0||i>this.width||y<0||h>this.height)return[];const D=[];if(i<=0&&h<=0&&this.width<=m&&this.height<=y){if(w)return[{key:null,x1:i,y1:h,x2:m,y2:y}];for(let B=0;B<this.boxKeys.length;B++)D.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const U=this.circles[3*B],W=this.circles[3*B+1],$=this.circles[3*B+2];D.push({key:this.circleKeys[B],x1:U-$,y1:W-$,x2:U+$,y2:W+$})}}else this._forEachCell(i,h,m,y,this._queryCell,D,{hitTest:w,overlapMode:E,seenUids:{box:{},circle:{}}},R);return D}query(i,h,m,y){return this._query(i,h,m,y,!1,null)}hitTest(i,h,m,y,w,E){return this._query(i,h,m,y,!0,w,E).length>0}hitTestCircle(i,h,m,y,w){const E=i-m,R=i+m,D=h-m,B=h+m;if(R<0||E>this.width||B<0||D>this.height)return!1;const U=[];return this._forEachCell(E,D,R,B,this._queryCellCircle,U,{hitTest:!0,overlapMode:y,circle:{x:i,y:h,radius:m},seenUids:{box:{},circle:{}}},w),U.length>0}_queryCell(i,h,m,y,w,E,R,D){const{seenUids:B,hitTest:U,overlapMode:W}=R,$=this.boxCells[w];if($!==null){const J=this.bboxes;for(const ie of $)if(!B.box[ie]){B.box[ie]=!0;const oe=4*ie,ae=this.boxKeys[ie];if(i<=J[oe+2]&&h<=J[oe+3]&&m>=J[oe+0]&&y>=J[oe+1]&&(!D||D(ae))&&(!U||!Tr(W,ae.overlapMode))&&(E.push({key:ae,x1:J[oe],y1:J[oe+1],x2:J[oe+2],y2:J[oe+3]}),U))return!0}}const Z=this.circleCells[w];if(Z!==null){const J=this.circles;for(const ie of Z)if(!B.circle[ie]){B.circle[ie]=!0;const oe=3*ie,ae=this.circleKeys[ie];if(this._circleAndRectCollide(J[oe],J[oe+1],J[oe+2],i,h,m,y)&&(!D||D(ae))&&(!U||!Tr(W,ae.overlapMode))){const de=J[oe],ye=J[oe+1],he=J[oe+2];if(E.push({key:ae,x1:de-he,y1:ye-he,x2:de+he,y2:ye+he}),U)return!0}}}return!1}_queryCellCircle(i,h,m,y,w,E,R,D){const{circle:B,seenUids:U,overlapMode:W}=R,$=this.boxCells[w];if($!==null){const J=this.bboxes;for(const ie of $)if(!U.box[ie]){U.box[ie]=!0;const oe=4*ie,ae=this.boxKeys[ie];if(this._circleAndRectCollide(B.x,B.y,B.radius,J[oe+0],J[oe+1],J[oe+2],J[oe+3])&&(!D||D(ae))&&!Tr(W,ae.overlapMode))return E.push(!0),!0}}const Z=this.circleCells[w];if(Z!==null){const J=this.circles;for(const ie of Z)if(!U.circle[ie]){U.circle[ie]=!0;const oe=3*ie,ae=this.circleKeys[ie];if(this._circlesCollide(J[oe],J[oe+1],J[oe+2],B.x,B.y,B.radius)&&(!D||D(ae))&&!Tr(W,ae.overlapMode))return E.push(!0),!0}}}_forEachCell(i,h,m,y,w,E,R,D){const B=this._convertToXCellCoord(i),U=this._convertToYCellCoord(h),W=this._convertToXCellCoord(m),$=this._convertToYCellCoord(y);for(let Z=B;Z<=W;Z++)for(let J=U;J<=$;J++)if(w.call(this,i,h,m,y,this.xCellCount*J+Z,E,R,D))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,h,m,y,w,E){const R=y-i,D=w-h,B=m+E;return B*B>R*R+D*D}_circleAndRectCollide(i,h,m,y,w,E,R){const D=(E-y)/2,B=Math.abs(i-(y+D));if(B>D+m)return!1;const U=(R-w)/2,W=Math.abs(h-(w+U));if(W>U+m)return!1;if(B<=D||W<=U)return!0;const $=B-D,Z=W-U;return $*$+Z*Z<=m*m}}function Sr(x,i,h){const m=a.L();if(!x){const{vecSouth:W,vecEast:$}=Gn(i),Z=A();Z[0]=$[0],Z[1]=$[1],Z[2]=W[0],Z[3]=W[1],y=Z,(U=(E=(w=Z)[0])*(B=w[3])-(D=w[2])*(R=w[1]))&&(y[0]=B*(U=1/U),y[1]=-R*U,y[2]=-D*U,y[3]=E*U),m[0]=Z[0],m[1]=Z[1],m[4]=Z[2],m[5]=Z[3]}var y,w,E,R,D,B,U;return a.N(m,m,[1/h,1/h,1]),m}function Rr(x,i,h,m){if(x){const y=a.L();if(!i){const{vecSouth:w,vecEast:E}=Gn(h);y[0]=E[0],y[1]=E[1],y[4]=w[0],y[5]=w[1]}return a.N(y,y,[m,m,1]),y}return h.pixelsToClipSpaceMatrix}function Gn(x){const i=Math.cos(x.rollInRadians),h=Math.sin(x.rollInRadians),m=Math.cos(x.pitchInRadians),y=Math.cos(x.bearingInRadians),w=Math.sin(x.bearingInRadians),E=a.ar();E[0]=-y*m*h-w*i,E[1]=-w*m*h+y*i;const R=a.as(E);R<1e-9?a.at(E):a.au(E,E,1/R);const D=a.ar();D[0]=y*m*i-w*h,D[1]=w*m*i+y*h;const B=a.as(D);return B<1e-9?a.at(D):a.au(D,D,1/B),{vecEast:D,vecSouth:E}}function kr(x,i,h,m){let y;m?(y=[x,i,m(x,i),1],a.aw(y,y,h)):(y=[x,i,0,1],Il(y,y,h));const w=y[3];return{point:new a.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function lt(x,i){return .5+x/i*.5}function yr(x,i){return x.x>=-i[0]&&x.x<=i[0]&&x.y>=-i[1]&&x.y<=i[1]}function gi(x,i,h,m,y,w,E,R,D,B,U,W,$){const Z=h?x.textSizeData:x.iconSizeData,J=a.an(Z,i.transform.zoom),ie=[256/i.width*2+1,256/i.height*2+1],oe=h?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;oe.clear();const ae=x.lineVertexArray,de=h?x.text.placedSymbolArray:x.icon.placedSymbolArray,ye=i.transform.width/i.transform.height;let he=!1;for(let we=0;we<de.length;we++){const Me=de.get(we);if(Me.hidden||Me.writingMode===a.ao.vertical&&!he){oo(Me.numGlyphs,oe);continue}he=!1;const _e=new a.P(Me.anchorX,Me.anchorY),Re={getElevation:$,pitchedLabelPlaneMatrix:m,lineVertexArray:ae,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:i.transform,tileAnchorPoint:_e,unwrappedTileID:D,width:B,height:U,translation:W},Ge=na(Me.anchorX,Me.anchorY,Re);if(!yr(Ge.point,ie)){oo(Me.numGlyphs,oe);continue}const qe=lt(i.transform.cameraToCenterDistance,Ge.signedDistanceFromCamera),Ye=a.ap(Z,J,Me),tt=w?Ye*i.transform.getPitchedTextCorrection(Me.anchorX,Me.anchorY,D)/qe:Ye*qe,wt=St({projectionContext:Re,pitchedLabelPlaneMatrixInverse:y,symbol:Me,fontSize:tt,flip:!1,keepUpright:E,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:ye,rotateToLine:R});he=wt.useVertical,(wt.notEnoughRoom||he||wt.needsFlipping&&St({projectionContext:Re,pitchedLabelPlaneMatrixInverse:y,symbol:Me,fontSize:tt,flip:!0,keepUpright:E,glyphOffsetArray:x.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:ye,rotateToLine:R}).notEnoughRoom)&&oo(Me.numGlyphs,oe)}h?x.text.dynamicLayoutVertexBuffer.updateData(oe):x.icon.dynamicLayoutVertexBuffer.updateData(oe)}function Eo(x,i,h,m,y,w,E,R){const D=w.glyphStartIndex+w.numGlyphs,B=w.lineStartIndex,U=w.lineStartIndex+w.lineLength,W=i.getoffsetX(w.glyphStartIndex),$=i.getoffsetX(D-1),Z=Co(x*W,h,m,y,w.segment,B,U,R,E);if(!Z)return null;const J=Co(x*$,h,m,y,w.segment,B,U,R,E);return J?R.projectionCache.anyProjectionOccluded?null:{first:Z,last:J}:null}function _i(x,i,h,m){return x===a.ao.horizontal&&Math.abs(h.y-i.y)>Math.abs(h.x-i.x)*m?{useVertical:!0}:(x===a.ao.vertical?i.y<h.y:i.x>h.x)?{needsFlipping:!0}:null}function St(x){const{projectionContext:i,pitchedLabelPlaneMatrixInverse:h,symbol:m,fontSize:y,flip:w,keepUpright:E,glyphOffsetArray:R,dynamicLayoutVertexArray:D,aspectRatio:B,rotateToLine:U}=x,W=y/24,$=m.lineOffsetX*W,Z=m.lineOffsetY*W;let J;if(m.numGlyphs>1){const ie=m.glyphStartIndex+m.numGlyphs,oe=m.lineStartIndex,ae=m.lineStartIndex+m.lineLength,de=Eo(W,R,$,Z,w,m,U,i);if(!de)return{notEnoughRoom:!0};const ye=ta(de.first.point.x,de.first.point.y,i,h),he=ta(de.last.point.x,de.last.point.y,i,h);if(E&&!w){const we=_i(m.writingMode,ye,he,B);if(we)return we}J=[de.first];for(let we=m.glyphStartIndex+1;we<ie-1;we++){const Me=Co(W*R.getoffsetX(we),$,Z,w,m.segment,oe,ae,i,U);if(!Me)return{notEnoughRoom:!0};J.push(Me)}J.push(de.last)}else{if(E&&!w){const oe=Yr(i.tileAnchorPoint.x,i.tileAnchorPoint.y,i).point,ae=m.lineStartIndex+m.segment+1,de=new a.P(i.lineVertexArray.getx(ae),i.lineVertexArray.gety(ae)),ye=Yr(de.x,de.y,i),he=ye.signedDistanceFromCamera>0?ye.point:bn(i.tileAnchorPoint,de,oe,1,i),we=ta(oe.x,oe.y,i,h),Me=ta(he.x,he.y,i,h),_e=_i(m.writingMode,we,Me,B);if(_e)return _e}const ie=Co(W*R.getoffsetX(m.glyphStartIndex),$,Z,w,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,i,U);if(!ie||i.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};J=[ie]}for(const ie of J)a.av(D,ie.point,ie.angle);return{}}function bn(x,i,h,m,y){const w=x.add(x.sub(i)._unit()),E=Yr(w.x,w.y,y).point,R=h.sub(E);return h.add(R._mult(m/R.mag()))}function dn(x,i,h){const m=i.projectionCache;if(m.projections[x])return m.projections[x];const y=new a.P(i.lineVertexArray.getx(x),i.lineVertexArray.gety(x)),w=Yr(y.x,y.y,i);if(w.signedDistanceFromCamera>0)return m.projections[x]=w.point,m.anyProjectionOccluded=m.anyProjectionOccluded||w.isOccluded,w.point;const E=x-h.direction;return bn(h.distanceFromAnchor===0?i.tileAnchorPoint:new a.P(i.lineVertexArray.getx(E),i.lineVertexArray.gety(E)),y,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,i)}function Yr(x,i,h){const m=x+h.translation[0],y=i+h.translation[1];let w;return h.pitchWithMap?(w=kr(m,y,h.pitchedLabelPlaneMatrix,h.getElevation),w.isOccluded=!1):(w=h.transform.projectTileCoordinates(m,y,h.unwrappedTileID,h.getElevation),w.point.x=(.5*w.point.x+.5)*h.width,w.point.y=(.5*-w.point.y+.5)*h.height),w}function ta(x,i,h,m){if(h.pitchWithMap){const y=[x,i,0,1];return a.aw(y,y,m),h.transform.projectTileCoordinates(y[0]/y[3],y[1]/y[3],h.unwrappedTileID,h.getElevation).point}return{x:x/h.width*2-1,y:1-i/h.height*2}}function na(x,i,h){return h.transform.projectTileCoordinates(x,i,h.unwrappedTileID,h.getElevation)}function yn(x,i,h){return x._unit()._perp()._mult(i*h)}function Mc(x,i,h,m,y,w,E,R,D){if(R.projectionCache.offsets[x])return R.projectionCache.offsets[x];const B=h.add(i);if(x+D.direction<m||x+D.direction>=y)return R.projectionCache.offsets[x]=B,B;const U=dn(x+D.direction,R,D),W=yn(U.sub(h),E,D.direction),$=h.add(W),Z=U.add(W);return R.projectionCache.offsets[x]=a.ax(w,B,$,Z)||B,R.projectionCache.offsets[x]}function Co(x,i,h,m,y,w,E,R,D){const B=m?x-i:x+i;let U=B>0?1:-1,W=0;m&&(U*=-1,W=Math.PI),U<0&&(W+=Math.PI);let $,Z=U>0?w+y:w+y+1;R.projectionCache.cachedAnchorPoint?$=R.projectionCache.cachedAnchorPoint:($=Yr(R.tileAnchorPoint.x,R.tileAnchorPoint.y,R).point,R.projectionCache.cachedAnchorPoint=$);let J,ie,oe=$,ae=$,de=0,ye=0;const he=Math.abs(B),we=[];let Me;for(;de+ye<=he;){if(Z+=U,Z<w||Z>=E)return null;de+=ye,ae=oe,ie=J;const Ge={absOffsetX:he,direction:U,distanceFromAnchor:de,previousVertex:ae};if(oe=dn(Z,R,Ge),h===0)we.push(ae),Me=oe.sub(ae);else{let qe;const Ye=oe.sub(ae);qe=Ye.mag()===0?yn(dn(Z+U,R,Ge).sub(oe),h,U):yn(Ye,h,U),ie||(ie=ae.add(qe)),J=Mc(Z,qe,oe,w,E,ie,h,R,Ge),we.push(ie),Me=J.sub(ie)}ye=Me.mag()}const _e=Me._mult((he-de)/ye)._add(ie||ae),Re=W+Math.atan2(oe.y-ae.y,oe.x-ae.x);return we.push(_e),{point:_e,angle:D?Re:0,path:we}}const Rc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function oo(x,i){for(let h=0;h<x;h++){const m=i.length;i.resize(m+4),i.float32.set(Rc,3*m)}}function Il(x,i,h){const m=i[0],y=i[1];return x[0]=h[0]*m+h[4]*y+h[12],x[1]=h[1]*m+h[5]*y+h[13],x[3]=h[3]*m+h[7]*y+h[15],x}const An=100;class ku{constructor(i,h=new zr(i.width+200,i.height+200,25),m=new zr(i.width+200,i.height+200,25)){this.transform=i,this.grid=h,this.ignoredGrid=m,this.pitchFactor=Math.cos(i.pitch*Math.PI/180)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+An,this.screenBottomBoundary=i.height+An,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,h,m,y,w,E,R,D,B,U,W,$){const Z=this.projectAndGetPerspectiveRatio(i.anchorPointX+D[0],i.anchorPointY+D[1],w,U,$),J=m*Z.perspectiveRatio;let ie;if(E||R)ie=this._projectCollisionBox(i,J,y,w,E,R,D,Z,U,W,$);else{const Me=Z.x+(W?W.x*J:0),_e=Z.y+(W?W.y*J:0);ie={allPointsOccluded:!1,box:[Me+i.x1*J,_e+i.y1*J,Me+i.x2*J,_e+i.y2*J]}}const[oe,ae,de,ye]=ie.box,he=E?ie.allPointsOccluded:Z.isOccluded;let we=he;return we||(we=Z.perspectiveRatio<this.perspectiveRatioCutoff),we||(we=!this.isInsideGrid(oe,ae,de,ye)),we||h!=="always"&&this.grid.hitTest(oe,ae,de,ye,h,B)?{box:[oe,ae,de,ye],placeable:!1,offscreen:!1,occluded:he}:{box:[oe,ae,de,ye],placeable:!0,offscreen:this.isOffscreen(oe,ae,de,ye),occluded:he}}placeCollisionCircles(i,h,m,y,w,E,R,D,B,U,W,$,Z,J){const ie=[],oe=new a.P(h.anchorX,h.anchorY),ae=this.getPerspectiveRatio(oe.x,oe.y,E,J),de=(B?w*this.transform.getPitchedTextCorrection(h.anchorX,h.anchorY,E)/ae:w*ae)/a.aB,ye={getElevation:J,pitchedLabelPlaneMatrix:R,lineVertexArray:m,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:oe,unwrappedTileID:E,width:this.transform.width,height:this.transform.height,translation:Z},he=Eo(de,y,h.lineOffsetX*de,h.lineOffsetY*de,!1,h,!1,ye);let we=!1,Me=!1,_e=!0;if(he){const Re=.5*W*ae+$,Ge=new a.P(-100,-100),qe=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Ye=new sr,tt=he.first,wt=he.last;let xt=[];for(let vn=tt.path.length-1;vn>=1;vn--)xt.push(tt.path[vn]);for(let vn=1;vn<wt.path.length;vn++)xt.push(wt.path[vn]);const ft=2.5*Re;if(B){const vn=this.projectPathToScreenSpace(xt,ye);xt=vn.some((Zn=>Zn.signedDistanceFromCamera<=0))?[]:vn.map((Zn=>Zn.point))}let Ut=[];if(xt.length>0){const vn=xt[0].clone(),Zn=xt[0].clone();for(let lr=1;lr<xt.length;lr++)vn.x=Math.min(vn.x,xt[lr].x),vn.y=Math.min(vn.y,xt[lr].y),Zn.x=Math.max(Zn.x,xt[lr].x),Zn.y=Math.max(Zn.y,xt[lr].y);Ut=vn.x>=Ge.x&&Zn.x<=qe.x&&vn.y>=Ge.y&&Zn.y<=qe.y?[xt]:Zn.x<Ge.x||vn.x>qe.x||Zn.y<Ge.y||vn.y>qe.y?[]:a.ay([xt],Ge.x,Ge.y,qe.x,qe.y)}for(const vn of Ut){Ye.reset(vn,.25*Re);let Zn=0;Zn=Ye.length<=.5*Re?1:Math.ceil(Ye.paddedLength/ft)+1;for(let lr=0;lr<Zn;lr++){const ir=lr/Math.max(Zn-1,1),tr=Ye.lerp(ir),cr=tr.x+An,Ir=tr.y+An;ie.push(cr,Ir,Re,0);const nr=cr-Re,Kn=Ir-Re,fr=cr+Re,Sn=Ir+Re;if(_e=_e&&this.isOffscreen(nr,Kn,fr,Sn),Me=Me||this.isInsideGrid(nr,Kn,fr,Sn),i!=="always"&&this.grid.hitTestCircle(cr,Ir,Re,i,U)&&(we=!0,!D))return{circles:[],offscreen:!1,collisionDetected:we}}}}return{circles:!D&&we||!Me||ae<this.perspectiveRatioCutoff?[]:ie,offscreen:_e,collisionDetected:we}}projectPathToScreenSpace(i,h){const m=(function(y,w){const E=a.L();return a.aq(E,w.pitchedLabelPlaneMatrix),y.map((R=>{const D=kr(R.x,R.y,E,w.getElevation),B=w.transform.projectTileCoordinates(D.point.x,D.point.y,w.unwrappedTileID,w.getElevation);return B.point.x=(.5*B.point.x+.5)*w.width,B.point.y=(.5*-B.point.y+.5)*w.height,B}))})(i,h);return(function(y){let w=0,E=0,R=0,D=0;for(let B=0;B<y.length;B++)y[B].isOccluded?(R=B+1,D=0):(D++,D>E&&(E=D,w=R));return y.slice(w,w+E)})(m)}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[],m=new a.a2;for(const W of i){const $=new a.P(W.x+An,W.y+An);m.extend($),h.push($)}const{minX:y,minY:w,maxX:E,maxY:R}=m,D=this.grid.query(y,w,E,R).concat(this.ignoredGrid.query(y,w,E,R)),B={},U={};for(const W of D){const $=W.key;if(B[$.bucketInstanceId]===void 0&&(B[$.bucketInstanceId]={}),B[$.bucketInstanceId][$.featureIndex])continue;const Z=[new a.P(W.x1,W.y1),new a.P(W.x2,W.y1),new a.P(W.x2,W.y2),new a.P(W.x1,W.y2)];a.az(h,Z)&&(B[$.bucketInstanceId][$.featureIndex]=!0,U[$.bucketInstanceId]===void 0&&(U[$.bucketInstanceId]=[]),U[$.bucketInstanceId].push($.featureIndex))}return U}insertCollisionBox(i,h,m,y,w,E){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:E,overlapMode:h},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,h,m,y,w,E){const R=m?this.ignoredGrid:this.grid,D={bucketInstanceId:y,featureIndex:w,collisionGroupID:E,overlapMode:h};for(let B=0;B<i.length;B+=4)R.insertCircle(D,i[B],i[B+1],i[B+2])}projectAndGetPerspectiveRatio(i,h,m,y,w){if(w){let E;y?(E=[i,h,y(i,h),1],a.aw(E,E,w)):(E=[i,h,0,1],Il(E,E,w));const R=E[3];return{x:(E[0]/R+1)/2*this.transform.width+An,y:(-E[1]/R+1)/2*this.transform.height+An,perspectiveRatio:.5+this.transform.cameraToCenterDistance/R*.5,isOccluded:!1,signedDistanceFromCamera:R}}{const E=this.transform.projectTileCoordinates(i,h,m,y);return{x:(E.point.x+1)/2*this.transform.width+An,y:(1-E.point.y)/2*this.transform.height+An,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E.signedDistanceFromCamera*.5,isOccluded:E.isOccluded,signedDistanceFromCamera:E.signedDistanceFromCamera}}}getPerspectiveRatio(i,h,m,y){const w=this.transform.projectTileCoordinates(i,h,m,y);return .5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5}isOffscreen(i,h,m,y){return m<An||i>=this.screenRightBoundary||y<An||h>this.screenBottomBoundary}isInsideGrid(i,h,m,y){return m>=0&&i<this.gridRightBoundary&&y>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const i=a.ag([]);return a.M(i,i,[-100,-100,0]),i}_projectCollisionBox(i,h,m,y,w,E,R,D,B,U,W){let $=1,Z=0,J=0,ie=1;const oe=i.anchorPointX+R[0],ae=i.anchorPointY+R[1];if(E&&!w){const xt=this.projectAndGetPerspectiveRatio(oe+1,ae,y,B,W),ft=xt.x-D.x,Ut=Math.atan((xt.y-D.y)/ft)+(ft<0?Math.PI:0),vn=Math.sin(Ut),Zn=Math.cos(Ut);$=Zn,Z=vn,J=-vn,ie=Zn}else if(!E&&w){const xt=Gn(this.transform);$=xt.vecEast[0],Z=xt.vecEast[1],J=xt.vecSouth[0],ie=xt.vecSouth[1]}let de=D.x,ye=D.y,he=h;w&&(de=oe,ye=ae,he=Math.pow(2,-(this.transform.zoom-m.overscaledZ)),he*=this.transform.getPitchedTextCorrection(oe,ae,y),U||(he*=a.ah(.5+D.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),U&&(de+=$*U.x*he+J*U.y*he,ye+=Z*U.x*he+ie*U.y*he);const we=i.x1*he,Me=i.x2*he,_e=(we+Me)/2,Re=i.y1*he,Ge=i.y2*he,qe=(Re+Ge)/2,Ye=[{offsetX:we,offsetY:Re},{offsetX:_e,offsetY:Re},{offsetX:Me,offsetY:Re},{offsetX:Me,offsetY:qe},{offsetX:Me,offsetY:Ge},{offsetX:_e,offsetY:Ge},{offsetX:we,offsetY:Ge},{offsetX:we,offsetY:qe}];let tt=[];for(const{offsetX:xt,offsetY:ft}of Ye)tt.push(new a.P(de+$*xt+J*ft,ye+Z*xt+ie*ft));let wt=!1;if(w){const xt=tt.map((ft=>this.projectAndGetPerspectiveRatio(ft.x,ft.y,y,B,W)));wt=xt.some((ft=>!ft.isOccluded)),tt=xt.map((ft=>new a.P(ft.x,ft.y)))}else wt=!0;return{box:a.aA(tt),allPointsOccluded:!wt}}}class yi{constructor(i,h,m,y){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?h:-h))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Qn{constructor(i,h,m,y,w){this.text=new yi(i?i.text:null,h,m,w),this.icon=new yi(i?i.icon:null,h,y,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kc{constructor(i,h,m){this.text=i,this.icon=h,this.skipFade=m}}class Dc{constructor(i,h,m,y,w){this.bucketInstanceId=i,this.featureIndex=h,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=w}}class Du{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const h=++this.maxGroupID;this.collisionGroups[i]={ID:h,predicate:m=>m.collisionGroupID===h}}return this.collisionGroups[i]}}function Vs(x,i,h,m,y){const{horizontalAlign:w,verticalAlign:E}=a.aH(x);return new a.P(-(w-.5)*i+m[0]*y,-(E-.5)*h+m[1]*y)}class ai{constructor(i,h,m,y,w){this.transform=i.clone(),this.terrain=h,this.collisionIndex=new ku(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Du(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const h=this.terrain;return h?(m,y)=>h.getElevation(i,m,y):null}getBucketParts(i,h,m,y){const w=m.getBucket(h),E=m.latestFeatureIndex;if(!w||!E||h.id!==w.layerIds[0])return;const R=m.collisionBoxArray,D=w.layers[0].layout,B=w.layers[0].paint,U=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),W=m.tileSize/a.$,$=m.tileID.toUnwrapped(),Z=D.get("text-rotation-alignment")==="map",J=a.aC(m,1,this.transform.zoom),ie=a.aD(this.collisionIndex.transform,m,B.get("text-translate"),B.get("text-translate-anchor")),oe=a.aD(this.collisionIndex.transform,m,B.get("icon-translate"),B.get("icon-translate-anchor")),ae=Sr(Z,this.transform,J);this.retainedQueryData[w.bucketInstanceId]=new Dc(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,m.tileID);const de={bucket:w,layout:D,translationText:ie,translationIcon:oe,unwrappedTileID:$,pitchedLabelPlaneMatrix:ae,scale:U,textPixelRatio:W,holdingForFade:m.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:a.an(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(y)for(const ye of w.sortKeyRanges){const{sortKey:he,symbolInstanceStart:we,symbolInstanceEnd:Me}=ye;i.push({sortKey:he,symbolInstanceStart:we,symbolInstanceEnd:Me,parameters:de})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:de})}attemptAnchorPlacement(i,h,m,y,w,E,R,D,B,U,W,$,Z,J,ie,oe,ae,de,ye,he){const we=a.aE[i.textAnchor],Me=[i.textOffset0,i.textOffset1],_e=Vs(we,m,y,Me,w),Re=this.collisionIndex.placeCollisionBox(h,$,D,B,U,R,E,oe,W.predicate,ye,_e,he);if((!de||this.collisionIndex.placeCollisionBox(de,$,D,B,U,R,E,ae,W.predicate,ye,_e,he).placeable)&&Re.placeable){let Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:Me,width:m,height:y,anchor:we,textBoxScale:w,prevAnchor:Ge},this.markUsedJustification(J,we,Z,ie),J.allowVerticalPlacement&&(this.markUsedOrientation(J,ie,Z),this.placedOrientations[Z.crossTileID]=ie),{shift:_e,placedGlyphBoxes:Re}}}placeLayerBucketPart(i,h,m){const{bucket:y,layout:w,translationText:E,translationIcon:R,unwrappedTileID:D,pitchedLabelPlaneMatrix:B,textPixelRatio:U,holdingForFade:W,collisionBoxArray:$,partiallyEvaluatedTextSize:Z,collisionGroup:J}=i.parameters,ie=w.get("text-optional"),oe=w.get("icon-optional"),ae=a.aF(w,"text-overlap","text-allow-overlap"),de=ae==="always",ye=a.aF(w,"icon-overlap","icon-allow-overlap"),he=ye==="always",we=w.get("text-rotation-alignment")==="map",Me=w.get("text-pitch-alignment")==="map",_e=w.get("icon-text-fit")!=="none",Re=w.get("symbol-z-order")==="viewport-y",Ge=de&&(he||!y.hasIconData()||oe),qe=he&&(de||!y.hasTextData()||ie);!y.collisionArrays&&$&&y.deserializeCollisionBoxes($);const Ye=this.retainedQueryData[y.bucketInstanceId].tileID,tt=this._getTerrainElevationFunc(Ye),wt=this.transform.getFastPathSimpleProjectionMatrix(Ye),xt=(ft,Ut,vn)=>{var Zn,lr;if(h[ft.crossTileID])return;if(W)return void(this.placements[ft.crossTileID]=new kc(!1,!1,!1));let ir=!1,tr=!1,cr=!0,Ir=null,nr={box:null,placeable:!1,offscreen:null,occluded:!1},Kn={placeable:!1},fr=null,Sn=null,Qr=null,yo=0,ba=0,vo=0;Ut.textFeatureIndex?yo=Ut.textFeatureIndex:ft.useRuntimeCollisionCircles&&(yo=ft.featureIndex),Ut.verticalTextFeatureIndex&&(ba=Ut.verticalTextFeatureIndex);const wa=Ut.textBox;if(wa){const es=Fr=>{let Nr=a.ao.horizontal;if(y.allowVerticalPlacement&&!Fr&&this.prevPlacement){const ei=this.prevPlacement.placedOrientations[ft.crossTileID];ei&&(this.placedOrientations[ft.crossTileID]=ei,Nr=ei,this.markUsedOrientation(y,Nr,ft))}return Nr},Ta=(Fr,Nr)=>{if(y.allowVerticalPlacement&&ft.numVerticalGlyphVertices>0&&Ut.verticalTextBox){for(const ei of y.writingModes)if(ei===a.ao.vertical?(nr=Nr(),Kn=nr):nr=Fr(),nr&&nr.placeable)break}else nr=Fr()},Uo=ft.textAnchorOffsetStartIndex,Vo=ft.textAnchorOffsetEndIndex;if(Vo===Uo){const Fr=(Nr,ei)=>{const pr=this.collisionIndex.placeCollisionBox(Nr,ae,U,Ye,D,Me,we,E,J.predicate,tt,void 0,wt);return pr&&pr.placeable&&(this.markUsedOrientation(y,ei,ft),this.placedOrientations[ft.crossTileID]=ei),pr};Ta((()=>Fr(wa,a.ao.horizontal)),(()=>{const Nr=Ut.verticalTextBox;return y.allowVerticalPlacement&&ft.numVerticalGlyphVertices>0&&Nr?Fr(Nr,a.ao.vertical):{box:null,offscreen:null}})),es(nr&&nr.placeable)}else{let Fr=a.aE[(lr=(Zn=this.prevPlacement)===null||Zn===void 0?void 0:Zn.variableOffsets[ft.crossTileID])===null||lr===void 0?void 0:lr.anchor];const Nr=(pr,nh,lf)=>{const Ms=pr.x2-pr.x1,ld=pr.y2-pr.y1,oc=ft.textBoxScale,ac=_e&&ye==="never"?nh:null;let ts=null,Js=ae==="never"?1:2,ns="never";Fr&&Js++;for(let rs=0;rs<Js;rs++){for(let lc=Uo;lc<Vo;lc++){const uu=y.textAnchorOffsets.get(lc);if(Fr&&uu.textAnchor!==Fr)continue;const rh=this.attemptAnchorPlacement(uu,pr,Ms,ld,oc,we,Me,U,Ye,D,J,ns,ft,y,lf,E,R,ac,tt);if(rh&&(ts=rh.placedGlyphBoxes,ts&&ts.placeable))return ir=!0,Ir=rh.shift,ts}Fr?Fr=null:ns=ae}return m&&!ts&&(ts={box:this.collisionIndex.placeCollisionBox(wa,"always",U,Ye,D,Me,we,E,J.predicate,tt,void 0,wt).box,offscreen:!1,placeable:!1,occluded:!1}),ts};Ta((()=>Nr(wa,Ut.iconBox,a.ao.horizontal)),(()=>{const pr=Ut.verticalTextBox;return y.allowVerticalPlacement&&(!nr||!nr.placeable)&&ft.numVerticalGlyphVertices>0&&pr?Nr(pr,Ut.verticalIconBox,a.ao.vertical):{box:null,occluded:!0,offscreen:null}})),nr&&(ir=nr.placeable,cr=nr.offscreen);const ei=es(nr&&nr.placeable);if(!ir&&this.prevPlacement){const pr=this.prevPlacement.variableOffsets[ft.crossTileID];pr&&(this.variableOffsets[ft.crossTileID]=pr,this.markUsedJustification(y,pr.anchor,ft,ei))}}}if(fr=nr,ir=fr&&fr.placeable,cr=fr&&fr.offscreen,ft.useRuntimeCollisionCircles&&ft.centerJustifiedTextSymbolIndex>=0){const es=y.text.placedSymbolArray.get(ft.centerJustifiedTextSymbolIndex),Ta=a.ap(y.textSizeData,Z,es),Uo=w.get("text-padding");Sn=this.collisionIndex.placeCollisionCircles(ae,es,y.lineVertexArray,y.glyphOffsetArray,Ta,D,B,m,Me,J.predicate,ft.collisionCircleDiameter,Uo,E,tt),Sn.circles.length&&Sn.collisionDetected&&!m&&a.w("Collisions detected, but collision boxes are not shown"),ir=de||Sn.circles.length>0&&!Sn.collisionDetected,cr=cr&&Sn.offscreen}if(Ut.iconFeatureIndex&&(vo=Ut.iconFeatureIndex),Ut.iconBox){const es=Ta=>this.collisionIndex.placeCollisionBox(Ta,ye,U,Ye,D,Me,we,R,J.predicate,tt,_e&&Ir?Ir:void 0,wt);Kn&&Kn.placeable&&Ut.verticalIconBox?(Qr=es(Ut.verticalIconBox),tr=Qr.placeable):(Qr=es(Ut.iconBox),tr=Qr.placeable),cr=cr&&Qr.offscreen}const sc=ie||ft.numHorizontalGlyphVertices===0&&ft.numVerticalGlyphVertices===0,zo=oe||ft.numIconVertices===0;sc||zo?zo?sc||(tr=tr&&ir):ir=tr&&ir:tr=ir=tr&&ir;const hl=tr&&Qr.placeable;if(ir&&fr.placeable&&this.collisionIndex.insertCollisionBox(fr.box,ae,w.get("text-ignore-placement"),y.bucketInstanceId,Kn&&Kn.placeable&&ba?ba:yo,J.ID),hl&&this.collisionIndex.insertCollisionBox(Qr.box,ye,w.get("icon-ignore-placement"),y.bucketInstanceId,vo,J.ID),Sn&&ir&&this.collisionIndex.insertCollisionCircles(Sn.circles,ae,w.get("text-ignore-placement"),y.bucketInstanceId,yo,J.ID),m&&this.storeCollisionData(y.bucketInstanceId,vn,Ut,fr,Qr,Sn),ft.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ft.crossTileID]=new kc((ir||Ge)&&!fr?.occluded,(tr||qe)&&!Qr?.occluded,cr||y.justReloaded),h[ft.crossTileID]=!0};if(Re){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ft=y.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ut=ft.length-1;Ut>=0;--Ut){const vn=ft[Ut];xt(y.symbolInstances.get(vn),y.collisionArrays[vn],vn)}}else for(let ft=i.symbolInstanceStart;ft<i.symbolInstanceEnd;ft++)xt(y.symbolInstances.get(ft),y.collisionArrays[ft],ft);y.justReloaded=!1}storeCollisionData(i,h,m,y,w,E){if(m.textBox||m.iconBox){let R,D;this.collisionBoxArrays.has(i)?R=this.collisionBoxArrays.get(i):(R=new Map,this.collisionBoxArrays.set(i,R)),R.has(h)?D=R.get(h):(D={text:null,icon:null},R.set(h,D)),m.textBox&&(D.text=y.box),m.iconBox&&(D.icon=w.box)}if(E){let R=this.collisionCircleArrays[i];R===void 0&&(R=this.collisionCircleArrays[i]=[]);for(let D=0;D<E.circles.length;D+=4)R.push(E.circles[D+0]-An),R.push(E.circles[D+1]-An),R.push(E.circles[D+2]),R.push(E.collisionDetected?1:0)}}markUsedJustification(i,h,m,y){let w;w=y===a.ao.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[a.aG(h)];const E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const R of E)R>=0&&(i.text.placedSymbolArray.get(R).crossTileID=w>=0&&R!==w?0:m.crossTileID)}markUsedOrientation(i,h,m){const y=h===a.ao.horizontal||h===a.ao.horizontalOnly?h:0,w=h===a.ao.vertical?h:0,E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const R of E)i.text.placedSymbolArray.get(R).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let m=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const y=h?h.symbolFadeChange(i):1,w=h?h.opacities:{},E=h?h.variableOffsets:{},R=h?h.placedOrientations:{};for(const D in this.placements){const B=this.placements[D],U=w[D];U?(this.opacities[D]=new Qn(U,y,B.text,B.icon),m=m||B.text!==U.text.placed||B.icon!==U.icon.placed):(this.opacities[D]=new Qn(null,y,B.text,B.icon,B.skipFade),m=m||B.text||B.icon)}for(const D in w){const B=w[D];if(!this.opacities[D]){const U=new Qn(B,y,!1,!1);U.isHidden()||(this.opacities[D]=U,m=m||B.text.placed||B.icon.placed)}}for(const D in E)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=E[D]);for(const D in R)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=R[D]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:i)}updateLayerOpacities(i,h){const m={};for(const y of h){const w=y.getBucket(i);w&&y.latestFeatureIndex&&i.id===w.layerIds[0]&&this.updateBucketOpacities(w,y.tileID,m,y.collisionBoxArray)}}updateBucketOpacities(i,h,m,y){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const w=i.layers[0],E=w.layout,R=new Qn(null,0,!1,!1,!0),D=E.get("text-allow-overlap"),B=E.get("icon-allow-overlap"),U=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),W=E.get("text-rotation-alignment")==="map",$=E.get("text-pitch-alignment")==="map",Z=E.get("icon-text-fit")!=="none",J=new Qn(null,0,D&&(B||!i.hasIconData()||E.get("icon-optional")),B&&(D||!i.hasTextData()||E.get("text-optional")),!0);!i.collisionArrays&&y&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(y);const ie=(ae,de,ye)=>{for(let he=0;he<de/4;he++)ae.opacityVertexArray.emplaceBack(ye);ae.hasVisibleVertices=ae.hasVisibleVertices||ye!==kl},oe=this.collisionBoxArrays.get(i.bucketInstanceId);for(let ae=0;ae<i.symbolInstances.length;ae++){const de=i.symbolInstances.get(ae),{numHorizontalGlyphVertices:ye,numVerticalGlyphVertices:he,crossTileID:we}=de;let Me=this.opacities[we];m[we]?Me=R:Me||(Me=J,this.opacities[we]=Me),m[we]=!0;const _e=de.numIconVertices>0,Re=this.placedOrientations[de.crossTileID],Ge=Re===a.ao.vertical,qe=Re===a.ao.horizontal||Re===a.ao.horizontalOnly;if(ye>0||he>0){const tt=Rl(Me.text);ie(i.text,ye,Ge?kl:tt),ie(i.text,he,qe?kl:tt);const wt=Me.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach((Ut=>{Ut>=0&&(i.text.placedSymbolArray.get(Ut).hidden=wt||Ge?1:0)})),de.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=wt||qe?1:0);const xt=this.variableOffsets[de.crossTileID];xt&&this.markUsedJustification(i,xt.anchor,de,Re);const ft=this.placedOrientations[de.crossTileID];ft&&(this.markUsedJustification(i,"left",de,ft),this.markUsedOrientation(i,ft,de))}if(_e){const tt=Rl(Me.icon),wt=!(Z&&de.verticalPlacedIconSymbolIndex&&Ge);de.placedIconSymbolIndex>=0&&(ie(i.icon,de.numIconVertices,wt?tt:kl),i.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=Me.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(ie(i.icon,de.numVerticalIconVertices,wt?kl:tt),i.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=Me.icon.isHidden())}const Ye=oe&&oe.has(ae)?oe.get(ae):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const tt=i.collisionArrays[ae];if(tt){let wt=new a.P(0,0);if(tt.textBox||tt.verticalTextBox){let xt=!0;if(U){const ft=this.variableOffsets[we];ft?(wt=Vs(ft.anchor,ft.width,ft.height,ft.textOffset,ft.textBoxScale),W&&wt._rotate($?-this.transform.bearingInRadians:this.transform.bearingInRadians)):xt=!1}if(tt.textBox||tt.verticalTextBox){let ft;tt.textBox&&(ft=Ge),tt.verticalTextBox&&(ft=qe),Oh(i.textCollisionBox.collisionVertexArray,Me.text.placed,!xt||ft,Ye.text,wt.x,wt.y)}}if(tt.iconBox||tt.verticalIconBox){const xt=!!(!qe&&tt.verticalIconBox);let ft;tt.iconBox&&(ft=xt),tt.verticalIconBox&&(ft=!xt),Oh(i.iconCollisionBox.collisionVertexArray,Me.icon.placed,ft,Ye.icon,Z?wt.x:0,Z?wt.y:0)}}}}if(i.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);i.bucketInstanceId in this.collisionCircleArrays&&(i.collisionCircleArray=this.collisionCircleArrays[i.bucketInstanceId],delete this.collisionCircleArrays[i.bucketInstanceId])}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,h){const m=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function Oh(x,i,h,m,y,w){m&&m.length!==0||(m=[0,0,0,0]);const E=m[0]-An,R=m[1]-An,D=m[2]-An,B=m[3]-An;x.emplaceBack(i?1:0,h?1:0,y||0,w||0,E,R),x.emplaceBack(i?1:0,h?1:0,y||0,w||0,D,R),x.emplaceBack(i?1:0,h?1:0,y||0,w||0,D,B),x.emplaceBack(i?1:0,h?1:0,y||0,w||0,E,B)}const ws=Math.pow(2,25),Gd=Math.pow(2,24),Ml=Math.pow(2,17),Yd=Math.pow(2,16),Ou=Math.pow(2,9),Lu=Math.pow(2,8),Oc=Math.pow(2,1);function Rl(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const i=x.placed?1:0,h=Math.floor(127*x.opacity);return h*ws+i*Gd+h*Ml+i*Yd+h*Ou+i*Lu+h*Oc+i}const kl=0;class Lh{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,h,m,y,w){const E=this._bucketParts;for(;this._currentTileIndex<i.length;)if(h.getBucketParts(E,y,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort(((R,D)=>R.sortKey-D.sortKey)));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,w())return!0;return!1}}class Lc{constructor(i,h,m,y,w,E,R,D){this.placement=new ai(i,h,E,R,D),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(i,h,m){const y=L.now(),w=()=>!this._forceFullPlacement&&L.now()-y>2;for(;this._currentPlacementIndex>=0;){const E=h[i[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=R)&&(!E.maxzoom||E.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Lh(E)),this._inProgressLayer.continuePlacement(m[E.source],this.placement,this._showCollisionBoxes,E,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Ba=512/a.$/2;class Fc{constructor(i,h,m){this.tileID=i,this.bucketInstanceId=m,this._symbolsByKey={};const y=new Map;for(let w=0;w<h.length;w++){const E=h.get(w),R=E.key,D=y.get(R);D?D.push(E):y.set(R,[E])}for(const[w,E]of y){const R={positions:E.map((D=>({x:Math.floor(D.anchorX*Ba),y:Math.floor(D.anchorY*Ba)}))),crossTileIDs:E.map((D=>D.crossTileID))};if(R.positions.length>128){const D=new a.aI(R.positions.length,16,Uint16Array);for(const{x:B,y:U}of R.positions)D.add(B,U);D.finish(),delete R.positions,R.index=D}this._symbolsByKey[w]=R}}getScaledCoordinates(i,h){const{x:m,y,z:w}=this.tileID.canonical,{x:E,y:R,z:D}=h.canonical,B=Ba/Math.pow(2,D-w),U=(R*a.$+i.anchorY)*B,W=y*a.$*Ba;return{x:Math.floor((E*a.$+i.anchorX)*B-m*a.$*Ba),y:Math.floor(U-W)}}findMatches(i,h,m){const y=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let w=0;w<i.length;w++){const E=i.get(w);if(E.crossTileID)continue;const R=this._symbolsByKey[E.key];if(!R)continue;const D=this.getScaledCoordinates(E,h);if(R.index){const B=R.index.range(D.x-y,D.y-y,D.x+y,D.y+y).sort();for(const U of B){const W=R.crossTileIDs[U];if(!m[W]){m[W]=!0,E.crossTileID=W;break}}}else if(R.positions)for(let B=0;B<R.positions.length;B++){const U=R.positions[B],W=R.crossTileIDs[B];if(Math.abs(U.x-D.x)<=y&&Math.abs(U.y-D.y)<=y&&!m[W]){m[W]=!0,E.crossTileID=W;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:i})=>i))}}class za{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Lp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const h=Math.round((i-this.lng)/360);if(h!==0)for(const m in this.indexes){const y=this.indexes[m],w={};for(const E in y){const R=y[E];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+h),w[R.tileID.key]=R}this.indexes[m]=w}this.lng=i}addBucket(i,h,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const y=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const E=this.indexes[w];if(Number(w)>i.overscaledZ)for(const R in E){const D=E[R];D.tileID.isChildOf(i)&&D.findMatches(h.symbolInstances,i,y)}else{const R=E[i.scaledTo(Number(w)).key];R&&R.findMatches(h.symbolInstances,i,y)}}for(let w=0;w<h.symbolInstances.length;w++){const E=h.symbolInstances.get(w);E.crossTileID||(E.crossTileID=m.generate(),y[E.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Fc(i,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(i,h){for(const m of h.getCrossTileIDsLists())for(const y of m)delete this.usedCrossTileIDs[i][y]}removeStaleBuckets(i){let h=!1;for(const m in this.indexes){const y=this.indexes[m];for(const w in y)i[y[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[w]),delete y[w],h=!0)}return h}}class ra{constructor(){this.layerIndexes={},this.crossTileIDs=new za,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,h,m){let y=this.layerIndexes[i.id];y===void 0&&(y=this.layerIndexes[i.id]=new Lp);let w=!1;const E={};y.handleWrapJump(m);for(const R of h){const D=R.getBucket(i);D&&i.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(R.tileID,D,this.crossTileIDs)&&(w=!0),E[D.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(i){const h={};i.forEach((m=>{h[m]=!0}));for(const m in this.layerIndexes)h[m]||delete this.layerIndexes[m]}}var $n="void main() {fragColor=vec4(1.0);}";const Ts={prelude:Pn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Pn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Pn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Pn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Pn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Pn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Pn($n,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Pn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Pn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Pn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Pn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Pn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Pn($n,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Pn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Pn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Pn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Pn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Pn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Pn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Pn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Pn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Pn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Pn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Pn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Pn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Pn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Pn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Pn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Pn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Pn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Pn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Pn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Pn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Pn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Pn(x,i){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=i.match(/in ([\w]+) ([\w]+)/g),y=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=w?w.concat(y):y,R={};return{fragmentSource:x=x.replace(h,((D,B,U,W,$)=>(R[$]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${$}
in ${U} ${W} ${$};
#else
uniform ${U} ${W} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${U} ${W} ${$} = u_${$};
#endif
`))),vertexSource:i=i.replace(h,((D,B,U,W,$)=>{const Z=W==="float"?"vec2":"vec4",J=$.match(/color/)?"color":Z;return R[$]?B==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${Z} a_${$};
out ${U} ${W} ${$};
#else
uniform ${U} ${W} u_${$};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${U} ${W} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${J}(a_${$}, u_${$}_t);
#else
    ${U} ${W} ${$} = u_${$};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${Z} a_${$};
#else
uniform ${U} ${W} u_${$};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${W} ${$} = a_${$};
#else
    ${U} ${W} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${W} ${$} = unpack_mix_${J}(a_${$}, u_${$}_t);
#else
    ${U} ${W} ${$} = u_${$};
#endif
`})),staticAttributes:m,staticUniforms:E}}class Io{constructor(i,h,m){this.vertexBuffer=i,this.indexBuffer=h,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Mo=a.aJ([{name:"a_pos",type:"Int16",components:2}]);const ao="#define PROJECTION_MERCATOR",ia="mercator";class Tn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ia}get shaderDefine(){return ao}get shaderPreludeCode(){return Ts.projectionMercator}get vertexShaderPreludeCode(){return Ts.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(i){}getMeshFromTileID(i,h,m,y,w){if(this._cachedMesh)return this._cachedMesh;const E=new a.aL;E.emplaceBack(0,0),E.emplaceBack(a.$,0),E.emplaceBack(0,a.$),E.emplaceBack(a.$,a.$);const R=i.createVertexBuffer(E,Mo.members),D=a.aM.simpleSegment(0,0,4,2),B=new a.aN;B.emplaceBack(1,0,2),B.emplaceBack(1,2,3);const U=i.createIndexBuffer(B);return this._cachedMesh=new Io(R,U,D),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(i){}}class lo{constructor(i=0,h=0,m=0,y=0){if(isNaN(i)||i<0||isNaN(h)||h<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=h,this.left=m,this.right=y}interpolate(i,h,m){return h.top!=null&&i.top!=null&&(this.top=a.C.number(i.top,h.top,m)),h.bottom!=null&&i.bottom!=null&&(this.bottom=a.C.number(i.bottom,h.bottom,m)),h.left!=null&&i.left!=null&&(this.left=a.C.number(i.left,h.left,m)),h.right!=null&&i.right!=null&&(this.right=a.C.number(i.right,h.right,m)),this}getCenter(i,h){const m=a.ah((this.left+i-this.right)/2,0,i),y=a.ah((this.top+h-this.bottom)/2,0,h);return new a.P(m,y)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new lo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function js(x,i){if(!x.renderWorldCopies||x.lngRange)return;const h=i.lng-x.center.lng;i.lng+=h>180?-360:h<-180?360:0}function $s(x){return Math.max(0,Math.floor(x))}class Pr{constructor(i,h,m,y,w,E){this._callbacks=i,this._tileSize=512,this._renderWorldCopies=E===void 0||!!E,this._minZoom=h||0,this._maxZoom=m||22,this._minPitch=y??0,this._maxPitch=w??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=$s(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new lo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(i,h,m){this._latRange=i.latRange,this._lngRange=i.lngRange,this._width=i.width,this._height=i.height,this._center=i.center,this._elevation=i.elevation,this._minElevationForCurrentTile=i.minElevationForCurrentTile,this._zoom=i.zoom,this._tileZoom=$s(this._zoom),this._scale=a.af(this._zoom),this._bearingInRadians=i.bearingInRadians,this._fovInRadians=i.fovInRadians,this._pitchInRadians=i.pitchInRadians,this._rollInRadians=i.rollInRadians,this._unmodified=i.unmodified,this._edgeInsets=new lo(i.padding.top,i.padding.bottom,i.padding.left,i.padding.right),this._minZoom=i.minZoom,this._maxZoom=i.maxZoom,this._minPitch=i.minPitch,this._maxPitch=i.maxPitch,this._renderWorldCopies=i.renderWorldCopies,this._cameraToCenterDistance=i.cameraToCenterDistance,this._nearZ=i.nearZ,this._farZ=i.farZ,this._autoCalculateNearFarZ=!m&&i.autoCalculateNearFarZ,h&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(i){this._minElevationForCurrentTile=i}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(i){this._minZoom!==i&&(this._minZoom=i,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(i){this._minPitch!==i&&(this._minPitch=i,this.setPitch(Math.max(this.pitch,i)))}get maxPitch(){return this._maxPitch}setMaxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.setPitch(Math.min(this.pitch,i)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(i){const h=a.aO(i,-180,180)*Math.PI/180;var m,y,w,E,R,D,B,U,W;this._bearingInRadians!==h&&(this._unmodified=!1,this._bearingInRadians=h,this._calcMatrices(),this._rotationMatrix=A(),m=this._rotationMatrix,w=-this._bearingInRadians,E=(y=this._rotationMatrix)[0],R=y[1],D=y[2],B=y[3],U=Math.sin(w),W=Math.cos(w),m[0]=E*W+D*U,m[1]=R*W+B*U,m[2]=E*-U+D*W,m[3]=R*-U+B*W)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(i){const h=a.ah(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==h&&(this._unmodified=!1,this._pitchInRadians=h,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(i){const h=i/180*Math.PI;this._rollInRadians!==h&&(this._unmodified=!1,this._rollInRadians=h,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aP(this._fovInRadians)}setFov(i){i=a.ah(i,.1,150),this.fov!==i&&(this._unmodified=!1,this._fovInRadians=a.ae(i),this._calcMatrices())}get zoom(){return this._zoom}setZoom(i){const h=this.getConstrained(this._center,i).zoom;this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this._tileZoom=Math.max(0,Math.floor(h)),this._scale=a.af(h),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(i,h){this._autoCalculateNearFarZ=!1,this._nearZ=i,this._farZ=h,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,h,m){this._unmodified=!1,this._edgeInsets.interpolate(i,h,m),this._constrain(),this._calcMatrices()}resize(i,h,m=!0){this._width=i,this._height=h,m&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new qn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(i){i?(this._lngRange=[i.getWest(),i.getEast()],this._latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-a.ai,a.ai])}getConstrained(i,h){return this._callbacks.getConstrained(i,h)}getCameraQueryGeometry(i,h){if(h.length===1)return[h[0],i];{const{minX:m,minY:y,maxX:w,maxY:E}=a.a2.fromPoints(h).extend(i);return[new a.P(m,y),new a.P(w,y),new a.P(w,E),new a.P(m,E),new a.P(m,y)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:h,zoom:m}=this.getConstrained(this.center,this.zoom);this.setCenter(h),this.setZoom(m),this._unmodified=i,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let i=a.ag(new Float64Array(16));a.N(i,i,[this._width/2,-this._height/2,1]),a.M(i,i,[1,-1,0]),this._clipSpaceToPixelsMatrix=i,i=a.ag(new Float64Array(16)),a.N(i,i,[1,-1,1]),a.M(i,i,[-1,-1,0]),a.N(i,i,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=i,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(i,h,m,y){const w=m!==void 0?m:this.bearing,E=y=y!==void 0?y:this.pitch,R=a.a1.fromLngLat(i,h),D=-Math.cos(a.ae(E)),B=Math.sin(a.ae(E)),U=B*Math.sin(a.ae(w)),W=-B*Math.cos(a.ae(w));let $=this.elevation;const Z=h-$;let J;D*Z>=0||Math.abs(D)<.1?(J=1e4,$=h+J*D):J=-Z/D;let ie,oe,ae=a.aQ(1,R.y),de=0;do{if(de+=1,de>10)break;oe=J/ae,ie=new a.a1(R.x+U*oe,R.y+W*oe),ae=1/ie.meterInMercatorCoordinateUnits()}while(Math.abs(J-oe*ae)>1e-12);return{center:ie.toLngLat(),elevation:$,zoom:a.ak(this.height/2/Math.tan(this.fovInRadians/2)/oe/this.tileSize)}}recalculateZoomAndCenter(i){if(this.elevation-i==0)return;const h=a.aj(1,this.center.lat)*this.worldSize,m=this.cameraToCenterDistance/h,y=a.a1.fromLngLat(this.center,this.elevation),w=Ke(this.center,this.elevation,this.pitch,this.bearing,m);this._elevation=i;const E=this.calculateCenterFromCameraLngLatAlt(w.toLngLat(),a.aQ(w.z,y.y),this.bearing,this.pitch);this._elevation=E.elevation,this._center=E.center,this.setZoom(E.zoom)}getCameraPoint(){const i=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(i*Math.sin(this.rollInRadians),i*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const i=a.aj(1,this.center.lat)*this.worldSize;return Ke(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/i).toLngLat()}getMercatorTileCoordinates(i){if(!i)return[0,0,1,1];const h=i.canonical.z>=0?1<<i.canonical.z:Math.pow(2,i.canonical.z);return[i.canonical.x/h,i.canonical.y/h,1/h/a.$,1/h/a.$]}}class Er{constructor(i,h){this.min=i,this.max=h,this.center=a.aR([],a.aS([],this.min,this.max),.5)}quadrant(i){const h=[i%2==0,i<2],m=a.aT(this.min),y=a.aT(this.max);for(let w=0;w<h.length;w++)m[w]=h[w]?this.min[w]:this.center[w],y[w]=h[w]?this.center[w]:this.max[w];return y[2]=this.max[2],new Er(m,y)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersectsFrustum(i){let h=!0;for(let m=0;m<i.planes.length;m++){const y=this.intersectsPlane(i.planes[m]);if(y===0)return 0;y===1&&(h=!1)}return h?2:i.aabb.min[0]>this.max[0]||i.aabb.min[1]>this.max[1]||i.aabb.min[2]>this.max[2]||i.aabb.max[0]<this.min[0]||i.aabb.max[1]<this.min[1]||i.aabb.max[2]<this.min[2]?0:1}intersectsPlane(i){let h=i[3],m=i[3];for(let y=0;y<3;y++)i[y]>0?(h+=i[y]*this.min[y],m+=i[y]*this.max[y]):(m+=i[y]*this.min[y],h+=i[y]*this.max[y]);return h>=0?2:m<0?0:1}}class Hr{distanceToTile2d(i,h,m,y){const w=y.distanceX([i,h]),E=y.distanceY([i,h]);return Math.hypot(w,E)}getWrap(i,h,m){return m}getTileBoundingVolume(i,h,m,y){var w,E;let R=0,D=0;if(y?.terrain){const U=new a.Z(i.z,h,i.z,i.x,i.y),W=y.terrain.getMinMaxElevation(U);R=(w=W.minElevation)!==null&&w!==void 0?w:Math.min(0,m),D=(E=W.maxElevation)!==null&&E!==void 0?E:Math.max(0,m)}const B=1<<i.z;return new Er([h+i.x/B,i.y/B,R],[h+(i.x+1)/B,(i.y+1)/B,D])}allowVariableZoom(i,h){const m=i.fov*(Math.abs(Math.cos(i.rollInRadians))*i.height+Math.abs(Math.sin(i.rollInRadians))*i.width)/i.height,y=a.ah(78.5-m/2,0,60);return!!h.terrain||i.pitch>y}allowWorldCopies(){return!0}prepareNextFrame(){}}class or{constructor(i,h,m){this.points=i,this.planes=h,this.aabb=m}static fromInvProjectionMatrix(i,h=1,m=0,y,w){const E=w?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],R=Math.pow(2,m),D=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(($=>(function(Z,J,ie,oe){const ae=a.aw([],Z,J),de=1/ae[3]/ie*oe;return a.aY(ae,ae,[de,de,1/ae[3],de])})($,i,h,R)));y&&(function($,Z,J,ie){const oe=ie?4:0,ae=ie?0:4;let de=0;const ye=[],he=[];for(let _e=0;_e<4;_e++){const Re=a.aU([],$[_e+ae],$[_e+oe]),Ge=a.aZ(Re);a.aR(Re,Re,1/Ge),ye.push(Ge),he.push(Re)}for(let _e=0;_e<4;_e++){const Re=a.a_($[_e+oe],he[_e],J);de=Re!==null&&Re>=0?Math.max(de,Re):Math.max(de,ye[_e])}const we=(function(_e,Re){const Ge=a.aU([],_e[Re[0]],_e[Re[1]]),qe=a.aU([],_e[Re[2]],_e[Re[1]]),Ye=[0,0,0,0];return a.aV(Ye,a.aW([],Ge,qe)),Ye[3]=-a.aX(Ye,_e[Re[0]]),Ye})($,Z),Me=(function(_e,Re){const Ge=a.a$(_e),qe=a.b0([],_e,1/Ge),Ye=a.aU([],Re,a.aR([],qe,a.aX(Re,qe))),tt=a.a$(Ye);if(tt>0){const wt=Math.sqrt(1-qe[3]*qe[3]),xt=a.aR([],qe,-qe[3]),ft=a.aS([],xt,a.aR([],Ye,wt/tt));return a.b1(Re,ft)}return null})(J,we);if(Me!==null){const _e=Me/a.aX(he[0],we);de=Math.min(de,_e)}for(let _e=0;_e<4;_e++){const Re=Math.min(de,ye[_e]);$[_e+ae]=[$[_e+oe][0]+he[_e][0]*Re,$[_e+oe][1]+he[_e][1]*Re,$[_e+oe][2]+he[_e][2]*Re,1]}})(D,E[0],y,w);const B=E.map(($=>{const Z=a.aU([],D[$[0]],D[$[1]]),J=a.aU([],D[$[2]],D[$[1]]),ie=a.aV([],a.aW([],Z,J)),oe=-a.aX(ie,D[$[1]]);return ie.concat(oe)})),U=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],W=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const $ of D)for(let Z=0;Z<3;Z++)U[Z]=Math.min(U[Z],$[Z]),W[Z]=Math.max(W[Z],$[Z]);return new or(D,B,new Er(U,W))}}class rr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,h,m){return this._helper.interpolatePadding(i,h,m)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,h,m=!0){this._helper.resize(i,h,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,h){this._helper.overrideNearFarZ(i,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i,h){}constructor(i,h,m,y,w){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Pr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(E,R)=>this.getConstrained(E,R)},i,h,m,y,w),this._coveringTilesDetailsProvider=new Hr}clone(){const i=new rr;return i.apply(this),i}apply(i,h,m){this._helper.apply(i,h,m)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(i){const h=[new a.b2(0,i)];if(this._helper._renderWorldCopies){const m=this.screenPointToMercatorCoordinate(new a.P(0,0)),y=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),w=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),E=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),R=Math.floor(Math.min(m.x,y.x,w.x,E.x)),D=Math.floor(Math.max(m.x,y.x,w.x,E.x)),B=1;for(let U=R-B;U<=D+B;U++)U!==0&&h.push(new a.b2(U,i))}return h}getCameraFrustum(){return or.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){const h=this.screenPointToLocation(this.centerPoint,i),m=i?i.getElevationForLngLatZoom(h,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(m)}setLocationAtPoint(i,h){const m=a.aj(this.elevation,this.center.lat),y=this.screenPointToMercatorCoordinateAtZ(h,m),w=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,m),E=a.a1.fromLngLat(i),R=new a.a1(E.x-(y.x-w.x),E.y-(y.y-w.y));this.setCenter(R?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(i,h){return h?this.coordinatePoint(a.a1.fromLngLat(i),h.getElevationForLngLatZoom(i,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.a1.fromLngLat(i))}screenPointToLocation(i,h){var m;return(m=this.screenPointToMercatorCoordinate(i,h))===null||m===void 0?void 0:m.toLngLat()}screenPointToMercatorCoordinate(i,h){if(h){const m=h.pointCoordinate(i);if(m!=null)return m}return this.screenPointToMercatorCoordinateAtZ(i)}screenPointToMercatorCoordinateAtZ(i,h){const m=h||0,y=[i.x,i.y,0,1],w=[i.x,i.y,1,1];a.aw(y,y,this._pixelMatrixInverse),a.aw(w,w,this._pixelMatrixInverse);const E=y[3],R=w[3],D=y[1]/E,B=w[1]/R,U=y[2]/E,W=w[2]/R,$=U===W?0:(m-U)/(W-U);return new a.a1(a.C.number(y[0]/E,w[0]/R,$)/this.worldSize,a.C.number(D,B,$)/this.worldSize,m)}coordinatePoint(i,h=0,m=this._pixelMatrix){const y=[i.x*this.worldSize,i.y*this.worldSize,h,1];return a.aw(y,y,m),new a.P(y[0]/y[3],y[1]/y[3])}getBounds(){const i=Math.max(0,this._helper._height/2-Ce(this));return new qn().extend(this.screenPointToLocation(new a.P(0,i))).extend(this.screenPointToLocation(new a.P(this._helper._width,i))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(i,h){return h?h.pointCoordinate(i)!=null:i.y>this.height/2-Ce(this)}calculatePosMatrix(i,h=!1,m){var y;const w=(y=i.key)!==null&&y!==void 0?y:a.b3(i.wrap,i.canonical.z,i.canonical.z,i.canonical.x,i.canonical.y),E=h?this._alignedPosMatrixCache:this._posMatrixCache;if(E.has(w)){const B=E.get(w);return m?B.f32:B.f64}const R=Fe(i,this.worldSize);a.O(R,h?this._alignedProjMatrix:this._viewProjMatrix,R);const D={f64:R,f32:new Float32Array(R)};return E.set(w,D),m?D.f32:D.f64}calculateFogMatrix(i){const h=i.key,m=this._fogMatrixCacheF32;if(m.has(h))return m.get(h);const y=Fe(i,this.worldSize);return a.O(y,this._fogMatrix,y),m.set(h,new Float32Array(y)),m.get(h)}getConstrained(i,h){h=a.ah(+h,this.minZoom,this.maxZoom);const m={center:new a.S(i.lng,i.lat),zoom:h};let y=this._helper._lngRange;if(!this._helper._renderWorldCopies&&y===null){const ye=179.9999999999;y=[-ye,ye]}const w=this.tileSize*a.af(m.zoom);let E=0,R=w,D=0,B=w,U=0,W=0;const{x:$,y:Z}=this.size;if(this._helper._latRange){const ye=this._helper._latRange;E=a.U(ye[1])*w,R=a.U(ye[0])*w,R-E<Z&&(U=Z/(R-E))}y&&(D=a.aO(a.V(y[0])*w,0,w),B=a.aO(a.V(y[1])*w,0,w),B<D&&(B+=w),B-D<$&&(W=$/(B-D)));const{x:J,y:ie}=ne(w,i);let oe,ae;const de=Math.max(W||0,U||0);if(de){const ye=new a.P(W?(B+D)/2:J,U?(R+E)/2:ie);return m.center=xe(w,ye).wrap(),m.zoom+=a.ak(de),m}if(this._helper._latRange){const ye=Z/2;ie-ye<E&&(ae=E+ye),ie+ye>R&&(ae=R-ye)}if(y){const ye=(D+B)/2;let he=J;this._helper._renderWorldCopies&&(he=a.aO(J,ye-w/2,ye+w/2));const we=$/2;he-we<D&&(oe=D+we),he+we>B&&(oe=B-we)}if(oe!==void 0||ae!==void 0){const ye=new a.P(oe??J,ae??ie);m.center=xe(w,ye).wrap()}return m}calculateCenterFromCameraLngLatAlt(i,h,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(i,h,m,y)}_calculateNearFarZIfNeeded(i,h,m){if(!this._helper.autoCalculateNearFarZ)return;const y=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),w=i-y*this._helper._pixelPerMeter/Math.cos(h),E=y<0?w:i,R=Math.PI/2+this.pitchInRadians,D=a.ae(this.fov)*(Math.abs(Math.cos(a.ae(this.roll)))*this.height+Math.abs(Math.sin(a.ae(this.roll)))*this.width)/this.height*(.5+m.y/this.height),B=Math.sin(D)*E/Math.sin(a.ah(Math.PI-R-D,.01,Math.PI-.01)),U=Ce(this),W=Math.atan(U/this._helper.cameraToCenterDistance),$=a.ae(.75),Z=W>$?2*W*(.5+m.y/(2*U)):$,J=Math.sin(Z)*E/Math.sin(a.ah(Math.PI-R-Z,.01,Math.PI-.01)),ie=Math.min(B,J);this._helper._farZ=1.01*(Math.cos(Math.PI/2-h)*ie+E),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const i=this.centerOffset,h=ne(this.worldSize,this.center),m=h.x,y=h.y;this._helper._pixelPerMeter=a.aj(1,this.center.lat)*this.worldSize;const w=a.ae(Math.min(this.pitch,K)),E=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(w));let R;this._calculateNearFarZIfNeeded(E,w,i),R=new Float64Array(16),a.b4(R,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.aq(this._invProjMatrix,R),R[8]=2*-i.x/this._helper._width,R[9]=2*i.y/this._helper._height,this._projectionMatrix=a.b5(R),a.N(R,R,[1,-1,1]),a.M(R,R,[0,0,-this._helper.cameraToCenterDistance]),a.b6(R,R,-this.rollInRadians),a.b7(R,R,this.pitchInRadians),a.b6(R,R,-this.bearingInRadians),a.M(R,R,[-m,-y,0]),this._mercatorMatrix=a.N([],R,[this.worldSize,this.worldSize,this.worldSize]),a.N(R,R,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,R),a.M(R,R,[0,0,-this.elevation]),this._viewProjMatrix=R,this._invViewProjMatrix=a.aq([],R);const D=[0,0,-1,1];a.aw(D,D,this._invViewProjMatrix),this._cameraPosition=[D[0]/D[3],D[1]/D[3],D[2]/D[3]],this._fogMatrix=new Float64Array(16),a.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,E,this._helper._farZ),this._fogMatrix[8]=2*-i.x/this.width,this._fogMatrix[9]=2*i.y/this.height,a.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.M(this._fogMatrix,this._fogMatrix,[-m,-y,0]),a.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,R);const B=this._helper._width%2/2,U=this._helper._height%2/2,W=Math.cos(this.bearingInRadians),$=Math.sin(-this.bearingInRadians),Z=m-Math.round(m)+W*B+$*U,J=y-Math.round(y)+W*U+$*B,ie=new Float64Array(R);if(a.M(ie,ie,[Z>.5?Z-1:Z,J>.5?J-1:J,0]),this._alignedProjMatrix=ie,R=a.aq(new Float64Array(16),this._pixelMatrix),!R)throw new Error("failed to invert matrix");this._pixelMatrixInverse=R,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const i=this.screenPointToMercatorCoordinate(new a.P(0,0)),h=[i.x*this.worldSize,i.y*this.worldSize,0,1];return a.aw(h,h,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const i=a.aj(1,this.center.lat)*this.worldSize;return Ke(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/i).toLngLat()}lngLatToCameraDepth(i,h){const m=a.a1.fromLngLat(i),y=[m.x*this.worldSize,m.y*this.worldSize,h,1];return a.aw(y,y,this._viewProjMatrix),y[2]/y[3]}getProjectionData(i){const{overscaledTileID:h,aligned:m,applyTerrainMatrix:y}=i,w=this._helper.getMercatorTileCoordinates(h),E=h?this.calculatePosMatrix(h,m,!0):null;let R;return R=h&&h.terrainRttPosMatrix32f&&y?h.terrainRttPosMatrix32f:E||a.b8(),{mainMatrix:R,tileMercatorCoords:w,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:R}}isLocationOccluded(i){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(i,h,m){return 1}transformLightDirection(i){return a.aT(i)}getRayDirectionFromPixel(i){throw new Error("Not implemented.")}projectTileCoordinates(i,h,m,y){const w=this.calculatePosMatrix(m);let E;y?(E=[i,h,y(i,h),1],a.aw(E,E,w)):(E=[i,h,0,1],Il(E,E,w));const R=E[3];return{point:new a.P(E[0]/R,E[1]/R),signedDistanceFromCamera:R,isOccluded:!1}}populateCache(i){for(const h of i)this.calculatePosMatrix(h)}getMatrixForModel(i,h){const m=a.a1.fromLngLat(i,h),y=m.meterInMercatorCoordinateUnits(),w=a.b9();return a.M(w,w,[m.x,m.y,m.z]),a.b6(w,w,Math.PI),a.b7(w,w,Math.PI/2),a.N(w,w,[-y,y,y]),w}getProjectionDataForCustomLayer(i=!0){const h=new a.Z(0,0,0,0,0),m=this.getProjectionData({overscaledTileID:h,applyGlobeMatrix:i}),y=Fe(h,this.worldSize);a.O(y,this._viewProjMatrix,y),m.tileMercatorCoords=[0,0,1,1];const w=[a.$,a.$,this.worldSize/this._helper.pixelsPerMeter],E=a.ba();return a.N(E,y,w),m.fallbackMatrix=E,m.mainMatrix=E,m}getFastPathSimpleProjectionMatrix(i){return this.calculatePosMatrix(i)}}function Fh(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Zr(x){if(x.useSlerp)if(x.k<1){const i=a.bb(x.startEulerAngles.roll,x.startEulerAngles.pitch,x.startEulerAngles.bearing),h=a.bb(x.endEulerAngles.roll,x.endEulerAngles.pitch,x.endEulerAngles.bearing),m=new Float64Array(4);a.bc(m,i,h,x.k);const y=a.bd(m);x.tr.setRoll(y.roll),x.tr.setPitch(y.pitch),x.tr.setBearing(y.bearing)}else x.tr.setRoll(x.endEulerAngles.roll),x.tr.setPitch(x.endEulerAngles.pitch),x.tr.setBearing(x.endEulerAngles.bearing);else x.tr.setRoll(a.C.number(x.startEulerAngles.roll,x.endEulerAngles.roll,x.k)),x.tr.setPitch(a.C.number(x.startEulerAngles.pitch,x.endEulerAngles.pitch,x.k)),x.tr.setBearing(a.C.number(x.startEulerAngles.bearing,x.endEulerAngles.bearing,x.k))}function ls(x,i,h,m,y){const w=y.padding,E=ne(y.worldSize,h.getNorthWest()),R=ne(y.worldSize,h.getNorthEast()),D=ne(y.worldSize,h.getSouthEast()),B=ne(y.worldSize,h.getSouthWest()),U=a.ae(-m),W=E.rotate(U),$=R.rotate(U),Z=D.rotate(U),J=B.rotate(U),ie=new a.P(Math.max(W.x,$.x,J.x,Z.x),Math.max(W.y,$.y,J.y,Z.y)),oe=new a.P(Math.min(W.x,$.x,J.x,Z.x),Math.min(W.y,$.y,J.y,Z.y)),ae=ie.sub(oe),de=(y.width-(w.left+w.right+i.left+i.right))/ae.x,ye=(y.height-(w.top+w.bottom+i.top+i.bottom))/ae.y;if(ye<0||de<0)return void Fh();const he=Math.min(a.ak(y.scale*Math.min(de,ye)),x.maxZoom),we=a.P.convert(x.offset),Me=new a.P((i.left-i.right)/2,(i.top-i.bottom)/2).rotate(a.ae(m)),_e=we.add(Me).mult(y.scale/a.af(he));return{center:xe(y.worldSize,E.add(D).div(2).sub(_e)),zoom:he,bearing:m}}class li{get useGlobeControls(){return!1}handlePanInertia(i,h){const m=i.mag(),y=Math.abs(Ce(h));return{easingOffset:i.mult(Math.min(.75*y/m,1)),easingCenter:h.center}}handleMapControlsRollPitchBearingZoom(i,h){i.bearingDelta&&h.setBearing(h.bearing+i.bearingDelta),i.pitchDelta&&h.setPitch(h.pitch+i.pitchDelta),i.rollDelta&&h.setRoll(h.roll+i.rollDelta),i.zoomDelta&&h.setZoom(h.zoom+i.zoomDelta)}handleMapControlsPan(i,h,m){i.around.distSqr(h.centerPoint)<.01||h.setLocationAtPoint(m,i.around)}cameraForBoxAndBearing(i,h,m,y,w){return ls(i,h,m,y,w)}handleJumpToCenterZoom(i,h){i.zoom!==(h.zoom!==void 0?+h.zoom:i.zoom)&&i.setZoom(+h.zoom),h.center!==void 0&&i.setCenter(a.S.convert(h.center))}handleEaseTo(i,h){const m=i.zoom,y=i.padding,w={roll:i.roll,pitch:i.pitch,bearing:i.bearing},E={roll:h.roll===void 0?i.roll:h.roll,pitch:h.pitch===void 0?i.pitch:h.pitch,bearing:h.bearing===void 0?i.bearing:h.bearing},R=h.zoom!==void 0,D=!i.isPaddingEqual(h.padding);let B=!1;const U=R?+h.zoom:i.zoom;let W=i.centerPoint.add(h.offsetAsPoint);const $=i.screenPointToLocation(W),{center:Z,zoom:J}=i.getConstrained(a.S.convert(h.center||$),U??m);js(i,Z);const ie=ne(i.worldSize,$),oe=ne(i.worldSize,Z).sub(ie),ae=a.af(J-m);return B=J!==m,{easeFunc:de=>{if(B&&i.setZoom(a.C.number(m,J,de)),a.be(w,E)||Zr({startEulerAngles:w,endEulerAngles:E,tr:i,k:de,useSlerp:w.roll!=E.roll}),D&&(i.interpolatePadding(y,h.padding,de),W=i.centerPoint.add(h.offsetAsPoint)),h.around)i.setLocationAtPoint(h.around,h.aroundPoint);else{const ye=a.af(i.zoom-m),he=J>m?Math.min(2,ae):Math.max(.5,ae),we=Math.pow(he,1-de),Me=xe(i.worldSize,ie.add(oe.mult(de*we)).mult(ye));i.setLocationAtPoint(i.renderWorldCopies?Me.wrap():Me,W)}},isZooming:B,elevationCenter:Z}}handleFlyTo(i,h){const m=h.zoom!==void 0,y=i.zoom,w=i.getConstrained(a.S.convert(h.center||h.locationAtOffset),m?+h.zoom:y),E=w.center,R=w.zoom;js(i,E);const D=ne(i.worldSize,h.locationAtOffset),B=ne(i.worldSize,E).sub(D),U=B.mag(),W=a.af(R-y);let $;if(h.minZoom!==void 0){const Z=Math.min(+h.minZoom,y,R),J=i.getConstrained(E,Z).zoom;$=a.af(J-y)}return{easeFunc:(Z,J,ie,oe)=>{i.setZoom(Z===1?R:y+a.ak(J));const ae=Z===1?E:xe(i.worldSize,D.add(B.mult(ie)).mult(J));i.setLocationAtPoint(i.renderWorldCopies?ae.wrap():ae,oe)},scaleOfZoom:W,targetCenter:E,scaleOfMinZoom:$,pixelPathLength:U}}}class er{constructor(i,h,m){this.blendFunction=i,this.blendColor=h,this.mask=m}}er.Replace=[1,0],er.disabled=new er(er.Replace,a.bf.transparent,[!1,!1,!1,!1]),er.unblended=new er(er.Replace,a.bf.transparent,[!0,!0,!0,!0]),er.alphaBlended=new er([1,771],a.bf.transparent,[!0,!0,!0,!0]);const sa=2305;class rn{constructor(i,h,m){this.enable=i,this.mode=h,this.frontFace=m}}rn.disabled=new rn(!1,1029,sa),rn.backCCW=new rn(!0,1029,sa),rn.frontCCW=new rn(!0,1028,sa);class cn{constructor(i,h,m){this.func=i,this.mask=h,this.range=m}}cn.ReadOnly=!1,cn.ReadWrite=!0,cn.disabled=new cn(519,cn.ReadOnly,[0,1]);const cs=7680;class En{constructor(i,h,m,y,w,E){this.test=i,this.ref=h,this.mask=m,this.fail=y,this.depthFail=w,this.pass=E}}En.disabled=new En({func:519,mask:0},0,0,cs,cs,cs);const vi=new WeakMap;function co(x){var i;if(vi.has(x))return vi.get(x);{const h=(i=x.getParameter(x.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return vi.set(x,h),h}}class uo{get awaitingQuery(){return!!this._readbackQueue}constructor(i){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=i;const h=i.context,m=h.gl;this._texFormat=m.RGBA,this._texType=m.UNSIGNED_BYTE;const y=new a.aL;y.emplaceBack(-1,-1),y.emplaceBack(2,-1),y.emplaceBack(-1,2);const w=new a.aN;w.emplaceBack(0,1,2),this._fullscreenTriangle=new Io(h.createVertexBuffer(y,Mo.members),h.createIndexBuffer(w),a.aM.simpleSegment(0,0,y.length,w.length)),this._resultBuffer=new Uint8Array(4),h.activeTexture.set(m.TEXTURE1);const E=m.createTexture();m.bindTexture(m.TEXTURE_2D,E),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texImage2D(m.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=h.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(E),co(m)&&(this._pbo=m.createBuffer(),m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.bufferData(m.PIXEL_PACK_BUFFER,4,m.STREAM_READ),m.bindBuffer(m.PIXEL_PACK_BUFFER,null))}destroy(){const i=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),i.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(i,h){const m=this._updateCount;return this._readbackQueue?m>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():m>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(i,h),this._updateCount++,this._measuredError}_bindFramebuffer(){const i=this._cachedRenderContext.context,h=i.gl;i.activeTexture.set(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this._fbo.colorAttachment.get()),i.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(i,h){const m=this._cachedRenderContext.context,y=m.gl;if(this._bindFramebuffer(),m.viewport.set([0,0,this._texWidth,this._texHeight]),m.clear({color:a.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(m,y.TRIANGLES,cn.disabled,En.disabled,er.unblended,rn.disabled,((w,E)=>({u_input:w,u_output_expected:E}))(i,h),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&co(y)){y.bindBuffer(y.PIXEL_PACK_BUFFER,this._pbo),y.readBuffer(y.COLOR_ATTACHMENT0),y.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,null);const w=y.fenceSync(y.SYNC_GPU_COMMANDS_COMPLETE,0);y.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:w}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const i=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&co(i)){const h=i.clientWaitSync(this._readbackQueue.sync,0,0);if(h===i.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(h===i.TIMEOUT_EXPIRED)return;i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),i.bindBuffer(i.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),i.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=uo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(i){let h=0;return h+=i[0]/256,h+=i[1]/65536,h+=i[2]/16777216,i[3]<127&&(h=-h),h/128}}const Dl=a.$/128;function Ol(x,i){const h=x.granularity!==void 0?Math.max(x.granularity,1):1,m=h+(x.generateBorders?2:0),y=h+(x.extendToNorthPole||x.generateBorders?1:0)+(x.extendToSouthPole||x.generateBorders?1:0),w=m+1,E=y+1,R=x.generateBorders?-1:0,D=x.generateBorders||x.extendToNorthPole?-1:0,B=h+(x.generateBorders?1:0),U=h+(x.generateBorders||x.extendToSouthPole?1:0),W=w*E,$=m*y*6,Z=w*E>65536;if(Z&&i==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const J=Z||i==="32bit",ie=new Int16Array(2*W);let oe=0;for(let ye=D;ye<=U;ye++)for(let he=R;he<=B;he++){let we=he/h*a.$;he===-1&&(we=-Dl),he===h+1&&(we=a.$+Dl);let Me=ye/h*a.$;ye===-1&&(Me=x.extendToNorthPole?a.bh:-Dl),ye===h+1&&(Me=x.extendToSouthPole?a.bi:a.$+Dl),ie[oe++]=we,ie[oe++]=Me}const ae=J?new Uint32Array($):new Uint16Array($);let de=0;for(let ye=0;ye<y;ye++)for(let he=0;he<m;he++){const we=he+1+ye*w,Me=he+(ye+1)*w,_e=he+1+(ye+1)*w;ae[de++]=he+ye*w,ae[de++]=Me,ae[de++]=we,ae[de++]=we,ae[de++]=Me,ae[de++]=_e}return{vertices:ie.buffer.slice(0),indices:ae.buffer.slice(0),uses32bitIndices:J}}const oa=new a.aK({fill:new a.bj(128,2),line:new a.bj(512,0),tile:new a.bj(128,32),stencil:new a.bj(128,1),circle:3});class Ll{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ts.projectionGlobe}get vertexShaderPreludeCode(){return Ts.projectionMercator.vertexSource}get subdivisionGranularity(){return oa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(i){this._errorMeasurement||(this._errorMeasurement=new uo(i));const h=a.U(this._errorQueryLatitudeDegrees),m=2*Math.atan(Math.exp(Math.PI-h*Math.PI*2))-.5*Math.PI,y=this._errorMeasurement.updateErrorLoop(h,m),w=L.now();y!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=y,this._errorMeasurementLastChangeTime=w);const E=Math.min(Math.max((w-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bl(E))}_getMeshKey(i){return`${i.granularity.toString(36)}_${i.generateBorders?"b":""}${i.extendToNorthPole?"n":""}${i.extendToSouthPole?"s":""}`}getMeshFromTileID(i,h,m,y,w){const E=(w==="stencil"?oa.stencil:oa.tile).getGranularityForZoomLevel(h.z);return this._getMesh(i,{granularity:E,generateBorders:m,extendToNorthPole:h.y===0&&y,extendToSouthPole:h.y===(1<<h.z)-1&&y})}_getMesh(i,h){const m=this._getMeshKey(h);if(m in this._tileMeshCache)return this._tileMeshCache[m];const y=(function(w,E){const R=Ol(E,"16bit"),D=a.aL.deserialize({arrayBuffer:R.vertices,length:R.vertices.byteLength/2/2}),B=a.aN.deserialize({arrayBuffer:R.indices,length:R.indices.byteLength/2/3});return new Io(w.createVertexBuffer(D,Mo.members),w.createIndexBuffer(B),a.aM.simpleSegment(0,0,D.length,B.length))})(i,h);return this._tileMeshCache[m]=y,y}recalculate(i){}hasTransition(){const i=L.now();let h=!1;return h=h||(i-this._errorMeasurementLastChangeTime)/1e3<.7,h=h||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,h}setErrorQueryLatitudeDegrees(i){this._errorQueryLatitudeDegrees=i}}const Ws=new a.r({type:new a.D(a.v.projection.type)});class Fl extends a.E{constructor(i){super(),this._transitionable=new a.t(Ws,void 0),this.setProjection(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.F(0)),this._mercatorProjection=new Tn,this._verticalPerspectiveProjection=new Ll}get transitionState(){const i=this.properties.get("type");if(typeof i=="string"&&i==="mercator")return 0;if(typeof i=="string"&&i==="vertical-perspective")return 1;if(i instanceof a.bm){if(i.from==="vertical-perspective"&&i.to==="mercator")return 1-i.transition;if(i.from==="mercator"&&i.to==="vertical-perspective")return i.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(i){this._mercatorProjection.updateGPUdependent(i),this._verticalPerspectiveProjection.updateGPUdependent(i)}getMeshFromTileID(i,h,m,y,w){return this.currentProjection.getMeshFromTileID(i,h,m,y,w)}setProjection(i){this._transitionable.setValue("type",i?.type||"mercator")}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}setErrorQueryLatitudeDegrees(i){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(i),this._mercatorProjection.setErrorQueryLatitudeDegrees(i)}}function Ua(x){const i=Ro(x.worldSize,x.center.lat);return 2*Math.PI*i}function Ss(x,i,h,m,y){const w=1/(1<<y),E=i/a.$*w+m*w,R=a.bo((x/a.$*w+h*w)*Math.PI*2+Math.PI,2*Math.PI),D=2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI,B=Math.cos(D),U=new Float64Array(3);return U[0]=Math.sin(R)*B,U[1]=Math.sin(D),U[2]=Math.cos(R)*B,U}function Dr(x){return(function(i,h){const m=Math.cos(h),y=new Float64Array(3);return y[0]=Math.sin(i)*m,y[1]=Math.sin(h),y[2]=Math.cos(i)*m,y})(x.lng*Math.PI/180,x.lat*Math.PI/180)}function Ro(x,i){return x/(2*Math.PI)/Math.cos(i*Math.PI/180)}function Nl(x){const i=Math.asin(x[1])/Math.PI*180,h=Math.sqrt(x[0]*x[0]+x[2]*x[2]);if(h>1e-6){const m=x[0]/h,y=Math.acos(x[2]/h),w=(m>0?y:-y)/Math.PI*180;return new a.S(a.aO(w,-180,180),i)}return new a.S(0,i)}function Xr(x){return Math.cos(x*Math.PI/180)}function ar(x,i){const h=Xr(x),m=Xr(i);return a.ak(m/h)}function Fu(x,i){const h=x.rotate(i.bearingInRadians),m=i.zoom+ar(i.center.lat,0),y=a.bk(1/Xr(i.center.lat),1/Xr(Math.min(Math.abs(i.center.lat),60)),a.bn(m,7,3,0,1)),w=360/Ua({worldSize:i.worldSize,center:{lat:i.center.lat}});return new a.S(i.center.lng-h.x*w*y,a.ah(i.center.lat+h.y*w,-a.ai,a.ai))}function ko(x){const i=.5*x,h=Math.sin(i),m=Math.cos(i);return Math.log(h+m)-Math.log(m-h)}function Nh(x,i,h,m){const y=x.lat+h*m;if(Math.abs(h)>1){const w=(Math.sign(x.lat+h)!==Math.sign(x.lat)?-Math.abs(x.lat):Math.abs(x.lat))*Math.PI/180,E=Math.abs(x.lat+h)*Math.PI/180,R=ko(w+m*(E-w)),D=ko(w),B=ko(E);return new a.S(x.lng+i*((R-D)/(B-D)),y)}return new a.S(x.lng+i*m,y)}class Bh{constructor(i){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=i}swapBuffers(){if(!this._hadAnyChanges)return;const i=this._cachePrevious;this._cachePrevious=this._cache,this._cache=i,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(i,h,m,y){const w=`${i.z}_${i.x}_${i.y}_${y?.terrain?"t":""}`,E=this._cache.get(w);if(E)return E;const R=this._cachePrevious.get(w);if(R)return this._cache.set(w,R),R;const D=this._boundingVolumeFactory(i,h,m,y);return this._cache.set(w,D),this._hadAnyChanges=!0,D}}class aa{constructor(i,h,m,y){this.min=m,this.max=y,this.points=i,this.planes=h}static fromAabb(i,h){const m=[];for(let y=0;y<8;y++)m.push([1&~y?i[0]:h[0],(y>>1&1)==1?h[1]:i[1],(y>>2&1)==1?h[2]:i[2]]);return new aa(m,[[-1,0,0,h[0]],[1,0,0,-i[0]],[0,-1,0,h[1]],[0,1,0,-i[1]],[0,0,-1,h[2]],[0,0,1,-i[2]]],i,h)}static fromCenterSizeAngles(i,h,m){const y=a.br([],m[0],m[1],m[2]),w=a.bs([],[h[0],0,0],y),E=a.bs([],[0,h[1],0],y),R=a.bs([],[0,0,h[2]],y),D=[...i],B=[...i];for(let W=0;W<8;W++)for(let $=0;$<3;$++){const Z=i[$]+w[$]*(1&~W?-1:1)+E[$]*((W>>1&1)==1?1:-1)+R[$]*((W>>2&1)==1?1:-1);D[$]=Math.min(D[$],Z),B[$]=Math.max(B[$],Z)}const U=[];for(let W=0;W<8;W++){const $=[...i];a.aS($,$,a.aR([],w,1&~W?-1:1)),a.aS($,$,a.aR([],E,(W>>1&1)==1?1:-1)),a.aS($,$,a.aR([],R,(W>>2&1)==1?1:-1)),U.push($)}return new aa(U,[[...w,-a.aX(w,U[0])],[...E,-a.aX(E,U[0])],[...R,-a.aX(R,U[0])],[-w[0],-w[1],-w[2],-a.aX(w,U[7])],[-E[0],-E[1],-E[2],-a.aX(E,U[7])],[-R[0],-R[1],-R[2],-a.aX(R,U[7])]],D,B)}intersectsFrustum(i){let h=!0;const m=this.points.length,y=this.planes.length,w=i.planes.length,E=i.points.length;for(let R=0;R<w;R++){const D=i.planes[R];let B=0;for(let U=0;U<m;U++){const W=this.points[U];D[0]*W[0]+D[1]*W[1]+D[2]*W[2]+D[3]>=0&&B++}if(B===0)return 0;B<m&&(h=!1)}if(h)return 2;for(let R=0;R<y;R++){const D=this.planes[R];let B=0;for(let U=0;U<E;U++){const W=i.points[U];D[0]*W[0]+D[1]*W[1]+D[2]*W[2]+D[3]>=0&&B++}if(B===0)return 0}return 1}intersectsPlane(i){const h=this.points.length;let m=0;for(let y=0;y<h;y++){const w=this.points[y];i[0]*w[0]+i[1]*w[1]+i[2]*w[2]+i[3]>=0&&m++}return m===h?2:m===0?0:1}}function Or(x,i,h){const m=x-i;return m<0?-m:Math.max(0,m-h)}function la(x,i,h,m,y){const w=x-h;let E;return E=w<0?Math.min(-w,1+w-y):w>1?Math.min(Math.max(w-y,0),1-w):0,Math.max(E,Or(i,m,y))}class Hs{constructor(){this._boundingVolumeCache=new Bh(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(i,h,m,y){const w=1<<m.z,E=1/w,R=m.x/w,D=m.y/w;let B=2;return B=Math.min(B,la(i,h,R,D,E)),B=Math.min(B,la(i,h,R+.5,-D-E,E)),B=Math.min(B,la(i,h,R+.5,2-D-E,E)),B}getWrap(i,h,m){const y=1<<h.z,w=1/y,E=h.x/y,R=Or(i.x,E,w),D=Or(i.x,E-1,w),B=Or(i.x,E+1,w),U=Math.min(R,D,B);return U===B?1:U===D?-1:0}allowVariableZoom(i,h){return Vt(i,h)>4}allowWorldCopies(){return!1}getTileBoundingVolume(i,h,m,y){return this._boundingVolumeCache.getTileBoundingVolume(i,h,m,y)}_computeTileBoundingVolume(i,h,m,y){var w,E;let R=0,D=0;if(y?.terrain){const B=new a.Z(i.z,h,i.z,i.x,i.y),U=y.terrain.getMinMaxElevation(B);R=(w=U.minElevation)!==null&&w!==void 0?w:Math.min(0,m),D=(E=U.maxElevation)!==null&&E!==void 0?E:Math.max(0,m)}if(R/=a.bu,D/=a.bu,R+=1,D+=1,i.z<=0)return aa.fromAabb([-D,-D,-D],[D,D,D]);if(i.z===1)return aa.fromAabb([i.x===0?-D:0,i.y===0?0:-D,-D],[i.x===0?0:D,i.y===0?D:0,D]);{const B=[Ss(0,0,i.x,i.y,i.z),Ss(a.$,0,i.x,i.y,i.z),Ss(a.$,a.$,i.x,i.y,i.z),Ss(0,a.$,i.x,i.y,i.z)],U=[];for(const Ye of B)U.push(a.aR([],Ye,D));if(D!==R)for(const Ye of B)U.push(a.aR([],Ye,R));i.y===0&&U.push([0,1,0]),i.y===(1<<i.z)-1&&U.push([0,-1,0]);const W=[1,1,1],$=[-1,-1,-1];for(const Ye of U)for(let tt=0;tt<3;tt++)W[tt]=Math.min(W[tt],Ye[tt]),$[tt]=Math.max($[tt],Ye[tt]);const Z=Ss(a.$/2,a.$/2,i.x,i.y,i.z),J=a.aW([],[0,1,0],Z);a.aV(J,J);const ie=a.aW([],Z,J);a.aV(ie,ie);const oe=a.aW([],B[2],B[1]);a.aV(oe,oe);const ae=a.aW([],B[0],B[3]);a.aV(ae,ae),U.push(a.aR([],Z,D)),i.y>=(1<<i.z)/2&&U.push(a.aR([],Ss(a.$/2,0,i.x,i.y,i.z),D)),i.y<(1<<i.z)/2&&U.push(a.aR([],Ss(a.$/2,a.$,i.x,i.y,i.z),D));const de=Nc(Z,U),ye=Nc(ie,U),he=[-Z[0],-Z[1],-Z[2],de.max],we=[Z[0],Z[1],Z[2],-de.min],Me=[-ie[0],-ie[1],-ie[2],ye.max],_e=[ie[0],ie[1],ie[2],-ye.min],Re=[...oe,0],Ge=[...ae,0],qe=[];return i.y===0?qe.push(a.bt(Ge,Re,he),a.bt(Ge,Re,we)):qe.push(a.bt(Me,Re,he),a.bt(Me,Re,we),a.bt(Me,Ge,he),a.bt(Me,Ge,we)),i.y===(1<<i.z)-1?qe.push(a.bt(Ge,Re,he),a.bt(Ge,Re,we)):qe.push(a.bt(_e,Re,he),a.bt(_e,Re,we),a.bt(_e,Ge,he),a.bt(_e,Ge,we)),new aa(qe,[he,we,Me,_e,Re,Ge],W,$)}}}function Nc(x,i){let h=1/0,m=-1/0;for(const y of i){const w=a.aX(x,y);h=Math.min(h,w),m=Math.max(m,w)}return{min:h,max:m}}class Bc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,h,m){return this._helper.interpolatePadding(i,h,m)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,h){this._helper.resize(i,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,h){this._helper.overrideNearFarZ(i,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i){}constructor(){this._cachedClippingPlane=a.bv(),this._projectionMatrix=a.b9(),this._globeViewProjMatrix32f=a.b8(),this._globeViewProjMatrixNoCorrection=a.b9(),this._globeViewProjMatrixNoCorrectionInverted=a.b9(),this._globeProjMatrixInverted=a.b9(),this._cameraPosition=a.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Pr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(i,h)=>this.getConstrained(i,h)}),this._coveringTilesDetailsProvider=new Hs}clone(){const i=new Bc;return i.apply(this),i}apply(i,h){this._globeLatitudeErrorCorrectionRadians=h||0,this._helper.apply(i)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const i=a.bp();return i[0]=this._cameraPosition[0],i[1]=this._cameraPosition[1],i[2]=this._cameraPosition[2],i}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(i){const{overscaledTileID:h,applyGlobeMatrix:m}=i,y=this._helper.getMercatorTileCoordinates(h);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:y,clippingPlane:this._cachedClippingPlane,projectionTransition:m?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(i){const h=this.pitchInRadians,m=this.cameraToCenterDistance/i,y=Math.sin(h)*m,w=Math.cos(h)*m+1,E=1/Math.sqrt(y*y+w*w)*1;let R=-y,D=w;const B=Math.sqrt(R*R+D*D);R/=B,D/=B;const U=[0,R,D];a.bw(U,U,[0,0,0],-this.bearingInRadians),a.bx(U,U,[0,0,0],-1*this.center.lat*Math.PI/180),a.by(U,U,[0,0,0],this.center.lng*Math.PI/180);const W=1/a.aZ(U);return a.aR(U,U,W),[...U,-E*W]}isLocationOccluded(i){return!this.isSurfacePointVisible(Dr(i))}transformLightDirection(i){const h=this._helper._center.lng*Math.PI/180,m=this._helper._center.lat*Math.PI/180,y=Math.cos(m),w=[Math.sin(h)*y,Math.sin(m),Math.cos(h)*y],E=[w[2],0,-w[0]],R=[0,0,0];a.aW(R,E,w),a.aV(E,E),a.aV(R,R);const D=[0,0,0];return a.aV(D,[E[0]*i[0]+R[0]*i[1]+w[0]*i[2],E[1]*i[0]+R[1]*i[1]+w[1]*i[2],E[2]*i[0]+R[2]*i[1]+w[2]*i[2]]),D}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(i,h,m){const y=(function(R,D,B){const U=1/(1<<B.z);return new a.a1(R/a.$*U+B.x*U,D/a.$*U+B.y*U)})(i,h,m.canonical),w=(E=y.y,[a.bo(y.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI]);var E;return this.getCircleRadiusCorrection()/Math.cos(w[1])}projectTileCoordinates(i,h,m,y){const w=m.canonical,E=Ss(i,h,w.x,w.y,w.z),R=1+(y?y(i,h):0)/a.bu,D=[E[0]*R,E[1]*R,E[2]*R,1];a.aw(D,D,this._globeViewProjMatrixNoCorrection);const B=this._cachedClippingPlane,U=B[0]*E[0]+B[1]*E[1]+B[2]*E[2]+B[3]<0;return{point:new a.P(D[0]/D[3],D[1]/D[3]),signedDistanceFromCamera:D[3],isOccluded:U}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const i=Ro(this.worldSize,this.center.lat),h=a.ba(),m=a.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*i),a.b4(h,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const y=this.centerOffset;h[8]=2*-y.x/this._helper._width,h[9]=2*y.y/this._helper._height,this._projectionMatrix=a.b5(h),this._globeProjMatrixInverted=a.ba(),a.aq(this._globeProjMatrixInverted,h),a.M(h,h,[0,0,-this.cameraToCenterDistance]),a.b6(h,h,this.rollInRadians),a.b7(h,h,-this.pitchInRadians),a.b6(h,h,this.bearingInRadians),a.M(h,h,[0,0,-i]);const w=a.bp();w[0]=i,w[1]=i,w[2]=i,a.b7(m,h,this.center.lat*Math.PI/180),a.bz(m,m,-this.center.lng*Math.PI/180),a.N(m,m,w),this._globeViewProjMatrixNoCorrection=m,a.b7(h,h,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bz(h,h,-this.center.lng*Math.PI/180),a.N(h,h,w),this._globeViewProjMatrix32f=new Float32Array(h),this._globeViewProjMatrixNoCorrectionInverted=a.ba(),a.aq(this._globeViewProjMatrixNoCorrectionInverted,m);const E=a.bp();this._cameraPosition=a.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/i,a.bw(this._cameraPosition,this._cameraPosition,E,-this.rollInRadians),a.bx(this._cameraPosition,this._cameraPosition,E,this.pitchInRadians),a.bw(this._cameraPosition,this._cameraPosition,E,-this.bearingInRadians),a.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bx(this._cameraPosition,this._cameraPosition,E,-this.center.lat*Math.PI/180),a.by(this._cameraPosition,this._cameraPosition,E,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(i);const R=a.b5(this._globeViewProjMatrixNoCorrectionInverted);a.N(R,R,[1,1,-1]),this._cachedFrustum=or.fromInvProjectionMatrix(R,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(i){a.w("calculateFogMatrix is not supported on globe projection.");const h=a.ba();return a.ag(h),h}getVisibleUnwrappedCoordinates(i){return[new a.b2(0,i)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){i&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,h){if(!this._globeViewProjMatrixNoCorrection)return 1;const m=Dr(i);a.aR(m,m,1+h/a.bu);const y=a.bv();return a.aw(y,[m[0],m[1],m[2],1],this._globeViewProjMatrixNoCorrection),y[2]/y[3]}populateCache(i){}getBounds(){const i=.5*this.width,h=.5*this.height,m=[new a.P(0,0),new a.P(i,0),new a.P(this.width,0),new a.P(this.width,h),new a.P(this.width,this.height),new a.P(i,this.height),new a.P(0,this.height),new a.P(0,h)],y=[];for(const W of m)y.push(this.unprojectScreenPoint(W));let w=0,E=0,R=0,D=0;const B=this.center;for(const W of y){const $=a.bA(B.lng,W.lng),Z=a.bA(B.lat,W.lat);$<E&&(E=$),$>w&&(w=$),Z<D&&(D=Z),Z>R&&(R=Z)}const U=[B.lng+E,B.lat+D,B.lng+w,B.lat+R];return this.isSurfacePointOnScreen([0,1,0])&&(U[3]=90,U[0]=-180,U[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(U[1]=-90,U[0]=-180,U[2]=180),new qn(U)}getConstrained(i,h){const m=a.ah(i.lat,-a.ai,a.ai),y=a.ah(+h,this.minZoom+ar(0,m),this.maxZoom);return{center:new a.S(i.lng,m),zoom:y}}calculateCenterFromCameraLngLatAlt(i,h,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(i,h,m,y)}setLocationAtPoint(i,h){const m=Dr(this.unprojectScreenPoint(h)),y=Dr(i),w=a.bp();a.bB(w);const E=a.bp();a.by(E,m,w,-this.center.lng*Math.PI/180),a.bx(E,E,w,this.center.lat*Math.PI/180);const R=y[0]*y[0]+y[2]*y[2],D=E[0]*E[0];if(R<D)return;const B=Math.sqrt(R-D),U=-B,W=a.bC(y[0],y[2],E[0],B),$=a.bC(y[0],y[2],E[0],U),Z=a.bp();a.by(Z,y,w,-W);const J=a.bC(Z[1],Z[2],E[1],E[2]),ie=a.bp();a.by(ie,y,w,-$);const oe=a.bC(ie[1],ie[2],E[1],E[2]),ae=.5*Math.PI,de=J>=-ae&&J<=ae,ye=oe>=-ae&&oe<=ae;let he,we;if(de&&ye){const Ge=this.center.lng*Math.PI/180,qe=this.center.lat*Math.PI/180;a.bD(W,Ge)+a.bD(J,qe)<a.bD($,Ge)+a.bD(oe,qe)?(he=W,we=J):(he=$,we=oe)}else if(de)he=W,we=J;else{if(!ye)return;he=$,we=oe}const Me=he/Math.PI*180,_e=we/Math.PI*180,Re=this.center.lat;this.setCenter(new a.S(Me,a.ah(_e,-90,90))),this.setZoom(this.zoom+ar(Re,this.center.lat))}locationToScreenPoint(i,h){const m=Dr(i);if(h){const y=h.getElevationForLngLatZoom(i,this._helper._tileZoom);a.aR(m,m,1+y/a.bu)}return this._projectSurfacePointToScreen(m)}_projectSurfacePointToScreen(i){const h=a.bv();return a.aw(h,[...i,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],new a.P((.5*h[0]+.5)*this.width,(.5*-h[1]+.5)*this.height)}screenPointToMercatorCoordinate(i,h){if(h){const m=h.pointCoordinate(i);if(m)return m}return a.a1.fromLngLat(this.unprojectScreenPoint(i))}screenPointToLocation(i,h){var m;return(m=this.screenPointToMercatorCoordinate(i,h))===null||m===void 0?void 0:m.toLngLat()}isPointOnMapSurface(i,h){const m=this._cameraPosition,y=this.getRayDirectionFromPixel(i);return!!this.rayPlanetIntersection(m,y)}getRayDirectionFromPixel(i){const h=a.bv();h[0]=i.x/this.width*2-1,h[1]=-1*(i.y/this.height*2-1),h[2]=1,h[3]=1,a.aw(h,h,this._globeViewProjMatrixNoCorrectionInverted),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3];const m=a.bp();m[0]=h[0]-this._cameraPosition[0],m[1]=h[1]-this._cameraPosition[1],m[2]=h[2]-this._cameraPosition[2];const y=a.bp();return a.aV(y,m),y}isSurfacePointVisible(i){const h=this._cachedClippingPlane;return h[0]*i[0]+h[1]*i[1]+h[2]*i[2]+h[3]>=0}isSurfacePointOnScreen(i){if(!this.isSurfacePointVisible(i))return!1;const h=a.bv();return a.aw(h,[...i,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3],h[0]>-1&&h[0]<1&&h[1]>-1&&h[1]<1&&h[2]>-1&&h[2]<1}rayPlanetIntersection(i,h){const m=a.aX(i,h),y=a.bp(),w=a.bp();a.aR(w,h,m),a.aU(y,i,w);const E=1-a.aX(y,y);if(E<0)return null;const R=a.aX(i,i)-1,D=-m+(m<0?1:-1)*Math.sqrt(E),B=R/D,U=D;return{tMin:Math.min(B,U),tMax:Math.max(B,U)}}unprojectScreenPoint(i){const h=this._cameraPosition,m=this.getRayDirectionFromPixel(i),y=this.rayPlanetIntersection(h,m);if(y){const U=a.bp();a.aS(U,h,[m[0]*y.tMin,m[1]*y.tMin,m[2]*y.tMin]);const W=a.bp();return a.aV(W,U),Nl(W)}const w=this._cachedClippingPlane,E=w[0]*m[0]+w[1]*m[1]+w[2]*m[2],R=-a.b1(w,h)/E,D=a.bp();if(R>0)a.aS(D,h,[m[0]*R,m[1]*R,m[2]*R]);else{const U=a.bp();a.aS(U,h,[2*m[0],2*m[1],2*m[2]]);const W=a.b1(this._cachedClippingPlane,U);a.aU(D,U,[this._cachedClippingPlane[0]*W,this._cachedClippingPlane[1]*W,this._cachedClippingPlane[2]*W])}const B=(function(U){const W=a.bp();return W[0]=U[0]*-U[3],W[1]=U[1]*-U[3],W[2]=U[2]*-U[3],{center:W,radius:Math.sqrt(1-U[3]*U[3])}})(w);return Nl((function(U,W,$){const Z=a.bp();a.aU(Z,$,U);const J=a.bp();return a.bq(J,U,Z,W/a.a$(Z)),J})(B.center,B.radius,D))}getMatrixForModel(i,h){const m=a.S.convert(i),y=1/a.bu,w=a.b9();return a.bz(w,w,m.lng/180*Math.PI),a.b7(w,w,-m.lat/180*Math.PI),a.M(w,w,[0,0,1+h/a.bu]),a.b7(w,w,.5*Math.PI),a.N(w,w,[y,y,y]),w}getProjectionDataForCustomLayer(i=!0){const h=this.getProjectionData({overscaledTileID:new a.Z(0,0,0,0,0),applyGlobeMatrix:i});return h.tileMercatorCoords=[0,0,1,1],h}getFastPathSimpleProjectionMatrix(i){}}class zc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,h,m){return this._helper.interpolatePadding(i,h,m)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,h,m=!0){this._helper.resize(i,h,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,h){this._helper.overrideNearFarZ(i,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(i,h){this._globeness=i,this._globeLatitudeErrorCorrectionRadians=h,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Pr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(i,h)=>this.getConstrained(i,h)}),this._globeness=1,this._mercatorTransform=new rr,this._verticalPerspectiveTransform=new Bc}clone(){const i=new zc;return i._globeness=this._globeness,i._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,i.apply(this),i}apply(i){this._helper.apply(i),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(i){const h=this._mercatorTransform.getProjectionData(i),m=this._verticalPerspectiveTransform.getProjectionData(i);return{mainMatrix:this.isGlobeRendering?m.mainMatrix:h.mainMatrix,clippingPlane:m.clippingPlane,tileMercatorCoords:m.tileMercatorCoords,projectionTransition:i.applyGlobeMatrix?this._globeness:0,fallbackMatrix:h.fallbackMatrix}}isLocationOccluded(i){return this.currentTransform.isLocationOccluded(i)}transformLightDirection(i){return this.currentTransform.transformLightDirection(i)}getPixelScale(){return a.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(i,h,m){const y=this._mercatorTransform.getPitchedTextCorrection(i,h,m),w=this._verticalPerspectiveTransform.getPitchedTextCorrection(i,h,m);return a.bk(y,w,this._globeness)}projectTileCoordinates(i,h,m,y){return this.currentTransform.projectTileCoordinates(i,h,m,y)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(i){return this.currentTransform.calculateFogMatrix(i)}getVisibleUnwrappedCoordinates(i){return this.currentTransform.getVisibleUnwrappedCoordinates(i)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(i){this._mercatorTransform.recalculateZoomAndCenter(i),this._verticalPerspectiveTransform.recalculateZoomAndCenter(i)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,h){return this.currentTransform.lngLatToCameraDepth(i,h)}populateCache(i){this._mercatorTransform.populateCache(i),this._verticalPerspectiveTransform.populateCache(i)}getBounds(){return this.currentTransform.getBounds()}getConstrained(i,h){return this.currentTransform.getConstrained(i,h)}calculateCenterFromCameraLngLatAlt(i,h,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(i,h,m,y)}setLocationAtPoint(i,h){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(i,h),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(i,h),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(i,h){return this.currentTransform.locationToScreenPoint(i,h)}screenPointToMercatorCoordinate(i,h){return this.currentTransform.screenPointToMercatorCoordinate(i,h)}screenPointToLocation(i,h){return this.currentTransform.screenPointToLocation(i,h)}isPointOnMapSurface(i,h){return this.currentTransform.isPointOnMapSurface(i,h)}getRayDirectionFromPixel(i){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(i)}getMatrixForModel(i,h){return this.currentTransform.getMatrixForModel(i,h)}getProjectionDataForCustomLayer(i=!0){const h=this._mercatorTransform.getProjectionDataForCustomLayer(i);if(!this.isGlobeRendering)return h;const m=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(i);return m.fallbackMatrix=h.mainMatrix,m}getFastPathSimpleProjectionMatrix(i){return this.currentTransform.getFastPathSimpleProjectionMatrix(i)}}class Kr{get useGlobeControls(){return!0}handlePanInertia(i,h){const m=Fu(i,h);return Math.abs(m.lng-h.center.lng)>180&&(m.lng=h.center.lng+179.5*Math.sign(m.lng-h.center.lng)),{easingCenter:m,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(i,h){const m=i.around,y=h.screenPointToLocation(m);i.bearingDelta&&h.setBearing(h.bearing+i.bearingDelta),i.pitchDelta&&h.setPitch(h.pitch+i.pitchDelta),i.rollDelta&&h.setRoll(h.roll+i.rollDelta);const w=h.zoom;i.zoomDelta&&h.setZoom(h.zoom+i.zoomDelta);const E=h.zoom-w;if(E===0)return;const R=a.bA(h.center.lng,y.lng),D=R/(Math.abs(R/180)+1),B=a.bA(h.center.lat,y.lat),U=h.getRayDirectionFromPixel(m),W=h.cameraPosition,$=-1*a.aX(W,U),Z=a.bp();a.aS(Z,W,[U[0]*$,U[1]*$,U[2]*$]);const J=a.aZ(Z)-1,ie=Math.exp(.5*-Math.max(J-.3,0)),oe=Ro(h.worldSize,h.center.lat)/Math.min(h.width,h.height),ae=a.bn(oe,.9,.5,1,.25),de=(1-a.af(-E))*Math.min(ie,ae),ye=h.center.lat,he=h.zoom,we=new a.S(h.center.lng+D*de,a.ah(h.center.lat+B*de,-a.ai,a.ai));h.setLocationAtPoint(y,m);const Me=h.center,_e=a.bn(Math.abs(R),45,85,0,1),Re=a.bn(oe,.75,.35,0,1),Ge=Math.pow(Math.max(_e,Re),.25),qe=a.bA(Me.lng,we.lng),Ye=a.bA(Me.lat,we.lat);h.setCenter(new a.S(Me.lng+qe*Ge,Me.lat+Ye*Ge).wrap()),h.setZoom(he+ar(ye,h.center.lat))}handleMapControlsPan(i,h,m){if(!i.panDelta)return;const y=h.center.lat,w=h.zoom;h.setCenter(Fu(i.panDelta,h).wrap()),h.setZoom(w+ar(y,h.center.lat))}cameraForBoxAndBearing(i,h,m,y,w){const E=ls(i,h,m,y,w),R=h.left/w.width*2-1,D=(w.width-h.right)/w.width*2-1,B=h.top/w.height*-2+1,U=(w.height-h.bottom)/w.height*-2+1,W=a.bA(m.getWest(),m.getEast())<0,$=W?m.getEast():m.getWest(),Z=W?m.getWest():m.getEast(),J=Math.max(m.getNorth(),m.getSouth()),ie=Math.min(m.getNorth(),m.getSouth()),oe=$+.5*a.bA($,Z),ae=J+.5*a.bA(J,ie),de=w.clone();de.setCenter(E.center),de.setBearing(E.bearing),de.setPitch(0),de.setRoll(0),de.setZoom(E.zoom);const ye=de.modelViewProjectionMatrix,he=[Dr(m.getNorthWest()),Dr(m.getNorthEast()),Dr(m.getSouthWest()),Dr(m.getSouthEast()),Dr(new a.S(Z,ae)),Dr(new a.S($,ae)),Dr(new a.S(oe,J)),Dr(new a.S(oe,ie))],we=Dr(E.center);let Me=Number.POSITIVE_INFINITY;for(const _e of he)R<0&&(Me=Kr.getLesserNonNegativeNonNull(Me,Kr.solveVectorScale(_e,we,ye,"x",R))),D>0&&(Me=Kr.getLesserNonNegativeNonNull(Me,Kr.solveVectorScale(_e,we,ye,"x",D))),B>0&&(Me=Kr.getLesserNonNegativeNonNull(Me,Kr.solveVectorScale(_e,we,ye,"y",B))),U<0&&(Me=Kr.getLesserNonNegativeNonNull(Me,Kr.solveVectorScale(_e,we,ye,"y",U)));if(Number.isFinite(Me)&&Me!==0)return E.zoom=de.zoom+a.ak(Me),E;Fh()}handleJumpToCenterZoom(i,h){const m=i.center.lat,y=i.getConstrained(h.center?a.S.convert(h.center):i.center,i.zoom).center;i.setCenter(y.wrap());const w=h.zoom!==void 0?+h.zoom:i.zoom+ar(m,y.lat);i.zoom!==w&&i.setZoom(w)}handleEaseTo(i,h){const m=i.zoom,y=i.center,w=i.padding,E={roll:i.roll,pitch:i.pitch,bearing:i.bearing},R={roll:h.roll===void 0?i.roll:h.roll,pitch:h.pitch===void 0?i.pitch:h.pitch,bearing:h.bearing===void 0?i.bearing:h.bearing},D=h.zoom!==void 0,B=!i.isPaddingEqual(h.padding);let U=!1;const W=h.center?a.S.convert(h.center):y,$=i.getConstrained(W,m).center;js(i,$);const Z=i.clone();Z.setCenter($),Z.setZoom(D?+h.zoom:m+ar(y.lat,W.lat)),Z.setBearing(h.bearing);const J=new a.P(a.ah(i.centerPoint.x+h.offsetAsPoint.x,0,i.width),a.ah(i.centerPoint.y+h.offsetAsPoint.y,0,i.height));Z.setLocationAtPoint($,J);const ie=(h.offset&&h.offsetAsPoint.mag())>0?Z.center:$,oe=D?+h.zoom:m+ar(y.lat,ie.lat),ae=m+ar(y.lat,0),de=oe+ar(ie.lat,0),ye=a.bA(y.lng,ie.lng),he=a.bA(y.lat,ie.lat),we=a.af(de-ae);return U=oe!==m,{easeFunc:Me=>{if(a.be(E,R)||Zr({startEulerAngles:E,endEulerAngles:R,tr:i,k:Me,useSlerp:E.roll!=R.roll}),B&&i.interpolatePadding(w,h.padding,Me),h.around)a.w("Easing around a point is not supported under globe projection."),i.setLocationAtPoint(h.around,h.aroundPoint);else{const _e=de>ae?Math.min(2,we):Math.max(.5,we),Re=Math.pow(_e,1-Me),Ge=Nh(y,ye,he,Me*Re);i.setCenter(Ge.wrap())}if(U){const _e=a.C.number(ae,de,Me)+ar(0,i.center.lat);i.setZoom(_e)}},isZooming:U,elevationCenter:ie}}handleFlyTo(i,h){const m=h.zoom!==void 0,y=i.center,w=i.zoom,E=i.padding,R=!i.isPaddingEqual(h.padding),D=i.getConstrained(a.S.convert(h.center||h.locationAtOffset),w).center,B=m?+h.zoom:i.zoom+ar(i.center.lat,D.lat),U=i.clone();U.setCenter(D),U.setZoom(B),U.setBearing(h.bearing);const W=new a.P(a.ah(i.centerPoint.x+h.offsetAsPoint.x,0,i.width),a.ah(i.centerPoint.y+h.offsetAsPoint.y,0,i.height));U.setLocationAtPoint(D,W);const $=U.center;js(i,$);const Z=(function(he,we,Me){const _e=Dr(we),Re=Dr(Me),Ge=a.aX(_e,Re),qe=Math.acos(Ge),Ye=Ua(he);return qe/(2*Math.PI)*Ye})(i,y,$),J=w+ar(y.lat,0),ie=B+ar($.lat,0),oe=a.af(ie-J);let ae;if(typeof h.minZoom=="number"){const he=+h.minZoom+ar($.lat,0),we=Math.min(he,J,ie)+ar(0,$.lat),Me=i.getConstrained($,we).zoom+ar($.lat,0);ae=a.af(Me-J)}const de=a.bA(y.lng,$.lng),ye=a.bA(y.lat,$.lat);return{easeFunc:(he,we,Me,_e)=>{const Re=Nh(y,de,ye,Me);R&&i.interpolatePadding(E,h.padding,he);const Ge=he===1?$:Re;i.setCenter(Ge.wrap());const qe=J+a.ak(we);i.setZoom(he===1?B:qe+ar(0,Ge.lat))},scaleOfZoom:oe,targetCenter:$,scaleOfMinZoom:ae,pixelPathLength:Z}}static solveVectorScale(i,h,m,y,w){const E=y==="x"?[m[0],m[4],m[8],m[12]]:[m[1],m[5],m[9],m[13]],R=[m[3],m[7],m[11],m[15]],D=i[0]*E[0]+i[1]*E[1]+i[2]*E[2],B=i[0]*R[0]+i[1]*R[1]+i[2]*R[2],U=h[0]*E[0]+h[1]*E[1]+h[2]*E[2],W=h[0]*R[0]+h[1]*R[1]+h[2]*R[2];return U+w*B===D+w*W||R[3]*(D-U)+E[3]*(W-B)+D*W==U*B?null:(U+E[3]-w*W-w*R[3])/(U-D-w*W+w*B)}static getLesserNonNegativeNonNull(i,h){return h!==null&&h>=0&&h<i?h:i}}class Kd{constructor(i){this._globe=i,this._mercatorCameraHelper=new li,this._verticalPerspectiveCameraHelper=new Kr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(i,h){return this.currentHelper.handlePanInertia(i,h)}handleMapControlsRollPitchBearingZoom(i,h){return this.currentHelper.handleMapControlsRollPitchBearingZoom(i,h)}handleMapControlsPan(i,h,m){this.currentHelper.handleMapControlsPan(i,h,m)}cameraForBoxAndBearing(i,h,m,y,w){return this.currentHelper.cameraForBoxAndBearing(i,h,m,y,w)}handleJumpToCenterZoom(i,h){this.currentHelper.handleJumpToCenterZoom(i,h)}handleEaseTo(i,h){return this.currentHelper.handleEaseTo(i,h)}handleFlyTo(i,h){return this.currentHelper.handleFlyTo(i,h)}}const Nu=(x,i)=>a.y(x,i&&i.filter((h=>h.identifier!=="source.canvas"))),Fp=a.bE();class zh extends a.E{constructor(i,h={}){var m,y;super(),this._rtlPluginLoaded=()=>{for(const E in this.sourceCaches){const R=this.sourceCaches[E].getSource().type;R!=="vector"&&R!=="geojson"||this.sourceCaches[E].reload()}},this.map=i,this.dispatcher=new ht(kt(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",((E,R)=>this.getGlyphs(E,R))),this.dispatcher.registerMessageHandler("GI",((E,R)=>this.getImages(E,R))),this.dispatcher.registerMessageHandler("GDA",((E,R)=>this.getDashes(E,R))),this.imageManager=new Tt,this.imageManager.setEventedParent(this);const w=((m=i._container)===null||m===void 0?void 0:m.lang)||typeof document<"u"&&((y=document.documentElement)===null||y===void 0?void 0:y.lang)||void 0;this.glyphManager=new on(i._requestManager,h.localIdeographFontFamily,w),this.lineAtlas=new ze(256,512),this.crossTileSymbolIndex=new ra,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",a.bG()),so().on(ea,this._rtlPluginLoaded),this.on("data",(E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const R=this.sourceCaches[E.sourceId];if(!R)return;const D=R.getSource();if(D&&D.vectorLayerIds)for(const B in this._layers){const U=this._layers[B];U.source===D.id&&this._validateLayer(U)}}))}setGlobalStateProperty(i,h){var m,y,w;this._checkLoaded();const E=h===null?(w=(y=(m=this.stylesheet.state)===null||m===void 0?void 0:m[i])===null||y===void 0?void 0:y.default)!==null&&w!==void 0?w:null:h;if(a.bH(E,this._globalState[i]))return this;this._globalState[i]=E,this._applyGlobalStateChanges([i])}getGlobalState(){return this._globalState}setGlobalState(i){this._checkLoaded();const h=[];for(const m in i)!a.bH(this._globalState[m],i[m].default)&&(h.push(m),this._globalState[m]=i[m].default);this._applyGlobalStateChanges(h)}_applyGlobalStateChanges(i){if(i.length===0)return;const h=new Set,m={};for(const y of i){m[y]=this._globalState[y];for(const w in this._layers){const E=this._layers[w],R=E.getLayoutAffectingGlobalStateRefs(),D=E.getPaintAffectingGlobalStateRefs();if(R.has(y)&&h.add(E.source),D.has(y))for(const{name:B,value:U}of D.get(y))this._updatePaintProperty(E,B,U)}}this.dispatcher.broadcast("UGS",m);for(const y in this.sourceCaches)h.has(y)&&(this._reloadSource(y),this._changed=!0)}loadURL(i,h={},m){this.fire(new a.l("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const y=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;a.j(y,this._loadStyleRequest).then((E=>{this._loadStyleRequest=null,this._load(E.data,h,m)})).catch((E=>{this._loadStyleRequest=null,E&&!w.signal.aborted&&this.fire(new a.k(E))}))}loadJSON(i,h={},m){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,L.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(i,h,m)})).catch((()=>{}))}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Fp,{validate:!1})}_load(i,h,m){var y,w;let E=h.transformStyle?h.transformStyle(m,i):i;if(!h.validate||!Nu(this,a.z(E))){E=Object.assign({},E),this._loaded=!0,this.stylesheet=E;for(const R in E.sources)this.addSource(R,E.sources[R],{validate:!1});E.sprite?this._loadSprite(E.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(E.glyphs),this._createLayers(),this.light=new Ee(this.stylesheet.light),this._setProjectionInternal(((y=this.stylesheet.projection)===null||y===void 0?void 0:y.type)||"mercator"),this.sky=new me(this.stylesheet.sky),this.map.setTerrain((w=this.stylesheet.terrain)!==null&&w!==void 0?w:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){var i;const h=a.bI(this.stylesheet.layers);this.setGlobalState((i=this.stylesheet.state)!==null&&i!==void 0?i:null),this.dispatcher.broadcast("SL",h),this._order=h.map((m=>m.id)),this._layers={},this._serializedLayers=null;for(const m of h){const y=a.bJ(m,this._globalState);y.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=y}}_loadSprite(i,h=!1,m=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(w,E,R,D){return a._(this,void 0,void 0,(function*(){const B=nt(w),U=R>1?"@2x":"",W={},$={};for(const{id:Z,url:J}of B){const ie=E.transformRequest(pt(J,U,".json"),"SpriteJSON");W[Z]=a.j(ie,D);const oe=E.transformRequest(pt(J,U,".png"),"SpriteImage");$[Z]=Se.getImage(oe,D)}return yield Promise.all([...Object.values(W),...Object.values($)]),(function(Z,J){return a._(this,void 0,void 0,(function*(){const ie={};for(const oe in Z){ie[oe]={};const ae=L.getImageCanvasContext((yield J[oe]).data),de=(yield Z[oe]).data;for(const ye in de){const{width:he,height:we,x:Me,y:_e,sdf:Re,pixelRatio:Ge,stretchX:qe,stretchY:Ye,content:tt,textFitWidth:wt,textFitHeight:xt}=de[ye];ie[oe][ye]={data:null,pixelRatio:Ge,sdf:Re,stretchX:qe,stretchY:Ye,content:tt,textFitWidth:wt,textFitHeight:xt,spriteData:{width:he,height:we,x:Me,y:_e,context:ae}}}}return ie}))})(W,$)}))})(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((w=>{if(this._spriteRequest=null,w)for(const E in w){this._spritesImagesIds[E]=[];const R=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter((D=>!(D in w))):[];for(const D of R)this.imageManager.removeImage(D),this._changedImages[D]=!0;for(const D in w[E]){const B=E==="default"?D:`${E}:${D}`;this._spritesImagesIds[E].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,w[E][D],!1):this.imageManager.addImage(B,w[E][D]),h&&(this._changedImages[B]=!0)}}})).catch((w=>{this._spriteRequest=null,y=w,this.fire(new a.k(y))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),m&&m(y)}))}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(i){const h=this.sourceCaches[i.source];if(!h)return;const m=i.sourceLayer;if(!m)return;const y=h.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(m)===-1)&&this.fire(new a.k(new Error(`Source layer "${m}" does not exist on source "${y.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i,h=!1){const m=this._serializedAllLayers();if(!i||i.length===0)return Object.values(h?a.bK(m):m);const y=[];for(const w of i)if(m[w]){const E=h?a.bK(m[w]):m[w];y.push(E)}return y}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const h=Object.keys(this._layers);for(const m of h){const y=this._layers[m];y.type!=="custom"&&(i[m]=y.serialize())}return i}hasTransitions(){var i,h,m;if(!((i=this.light)===null||i===void 0)&&i.hasTransition()||!((h=this.sky)===null||h===void 0)&&h.hasTransition()||!((m=this.projection)===null||m===void 0)&&m.hasTransition())return!0;for(const y in this.sourceCaches)if(this.sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const h=this._changed;if(h){const y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(y.length||w.length)&&this._updateWorkerLayers(y,w);for(const E in this._updatedSources){const R=this._updatedSources[E];if(R==="reload")this._reloadSource(E);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const m={};for(const y in this.sourceCaches){const w=this.sourceCaches[y];m[y]=w.used,w.used=!1}for(const y of this._order){const w=this._layers[y];w.recalculate(i,this._availableImages),!w.isHidden(i.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const y in m){const w=this.sourceCaches[y];!!m[y]!=!!w.used&&w.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(i),this.sky.recalculate(i),this.projection.recalculate(i),this.z=i.zoom,h&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,h={}){var m;this._checkLoaded();const y=this.serialize();if(i=h.transformStyle?h.transformStyle(y,i):i,((m=h.validate)===null||m===void 0||m)&&Nu(this,a.z(i)))return!1;(i=a.bK(i)).layers=a.bI(i.layers);const w=a.bL(y,i),E=this._getOperationsToPerform(w);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const R of E.operations)R();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const h=[],m=[];for(const y of i)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":h.push((()=>this.addLayer.apply(this,y.args)));break;case"removeLayer":h.push((()=>this.removeLayer.apply(this,y.args)));break;case"setPaintProperty":h.push((()=>this.setPaintProperty.apply(this,y.args)));break;case"setLayoutProperty":h.push((()=>this.setLayoutProperty.apply(this,y.args)));break;case"setFilter":h.push((()=>this.setFilter.apply(this,y.args)));break;case"addSource":h.push((()=>this.addSource.apply(this,y.args)));break;case"removeSource":h.push((()=>this.removeSource.apply(this,y.args)));break;case"setLayerZoomRange":h.push((()=>this.setLayerZoomRange.apply(this,y.args)));break;case"setLight":h.push((()=>this.setLight.apply(this,y.args)));break;case"setGeoJSONSourceData":h.push((()=>this.setGeoJSONSourceData.apply(this,y.args)));break;case"setGlyphs":h.push((()=>this.setGlyphs.apply(this,y.args)));break;case"setSprite":h.push((()=>this.setSprite.apply(this,y.args)));break;case"setTerrain":h.push((()=>this.map.setTerrain.apply(this,y.args)));break;case"setSky":h.push((()=>this.setSky.apply(this,y.args)));break;case"setProjection":this.setProjection.apply(this,y.args);break;case"setGlobalState":h.push((()=>this.setGlobalState.apply(this,y.args)));break;case"setTransition":h.push((()=>{}));break;default:m.push(y.command)}return{operations:h,unimplemented:m}}addImage(i,h){if(this.getImage(i))return this.fire(new a.k(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,h),this._afterImageUpdated(i)}updateImage(i,h){this.imageManager.updateImage(i,h)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new a.k(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,h,m={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.z.source,`sources.${i}`,h,null,m))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const y=this.sourceCaches[i]=new Mn(i,h,this.dispatcher);y.style=this,y.setEventedParent(this,(()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:i}))),y.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===i)return this.fire(new a.k(new Error(`Source "${i}" cannot be removed while layer "${m}" is using it.`)));const h=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],h.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,h){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const m=this.sourceCaches[i].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(h),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,h,m={}){this._checkLoaded();const y=i.id;if(this.getLayer(y))return void this.fire(new a.k(new Error(`Layer "${y}" already exists on this map.`)));let w;if(i.type==="custom"){if(Nu(this,a.bM(i)))return;w=a.bJ(i,this._globalState)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(y,i.source),i=a.bK(i),i=a.e(i,{source:y})),this._validate(a.z.layer,`layers.${y}`,i,{arrayIndex:-1},m))return;w=a.bJ(i,this._globalState),this._validateLayer(w),w.setEventedParent(this,{layer:{id:y}})}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new a.k(new Error(`Cannot add layer "${y}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,y),this._layerOrderChanged=!0,this._layers[y]=w,this._removedLayers[y]&&w.source&&w.type!=="custom"){const R=this._removedLayers[y];delete this._removedLayers[y],R.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(i,h){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new a.k(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===h)return;const m=this._order.indexOf(i);this._order.splice(m,1);const y=h?this._order.indexOf(h):this._order.length;h&&y===-1?this.fire(new a.k(new Error(`Cannot move layer "${i}" before non-existing layer "${h}".`))):(this._order.splice(y,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const h=this._layers[i];if(!h)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${i}".`)));h.setEventedParent(null);const m=this._order.indexOf(i);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=h,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],h.onRemove&&h.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,h,m){this._checkLoaded();const y=this.getLayer(i);y?y.minzoom===h&&y.maxzoom===m||(h!=null&&(y.minzoom=h),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,h,m={}){this._checkLoaded();const y=this.getLayer(i);if(y){if(!a.bH(y.filter,h))return h==null?(y.setFilter(void 0),void this._updateLayer(y)):void(this._validate(a.z.filter,`layers.${y.id}.filter`,h,null,m)||(y.setFilter(a.bK(h)),this._updateLayer(y)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return a.bK(this.getLayer(i).filter)}setLayoutProperty(i,h,m,y={}){this._checkLoaded();const w=this.getLayer(i);w?a.bH(w.getLayoutProperty(h),m)||(w.setLayoutProperty(h,m,y),this._updateLayer(w)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,h){const m=this.getLayer(i);if(m)return m.getLayoutProperty(h);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,h,m,y={}){this._checkLoaded();const w=this.getLayer(i);w?a.bH(w.getPaintProperty(h),m)||this._updatePaintProperty(w,h,m,y):this.fire(new a.k(new Error(`Cannot style non-existing layer "${i}".`)))}_updatePaintProperty(i,h,m,y={}){i.setPaintProperty(h,m,y)&&this._updateLayer(i),this._changed=!0,this._updatedPaintProps[i.id]=!0,this._serializedLayers=null}getPaintProperty(i,h){return this.getLayer(i).getPaintProperty(h)}setFeatureState(i,h){this._checkLoaded();const m=i.source,y=i.sourceLayer,w=this.sourceCaches[m];if(w===void 0)return void this.fire(new a.k(new Error(`The source '${m}' does not exist in the map's style.`)));const E=w.getSource().type;E==="geojson"&&y?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||y?(i.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),w.setFeatureState(y,i.id,h)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,h){this._checkLoaded();const m=i.source,y=this.sourceCaches[m];if(y===void 0)return void this.fire(new a.k(new Error(`The source '${m}' does not exist in the map's style.`)));const w=y.getSource().type,E=w==="vector"?i.sourceLayer:void 0;w!=="vector"||E?h&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(E,i.id,h):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const h=i.source,m=i.sourceLayer,y=this.sourceCaches[h];if(y!==void 0)return y.getSource().type!=="vector"||m?(i.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),y.getFeatureState(m,i.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=a.bN(this.sourceCaches,(w=>w.serialize())),h=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,y=this.stylesheet;return a.bO({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,projection:y.projection,sources:i,layers:h,terrain:m},(w=>w!==void 0))}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const h=E=>this._layers[E].type==="fill-extrusion",m={},y=[];for(let E=this._order.length-1;E>=0;E--){const R=this._order[E];if(h(R)){m[R]=E;for(const D of i){const B=D[R];if(B)for(const U of B)y.push(U)}}}y.sort(((E,R)=>R.intersectionZ-E.intersectionZ));const w=[];for(let E=this._order.length-1;E>=0;E--){const R=this._order[E];if(h(R))for(let D=y.length-1;D>=0;D--){const B=y[D].feature;if(m[B.layer.id]<E)break;w.push(B),y.pop()}else for(const D of i){const B=D[R];if(B)for(const U of B)w.push(U.feature)}}return w}queryRenderedFeatures(i,h,m){h&&h.filter&&this._validate(a.z.filter,"queryRenderedFeatures.filter",h.filter,null,h);const y={};if(h&&h.layers){if(!(Array.isArray(h.layers)||h.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const B of h.layers){const U=this._layers[B];if(!U)return this.fire(new a.k(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];y[U.source]=!0}}const w=[];h.availableImages=this._availableImages;const E=this._serializedAllLayers(),R=h.layers instanceof Set?h.layers:Array.isArray(h.layers)?new Set(h.layers):null,D=Object.assign(Object.assign({},h),{layers:R,globalState:this._globalState});for(const B in this.sourceCaches)h.layers&&!y[B]||w.push(Bt(this.sourceCaches[B],this._layers,E,i,D,m,this.map.terrain?(U,W,$)=>this.map.terrain.getElevation(U,W,$):void 0));return this.placement&&w.push((function(B,U,W,$,Z,J,ie){const oe={},ae=J.queryRenderedSymbols($),de=[];for(const ye of Object.keys(ae).map(Number))de.push(ie[ye]);de.sort(Wt);for(const ye of de){const he=ye.featureIndex.lookupSymbolFeatures(ae[ye.bucketInstanceId],U,ye.bucketIndex,ye.sourceLayerIndex,{filterSpec:Z.filter,globalState:Z.globalState},Z.layers,Z.availableImages,B);for(const we in he){const Me=oe[we]=oe[we]||[],_e=he[we];_e.sort(((Re,Ge)=>{const qe=ye.featureSortOrder;if(qe){const Ye=qe.indexOf(Re.featureIndex);return qe.indexOf(Ge.featureIndex)-Ye}return Ge.featureIndex-Re.featureIndex}));for(const Re of _e)Me.push(Re)}}return(function(ye,he,we){for(const Me in ye)for(const _e of ye[Me])jn(_e,we[he[Me].source]);return ye})(oe,B,W)})(this._layers,E,this.sourceCaches,i,D,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(i,h){h?.filter&&this._validate(a.z.filter,"querySourceFeatures.filter",h.filter,null,h);const m=this.sourceCaches[i];return m?(function(y,w){const E=y.getRenderableIds().map((B=>y.getTileByID(B))),R=[],D={};for(let B=0;B<E.length;B++){const U=E[B],W=U.tileID.canonical.key;D[W]||(D[W]=!0,U.querySourceFeatures(R,w))}return R})(m,h?Object.assign(Object.assign({},h),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(i,h={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const E in i)if(!a.bH(i[E],m[E])){y=!0;break}if(!y)return;const w={now:L.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,h),this.light.updateTransitions(w)}getProjection(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.projection}setProjection(i){if(this._checkLoaded(),this.projection){if(this.projection.name===i.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=i,this._setProjectionInternal(i.type)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,h={}){this._checkLoaded();const m=this.getSky();let y=!1;if(!i&&!m)return;if(i&&!m)y=!0;else if(!i&&m)y=!0;else for(const E in i)if(!a.bH(i[E],m[E])){y=!0;break}if(!y)return;const w={now:L.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,h),this.sky.updateTransitions(w)}_setProjectionInternal(i){const h=(function(m){if(Array.isArray(m)){const y=new Fl({type:m});return{projection:y,transform:new zc,cameraHelper:new Kd(y)}}switch(m){case"mercator":return{projection:new Tn,transform:new rr,cameraHelper:new li};case"globe":{const y=new Fl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:y,transform:new zc,cameraHelper:new Kd(y)}}case"vertical-perspective":return{projection:new Ll,transform:new Bc,cameraHelper:new Kr};default:return a.w(`Unknown projection name: ${m}. Falling back to mercator projection.`),{projection:new Tn,transform:new rr,cameraHelper:new li}}})(i);this.projection=h.projection,this.map.migrateProjection(h.transform,h.cameraHelper);for(const m in this.sourceCaches)this.sourceCaches[m].reload()}_validate(i,h,m,y,w={}){return(!w||w.validate!==!1)&&Nu(this,i.call(a.z,a.e({key:h,style:this.serialize(),value:m,styleSpec:a.v},y)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),so().off(ea,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const m=this.sourceCaches[h];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const h in this.sourceCaches)this.sourceCaches[h].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,h,m,y,w=!1){let E=!1,R=!1;const D={};for(const B of this._order){const U=this._layers[B];if(U.type!=="symbol")continue;if(!D[U.source]){const $=this.sourceCaches[U.source];D[U.source]=$.getRenderableIds(!0).map((Z=>$.getTileByID(Z))).sort(((Z,J)=>J.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(J.tileID)?-1:1)))}const W=this.crossTileSymbolIndex.addLayer(U,D[U.source],i.center.lng);E=E||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(L.now(),i.zoom))&&(this.pauseablePlacement=new Lc(i,this.map.terrain,this._order,w,h,m,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(L.now()),R=!0),E&&this.pauseablePlacement.placement.setStale()),R||E)for(const B of this._order){const U=this._layers[B];U.type==="symbol"&&this.placement.updateLayerOpacities(U,D[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(L.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,h){return a._(this,void 0,void 0,(function*(){const m=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,h.icons),m}))}getGlyphs(i,h){return a._(this,void 0,void 0,(function*(){const m=yield this.glyphManager.getGlyphs(h.stacks),y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,[""]),m}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,h={}){this._checkLoaded(),i&&this._validate(a.z.glyphs,"glyphs",i,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}getDashes(i,h){return a._(this,void 0,void 0,(function*(){const m={};for(const[y,w]of Object.entries(h.dashes))m[y]=this.lineAtlas.getDash(w.dasharray,w.round);return m}))}addSprite(i,h,m={},y){this._checkLoaded();const w=[{id:i,url:h}],E=[...nt(this.stylesheet.sprite),...w];this._validate(a.z.sprite,"sprite",E,null,m)||(this.stylesheet.sprite=E,this._loadSprite(w,!0,y))}removeSprite(i){this._checkLoaded();const h=nt(this.stylesheet.sprite);if(h.find((m=>m.id===i))){if(this._spritesImagesIds[i])for(const m of this._spritesImagesIds[i])this.imageManager.removeImage(m),this._changedImages[m]=!0;h.splice(h.findIndex((m=>m.id===i)),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return nt(this.stylesheet.sprite)}setSprite(i,h={},m){this._checkLoaded(),i&&this._validate(a.z.sprite,"sprite",i,null,h)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,m):(this._unloadSprite(),m&&m(null)))}}var Np=a.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Jd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,h,m,y,w,E,R,D,B){this.context=i;let U=this.boundPaintVertexBuffers.length!==y.length;for(let W=0;!U&&W<y.length;W++)this.boundPaintVertexBuffers[W]!==y[W]&&(U=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==m||U||this.boundIndexBuffer!==w||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==B?this.freshBind(h,m,y,w,E,R,D,B):(i.bindVertexArray.set(this.vao),R&&R.bind(),w&&w.dynamicDraw&&w.bind(),D&&D.bind(),B&&B.bind())}freshBind(i,h,m,y,w,E,R,D){const B=i.numAttributes,U=this.context,W=U.gl;this.vao&&this.destroy(),this.vao=U.createVertexArray(),U.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=D,h.enableAttributes(W,i);for(const $ of m)$.enableAttributes(W,i);E&&E.enableAttributes(W,i),R&&R.enableAttributes(W,i),D&&D.enableAttributes(W,i),h.bind(),h.setVertexAttribPointers(W,i,w);for(const $ of m)$.bind(),$.setVertexAttribPointers(W,i,w);E&&(E.bind(),E.setVertexAttribPointers(W,i,w)),y&&y.bind(),R&&(R.bind(),R.setVertexAttribPointers(W,i,w)),D&&(D.bind(),D.setVertexAttribPointers(W,i,w)),U.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Bu=(x,i,h,m,y)=>({u_texture:0,u_ele_delta:x,u_fog_matrix:i,u_fog_color:h?h.properties.get("fog-color"):a.bf.white,u_fog_ground_blend:h?h.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?0:h?h.calculateFogBlendOpacity(m):0,u_horizon_color:h?h.properties.get("horizon-color"):a.bf.white,u_horizon_fog_blend:h?h.properties.get("horizon-fog-blend"):1,u_is_globe_mode:y?1:0}),Uh={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Va(x){const i=[];for(let h=0;h<x.length;h++){if(x[h]===null)continue;const m=x[h].split(" ");i.push(m.pop())}return i}class Vh{constructor(i,h,m,y,w,E,R,D,B=[]){const U=i.gl;this.program=U.createProgram();const W=Va(h.staticAttributes),$=m?m.getBinderAttributes():[],Z=W.concat($),J=Ts.prelude.staticUniforms?Va(Ts.prelude.staticUniforms):[],ie=R.staticUniforms?Va(R.staticUniforms):[],oe=h.staticUniforms?Va(h.staticUniforms):[],ae=m?m.getBinderUniforms():[],de=J.concat(ie).concat(oe).concat(ae),ye=[];for(const qe of de)ye.indexOf(qe)<0&&ye.push(qe);const he=m?m.defines():[];co(U)&&he.unshift("#version 300 es"),w&&he.push("#define OVERDRAW_INSPECTOR;"),E&&he.push("#define TERRAIN3D;"),D&&he.push(D),B&&he.push(...B);let we=he.concat(Ts.prelude.fragmentSource,R.fragmentSource,h.fragmentSource).join(`
`),Me=he.concat(Ts.prelude.vertexSource,R.vertexSource,h.vertexSource).join(`
`);co(U)||(we=(function(qe){return qe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(we),Me=(function(qe){return qe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Me));const _e=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(_e,we),U.compileShader(_e),!U.getShaderParameter(_e,U.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${U.getShaderInfoLog(_e)}`);U.attachShader(this.program,_e);const Re=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(Re,Me),U.compileShader(Re),!U.getShaderParameter(Re,U.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${U.getShaderInfoLog(Re)}`);U.attachShader(this.program,Re),this.attributes={};const Ge={};this.numAttributes=Z.length;for(let qe=0;qe<this.numAttributes;qe++)Z[qe]&&(U.bindAttribLocation(this.program,qe,Z[qe]),this.attributes[Z[qe]]=qe);if(U.linkProgram(this.program),!U.getProgramParameter(this.program,U.LINK_STATUS))throw new Error(`Program failed to link: ${U.getProgramInfoLog(this.program)}`);U.deleteShader(Re),U.deleteShader(_e);for(let qe=0;qe<ye.length;qe++){const Ye=ye[qe];if(Ye&&!Ge[Ye]){const tt=U.getUniformLocation(this.program,Ye);tt&&(Ge[Ye]=tt)}}this.fixedUniforms=y(i,Ge),this.terrainUniforms=((qe,Ye)=>({u_depth:new a.bP(qe,Ye.u_depth),u_terrain:new a.bP(qe,Ye.u_terrain),u_terrain_dim:new a.bg(qe,Ye.u_terrain_dim),u_terrain_matrix:new a.bR(qe,Ye.u_terrain_matrix),u_terrain_unpack:new a.bS(qe,Ye.u_terrain_unpack),u_terrain_exaggeration:new a.bg(qe,Ye.u_terrain_exaggeration)}))(i,Ge),this.projectionUniforms=((qe,Ye)=>({u_projection_matrix:new a.bR(qe,Ye.u_projection_matrix),u_projection_tile_mercator_coords:new a.bS(qe,Ye.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bS(qe,Ye.u_projection_clipping_plane),u_projection_transition:new a.bg(qe,Ye.u_projection_transition),u_projection_fallback_matrix:new a.bR(qe,Ye.u_projection_fallback_matrix)}))(i,Ge),this.binderUniforms=m?m.getUniforms(i,Ge):[]}draw(i,h,m,y,w,E,R,D,B,U,W,$,Z,J,ie,oe,ae,de,ye){const he=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(m),i.setStencilMode(y),i.setColorMode(w),i.setCullFace(E),D){i.activeTexture.set(he.TEXTURE2),he.bindTexture(he.TEXTURE_2D,D.depthTexture),i.activeTexture.set(he.TEXTURE3),he.bindTexture(he.TEXTURE_2D,D.texture);for(const Me in this.terrainUniforms)this.terrainUniforms[Me].set(D[Me])}if(B)for(const Me in B)this.projectionUniforms[Uh[Me]].set(B[Me]);if(R)for(const Me in this.fixedUniforms)this.fixedUniforms[Me].set(R[Me]);oe&&oe.setUniforms(i,this.binderUniforms,J,{zoom:ie});let we=0;switch(h){case he.LINES:we=2;break;case he.TRIANGLES:we=3;break;case he.LINE_STRIP:we=1}for(const Me of Z.get()){const _e=Me.vaos||(Me.vaos={});(_e[U]||(_e[U]=new Jd)).bind(i,this,W,oe?oe.getPaintVertexBuffers():[],$,Me.vertexOffset,ae,de,ye),he.drawElements(h,Me.primitiveLength*we,he.UNSIGNED_SHORT,Me.primitiveOffset*we*2)}}}function Bl(x,i,h){const m=1/a.aC(h,1,i.transform.tileZoom),y=Math.pow(2,h.tileID.overscaledZ),w=h.tileSize*Math.pow(2,i.transform.tileZoom)/y,E=w*(h.tileID.canonical.x+h.tileID.wrap*y),R=w*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[E>>16,R>>16],u_pixel_coord_lower:[65535&E,65535&R]}}const Zs=(x,i,h,m)=>{const y=x.style.light,w=y.properties.get("position"),E=[w.x,w.y,w.z],R=a.bV();y.properties.get("anchor")==="viewport"&&a.bW(R,x.transform.bearingInRadians),a.bX(E,E,R);const D=x.transform.transformLightDirection(E),B=y.properties.get("color");return{u_lightpos:E,u_lightpos_globe:D,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+i,u_opacity:h,u_fill_translate:m}},Bp=(x,i,h,m,y,w,E)=>a.e(Zs(x,i,h,m),Bl(w,x,E),{u_height_factor:-Math.pow(2,y.overscaledZ)/E.tileSize/8}),zu=(x,i,h,m)=>a.e(Bl(i,x,h),{u_fill_translate:m}),zl=(x,i)=>({u_world:x,u_fill_translate:i}),Uc=(x,i,h,m,y)=>a.e(zu(x,i,h,y),{u_world:m}),zp=(x,i,h,m,y)=>{const w=x.transform;let E,R,D=0;if(h.paint.get("circle-pitch-alignment")==="map"){const B=a.aC(i,1,w.zoom);E=!0,R=[B,B],D=B/(a.$*Math.pow(2,i.tileID.overscaledZ))*2*Math.PI*y}else E=!1,R=w.pixelsToGLUnits;return{u_camera_to_center_distance:w.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+E,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:R,u_globe_extrude_scale:D,u_translate:m}},Uu=x=>({u_pixel_extrude_scale:[1/x.width,1/x.height]}),Up=x=>({u_viewport_size:[x.width,x.height]}),ja=(x,i=1)=>({u_color:x,u_overlay:0,u_overlay_scale:i}),Qd=(x,i,h,m)=>{const y=a.aC(x,1,i)/(a.$*Math.pow(2,x.tileID.overscaledZ))*2*Math.PI*m;return{u_extrude_scale:a.aC(x,1,i),u_intensity:h,u_globe_extrude_scale:y}},jh=(x,i,h,m)=>{const y=a.L();a.bY(y,0,x.width,x.height,0,0,1);const w=x.context.gl;return{u_matrix:y,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:h,u_color_ramp:m,u_opacity:i.paint.get("heatmap-opacity")}},$h=(x,i,h)=>{const m=h.paint.get("hillshade-accent-color");let y;switch(h.paint.get("hillshade-method")){case"basic":y=4;break;case"combined":y=1;break;case"igor":y=2;break;case"multidirectional":y=3;break;default:y=0}const w=h.getIlluminationProperties();for(let E=0;E<w.directionRadians.length;E++)h.paint.get("hillshade-illumination-anchor")==="viewport"&&(w.directionRadians[E]+=x.transform.bearingInRadians);return{u_image:0,u_latrange:Wh(0,i.tileID),u_exaggeration:h.paint.get("hillshade-exaggeration"),u_altitudes:w.altitudeRadians,u_azimuths:w.directionRadians,u_accent:m,u_method:y,u_highlights:w.highlightColor,u_shadows:w.shadowColor}},Ul=(x,i)=>{const h=i.stride,m=a.L();return a.bY(m,0,a.$,-a.$,0,0,1),a.M(m,m,[0,-a.$,0]),{u_matrix:m,u_image:1,u_dimension:[h,h],u_zoom:x.overscaledZ,u_unpack:i.getUnpackVector()}};function Wh(x,i){const h=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new a.a1(0,m/h).toLngLat().lat,new a.a1(0,(m+1)/h).toLngLat().lat]}const Hh=(x,i,h=0)=>({u_image:0,u_unpack:i.getUnpackVector(),u_dimension:[i.stride,i.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:h,u_opacity:x.paint.get("color-relief-opacity")}),Vc=(x,i,h,m)=>{const y=x.transform;return{u_translation:qh(x,i,h),u_ratio:m/a.aC(i,1,y.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Zh=(x,i,h,m,y)=>a.e(Vc(x,i,h,m),{u_image:0,u_image_height:y}),Xh=(x,i,h,m,y)=>{const w=x.transform,E=ua(i,w);return{u_translation:qh(x,i,h),u_texsize:i.imageAtlasTexture.size,u_ratio:m/a.aC(i,1,w.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[E,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},ca=(x,i,h,m,y)=>{const w=ua(i,x.transform);return a.e(Vc(x,i,h,m),{u_tileratio:w,u_crossfade_from:y.fromScale,u_crossfade_to:y.toScale,u_image:0,u_mix:y.t,u_lineatlas_width:x.lineAtlas.width,u_lineatlas_height:x.lineAtlas.height})};function ua(x,i){return 1/a.aC(x,1,i.tileZoom)}function qh(x,i,h){return a.aD(x.transform,i,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const jc=(x,i,h,m,y)=>{return{u_tl_parent:x,u_scale_parent:i,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(w=m.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Vp(m.paint.get("raster-hue-rotate")),u_coords_top:[y[0].x,y[0].y,y[1].x,y[1].y],u_coords_bottom:[y[3].x,y[3].y,y[2].x,y[2].y]};var w,E};function Vp(x){x*=Math.PI/180;const i=Math.sin(x),h=Math.cos(x);return[(2*h+1)/3,(-Math.sqrt(3)*i-h+1)/3,(Math.sqrt(3)*i-h+1)/3]}const Vl=(x,i,h,m,y,w,E,R,D,B,U,W,$)=>{const Z=E.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Z.width/Z.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_label_plane_matrix:R,u_coord_matrix:D,u_is_text:+U,u_pitch_with_map:+m,u_is_along_line:y,u_is_variable_anchor:w,u_texsize:W,u_texture:0,u_translation:B,u_pitched_scale:$}},Gh=(x,i,h,m,y,w,E,R,D,B,U,W,$,Z)=>{const J=E.transform;return a.e(Vl(x,i,h,m,y,w,E,R,D,B,U,W,Z),{u_gamma_scale:m?Math.cos(J.pitch*Math.PI/180)*J.cameraToCenterDistance:1,u_device_pixel_ratio:E.pixelRatio,u_is_halo:1})},$c=(x,i,h,m,y,w,E,R,D,B,U,W,$)=>a.e(Gh(x,i,h,m,y,w,E,R,D,B,!0,U,0,$),{u_texsize_icon:W,u_texture_icon:1}),jl=(x,i)=>({u_opacity:x,u_color:i}),ef=(x,i,h,m,y)=>a.e((function(w,E,R,D){const B=R.imageManager.getPattern(w.from.toString()),U=R.imageManager.getPattern(w.to.toString()),{width:W,height:$}=R.imageManager.getPixelSize(),Z=Math.pow(2,D.tileID.overscaledZ),J=D.tileSize*Math.pow(2,R.transform.tileZoom)/Z,ie=J*(D.tileID.canonical.x+D.tileID.wrap*Z),oe=J*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[W,$],u_mix:E.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/a.aC(D,1,R.transform.tileZoom),u_pixel_coord_upper:[ie>>16,oe>>16],u_pixel_coord_lower:[65535&ie,65535&oe]}})(h,y,i,m),{u_opacity:x}),$l=(x,i)=>{},Yh={fillExtrusion:(x,i)=>({u_lightpos:new a.bT(x,i.u_lightpos),u_lightpos_globe:new a.bT(x,i.u_lightpos_globe),u_lightintensity:new a.bg(x,i.u_lightintensity),u_lightcolor:new a.bT(x,i.u_lightcolor),u_vertical_gradient:new a.bg(x,i.u_vertical_gradient),u_opacity:new a.bg(x,i.u_opacity),u_fill_translate:new a.bU(x,i.u_fill_translate)}),fillExtrusionPattern:(x,i)=>({u_lightpos:new a.bT(x,i.u_lightpos),u_lightpos_globe:new a.bT(x,i.u_lightpos_globe),u_lightintensity:new a.bg(x,i.u_lightintensity),u_lightcolor:new a.bT(x,i.u_lightcolor),u_vertical_gradient:new a.bg(x,i.u_vertical_gradient),u_height_factor:new a.bg(x,i.u_height_factor),u_opacity:new a.bg(x,i.u_opacity),u_fill_translate:new a.bU(x,i.u_fill_translate),u_image:new a.bP(x,i.u_image),u_texsize:new a.bU(x,i.u_texsize),u_pixel_coord_upper:new a.bU(x,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(x,i.u_pixel_coord_lower),u_scale:new a.bT(x,i.u_scale),u_fade:new a.bg(x,i.u_fade)}),fill:(x,i)=>({u_fill_translate:new a.bU(x,i.u_fill_translate)}),fillPattern:(x,i)=>({u_image:new a.bP(x,i.u_image),u_texsize:new a.bU(x,i.u_texsize),u_pixel_coord_upper:new a.bU(x,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(x,i.u_pixel_coord_lower),u_scale:new a.bT(x,i.u_scale),u_fade:new a.bg(x,i.u_fade),u_fill_translate:new a.bU(x,i.u_fill_translate)}),fillOutline:(x,i)=>({u_world:new a.bU(x,i.u_world),u_fill_translate:new a.bU(x,i.u_fill_translate)}),fillOutlinePattern:(x,i)=>({u_world:new a.bU(x,i.u_world),u_image:new a.bP(x,i.u_image),u_texsize:new a.bU(x,i.u_texsize),u_pixel_coord_upper:new a.bU(x,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(x,i.u_pixel_coord_lower),u_scale:new a.bT(x,i.u_scale),u_fade:new a.bg(x,i.u_fade),u_fill_translate:new a.bU(x,i.u_fill_translate)}),circle:(x,i)=>({u_camera_to_center_distance:new a.bg(x,i.u_camera_to_center_distance),u_scale_with_map:new a.bP(x,i.u_scale_with_map),u_pitch_with_map:new a.bP(x,i.u_pitch_with_map),u_extrude_scale:new a.bU(x,i.u_extrude_scale),u_device_pixel_ratio:new a.bg(x,i.u_device_pixel_ratio),u_globe_extrude_scale:new a.bg(x,i.u_globe_extrude_scale),u_translate:new a.bU(x,i.u_translate)}),collisionBox:(x,i)=>({u_pixel_extrude_scale:new a.bU(x,i.u_pixel_extrude_scale)}),collisionCircle:(x,i)=>({u_viewport_size:new a.bU(x,i.u_viewport_size)}),debug:(x,i)=>({u_color:new a.bQ(x,i.u_color),u_overlay:new a.bP(x,i.u_overlay),u_overlay_scale:new a.bg(x,i.u_overlay_scale)}),depth:$l,clippingMask:$l,heatmap:(x,i)=>({u_extrude_scale:new a.bg(x,i.u_extrude_scale),u_intensity:new a.bg(x,i.u_intensity),u_globe_extrude_scale:new a.bg(x,i.u_globe_extrude_scale)}),heatmapTexture:(x,i)=>({u_matrix:new a.bR(x,i.u_matrix),u_world:new a.bU(x,i.u_world),u_image:new a.bP(x,i.u_image),u_color_ramp:new a.bP(x,i.u_color_ramp),u_opacity:new a.bg(x,i.u_opacity)}),hillshade:(x,i)=>({u_image:new a.bP(x,i.u_image),u_latrange:new a.bU(x,i.u_latrange),u_exaggeration:new a.bg(x,i.u_exaggeration),u_altitudes:new a.b_(x,i.u_altitudes),u_azimuths:new a.b_(x,i.u_azimuths),u_accent:new a.bQ(x,i.u_accent),u_method:new a.bP(x,i.u_method),u_shadows:new a.bZ(x,i.u_shadows),u_highlights:new a.bZ(x,i.u_highlights)}),hillshadePrepare:(x,i)=>({u_matrix:new a.bR(x,i.u_matrix),u_image:new a.bP(x,i.u_image),u_dimension:new a.bU(x,i.u_dimension),u_zoom:new a.bg(x,i.u_zoom),u_unpack:new a.bS(x,i.u_unpack)}),colorRelief:(x,i)=>({u_image:new a.bP(x,i.u_image),u_unpack:new a.bS(x,i.u_unpack),u_dimension:new a.bU(x,i.u_dimension),u_elevation_stops:new a.bP(x,i.u_elevation_stops),u_color_stops:new a.bP(x,i.u_color_stops),u_color_ramp_size:new a.bP(x,i.u_color_ramp_size),u_opacity:new a.bg(x,i.u_opacity)}),line:(x,i)=>({u_translation:new a.bU(x,i.u_translation),u_ratio:new a.bg(x,i.u_ratio),u_device_pixel_ratio:new a.bg(x,i.u_device_pixel_ratio),u_units_to_pixels:new a.bU(x,i.u_units_to_pixels)}),lineGradient:(x,i)=>({u_translation:new a.bU(x,i.u_translation),u_ratio:new a.bg(x,i.u_ratio),u_device_pixel_ratio:new a.bg(x,i.u_device_pixel_ratio),u_units_to_pixels:new a.bU(x,i.u_units_to_pixels),u_image:new a.bP(x,i.u_image),u_image_height:new a.bg(x,i.u_image_height)}),linePattern:(x,i)=>({u_translation:new a.bU(x,i.u_translation),u_texsize:new a.bU(x,i.u_texsize),u_ratio:new a.bg(x,i.u_ratio),u_device_pixel_ratio:new a.bg(x,i.u_device_pixel_ratio),u_image:new a.bP(x,i.u_image),u_units_to_pixels:new a.bU(x,i.u_units_to_pixels),u_scale:new a.bT(x,i.u_scale),u_fade:new a.bg(x,i.u_fade)}),lineSDF:(x,i)=>({u_translation:new a.bU(x,i.u_translation),u_ratio:new a.bg(x,i.u_ratio),u_device_pixel_ratio:new a.bg(x,i.u_device_pixel_ratio),u_units_to_pixels:new a.bU(x,i.u_units_to_pixels),u_image:new a.bP(x,i.u_image),u_mix:new a.bg(x,i.u_mix),u_tileratio:new a.bg(x,i.u_tileratio),u_crossfade_from:new a.bg(x,i.u_crossfade_from),u_crossfade_to:new a.bg(x,i.u_crossfade_to),u_lineatlas_width:new a.bg(x,i.u_lineatlas_width),u_lineatlas_height:new a.bg(x,i.u_lineatlas_height)}),raster:(x,i)=>({u_tl_parent:new a.bU(x,i.u_tl_parent),u_scale_parent:new a.bg(x,i.u_scale_parent),u_buffer_scale:new a.bg(x,i.u_buffer_scale),u_fade_t:new a.bg(x,i.u_fade_t),u_opacity:new a.bg(x,i.u_opacity),u_image0:new a.bP(x,i.u_image0),u_image1:new a.bP(x,i.u_image1),u_brightness_low:new a.bg(x,i.u_brightness_low),u_brightness_high:new a.bg(x,i.u_brightness_high),u_saturation_factor:new a.bg(x,i.u_saturation_factor),u_contrast_factor:new a.bg(x,i.u_contrast_factor),u_spin_weights:new a.bT(x,i.u_spin_weights),u_coords_top:new a.bS(x,i.u_coords_top),u_coords_bottom:new a.bS(x,i.u_coords_bottom)}),symbolIcon:(x,i)=>({u_is_size_zoom_constant:new a.bP(x,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(x,i.u_is_size_feature_constant),u_size_t:new a.bg(x,i.u_size_t),u_size:new a.bg(x,i.u_size),u_camera_to_center_distance:new a.bg(x,i.u_camera_to_center_distance),u_pitch:new a.bg(x,i.u_pitch),u_rotate_symbol:new a.bP(x,i.u_rotate_symbol),u_aspect_ratio:new a.bg(x,i.u_aspect_ratio),u_fade_change:new a.bg(x,i.u_fade_change),u_label_plane_matrix:new a.bR(x,i.u_label_plane_matrix),u_coord_matrix:new a.bR(x,i.u_coord_matrix),u_is_text:new a.bP(x,i.u_is_text),u_pitch_with_map:new a.bP(x,i.u_pitch_with_map),u_is_along_line:new a.bP(x,i.u_is_along_line),u_is_variable_anchor:new a.bP(x,i.u_is_variable_anchor),u_texsize:new a.bU(x,i.u_texsize),u_texture:new a.bP(x,i.u_texture),u_translation:new a.bU(x,i.u_translation),u_pitched_scale:new a.bg(x,i.u_pitched_scale)}),symbolSDF:(x,i)=>({u_is_size_zoom_constant:new a.bP(x,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(x,i.u_is_size_feature_constant),u_size_t:new a.bg(x,i.u_size_t),u_size:new a.bg(x,i.u_size),u_camera_to_center_distance:new a.bg(x,i.u_camera_to_center_distance),u_pitch:new a.bg(x,i.u_pitch),u_rotate_symbol:new a.bP(x,i.u_rotate_symbol),u_aspect_ratio:new a.bg(x,i.u_aspect_ratio),u_fade_change:new a.bg(x,i.u_fade_change),u_label_plane_matrix:new a.bR(x,i.u_label_plane_matrix),u_coord_matrix:new a.bR(x,i.u_coord_matrix),u_is_text:new a.bP(x,i.u_is_text),u_pitch_with_map:new a.bP(x,i.u_pitch_with_map),u_is_along_line:new a.bP(x,i.u_is_along_line),u_is_variable_anchor:new a.bP(x,i.u_is_variable_anchor),u_texsize:new a.bU(x,i.u_texsize),u_texture:new a.bP(x,i.u_texture),u_gamma_scale:new a.bg(x,i.u_gamma_scale),u_device_pixel_ratio:new a.bg(x,i.u_device_pixel_ratio),u_is_halo:new a.bP(x,i.u_is_halo),u_translation:new a.bU(x,i.u_translation),u_pitched_scale:new a.bg(x,i.u_pitched_scale)}),symbolTextAndIcon:(x,i)=>({u_is_size_zoom_constant:new a.bP(x,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bP(x,i.u_is_size_feature_constant),u_size_t:new a.bg(x,i.u_size_t),u_size:new a.bg(x,i.u_size),u_camera_to_center_distance:new a.bg(x,i.u_camera_to_center_distance),u_pitch:new a.bg(x,i.u_pitch),u_rotate_symbol:new a.bP(x,i.u_rotate_symbol),u_aspect_ratio:new a.bg(x,i.u_aspect_ratio),u_fade_change:new a.bg(x,i.u_fade_change),u_label_plane_matrix:new a.bR(x,i.u_label_plane_matrix),u_coord_matrix:new a.bR(x,i.u_coord_matrix),u_is_text:new a.bP(x,i.u_is_text),u_pitch_with_map:new a.bP(x,i.u_pitch_with_map),u_is_along_line:new a.bP(x,i.u_is_along_line),u_is_variable_anchor:new a.bP(x,i.u_is_variable_anchor),u_texsize:new a.bU(x,i.u_texsize),u_texsize_icon:new a.bU(x,i.u_texsize_icon),u_texture:new a.bP(x,i.u_texture),u_texture_icon:new a.bP(x,i.u_texture_icon),u_gamma_scale:new a.bg(x,i.u_gamma_scale),u_device_pixel_ratio:new a.bg(x,i.u_device_pixel_ratio),u_is_halo:new a.bP(x,i.u_is_halo),u_translation:new a.bU(x,i.u_translation),u_pitched_scale:new a.bg(x,i.u_pitched_scale)}),background:(x,i)=>({u_opacity:new a.bg(x,i.u_opacity),u_color:new a.bQ(x,i.u_color)}),backgroundPattern:(x,i)=>({u_opacity:new a.bg(x,i.u_opacity),u_image:new a.bP(x,i.u_image),u_pattern_tl_a:new a.bU(x,i.u_pattern_tl_a),u_pattern_br_a:new a.bU(x,i.u_pattern_br_a),u_pattern_tl_b:new a.bU(x,i.u_pattern_tl_b),u_pattern_br_b:new a.bU(x,i.u_pattern_br_b),u_texsize:new a.bU(x,i.u_texsize),u_mix:new a.bg(x,i.u_mix),u_pattern_size_a:new a.bU(x,i.u_pattern_size_a),u_pattern_size_b:new a.bU(x,i.u_pattern_size_b),u_scale_a:new a.bg(x,i.u_scale_a),u_scale_b:new a.bg(x,i.u_scale_b),u_pixel_coord_upper:new a.bU(x,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.bU(x,i.u_pixel_coord_lower),u_tile_units_to_pixels:new a.bg(x,i.u_tile_units_to_pixels)}),terrain:(x,i)=>({u_texture:new a.bP(x,i.u_texture),u_ele_delta:new a.bg(x,i.u_ele_delta),u_fog_matrix:new a.bR(x,i.u_fog_matrix),u_fog_color:new a.bQ(x,i.u_fog_color),u_fog_ground_blend:new a.bg(x,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.bg(x,i.u_fog_ground_blend_opacity),u_horizon_color:new a.bQ(x,i.u_horizon_color),u_horizon_fog_blend:new a.bg(x,i.u_horizon_fog_blend),u_is_globe_mode:new a.bg(x,i.u_is_globe_mode)}),terrainDepth:(x,i)=>({u_ele_delta:new a.bg(x,i.u_ele_delta)}),terrainCoords:(x,i)=>({u_texture:new a.bP(x,i.u_texture),u_terrain_coords_id:new a.bg(x,i.u_terrain_coords_id),u_ele_delta:new a.bg(x,i.u_ele_delta)}),projectionErrorMeasurement:(x,i)=>({u_input:new a.bg(x,i.u_input),u_output_expected:new a.bg(x,i.u_output_expected)}),atmosphere:(x,i)=>({u_sun_pos:new a.bT(x,i.u_sun_pos),u_atmosphere_blend:new a.bg(x,i.u_atmosphere_blend),u_globe_position:new a.bT(x,i.u_globe_position),u_globe_radius:new a.bg(x,i.u_globe_radius),u_inv_proj_matrix:new a.bR(x,i.u_inv_proj_matrix)}),sky:(x,i)=>({u_sky_color:new a.bQ(x,i.u_sky_color),u_horizon_color:new a.bQ(x,i.u_horizon_color),u_horizon:new a.bU(x,i.u_horizon),u_horizon_normal:new a.bU(x,i.u_horizon_normal),u_sky_horizon_blend:new a.bg(x,i.u_sky_horizon_blend),u_sky_blend:new a.bg(x,i.u_sky_blend)})};class Kh{constructor(i,h,m){this.context=i;const y=i.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Wl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xs{constructor(i,h,m,y){this.length=h.length,this.attributes=m,this.itemSize=h.bytesPerElement,this.dynamicDraw=y,this.context=i;const w=i.gl;this.buffer=w.createBuffer(),i.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,h){for(let m=0;m<this.attributes.length;m++){const y=h.attributes[this.attributes[m].name];y!==void 0&&i.enableVertexAttribArray(y)}}setVertexAttribPointers(i,h,m){for(let y=0;y<this.attributes.length;y++){const w=this.attributes[y],E=h.attributes[w.name];E!==void 0&&i.vertexAttribPointer(E,w.components,i[Wl[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Fn{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Vu extends Fn{getDefault(){return a.bf.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ju extends Fn{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class tf extends Fn{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Jh extends Fn{getDefault(){return[!0,!0,!0,!0]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class $a extends Fn{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Qh extends Fn{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class jp extends Fn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const h=this.current;(i.func!==h.func||i.ref!==h.ref||i.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class qs extends Fn{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Wc extends Fn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=i,this.dirty=!1}}class nf extends Fn{getDefault(){return[0,1]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class ed extends Fn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=i,this.dirty=!1}}class rf extends Fn{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class td extends Fn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.BLEND):h.disable(h.BLEND),this.current=i,this.dirty=!1}}class Hl extends Fn{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class $u extends Fn{getDefault(){return a.bf.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Wu extends Fn{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class ha extends Fn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=i,this.dirty=!1}}class Do extends Fn{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Oo extends Fn{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class da extends Fn{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class us extends Fn{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Hc extends Fn{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Wa extends Fn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Zc extends Fn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class fa extends Fn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Ha extends Fn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Xc extends Fn{getDefault(){return null}set(i){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Zl extends Fn{getDefault(){return null}set(i){var h;if(i===this.current&&!this.dirty)return;const m=this.gl;co(m)?m.bindVertexArray(i):(h=m.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class qc extends Fn{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class nd extends Fn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Za extends Fn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Lo extends Fn{constructor(i,h){super(i),this.context=i,this.parent=h}getDefault(){return null}}class Fo extends Lo{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Gc extends Lo{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Cn extends Lo{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}const Yc="Framebuffer is not complete";class $p{constructor(i,h,m,y,w){this.context=i,this.width=h,this.height=m;const E=i.gl,R=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new Fo(i,R),y)this.depthAttachment=w?new Cn(i,R):new Gc(i,R);else if(w)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error(Yc)}destroy(){const i=this.context.gl,h=this.colorAttachment.get();if(h&&i.deleteTexture(h),this.depthAttachment){const m=this.depthAttachment.get();m&&i.deleteRenderbuffer(m)}i.deleteFramebuffer(this.framebuffer)}}class Xl{constructor(i){var h,m;if(this.gl=i,this.clearColor=new Vu(this),this.clearDepth=new ju(this),this.clearStencil=new tf(this),this.colorMask=new Jh(this),this.depthMask=new $a(this),this.stencilMask=new Qh(this),this.stencilFunc=new jp(this),this.stencilOp=new qs(this),this.stencilTest=new Wc(this),this.depthRange=new nf(this),this.depthTest=new ed(this),this.depthFunc=new rf(this),this.blend=new td(this),this.blendFunc=new Hl(this),this.blendColor=new $u(this),this.blendEquation=new Wu(this),this.cullFace=new ha(this),this.cullFaceSide=new Do(this),this.frontFace=new Oo(this),this.program=new da(this),this.activeTexture=new us(this),this.viewport=new Hc(this),this.bindFramebuffer=new Wa(this),this.bindRenderbuffer=new Zc(this),this.bindTexture=new fa(this),this.bindVertexBuffer=new Ha(this),this.bindElementBuffer=new Xc(this),this.bindVertexArray=new Zl(this),this.pixelStoreUnpack=new qc(this),this.pixelStoreUnpackPremultiplyAlpha=new nd(this),this.pixelStoreUnpackFlipY=new Za(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),co(i)){this.HALF_FLOAT=i.HALF_FLOAT;const y=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=i.RGBA16F)!==null&&h!==void 0?h:y?.RGBA16F_EXT,this.RGB16F=(m=i.RGB16F)!==null&&m!==void 0?m:y?.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const y=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=y?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,h){return new Kh(this,i,h)}createVertexBuffer(i,h,m){return new Xs(this,i,h,m)}createRenderbuffer(i,h,m){const y=this.gl,w=y.createRenderbuffer();return this.bindRenderbuffer.set(w),y.renderbufferStorage(y.RENDERBUFFER,i,h,m),this.bindRenderbuffer.set(null),w}createFramebuffer(i,h,m,y){return new $p(this,i,h,m,y)}clear({color:i,depth:h,stencil:m}){const y=this.gl;let w=0;i&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),m!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(w)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){a.bH(i.blendFunction,er.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return co(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var h;return co(this.gl)?this.gl.deleteVertexArray(i):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}let pa;function rd(x,i,h,m,y){const w=x.context,E=x.transform,R=w.gl,D=x.useProgram("collisionBox"),B=[];let U=0,W=0;for(let ae=0;ae<m.length;ae++){const de=m[ae],ye=i.getTile(de).getBucket(h);if(!ye)continue;const he=y?ye.textCollisionBox:ye.iconCollisionBox,we=ye.collisionCircleArray;we.length>0&&(B.push({circleArray:we,circleOffset:W,coord:de}),U+=we.length/4,W=U),he&&D.draw(w,R.LINES,cn.disabled,En.disabled,x.colorModeForRenderPass(),rn.disabled,Uu(x.transform),x.style.map.terrain&&x.style.map.terrain.getTerrainData(de),E.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,x.transform.zoom,null,null,he.collisionVertexBuffer)}if(!y||!B.length)return;const $=x.useProgram("collisionCircle"),Z=new a.b$;Z.resize(4*U),Z._trim();let J=0;for(const ae of B)for(let de=0;de<ae.circleArray.length/4;de++){const ye=4*de,he=ae.circleArray[ye+0],we=ae.circleArray[ye+1],Me=ae.circleArray[ye+2],_e=ae.circleArray[ye+3];Z.emplace(J++,he,we,Me,_e,0),Z.emplace(J++,he,we,Me,_e,1),Z.emplace(J++,he,we,Me,_e,2),Z.emplace(J++,he,we,Me,_e,3)}(!pa||pa.length<2*U)&&(pa=(function(ae){const de=2*ae,ye=new a.c1;ye.resize(de),ye._trim();for(let he=0;he<de;he++){const we=6*he;ye.uint16[we+0]=4*he+0,ye.uint16[we+1]=4*he+1,ye.uint16[we+2]=4*he+2,ye.uint16[we+3]=4*he+2,ye.uint16[we+4]=4*he+3,ye.uint16[we+5]=4*he+0}return ye})(U));const ie=w.createIndexBuffer(pa,!0),oe=w.createVertexBuffer(Z,a.c0.members,!0);for(const ae of B){const de=Up(x.transform);$.draw(w,R.TRIANGLES,cn.disabled,En.disabled,x.colorModeForRenderPass(),rn.disabled,de,x.style.map.terrain&&x.style.map.terrain.getTerrainData(ae.coord),null,h.id,oe,ie,a.aM.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,x.transform.zoom,null,null,null)}oe.destroy(),ie.destroy()}const sf=a.ag(new Float32Array(16));function hr(x,i,h,m,y,w){const{horizontalAlign:E,verticalAlign:R}=a.aH(x);return new a.P((-(E-.5)*i/y+m[0])*w,(-(R-.5)*h/y+m[1])*w)}function id(x,i,h,m,y,w){const E=i.tileAnchorPoint.add(new a.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let R=m.mult(w);h||(R=R.rotate(-y));const D=E.add(R);return kr(D.x,D.y,i.pitchedLabelPlaneMatrix,i.getElevation).point}if(h){const R=Yr(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(x),D=Math.atan(R.y/R.x)+(R.x<0?Math.PI:0);return x.add(m.rotate(D))}return x.add(m)}function ql(x,i,h,m,y,w,E,R,D,B,U,W){const $=x.text.placedSymbolArray,Z=x.text.dynamicLayoutVertexArray,J=x.icon.dynamicLayoutVertexArray,ie={};Z.clear();for(let oe=0;oe<$.length;oe++){const ae=$.get(oe),de=ae.hidden||!ae.crossTileID||x.allowVerticalPlacement&&!ae.placedOrientation?null:m[ae.crossTileID];if(de){const ye=new a.P(ae.anchorX,ae.anchorY),he={getElevation:W,width:y.width,height:y.height,pitchedLabelPlaneMatrix:w,pitchWithMap:h,transform:y,tileAnchorPoint:ye,translation:B,unwrappedTileID:U},we=h?na(ye.x,ye.y,he):Yr(ye.x,ye.y,he),Me=lt(y.cameraToCenterDistance,we.signedDistanceFromCamera);let _e=a.ap(x.textSizeData,R,ae)*Me/a.aB;h&&(_e*=x.tilePixelRatio/E);const{width:Re,height:Ge,anchor:qe,textOffset:Ye,textBoxScale:tt}=de,wt=hr(qe,Re,Ge,Ye,tt,_e),xt=y.getPitchedTextCorrection(ye.x+B[0],ye.y+B[1],U),ft=id(we.point,he,i,wt,-y.bearingInRadians,xt),Ut=x.allowVerticalPlacement&&ae.placedOrientation===a.ao.vertical?Math.PI/2:0;for(let vn=0;vn<ae.numGlyphs;vn++)a.av(Z,ft,Ut);D&&ae.associatedIconIndex>=0&&(ie[ae.associatedIconIndex]={shiftedAnchor:ft,angle:Ut})}else oo(ae.numGlyphs,Z)}if(D){J.clear();const oe=x.icon.placedSymbolArray;for(let ae=0;ae<oe.length;ae++){const de=oe.get(ae);if(de.hidden)oo(de.numGlyphs,J);else{const ye=ie[ae];if(ye)for(let he=0;he<de.numGlyphs;he++)a.av(J,ye.shiftedAnchor,ye.angle);else oo(de.numGlyphs,J)}}x.icon.dynamicLayoutVertexBuffer.updateData(J)}x.text.dynamicLayoutVertexBuffer.updateData(Z)}function ma(x,i,h){return h.iconsInText&&i?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function Gl(x,i,h,m,y,w,E,R,D,B,U,W,$){const Z=x.context,J=Z.gl,ie=x.transform,oe=R==="map",ae=D==="map",de=R!=="viewport"&&h.layout.get("symbol-placement")!=="point",ye=oe&&!ae&&!de,he=!h.layout.get("symbol-sort-key").isConstant();let we=!1;const Me=x.getDepthModeForSublayer(0,cn.ReadOnly),_e=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[],Ge=ie.getCircleRadiusCorrection();for(const qe of m){const Ye=i.getTile(qe),tt=Ye.getBucket(h);if(!tt)continue;const wt=y?tt.text:tt.icon;if(!wt||!wt.segments.get().length||!wt.hasVisibleVertices)continue;const xt=wt.programConfigurations.get(h.id),ft=y||tt.sdfIcons,Ut=y?tt.textSizeData:tt.iconSizeData,vn=ae||ie.pitch!==0,Zn=x.useProgram(ma(ft,y,tt),xt),lr=a.an(Ut,ie.zoom),ir=x.style.map.terrain&&x.style.map.terrain.getTerrainData(qe);let tr,cr,Ir,nr,Kn=[0,0],fr=null;if(y)cr=Ye.glyphAtlasTexture,Ir=J.LINEAR,tr=Ye.glyphAtlasTexture.size,tt.iconsInText&&(Kn=Ye.imageAtlasTexture.size,fr=Ye.imageAtlasTexture,nr=vn||x.options.rotating||x.options.zooming||Ut.kind==="composite"||Ut.kind==="camera"?J.LINEAR:J.NEAREST);else{const Fr=h.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear;cr=Ye.imageAtlasTexture,Ir=ft||x.options.rotating||x.options.zooming||Fr||vn?J.LINEAR:J.NEAREST,tr=Ye.imageAtlasTexture.size}const Sn=a.aC(Ye,1,x.transform.zoom),Qr=Sr(oe,x.transform,Sn),yo=a.L();a.aq(yo,Qr);const ba=Rr(ae,oe,x.transform,Sn),vo=a.aD(ie,Ye,w,E),wa=ie.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),sc=_e&&tt.hasTextData(),zo=h.layout.get("icon-text-fit")!=="none"&&sc&&tt.hasIconData();if(de){const Fr=x.style.map.terrain?(ei,pr)=>x.style.map.terrain.getElevation(qe,ei,pr):null,Nr=h.layout.get("text-rotation-alignment")==="map";gi(tt,x,y,Qr,yo,ae,B,Nr,qe.toUnwrapped(),ie.width,ie.height,vo,Fr)}const hl=y&&_e||zo,es=de||hl?sf:ae?Qr:x.transform.clipSpaceToPixelsMatrix,Ta=ft&&h.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Uo;Uo=ft?tt.iconsInText?$c(Ut.kind,lr,ye,ae,de,hl,x,es,ba,vo,tr,Kn,Ge):Gh(Ut.kind,lr,ye,ae,de,hl,x,es,ba,vo,y,tr,0,Ge):Vl(Ut.kind,lr,ye,ae,de,hl,x,es,ba,vo,y,tr,Ge);const Vo={program:Zn,buffers:wt,uniformValues:Uo,projectionData:wa,atlasTexture:cr,atlasTextureIcon:fr,atlasInterpolation:Ir,atlasInterpolationIcon:nr,isSDF:ft,hasHalo:Ta};if(he&&tt.canOverlap){we=!0;const Fr=wt.segments.get();for(const Nr of Fr)Re.push({segments:new a.aM([Nr]),sortKey:Nr.sortKey,state:Vo,terrainData:ir})}else Re.push({segments:wt.segments,sortKey:0,state:Vo,terrainData:ir})}we&&Re.sort(((qe,Ye)=>qe.sortKey-Ye.sortKey));for(const qe of Re){const Ye=qe.state;if(Z.activeTexture.set(J.TEXTURE0),Ye.atlasTexture.bind(Ye.atlasInterpolation,J.CLAMP_TO_EDGE),Ye.atlasTextureIcon&&(Z.activeTexture.set(J.TEXTURE1),Ye.atlasTextureIcon&&Ye.atlasTextureIcon.bind(Ye.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),Ye.isSDF){const tt=Ye.uniformValues;Ye.hasHalo&&(tt.u_is_halo=1,Xa(Ye.buffers,qe.segments,h,x,Ye.program,Me,U,W,tt,Ye.projectionData,qe.terrainData)),tt.u_is_halo=0}Xa(Ye.buffers,qe.segments,h,x,Ye.program,Me,U,W,Ye.uniformValues,Ye.projectionData,qe.terrainData)}}function Xa(x,i,h,m,y,w,E,R,D,B,U){const W=m.context;y.draw(W,W.gl.TRIANGLES,w,E,R,rn.backCCW,D,U,B,h.id,x.layoutVertexBuffer,x.indexBuffer,i,h.paint,m.transform.zoom,x.programConfigurations.get(h.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function qa(x,i,h,m,y){const w=x.context,E=w.gl,R=En.disabled,D=new er([E.ONE,E.ONE],a.bf.transparent,[!0,!0,!0,!0]),B=i.getBucket(h);if(!B)return;const U=m.key;let W=h.heatmapFbos.get(U);W||(W=ho(w,i.tileSize,i.tileSize),h.heatmapFbos.set(U,W)),w.bindFramebuffer.set(W.framebuffer),w.viewport.set([0,0,i.tileSize,i.tileSize]),w.clear({color:a.bf.transparent});const $=B.programConfigurations.get(h.id),Z=x.useProgram("heatmap",$,!y),J=x.transform.getProjectionData({overscaledTileID:i.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ie=x.style.map.terrain.getTerrainData(m);Z.draw(w,E.TRIANGLES,cn.disabled,R,D,rn.disabled,Qd(i,x.transform.zoom,h.paint.get("heatmap-intensity"),1),ie,J,h.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,h.paint,x.transform.zoom,$)}function Kc(x,i,h,m,y){const w=x.context,E=w.gl,R=x.transform;w.setColorMode(x.colorModeForRenderPass());const D=Yl(w,i),B=h.key,U=i.heatmapFbos.get(B);if(!U)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,U.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1),D.bind(E.LINEAR,E.CLAMP_TO_EDGE);const W=R.getProjectionData({overscaledTileID:h,applyTerrainMatrix:y,applyGlobeMatrix:!m});x.useProgram("heatmapTexture").draw(w,E.TRIANGLES,cn.disabled,En.disabled,x.colorModeForRenderPass(),rn.disabled,jh(x,i,0,1),null,W,i.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments,i.paint,R.zoom),U.destroy(),i.heatmapFbos.delete(B)}function ho(x,i,h){var m,y;const w=x.gl,E=w.createTexture();w.bindTexture(w.TEXTURE_2D,E),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const R=(m=x.HALF_FLOAT)!==null&&m!==void 0?m:w.UNSIGNED_BYTE,D=(y=x.RGBA16F)!==null&&y!==void 0?y:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,D,i,h,0,w.RGBA,R,null);const B=x.createFramebuffer(i,h,!1,!1);return B.colorAttachment.set(E),B}function Yl(x,i){return i.colorRampTexture||(i.colorRampTexture=new a.T(x,i.colorRamp,x.gl.RGBA)),i.colorRampTexture}function Jc(x,i,h,m,y){if(!h||!m||!m.imageAtlas)return;const w=m.imageAtlas.patternPositions;let E=w[h.to.toString()],R=w[h.from.toString()];if(!E&&R&&(E=R),!R&&E&&(R=E),!E||!R){const D=y.getPaintProperty(i);E=w[D],R=w[D]}E&&R&&x.setConstantPatternPositions(E,R)}function Ga(x,i,h,m,y,w,E,R){const D=x.context.gl,B="fill-pattern",U=h.paint.get(B),W=U&&U.constantOr(1),$=h.getCrossfadeParameters();let Z,J,ie,oe,ae;const de=x.transform,ye=h.paint.get("fill-translate"),he=h.paint.get("fill-translate-anchor");E?(J=W&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=D.LINES):(J=W?"fillPattern":"fill",Z=D.TRIANGLES);const we=U.constantOr(null);for(const Me of m){const _e=i.getTile(Me);if(W&&!_e.patternsLoaded())continue;const Re=_e.getBucket(h);if(!Re)continue;const Ge=Re.programConfigurations.get(h.id),qe=x.useProgram(J,Ge),Ye=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Me);W&&(x.context.activeTexture.set(D.TEXTURE0),_e.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ge.updatePaintBuffers($)),Jc(Ge,B,we,_e,h);const tt=de.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),wt=a.aD(de,_e,ye,he);if(E){oe=Re.indexBuffer2,ae=Re.segments2;const ft=[D.drawingBufferWidth,D.drawingBufferHeight];ie=J==="fillOutlinePattern"&&W?Uc(x,$,_e,ft,wt):zl(ft,wt)}else oe=Re.indexBuffer,ae=Re.segments,ie=W?zu(x,$,_e,wt):{u_fill_translate:wt};const xt=x.stencilModeForClipping(Me);qe.draw(x.context,Z,y,xt,w,rn.backCCW,ie,Ye,tt,h.id,Re.layoutVertexBuffer,oe,ae,h.paint,x.transform.zoom,Ge)}}function Kl(x,i,h,m,y,w,E,R){const D=x.context,B=D.gl,U="fill-extrusion-pattern",W=h.paint.get(U),$=W.constantOr(1),Z=h.getCrossfadeParameters(),J=h.paint.get("fill-extrusion-opacity"),ie=W.constantOr(null),oe=x.transform;for(const ae of m){const de=i.getTile(ae),ye=de.getBucket(h);if(!ye)continue;const he=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ae),we=ye.programConfigurations.get(h.id),Me=x.useProgram($?"fillExtrusionPattern":"fillExtrusion",we);$&&(x.context.activeTexture.set(B.TEXTURE0),de.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),we.updatePaintBuffers(Z));const _e=oe.getProjectionData({overscaledTileID:ae,applyGlobeMatrix:!R,applyTerrainMatrix:!0});Jc(we,U,ie,de,h);const Re=a.aD(oe,de,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ge=h.paint.get("fill-extrusion-vertical-gradient"),qe=$?Bp(x,Ge,J,Re,ae,Z,de):Zs(x,Ge,J,Re);Me.draw(D,D.gl.TRIANGLES,y,w,E,rn.backCCW,qe,he,_e,h.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,h.paint,x.transform.zoom,we,x.style.map.terrain&&ye.centroidVertexBuffer)}}function Jl(x,i,h,m,y,w,E,R,D){var B;const U=x.style.projection,W=x.context,$=x.transform,Z=W.gl,J=[`#define NUM_ILLUMINATION_SOURCES ${h.paint.get("hillshade-highlight-color").values.length}`],ie=x.useProgram("hillshade",null,!1,J),oe=!x.options.moving;for(const ae of m){const de=i.getTile(ae),ye=de.fbo;if(!ye)continue;const he=U.getMeshFromTileID(W,ae.canonical,R,!0,"raster"),we=(B=x.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(ae);W.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,ye.colorAttachment.get());const Me=$.getProjectionData({overscaledTileID:ae,aligned:oe,applyGlobeMatrix:!D,applyTerrainMatrix:!0});ie.draw(W,Z.TRIANGLES,w,y[ae.overscaledZ],E,rn.backCCW,$h(x,de,h),we,Me,h.id,he.vertexBuffer,he.indexBuffer,he.segments)}}function fo(x,i,h,m,y,w,E,R,D){var B;const U=x.style.projection,W=x.context,$=x.transform,Z=W.gl,J=x.useProgram("colorRelief"),ie=!x.options.moving;let oe=!0,ae=0;for(const de of m){const ye=i.getTile(de),he=ye.dem;if(oe){const qe=Z.getParameter(Z.MAX_TEXTURE_SIZE),{elevationTexture:Ye,colorTexture:tt}=h.getColorRampTextures(W,qe,he.getUnpackVector());W.activeTexture.set(Z.TEXTURE1),Ye.bind(Z.NEAREST,Z.CLAMP_TO_EDGE),W.activeTexture.set(Z.TEXTURE4),tt.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),oe=!1,ae=Ye.size[0]}if(!he||!he.data)continue;const we=he.stride,Me=he.getPixels();if(W.activeTexture.set(Z.TEXTURE0),W.pixelStoreUnpackPremultiplyAlpha.set(!1),ye.demTexture=ye.demTexture||x.getTileTexture(we),ye.demTexture){const qe=ye.demTexture;qe.update(Me,{premultiply:!1}),qe.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}else ye.demTexture=new a.T(W,Me,Z.RGBA,{premultiply:!1}),ye.demTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const _e=U.getMeshFromTileID(W,de.canonical,R,!0,"raster"),Re=(B=x.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(de),Ge=$.getProjectionData({overscaledTileID:de,aligned:ie,applyGlobeMatrix:!D,applyTerrainMatrix:!0});J.draw(W,Z.TRIANGLES,w,y[de.overscaledZ],E,rn.backCCW,Hh(h,ye.dem,ae),Re,Ge,h.id,_e.vertexBuffer,_e.indexBuffer,_e.segments)}}const Qc=[new a.P(0,0),new a.P(a.$,0),new a.P(a.$,a.$),new a.P(0,a.$)];function Ya(x,i,h,m,y,w,E,R,D=!1,B=!1){const U=m[m.length-1].overscaledZ,W=x.context,$=W.gl,Z=x.useProgram("raster"),J=x.transform,ie=x.style.projection,oe=x.colorModeForRenderPass(),ae=!x.options.moving;for(const de of m){const ye=x.getDepthModeForSublayer(de.overscaledZ-U,h.paint.get("raster-opacity")===1?cn.ReadWrite:cn.ReadOnly,$.LESS),he=i.getTile(de);he.registerFadeDuration(h.paint.get("raster-fade-duration"));const we=i.findLoadedParent(de,0),Me=i.findLoadedSibling(de),_e=Ql(he,we||Me||null,i,h,x.transform,x.style.map.terrain);let Re,Ge;const qe=h.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;W.activeTexture.set($.TEXTURE0),he.texture.bind(qe,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),W.activeTexture.set($.TEXTURE1),we?(we.texture.bind(qe,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,we.tileID.overscaledZ-he.tileID.overscaledZ),Ge=[he.tileID.canonical.x*Re%1,he.tileID.canonical.y*Re%1]):he.texture.bind(qe,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),he.texture.useMipmap&&W.extTextureFilterAnisotropic&&x.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const Ye=x.style.map.terrain&&x.style.map.terrain.getTerrainData(de),tt=J.getProjectionData({overscaledTileID:de,aligned:ae,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),wt=jc(Ge||[0,0],Re||1,_e,h,R),xt=ie.getMeshFromTileID(W,de.canonical,w,E,"raster");Z.draw(W,$.TRIANGLES,ye,y?y[de.overscaledZ]:En.disabled,oe,D?rn.frontCCW:rn.backCCW,wt,Ye,tt,h.id,xt.vertexBuffer,xt.indexBuffer,xt.segments)}}function Ql(x,i,h,m,y,w){const E=m.paint.get("raster-fade-duration");if(!w&&E>0){const R=L.now(),D=(R-x.timeAdded)/E,B=i?(R-i.timeAdded)/E:-1,U=h.getSource(),W=Vt(y,{tileSize:U.tileSize,roundZoom:U.roundZoom}),$=!i||Math.abs(i.tileID.overscaledZ-W)>Math.abs(x.tileID.overscaledZ-W),Z=$&&x.refreshedUponExpiration?1:a.ah($?D:1-B,0,1);return x.refreshedUponExpiration&&D>=1&&(x.refreshedUponExpiration=!1),i?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const eu=new a.bf(1,0,0,1),of=new a.bf(0,1,0,1),sd=new a.bf(0,0,1,1),Hu=new a.bf(1,0,1,1),od=new a.bf(0,1,1,1);function Zu(x,i,h,m){dr(x,0,i+h/2,x.transform.width,h,m)}function po(x,i,h,m){dr(x,i-h/2,0,h,x.transform.height,m)}function dr(x,i,h,m,y,w){const E=x.context,R=E.gl;R.enable(R.SCISSOR_TEST),R.scissor(i*x.pixelRatio,h*x.pixelRatio,m*x.pixelRatio,y*x.pixelRatio),E.clear({color:w}),R.disable(R.SCISSOR_TEST)}function As(x,i,h){const m=x.context,y=m.gl,w=x.useProgram("debug"),E=cn.disabled,R=En.disabled,D=x.colorModeForRenderPass(),B="$debug",U=x.style.map.terrain&&x.style.map.terrain.getTerrainData(h);m.activeTexture.set(y.TEXTURE0);const W=i.getTileByID(h.key).latestRawTileData,$=Math.floor((W&&W.byteLength||0)/1024),Z=i.getTile(h).tileSize,J=512/Math.min(Z,512)*(h.overscaledZ/x.transform.zoom)*.5;let ie=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ie+=` => ${h.overscaledZ}`),(function(ae,de){ae.initDebugOverlayCanvas();const ye=ae.debugOverlayCanvas,he=ae.context.gl,we=ae.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,ye.width,ye.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(de,5,5),we.strokeText(de,5,5),ae.debugOverlayTexture.update(ye),ae.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)})(x,`${ie} ${$}kB`);const oe=x.transform.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!0,applyTerrainMatrix:!0});w.draw(m,y.TRIANGLES,E,R,er.alphaBlended,rn.disabled,ja(a.bf.transparent,J),null,oe,B,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),w.draw(m,y.LINE_STRIP,E,R,D,rn.disabled,ja(a.bf.red),U,oe,B,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function Cr(x,i,h,m){const{isRenderingGlobe:y}=m,w=x.context,E=w.gl,R=x.transform,D=x.colorModeForRenderPass(),B=x.getDepthModeFor3D(),U=x.useProgram("terrain");w.bindFramebuffer.set(null),w.viewport.set([0,0,x.width,x.height]);for(const W of h){const $=i.getTerrainMesh(W.tileID),Z=x.renderToTexture.getTexture(W),J=i.getTerrainData(W.tileID);w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,Z.texture);const ie=i.getMeshFrameDelta(R.zoom),oe=R.calculateFogMatrix(W.tileID.toUnwrapped()),ae=Bu(ie,oe,x.style.sky,R.pitch,y),de=R.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(w,E.TRIANGLES,B,En.disabled,D,rn.backCCW,ae,J,de,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}}function ga(x,i){if(!i.mesh){const h=new a.aL;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1);const m=new a.aN;m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),i.mesh=new Io(x.createVertexBuffer(h,Mo.members),x.createIndexBuffer(m),a.aM.simpleSegment(0,0,h.length,m.length))}return i.mesh}class Ps{constructor(i,h){this.context=new Xl(i),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Mn.maxUnderzooming+Mn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ra}resize(i,h,m){if(this.width=Math.floor(i*m),this.height=Math.floor(h*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const i=this.context,h=new a.aL;h.emplaceBack(0,0),h.emplaceBack(a.$,0),h.emplaceBack(0,a.$),h.emplaceBack(a.$,a.$),this.tileExtentBuffer=i.createVertexBuffer(h,Mo.members),this.tileExtentSegments=a.aM.simpleSegment(0,0,4,2);const m=new a.aL;m.emplaceBack(0,0),m.emplaceBack(a.$,0),m.emplaceBack(0,a.$),m.emplaceBack(a.$,a.$),this.debugBuffer=i.createVertexBuffer(m,Mo.members),this.debugSegments=a.aM.simpleSegment(0,0,4,5);const y=new a.c6;y.emplaceBack(0,0,0,0),y.emplaceBack(a.$,0,a.$,0),y.emplaceBack(0,a.$,0,a.$),y.emplaceBack(a.$,a.$,a.$,a.$),this.rasterBoundsBuffer=i.createVertexBuffer(y,Np.members),this.rasterBoundsSegments=a.aM.simpleSegment(0,0,4,2);const w=new a.aL;w.emplaceBack(0,0),w.emplaceBack(a.$,0),w.emplaceBack(0,a.$),w.emplaceBack(a.$,a.$),this.rasterBoundsBufferPosOnly=i.createVertexBuffer(w,Mo.members),this.rasterBoundsSegmentsPosOnly=a.aM.simpleSegment(0,0,4,5);const E=new a.aL;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(E,Mo.members),this.viewportSegments=a.aM.simpleSegment(0,0,4,2);const R=new a.c7;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(R);const D=new a.aN;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(D);const B=this.context.gl;this.stencilClearMode=new En({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.tileExtentMesh=new Io(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const i=this.context,h=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=a.L();a.bY(m,0,this.width,this.height,0,0,1),a.N(m,m,[h.drawingBufferWidth,h.drawingBufferHeight,0]);const y={mainMatrix:m,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:m};this.useProgram("clippingMask",null,!0).draw(i,h.TRIANGLES,cn.disabled,this.stencilClearMode,er.disabled,rn.disabled,null,null,y,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,h,m){if(this.currentStencilSource===i.source||!i.isTileClipped()||!h||!h.length)return;this.currentStencilSource=i.source,this.nextStencilID+h.length>256&&this.clearStencil();const y=this.context;y.setColorMode(er.disabled),y.setDepthMode(cn.disabled);const w={};for(const E of h)w[E.key]=this.nextStencilID++;this._renderTileMasks(w,h,m,!0),this._renderTileMasks(w,h,m,!1),this._tileClippingMaskIDs=w}_renderTileMasks(i,h,m,y){const w=this.context,E=w.gl,R=this.style.projection,D=this.transform,B=this.useProgram("clippingMask");for(const U of h){const W=i[U.key],$=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U),Z=R.getMeshFromTileID(this.context,U.canonical,y,!0,"stencil"),J=D.getProjectionData({overscaledTileID:U,applyGlobeMatrix:!m,applyTerrainMatrix:!0});B.draw(w,E.TRIANGLES,cn.disabled,new En({func:E.ALWAYS,mask:0},W,255,E.KEEP,E.KEEP,E.REPLACE),er.disabled,m?rn.disabled:rn.backCCW,null,$,J,"$clipping",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}_renderTilesDepthBuffer(){const i=this.context,h=i.gl,m=this.style.projection,y=this.transform,w=this.useProgram("depth"),E=this.getDepthModeFor3D(),R=Be(y,{tileSize:y.tileSize});for(const D of R){const B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),U=m.getMeshFromTileID(this.context,D.canonical,!0,!0,"raster"),W=y.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!0,applyTerrainMatrix:!0});w.draw(i,h.TRIANGLES,E,En.disabled,er.disabled,rn.backCCW,null,B,W,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,h=this.context.gl;return new En({func:h.NOTEQUAL,mask:255},i,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(i){const h=this.context.gl;return new En({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,h.KEEP,h.KEEP,h.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(i){const h=this.context.gl,m=i.sort(((E,R)=>R.overscaledZ-E.overscaledZ)),y=m[m.length-1].overscaledZ,w=m[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const E={};for(let R=0;R<w;R++)E[R+y]=new En({func:h.GEQUAL,mask:255},R+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[E,m]}return[{[y]:En.disabled},m]}stencilConfigForOverlapTwoPass(i){const h=this.context.gl,m=i.sort(((E,R)=>R.overscaledZ-E.overscaledZ)),y=m[m.length-1].overscaledZ,w=m[0].overscaledZ-y+1;if(this.clearStencil(),w>1){const E={},R={};for(let D=0;D<w;D++)E[D+y]=new En({func:h.GREATER,mask:255},w+1+D,255,h.KEEP,h.KEEP,h.REPLACE),R[D+y]=new En({func:h.GREATER,mask:255},1+D,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID=2*w+1,[E,R,m]}return this.nextStencilID=3,[{[y]:new En({func:h.GREATER,mask:255},2,255,h.KEEP,h.KEEP,h.REPLACE)},{[y]:new En({func:h.GREATER,mask:255},1,255,h.KEEP,h.KEEP,h.REPLACE)},m]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new er([i.CONSTANT_COLOR,i.ONE],new a.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?er.unblended:er.alphaBlended}getDepthModeForSublayer(i,h,m){if(!this.opaquePassEnabledForLayer())return cn.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new cn(m||this.context.gl.LEQUAL,h,[y,y])}getDepthModeFor3D(){return new cn(this.context.gl.LEQUAL,cn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,h){var m,y;this.style=i,this.options=h,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(L.now()),this.imageManager.beginFrame();const w=this.style._order,E=this.style.sourceCaches,R={},D={},B={},U={isRenderingToTexture:!1,isRenderingGlobe:((m=i.projection)===null||m===void 0?void 0:m.transitionState)>0};for(const $ in E){const Z=E[$];Z.used&&Z.prepare(this.context),R[$]=Z.getVisibleCoordinates(!1),D[$]=R[$].slice().reverse(),B[$]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<w.length;$++)if(this.style._layers[w[$]].is3D()){this.opaquePassCutoff=$;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const $ of w){const Z=this.style._layers[$];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const J=D[Z.source];(Z.type==="custom"||J.length)&&this.renderLayer(this,E[Z.source],Z,J,U)}if((y=this.style.projection)===null||y===void 0||y.updateGPUdependent({context:this.context,useProgram:$=>this.useProgram($)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.bf.black:a.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function($,Z){const J=$.context,ie=J.gl,oe=((Me,_e,Re)=>{const Ge=Math.cos(_e.rollInRadians),qe=Math.sin(_e.rollInRadians),Ye=Ce(_e),tt=_e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Me.properties.get("sky-color"),u_horizon_color:Me.properties.get("horizon-color"),u_horizon:[(_e.width/2-Ye*qe)*Re,(_e.height/2+Ye*Ge)*Re],u_horizon_normal:[-qe,Ge],u_sky_horizon_blend:Me.properties.get("sky-horizon-blend")*_e.height/2*Re,u_sky_blend:tt}})(Z,$.style.map.transform,$.pixelRatio),ae=new cn(ie.LEQUAL,cn.ReadWrite,[0,1]),de=En.disabled,ye=$.colorModeForRenderPass(),he=$.useProgram("sky"),we=ga(J,Z);he.draw(J,ie.TRIANGLES,ae,de,ye,rn.disabled,oe,null,void 0,"sky",we.vertexBuffer,we.indexBuffer,we.segments)})(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[w[this.currentLayer]],Z=E[$.source],J=R[$.source];this._renderTileClippingMasks($,J,!1),this.renderLayer(this,Z,$,J,U)}this.renderPass="translucent";let W=!1;for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const $=this.style._layers[w[this.currentLayer]],Z=E[$.source];if(this.renderToTexture&&this.renderToTexture.renderLayer($,U))continue;this.opaquePassEnabledForLayer()||W||(W=!0,U.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const J=($.type==="symbol"?B:D)[$.source];this._renderTileClippingMasks($,R[$.source],!!this.renderToTexture),this.renderLayer(this,Z,$,J,U)}if(U.isRenderingGlobe&&(function($,Z,J){const ie=$.context,oe=ie.gl,ae=$.useProgram("atmosphere"),de=new cn(oe.LEQUAL,cn.ReadOnly,[0,1]),ye=$.transform,he=(function(tt,wt){const xt=tt.properties.get("position"),ft=[-xt.x,-xt.y,-xt.z],Ut=a.ag(new Float64Array(16));return tt.properties.get("anchor")==="map"&&(a.b6(Ut,Ut,wt.rollInRadians),a.b7(Ut,Ut,-wt.pitchInRadians),a.b6(Ut,Ut,wt.bearingInRadians),a.b7(Ut,Ut,wt.center.lat*Math.PI/180),a.bz(Ut,Ut,-wt.center.lng*Math.PI/180)),a.c5(ft,ft,Ut),ft})(J,$.transform),we=ye.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Me=Z.properties.get("atmosphere-blend")*we.projectionTransition;if(Me===0)return;const _e=Ro(ye.worldSize,ye.center.lat),Re=ye.inverseProjectionMatrix,Ge=new Float64Array(4);Ge[3]=1,a.aw(Ge,Ge,ye.modelViewProjectionMatrix),Ge[0]/=Ge[3],Ge[1]/=Ge[3],Ge[2]/=Ge[3],Ge[3]=1,a.aw(Ge,Ge,Re),Ge[0]/=Ge[3],Ge[1]/=Ge[3],Ge[2]/=Ge[3],Ge[3]=1;const qe=((tt,wt,xt,ft,Ut)=>({u_sun_pos:tt,u_atmosphere_blend:wt,u_globe_position:xt,u_globe_radius:ft,u_inv_proj_matrix:Ut}))(he,Me,[Ge[0],Ge[1],Ge[2]],_e,Re),Ye=ga(ie,Z);ae.draw(ie,oe.TRIANGLES,de,En.disabled,er.alphaBlended,rn.disabled,qe,null,null,"atmosphere",Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const $=(function(Z,J){let ie=null;const oe=Object.values(Z._layers).flatMap((he=>he.source&&!he.isHidden(J)?[Z.sourceCaches[he.source]]:[])),ae=oe.filter((he=>he.getSource().type==="vector")),de=oe.filter((he=>he.getSource().type!=="vector")),ye=he=>{(!ie||ie.getSource().maxzoom<he.getSource().maxzoom)&&(ie=he)};return ae.forEach((he=>ye(he))),ie||de.forEach((he=>ye(he))),ie})(this.style,this.transform.zoom);$&&(function(Z,J,ie){for(let oe=0;oe<ie.length;oe++)As(Z,J,ie[oe])})(this,$,$.getVisibleCoordinates())}this.options.showPadding&&(function($){const Z=$.transform.padding;Zu($,$.transform.height-(Z.top||0),3,eu),Zu($,Z.bottom||0,3,of),po($,Z.left||0,3,sd),po($,$.transform.width-(Z.right||0),3,Hu);const J=$.transform.centerPoint;(function(ie,oe,ae,de){dr(ie,oe-1,ae-10,2,20,de),dr(ie,oe-10,ae-1,20,2,de)})($,J.x,$.transform.height-J.y,od)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=i?!a.c8(h,m):!a.c9(h,m)),y||(y=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),y&&(a.ca(h,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(w,E){const R=w.context,D=R.gl,B=w.transform,U=er.unblended,W=new cn(D.LEQUAL,cn.ReadWrite,[0,1]),$=E.sourceCache.getRenderableTiles(),Z=w.useProgram("terrainDepth");R.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),R.clear({color:a.bf.transparent,depth:1});for(const J of $){const ie=E.getTerrainMesh(J.tileID),oe=E.getTerrainData(J.tileID),ae=B.getProjectionData({overscaledTileID:J.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),de={u_ele_delta:E.getMeshFrameDelta(B.zoom)};Z.draw(R,D.TRIANGLES,W,En.disabled,U,rn.backCCW,de,oe,ae,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,w.width,w.height])})(this,this.style.map.terrain),(function(w,E){const R=w.context,D=R.gl,B=w.transform,U=er.unblended,W=new cn(D.LEQUAL,cn.ReadWrite,[0,1]),$=E.getCoordsTexture(),Z=E.sourceCache.getRenderableTiles(),J=w.useProgram("terrainCoords");R.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),R.clear({color:a.bf.transparent,depth:1}),E.coordsIndex=[];for(const ie of Z){const oe=E.getTerrainMesh(ie.tileID),ae=E.getTerrainData(ie.tileID);R.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,$.texture);const de={u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(B.zoom)},ye=B.getProjectionData({overscaledTileID:ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});J.draw(R,D.TRIANGLES,W,En.disabled,U,rn.backCCW,de,ae,ye,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments),E.coordsIndex.push(ie.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,w.width,w.height])})(this,this.style.map.terrain))}renderLayer(i,h,m,y,w){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="custom"||(y||[]).length)&&(this.id=m.id,a.cb(m)?(function(E,R,D,B,U,W){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:$}=W,Z=En.disabled,J=E.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ie,oe,ae,de,ye,he,we,Me,_e){const Re=oe.transform,Ge=oe.style.map.terrain,qe=ye==="map",Ye=he==="map";for(const tt of ie){const wt=de.getTile(tt),xt=wt.getBucket(ae);if(!xt||!xt.text||!xt.text.segments.get().length)continue;const ft=a.an(xt.textSizeData,Re.zoom),Ut=a.aC(wt,1,oe.transform.zoom),vn=Sr(qe,oe.transform,Ut),Zn=ae.layout.get("icon-text-fit")!=="none"&&xt.hasIconData();if(ft){const lr=Math.pow(2,Re.zoom-wt.tileID.overscaledZ),ir=Ge?(tr,cr)=>Ge.getElevation(tt,tr,cr):null;ql(xt,qe,Ye,_e,Re,vn,lr,ft,Zn,a.aD(Re,wt,we,Me),tt.toUnwrapped(),ir)}}})(B,E,D,R,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),U),D.paint.get("icon-opacity").constantOr(1)!==0&&Gl(E,R,D,B,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),Z,J,$),D.paint.get("text-opacity").constantOr(1)!==0&&Gl(E,R,D,B,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),Z,J,$),R.map.showCollisionBoxes&&(rd(E,R,D,B,!0),rd(E,R,D,B,!1))})(i,h,m,y,this.style.placement.variableOffsets,w):a.cc(m)?(function(E,R,D,B,U){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:W}=U,$=D.paint.get("circle-opacity"),Z=D.paint.get("circle-stroke-width"),J=D.paint.get("circle-stroke-opacity"),ie=!D.layout.get("circle-sort-key").isConstant();if($.constantOr(1)===0&&(Z.constantOr(1)===0||J.constantOr(1)===0))return;const oe=E.context,ae=oe.gl,de=E.transform,ye=E.getDepthModeForSublayer(0,cn.ReadOnly),he=En.disabled,we=E.colorModeForRenderPass(),Me=[],_e=de.getCircleRadiusCorrection();for(let Re=0;Re<B.length;Re++){const Ge=B[Re],qe=R.getTile(Ge),Ye=qe.getBucket(D);if(!Ye)continue;const tt=D.paint.get("circle-translate"),wt=D.paint.get("circle-translate-anchor"),xt=a.aD(de,qe,tt,wt),ft=Ye.programConfigurations.get(D.id),Ut=E.useProgram("circle",ft),vn=Ye.layoutVertexBuffer,Zn=Ye.indexBuffer,lr=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ge),ir={programConfiguration:ft,program:Ut,layoutVertexBuffer:vn,indexBuffer:Zn,uniformValues:zp(E,qe,D,xt,_e),terrainData:lr,projectionData:de.getProjectionData({overscaledTileID:Ge,applyGlobeMatrix:!W,applyTerrainMatrix:!0})};if(ie){const tr=Ye.segments.get();for(const cr of tr)Me.push({segments:new a.aM([cr]),sortKey:cr.sortKey,state:ir})}else Me.push({segments:Ye.segments,sortKey:0,state:ir})}ie&&Me.sort(((Re,Ge)=>Re.sortKey-Ge.sortKey));for(const Re of Me){const{programConfiguration:Ge,program:qe,layoutVertexBuffer:Ye,indexBuffer:tt,uniformValues:wt,terrainData:xt,projectionData:ft}=Re.state;qe.draw(oe,ae.TRIANGLES,ye,he,we,rn.backCCW,wt,xt,ft,D.id,Ye,tt,Re.segments,D.paint,E.transform.zoom,Ge)}})(i,h,m,y,w):a.cd(m)?(function(E,R,D,B,U){if(D.paint.get("heatmap-opacity")===0)return;const W=E.context,{isRenderingToTexture:$,isRenderingGlobe:Z}=U;if(E.style.map.terrain){for(const J of B){const ie=R.getTile(J);R.hasRenderableParent(J)||(E.renderPass==="offscreen"?qa(E,ie,D,J,Z):E.renderPass==="translucent"&&Kc(E,D,J,$,Z))}W.viewport.set([0,0,E.width,E.height])}else E.renderPass==="offscreen"?(function(J,ie,oe,ae){const de=J.context,ye=de.gl,he=J.transform,we=En.disabled,Me=new er([ye.ONE,ye.ONE],a.bf.transparent,[!0,!0,!0,!0]);(function(_e,Re,Ge){const qe=_e.gl;_e.activeTexture.set(qe.TEXTURE1),_e.viewport.set([0,0,Re.width/4,Re.height/4]);let Ye=Ge.heatmapFbos.get(a.c2);Ye?(qe.bindTexture(qe.TEXTURE_2D,Ye.colorAttachment.get()),_e.bindFramebuffer.set(Ye.framebuffer)):(Ye=ho(_e,Re.width/4,Re.height/4),Ge.heatmapFbos.set(a.c2,Ye))})(de,J,oe),de.clear({color:a.bf.transparent});for(let _e=0;_e<ae.length;_e++){const Re=ae[_e];if(ie.hasRenderableParent(Re))continue;const Ge=ie.getTile(Re),qe=Ge.getBucket(oe);if(!qe)continue;const Ye=qe.programConfigurations.get(oe.id),tt=J.useProgram("heatmap",Ye),wt=he.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),xt=he.getCircleRadiusCorrection();tt.draw(de,ye.TRIANGLES,cn.disabled,we,Me,rn.backCCW,Qd(Ge,he.zoom,oe.paint.get("heatmap-intensity"),xt),null,wt,oe.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,oe.paint,he.zoom,Ye)}de.viewport.set([0,0,J.width,J.height])})(E,R,D,B):E.renderPass==="translucent"&&(function(J,ie){const oe=J.context,ae=oe.gl;oe.setColorMode(J.colorModeForRenderPass());const de=ie.heatmapFbos.get(a.c2);de&&(oe.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_2D,de.colorAttachment.get()),oe.activeTexture.set(ae.TEXTURE1),Yl(oe,ie).bind(ae.LINEAR,ae.CLAMP_TO_EDGE),J.useProgram("heatmapTexture").draw(oe,ae.TRIANGLES,cn.disabled,En.disabled,J.colorModeForRenderPass(),rn.disabled,jh(J,ie,0,1),null,null,ie.id,J.viewportBuffer,J.quadTriangleIndexBuffer,J.viewportSegments,ie.paint,J.transform.zoom))})(E,D)})(i,h,m,y,w):a.ce(m)?(function(E,R,D,B,U){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:W}=U,$=D.paint.get("line-opacity"),Z=D.paint.get("line-width");if($.constantOr(1)===0||Z.constantOr(1)===0)return;const J=E.getDepthModeForSublayer(0,cn.ReadOnly),ie=E.colorModeForRenderPass(),oe=D.paint.get("line-dasharray"),ae=oe.constantOr(1),de=D.paint.get("line-pattern"),ye=de.constantOr(1),he=D.paint.get("line-gradient"),we=D.getCrossfadeParameters(),Me=ye?"linePattern":ae?"lineSDF":he?"lineGradient":"line",_e=E.context,Re=_e.gl,Ge=E.transform;let qe=!0;for(const Ye of B){const tt=R.getTile(Ye);if(ye&&!tt.patternsLoaded())continue;const wt=tt.getBucket(D);if(!wt)continue;const xt=wt.programConfigurations.get(D.id),ft=E.context.program.get(),Ut=E.useProgram(Me,xt),vn=qe||Ut.program!==ft,Zn=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ye),lr=de.constantOr(null),ir=oe&&oe.constantOr(null);if(lr&&tt.imageAtlas){const Kn=tt.imageAtlas,fr=Kn.patternPositions[lr.to.toString()],Sn=Kn.patternPositions[lr.from.toString()];fr&&Sn&&xt.setConstantPatternPositions(fr,Sn)}else if(ir){const Kn=D.layout.get("line-cap")==="round",fr=E.lineAtlas.getDash(ir.to,Kn),Sn=E.lineAtlas.getDash(ir.from,Kn);xt.setConstantDashPositions(fr,Sn)}const tr=Ge.getProjectionData({overscaledTileID:Ye,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),cr=Ge.getPixelScale(),Ir=ye?Xh(E,tt,D,cr,we):ae?ca(E,tt,D,cr,we):he?Zh(E,tt,D,cr,wt.lineClipsArray.length):Vc(E,tt,D,cr);if(ye)_e.activeTexture.set(Re.TEXTURE0),tt.imageAtlasTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),xt.updatePaintBuffers(we);else if(ae)(vn||E.lineAtlas.dirty)&&(_e.activeTexture.set(Re.TEXTURE0),E.lineAtlas.bind(_e)),xt.updatePaintBuffers(we);else if(he){const Kn=wt.gradients[D.id];let fr=Kn.texture;if(D.gradientVersion!==Kn.version){let Sn=256;if(D.stepInterpolant){const Qr=R.getSource().maxzoom,yo=Ye.canonical.z===Qr?Math.ceil(1<<E.transform.maxZoom-Ye.canonical.z):1;Sn=a.ah(a.c3(wt.maxLineLength/a.$*1024*yo),256,_e.maxTextureSize)}Kn.gradient=a.c4({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:Sn,image:Kn.gradient||void 0,clips:wt.lineClipsArray}),Kn.texture?Kn.texture.update(Kn.gradient):Kn.texture=new a.T(_e,Kn.gradient,Re.RGBA),Kn.version=D.gradientVersion,fr=Kn.texture}_e.activeTexture.set(Re.TEXTURE0),fr.bind(D.stepInterpolant?Re.NEAREST:Re.LINEAR,Re.CLAMP_TO_EDGE)}const nr=E.stencilModeForClipping(Ye);Ut.draw(_e,Re.TRIANGLES,J,nr,ie,rn.disabled,Ir,Zn,tr,D.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,D.paint,E.transform.zoom,xt,wt.layoutVertexBuffer2),qe=!1}})(i,h,m,y,w):a.cf(m)?(function(E,R,D,B,U){const W=D.paint.get("fill-color"),$=D.paint.get("fill-opacity");if($.constantOr(1)===0)return;const{isRenderingToTexture:Z}=U,J=E.colorModeForRenderPass(),ie=D.paint.get("fill-pattern"),oe=E.opaquePassEnabledForLayer()&&!ie.constantOr(1)&&W.constantOr(a.bf.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(E.renderPass===oe){const ae=E.getDepthModeForSublayer(1,E.renderPass==="opaque"?cn.ReadWrite:cn.ReadOnly);Ga(E,R,D,B,ae,J,!1,Z)}if(E.renderPass==="translucent"&&D.paint.get("fill-antialias")){const ae=E.getDepthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,cn.ReadOnly);Ga(E,R,D,B,ae,J,!0,Z)}})(i,h,m,y,w):a.cg(m)?(function(E,R,D,B,U){const W=D.paint.get("fill-extrusion-opacity");if(W===0)return;const{isRenderingToTexture:$}=U;if(E.renderPass==="translucent"){const Z=new cn(E.context.gl.LEQUAL,cn.ReadWrite,E.depthRangeFor3D);if(W!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))Kl(E,R,D,B,Z,En.disabled,er.disabled,$),Kl(E,R,D,B,Z,E.stencilModeFor3D(),E.colorModeForRenderPass(),$);else{const J=E.colorModeForRenderPass();Kl(E,R,D,B,Z,En.disabled,J,$)}}})(i,h,m,y,w):a.ch(m)?(function(E,R,D,B,U){if(E.renderPass!=="offscreen"&&E.renderPass!=="translucent")return;const{isRenderingToTexture:W}=U,$=E.context,Z=E.style.projection.useSubdivision,J=E.getDepthModeForSublayer(0,cn.ReadOnly),ie=E.colorModeForRenderPass();if(E.renderPass==="offscreen")(function(oe,ae,de,ye,he,we,Me){const _e=oe.context,Re=_e.gl;for(const Ge of de){const qe=ae.getTile(Ge),Ye=qe.dem;if(!Ye||!Ye.data||!qe.needsHillshadePrepare)continue;const tt=Ye.dim,wt=Ye.stride,xt=Ye.getPixels();if(_e.activeTexture.set(Re.TEXTURE1),_e.pixelStoreUnpackPremultiplyAlpha.set(!1),qe.demTexture=qe.demTexture||oe.getTileTexture(wt),qe.demTexture){const Ut=qe.demTexture;Ut.update(xt,{premultiply:!1}),Ut.bind(Re.NEAREST,Re.CLAMP_TO_EDGE)}else qe.demTexture=new a.T(_e,xt,Re.RGBA,{premultiply:!1}),qe.demTexture.bind(Re.NEAREST,Re.CLAMP_TO_EDGE);_e.activeTexture.set(Re.TEXTURE0);let ft=qe.fbo;if(!ft){const Ut=new a.T(_e,{width:tt,height:tt,data:null},Re.RGBA);Ut.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),ft=qe.fbo=_e.createFramebuffer(tt,tt,!0,!1),ft.colorAttachment.set(Ut.texture)}_e.bindFramebuffer.set(ft.framebuffer),_e.viewport.set([0,0,tt,tt]),oe.useProgram("hillshadePrepare").draw(_e,Re.TRIANGLES,he,we,Me,rn.disabled,Ul(qe.tileID,Ye),null,null,ye.id,oe.rasterBoundsBuffer,oe.quadTriangleIndexBuffer,oe.rasterBoundsSegments),qe.needsHillshadePrepare=!1}})(E,R,B,D,J,En.disabled,ie),$.viewport.set([0,0,E.width,E.height]);else if(E.renderPass==="translucent")if(Z){const[oe,ae,de]=E.stencilConfigForOverlapTwoPass(B);Jl(E,R,D,de,oe,J,ie,!1,W),Jl(E,R,D,de,ae,J,ie,!0,W)}else{const[oe,ae]=E.getStencilConfigForOverlapAndUpdateStencilID(B);Jl(E,R,D,ae,oe,J,ie,!1,W)}})(i,h,m,y,w):a.ci(m)?(function(E,R,D,B,U){if(E.renderPass!=="translucent"||!B.length)return;const{isRenderingToTexture:W}=U,$=E.style.projection.useSubdivision,Z=E.getDepthModeForSublayer(0,cn.ReadOnly),J=E.colorModeForRenderPass();if($){const[ie,oe,ae]=E.stencilConfigForOverlapTwoPass(B);fo(E,R,D,ae,ie,Z,J,!1,W),fo(E,R,D,ae,oe,Z,J,!0,W)}else{const[ie,oe]=E.getStencilConfigForOverlapAndUpdateStencilID(B);fo(E,R,D,oe,ie,Z,J,!1,W)}})(i,h,m,y,w):a.cj(m)?(function(E,R,D,B,U){if(E.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!B.length)return;const{isRenderingToTexture:W}=U,$=R.getSource(),Z=E.style.projection.useSubdivision;if($ instanceof Di)Ya(E,R,D,B,null,!1,!1,$.tileCoords,$.flippedWindingOrder,W);else if(Z){const[J,ie,oe]=E.stencilConfigForOverlapTwoPass(B);Ya(E,R,D,oe,J,!1,!0,Qc,!1,W),Ya(E,R,D,oe,ie,!0,!0,Qc,!1,W)}else{const[J,ie]=E.getStencilConfigForOverlapAndUpdateStencilID(B);Ya(E,R,D,ie,J,!1,!0,Qc,!1,W)}})(i,h,m,y,w):a.ck(m)?(function(E,R,D,B,U){const W=D.paint.get("background-color"),$=D.paint.get("background-opacity");if($===0)return;const{isRenderingToTexture:Z}=U,J=E.context,ie=J.gl,oe=E.style.projection,ae=E.transform,de=ae.tileSize,ye=D.paint.get("background-pattern");if(E.isPatternMissing(ye))return;const he=!ye&&W.a===1&&$===1&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==he)return;const we=En.disabled,Me=E.getDepthModeForSublayer(0,he==="opaque"?cn.ReadWrite:cn.ReadOnly),_e=E.colorModeForRenderPass(),Re=E.useProgram(ye?"backgroundPattern":"background"),Ge=B||Be(ae,{tileSize:de,terrain:E.style.map.terrain});ye&&(J.activeTexture.set(ie.TEXTURE0),E.imageManager.bind(E.context));const qe=D.getCrossfadeParameters();for(const Ye of Ge){const tt=ae.getProjectionData({overscaledTileID:Ye,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),wt=ye?ef($,E,ye,{tileID:Ye,tileSize:de},qe):jl($,W),xt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ye),ft=oe.getMeshFromTileID(J,Ye.canonical,!1,!0,"raster");Re.draw(J,ie.TRIANGLES,Me,we,_e,rn.backCCW,wt,xt,tt,D.id,ft.vertexBuffer,ft.indexBuffer,ft.segments)}})(i,0,m,y,w):a.cl(m)&&(function(E,R,D,B){const{isRenderingGlobe:U}=B,W=E.context,$=D.implementation,Z=E.style.projection,J=E.transform,ie=J.getProjectionDataForCustomLayer(U),oe={farZ:J.farZ,nearZ:J.nearZ,fov:J.fov*Math.PI/180,modelViewProjectionMatrix:J.modelViewProjectionMatrix,projectionMatrix:J.projectionMatrix,shaderData:{variantName:Z.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Z.shaderPreludeCode.vertexSource}`,define:Z.shaderDefine},defaultProjectionData:ie},ae=$.renderingMode?$.renderingMode:"2d";if(E.renderPass==="offscreen"){const de=$.prerender;de&&(E.setCustomLayerDefaults(),W.setColorMode(E.colorModeForRenderPass()),de.call($,W.gl,oe),W.setDirty(),E.setBaseState())}else if(E.renderPass==="translucent"){E.setCustomLayerDefaults(),W.setColorMode(E.colorModeForRenderPass()),W.setStencilMode(En.disabled);const de=ae==="3d"?E.getDepthModeFor3D():E.getDepthModeForSublayer(0,cn.ReadOnly);W.setDepthMode(de),$.render(W.gl,oe),W.setDirty(),E.setBaseState(),W.bindFramebuffer.set(null)}})(i,0,m,w))}saveTileTexture(i){const h=this._tileTextures[i.size[0]];h?h.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const h=this._tileTextures[i];return h&&h.length>0?h.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const h=this.imageManager.getPattern(i.from.toString()),m=this.imageManager.getPattern(i.to.toString());return!h||!m}useProgram(i,h,m=!1,y=[]){this.cache=this.cache||{};const w=!!this.style.map.terrain,E=this.style.projection,R=m?Ts.projectionMercator:E.shaderPreludeCode,D=m?ao:E.shaderDefine,B=i+(h?h.cacheKey:"")+`/${m?ia:E.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(w?"/terrain":"")+(y?`/${y.join("/")}`:"");return this.cache[B]||(this.cache[B]=new Vh(this.context,Ts[i],h,Yh[i],this._showOverdrawInspector,w,R,D,y)),this.cache[B]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:h}=this.context.gl;return this.width!==i||this.height!==h}}function tu(x,i){let h,m=!1,y=null,w=null;const E=()=>{y=null,m&&(x.apply(w,h),y=setTimeout(E,i),m=!1)};return(...R)=>(m=!0,w=this,h=R,y||E(),y)}class Ka{constructor(i){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let m;return h.split("&").map((y=>y.split("="))).forEach((y=>{y[0]===this._hashName&&(m=y)})),(m&&m[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(!this._isValidHash(h))return!1;const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:m,pitch:+(h[4]||0)}),!0},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const m=h.join("/");let y=m;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${m}`);let w=window.location.hash.replace(y,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let E=window.location.href.replace(/(#.+)?$/,w);E=E.replace("&&","&"),window.history.replaceState(window.history.state,null,E)},this._updateHash=tu(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const h=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,y),E=Math.round(h.lng*w)/w,R=Math.round(h.lat*w)/w,D=this._map.getBearing(),B=this._map.getPitch();let U="";if(U+=i?`/${E}/${R}/${m}`:`${m}/${R}/${E}`,(D||B)&&(U+="/"+Math.round(10*D)/10),B&&(U+=`/${Math.round(B)}`),this._hashName){const W=this._hashName;let $=!1;const Z=window.location.hash.slice(1).split("&").map((J=>{const ie=J.split("=")[0];return ie===W?($=!0,`${ie}=${U}`):J})).filter((J=>J));return $||Z.push(`${W}=${U}`),`#${Z.join("&")}`}return`#${U}`}_isValidHash(i){if(i.length<3||i.some(isNaN))return!1;try{new a.S(+i[2],+i[1])}catch{return!1}const h=+i[0],m=+(i[3]||0),y=+(i[4]||0);return h>=this._map.getMinZoom()&&h<=this._map.getMaxZoom()&&m>=-180&&m<=180&&y>=this._map.getMinPitch()&&y<=this._map.getMaxPitch()}}const Ja={linearity:.3,easing:a.cm(0,0,.3,1)},Gs=a.e({deceleration:2500,maxSpeed:1400},Ja),Qa=a.e({deceleration:20,maxSpeed:1400},Ja),el=a.e({deceleration:1e3,maxSpeed:360},Ja),nu=a.e({deceleration:1e3,maxSpeed:90},Ja),Xu=a.e({deceleration:1e3,maxSpeed:360},Ja);class tl{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:L.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,h=L.now();for(;i.length>0&&h-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,h.roll+=w.rollDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(h.pan.mag()){const w=Nn(h.pan.mag(),m,a.e({},Gs,i||{})),E=h.pan.mult(w.amount/h.pan.mag()),R=this._map.cameraHelper.handlePanInertia(E,this._map.transform);y.center=R.easingCenter,y.offset=R.easingOffset,hs(y,w)}if(h.zoom){const w=Nn(h.zoom,m,Qa);y.zoom=this._map.transform.zoom+w.amount,hs(y,w)}if(h.bearing){const w=Nn(h.bearing,m,el);y.bearing=this._map.transform.bearing+a.ah(w.amount,-179,179),hs(y,w)}if(h.pitch){const w=Nn(h.pitch,m,nu);y.pitch=this._map.transform.pitch+w.amount,hs(y,w)}if(h.roll){const w=Nn(h.roll,m,Xu);y.roll=this._map.transform.roll+a.ah(w.amount,-179,179),hs(y,w)}if(y.zoom||y.bearing){const w=h.pinchAround===void 0?h.around:h.pinchAround;y.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),a.e(y,{noMoveStart:!0})}}function hs(x,i){(!x.duration||x.duration<i.duration)&&(x.duration=i.duration,x.easing=i.easing)}function Nn(x,i,h){const{maxSpeed:m,linearity:y,deceleration:w}=h,E=a.ah(x*y/(i/1e3),-m,m),R=Math.abs(E)/(w*y);return{easing:h.easing,duration:1e3*R,amount:E*(R/2)}}class Dn extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,m,y={}){m=m instanceof MouseEvent?m:new MouseEvent(i,m);const w=z.mousePos(h.getCanvas(),m),E=h.unproject(w);super(i,a.e({point:w,lngLat:E,originalEvent:m},y)),this._defaultPrevented=!1,this.target=h}}class ds extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,m){const y=i==="touchend"?m.changedTouches:m.touches,w=z.touchPos(h.getCanvasContainer(),y),E=w.map((D=>h.unproject(D))),R=w.reduce(((D,B,U,W)=>D.add(B.div(W.length))),new a.P(0,0));super(i,{points:w,point:R,lngLats:E,lngLat:h.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class Jr extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class Oi{constructor(i,h){this._map=i,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Jr(i.type,this._map,i))}mousedown(i,h){return this._mousedownPos=h,this._firePreventable(new Dn(i.type,this._map,i))}mouseup(i){this._map.fire(new Dn(i.type,this._map,i))}click(i,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Dn(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Dn(i.type,this._map,i))}mouseover(i){this._map.fire(new Dn(i.type,this._map,i))}mouseout(i){this._map.fire(new Dn(i.type,this._map,i))}touchstart(i){return this._firePreventable(new ds(i.type,this._map,i))}touchmove(i){this._map.fire(new ds(i.type,this._map,i))}touchend(i){this._map.fire(new ds(i.type,this._map,i))}touchcancel(i){this._map.fire(new ds(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _a{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Dn(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Dn(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ys{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.screenPointToLocation(a.P.convert(i),this._map.terrain)}}class xi{constructor(i,h){this._map=i,this._tr=new Ys(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,h){this.isEnabled()&&i.shiftKey&&i.button===0&&(z.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(i,h){if(!this._active)return;const m=h;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=z.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const w=Math.min(y.x,m.x),E=Math.max(y.x,m.x),R=Math.min(y.y,m.y),D=Math.max(y.y,m.y);z.setTransform(this._box,`translate(${w}px,${R}px)`),this._box.style.width=E-w+"px",this._box.style.height=D-R+"px"}mouseupWindow(i,h){if(!this._active||i.button!==0)return;const m=this._startPos,y=h;if(this.reset(),z.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(m,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,h){return this._map.fire(new a.l(i,{originalEvent:h}))}}function nl(x,i){if(x.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${i.length}`);const h={};for(let m=0;m<x.length;m++)h[x[m].identifier]=i[m];return h}class ru{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,h,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=(function(y){const w=new a.P(0,0);for(const E of y)w._add(E);return w.div(y.length)})(h),this.touches=nl(m,h)))}touchmove(i,h,m){if(this.aborted||!this.centroid)return;const y=nl(m,h);for(const w in this.touches){const E=y[w];(!E||E.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(i,h,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class iu{constructor(i){this.singleTap=new ru(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,h,m){this.singleTap.touchstart(i,h,m)}touchmove(i,h,m){this.singleTap.touchmove(i,h,m)}touchend(i,h,m){const y=this.singleTap.touchend(i,h,m);if(y){const w=i.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(y)<30;if(w&&E||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Li{constructor(i){this._tr=new Ys(i),this._zoomIn=new iu({numTouches:1,numTaps:2}),this._zoomOut=new iu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,h,m){this._zoomIn.touchstart(i,h,m),this._zoomOut.touchstart(i,h,m)}touchmove(i,h,m){this._zoomIn.touchmove(i,h,m),this._zoomOut.touchmove(i,h,m)}touchend(i,h,m){const y=this._zoomIn.touchend(i,h,m),w=this._zoomOut.touchend(i,h,m),E=this._tr;return y?(this._active=!0,i.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(y)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bi{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const h=this._moveFunction(...i);if(h.bearingDelta||h.pitchDelta||h.rollDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(i,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=Array.isArray(h)?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,h){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const y=Array.isArray(h)?h[0]:h;return!this._moved&&y.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(m,y))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&z.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const mo=0,Yi=2,ya={[mo]:1,[Yi]:2};class ec{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const h=z.mouseButton(i);this._eventButton=h}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!(function(h,m){const y=ya[m];return h.buttons===void 0||(h.buttons&y)!==y})(i,this._eventButton)}isValidEndEvent(i){return z.mouseButton(i)===this._eventButton}}class Wp{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}class va{constructor(i=new ec({checkCorrectEvent:()=>!0}),h=new Wp){this.mouseMoveStateManager=i,this.oneFingerTouchMoveStateManager=h}_executeRelevantHandler(i,h,m){return i instanceof MouseEvent?h(i):typeof TouchEvent<"u"&&i instanceof TouchEvent?m(i):void 0}startMove(i){this._executeRelevantHandler(i,(h=>this.mouseMoveStateManager.startMove(h)),(h=>this.oneFingerTouchMoveStateManager.startMove(h)))}endMove(i){this._executeRelevantHandler(i,(h=>this.mouseMoveStateManager.endMove(h)),(h=>this.oneFingerTouchMoveStateManager.endMove(h)))}isValidStartEvent(i){return this._executeRelevantHandler(i,(h=>this.mouseMoveStateManager.isValidStartEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidStartEvent(h)))}isValidMoveEvent(i){return this._executeRelevantHandler(i,(h=>this.mouseMoveStateManager.isValidMoveEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(h)))}isValidEndEvent(i){return this._executeRelevantHandler(i,(h=>this.mouseMoveStateManager.isValidEndEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidEndEvent(h)))}}const No=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=i=>{i.preventDefault()}};class rl{constructor(i,h){this._clickTolerance=i.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(i){return i<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(i,h,m){return this._calculateTransform(i,h,m)}touchmove(i,h,m){if(this._active){if(!this._shouldBePrevented(m.length))return i.preventDefault(),this._calculateTransform(i,h,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",i)}}touchend(i,h,m){this._calculateTransform(i,h,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,h,m){m.length>0&&(this._active=!0);const y=nl(m,h),w=new a.P(0,0),E=new a.P(0,0);let R=0;for(const B in y){const U=y[B],W=this._touches[B];W&&(w._add(U),E._add(U.sub(W)),R++,y[B]=U)}if(this._touches=y,this._shouldBePrevented(R)||!E.mag())return;const D=E.div(R);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(R),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class go{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,h,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([h[0],h[1]]))}touchmove(i,h,m){if(!this._firstTwoTouches)return;i.preventDefault();const[y,w]=this._firstTwoTouches,E=Fi(m,h,y),R=Fi(m,h,w);if(!E||!R)return;const D=this._aroundCenter?null:E.add(R).div(2);return this._move([E,R],D,i)}touchend(i,h,m){if(!this._firstTwoTouches)return;const[y,w]=this._firstTwoTouches,E=Fi(m,h,y),R=Fi(m,h,w);E&&R||(this._active&&z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Fi(x,i,h){for(let m=0;m<x.length;m++)if(x[m].identifier===h)return i[m]}function It(x,i){return Math.log(x/i)/Math.LN2}class Ki extends go{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,h){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(It(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:It(this._distance,m),pinchAround:h}}}function _o(x,i){return 180*x.angleWith(i)/Math.PI}class Ks extends go{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,h,m){const y=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_o(this._vector,y),pinchAround:h}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const h=25/(Math.PI*this._minDiameter)*360,m=_o(i,this._startVector);return Math.abs(m)<h}}function Ni(x){return Math.abs(x.y)>Math.abs(x.x)}class Es extends go{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,h,m){super.touchstart(i,h,m),this._currentTouchCount=m.length}_start(i){this._lastPoints=i,Ni(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,h,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=i[0].sub(this._lastPoints[0]),w=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,w,m.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(i,h,m){if(this._valid!==void 0)return this._valid;const y=i.mag()>=2,w=h.mag()>=2;if(!y&&!w)return;if(!y||!w)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const E=i.y>0==h.y>0;return Ni(i)&&Ni(h)&&E}}const qu={panStep:100,bearingStep:15,pitchStep:10};class In{constructor(i){this._tr=new Ys(i);const h=qu;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let h=0,m=0,y=0,w=0,E=0;switch(i.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?y=1:(i.preventDefault(),E=-1);break;case 40:i.shiftKey?y=-1:(i.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:R=>{const D=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:su,zoom:h?Math.round(D.zoom)+h*(i.shiftKey?2:1):D.zoom,bearing:D.bearing+m*this._bearingStep,pitch:D.pitch+y*this._pitchStep,offset:[-w*this._panStep,-E*this._panStep],center:D.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function su(x){return x*(2-x)}const Ji=4.000244140625,Bi=1/450;class gr{constructor(i,h){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=i,this._tr=new Ys(i),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Bi}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(i){return!!this._map.cooperativeGestures.isEnabled()&&!(i.ctrlKey||this._map.cooperativeGestures.isBypassed(i))}wheel(i){if(!this.isEnabled())return;if(this._shouldBePrevented(i))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",i);let h=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=L.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,h!==0&&h%Ji==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(y*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),i.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=i,this._delta-=h,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=z.mousePos(this._map.getCanvas(),i),m=this._tr;this._aroundPoint=this._aroundCenter?m.transform.locationToScreenPoint(a.S.convert(m.center)):h,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const R=i.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=R),typeof this._targetZoom=="number"&&(this._targetZoom+=R)}if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>Ji?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&D!==0&&(D=1/D);const B=typeof this._targetZoom!="number"?i.scale:a.af(this._targetZoom);this._targetZoom=i.getConstrained(i.getCameraLngLat(),a.ak(B*D)).zoom,this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom!="number"?i.zoom:this._targetZoom,m=this._startZoom,y=this._easing;let w,E=!1;if(this._type==="wheel"&&m&&y){const R=L.now()-this._lastWheelEventTime,D=Math.min((R+5)/200,1),B=y(D);w=a.C.number(m,h,B),D<1?this._frameId||(this._frameId=!0):E=!0}else w=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=w,{noInertia:!0,needsRenderFrame:!E,zoomDelta:w-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let h=a.co;if(this._prevEase){const m=this._prevEase,y=(L.now()-m.start)/m.duration,w=m.easing(y+.01)-m.easing(y),E=.27/Math.sqrt(w*w+1e-4)*.01,R=Math.sqrt(.0729-E*E);h=a.cm(E,R,.25,1)}return this._prevEase={start:L.now(),duration:i,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Cs{constructor(i,h){this._clickZoom=i,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ad{constructor(i){this._tr=new Ys(i),this.reset()}reset(){this._active=!1}dblclick(i,h){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gu{constructor(){this._tap=new iu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,h,m){if(!this._swipePoint)if(this._tapTime){const y=h[0],w=i.timeStamp-this._tapTime<500,E=this._tapPoint.dist(y)<30;w&&E?m.length>0&&(this._swipePoint=y,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(i,h,m)}touchmove(i,h,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=h[0],w=y.y-this._swipePoint.y;return this._swipePoint=y,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,h,m)}touchend(i,h,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const y=this._tap.touchend(i,h,m);y&&(this._tapTime=i.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ou{constructor(i,h,m){this._el=i,this._mousePan=h,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yu{constructor(i,h,m,y){this._pitchWithRotate=i.pitchWithRotate,this._rollEnabled=i.rollEnabled,this._mouseRotate=h,this._mousePitch=m,this._mouseRoll=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ku{constructor(i,h,m,y){this._el=i,this._touchZoom=h,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class au{constructor(i,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=z.create("div","maplibregl-cooperative-gesture-screen",i);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=h,this._container.appendChild(y);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=m,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(z.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(i){return i[this._bypassKey]}notifyGestureBlocked(i,h){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:i,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const lu=x=>x.zoom||x.drag||x.roll||x.pitch||x.rotate;class fs extends a.l{}function Hn(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta||x.rollDelta}class Hp{constructor(i,h){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,w)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=y.type==="renderFrame"?void 0:y,R={needsRenderFrame:!1},D={},B={};for(const{handlerName:$,handler:Z,allowed:J}of this._handlers){if(!Z.isEnabled())continue;let ie;if(this._blockedByActive(B,J,$))Z.reset();else if(Z[w||y.type]){if(a.cp(y,w||y.type)){const oe=z.mousePos(this._map.getCanvas(),y);ie=Z[w||y.type](y,oe)}else if(a.cq(y,w||y.type)){const oe=this._getMapTouches(y.touches),ae=z.touchPos(this._map.getCanvas(),oe);ie=Z[w||y.type](y,ae,oe)}else a.cr(w||y.type)||(ie=Z[w||y.type](y));this.mergeHandlerResult(R,D,ie,$,E),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()}(ie||Z.isActive())&&(B[$]=Z)}const U={};for(const $ in this._previousActiveHandlers)B[$]||(U[$]=E);this._previousActiveHandlers=B,(Object.keys(U).length||Hn(R))&&(this._changes.push([R,D,U]),this._triggerRenderFrame()),(Object.keys(B).length||Hn(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=R;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tl(i),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,w,E]of this._listeners)z.addEventListener(y,w,y===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[i,h,m]of this._listeners)z.removeEventListener(i,h,i===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(i){const h=this._map,m=h.getCanvasContainer();this._add("mapEvent",new Oi(h,i));const y=h.boxZoom=new xi(h,i);this._add("boxZoom",y),i.interactive&&i.boxZoom&&y.enable();const w=h.cooperativeGestures=new au(h,i.cooperativeGestures);this._add("cooperativeGestures",w),i.cooperativeGestures&&w.enable();const E=new Li(h),R=new ad(h);h.doubleClickZoom=new Cs(R,E),this._add("tapZoom",E),this._add("clickZoom",R),i.interactive&&i.doubleClickZoom&&h.doubleClickZoom.enable();const D=new Gu;this._add("tapDragZoom",D);const B=h.touchPitch=new Es(h);this._add("touchPitch",B),i.interactive&&i.touchPitch&&h.touchPitch.enable(i.touchPitch);const U=()=>h.project(h.getCenter()),W=(function({enable:he,clickTolerance:we,aroundCenter:Me=!0,minPixelCenterThreshold:_e=100,rotateDegreesPerPixelMoved:Re=.8},Ge){const qe=new ec({checkCorrectEvent:Ye=>z.mouseButton(Ye)===0&&Ye.ctrlKey||z.mouseButton(Ye)===2&&!Ye.ctrlKey});return new bi({clickTolerance:we,move:(Ye,tt)=>{const wt=Ge();if(Me&&Math.abs(wt.y-Ye.y)>_e)return{bearingDelta:a.cn(new a.P(Ye.x,tt.y),tt,wt)};let xt=(tt.x-Ye.x)*Re;return Me&&tt.y<wt.y&&(xt=-xt),{bearingDelta:xt}},moveStateManager:qe,enable:he,assignEvents:No})})(i,U),$=(function({enable:he,clickTolerance:we,pitchDegreesPerPixelMoved:Me=-.5}){const _e=new ec({checkCorrectEvent:Re=>z.mouseButton(Re)===0&&Re.ctrlKey||z.mouseButton(Re)===2});return new bi({clickTolerance:we,move:(Re,Ge)=>({pitchDelta:(Ge.y-Re.y)*Me}),moveStateManager:_e,enable:he,assignEvents:No})})(i),Z=(function({enable:he,clickTolerance:we,rollDegreesPerPixelMoved:Me=.3},_e){const Re=new ec({checkCorrectEvent:Ge=>z.mouseButton(Ge)===2&&Ge.ctrlKey});return new bi({clickTolerance:we,move:(Ge,qe)=>{const Ye=_e();let tt=(qe.x-Ge.x)*Me;return qe.y<Ye.y&&(tt=-tt),{rollDelta:tt}},moveStateManager:Re,enable:he,assignEvents:No})})(i,U);h.dragRotate=new Yu(i,W,$,Z),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",$,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Z,["mousePitch"]),i.interactive&&i.dragRotate&&h.dragRotate.enable();const J=(function({enable:he,clickTolerance:we}){const Me=new ec({checkCorrectEvent:_e=>z.mouseButton(_e)===0&&!_e.ctrlKey});return new bi({clickTolerance:we,move:(_e,Re)=>({around:Re,panDelta:Re.sub(_e)}),activateOnStart:!0,moveStateManager:Me,enable:he,assignEvents:No})})(i),ie=new rl(i,h);h.dragPan=new ou(m,J,ie),this._add("mousePan",J),this._add("touchPan",ie,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&h.dragPan.enable(i.dragPan);const oe=new Ks,ae=new Ki;h.touchZoomRotate=new Ku(m,ae,oe,D),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&h.touchZoomRotate.enable(i.touchZoomRotate);const de=h.scrollZoom=new gr(h,(()=>this._triggerRenderFrame()));this._add("scrollZoom",de,["mousePan"]),i.interactive&&i.scrollZoom&&h.scrollZoom.enable(i.scrollZoom);const ye=h.keyboard=new In(h);this._add("keyboard",ye),i.interactive&&i.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new _a(h))}_add(i,h,m){this._handlers.push({handlerName:i,handler:h,allowed:m}),this._handlersById[i]=h}stop(i){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!lu(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,h,m){for(const y in i)if(y!==m&&(!h||h.indexOf(y)<0))return!0;return!1}_getMapTouches(i){const h=[];for(const m of i)this._el.contains(m.target)&&h.push(m);return h}mergeHandlerResult(i,h,m,y,w){if(!m)return;a.e(i,m);const E={handlerName:y,originalEvent:m.originalEvent||w};m.zoomDelta!==void 0&&(h.zoom=E),m.panDelta!==void 0&&(h.drag=E),m.rollDelta!==void 0&&(h.roll=E),m.pitchDelta!==void 0&&(h.pitch=E),m.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const i={},h={},m={};for(const[y,w,E]of this._changes)y.panDelta&&(i.panDelta=(i.panDelta||new a.P(0,0))._add(y.panDelta)),y.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+y.pitchDelta),y.rollDelta&&(i.rollDelta=(i.rollDelta||0)+y.rollDelta),y.around!==void 0&&(i.around=y.around),y.pinchAround!==void 0&&(i.pinchAround=y.pinchAround),y.noInertia&&(i.noInertia=y.noInertia),a.e(h,w),a.e(m,E);this._updateMapTransform(i,h,m),this._changes=[]}_updateMapTransform(i,h,m){const y=this._map,w=y._getTransformForUpdate(),E=y.terrain;if(!(Hn(i)||E&&this._terrainMovement))return this._fireEvents(h,m,!0);y._stop(!0);let{panDelta:R,zoomDelta:D,bearingDelta:B,pitchDelta:U,rollDelta:W,around:$,pinchAround:Z}=i;Z!==void 0&&($=Z),$=$||y.transform.centerPoint,E&&!w.isPointOnMapSurface($)&&($=w.centerPoint);const J={panDelta:R,zoomDelta:D,rollDelta:W,pitchDelta:U,bearingDelta:B,around:$};this._map.cameraHelper.useGlobeControls&&!w.isPointOnMapSurface($)&&($=w.centerPoint);const ie=$.distSqr(w.centerPoint)<.01?w.center:w.screenPointToLocation(R?$.sub(R):$);this._handleMapControls({terrain:E,tr:w,deltasForHelper:J,preZoomAroundLoc:ie,combinedEventsInProgress:h,panDelta:R}),y._applyUpdatedTransform(w),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(h,m,!0)}_handleMapControls({terrain:i,tr:h,deltasForHelper:m,preZoomAroundLoc:y,combinedEventsInProgress:w,panDelta:E}){const R=this._map.cameraHelper;if(R.handleMapControlsRollPitchBearingZoom(m,h),i)return R.useGlobeControls?(this._terrainMovement||!w.drag&&!w.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void R.handleMapControlsPan(m,h,y)):this._terrainMovement||!w.drag&&!w.zoom?void(w.drag&&this._terrainMovement&&E?h.setCenter(h.screenPointToLocation(h.centerPoint.sub(E))):R.handleMapControlsPan(m,h,y)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void R.handleMapControlsPan(m,h,y));R.handleMapControlsPan(m,h,y)}_fireEvents(i,h,m){const y=lu(this._eventsInProgress),w=lu(i),E={};for(const W in i){const{originalEvent:$}=i[W];this._eventsInProgress[W]||(E[`${W}start`]=$),this._eventsInProgress[W]=i[W]}!y&&w&&this._fireEvent("movestart",w.originalEvent);for(const W in E)this._fireEvent(W,E[W]);w&&this._fireEvent("move",w.originalEvent);for(const W in i){const{originalEvent:$}=i[W];this._fireEvent(W,$)}const R={};let D;for(const W in this._eventsInProgress){const{handlerName:$,originalEvent:Z}=this._eventsInProgress[W];this._handlersById[$].isActive()||(delete this._eventsInProgress[W],D=h[$]||Z,R[`${W}end`]=D)}for(const W in R)this._fireEvent(W,R[W]);const B=lu(this._eventsInProgress),U=(y||w)&&!B;if(U&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const W=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&W.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(W)}if(m&&U){this._updatingCamera=!0;const W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!W||!W.essential&&L.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:D})),$(this._map.getBearing())&&this._map.resetNorth()):($(W.bearing||this._map.getBearing())&&(W.bearing=0),W.freezeElevation=!0,this._map.easeTo(W,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(i,h){this._map.fire(new a.l(i,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((i=>{delete this._frameId,this.handleEvent(new fs("renderFrame",{timeStamp:i})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xa extends a.E{constructor(i,h,m){super(),this._renderFrameCallback=()=>{const y=Math.min((L.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=m.bearingSnap,this.cameraHelper=h,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(i,h){i.apply(this.transform),this.transform=i,this.cameraHelper=h}getCenter(){return new a.S(this.transform.center.lng,this.transform.center.lat)}setCenter(i,h){return this.jumpTo({center:i},h)}getCenterElevation(){return this.transform.elevation}setCenterElevation(i,h){return this.jumpTo({elevation:i},h),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(i){this._centerClampedToGround=i}panBy(i,h,m){return i=a.P.convert(i).mult(-1),this.panTo(this.transform.center,a.e({offset:i},h),m)}panTo(i,h,m){return this.easeTo(a.e({center:i},h),m)}getZoom(){return this.transform.zoom}setZoom(i,h){return this.jumpTo({zoom:i},h),this}zoomTo(i,h,m){return this.easeTo(a.e({zoom:i},h),m)}zoomIn(i,h){return this.zoomTo(this.getZoom()+1,i,h),this}zoomOut(i,h){return this.zoomTo(this.getZoom()-1,i,h),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(i,h){return i!=this.transform.fov&&(this.transform.setFov(i),this.fire(new a.l("movestart",h)).fire(new a.l("move",h)).fire(new a.l("moveend",h))),this}getBearing(){return this.transform.bearing}setBearing(i,h){return this.jumpTo({bearing:i},h),this}getPadding(){return this.transform.padding}setPadding(i,h){return this.jumpTo({padding:i},h),this}rotateTo(i,h,m){return this.easeTo(a.e({bearing:i},h),m)}resetNorth(i,h){return this.rotateTo(0,a.e({duration:1e3},i),h),this}resetNorthPitch(i,h){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},i),h),this}snapToNorth(i,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,h):this}getPitch(){return this.transform.pitch}setPitch(i,h){return this.jumpTo({pitch:i},h),this}getRoll(){return this.transform.roll}setRoll(i,h){return this.jumpTo({roll:i},h),this}cameraForBounds(i,h){i=qn.convert(i).adjustAntiMeridian();const m=h&&h.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),m,h)}_cameraForBoxAndBearing(i,h,m,y){const w={top:0,bottom:0,right:0,left:0};if(typeof(y=a.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const B=y.padding;y.padding={top:B,bottom:B,right:B,left:B}}const E=a.e(w,y.padding);y.padding=E;const R=this.transform,D=new qn(i,h);return this.cameraHelper.cameraForBoxAndBearing(y,E,D,m,R)}fitBounds(i,h,m){return this._fitInternal(this.cameraForBounds(i,h),h,m)}fitScreenCoordinates(i,h,m,y,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(i)),this.transform.screenPointToLocation(a.P.convert(h)),m,y),y,w)}_fitInternal(i,h,m){return i?(delete(h=a.e(i,h)).padding,h.linear?this.easeTo(h,m):this.flyTo(h,m)):this}jumpTo(i,h){this.stop();const m=this._getTransformForUpdate();let y=!1,w=!1,E=!1;const R=m.zoom;this.cameraHelper.handleJumpToCenterZoom(m,i);const D=m.zoom!==R;return"elevation"in i&&m.elevation!==+i.elevation&&m.setElevation(+i.elevation),"bearing"in i&&m.bearing!==+i.bearing&&(y=!0,m.setBearing(+i.bearing)),"pitch"in i&&m.pitch!==+i.pitch&&(w=!0,m.setPitch(+i.pitch)),"roll"in i&&m.roll!==+i.roll&&(E=!0,m.setRoll(+i.roll)),i.padding==null||m.isPaddingEqual(i.padding)||m.setPadding(i.padding),this._applyUpdatedTransform(m),this.fire(new a.l("movestart",h)).fire(new a.l("move",h)),D&&this.fire(new a.l("zoomstart",h)).fire(new a.l("zoom",h)).fire(new a.l("zoomend",h)),y&&this.fire(new a.l("rotatestart",h)).fire(new a.l("rotate",h)).fire(new a.l("rotateend",h)),w&&this.fire(new a.l("pitchstart",h)).fire(new a.l("pitch",h)).fire(new a.l("pitchend",h)),E&&this.fire(new a.l("rollstart",h)).fire(new a.l("roll",h)).fire(new a.l("rollend",h)),this.fire(new a.l("moveend",h))}calculateCameraOptionsFromTo(i,h,m,y=0){const w=a.a1.fromLngLat(i,h),E=a.a1.fromLngLat(m,y),R=E.x-w.x,D=E.y-w.y,B=E.z-w.z,U=Math.hypot(R,D,B);if(U===0)throw new Error("Can't calculate camera options with same From and To");const W=Math.hypot(R,D),$=a.ak(this.transform.cameraToCenterDistance/U/this.transform.tileSize),Z=180*Math.atan2(R,-D)/Math.PI;let J=180*Math.acos(W/U)/Math.PI;return J=B<0?90-J:90+J,{center:E.toLngLat(),elevation:y,zoom:$,pitch:J,bearing:Z}}calculateCameraOptionsFromCameraLngLatAltRotation(i,h,m,y,w){const E=this.transform.calculateCenterFromCameraLngLatAlt(i,h,m,y);return{center:E.center,elevation:E.elevation,zoom:E.zoom,bearing:m,pitch:y,roll:w}}easeTo(i,h){this._stop(!1,i.easeId),((i=a.e({offset:[0,0],duration:500,easing:a.co},i)).animate===!1||!i.essential&&L.prefersReducedMotion)&&(i.duration=0);const m=this._getTransformForUpdate(),y=this.getBearing(),w=m.pitch,E=m.roll,R="bearing"in i?this._normalizeBearing(i.bearing,y):y,D="pitch"in i?+i.pitch:w,B="roll"in i?this._normalizeBearing(i.roll,E):E,U="padding"in i?i.padding:m.padding,W=a.P.convert(i.offset);let $,Z;i.around&&($=a.S.convert(i.around),Z=m.locationToScreenPoint($));const J={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ie=this.cameraHelper.handleEaseTo(m,{bearing:R,pitch:D,roll:B,padding:U,around:$,aroundPoint:Z,offsetAsPoint:W,offset:i.offset,zoom:i.zoom,center:i.center});return this._rotating=this._rotating||y!==R,this._pitching=this._pitching||D!==w,this._rolling=this._rolling||B!==E,this._padding=!m.isPaddingEqual(U),this._zooming=this._zooming||ie.isZooming,this._easeId=i.easeId,this._prepareEase(h,i.noMoveStart,J),this.terrain&&this._prepareElevation(ie.elevationCenter),this._ease((oe=>{ie.easeFunc(oe),this.terrain&&!i.freezeElevation&&this._updateElevation(oe),this._applyUpdatedTransform(m),this._fireMoveEvents(h)}),(oe=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h,oe)}),i),this}_prepareEase(i,h,m={}){this._moving=!0,h||m.moving||this.fire(new a.l("movestart",i)),this._zooming&&!m.zooming&&this.fire(new a.l("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new a.l("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new a.l("pitchstart",i)),this._rolling&&!m.rolling&&this.fire(new a.l("rollstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&h!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(m-(h-(m*i+this._elevationStart))/(1-i)),this._elevationTarget=h}this.transform.setElevation(a.C.number(this._elevationStart,this._elevationTarget,i))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(i){if(!this.terrain&&i.elevation>=0&&i.pitch<=90)return{};const h=i.getCameraLngLat(),m=i.getCameraAltitude(),y=this.terrain?this.terrain.getElevationForLngLatZoom(h,i.zoom):0;if(m<y){const w=this.calculateCameraOptionsFromTo(h,y,i.center,i.elevation);return{pitch:w.pitch,zoom:w.zoom}}return{}}_applyUpdatedTransform(i){const h=[];if(h.push((y=>this._elevateCameraIfInsideTerrain(y))),this.transformCameraUpdate&&h.push((y=>this.transformCameraUpdate(y))),!h.length)return;const m=i.clone();for(const y of h){const w=m.clone(),{center:E,zoom:R,roll:D,pitch:B,bearing:U,elevation:W}=y(w);E&&w.setCenter(E),W!==void 0&&w.setElevation(W),R!==void 0&&w.setZoom(R),D!==void 0&&w.setRoll(D),B!==void 0&&w.setPitch(B),U!==void 0&&w.setBearing(U),m.apply(w)}this.transform.apply(m)}_fireMoveEvents(i){this.fire(new a.l("move",i)),this._zooming&&this.fire(new a.l("zoom",i)),this._rotating&&this.fire(new a.l("rotate",i)),this._pitching&&this.fire(new a.l("pitch",i)),this._rolling&&this.fire(new a.l("roll",i))}_afterEase(i,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const m=this._zooming,y=this._rotating,w=this._pitching,E=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,m&&this.fire(new a.l("zoomend",i)),y&&this.fire(new a.l("rotateend",i)),w&&this.fire(new a.l("pitchend",i)),E&&this.fire(new a.l("rollend",i)),this.fire(new a.l("moveend",i))}flyTo(i,h){if(!i.essential&&L.prefersReducedMotion){const tt=a.Q(i,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(tt,h)}this.stop(),i=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.co},i);const m=this._getTransformForUpdate(),y=m.bearing,w=m.pitch,E=m.roll,R=m.padding,D="bearing"in i?this._normalizeBearing(i.bearing,y):y,B="pitch"in i?+i.pitch:w,U="roll"in i?this._normalizeBearing(i.roll,E):E,W="padding"in i?i.padding:m.padding,$=a.P.convert(i.offset);let Z=m.centerPoint.add($);const J=m.screenPointToLocation(Z),ie=this.cameraHelper.handleFlyTo(m,{bearing:D,pitch:B,roll:U,padding:W,locationAtOffset:J,offsetAsPoint:$,center:i.center,minZoom:i.minZoom,zoom:i.zoom});let oe=i.curve;const ae=Math.max(m.width,m.height),de=ae/ie.scaleOfZoom,ye=ie.pixelPathLength;typeof ie.scaleOfMinZoom=="number"&&(oe=Math.sqrt(ae/ie.scaleOfMinZoom/ye*2));const he=oe*oe;function we(tt){const wt=(de*de-ae*ae+(tt?-1:1)*he*he*ye*ye)/(2*(tt?de:ae)*he*ye);return Math.log(Math.sqrt(wt*wt+1)-wt)}function Me(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function _e(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Re=we(!1);let Ge=function(tt){return _e(Re)/_e(Re+oe*tt)},qe=function(tt){return ae*((_e(Re)*(Me(wt=Re+oe*tt)/_e(wt))-Me(Re))/he)/ye;var wt},Ye=(we(!0)-Re)/oe;if(Math.abs(ye)<2e-6||!isFinite(Ye)){if(Math.abs(ae-de)<1e-6)return this.easeTo(i,h);const tt=de<ae?-1:1;Ye=Math.abs(Math.log(de/ae))/oe,qe=()=>0,Ge=wt=>Math.exp(tt*oe*wt)}return i.duration="duration"in i?+i.duration:1e3*Ye/("screenSpeed"in i?+i.screenSpeed/oe:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=y!==D,this._pitching=B!==w,this._rolling=U!==E,this._padding=!m.isPaddingEqual(W),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ie.targetCenter),this._ease((tt=>{const wt=tt*Ye,xt=1/Ge(wt),ft=qe(wt);this._rotating&&m.setBearing(a.C.number(y,D,tt)),this._pitching&&m.setPitch(a.C.number(w,B,tt)),this._rolling&&m.setRoll(a.C.number(E,U,tt)),this._padding&&(m.interpolatePadding(R,W,tt),Z=m.centerPoint.add($)),ie.easeFunc(tt,xt,ft,Z),this.terrain&&!i.freezeElevation&&this._updateElevation(tt),this._applyUpdatedTransform(m),this._fireMoveEvents(h)}),(()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h)}),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,h){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}return i||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(i,h,m){m.animate===!1||m.duration===0?(i(1),h()):(this._easeStart=L.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,h){i=a.aO(i,-180,180);const m=Math.abs(i-h);return Math.abs(i-360-h)<m&&(i-=360),Math.abs(i+360-h)<m&&(i+=360),i}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(a.S.convert(i),this.transform.tileZoom):null}}const il={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ju{constructor(i=il){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=z.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,h){const m=this._map._getUIString(`AttributionControl.${h}`);i.title=m,i.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map((y=>typeof y!="string"?"":y))):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const h=this._map.style.sourceCaches;for(const y in h){const w=h[y];if(w.used||w.usedForTerrain){const E=w.getSource();E.attribution&&i.indexOf(E.attribution)<0&&i.push(E.attribution)}}i=i.filter((y=>String(y).trim())),i.sort(((y,w)=>y.length-w.length)),i=i.filter(((y,w)=>{for(let E=w+1;E<i.length;E++)if(i[E].indexOf(y)>=0)return!1;return!0}));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=z.sanitize(m),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Qu{constructor(i={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const m=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=z.create("div","maplibregl-ctrl");const h=z.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class sl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const h=++this._id;return this._queue.push({callback:i,id:h,cancelled:!1}),h}remove(i){const h=this._currentlyRunning,m=h?this._queue.concat(h):this._queue;for(const y of m)if(y.id===i)return void(y.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const m of h)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var af=a.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class ps extends a.E{constructor(i){super(),this._lastTilesetChange=L.now(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=i._source.tileSize*2**this.deltaZoom,i.usedForTerrain=!0,i.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,h){this.sourceCache.update(i,h),this._renderableTilesKeys=[];const m={};for(const y of Be(i,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))m[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.terrainRttPosMatrix32f=new Float64Array(16),a.bY(y.terrainRttPosMatrix32f,0,a.$,a.$,0,0,1),this._tiles[y.key]=new Po(y,this.tileSize),this._lastTilesetChange=L.now());for(const y in this._tiles)m[y]||delete this._tiles[y]}freeRtt(i){for(const h in this._tiles){const m=this._tiles[h];(!i||m.tileID.equals(i)||m.tileID.isChildOf(i)||i.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((i=>this.getTileByID(i)))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i,h){return h?this._getTerrainCoordsForTileRanges(i,h):this._getTerrainCoordsForRegularTile(i)}_getTerrainCoordsForRegularTile(i){const h={};for(const m of this._renderableTilesKeys){const y=this._tiles[m].tileID,w=i.clone(),E=a.ba();if(y.canonical.equals(i.canonical))a.bY(E,0,a.$,a.$,0,0,1);else if(y.canonical.isChildOf(i.canonical)){const R=y.canonical.z-i.canonical.z,D=y.canonical.x-(y.canonical.x>>R<<R),B=y.canonical.y-(y.canonical.y>>R<<R),U=a.$>>R;a.bY(E,0,U,U,0,0,1),a.M(E,E,[-D*U,-B*U,0])}else{if(!i.canonical.isChildOf(y.canonical))continue;{const R=i.canonical.z-y.canonical.z,D=i.canonical.x-(i.canonical.x>>R<<R),B=i.canonical.y-(i.canonical.y>>R<<R),U=a.$>>R;a.bY(E,0,a.$,a.$,0,0,1),a.M(E,E,[D*U,B*U,0]),a.N(E,E,[1/2**R,1/2**R,0])}}w.terrainRttPosMatrix32f=new Float32Array(E),h[m]=w}return h}_getTerrainCoordsForTileRanges(i,h){const m={};for(const y of this._renderableTilesKeys){const w=this._tiles[y].tileID;if(!this._isWithinTileRanges(w,h))continue;const E=i.clone(),R=a.ba();if(w.canonical.z===i.canonical.z){const D=i.canonical.x-w.canonical.x,B=i.canonical.y-w.canonical.y;a.bY(R,0,a.$,a.$,0,0,1),a.M(R,R,[D*a.$,B*a.$,0])}else if(w.canonical.z>i.canonical.z){const D=w.canonical.z-i.canonical.z,B=w.canonical.x-(w.canonical.x>>D<<D),U=w.canonical.y-(w.canonical.y>>D<<D),W=i.canonical.x-(w.canonical.x>>D),$=i.canonical.y-(w.canonical.y>>D),Z=a.$>>D;a.bY(R,0,Z,Z,0,0,1),a.M(R,R,[-B*Z+W*a.$,-U*Z+$*a.$,0])}else{const D=i.canonical.z-w.canonical.z,B=i.canonical.x-(i.canonical.x>>D<<D),U=i.canonical.y-(i.canonical.y>>D<<D),W=(i.canonical.x>>D)-w.canonical.x,$=(i.canonical.y>>D)-w.canonical.y,Z=a.$<<D;a.bY(R,0,Z,Z,0,0,1),a.M(R,R,[B*a.$+W*Z,U*a.$+$*Z,0])}E.terrainRttPosMatrix32f=new Float32Array(R),m[y]=E}return m}getSourceTile(i,h){const m=this.sourceCache._source;let y=i.overscaledZ-this.deltaZoom;if(y>m.maxzoom&&(y=m.maxzoom),y<m.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(y).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!w||!w.dem)&&h)for(;y>=m.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(i.scaledTo(y--).key);return w}anyTilesAfterTime(i=Date.now()){return this._lastTilesetChange>=i}_isWithinTileRanges(i,h){return h[i.canonical.z]&&i.canonical.x>=h[i.canonical.z].minTileX&&i.canonical.x<=h[i.canonical.z].maxTileX&&i.canonical.y>=h[i.canonical.z].minTileY&&i.canonical.y<=h[i.canonical.z].maxTileY}}class ol{constructor(i,h,m){this._meshCache={},this.painter=i,this.sourceCache=new ps(h),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,h,m,y=a.$){var w;if(!(h>=0&&h<y&&m>=0&&m<y))return 0;const E=this.getTerrainData(i),R=(w=E.tile)===null||w===void 0?void 0:w.dem;if(!R)return 0;const D=a.cs([],[h/y*a.$,m/y*a.$],E.u_terrain_matrix),B=[D[0]*R.dim,D[1]*R.dim],U=Math.floor(B[0]),W=Math.floor(B[1]),$=B[0]-U,Z=B[1]-W;return R.get(U,W)*(1-$)*(1-Z)+R.get(U+1,W)*$*(1-Z)+R.get(U,W+1)*(1-$)*Z+R.get(U+1,W+1)*$*Z}getElevationForLngLatZoom(i,h){if(!a.ct(h,i.wrap()))return 0;const{tileID:m,mercatorX:y,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(i,h);return this.getElevation(m,y%a.$,w%a.$,a.$)}getElevation(i,h,m,y=a.$){return this.getDEMElevation(i,h,m,y)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const y=this.painter.context,w=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new a.T(y,w,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new a.T(y,new a.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ag([])}const h=this.sourceCache.getSourceTile(i,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const y=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new a.T(y,h.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),h.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const m=h&&h+h.tileID.key+i.key;if(m&&!this._demMatrixCache[m]){const y=this.sourceCache.sourceCache._source.maxzoom;let w=i.canonical.z-h.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=y?w=i.canonical.z-y:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=i.canonical.x-(i.canonical.x>>w<<w),R=i.canonical.y-(i.canonical.y>>w<<w),D=a.cu(new Float64Array(16),[1/(a.$<<w),1/(a.$<<w),0]);a.M(D,D,[E*a.$,R*a.$,0]),this._demMatrixCache[i.key]={matrix:D,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(i){const h=this.painter,m=h.width/devicePixelRatio,y=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new a.T(h.context,{width:m,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new a.T(h.context,{width:m,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(m,y,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,m,y))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,E=0;w<this._coordsTextureSize;w++)for(let R=0;R<this._coordsTextureSize;R++,E+=4)h[E+0]=255&R,h[E+1]=255&w,h[E+2]=R>>8<<4|w>>8,h[E+3]=0;const m=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),y=new a.T(i,m,i.gl.RGBA,{premultiply:!1});return y.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),m=this.painter.context,y=m.gl,w=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(w,R-E-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null);const D=h[0]+(h[2]>>4<<8),B=h[1]+((15&h[2])<<8),U=this.coordsIndex[255-h[3]],W=U&&this.sourceCache.getTileByID(U);if(!W)return null;const $=this._coordsTextureSize,Z=(1<<W.tileID.canonical.z)*$;return new a.a1((W.tileID.canonical.x*$+D)/Z+W.tileID.wrap,(W.tileID.canonical.y*$+B)/Z,this.getElevation(W.tileID,D,B,$))}depthAtPoint(i){const h=new Uint8Array(4),m=this.painter.context,y=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(i){var h;const m=((h=this.painter.style.projection)===null||h===void 0?void 0:h.transitionState)>0,y=m&&i.canonical.y===0,w=m&&i.canonical.y===(1<<i.canonical.z)-1,E=`m_${y?"n":""}_${w?"s":""}`;if(this._meshCache[E])return this._meshCache[E];const R=this.painter.context,D=new a.cv,B=new a.aN,U=this.meshSize,W=a.$/U,$=U*U;for(let _e=0;_e<=U;_e++)for(let Re=0;Re<=U;Re++)D.emplaceBack(Re*W,_e*W,0);for(let _e=0;_e<$;_e+=U+1)for(let Re=0;Re<U;Re++)B.emplaceBack(Re+_e,U+Re+_e+1,U+Re+_e+2),B.emplaceBack(Re+_e,U+Re+_e+2,Re+_e+1);const Z=D.length,J=Z+(U+1),ie=(U+1)*U,oe=y?a.bh:0,ae=y?0:1,de=w?a.bi:a.$,ye=w?0:1;for(let _e=0;_e<=U;_e++)D.emplaceBack(_e*W,oe,ae);for(let _e=0;_e<=U;_e++)D.emplaceBack(_e*W,de,ye);for(let _e=0;_e<U;_e++)B.emplaceBack(ie+_e,J+_e,J+_e+1),B.emplaceBack(ie+_e,J+_e+1,ie+_e+1),B.emplaceBack(0+_e,Z+_e+1,Z+_e),B.emplaceBack(0+_e,0+_e+1,Z+_e+1);const he=D.length,we=he+2*(U+1);for(const _e of[0,1])for(let Re=0;Re<=U;Re++)for(const Ge of[0,1])D.emplaceBack(_e*a.$,Re*W,Ge);for(let _e=0;_e<2*U;_e+=2)B.emplaceBack(he+_e,he+_e+1,he+_e+3),B.emplaceBack(he+_e,he+_e+3,he+_e+2),B.emplaceBack(we+_e,we+_e+3,we+_e+1),B.emplaceBack(we+_e,we+_e+2,we+_e+3);const Me=new Io(R.createVertexBuffer(D,af.members),R.createIndexBuffer(B),a.aM.simpleSegment(0,0,D.length,B.length));return this._meshCache[E]=Me,Me}getMeshFrameDelta(i){return 2*Math.PI*a.bu/Math.pow(2,Math.max(i,0))/5}getMinTileElevationForLngLatZoom(i,h){var m;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(i,h);return(m=this.getMinMaxElevation(y).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(i){const h=this.getTerrainData(i).tile,m={minElevation:null,maxElevation:null};return h&&h.dem&&(m.minElevation=h.dem.min*this.exaggeration,m.maxElevation=h.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(i,h){const m=a.a1.fromLngLat(i.wrap()),y=(1<<h)*a.$,w=m.x*y,E=m.y*y,R=Math.floor(w/a.$),D=Math.floor(E/a.$);return{tileID:new a.Z(h,0,h,R,D),mercatorX:w,mercatorY:E}}}class jt{constructor(i,h,m){this._context=i,this._size=h,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new a.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(m.texture),{id:i,fbo:h,texture:m,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((h=>i.id!==h)),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((i=>!i.inUse))===!1}}const Gt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class al{constructor(i,h){this.painter=i,this.terrain=h,this.pool=new jt(i.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter((m=>!i._layers[m].isHidden(h))),this._coordsAscending={};for(const m in i.sourceCaches){this._coordsAscending[m]={};const y=i.sourceCaches[m].getVisibleCoordinates(),w=i.sourceCaches[m].getSource(),E=w instanceof Di?w.terrainTileRanges:null;for(const R of y){const D=this.terrain.sourceCache.getTerrainCoords(R,E);for(const B in D)this._coordsAscending[m][B]||(this._coordsAscending[m][B]=[]),this._coordsAscending[m][B].push(D[B])}}this._coordsAscendingStr={};for(const m of i._order){const y=i._layers[m],w=y.source;if(Gt[y.type]&&!this._coordsAscendingStr[w]){this._coordsAscendingStr[w]={};for(const E in this._coordsAscending[w])this._coordsAscendingStr[w][E]=this._coordsAscending[w][E].map((R=>R.key)).sort().join()}}for(const m of this._renderableTiles)for(const y in this._coordsAscendingStr){const w=this._coordsAscendingStr[y][m.tileID.key];w&&w!==m.rttCoords[y]&&(m.rtt=[])}}renderLayer(i,h){if(i.isHidden(this.painter.transform.zoom))return!1;const m=Object.assign(Object.assign({},h),{isRenderingToTexture:!0}),y=i.type,w=this.painter,E=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Gt[y]&&(this._prevType&&Gt[this._prevType]||this._stacks.push([]),this._prevType=y,this._stacks[this._stacks.length-1].push(i.id),!E))return!0;if(Gt[this._prevType]||Gt[y]&&E){this._prevType=y;const R=this._stacks.length-1,D=this._stacks[R]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(Cr(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[R]){const W=this.pool.getObjectForId(B.rtt[R].id);if(W.stamp===B.rtt[R].stamp){this.pool.useObject(W);continue}}const U=this.pool.getOrCreateFreeObject();this.pool.useObject(U),this.pool.stampObject(U),B.rtt[R]={id:U.id,stamp:U.stamp},w.context.bindFramebuffer.set(U.fbo.framebuffer),w.context.clear({color:a.bf.transparent,stencil:0}),w.currentStencilSource=void 0;for(let W=0;W<D.length;W++){const $=w.style._layers[D[W]],Z=$.source?this._coordsAscending[$.source][B.tileID.key]:[B.tileID];w.context.viewport.set([0,0,U.fbo.width,U.fbo.height]),w._renderTileClippingMasks($,Z,!0),w.renderLayer(w,w.style.sourceCaches[$.source],$,Z,m),$.source&&(B.rttCoords[$.source]=this._coordsAscendingStr[$.source][B.tileID.key])}}return Cr(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects(),Gt[y]}return!1}}const eh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},tc=v,Lr={hash:!1,interactive:!0,bearingSnap:7,attributionControl:il,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},ms={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ci{constructor(i,h,m=!1){this.mousedown=w=>{this.startMove(w,z.mousePos(this.element,w)),z.addEventListener(window,"mousemove",this.mousemove),z.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.move(w,z.mousePos(this.element,w))},this.mouseup=w=>{this._rotatePitchHandler.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,w.targetTouches)[0],this.startMove(w,this._startPos),z.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=z.touchPos(this.element,w.targetTouches)[0],this.move(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=h;const y=new va;this._rotatePitchHandler=new bi({clickTolerance:3,move:(w,E)=>{const R=h.getBoundingClientRect(),D=new a.P((R.bottom-R.top)/2,(R.right-R.left)/2);return{bearingDelta:a.cn(new a.P(w.x,E.y),E,D),pitchDelta:m?-.5*(E.y-w.y):void 0}},moveStateManager:y,enable:!0,assignEvents:()=>{}}),this.map=i,z.addEventListener(h,"mousedown",this.mousedown),z.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(h,"touchcancel",this.reset)}startMove(i,h){this._rotatePitchHandler.dragStart(i,h),z.disableDrag()}move(i,h){const m=this.map,{bearingDelta:y,pitchDelta:w}=this._rotatePitchHandler.dragMove(i,h)||{};y&&m.setBearing(m.getBearing()+y),w&&m.setPitch(m.getPitch()+w)}off(){const i=this.element;z.removeEventListener(i,"mousedown",this.mousedown),z.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend),z.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){z.enableDrag(),z.removeEventListener(window,"mousemove",this.mousemove),z.removeEventListener(window,"mouseup",this.mouseup),z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),z.removeEventListener(window,"touchend",this.touchend)}}let Bo;function ll(x,i,h,m=!1){if(m||!h.getCoveringTilesDetailsProvider().allowWorldCopies())return x?.wrap();const y=new a.S(x.lng,x.lat);if(x=new a.S(x.lng,x.lat),i){const w=new a.S(x.lng-360,x.lat),E=new a.S(x.lng+360,x.lat),R=h.locationToScreenPoint(x).distSqr(i);h.locationToScreenPoint(w).distSqr(i)<R?x=w:h.locationToScreenPoint(E).distSqr(i)<R&&(x=E)}for(;Math.abs(x.lng-h.center.lng)>180;){const w=h.locationToScreenPoint(x);if(w.x>=0&&w.y>=0&&w.x<=h.width&&w.y<=h.height)break;x.lng>h.center.lng?x.lng-=360:x.lng+=360}return x.lng!==y.lng&&h.isPointOnMapSurface(h.locationToScreenPoint(x))?x:y}const zn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Yn(x,i,h){const m=x.classList;for(const y in zn)m.remove(`maplibregl-${h}-anchor-${y}`);m.add(`maplibregl-${h}-anchor-${i}`)}class nc extends a.E{constructor(i){if(super(),this._onKeyPress=h=>{const m=h.code,y=h.charCode||h.keyCode;m!=="Space"&&m!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=h=>{const m=h.originalEvent.target,y=this._element;this._popup&&(m===y||y.contains(m))&&this.togglePopup()},this._update=h=>{if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();(h?.type==="terrain"||h?.type==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=ll(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),z.setTransform(this._element,`${zn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${y}`),L.frameAsync(new AbortController).then((()=>{this._updateOpacity(h&&h.type==="moveend")})).catch((()=>{}))},this._onMove=h=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(i?.opacity,i?.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=a.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=z.create("div");const h=z.createNS("http://www.w3.org/2000/svg","svg"),m=41,y=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${m}px`),h.setAttributeNS(null,"width",`${y}px`),h.setAttributeNS(null,"viewBox",`0 0 ${y} ${m}`);const w=z.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const E=z.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const R=z.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of D){const de=z.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",ae.rx),de.setAttributeNS(null,"ry",ae.ry),R.appendChild(de)}const B=z.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const U=z.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(U);const W=z.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");const $=z.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild($);const Z=z.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const J=z.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ie=z.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#000000"),ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962");const oe=z.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#FFFFFF"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962"),J.appendChild(ie),J.appendChild(oe),E.appendChild(R),E.appendChild(B),E.appendChild(W),E.appendChild(Z),E.appendChild(J),h.appendChild(E),h.setAttributeNS(null,"height",m*this._scale+"px"),h.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(h=>{h.preventDefault()})),this._element.addEventListener("mousedown",(h=>{h.preventDefault()})),Yn(this._element,this._anchor,"marker"),i&&i.className)for(const h of i.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),i.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=a.S.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const y=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var h,m;const y=(h=this._map)===null||h===void 0?void 0:h.terrain,w=this._map.transform.isLocationOccluded(this._lngLat);if(!y||w){const Z=w?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Z&&(this._element.style.opacity=Z))}if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const E=this._map,R=E.terrain.depthAtPoint(this._pos),D=E.terrain.getElevationForLngLatZoom(this._lngLat,E.transform.tileZoom);if(E.transform.lngLatToCameraDepth(this._lngLat,D)-R<.006)return void(this._element.style.opacity=this._opacity);const B=-this._offset.y/E.transform.pixelsPerMeter,U=Math.sin(E.getPitch()*Math.PI/180)*B,W=E.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),$=E.transform.lngLatToCameraDepth(this._lngLat,D+U)-W>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&$&&this._popup.remove(),this._element.style.opacity=$?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=a.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,h){return(this._opacity===void 0||i===void 0&&h===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const rc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let zi=0,Qi=!1;const ic={maxWidth:100,unit:"metric"};function cu(x,i,h){const m=h&&h.maxWidth||100,y=x._container.clientHeight/2,w=x._container.clientWidth/2,E=x.unproject([w-m/2,y]),R=x.unproject([w+m/2,y]),D=Math.round(x.project(R).x-x.project(E).x),B=Math.min(m,D,x._container.clientWidth),U=E.distanceTo(R);if(h&&h.unit==="imperial"){const W=3.2808*U;W>5280?Is(i,B,W/5280,x._getUIString("ScaleControl.Miles")):Is(i,B,W,x._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Is(i,B,U/1852,x._getUIString("ScaleControl.NauticalMiles")):U>=1e3?Is(i,B,U/1e3,x._getUIString("ScaleControl.Kilometers")):Is(i,B,U,x._getUIString("ScaleControl.Meters"))}function Is(x,i,h,m){const y=(function(w){const E=Math.pow(10,`${Math.floor(w)}`.length-1);let R=w/E;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:(function(D){const B=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*B)/B})(R),E*R})(h);x.style.width=i*(y/h)+"px",x.innerHTML=`${y}&nbsp;${m}`}const th={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},cl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gs(x){if(x){if(typeof x=="number"){const i=Math.round(Math.abs(x)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,x),"top-left":new a.P(i,i),"top-right":new a.P(-i,i),bottom:new a.P(0,-x),"bottom-left":new a.P(i,-i),"bottom-right":new a.P(-i,-i),left:new a.P(x,0),right:new a.P(-x,0)}}if(x instanceof a.P||Array.isArray(x)){const i=a.P.convert(x);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:a.P.convert(x.center||[0,0]),top:a.P.convert(x.top||[0,0]),"top-left":a.P.convert(x["top-left"]||[0,0]),"top-right":a.P.convert(x["top-right"]||[0,0]),bottom:a.P.convert(x.bottom||[0,0]),"bottom-left":a.P.convert(x["bottom-left"]||[0,0]),"bottom-right":a.P.convert(x["bottom-right"]||[0,0]),left:a.P.convert(x.left||[0,0]),right:a.P.convert(x.right||[0,0])}}return gs(new a.P(0,0))}const ul=v;d.AJAXError=a.cz,d.Event=a.l,d.Evented=a.E,d.LngLat=a.S,d.MercatorCoordinate=a.a1,d.Point=a.P,d.addProtocol=a.cA,d.config=a.a,d.removeProtocol=a.cB,d.AttributionControl=Ju,d.BoxZoomHandler=xi,d.CanvasSource=mi,d.CooperativeGesturesHandler=au,d.DoubleClickZoomHandler=Cs,d.DragPanHandler=ou,d.DragRotateHandler=Yu,d.EdgeInsets=lo,d.FullscreenControl=class extends a.E{constructor(x={}){super(),this._onFullscreenChange=()=>{var i;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=h?.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=z.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);z.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=ki,d.GeolocateControl=class extends a.E{constructor(x){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",i)),this._finish()}},this._updateCamera=i=>{const h=new a.S(i.coords.longitude,i.coords.latitude),m=i.coords.accuracy,y=this._map.getBearing(),w=a.e({bearing:y},this.options.fitBoundsOptions),E=qn.fromLngLat(h,m);this._map.fitBounds(E,w,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const h=new a.S(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=i.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=i=>{if(this._map){if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&Qi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(i=>i.preventDefault())),this._geolocateButton=z.create("button","maplibregl-ctrl-geolocate",this._container),z.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new nc({element:this._dotElement}),this._circleElement=z.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(h=>{const m=h?.[0]instanceof ResizeObserverEntry;h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||m||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))}))}},this.options=a.e({},rc,x)}onAdd(x){return this._map=x,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return a._(this,arguments,void 0,(function*(i=!1){if(Bo!==void 0&&!i)return Bo;if(window.navigator.permissions===void 0)return Bo=!!window.navigator.geolocation,Bo;try{Bo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Bo=!!window.navigator.geolocation}return Bo}))})().then((i=>this._finishSetupUI(i))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),z.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,zi=0,Qi=!1}_isOutOfMapMaxBounds(x){const i=this._map.getMaxBounds(),h=x.coords;return i&&(h.longitude<i.getWest()||h.longitude>i.getEast()||h.latitude<i.getSouth()||h.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const x=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&x))return;const i=this._map.project(x),h=this._map.unproject([i.x+100,i.y]),m=x.distanceTo(h)/100,y=2*this._accuracy/m;this._circleElement.style.width=`${y.toFixed(2)}px`,this._circleElement.style.height=`${y.toFixed(2)}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zi--,Qi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),zi++,zi>1?(x={maximumAge:6e5,timeout:0},Qi=!0):(x=this.options.positionOptions,Qi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.GlobeControl=class{constructor(){this._toggleProjection=()=>{var x;const i=(x=this._map.getProjection())===null||x===void 0?void 0:x.type;this._map.setProjection(i!=="mercator"&&i?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var x;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((x=this._map.getProjection())===null||x===void 0?void 0:x.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(x){return this._map=x,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=z.create("button","maplibregl-ctrl-globe",this._container),z.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){z.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},d.Hash=Ka,d.ImageSource=Di,d.KeyboardHandler=In,d.LngLatBounds=qn,d.LogoControl=Qu,d.Map=class extends xa{constructor(x){var i,h;a.cw.mark(a.cx.create);const m=Object.assign(Object.assign(Object.assign({},Lr),x),{canvasContextAttributes:Object.assign(Object.assign({},Lr.canvasContextAttributes),x.canvasContextAttributes)});if(m.minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const y=new rr,w=new li;if(m.minZoom!==void 0&&y.setMinZoom(m.minZoom),m.maxZoom!==void 0&&y.setMaxZoom(m.maxZoom),m.minPitch!==void 0&&y.setMinPitch(m.minPitch),m.maxPitch!==void 0&&y.setMaxPitch(m.maxPitch),m.renderWorldCopies!==void 0&&y.setRenderWorldCopies(m.renderWorldCopies),super(y,w,{bearingSnap:m.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new sl,this._controls=[],this._mapId=a.a7(),this._contextLost=R=>{R.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:R}))},this._contextRestored=R=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:R}))},this._onMapScroll=R=>{if(R.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},m.canvasContextAttributes),this._trackResize=m.trackResize===!0,this._bearingSnap=m.bearingSnap,this._centerClampedToGround=m.centerClampedToGround,this._refreshExpiredTiles=m.refreshExpiredTiles===!0,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions===!0,this._collectResourceTiming=m.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},eh),m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=m.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Se.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ne(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let R=!1;const D=tu((B=>{this._trackResize&&!this._removed&&(this.resize(B),this.redraw())}),50);this._resizeObserver=new ResizeObserver((B=>{R?D(B):R=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Hp(this,m),this._hash=m.hash&&new Ka(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,roll:m.roll}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,a.e({},m.fitBoundsOptions,{duration:0}))));const E=typeof m.style=="string"||((h=(i=m.style)===null||i===void 0?void 0:i.projection)===null||h===void 0?void 0:h.type)!=="globe";this.resize(null,E),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Ju(typeof m.attributionControl=="boolean"?void 0:m.attributionControl)),m.maplibreLogo&&this.addControl(new Qu,m.logoPosition),this.on("style.load",(()=>{if(E||this._resizeTransform(),this.transform.unmodified){const R=a.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(R)}})),this.on("data",(R=>{this._update(R.dataType==="style"),this.fire(new a.l(`${R.dataType}data`,R))})),this.on("dataloading",(R=>{this.fire(new a.l(`${R.dataType}dataloading`,R))})),this.on("dataabort",(R=>{this.fire(new a.l("sourcedataabort",R))}))}_getMapId(){return this._mapId}setGlobalStateProperty(x,i){return this.style.setGlobalStateProperty(x,i),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(x,i){if(i===void 0&&(i=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=x.onAdd(this);this._controls.push(x);const m=this._controlPositions[i];return i.indexOf("bottom")!==-1?m.insertBefore(h,m.firstChild):m.appendChild(h),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(x);return i>-1&&this._controls.splice(i,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}coveringTiles(x){return Be(this.transform,x)}calculateCameraOptionsFromTo(x,i,h,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,i,h,m)}resize(x,i=!0){const[h,m]=this._containerDimensions(),y=this._getClampedPixelRatio(h,m);if(this._resizeCanvas(h,m,y),this.painter.resize(h,m,y),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const R=this._getClampedPixelRatio(h,m);this._resizeCanvas(h,m,R),this.painter.resize(h,m,R)}this._resizeTransform(i);const w=!this._moving;return w&&(this.stop(),this.fire(new a.l("movestart",x)).fire(new a.l("move",x))),this.fire(new a.l("resize",x)),w&&this.fire(new a.l("moveend",x)),this}_resizeTransform(x=!0){var i;const[h,m]=this._containerDimensions();this.transform.resize(h,m,x),(i=this._requestedCameraState)===null||i===void 0||i.resize(h,m,x)}_getClampedPixelRatio(x,i){const{0:h,1:m}=this._maxCanvasSize,y=this.getPixelRatio(),w=x*y,E=i*y;return Math.min(w>h?h/w:1,E>m?m/E:1)*y}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(qn.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.setMinZoom(x),this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.setMaxZoom(x),this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.setMinPitch(x),this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(x>=this.transform.minPitch)return this.transform.setMaxPitch(x),this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.setRenderWorldCopies(x),this._update()}project(x){return this.transform.locationToScreenPoint(a.S.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.screenPointToLocation(a.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,i,h){if(x==="mouseenter"||x==="mouseover"){let m=!1;return{layers:i,listener:h,delegates:{mousemove:w=>{const E=i.filter((D=>this.getLayer(D))),R=E.length!==0?this.queryRenderedFeatures(w.point,{layers:E}):[];R.length?m||(m=!0,h.call(this,new Dn(x,this,w.originalEvent,{features:R}))):m=!1},mouseout:()=>{m=!1}}}}if(x==="mouseleave"||x==="mouseout"){let m=!1;return{layers:i,listener:h,delegates:{mousemove:E=>{const R=i.filter((D=>this.getLayer(D)));(R.length!==0?this.queryRenderedFeatures(E.point,{layers:R}):[]).length?m=!0:m&&(m=!1,h.call(this,new Dn(x,this,E.originalEvent)))},mouseout:E=>{m&&(m=!1,h.call(this,new Dn(x,this,E.originalEvent)))}}}}{const m=y=>{const w=i.filter((R=>this.getLayer(R))),E=w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[];E.length&&(y.features=E,h.call(this,y),delete y.features)};return{layers:i,listener:h,delegates:{[x]:m}}}}_saveDelegatedListener(x,i){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(i)}_removeDelegatedListener(x,i,h){if(!this._delegatedListeners||!this._delegatedListeners[x])return;const m=this._delegatedListeners[x];for(let y=0;y<m.length;y++){const w=m[y];if(w.listener===h&&w.layers.length===i.length&&w.layers.every((E=>i.includes(E)))){for(const E in w.delegates)this.off(E,w.delegates[E]);return void m.splice(y,1)}}}on(x,i,h){if(h===void 0)return super.on(x,i);const m=typeof i=="string"?[i]:i,y=this._createDelegatedListener(x,m,h);this._saveDelegatedListener(x,y);for(const w in y.delegates)this.on(w,y.delegates[w]);return{unsubscribe:()=>{this._removeDelegatedListener(x,m,h)}}}once(x,i,h){if(h===void 0)return super.once(x,i);const m=typeof i=="string"?[i]:i,y=this._createDelegatedListener(x,m,h);for(const w in y.delegates){const E=y.delegates[w];y.delegates[w]=(...R)=>{this._removeDelegatedListener(x,m,h),E(...R)}}this._saveDelegatedListener(x,y);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(x,i,h){return h===void 0?super.off(x,i):(this._removeDelegatedListener(x,typeof i=="string"?[i]:i,h),this)}queryRenderedFeatures(x,i){if(!this.style)return[];let h;const m=x instanceof a.P||Array.isArray(x),y=m?x:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(m?{}:x)||{},y instanceof a.P||typeof y[0]=="number")h=[a.P.convert(y)];else{const w=a.P.convert(y[0]),E=a.P.convert(y[1]);h=[w,new a.P(E.x,w.y),E,new a.P(w.x,E.y),w]}return this.style.queryRenderedFeatures(h,i,this.transform)}querySourceFeatures(x,i){return this.style.querySourceFeatures(x,i)}setStyle(x,i){return(i=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(x,i))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const i=this._locale[x];if(i==null)throw new Error(`Missing UI string '${x}'`);return i}_updateStyle(x,i){var h,m;if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(x,i)));const y=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new zh(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,i,y):this.style.loadJSON(x,i,y),this):((m=(h=this.style)===null||h===void 0?void 0:h.projection)===null||m===void 0||m.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new zh(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,i){if(typeof x=="string"){const h=this._requestManager.transformRequest(x,"Style");a.j(h,new AbortController).then((m=>{this._updateDiff(m.data,i)})).catch((m=>{m&&this.fire(new a.k(m))}))}else typeof x=="object"&&this._updateDiff(x,i)}_updateDiff(x,i){try{this.style.setState(x,i)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(x,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(x,i){return this._lazyInitEmptyStyle(),this.style.addSource(x,i),this._update(!0)}isSourceLoaded(x){const i=this.style&&this.style.sourceCaches[x];if(i!==void 0)return i.loaded();this.fire(new a.k(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const i=this.style.sourceCaches[x.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&i.reload();for(const h in this.style._layers){const m=this.style._layers[h];m.type==="hillshade"&&m.source===x.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),m.type==="color-relief"&&m.source===x.source&&a.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ol(this.painter,i,x),this.painter.renderToTexture=new al(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=h=>{var m;h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==x.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((m=h.source)===null||m===void 0?void 0:m.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:x})),this}getTerrain(){var x,i;return(i=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const i in x){const h=x[i]._tiles;for(const m in h){const y=h[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}setSourceTileLodParams(x,i,h){if(h){const m=this.getSource(h);if(!m)throw new Error(`There is no source with ID "${h}", cannot set LOD parameters`);m.calculateTileZoom=yt(Math.max(1,x),Math.max(1,i))}else for(const m in this.style.sourceCaches)this.style.sourceCaches[m].getSource().calculateTileZoom=yt(Math.max(1,x),Math.max(1,i));return this._update(!0),this}refreshTiles(x,i){const h=this.style.sourceCaches[x];if(!h)throw new Error(`There is no source cache with ID "${x}", cannot refresh tile`);i===void 0?h.reload(!0):h.refreshTiles(i.map((m=>new a.a4(m.z,m.x,m.y))))}addImage(x,i,h={}){const{pixelRatio:m=1,sdf:y=!1,stretchX:w,stretchY:E,content:R,textFitWidth:D,textFitHeight:B}=h;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||a.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:U,height:W,data:$}=i,Z=i;return this.style.addImage(x,{data:new a.R({width:U,height:W},new Uint8Array($)),pixelRatio:m,stretchX:w,stretchY:E,content:R,textFitWidth:D,textFitHeight:B,sdf:y,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,x),this}}{const{width:U,height:W,data:$}=L.getImageData(i);this.style.addImage(x,{data:new a.R({width:U,height:W},$),pixelRatio:m,stretchX:w,stretchY:E,content:R,textFitWidth:D,textFitHeight:B,sdf:y,version:0})}}updateImage(x,i){const h=this.style.getImage(x);if(!h)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof HTMLImageElement||a.b(i)?L.getImageData(i):i,{width:y,height:w,data:E}=m;if(y===void 0||w===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==h.data.width||w!==h.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(i instanceof HTMLImageElement||a.b(i));return h.data.replace(E,R),this.style.updateImage(x,h),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return Se.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,i){return this._lazyInitEmptyStyle(),this.style.addLayer(x,i),this._update(!0)}moveLayer(x,i){return this.style.moveLayer(x,i),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,i,h){return this.style.setLayerZoomRange(x,i,h),this._update(!0)}setFilter(x,i,h={}){return this.style.setFilter(x,i,h),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,i,h,m={}){return this.style.setPaintProperty(x,i,h,m),this._update(!0)}getPaintProperty(x,i){return this.style.getPaintProperty(x,i)}setLayoutProperty(x,i,h,m={}){return this.style.setLayoutProperty(x,i,h,m),this._update(!0)}getLayoutProperty(x,i){return this.style.getLayoutProperty(x,i)}setGlyphs(x,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,i,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,i,h,(m=>{m||this._update(!0)})),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,i,(h=>{h||this._update(!0)})),this}setLight(x,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(x,i={}){return this._lazyInitEmptyStyle(),this.style.setSky(x,i),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(x,i){return this.style.setFeatureState(x,i),this._update()}removeFeatureState(x,i){return this.style.removeFeatureState(x,i),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,i=0;return this._container&&(x=this._container.clientWidth||400,i=this._container.clientHeight||300),[x,i]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const i=this._canvasContainer=z.create("div","maplibregl-canvas-container",x);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=z.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),m=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],m);const y=this._controlContainer=z.create("div","maplibregl-control-container",x),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((E=>{w[E]=z.create("div",`maplibregl-ctrl-${E} `,y)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,i,h){this._canvas.width=Math.floor(h*x),this._canvas.height=Math.floor(h*i),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const x=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let i=null;this._canvas.addEventListener("webglcontextcreationerror",(m=>{i={requestedAttributes:x},m&&(i.statusMessage=m.statusMessage,i.type=m.type)}),{once:!0});let h=null;if(h=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,x):this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x),!h){const m="Failed to initialize WebGL";throw i?(i.message=m,new Error(JSON.stringify(i))):new Error(m)}this.painter=new Ps(h,this.transform),G.testSupport(h)}migrateProjection(x,i){super.migrateProjection(x,i),this.painter.transform=x,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){var i,h,m,y,w;const E=this._idleTriggered?this._fadeDuration:0,R=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let D=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const W=this.transform.zoom,$=L.now();this.style.zoomHistory.update(W,$);const Z=new a.F(W,{now:$,fadeDuration:E,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),J=Z.crossFadingFactor();J===1&&J===this._crossFadingFactor||(D=!0,this._crossFadingFactor=J),this.style.update(Z)}const B=((h=this.style.projection)===null||h===void 0?void 0:h.transitionState)>0!==R;(m=this.style.projection)===null||m===void 0||m.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((y=this.style.projection)===null||y===void 0?void 0:y.transitionState,(w=this.style.projection)===null||w===void 0?void 0:w.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||B)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,E,this._crossSourceCollisions,B),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cw.mark(a.cx.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const U=this._sourcesDirty||this._styleDirty||this._placementDirty;return U||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,a.cw.mark(a.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Se.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i?.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),z.remove(this._canvasContainer),z.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cw.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,L.frame(this._frameRequest,(x=>{a.cw.frame(x),this._frameRequest=null;try{this._render(x)}catch(i){if(!a.cy(i)&&!(function(h){return h.message===Yc})(i))throw i}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return tc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(x){return this._lazyInitEmptyStyle(),this.style.setProjection(x),this._update(!0)}},d.MapMouseEvent=Dn,d.MapTouchEvent=ds,d.MapWheelEvent=Jr,d.Marker=nc,d.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const i=this._map.getZoom(),h=i===this._map.getMaxZoom(),m=i===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(i,h)=>{const m=this._map._getUIString(`NavigationControl.${h}`);i.title=m,i.setAttribute("aria-label",m)},this.options=a.e({},ms,x),this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(i=>i.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(i=>this._map.zoomIn({},{originalEvent:i}))),z.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(i=>this._map.zoomOut({},{originalEvent:i}))),z.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})})),this._compassIcon=z.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ci(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,i){const h=z.create("button",x,this._container);return h.type="button",h.addEventListener("click",i),h}},d.Popup=class extends a.E{constructor(x){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&z.remove(this._content),this._container&&(z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=z.create("div","maplibregl-popup",this._map.getContainer()),this._tip=z.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ll(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!i)return;const h=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationToScreenPoint(this._lngLat));let m=this.options.anchor;const y=gs(this.options.offset);if(!m){const E=this._container.offsetWidth,R=this._container.offsetHeight;let D;D=h.y+y.bottom.y<R?["top"]:h.y>this._map.transform.height-R?["bottom"]:[],h.x<E/2?D.push("left"):h.x>this._map.transform.width-E/2&&D.push("right"),m=D.length===0?"bottom":D.join("-")}let w=h.add(y[m]);this.options.subpixelPositioning||(w=w.round()),z.setTransform(this._container,`${zn[m]} translate(${w.x}px,${w.y}px)`),Yn(this._container,m,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(th),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=a.S.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const i=document.createDocumentFragment(),h=document.createElement("body");let m;for(h.innerHTML=x;m=h.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){return this._container&&this._container.classList.add(x),this}removeClassName(x){return this._container&&this._container.classList.remove(x),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}_createCloseButton(){this.options.closeButton&&(this._closeButton=z.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(cl);x&&x.focus()}},d.RasterDEMTileSource=Us,d.RasterTileSource=mn,d.ScaleControl=class{constructor(x){this._onMove=()=>{cu(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,cu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ic),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=gr,d.Style=zh,d.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=z.create("button","maplibregl-ctrl-terrain",this._container),z.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=Es,d.TwoFingersTouchRotateHandler=Ks,d.TwoFingersTouchZoomHandler=Ki,d.TwoFingersTouchZoomRotateHandler=Ku,d.VectorTileSource=pn,d.VideoSource=Gi,d.addSourceType=(x,i)=>a._(void 0,void 0,void 0,(function*(){if(To(x))throw new Error(`A source type called "${x}" already exists.`);((h,m)=>{bs[h]=m})(x,i)})),d.clearPrewarmedResources=function(){const x=dt;x&&(x.isPreloaded()&&x.numActive()===1?(x.release($e),dt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.createTileMesh=Ol,d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return so().getRTLTextPluginStatus()},d.getVersion=function(){return ul},d.getWorkerCount=function(){return ue.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(x){return vt().broadcast("IS",x)},d.prewarm=function(){kt().acquire($e)},d.setMaxParallelImageRequests=function(x){a.a.MAX_PARALLEL_IMAGE_REQUESTS=x},d.setRTLTextPlugin=function(x,i){return so().setRTLTextPlugin(x,i)},d.setWorkerCount=function(x){ue.workerCount=x},d.setWorkerUrl=function(x){a.a.WORKER_URL=x}}));var c=t;return c}))})(C_)),C_.exports}var tE=nL();const nE=Tx(tE),rL=eA({__proto__:null,default:nE},[tE]),iL="modulepreload",sL=function(n){return"/"+n},vT={},rE=function(e,t,r){let o=Promise.resolve();if(t&&t.length>0){let A=function(P){return Promise.all(P.map(k=>Promise.resolve(k).then(L=>({status:"fulfilled",value:L}),L=>({status:"rejected",reason:L}))))};var d=A;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),v=a?.nonce||a?.getAttribute("nonce");o=A(t.map(P=>{if(P=sL(P),P in vT)return;vT[P]=!0;const k=P.endsWith(".css"),L=k?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${P}"]${L}`))return;const z=document.createElement("link");if(z.rel=k?"stylesheet":iL,k||(z.as="script"),z.crossOrigin="",z.href=P,v&&z.setAttribute("nonce",v),document.head.appendChild(z),k)return new Promise((G,te)=>{z.addEventListener("load",G),z.addEventListener("error",()=>te(new Error(`Unable to preload CSS for ${P}`)))})}))}function c(a){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=a,window.dispatchEvent(v),!v.defaultPrevented)throw a}return o.then(a=>{for(const v of a||[])v.status==="rejected"&&c(v.reason);return e().catch(c)})},oL=Ae.createContext(null);function aL(n,e){const t=Array.isArray(n)?n[0]:n?n.x:0,r=Array.isArray(n)?n[1]:n?n.y:0,o=Array.isArray(e)?e[0]:e?e.x:0,c=Array.isArray(e)?e[1]:e?e.y:0;return t===o&&r===c}function Tc(n,e){if(n===e)return!0;if(!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Tc(n[t],e[t]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(const o of t)if(!e.hasOwnProperty(o)||!Tc(n[o],e[o]))return!1;return!0}return!1}function xT(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function bT(n,e){const t=e.viewState||e,r={};if("longitude"in t&&"latitude"in t&&(t.longitude!==n.center.lng||t.latitude!==n.center.lat)){const o=n.center.constructor;r.center=new o(t.longitude,t.latitude)}return"zoom"in t&&t.zoom!==n.zoom&&(r.zoom=t.zoom),"bearing"in t&&t.bearing!==n.bearing&&(r.bearing=t.bearing),"pitch"in t&&t.pitch!==n.pitch&&(r.pitch=t.pitch),t.padding&&n.padding&&!Tc(t.padding,n.padding)&&(r.padding=t.padding),r}const lL=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function wT(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const e={};for(const r of n.layers)e[r.id]=r;const t=n.layers.map(r=>{let o=null;"interactive"in r&&(o=Object.assign({},r),delete o.interactive);const c=e[r.ref];if(c){o=o||Object.assign({},r),delete o.ref;for(const d of lL)d in c&&(o[d]=c[d])}return o||r});return{...n,layers:t}}const TT={version:8,sources:{},layers:[]},ST={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},AT={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},PT={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},cL=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],uL=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class gp{constructor(e,t,r){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=o=>{const c=this.props[PT[o.type]];c?c(o):o.type==="error"&&console.error(o.error)},this._onCameraEvent=o=>{if(this._internalUpdate)return;o.viewState=this._propsedCameraUpdate||xT(this._map.transform);const c=this.props[AT[o.type]];c&&c(o)},this._onCameraUpdate=o=>this._internalUpdate?o:(this._propsedCameraUpdate=xT(o),bT(o,this.props)),this._onPointerEvent=o=>{(o.type==="mousemove"||o.type==="mouseout")&&this._updateHover(o);const c=this.props[ST[o.type]];c&&(this.props.interactiveLayerIds&&o.type!=="mouseover"&&o.type!=="mouseout"&&(o.features=this._hoveredFeatures||this._queryRenderedFeatures(o.point)),c(o),delete o.features)},this._MapClass=e,this.props=t,this._initialize(r)}get map(){return this._map}setProps(e){const t=this.props;this.props=e;const r=this._updateSettings(e,t),o=this._updateSize(e),c=this._updateViewState(e);this._updateStyle(e,t),this._updateStyleComponents(e),this._updateHandlers(e,t),(r||o||c&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const r=gp.savedMaps.pop();if(!r)return null;const o=r.map,c=o.getContainer();for(t.className=c.className;c.childNodes.length>0;)t.appendChild(c.childNodes[0]);o._container=t;const d=o._resizeObserver;d&&(d.disconnect(),d.observe(t)),r.setProps({...e,styleDiffing:!1}),o.resize();const{initialViewState:a}=e;return a&&(a.bounds?o.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a)),o.isStyleLoaded()?o.fire("load"):o.once("style.load",()=>o.fire("load")),o._update(),r}_initialize(e){const{props:t}=this,{mapStyle:r=TT}=t,o={...t,...t.initialViewState,container:e,style:wT(r)},c=o.initialViewState||o.viewState||o;if(Object.assign(o,{center:[c.longitude||0,c.latitude||0],zoom:c.zoom||0,pitch:c.pitch||0,bearing:c.bearing||0}),t.gl){const a=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=a,t.gl)}const d=new this._MapClass(o);c.padding&&d.setPadding(c.padding),t.cursor&&(d.getCanvas().style.cursor=t.cursor),d.transformCameraUpdate=this._onCameraUpdate,d.on("style.load",()=>{this._styleComponents={light:d.getLight(),sky:d.getSky(),projection:d.getProjection?.(),terrain:d.getTerrain()},this._updateStyleComponents(this.props)}),d.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const a in ST)d.on(a,this._onPointerEvent);for(const a in AT)d.on(a,this._onCameraEvent);for(const a in PT)d.on(a,this._onEvent);this._map=d}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),gp.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:t}=e;if(t){const r=this._map;if(t.width!==r.transform.width||t.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e){const t=this._map,r=t.transform;if(!t.isMoving()){const c=bT(r,e);if(Object.keys(c).length>0)return this._internalUpdate=!0,t.jumpTo(c),this._internalUpdate=!1,!0}return!1}_updateSettings(e,t){const r=this._map;let o=!1;for(const c of cL)c in e&&!Tc(e[c],t[c])&&(o=!0,r[`set${c[0].toUpperCase()}${c.slice(1)}`]?.call(r,e[c]));return o}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:r=TT,styleDiffing:o=!0}=e,c={diff:o};"localIdeographFontFamily"in e&&(c.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(wT(r),c)}}_updateStyleComponents({light:e,projection:t,sky:r,terrain:o}){const c=this._map,d=this._styleComponents;c.style._loaded&&(e&&!Tc(e,d.light)&&(d.light=e,c.setLight(e)),t&&!Tc(t,d.projection)&&t!==d.projection?.type&&(d.projection=typeof t=="string"?{type:t}:t,c.setProjection?.(d.projection)),r&&!Tc(r,d.sky)&&(d.sky=r,c.setSky(r)),o!==void 0&&!Tc(o,d.terrain)&&(!o||c.getSource(o.source))&&(d.terrain=o,c.setTerrain(o)))}_updateHandlers(e,t){const r=this._map;for(const o of uL){const c=e[o]??!0,d=t[o]??!0;Tc(c,d)||(c?r[o].enable(c):r[o].disable())}}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:r=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:r.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const o=e.type,c=this._hoveredFeatures?.length>0,d=this._queryRenderedFeatures(e.point),a=d.length>0;!a&&c&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=d,a&&!c&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=o}else this._hoveredFeatures=null}}gp.savedMaps=[];const hL=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function dL(n){if(!n)return null;const e=n.map,t={getMap:()=>e};for(const r of fL(e))!(r in t)&&!hL.includes(r)&&(t[r]=e[r].bind(e));return t}function fL(n){const e=new Set;let t=n;for(;t;){for(const r of Object.getOwnPropertyNames(t))r[0]!=="_"&&typeof n[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);t=Object.getPrototypeOf(t)}return Array.from(e)}const pL=typeof document<"u"?Ae.useLayoutEffect:Ae.useEffect;function mL(n,e){const{RTLTextPlugin:t,maxParallelImageRequests:r,workerCount:o,workerUrl:c}=e;if(t&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:d,lazy:a=!0}=typeof t=="string"?{pluginUrl:t}:t;n.setRTLTextPlugin(d,v=>{v&&console.error(v)},a)}r!==void 0&&n.setMaxParallelImageRequests(r),o!==void 0&&n.setWorkerCount(o),c!==void 0&&n.setWorkerUrl(c)}const Sy=Ae.createContext(null);function gL(n,e){const t=Ae.useContext(oL),[r,o]=Ae.useState(null),c=Ae.useRef(),{current:d}=Ae.useRef({mapLib:null,map:null});Ae.useEffect(()=>{const A=n.mapLib;let P=!0,k;return Promise.resolve(A||rE(()=>Promise.resolve().then(()=>rL),void 0)).then(L=>{if(!P)return;if(!L)throw new Error("Invalid mapLib");const z="Map"in L?L:L.default;if(!z.Map)throw new Error("Invalid mapLib");mL(z,n),n.reuseMaps&&(k=gp.reuse(n,c.current)),k||(k=new gp(z.Map,n,c.current)),d.map=dL(k),d.mapLib=z,o(k),t?.onMapMount(d.map,n.id)}).catch(L=>{const{onError:z}=n;z?z({type:"error",target:null,originalEvent:null,error:L}):console.error(L)}),()=>{P=!1,k&&(t?.onMapUnmount(n.id),n.reuseMaps?k.recycle():k.destroy())}},[]),pL(()=>{r&&r.setProps(n)}),Ae.useImperativeHandle(e,()=>d.map,[r]);const a=Ae.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]),v={height:"100%"};return Ae.createElement("div",{id:n.id,ref:c,style:a},r&&Ae.createElement(Sy.Provider,{value:d},Ae.createElement("div",{"mapboxgl-children":"",style:v},n.children)))}const _L=Ae.forwardRef(gL),yL=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Mu(n,e){if(!n||!e)return;const t=n.style;for(const r in e){const o=e[r];Number.isFinite(o)&&!yL.test(r)?t[r]=`${o}px`:t[r]=o}}function iE(n,e){if(n===e)return null;const t=ET(n),r=ET(e),o=[];for(const c of r)t.has(c)||o.push(c);for(const c of t)r.has(c)||o.push(c);return o.length===0?null:o}function ET(n){return new Set(n?n.trim().split(/\s+/):[])}Ae.memo(Ae.forwardRef((n,e)=>{const{map:t,mapLib:r}=Ae.useContext(Sy),o=Ae.useRef({props:n}),c=Ae.useMemo(()=>{let fe=!1;Ae.Children.forEach(n.children,Se=>{Se&&(fe=!0)});const ve={...n,element:fe?document.createElement("div"):void 0},le=new r.Marker(ve);return le.setLngLat([n.longitude,n.latitude]),le.getElement().addEventListener("click",Se=>{o.current.props.onClick?.({type:"click",target:le,originalEvent:Se})}),le.on("dragstart",Se=>{const Ne=Se;Ne.lngLat=c.getLngLat(),o.current.props.onDragStart?.(Ne)}),le.on("drag",Se=>{const Ne=Se;Ne.lngLat=c.getLngLat(),o.current.props.onDrag?.(Ne)}),le.on("dragend",Se=>{const Ne=Se;Ne.lngLat=c.getLngLat(),o.current.props.onDragEnd?.(Ne)}),le},[]);Ae.useEffect(()=>(c.addTo(t.getMap()),()=>{c.remove()}),[]);const{longitude:d,latitude:a,offset:v,style:A,draggable:P=!1,popup:k=null,rotation:L=0,rotationAlignment:z="auto",pitchAlignment:G="auto"}=n;Ae.useEffect(()=>{Mu(c.getElement(),A)},[A]),Ae.useImperativeHandle(e,()=>c,[]);const te=o.current.props;(c.getLngLat().lng!==d||c.getLngLat().lat!==a)&&c.setLngLat([d,a]),v&&!aL(c.getOffset(),v)&&c.setOffset(v),c.isDraggable()!==P&&c.setDraggable(P),c.getRotation()!==L&&c.setRotation(L),c.getRotationAlignment()!==z&&c.setRotationAlignment(z),c.getPitchAlignment()!==G&&c.setPitchAlignment(G),c.getPopup()!==k&&c.setPopup(k);const re=iE(te.className,n.className);if(re)for(const fe of re)c.toggleClassName(fe);return o.current.props=n,nA.createPortal(n.children,c.getElement())}));Ae.memo(Ae.forwardRef((n,e)=>{const{map:t,mapLib:r}=Ae.useContext(Sy),o=Ae.useMemo(()=>document.createElement("div"),[]),c=Ae.useRef({props:n}),d=Ae.useMemo(()=>{const a={...n},v=new r.Popup(a);return v.setLngLat([n.longitude,n.latitude]),v.once("open",A=>{c.current.props.onOpen?.(A)}),v},[]);if(Ae.useEffect(()=>{const a=v=>{c.current.props.onClose?.(v)};return d.on("close",a),d.setDOMContent(o).addTo(t.getMap()),()=>{d.off("close",a),d.isOpen()&&d.remove()}},[]),Ae.useEffect(()=>{Mu(d.getElement(),n.style)},[n.style]),Ae.useImperativeHandle(e,()=>d,[]),d.isOpen()){const a=c.current.props;(d.getLngLat().lng!==n.longitude||d.getLngLat().lat!==n.latitude)&&d.setLngLat([n.longitude,n.latitude]),n.offset&&!Tc(a.offset,n.offset)&&d.setOffset(n.offset),(a.anchor!==n.anchor||a.maxWidth!==n.maxWidth)&&(d.options.anchor=n.anchor,d.setMaxWidth(n.maxWidth));const v=iE(a.className,n.className);if(v)for(const A of v)d.toggleClassName(A);c.current.props=n}return nA.createPortal(n.children,o)}));function Hd(n,e,t,r){const o=Ae.useContext(Sy),c=Ae.useMemo(()=>n(o),[]);return Ae.useEffect(()=>{const d=e,a=null,v=typeof e=="function"?e:null,{map:A}=o;return A.hasControl(c)||(A.addControl(c,d?.position),a&&a(o)),()=>{v&&v(o),A.hasControl(c)&&A.removeControl(c)}},[]),c}function vL(n){const e=Hd(({mapLib:t})=>new t.AttributionControl(n),{position:n.position});return Ae.useEffect(()=>{Mu(e._container,n.style)},[n.style]),null}Ae.memo(vL);function xL(n){const e=Hd(({mapLib:t})=>new t.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return Ae.useEffect(()=>{Mu(e._controlContainer,n.style)},[n.style]),null}Ae.memo(xL);function bL(n,e){const t=Ae.useRef({props:n}),r=Hd(({mapLib:o})=>{const c=new o.GeolocateControl(n),d=c._setupUI;return c._setupUI=()=>{c._container.hasChildNodes()||d()},c.on("geolocate",a=>{t.current.props.onGeolocate?.(a)}),c.on("error",a=>{t.current.props.onError?.(a)}),c.on("outofmaxbounds",a=>{t.current.props.onOutOfMaxBounds?.(a)}),c.on("trackuserlocationstart",a=>{t.current.props.onTrackUserLocationStart?.(a)}),c.on("trackuserlocationend",a=>{t.current.props.onTrackUserLocationEnd?.(a)}),c},{position:n.position});return t.current.props=n,Ae.useImperativeHandle(e,()=>r,[]),Ae.useEffect(()=>{Mu(r._container,n.style)},[n.style]),null}Ae.memo(Ae.forwardRef(bL));function wL(n){const e=Hd(({mapLib:t})=>new t.NavigationControl(n),{position:n.position});return Ae.useEffect(()=>{Mu(e._container,n.style)},[n.style]),null}Ae.memo(wL);function TL(n){const e=Hd(({mapLib:c})=>new c.ScaleControl(n),{position:n.position}),t=Ae.useRef(n),r=t.current;t.current=n;const{style:o}=n;return n.maxWidth!==void 0&&n.maxWidth!==r.maxWidth&&(e.options.maxWidth=n.maxWidth),n.unit!==void 0&&n.unit!==r.unit&&e.setUnit(n.unit),Ae.useEffect(()=>{Mu(e._container,o)},[o]),null}Ae.memo(TL);function SL(n){const e=Hd(({mapLib:t})=>new t.TerrainControl(n),{position:n.position});return Ae.useEffect(()=>{Mu(e._container,n.style)},[n.style]),null}Ae.memo(SL);function AL(n){const e=Hd(({mapLib:t})=>new t.LogoControl(n),{position:n.position});return Ae.useEffect(()=>{Mu(e._container,n.style)},[n.style]),null}Ae.memo(AL);function H_(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const ob=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),CT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);CT&&parseFloat(CT[1]);const IT=globalThis,MT=globalThis.process||{},PL=globalThis.navigator||{};function sE(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Zd(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||sE()}function EL(n){return Zd()?sE()?"Electron":(PL.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const oE="4.1.0";function CL(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class IL{constructor(e,t,r="sessionStorage"){this.storage=CL(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function ML(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function RL(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var Z_;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Z_||(Z_={}));const kL=10;function RT(n){return typeof n!="string"?n:(n=n.toUpperCase(),Z_[n]||Z_.WHITE)}function DL(n,e,t){return!Zd&&typeof n=="string"&&(e&&(n=`\x1B[${RT(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${RT(t)+kL}m${n}\x1B[49m`)),n}function OL(n,e=["constructor"]){const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t),o=n;for(const c of r){const d=o[c];typeof d=="function"&&(e.find(a=>c===a)||(o[c]=d.bind(n)))}}function ab(n,e){if(!n)throw new Error("Assertion failed")}function Zf(){let n;if(Zd()&&IT.performance)n=IT?.performance?.now?.();else if("hrtime"in MT){const e=MT?.hrtime?.();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}const Xf={debug:Zd()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},LL={enabled:!0,level:0};function qf(){}const kT={},DT={once:!0};class pg{constructor({id:e}={id:""}){this.VERSION=oE,this._startTs=Zf(),this._deltaTs=Zf(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new IL(`__probe-${this.id}__`,LL),this.timeStamp(`${this.id} started`),OL(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Zf()-this._startTs).toPrecision(10))}getDelta(){return Number((Zf()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Xf.warn,arguments,DT)}error(e){return this._getLogFunction(0,e,Xf.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Xf.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Xf.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Xf.debug||Xf.info,arguments,DT)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||qf,r&&[r],{tag:NL(t)}):qf}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||qf)}group(e,t,r={collapsed:!1}){const o=OT({logLevel:e,message:t,opts:r}),{collapsed:c}=r;return o.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||qf)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=aE(e)}_getLogFunction(e,t,r,o,c){if(this._shouldLog(e)){c=OT({logLevel:e,message:t,args:o,opts:c}),r=r||c.method,ab(r),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=Zf();const d=c.tag||c.message;if(c.once&&d)if(!kT[d])kT[d]=Zf();else return qf;return t=FL(this.id,c.message,c),r.bind(console,t,...c.args)}return qf}}pg.VERSION=oE;function aE(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return ab(Number.isFinite(e)&&e>=0),e}function OT(n){const{logLevel:e,message:t}=n;n.logLevel=aE(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const o=typeof n.message;return ab(o==="string"||o==="object"),Object.assign(n,{args:r},n.opts)}function FL(n,e,t){if(typeof e=="string"){const r=t.time?RL(ML(t.total)):"";e=t.time?`${n}: ${r}  ${e}`:`${n}: ${e}`,e=DL(e,t.color,t.background)}return e}function NL(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const Dv="4.3.3",BL=Dv[0]>="0"&&Dv[0]<="9"?`v${Dv}`:"";function zL(){const n=new pg({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=BL,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const UL=zL();function VL(n,e){return lE(n||{},e)}function lE(n,e,t=0){if(t>3)return e;const r={...n};for(const[o,c]of Object.entries(e))c&&typeof c=="object"&&!Array.isArray(c)?r[o]=lE(r[o]||{},e[o],t+1):r[o]=e[o];return r}const jL="latest";function $L(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const WL=$L();function Ih(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Nd=typeof process!="object"||String(process)!=="[object process]"||process.browser,HL=typeof window<"u"&&typeof window.orientation<"u",LT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);LT&&parseFloat(LT[1]);class ZL{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((r,o)=>{this._resolve=r,this._reject=o})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Ih(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ih(this.isRunning),this.isRunning=!1,this._reject(e)}}class Ov{terminate(){}}const Lv=new Map;function XL(n){Ih(n.source&&!n.url||!n.source&&n.url);let e=Lv.get(n.source||n.url);return e||(n.url&&(e=qL(n.url),Lv.set(n.url,e)),n.source&&(e=cE(n.source),Lv.set(n.source,e))),Ih(e),e}function qL(n){if(!n.startsWith("http"))return n;const e=GL(n);return cE(e)}function cE(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function GL(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function uE(n,e=!0,t){const r=t||new Set;if(n){if(FT(n))r.add(n);else if(FT(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const o in n)uE(n[o],e,r)}}return t===void 0?Array.from(r):[]}function FT(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const Fv=()=>{};class V0{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Nd||typeof Ov<"u"&&!Nd}constructor(e){const{name:t,source:r,url:o}=e;Ih(r||o),this.name=t,this.source=r,this.url=o,this.onMessage=Fv,this.onError=c=>console.log(c),this.worker=Nd?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Fv,this.onError=Fv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||uE(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=XL({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Ov(r,{eval:!1})}else if(this.source)e=new Ov(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class YL{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return V0.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(o,c,d)=>o.done(d),r=(o,c)=>o.error(c)){const o=new Promise(c=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:c}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new ZL(t.name,e);e.onMessage=o=>t.onMessage(r,o.type,o.payload),e.onError=o=>t.onError(r,o),t.onStart(r);try{await r.result}catch(o){console.error(`Worker exception: ${o}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Nd||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new V0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return HL?this.maxMobileConcurrency:this.maxConcurrency}}const KL={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class yh{props;workerPools=new Map;static _workerFarm;static isSupported(){return V0.isSupported()}static getWorkerFarm(e={}){return yh._workerFarm=yh._workerFarm||new yh({}),yh._workerFarm.setProps(e),yh._workerFarm}constructor(e){this.props={...KL},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:o}=e;let c=this.workerPools.get(t);return c||(c=new YL({name:t,source:r,url:o}),c.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,c)),c}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function JL(n,e={}){const t=e[n.id]||{},r=Nd?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let o=t.workerUrl;if(!o&&n.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(Nd?o=`modules/${n.module}/dist/${r}`:o=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!o){let c=n.version;c==="latest"&&(c=jL);const d=c?`@${c}`:"";o=`https://unpkg.com/@loaders.gl/${n.module}${d}/dist/${r}`}return Ih(o),o}function QL(n,e=WL){Ih(n,"no worker provided");const t=n.version;return!(!e||!t)}function eF(n,e){return!yh.isSupported()||!Nd&&!e?._nodeWorkers?!1:n.worker&&e?.worker}async function tF(n,e,t,r,o){const c=n.id,d=JL(n,t),v=yh.getWorkerFarm(t).getWorkerPool({name:c,url:d});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const A=await v.startJob("process-on-worker",nF.bind(null,o));return A.postMessage("process",{input:e,options:t,context:r}),await(await A.result).result}async function nF(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:o,input:c,options:d}=r;try{const a=await n(c,d);e.postMessage("done",{id:o,result:a})}catch(a){const v=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:o,error:v})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function rF(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),o=new Uint8Array(e);for(let c=0;c<r.length;++c)if(r[c]!==o[c])return!1;return!0}function iF(...n){return sF(n)}function sF(n){const e=n.map(c=>c instanceof ArrayBuffer?new Uint8Array(c):c),t=e.reduce((c,d)=>c+d.byteLength,0),r=new Uint8Array(t);let o=0;for(const c of e)r.set(c,o),o+=c.byteLength;return r.buffer}async function oF(n){const e=[];for await(const t of n)e.push(t);return iF(...e)}function NT(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class BT{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=NT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(NT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Ay{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let o=this.stats[t];return o||(e instanceof BT?o=e:o=new BT(t,r),this.stats[t]=o),o}}let aF="";const zT={};function lF(n){for(const e in zT)if(n.startsWith(e)){const t=zT[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${aF}${n}`),n}function cF(n){return n&&typeof n=="object"&&n.isBuffer}function hE(n){if(cF(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function dE(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function uF(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const hF=n=>typeof n=="boolean",Vm=n=>typeof n=="function",mg=n=>n!==null&&typeof n=="object",UT=n=>mg(n)&&n.constructor==={}.constructor,dF=n=>!!n&&typeof n[Symbol.iterator]=="function",fF=n=>n&&typeof n[Symbol.asyncIterator]=="function",Xd=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,qd=n=>typeof Blob<"u"&&n instanceof Blob,pF=n=>n&&typeof n=="object"&&n.isBuffer,mF=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||mg(n)&&Vm(n.tee)&&Vm(n.cancel)&&Vm(n.getReader),gF=n=>mg(n)&&Vm(n.read)&&Vm(n.pipe)&&hF(n.readable),fE=n=>mF(n)||gF(n);class _F extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const yF=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,vF=/^([-\w.]+\/[-\w.+]+)/;function VT(n,e){return n.toLowerCase()===e.toLowerCase()}function xF(n){const e=vF.exec(n);return e?e[1]:n}function jT(n){const e=yF.exec(n);return e?e[1]:""}const pE=/\?.*/;function bF(n){const e=n.match(pE);return e&&e[0]}function lb(n){return n.replace(pE,"")}function wF(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Py(n){return Xd(n)?n.url:qd(n)?n.name||"":typeof n=="string"?n:""}function cb(n){if(Xd(n)){const e=n,t=e.headers.get("content-type")||"",r=lb(e.url);return xF(t)||jT(r)}return qd(n)?n.type||"":typeof n=="string"?jT(n):""}function TF(n){return Xd(n)?n.headers["content-length"]||-1:qd(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function mE(n){if(Xd(n))return n;const e={},t=TF(n);t>=0&&(e["content-length"]=String(t));const r=Py(n),o=cb(n);o&&(e["content-type"]=o);const c=await PF(n);c&&(e["x-first-bytes"]=c),typeof n=="string"&&(n=new TextEncoder().encode(n));const d=new Response(n,{headers:e});return Object.defineProperty(d,"url",{value:r}),d}async function SF(n){if(!n.ok)throw await AF(n)}async function AF(n){const e=wF(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const r={reason:n.statusText,url:n.url,response:n};try{const o=n.headers.get("Content-Type");r.reason=!n.bodyUsed&&o?.includes("application/json")?await n.json():await n.text()}catch{}return new _F(t,r)}async function PF(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const o=new FileReader;o.onload=c=>r(c?.target?.result),o.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${EF(t)}`}return null}function EF(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function CF(n){return!IF(n)&&!MF(n)}function IF(n){return n.startsWith("http:")||n.startsWith("https:")}function MF(n){return n.startsWith("data:")}async function $T(n,e){if(typeof n=="string"){const t=lF(n);return CF(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await mE(n)}const WT=new pg({id:"loaders.gl"});class RF{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class kF{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const gE={fetch:null,mimeType:void 0,nothrow:!1,log:new kF,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ob,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},DF={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function _E(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function yE(){const n=_E();return n.globalOptions=n.globalOptions||{...gE},n.globalOptions}function OF(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],LF(n,t),NF(e,n,r)}function LF(n,e){HT(n,null,gE,DF,e);for(const t of e){const r=n&&n[t.id]||{},o=t.options&&t.options[t.id]||{},c=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};HT(r,t.id,o,c,e)}}function HT(n,e,t,r,o){const c=e||"Top level",d=e?`${e}.`:"";for(const a in n){const v=!e&&mg(n[a]),A=a==="baseUri"&&!e,P=a==="workerUrl"&&e;if(!(a in t)&&!A&&!P){if(a in r)WT.warn(`${c} loader option '${d}${a}' no longer supported, use '${r[a]}'`)();else if(!v){const k=FF(a,o);WT.warn(`${c} loader option '${d}${a}' not recognized. ${k}`)()}}}}function FF(n,e){const t=n.toLowerCase();let r="";for(const o of e)for(const c in o.options){if(n===c)return`Did you mean '${o.id}.${c}'?`;const d=c.toLowerCase();(t.startsWith(d)||d.startsWith(t))&&(r=r||`Did you mean '${o.id}.${c}'?`)}return r}function NF(n,e,t){const o={...n.options||{}};return BF(o,t),o.log===null&&(o.log=new RF),ZT(o,yE()),ZT(o,e),o}function ZT(n,e){for(const t in e)if(t in e){const r=e[t];UT(r)&&UT(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function BF(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function ub(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function hb(n){H_(n,"null loader"),H_(ub(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const vE=()=>{const n=_E();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function zF(n){const e=vE();n=Array.isArray(n)?n:[n];for(const t of n){const r=hb(t);e.find(o=>r===o)||e.unshift(r)}}function UF(){return vE()}const VF=/\.([^.]+)$/;async function jF(n,e=[],t,r){if(!xE(n))return null;let o=XT(n,e,{...t,nothrow:!0},r);if(o)return o;if(qd(n)&&(n=await n.slice(0,10).arrayBuffer(),o=XT(n,e,t,r)),!o&&!t?.nothrow)throw new Error(bE(n));return o}function XT(n,e=[],t,r){if(!xE(n))return null;if(e&&!Array.isArray(e))return hb(e);let o=[];e&&(o=o.concat(e)),t?.ignoreRegisteredLoaders||o.push(...UF()),WF(o);const c=$F(n,o,t,r);if(!c&&!t?.nothrow)throw new Error(bE(n));return c}function $F(n,e,t,r){const o=Py(n),c=cb(n),d=lb(o)||r?.url;let a=null,v="";return t?.mimeType&&(a=Nv(e,t?.mimeType),v=`match forced by supplied MIME type ${t?.mimeType}`),a=a||HF(e,d),v=v||(a?`matched url ${d}`:""),a=a||Nv(e,c),v=v||(a?`matched MIME type ${c}`:""),a=a||XF(e,n),v=v||(a?`matched initial data ${wE(n)}`:""),t?.fallbackMimeType&&(a=a||Nv(e,t?.fallbackMimeType),v=v||(a?`matched fallback MIME type ${c}`:"")),v&&UL.log(1,`selectLoader selected ${a?.name}: ${v}.`),a}function xE(n){return!(n instanceof Response&&n.status===204)}function bE(n){const e=Py(n),t=cb(n);let r="No valid loader found (";r+=e?`${dE(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const o=n?wE(n):"";return r+=o?` first bytes: "${o}"`:"first bytes: not available",r+=")",r}function WF(n){for(const e of n)hb(e)}function HF(n,e){const t=e&&VF.exec(e),r=t&&t[1];return r?ZF(n,r):null}function ZF(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function Nv(n,e){for(const t of n)if(t.mimeTypes?.some(r=>VT(e,r))||VT(e,`application/x.${t.id}`))return t;return null}function XF(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(qF(e,t))return t}else if(ArrayBuffer.isView(e)){if(qT(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&qT(e,0,t))return t;return null}function qF(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function qT(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(o=>GF(n,e,t,o))}function GF(n,e,t,r){if(r instanceof ArrayBuffer)return rF(r,n,r.byteLength);switch(typeof r){case"function":return r(n);case"string":const o=j0(n,e,r.length);return r===o;default:return!1}}function wE(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?j0(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?j0(n,0,e):""}function j0(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let o="";for(let c=0;c<t;c++)o+=String.fromCharCode(r.getUint8(e+c));return o}const YF=256*1024;function*KF(n,e){const t=e?.chunkSize||YF;let r=0;const o=new TextEncoder;for(;r<n.length;){const c=Math.min(n.length-r,t),d=n.slice(r,r+c);r+=c,yield o.encode(d)}}const JF=256*1024;function*QF(n,e={}){const{chunkSize:t=JF}=e;let r=0;for(;r<n.byteLength;){const o=Math.min(n.byteLength-r,t),c=new ArrayBuffer(o),d=new Uint8Array(n,r,o);new Uint8Array(c).set(d),r+=o,yield c}}const eN=1024*1024;async function*tN(n,e){const t=e?.chunkSize||eN;let r=0;for(;r<n.size;){const o=r+t,c=await n.slice(r,o).arrayBuffer();r=o,yield c}}function GT(n,e){return ob?nN(n,e):rN(n)}async function*nN(n,e){const t=n.getReader();let r;try{for(;;){const o=r||t.read();e?._streamReadAhead&&(r=t.read());const{done:c,value:d}=await o;if(c)return;yield hE(d)}}catch{t.releaseLock()}}async function*rN(n,e){for await(const t of n)yield hE(t)}function iN(n,e){if(typeof n=="string")return KF(n,e);if(n instanceof ArrayBuffer)return QF(n,e);if(qd(n))return tN(n,e);if(fE(n))return GT(n,e);if(Xd(n))return GT(n.body,e);throw new Error("makeIterator")}const TE="Cannot convert supplied data type";function sN(n,e,t){if(e.text&&typeof n=="string")return n;if(pF(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const o=n.byteLength||n.length;return(n.byteOffset!==0||o!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+o)),r}throw new Error(TE)}async function oN(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return sN(n,e);if(qd(n)&&(n=await mE(n)),Xd(n)){const o=n;return await SF(o),e.binary?await o.arrayBuffer():await o.text()}if(fE(n)&&(n=iN(n,t)),dF(n)||fF(n))return oF(n);throw new Error(TE)}function SE(n,e){const t=yE(),r=n||t;return typeof r.fetch=="function"?r.fetch:mg(r.fetch)?o=>$T(o,r.fetch):e?.fetch?e?.fetch:$T}function aN(n,e,t){if(t)return t;const r={fetch:SE(e,n),...n};if(r.url){const o=lb(r.url);r.baseUrl=o,r.queryString=bF(r.url),r.filename=dE(o),r.baseUrl=uF(o)}return Array.isArray(r.loaders)||(r.loaders=null),r}function lN(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function X_(n,e,t,r){e&&!Array.isArray(e)&&!ub(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const o=Py(n),d=lN(e,r),a=await jF(n,d,t);return a?(t=OF(t,a,d,o),r=aN({url:o,_parse:X_,loaders:d},t,r||null),await cN(a,n,t,r)):null}async function cN(n,e,t,r){if(QL(n),t=VL(n.options,t),Xd(e)){const c=e,{ok:d,redirected:a,status:v,statusText:A,type:P,url:k}=c,L=Object.fromEntries(c.headers.entries());r.response={headers:L,ok:d,redirected:a,status:v,statusText:A,type:P,url:k}}e=await oN(e,n,t);const o=n;if(o.parseTextSync&&typeof e=="string")return o.parseTextSync(e,t,r);if(eF(n,t))return await tF(n,e,t,r,X_);if(o.parseText&&typeof e=="string")return await o.parseText(e,t,r);if(o.parse)return await o.parse(e,t,r);throw Ih(!o.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function q_(n,e,t,r){let o,c;!Array.isArray(e)&&!ub(e)?(o=[],c=e):(o=e,c=t);const d=SE(c);let a=n;return typeof n=="string"&&(a=await d(n)),qd(n)&&(a=await d(n)),Array.isArray(o)?await X_(a,o,c):await X_(a,o,c)}const uN="4.3.3",hN=globalThis.loaders?.parseImageNode,$0=typeof Image<"u",W0=typeof ImageBitmap<"u",dN=!!hN,H0=ob?!0:dN;function fN(n){switch(n){case"auto":return W0||$0||H0;case"imagebitmap":return W0;case"image":return $0;case"data":return H0;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function pN(){if(W0)return"imagebitmap";if($0)return"image";if(H0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function mN(n){const e=_N(n);if(!e)throw new Error("Not an image");return e}function gN(n){switch(mN(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function _N(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const yN=/^data:image\/svg\+xml/,vN=/\.svg((\?|#).*)?$/;function db(n){return n&&(yN.test(n)||vN.test(n))}function xN(n,e){if(db(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(c){throw new Error(c.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return AE(n,e)}function AE(n,e){if(db(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function PE(n,e,t){const r=xN(n,t),o=self.URL||self.webkitURL,c=typeof r!="string"&&o.createObjectURL(r);try{return await bN(c||r,e)}finally{c&&o.revokeObjectURL(c)}}async function bN(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,o)=>{try{t.onload=()=>r(t),t.onerror=c=>{const d=c instanceof Error?c.message:"error";o(new Error(d))}}catch(c){o(c)}})}const wN={};let YT=!0;async function TN(n,e,t){let r;db(t)?r=await PE(n,e,t):r=AE(n,t);const o=e&&e.imagebitmap;return await SN(r,o)}async function SN(n,e=null){if((AN(e)||!YT)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),YT=!1}return await createImageBitmap(n)}function AN(n){for(const e in n||wN)return!1;return!0}function PN(n){return!MN(n,"ftyp",4)||(n[8]&96)===0?null:EN(n)}function EN(n){switch(CN(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function CN(n,e,t){return String.fromCharCode(...n.slice(e,t))}function IN(n){return[...n].map(e=>e.charCodeAt(0))}function MN(n,e,t=0){const r=IN(e);for(let o=0;o<r.length;++o)if(r[o]!==n[o+t])return!1;return!0}const Sc=!1,jm=!0;function EE(n){const e=gg(n);return kN(e)||LN(e)||DN(e)||ON(e)||RN(e)}function RN(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=PN(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function kN(n){const e=gg(n);return e.byteLength>=24&&e.getUint32(0,Sc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Sc),height:e.getUint32(20,Sc)}:null}function DN(n){const e=gg(n);return e.byteLength>=10&&e.getUint32(0,Sc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,jm),height:e.getUint16(8,jm)}:null}function ON(n){const e=gg(n);return e.byteLength>=14&&e.getUint16(0,Sc)===16973&&e.getUint32(2,jm)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,jm),height:e.getUint32(22,jm)}:null}function LN(n){const e=gg(n);if(!(e.byteLength>=3&&e.getUint16(0,Sc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:o}=FN();let c=2;for(;c+9<e.byteLength;){const d=e.getUint16(c,Sc);if(o.has(d))return{mimeType:"image/jpeg",height:e.getUint16(c+5,Sc),width:e.getUint16(c+7,Sc)};if(!r.has(d))return null;c+=2,c+=e.getUint16(c,Sc)}return null}function FN(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function gg(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function NN(n,e){const{mimeType:t}=EE(n)||{},r=globalThis.loaders?.parseImageNode;return H_(r),await r(n,t)}async function BN(n,e,t){e=e||{};const o=(e.image||{}).type||"auto",{url:c}=t||{},d=zN(o);let a;switch(d){case"imagebitmap":a=await TN(n,e,c);break;case"image":a=await PE(n,e,c);break;case"data":a=await NN(n);break;default:H_(!1)}return o==="data"&&(a=gN(a)),a}function zN(n){switch(n){case"auto":case"data":return pN();default:return fN(n),n}}const UN=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],VN=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],jN={image:{type:"auto",decode:!0}},$N={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:uN,mimeTypes:VN,extensions:UN,parse:BN,tests:[n=>!!EE(new DataView(n))],options:jN},_r=new pg({id:"deck"});let Z0={};function WN(n){Z0=n}function Bs(n,e,t,r){_r.level>0&&Z0[n]&&Z0[n].call(null,e,t,r)}function HN(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const ZN={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:HN,parseTextSync:JSON.parse};function XN(){const n="9.1.15",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(_r.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:_r,_registerLoggers:WN},zF([ZN,[$N,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const qN=XN();function fb(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const Bv={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function GN(n){const e={};for(const[t,r]of Object.entries(n))e[t]=YN(r);return e}function YN(n){let e=KT(n);if(e!=="object")return{value:n,...Bv[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...Bv[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=KT(n.value),{...n,...Bv[e],type:e}):{type:"object",value:null};throw new Error("props")}function KT(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const KN=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,JN=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,QN={vertex:KN,fragment:JN},JT=/void\s+main\s*\([^)]*\)\s*\{\n?/,QT=/}\n?[^{}]*$/,zv=[],I_="__LUMA_INJECT_DECLARATIONS__";function eB(n){const e={vertex:{},fragment:{}};for(const t in n){let r=n[t];const o=tB(t);typeof r=="string"&&(r={order:0,injection:r}),e[o][t]=r}return e}function tB(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function G_(n,e,t,r=!1){const o=e==="vertex";for(const c in t){const d=t[c];d.sort((v,A)=>v.order-A.order),zv.length=d.length;for(let v=0,A=d.length;v<A;++v)zv[v]=d[v].injection;const a=`${zv.join(`
`)}
`;switch(c){case"vs:#decl":o&&(n=n.replace(I_,a));break;case"vs:#main-start":o&&(n=n.replace(JT,v=>v+a));break;case"vs:#main-end":o&&(n=n.replace(QT,v=>a+v));break;case"fs:#decl":o||(n=n.replace(I_,a));break;case"fs:#main-start":o||(n=n.replace(JT,v=>v+a));break;case"fs:#main-end":o||(n=n.replace(QT,v=>a+v));break;default:n=n.replace(c,v=>v+a)}}return n=n.replace(I_,""),r&&(n=n.replace(/\}\s*$/,c=>c+QN[e])),n}function Y_(n){n.map(e=>nB(e))}function nB(n){if(n.instance)return;Y_(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:r={}}=n,o={normalizedInjections:eB(r),parsedDeprecations:rB(t)};e&&(o.propValidators=GN(e)),n.instance=o;let c={};e&&(c=Object.entries(e).reduce((d,[a,v])=>{const A=v?.value;return A&&(d[a]=A),d},{})),n.defaultUniforms={...n.defaultUniforms,...c}}function CE(n,e,t){n.deprecations?.forEach(r=>{r.regex?.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}function rB(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function pb(n){Y_(n);const e={},t={};IE({modules:n,level:0,moduleMap:e,moduleDepth:t});const r=Object.keys(t).sort((o,c)=>t[c]-t[o]).map(o=>e[o]);return Y_(r),r}function IE(n){const{modules:e,level:t,moduleMap:r,moduleDepth:o}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const c of e)r[c.name]=c,(o[c.name]===void 0||o[c.name]<t)&&(o[c.name]=t);for(const c of e)c.dependencies&&IE({modules:c.dependencies,level:t+1,moduleMap:r,moduleDepth:o})}function iB(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function sB(n,e){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=e2(n,oB),n;case"fragment":return n=e2(n,aB),n;default:throw new Error(e)}}const ME=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],oB=[...ME,[X0("attribute"),"in $1"],[X0("varying"),"out $1"]],aB=[...ME,[X0("varying"),"in $1"]];function e2(n,e){for(const[t,r]of e)n=n.replace(t,r);return n}function X0(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function RE(n,e){let t="";for(const r in n){const o=n[r];if(t+=`void ${o.signature} {
`,o.header&&(t+=`  ${o.header}`),e[r]){const c=e[r];c.sort((d,a)=>d.order-a.order);for(const d of c)t+=`  ${d.injection}
`}o.footer&&(t+=`  ${o.footer}`),t+=`}
`}return t}function kE(n){const e={vertex:{},fragment:{}};for(const t of n){let r,o;typeof t!="string"?(r=t,o=r.hook):(r={},o=t),o=o.trim();const[c,d]=o.split(":"),a=o.replace(/\(.+/,""),v=Object.assign(r,{signature:d});switch(c){case"vs":e.vertex[a]=v;break;case"fs":e.fragment[a]=v;break;default:throw new Error(c)}}return e}function lB(n,e){return{name:cB(n,e),language:"glsl",version:uB(n)}}function cB(n,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return r?r[1]:e}function uB(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const DE=`

${I_}
`,hB=`precision highp float;
`;function dB(n){const e=pb(n.modules||[]);return{source:pB(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:OE(e)}}function fB(n){const{vs:e,fs:t}=n,r=pb(n.modules||[]);return{vs:t2(n.platformInfo,{...n,source:e,stage:"vertex",modules:r}),fs:t2(n.platformInfo,{...n,source:t,stage:"fragment",modules:r}),getUniforms:OE(r)}}function pB(n,e){const{source:t,stage:r,modules:o,hookFunctions:c=[],inject:d={},log:a}=e;fb(typeof t=="string","shader source must be a string");const v=t;let A="";const P=kE(c),k={},L={},z={};for(const te in d){const re=typeof d[te]=="string"?{injection:d[te],order:0}:d[te],fe=/^(v|f)s:(#)?([\w-]+)$/.exec(te);if(fe){const ve=fe[2],le=fe[3];ve?le==="decl"?L[te]=[re]:z[te]=[re]:k[te]=[re]}else z[te]=[re]}const G=o;for(const te of G){a&&CE(te,v,a);const re=LE(te,"wgsl");A+=re;const fe=te.injections?.[r]||{};for(const ve in fe){const le=/^(v|f)s:#([\w-]+)$/.exec(ve);if(le){const Ne=le[2]==="decl"?L:z;Ne[ve]=Ne[ve]||[],Ne[ve].push(fe[ve])}else k[ve]=k[ve]||[],k[ve].push(fe[ve])}}return A+=DE,A=G_(A,r,L),A+=RE(P[r],k),A+=v,A=G_(A,r,z),A}function t2(n,e){const{id:t,source:r,stage:o,language:c="glsl",modules:d,defines:a={},hookFunctions:v=[],inject:A={},prologue:P=!0,log:k}=e;fb(typeof r=="string","shader source must be a string");const L=c==="glsl"?lB(r).version:-1,z=n.shaderLanguageVersion,G=L===100?"#version 100":"#version 300 es",re=r.split(`
`).slice(1).join(`
`),fe={};d.forEach(pt=>{Object.assign(fe,pt.defines)}),Object.assign(fe,a);let ve="";switch(c){case"wgsl":break;case"glsl":ve=P?`${G}

// ----- PROLOGUE -------------------------
${mB({id:t,source:r,stage:o})}
${`#define SHADER_TYPE_${o.toUpperCase()}`}

${iB(n)}
${o==="fragment"?hB:""}

// ----- APPLICATION DEFINES -------------------------

${gB(fe)}

`:`${G}
`;break}const le=kE(v),Se={},Ne={},nt={};for(const pt in A){const mt=typeof A[pt]=="string"?{injection:A[pt],order:0}:A[pt],Tt=/^(v|f)s:(#)?([\w-]+)$/.exec(pt);if(Tt){const Mt=Tt[2],Zt=Tt[3];Mt?Zt==="decl"?Ne[pt]=[mt]:nt[pt]=[mt]:Se[pt]=[mt]}else nt[pt]=[mt]}for(const pt of d){k&&CE(pt,re,k);const mt=LE(pt,o);ve+=mt;const Tt=pt.instance?.normalizedInjections[o]||{};for(const Mt in Tt){const Zt=/^(v|f)s:#([\w-]+)$/.exec(Mt);if(Zt){const on=Zt[2]==="decl"?Ne:nt;on[Mt]=on[Mt]||[],on[Mt].push(Tt[Mt])}else Se[Mt]=Se[Mt]||[],Se[Mt].push(Tt[Mt])}}return ve+="// ----- MAIN SHADER SOURCE -------------------------",ve+=DE,ve=G_(ve,o,Ne),ve+=RE(le[o],Se),ve+=re,ve=G_(ve,o,nt),c==="glsl"&&L!==z&&(ve=sB(ve,o)),ve.trim()}function OE(n){return function(t){const r={};for(const o of n){const c=o.getUniforms?.(t,r);Object.assign(r,c)}return r}}function mB(n){const{id:e,source:t,stage:r}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function gB(n={}){let e="";for(const t in n){const r=n[t];(r||Number.isFinite(r))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function LE(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:fb(!1)}if(!n.name)throw new Error("Shader module must have a name");const r=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let o=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(o+=`#define MODULE_${r}
`),o+=`${t}
`,o}const _B=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,yB=/^\s*\#\s*endif\s*$/;function vB(n,e){const t=n.split(`
`),r=[];let o=!0,c=null;for(const d of t){const a=d.match(_B),v=d.match(yB);a?(c=a[1],o=!!e?.defines?.[c]):v?o=!0:o&&r.push(d)}return r.join(`
`)}class Rd{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Rd.defaultShaderAssembler=Rd.defaultShaderAssembler||new Rd,Rd.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),r=this._hookFunctions,{source:o,getUniforms:c}=dB({...e,source:e.source,modules:t,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?vB(o):o,getUniforms:c,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),r=this._hookFunctions;return{...fB({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let o=0;for(let c=0,d=this._defaultModules.length;c<d;++c){const a=this._defaultModules[c],v=a.name;t[o++]=a,r[v]=!0}for(let c=0,d=e.length;c<d;++c){const a=e[c],v=a.name;r[v]||(t[o++]=a,r[v]=!0)}return t.length=o,Y_(t),t}}const xB=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,bB=`#version 300 es
${xB}`;function FE(n){const{input:e,inputChannels:t,output:r}=n||{};if(!e)return bB;if(!t)throw new Error("inputChannels");const o=wB(t),c=TB(e,t);return`#version 300 es
in ${o} ${e};
out vec4 ${r};
void main() {
  ${r} = ${c};
}`}function wB(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function TB(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class SB{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Ay({id:e})),this.stats.get(e)}}const NE=new SB,Lt=new pg({id:"luma.gl"}),Uv={};function Ey(n="id"){Uv[n]=Uv[n]||1;const e=Uv[n]++;return`${n}-${e}`}let wr=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,r){if(!e)throw new Error("no device");this._device=e,this.props=AB(t,r);const o=this.props.id!=="undefined"?this.props.id:Ey(this[Symbol.toStringTag]);this.props.id=o,this.id=o,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function AB(n,e){const t={...e};for(const r in n)n[r]!==void 0&&(t[r]=n[r]);return t}class Ar extends wr{static defaultProps={...wr.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const r={...t};(t.usage||0)&Ar.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data,super(e,r,Ar.defaultProps),this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,t){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,r){const o=ArrayBuffer.isView(e)?e.buffer:e,c=Math.min(e?e.byteLength:r,Ar.DEBUG_DATA_MAX_LENGTH);o===null?this.debugData=new ArrayBuffer(c):t===0&&r===o.byteLength?this.debugData=o.slice(0,c):this.debugData=o.slice(t,t+c)}}function BE(n){const e=n2[n],t=PB(e),r=n.includes("norm"),o=!r&&!n.startsWith("float"),c=n.startsWith("s");return{dataType:n2[n],byteLength:t,integer:o,signed:c,normalized:r}}function PB(n){return EB[n]}const n2={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},EB={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Ls="texture-compression-bc",xr="texture-compression-astc",xc="texture-compression-etc2",CB="texture-compression-etc1-webgl",i_="texture-compression-pvrtc-webgl",Vv="texture-compression-atc-webgl",s_="float32-renderable-webgl",jv="float16-renderable-webgl",IB="rgb9e5ufloat-renderable-webgl",$v="snorm8-renderable-webgl",Am="norm16-renderable-webgl",Wv="snorm16-renderable-webgl",o_="float32-filterable",r2="float16-filterable-webgl";function zE(n){const e=MB[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const MB={r8unorm:{},r8snorm:{render:$v},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:$v},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:jv,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Am},"r16snorm-webgl":{f:Wv},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:$v},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:jv,filter:r2},"rg16unorm-webgl":{render:Am},"rg16snorm-webgl":{render:Wv},r32uint:{},r32sint:{},r32float:{render:s_,filter:o_},rgb9e5ufloat:{channels:"rgb",packed:!0,render:IB},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:s_},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Am},"rgb16snorm-webgl":{f:Am},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:o_},rgba16uint:{},rgba16sint:{},rgba16float:{render:jv,filter:r2},"rgba16unorm-webgl":{render:Am},"rgba16snorm-webgl":{render:Wv},"rgb32float-webgl":{render:s_,filter:o_},rgba32uint:{},rgba32sint:{},rgba32float:{render:s_,filter:o_},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Ls},"bc1-rgb-unorm-srgb-webgl":{f:Ls},"bc1-rgba-unorm":{f:Ls},"bc1-rgba-unorm-srgb":{f:Ls},"bc2-rgba-unorm":{f:Ls},"bc2-rgba-unorm-srgb":{f:Ls},"bc3-rgba-unorm":{f:Ls},"bc3-rgba-unorm-srgb":{f:Ls},"bc4-r-unorm":{f:Ls},"bc4-r-snorm":{f:Ls},"bc5-rg-unorm":{f:Ls},"bc5-rg-snorm":{f:Ls},"bc6h-rgb-ufloat":{f:Ls},"bc6h-rgb-float":{f:Ls},"bc7-rgba-unorm":{f:Ls},"bc7-rgba-unorm-srgb":{f:Ls},"etc2-rgb8unorm":{f:xc},"etc2-rgb8unorm-srgb":{f:xc},"etc2-rgb8a1unorm":{f:xc},"etc2-rgb8a1unorm-srgb":{f:xc},"etc2-rgba8unorm":{f:xc},"etc2-rgba8unorm-srgb":{f:xc},"eac-r11unorm":{f:xc},"eac-r11snorm":{f:xc},"eac-rg11unorm":{f:xc},"eac-rg11snorm":{f:xc},"astc-4x4-unorm":{f:xr},"astc-4x4-unorm-srgb":{f:xr},"astc-5x4-unorm":{f:xr},"astc-5x4-unorm-srgb":{f:xr},"astc-5x5-unorm":{f:xr},"astc-5x5-unorm-srgb":{f:xr},"astc-6x5-unorm":{f:xr},"astc-6x5-unorm-srgb":{f:xr},"astc-6x6-unorm":{f:xr},"astc-6x6-unorm-srgb":{f:xr},"astc-8x5-unorm":{f:xr},"astc-8x5-unorm-srgb":{f:xr},"astc-8x6-unorm":{f:xr},"astc-8x6-unorm-srgb":{f:xr},"astc-8x8-unorm":{f:xr},"astc-8x8-unorm-srgb":{f:xr},"astc-10x5-unorm":{f:xr},"astc-10x5-unorm-srgb":{f:xr},"astc-10x6-unorm":{f:xr},"astc-10x6-unorm-srgb":{f:xr},"astc-10x8-unorm":{f:xr},"astc-10x8-unorm-srgb":{f:xr},"astc-10x10-unorm":{f:xr},"astc-10x10-unorm-srgb":{f:xr},"astc-12x10-unorm":{f:xr},"astc-12x10-unorm-srgb":{f:xr},"astc-12x12-unorm":{f:xr},"astc-12x12-unorm-srgb":{f:xr},"pvrtc-rgb4unorm-webgl":{f:i_},"pvrtc-rgba4unorm-webgl":{f:i_},"pvrtc-rbg2unorm-webgl":{f:i_},"pvrtc-rgba2unorm-webgl":{f:i_},"etc1-rbg-unorm-webgl":{f:CB},"atc-rgb-unorm-webgl":{f:Vv},"atc-rgba-unorm-webgl":{f:Vv},"atc-rgbai-unorm-webgl":{f:Vv}},RB=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],kB=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function UE(n){return RB.some(e=>n.startsWith(e))}function mb(n){let e=DB(n);if(UE(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=OB(n);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const t=kB.exec(n);if(t){const[,r,o,c,d,a]=t,v=`${c}${o}`,A=BE(v),P=A.byteLength*8,k=r.length,L=[P,k>=2?P:0,k>=3?P:0,k>=4?P:0];e={format:n,attachment:e.attachment,dataType:A.dataType,components:k,channels:r,integer:A.integer,signed:A.signed,normalized:A.normalized,bitsPerChannel:L,bytesPerPixel:A.byteLength*r.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),d==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function DB(n){const e=zE(n),t=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function OB(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,r,o]=t;return{blockWidth:Number(r),blockHeight:Number(o)}}return null}function LB(n){const e=zE(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=mb(n),o=n.startsWith("depth")||n.startsWith("stencil"),c=r?.signed,d=r?.integer,a=r?.webgl;return t.render&&=!c,t.filter&&=!o&&!c&&!d&&!a,t}class FB{}class NB{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Sh{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Lt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Lt.get("debug")||void 0,debugShaders:Lt.get("debug-shaders")||void 0,debugFramebuffers:!!Lt.get("debug-framebuffers"),debugWebGL:!!Lt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...Sh.defaultProps,...e},this.id=this.props.id||Ey(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=NE;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const t=LB(e),r=d=>(typeof d=="string"?this.features.has(d):d)??!0,o=r(t.create),c={format:e,create:o,render:o&&r(t.render),filter:o&&r(t.filter),blend:o&&r(t.blend),store:o&&r(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(c)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return UE(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Ar.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":Lt.warn("indices buffer content must be of integer type")()),t}}const BB=Zd()&&typeof document<"u",zB=()=>BB&&document.readyState==="complete",UB="set luma.log.level=1 (or higher) to trace rendering",i2="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class ip{static defaultProps={...Sh.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=VB().then(()=>{Lt.probe(2,"DOM is loaded")()});stats=NE;log=Lt;VERSION="9.1.10";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Lt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Lt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Lt.error("This version of luma.gl has already been initialized")()}Lt.log(1,`${this.VERSION} - ${UB}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,r])=>r).filter(r=>r.isSupported?.()).map(r=>r.type)}getBestAvailableAdapter(e=[]){const t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(ip.defaultProps,e)}async createDevice(e={}){e={...ip.defaultProps,...e},e.waitForPageLoad&&await ip.pageLoaded;const t=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const d=await(this.getAdapterMap(e.adapters)||t).get(r)?.create?.(e);if(d)return d;throw new Error(i2)}async attachDevice(e){const t=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await ip.pageLoaded,e.handle===null&&(r="unknown");const c=await t.get(r)?.attach?.(null);if(c)return c;throw new Error(i2)}enforceWebGL2(e=!0,t=[]){const o=this.getAdapterMap(t).get("webgl");o||Lt.warn("enforceWebGL2: webgl adapter not found")(),o?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const r of e)t.set(r.type,r);return t}registerDevices(e){Lt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const r=t.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}}const q0=new ip;function VB(){return zB()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class jB{}class gb{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...gb.defaultProps,...e},e=this.props,!Zd()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=WB(e.canvas):this.canvas=e.canvas;else{const t=HB(e),r=$B(e?.container||null);r.insertBefore(t,r.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const r of t)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){const r=this.cssToDeviceRatio(),[o,c]=this.getDrawingBufferSize();return ZB(e,r,o,c,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let r="width"in t?t.width:this.htmlCanvas.clientWidth,o="height"in t?t.height:this.htmlCanvas.clientHeight;(!r||!o)&&(Lt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,o=this.htmlCanvas.height||1);const c=this._canvasSizeInfo;if(c.clientWidth!==r||c.clientHeight!==o||c.devicePixelRatio!==e){let d=e;const a=Math.floor(r*d),v=Math.floor(o*d);if(this.htmlCanvas.width=a,this.htmlCanvas.height=v,this.device.gl){const[P,k]=this.getDrawingBufferSize();(P!==a||k!==v)&&(d=Math.min(P/r,k/o),this.htmlCanvas.width=Math.floor(r*d),this.htmlCanvas.height=Math.floor(o*d),Lt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=o,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function $B(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function WB(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function HB(n){const{width:e,height:t}=n,r=document.createElement("canvas");return r.id=Ey("lumagl-auto-created-canvas"),r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",r}function ZB(n,e,t,r,o){const c=n,d=s2(c[0],e,t);let a=o2(c[1],e,r,o),v=s2(c[0]+1,e,t);const A=v===t-1?v:v-1;v=o2(c[1]+1,e,r,o);let P;return o?(v=v===0?v:v+1,P=a,a=v):P=v===r-1?v:v-1,{x:d,y:a,width:Math.max(A-d+1,1),height:Math.max(P-a+1,1)}}function s2(n,e,t){return Math.min(Math.round(n*e),t-1)}function o2(n,e,t,r){return r?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}class br extends wr{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...wr.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,t){if(t=br.normalizeProps(e,t),super(e,t,br.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const r=br.getTextureDataSize(this.props.data);this.width=r?.width||1,this.height=r?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?br.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return br.getTextureDataSize(e[0]);if(br.isExternalImage(e))return br.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const r=Object.values(e)[0];return{width:r.width,height:r.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,t){let r;return ArrayBuffer.isView(e)?r=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?r=e:r=[e],r}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,t){const r={...t},o=e?.props?._resourceDefaults?.texture||{};Object.assign(r,o);const{width:c,height:d}=r;return typeof c=="number"&&(r.width=Math.max(1,Math.ceil(c))),typeof d=="number"&&(r.height=Math.max(1,Math.ceil(d))),r}}class Cy extends wr{static defaultProps={...wr.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Cy.defaultProps)}}function XB(n,e,t){let r="";const o=e.split(/\r?\n/),c=n.slice().sort((d,a)=>d.lineNum-a.lineNum);switch(t?.showSourceCode||"no"){case"all":let d=0;for(let a=1;a<=o.length;a++)for(r+=VE(o[a-1],a,t);c.length>d&&c[d].lineNum===a;){const v=c[d++];r+=a2(v,o,v.lineNum,{...t,inlineSource:!1})}return r;case"issues":case"no":for(const a of n)r+=a2(a,o,a.lineNum,{inlineSource:t?.showSourceCode!=="no"});return r}}function a2(n,e,t,r){if(r?.inlineSource){const c=qB(e,t),d=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${c}${d}${n.type.toUpperCase()}: ${n.message}

`}const o=n.type==="error"?"red":"#8B4000";return r?.html?`<div class='luma-compiler-log-error' style="color:${o};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function qB(n,e,t){let r="";for(let o=e-2;o<=e;o++){const c=n[o-1];c!==void 0&&(r+=VE(c,e,t))}return r}function VE(n,e,t){const r=t?.html?YB(n):n;return`${GB(String(e),4)}: ${r}${t?.html?"<br/>":`
`}`}function GB(n,e){let t="";for(let r=n.length;r<e;++r)t+=" ";return t+n}function YB(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Iy extends wr{static defaultProps={...wr.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:KB(t),...t},Iy.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const t=jE(this.source),r=`${this.stage} ${t}`;let o=XB(e,this.source,{showSourceCode:"all",html:!0});const c=this.getTranslatedSource();c&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${c}</pre></code>`);const d=document.createElement("Button");d.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,d.style.top="10px",d.style.left="10px",d.style.position="absolute",d.style.zIndex="9999",d.style.width="100%",d.style.textAlign="left",document.body.appendChild(d),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),d.onclick=()=>{const v=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(v)}}}function KB(n){return jE(n.source)||n.id||Ey(`unnamed ${n.stage}-shader`)}function jE(n,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return r?r[1]:e}class ng extends wr{static defaultProps={...wr.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=ng.normalizeProps(e,t),super(e,t,ng.defaultProps)}static normalizeProps(e,t){const r=e?.props?._resourceDefaults?.sampler||{};return{...t,...r}}}class My extends wr{static defaultProps={...wr.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,My.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(o=>o.texture.clone(e)),r=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:r})}resize(e){let t=!e;if(e){const[r,o]=Array.isArray(e)?e:[e.width,e.height];t=t||o!==this.height||r!==this.width,this.width=r,this.height=o}t&&(Lt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,r)=>{if(typeof t=="string"){const o=this.createColorTexture(t,r);return this.attachResource(o),o.view}return t instanceof br?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof br?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:br.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:br.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const o=this.colorAttachments[r].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=o.view,this.attachResource(o.view)}if(this.depthStencilAttachment){const r=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}this.updateAttachments()}}class _p extends wr{static defaultProps={...wr.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,_p.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class Cd extends wr{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...wr.defaultProps,framebuffer:null,parameters:void 0,clearColor:Cd.defaultClearColor,clearColors:void 0,clearDepth:Cd.defaultClearDepth,clearStencil:Cd.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Cd.normalizeProps(e,t),super(e,t,Cd.defaultProps)}static normalizeProps(e,t){return{...e.props._resourceDefaults?.renderPass,...t}}}class K_ extends wr{static defaultProps={...wr.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,K_.defaultProps),this.shaderLayout=t.shaderLayout}}class _b extends wr{static defaultProps={...wr.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,_b.defaultProps)}}class yb extends wr{static defaultProps={...wr.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,yb.defaultProps)}}function JB(n){const[e,t]=ez[n],r=e==="i32"||e==="u32",o=e!=="u32",c=tz[e]*t,d=QB(e,t);return{dataType:e,components:t,defaultVertexFormat:d,byteLength:c,integer:r,signed:o}}function QB(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const ez={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},tz={f32:4,f16:2,i32:4,u32:4};function $E(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,r]=n.split("x"),o=t,c=r?parseInt(r):1,d=BE(o),a={type:o,components:c,byteLength:d.byteLength*c,integer:d.integer,signed:d.signed,normalized:d.normalized};return e&&(a.webglOnly=!0),a}function WE(n,e){const t={};for(const r of n.attributes){const o=rz(n,e,r.name);o&&(t[r.name]=o)}return t}function nz(n,e,t=16){const r=WE(n,e),o=new Array(t).fill(null);for(const c of Object.values(r))o[c.location]=c;return o}function rz(n,e,t){const r=iz(n,t),o=sz(e,t);if(!r)return null;const c=JB(r.type),d=o?.vertexFormat||c.defaultVertexFormat,a=$E(d);return{attributeName:o?.attributeName||r.name,bufferName:o?.bufferName||r.name,location:r.location,shaderType:r.type,shaderDataType:c.dataType,shaderComponents:c.components,vertexFormat:d,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:c.integer,stepMode:o?.stepMode||r.stepMode||"vertex",byteOffset:o?.byteOffset||0,byteStride:o?.byteStride||0}}function iz(n,e){const t=n.attributes.find(r=>r.name===e);return t||Lt.warn(`shader layout attribute "${e}" not present in shader`),t||null}function sz(n,e){oz(n);let t=az(n,e);return t||(t=lz(n,e),t)?t:(Lt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function oz(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&Lt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function az(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function lz(n,e){for(const t of n){let r=t.byteStride;if(typeof t.byteStride!="number")for(const c of t.attributes||[]){const d=$E(c.format);r+=d.byteLength}const o=t.attributes?.find(c=>c.attribute===e);if(o)return{attributeName:o.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:o.format,byteOffset:o.byteOffset,byteStride:r}}return null}class vb extends wr{static defaultProps={...wr.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,vb.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:r,bufferLayout:o}=t.renderPipeline||{};if(!r||!o)throw new Error("VertexArray");this.attributeInfos=nz(r,o,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"))}}class xb extends wr{static defaultProps={...wr.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,xb.defaultProps)}}class bb extends wr{static defaultProps={...wr.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,bb.defaultProps)}}const cz={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function uz(n){return cz[n]}function hz(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let a_;function HE(n){return(!a_||a_.byteLength<n)&&(a_=new ArrayBuffer(n)),a_}function dz(n,e){const t=HE(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function fz(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function J_(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":fz(n)}const l2=1024;class pz{layout={};byteLength;constructor(e){let t=0;for(const[o,c]of Object.entries(e)){const d=uz(c),{type:a,components:v}=d;t=hz(t,v);const A=t;t+=v,this.layout[o]={type:a,size:v,offset:A}}t+=(4-t%4)%4;const r=t*4;this.byteLength=Math.max(r,l2)}getData(e){const t=Math.max(this.byteLength,l2),r=HE(t),o={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[c,d]of Object.entries(e)){const a=this.layout[c];if(!a){Lt.warn(`Supplied uniform value ${c} not present in uniform block layout`)();continue}const{type:v,size:A,offset:P}=a,k=o[v];if(A===1){if(typeof d!="number"&&typeof d!="boolean"){Lt.warn(`Supplied value for single component uniform ${c} is not a number: ${d}`)();continue}k[P]=Number(d)}else{if(!J_(d)){Lt.warn(`Supplied value for multi component / array uniform ${c} is not a numeric array: ${d}`)();continue}k.set(d,P)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function mz(n,e,t=16){if(n!==e)return!1;const r=n,o=e;if(!J_(r))return!1;if(J_(o)&&r.length===o.length){for(let c=0;c<r.length;++c)if(o[c]!==r[c])return!1}return!0}function gz(n){return J_(n)?n.slice():n}class _z{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(o=>o.type==="uniform"&&o.name===e?.name);if(!t)throw new Error(e?.name);const r=t;for(const o of r.uniforms||[])this.bindingLayout[o.name]=o}}setUniforms(e){for(const[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){mz(this.uniforms[e],t)||(this.uniforms[e]=gz(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class yz{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,r]of Object.entries(e)){const o=t,c=new pz(r.uniformTypes||{});this.uniformBufferLayouts.set(o,c);const d=new _z({name:t});d.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(o,d)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,r]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);const o=this.getUniformBufferByteLength(t),c=e.createBuffer({usage:Ar.UNIFORM|Ar.COPY_DST,byteLength:o}),d=this.getUniformBufferData(t);return c.write(d),c}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const r=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:Ar.UNIFORM|Ar.COPY_DST,byteLength:r});this.uniformBuffers.set(t,o)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(t);e||=r}return e&&Lt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),o=!1;if(r&&t?.needsRedraw){o||=t.needsRedraw;const c=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r?.write(c);const d=this.uniformBlocks.get(e)?.getAllUniforms();Lt.log(4,`Writing to uniform buffer ${String(e)}`,c,d)()}return o}}function ZE(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function XE(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function vz(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let o=ZE(n);if(o==="uint8"&&t&&r===1)return"unorm8-webgl";if(o==="uint8"&&t&&r===3)return"unorm8x3-webgl";if(o==="uint8"||o==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(o=o.replace("int","norm")),`${o}x${r}`}if(o==="uint16"||o==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(o=o.replace("int","norm")),`${o}x${r}`}return r===1?o:`${o}x${r}`}class Hv{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const r=[...e];for(const o of t){const c=r.findIndex(d=>d.name===o.name);c<0?r.push(o):r[c]=o}return r}getBufferIndex(e){const t=this.bufferLayouts.findIndex(r=>r.name===e);return t===-1&&Lt.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function xz(n,e){const t=Object.fromEntries(n.attributes.map(o=>[o.name,o.location])),r=e.slice();return r.sort((o,c)=>{const d=o.attributes?o.attributes.map(P=>P.attribute):[o.name],a=c.attributes?c.attributes.map(P=>P.attribute):[c.name],v=Math.min(...d.map(P=>t[P])),A=Math.min(...a.map(P=>t[P]));return v-A}),r}class Ra{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class c2{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class xh extends Ra{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Ah extends Ra{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class G0 extends Ra{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Vd extends Ra{constructor(e,t,r,o){super(e,r),this.format=t,this.access=o}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var _h;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(_h||(_h={}));class l_{constructor(e,t,r,o,c,d,a){this.name=e,this.type=t,this.group=r,this.binding=o,this.attributes=c,this.resourceType=d,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class bz{constructor(e,t){this.name=e,this.type=t}}class wz{constructor(e,t,r,o){this.name=e,this.type=t,this.locationType=r,this.location=o,this.interpolation=null}}class u2{constructor(e,t,r,o){this.name=e,this.type=t,this.locationType=r,this.location=o}}class Tz{constructor(e,t,r,o){this.name=e,this.type=t,this.attributes=r,this.id=o}}class Sz{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class Az{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class Pz{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function Ez(n){var e=(32768&n)>>15,t=(31744&n)>>10,r=1023&n;return t==0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):t==31?r?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+r/Math.pow(2,10))}const qE=new Float32Array(1),Cz=new Int32Array(qE.buffer),Fs=new Uint16Array(1);function Iz(n){qE[0]=n;const e=Cz[0],t=e>>31&1;let r=e>>23&255,o=8388607&e;if(r===255)return Fs[0]=t<<15|31744|(o!==0?512:0),Fs[0];if(r===0){if(o===0)return Fs[0]=t<<15,Fs[0];o|=8388608;let c=113;for(;!(8388608&o);)o<<=1,c--;return r=127-c,o&=8388607,r>0?(o=(o>>126-r)+(o>>127-r&1),Fs[0]=t<<15|r<<10|o>>13,Fs[0]):(Fs[0]=t<<15,Fs[0])}return r=r-127+15,r>=31?(Fs[0]=t<<15|31744,Fs[0]):r<=0?r<-10?(Fs[0]=t<<15,Fs[0]):(o=(8388608|o)>>1-r,Fs[0]=t<<15|o>>13,Fs[0]):(o>>=13,Fs[0]=t<<15|r<<10|o,Fs[0])}const wb=new Uint32Array(1),GE=new Float32Array(wb.buffer,0,1);function h2(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return wb[0]=e,GE[0]}function Mz(n,e,t,r,o,c,d,a,v){const A=r*(d>>=o)*(c>>=o)+t*d+e*a;switch(v){case"r8unorm":return[ur(n,A,"8unorm",1)[0]];case"r8snorm":return[ur(n,A,"8snorm",1)[0]];case"r8uint":return[ur(n,A,"8uint",1)[0]];case"r8sint":return[ur(n,A,"8sint",1)[0]];case"rg8unorm":{const P=ur(n,A,"8unorm",2);return[P[0],P[1]]}case"rg8snorm":{const P=ur(n,A,"8snorm",2);return[P[0],P[1]]}case"rg8uint":{const P=ur(n,A,"8uint",2);return[P[0],P[1]]}case"rg8sint":{const P=ur(n,A,"8sint",2);return[P[0],P[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const P=ur(n,A,"8unorm",4);return[P[0],P[1],P[2],P[3]]}case"rgba8snorm":{const P=ur(n,A,"8snorm",4);return[P[0],P[1],P[2],P[3]]}case"rgba8uint":{const P=ur(n,A,"8uint",4);return[P[0],P[1],P[2],P[3]]}case"rgba8sint":{const P=ur(n,A,"8sint",4);return[P[0],P[1],P[2],P[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const P=ur(n,A,"8unorm",4);return[P[2],P[1],P[0],P[3]]}case"r16uint":return[ur(n,A,"16uint",1)[0]];case"r16sint":return[ur(n,A,"16sint",1)[0]];case"r16float":return[ur(n,A,"16float",1)[0]];case"rg16uint":{const P=ur(n,A,"16uint",2);return[P[0],P[1]]}case"rg16sint":{const P=ur(n,A,"16sint",2);return[P[0],P[1]]}case"rg16float":{const P=ur(n,A,"16float",2);return[P[0],P[1]]}case"rgba16uint":{const P=ur(n,A,"16uint",4);return[P[0],P[1],P[2],P[3]]}case"rgba16sint":{const P=ur(n,A,"16sint",4);return[P[0],P[1],P[2],P[3]]}case"rgba16float":{const P=ur(n,A,"16float",4);return[P[0],P[1],P[2],P[3]]}case"r32uint":return[ur(n,A,"32uint",1)[0]];case"r32sint":return[ur(n,A,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[ur(n,A,"32float",1)[0]];case"rg32uint":{const P=ur(n,A,"32uint",2);return[P[0],P[1]]}case"rg32sint":{const P=ur(n,A,"32sint",2);return[P[0],P[1]]}case"rg32float":{const P=ur(n,A,"32float",2);return[P[0],P[1]]}case"rgba32uint":{const P=ur(n,A,"32uint",4);return[P[0],P[1],P[2],P[3]]}case"rgba32sint":{const P=ur(n,A,"32sint",4);return[P[0],P[1],P[2],P[3]]}case"rgba32float":{const P=ur(n,A,"32float",4);return[P[0],P[1],P[2],P[3]]}case"rg11b10ufloat":{const P=new Uint32Array(n.buffer,A,1)[0],k=(4192256&P)>>11,L=(4290772992&P)>>22;return[h2(2047&P),h2(k),(function(z){const G=112+(z>>5&31)<<23|(31&z)<<18;return wb[0]=G,GE[0]})(L),1]}}return null}function ur(n,e,t,r){const o=[0,0,0,0];for(let c=0;c<r;++c)switch(t){case"8unorm":o[c]=n[e]/255,e++;break;case"8snorm":o[c]=n[e]/255*2-1,e++;break;case"8uint":o[c]=n[e],e++;break;case"8sint":o[c]=n[e]-127,e++;break;case"16uint":o[c]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":o[c]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":o[c]=Ez(n[e]|n[e+1]<<8),e+=2;break;case"32uint":case"32sint":o[c]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":o[c]=new Float32Array(n.buffer,e,1)[0],e+=4}return o}function mr(n,e,t,r,o){for(let c=0;c<r;++c)switch(t){case"8unorm":n[e]=255*o[c],e++;break;case"8snorm":n[e]=.5*(o[c]+1)*255,e++;break;case"8uint":n[e]=o[c],e++;break;case"8sint":n[e]=o[c]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=o[c],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=o[c],e+=2;break;case"16float":{const d=Iz(o[c]);new Uint16Array(n.buffer,e,1)[0]=d,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=o[c],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=o[c],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=o[c],e+=4}return o}const Zv={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Na{constructor(){this.id=Na._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Q_.instance);for(const r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(ey.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Na._id=0;class Q_ extends Na{}Q_.instance=new Q_;class ey extends Na{}ey.instance=new ey;const YE=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Wr extends Na{constructor(){super()}}class rg extends Wr{constructor(e,t,r,o,c,d){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=o,this.startLine=c,this.endLine=d}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class Rz extends Wr{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class KE extends Wr{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Y0 extends Wr{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class JE extends Wr{constructor(e,t,r,o){super(),this.init=e,this.condition=t,this.increment=r,this.body=o}get astNodeType(){return"for"}search(e){var t,r,o;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(o=this.increment)===null||o===void 0||o.search(e),this.searchBlock(this.body,e)}}class Au extends Wr{constructor(e,t,r,o,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=o,this.value=c}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Tb extends Wr{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class $m extends Wr{constructor(e,t,r,o,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=o,this.value=c}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class M_ extends Wr{constructor(e,t,r,o,c){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=o,this.value=c}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var sp,Mm,et,He;(n=>{n.increment="++",n.decrement="--"})(sp||(sp={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(sp||(sp={}));class QE extends Wr{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Mm||(Mm={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Mm||(Mm={}));class eC extends Wr{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Sb extends Wr{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return YE.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class tC extends Wr{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class nC extends Wr{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class rC extends Wr{constructor(e,t,r,o){super(),this.condition=e,this.body=t,this.elseif=r,this.else=o}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class iC extends Wr{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class kz extends Wr{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Dz extends Wr{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class sC extends Wr{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Ab extends Wr{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class Oz extends Wr{constructor(){super()}get astNodeType(){return"discard"}}class oC extends Wr{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class aC extends Wr{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class _t extends Wr{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const o=_t._priority.get(t.name);_t._priority.get(e[r].name)<o&&(t=e[r])}return t.name==="x32"?_t.i32:t}getTypeName(){return this.name}}_t.x32=new _t("x32"),_t.f32=new _t("f32"),_t.i32=new _t("i32"),_t.u32=new _t("u32"),_t.f16=new _t("f16"),_t.bool=new _t("bool"),_t.void=new _t("void"),_t._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class d2 extends _t{constructor(e){super(e)}}class Tu extends _t{constructor(e,t,r,o){super(e),this.members=t,this.startLine=r,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class Xe extends _t{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}Xe.vec2f=new Xe("vec2",_t.f32,null),Xe.vec3f=new Xe("vec3",_t.f32,null),Xe.vec4f=new Xe("vec4",_t.f32,null),Xe.vec2i=new Xe("vec2",_t.i32,null),Xe.vec3i=new Xe("vec3",_t.i32,null),Xe.vec4i=new Xe("vec4",_t.i32,null),Xe.vec2u=new Xe("vec2",_t.u32,null),Xe.vec3u=new Xe("vec3",_t.u32,null),Xe.vec4u=new Xe("vec4",_t.u32,null),Xe.vec2h=new Xe("vec2",_t.f16,null),Xe.vec3h=new Xe("vec3",_t.f16,null),Xe.vec4h=new Xe("vec4",_t.f16,null),Xe.vec2b=new Xe("vec2",_t.bool,null),Xe.vec3b=new Xe("vec3",_t.bool,null),Xe.vec4b=new Xe("vec4",_t.bool,null),Xe.mat2x2f=new Xe("mat2x2",_t.f32,null),Xe.mat2x3f=new Xe("mat2x3",_t.f32,null),Xe.mat2x4f=new Xe("mat2x4",_t.f32,null),Xe.mat3x2f=new Xe("mat3x2",_t.f32,null),Xe.mat3x3f=new Xe("mat3x3",_t.f32,null),Xe.mat3x4f=new Xe("mat3x4",_t.f32,null),Xe.mat4x2f=new Xe("mat4x2",_t.f32,null),Xe.mat4x3f=new Xe("mat4x3",_t.f32,null),Xe.mat4x4f=new Xe("mat4x4",_t.f32,null),Xe.mat2x2h=new Xe("mat2x2",_t.f16,null),Xe.mat2x3h=new Xe("mat2x3",_t.f16,null),Xe.mat2x4h=new Xe("mat2x4",_t.f16,null),Xe.mat3x2h=new Xe("mat3x2",_t.f16,null),Xe.mat3x3h=new Xe("mat3x3",_t.f16,null),Xe.mat3x4h=new Xe("mat3x4",_t.f16,null),Xe.mat4x2h=new Xe("mat4x2",_t.f16,null),Xe.mat4x3h=new Xe("mat4x3",_t.f16,null),Xe.mat4x4h=new Xe("mat4x4",_t.f16,null),Xe.mat2x2i=new Xe("mat2x2",_t.i32,null),Xe.mat2x3i=new Xe("mat2x3",_t.i32,null),Xe.mat2x4i=new Xe("mat2x4",_t.i32,null),Xe.mat3x2i=new Xe("mat3x2",_t.i32,null),Xe.mat3x3i=new Xe("mat3x3",_t.i32,null),Xe.mat3x4i=new Xe("mat3x4",_t.i32,null),Xe.mat4x2i=new Xe("mat4x2",_t.i32,null),Xe.mat4x3i=new Xe("mat4x3",_t.i32,null),Xe.mat4x4i=new Xe("mat4x4",_t.i32,null),Xe.mat2x2u=new Xe("mat2x2",_t.u32,null),Xe.mat2x3u=new Xe("mat2x3",_t.u32,null),Xe.mat2x4u=new Xe("mat2x4",_t.u32,null),Xe.mat3x2u=new Xe("mat3x2",_t.u32,null),Xe.mat3x3u=new Xe("mat3x3",_t.u32,null),Xe.mat3x4u=new Xe("mat3x4",_t.u32,null),Xe.mat4x2u=new Xe("mat4x2",_t.u32,null),Xe.mat4x3u=new Xe("mat4x3",_t.u32,null),Xe.mat4x4u=new Xe("mat4x4",_t.u32,null);class R_ extends _t{constructor(e,t,r,o){super(e),this.storage=t,this.type=r,this.access=o}get astNodeType(){return"pointer"}}class Wm extends _t{constructor(e,t,r,o){super(e),this.attributes=t,this.format=r,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class Rm extends _t{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class Cl extends Na{constructor(){super(),this.postfix=null}}class jd extends Cl{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class wc extends Cl{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Pb extends Cl{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return YE.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Qo extends Cl{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class lC extends Cl{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class Zi extends Cl{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof We}get isVector(){return this.value instanceof ge||this.value instanceof xn}get scalarValue(){return this.value instanceof We?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof ge||this.value instanceof xn?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class cC extends Cl{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class yp extends Cl{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class uC extends Cl{constructor(){super()}}class Ii extends uC{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Tl extends uC{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?_t.f32:e.name==="u32"||t.name==="u32"?_t.u32:_t.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class hC extends Na{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class k_ extends Cl{constructor(){super()}get astNodeType(){return"default"}}class dC extends hC{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class fC extends hC{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class f2 extends Na{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class Lz extends Na{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class p2 extends Na{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class pC extends Na{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Fa{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Fa._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,o){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Fa._id=0;class K0 extends Fa{constructor(){super(new Ra("void",null),null)}toString(){return"void"}}K0.void=new K0;class Gf extends Fa{constructor(e){super(new G0("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,o){this.reference.setDataValue(e,t,r,o)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}}class We extends Fa{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new We(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new We(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new We(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,o){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof We))return void console.error("SetDataValue: Invalid value",t);let c=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?c=Math.floor(c):this.typeInfo.name==="bool"&&(c=c?1:0),this.data[0]=c}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function Fz(n,e,t){const r=e.length;return r===2?t==="f32"?new ge(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new ge(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new ge(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new ge(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):r===3?t==="f32"?new ge(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new ge(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new ge(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new ge(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):r===4?t==="f32"?new ge(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new ge(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new ge(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new ge(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class ge extends Fa{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?this.data=new Float32Array(e):o==="vec2i"||o==="vec3i"||o==="vec4i"?this.data=new Int32Array(e):o==="vec2u"||o==="vec3u"||o==="vec4u"?this.data=new Uint32Array(e):o==="vec2h"||o==="vec3h"||o==="vec4h"?this.data=new Float32Array(e):o==="vec2b"||o==="vec3b"||o==="vec4b"?this.data=new Int32Array(e):o==="vec2"||o==="vec3"||o==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${o}`)}}clone(){if(this.data instanceof Float32Array)return new ge(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ge(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ge(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,o){r instanceof jd?console.error("TODO: Set vector postfix"):t instanceof ge?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let o=e.getTypeInfo("f32");if(this.typeInfo instanceof Vd)o=this.typeInfo.format||o;else{const d=this.typeInfo.name;d==="vec2f"||d==="vec3f"||d==="vec4f"?o=e.getTypeInfo("f32"):d==="vec2i"||d==="vec3i"||d==="vec4i"?o=e.getTypeInfo("i32"):d==="vec2b"||d==="vec3b"||d==="vec4b"?o=e.getTypeInfo("bool"):d==="vec2u"||d==="vec3u"||d==="vec4u"?o=e.getTypeInfo("u32"):d==="vec2h"||d==="vec3h"||d==="vec4h"?o=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${d}`)}let c=this;for(;t!==null&&c!==null;){if(t instanceof yp){const d=t.index;let a=-1;if(d instanceof Zi){if(!(d.value instanceof We))return console.error(`GetSubData: Invalid array index ${d.value}`),null;a=d.value.value}else{const v=e.evalExpression(d,r);if(!(v instanceof We))return console.error("GetSubData: Unknown index type",d),null;a=v.value}if(a<0||a>=c.data.length)return console.error("GetSubData: Index out of range",a),null;if(c.data instanceof Float32Array){const v=new Float32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new We(v,o)}if(c.data instanceof Int32Array){const v=new Int32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new We(v,o)}if(c.data instanceof Uint32Array){const v=new Uint32Array(c.data.buffer,c.data.byteOffset+4*a,1);return new We(v,o)}throw"GetSubData: Invalid data type"}if(!(t instanceof jd))return console.error("GetSubData: Unknown postfix",t),null;{const d=t.value.toLowerCase();if(d.length===1){let v=0;if(d==="x"||d==="r")v=0;else if(d==="y"||d==="g")v=1;else if(d==="z"||d==="b")v=2;else{if(d!=="w"&&d!=="a")return console.error(`GetSubData: Unknown member ${d}`),null;v=3}if(this.data instanceof Float32Array){let A=new Float32Array(this.data.buffer,this.data.byteOffset+4*v,1);return new We(A,o,this)}if(this.data instanceof Int32Array){let A=new Int32Array(this.data.buffer,this.data.byteOffset+4*v,1);return new We(A,o,this)}if(this.data instanceof Uint32Array){let A=new Uint32Array(this.data.buffer,this.data.byteOffset+4*v,1);return new We(A,o,this)}}const a=[];for(const v of d)v==="x"||v==="r"?a.push(this.data[0]):v==="y"||v==="g"?a.push(this.data[1]):v==="z"||v==="b"?a.push(this.data[2]):v==="w"||v==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${v}`);c=Fz(e,a,o.name)}t=t.postfix}return c}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class xn extends Fa{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new xn(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,o){r instanceof jd?console.error("TODO: Set matrix postfix"):t instanceof xn?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;const o=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Vd)this.typeInfo.format;else if(o.endsWith("f"))e.getTypeInfo("f32");else if(o.endsWith("i"))e.getTypeInfo("i32");else if(o.endsWith("u"))e.getTypeInfo("u32");else{if(!o.endsWith("h"))return console.error(`GetDataValue: Unknown type ${o}`),null;e.getTypeInfo("f16")}if(t instanceof yp){const c=t.index;let d=-1;if(c instanceof Zi){if(!(c.value instanceof We))return console.error(`GetDataValue: Invalid array index ${c.value}`),null;d=c.value.value}else{const A=e.evalExpression(c,r);if(!(A instanceof We))return console.error("GetDataValue: Unknown index type",c),null;d=A.value}if(d<0||d>=this.data.length)return console.error("GetDataValue: Index out of range",d),null;const a=o.endsWith("h")?"h":"f";let v;if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h"||o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h")v=new ge(new Float32Array(this.data.buffer,this.data.byteOffset+2*d*4,2),e.getTypeInfo(`vec2${a}`));else if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h"||o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h")v=new ge(new Float32Array(this.data.buffer,this.data.byteOffset+3*d*4,3),e.getTypeInfo(`vec3${a}`));else{if(o!=="mat2x4"&&o!=="mat2x4f"&&o!=="mat2x4h"&&o!=="mat3x4"&&o!=="mat3x4f"&&o!=="mat3x4h"&&o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${o}`),null;v=new ge(new Float32Array(this.data.buffer,this.data.byteOffset+4*d*4,4),e.getTypeInfo(`vec4${a}`))}return t.postfix?v.getSubData(e,t.postfix,r):v}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class oi extends Fa{constructor(e,t,r=0,o=null){super(t,o),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new oi(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,r,o){if(t===null)return void console.log("setDataValue: NULL data.");let c=this.offset,d=this.typeInfo;for(;r;){if(r instanceof yp)if(d instanceof Ah){const a=r.index;if(a instanceof Zi){if(!(a.value instanceof We))return void console.error(`SetDataValue: Invalid index type ${a.value}`);c+=a.value.value*d.stride}else{const v=e.evalExpression(a,o);if(!(v instanceof We))return void console.error("SetDataValue: Unknown index type",a);c+=v.value*d.stride}d=d.format}else console.error(`SetDataValue: Type ${d.getTypeName()} is not an array`);else{if(!(r instanceof jd))return void console.error("SetDataValue: Unknown postfix type",r);{const a=r.value;if(d instanceof xh){let v=!1;for(const A of d.members)if(A.name===a){c+=A.offset,d=A.type,v=!0;break}if(!v)return void console.error(`SetDataValue: Member ${a} not found`)}else if(d instanceof Ra){const v=d.getTypeName();let A=0;if(a==="x"||a==="r")A=0;else if(a==="y"||a==="g")A=1;else if(a==="z"||a==="b")A=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);A=3}if(!(t instanceof We))return void console.error("SetDataValue: Invalid value",t);const P=t.value;return v==="vec2f"?void(new Float32Array(this.buffer,c,2)[A]=P):v==="vec3f"?void(new Float32Array(this.buffer,c,3)[A]=P):v==="vec4f"?void(new Float32Array(this.buffer,c,4)[A]=P):v==="vec2i"?void(new Int32Array(this.buffer,c,2)[A]=P):v==="vec3i"?void(new Int32Array(this.buffer,c,3)[A]=P):v==="vec4i"?void(new Int32Array(this.buffer,c,4)[A]=P):v==="vec2u"?void(new Uint32Array(this.buffer,c,2)[A]=P):v==="vec3u"?void(new Uint32Array(this.buffer,c,3)[A]=P):v==="vec4u"?void(new Uint32Array(this.buffer,c,4)[A]=P):void console.error(`SetDataValue: Type ${v} is not a struct`)}}}r=r.postfix}this.setData(e,t,d,c,o)}setData(e,t,r,o,c){const d=r.getTypeName();if(d!=="f32"&&d!=="f16")if(d!=="i32"&&d!=="atomic<i32>"&&d!=="x32")if(d!=="u32"&&d!=="atomic<u32>")if(d!=="bool"){if(d==="vec2f"||d==="vec2h"){const a=new Float32Array(this.buffer,o,2);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(d==="vec3f"||d==="vec3h"){const a=new Float32Array(this.buffer,o,3);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(d==="vec4f"||d==="vec4h"){const a=new Float32Array(this.buffer,o,4);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(d==="vec2i"){const a=new Int32Array(this.buffer,o,2);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(d==="vec3i"){const a=new Int32Array(this.buffer,o,3);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(d==="vec4i"){const a=new Int32Array(this.buffer,o,4);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(d==="vec2u"){const a=new Uint32Array(this.buffer,o,2);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(d==="vec3u"){const a=new Uint32Array(this.buffer,o,3);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(d==="vec4u"){const a=new Uint32Array(this.buffer,o,4);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(d==="vec2b"){const a=new Uint32Array(this.buffer,o,2);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(d==="vec3b"){const a=new Uint32Array(this.buffer,o,3);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(d==="vec4b"){const a=new Uint32Array(this.buffer,o,4);return void(t instanceof ge?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(d==="mat2x2f"||d==="mat2x2h"){const a=new Float32Array(this.buffer,o,4);return void(t instanceof xn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(d==="mat2x3f"||d==="mat2x3h"){const a=new Float32Array(this.buffer,o,6);return void(t instanceof xn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(d==="mat2x4f"||d==="mat2x4h"){const a=new Float32Array(this.buffer,o,8);return void(t instanceof xn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(d==="mat3x2f"||d==="mat3x2h"){const a=new Float32Array(this.buffer,o,6);return void(t instanceof xn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(d==="mat3x3f"||d==="mat3x3h"){const a=new Float32Array(this.buffer,o,9);return void(t instanceof xn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8]))}if(d==="mat3x4f"||d==="mat3x4h"){const a=new Float32Array(this.buffer,o,12);return void(t instanceof xn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(d==="mat4x2f"||d==="mat4x2h"){const a=new Float32Array(this.buffer,o,8);return void(t instanceof xn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(d==="mat4x3f"||d==="mat4x3h"){const a=new Float32Array(this.buffer,o,12);return void(t instanceof xn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(d==="mat4x4f"||d==="mat4x4h"){const a=new Float32Array(this.buffer,o,16);return void(t instanceof xn?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11],a[12]=t.data[12],a[13]=t.data[13],a[14]=t.data[14],a[15]=t.data[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]))}if(t instanceof oi){if(r===t.typeInfo)return void new Uint8Array(this.buffer,o,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",d,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${d}`)}else t instanceof We&&(new Int32Array(this.buffer,o,1)[0]=t.value);else t instanceof We&&(new Uint32Array(this.buffer,o,1)[0]=t.value);else t instanceof We&&(new Int32Array(this.buffer,o,1)[0]=t.value);else t instanceof We&&(new Float32Array(this.buffer,o,1)[0]=t.value)}getSubData(e,t,r){var o,c,d;if(t===null)return this;let a=this.offset,v=this.typeInfo;for(;t;){if(t instanceof yp){const P=t.index,k=P instanceof Cl?e.evalExpression(P,r):P;let L=0;if(k instanceof We?L=k.value:typeof k=="number"?L=k:console.error("GetDataValue: Invalid index type",P),v instanceof Ah)a+=L*v.stride,v=v.format;else{const z=v.getTypeName();z==="mat4x4"||z==="mat4x4f"||z==="mat4x4h"?(a+=16*L,v=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${v.getTypeName()} is not an array`)}}else{if(!(t instanceof jd))return console.error("GetDataValue: Unknown postfix type",t),null;{const P=t.value;if(v instanceof xh){let k=!1;for(const L of v.members)if(L.name===P){a+=L.offset,v=L.type,k=!0;break}if(!k)return console.error(`GetDataValue: Member ${P} not found`),null}else if(v instanceof Ra){const k=v.getTypeName();if(k==="vec2f"||k==="vec3f"||k==="vec4f"||k==="vec2i"||k==="vec3i"||k==="vec4i"||k==="vec2u"||k==="vec3u"||k==="vec4u"||k==="vec2b"||k==="vec3b"||k==="vec4b"||k==="vec2h"||k==="vec3h"||k==="vec4h"||k==="vec2"||k==="vec3"||k==="vec4"){if(P.length>0&&P.length<5){let L="f";const z=[];for(let G=0;G<P.length;++G){const te=P[G].toLowerCase();let re=0;if(te==="x"||te==="r")re=0;else if(te==="y"||te==="g")re=1;else if(te==="z"||te==="b")re=2;else{if(te!=="w"&&te!=="a")return console.error(`Unknown member ${P}`),null;re=3}if(P.length===1){if(k.endsWith("f"))return this.buffer.byteLength<a+4*re+4?(console.log("Insufficient buffer data"),null):new We(new Float32Array(this.buffer,a+4*re,1),e.getTypeInfo("f32"),this);if(k.endsWith("h"))return new We(new Float32Array(this.buffer,a+4*re,1),e.getTypeInfo("f16"),this);if(k.endsWith("i"))return new We(new Int32Array(this.buffer,a+4*re,1),e.getTypeInfo("i32"),this);if(k.endsWith("b"))return new We(new Int32Array(this.buffer,a+4*re,1),e.getTypeInfo("bool"),this);if(k.endsWith("u"))return new We(new Uint32Array(this.buffer,a+4*re,1),e.getTypeInfo("i32"),this)}if(k==="vec2f")z.push(new Float32Array(this.buffer,a,2)[re]);else if(k==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const fe=new Float32Array(this.buffer,a,3);z.push(fe[re])}else if(k==="vec4f")z.push(new Float32Array(this.buffer,a,4)[re]);else if(k==="vec2i")L="i",z.push(new Int32Array(this.buffer,a,2)[re]);else if(k==="vec3i")L="i",z.push(new Int32Array(this.buffer,a,3)[re]);else if(k==="vec4i")L="i",z.push(new Int32Array(this.buffer,a,4)[re]);else if(k==="vec2u"){L="u";const fe=new Uint32Array(this.buffer,a,2);z.push(fe[re])}else k==="vec3u"?(L="u",z.push(new Uint32Array(this.buffer,a,3)[re])):k==="vec4u"&&(L="u",z.push(new Uint32Array(this.buffer,a,4)[re]))}return z.length===2?v=e.getTypeInfo(`vec2${L}`):z.length===3?v=e.getTypeInfo(`vec3${L}`):z.length===4?v=e.getTypeInfo(`vec4${L}`):console.error(`GetDataValue: Invalid vector length ${z.length}`),new ge(z,v,null)}return console.error(`GetDataValue: Unknown member ${P}`),null}return console.error(`GetDataValue: Type ${k} is not a struct`),null}}}t=t.postfix}const A=v.getTypeName();return A==="f32"?new We(new Float32Array(this.buffer,a,1),v,this):A==="i32"?new We(new Int32Array(this.buffer,a,1),v,this):A==="u32"?new We(new Uint32Array(this.buffer,a,1),v,this):A==="vec2f"?new ge(new Float32Array(this.buffer,a,2),v,this):A==="vec3f"?new ge(new Float32Array(this.buffer,a,3),v,this):A==="vec4f"?new ge(new Float32Array(this.buffer,a,4),v,this):A==="vec2i"?new ge(new Int32Array(this.buffer,a,2),v,this):A==="vec3i"?new ge(new Int32Array(this.buffer,a,3),v,this):A==="vec4i"?new ge(new Int32Array(this.buffer,a,4),v,this):A==="vec2u"?new ge(new Uint32Array(this.buffer,a,2),v,this):A==="vec3u"?new ge(new Uint32Array(this.buffer,a,3),v,this):A==="vec4u"?new ge(new Uint32Array(this.buffer,a,4),v,this):v instanceof Vd&&v.name==="atomic"?((o=v.format)===null||o===void 0?void 0:o.name)==="u32"?new We(new Uint32Array(this.buffer,a,1)[0],v.format,this):((c=v.format)===null||c===void 0?void 0:c.name)==="i32"?new We(new Int32Array(this.buffer,a,1)[0],v.format,this):(console.error(`GetDataValue: Invalid atomic format ${(d=v.format)===null||d===void 0?void 0:d.name}`),null):new oi(this.buffer,v,a,this)}toString(){let e="";if(this.typeInfo instanceof Ah)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof xh?e+="{...}":e="[...]";return e}}class Su extends Fa{constructor(e,t,r,o){super(t,null),this.data=e,this.descriptor=r,this.view=o}clone(){return new Su(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.width)!==null&&t!==void 0?t:0}get height(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){const e=this.format,t=Zv[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Zv[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Zv[e],r=this.width;if(!e||r<=0||!t)return-1;const o=this.height,c=this.depthOrArrayLayers,d=this.dimension;return r/t.blockWidth*(d==="1d"?1:o/t.blockHeight)*t.bytesPerBlock*c}getPixel(e,t,r=0,o=0){const c=this.texelByteSize,d=this.bytesPerRow,a=this.height,v=this.data[o];return Mz(new Uint8Array(v),e,t,r,o,a,d,c,this.format)}setPixel(e,t,r,o,c){const d=this.texelByteSize,a=this.bytesPerRow,v=this.height,A=this.data[o];(function(P,k,L,z,G,te,re,fe,ve,le){const Se=z*(re>>=G)*(te>>=G)+L*re+k*fe;switch(ve){case"r8unorm":return void mr(P,Se,"8unorm",1,le);case"r8snorm":return void mr(P,Se,"8snorm",1,le);case"r8uint":return void mr(P,Se,"8uint",1,le);case"r8sint":return void mr(P,Se,"8sint",1,le);case"rg8unorm":return void mr(P,Se,"8unorm",2,le);case"rg8snorm":return void mr(P,Se,"8snorm",2,le);case"rg8uint":return void mr(P,Se,"8uint",2,le);case"rg8sint":return void mr(P,Se,"8sint",2,le);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void mr(P,Se,"8unorm",4,le);case"rgba8snorm":return void mr(P,Se,"8snorm",4,le);case"rgba8uint":return void mr(P,Se,"8uint",4,le);case"rgba8sint":return void mr(P,Se,"8sint",4,le);case"r16uint":return void mr(P,Se,"16uint",1,le);case"r16sint":return void mr(P,Se,"16sint",1,le);case"r16float":return void mr(P,Se,"16float",1,le);case"rg16uint":return void mr(P,Se,"16uint",2,le);case"rg16sint":return void mr(P,Se,"16sint",2,le);case"rg16float":return void mr(P,Se,"16float",2,le);case"rgba16uint":return void mr(P,Se,"16uint",4,le);case"rgba16sint":return void mr(P,Se,"16sint",4,le);case"rgba16float":return void mr(P,Se,"16float",4,le);case"r32uint":return void mr(P,Se,"32uint",1,le);case"r32sint":return void mr(P,Se,"32sint",1,le);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void mr(P,Se,"32float",1,le);case"rg32uint":return void mr(P,Se,"32uint",2,le);case"rg32sint":return void mr(P,Se,"32sint",2,le);case"rg32float":return void mr(P,Se,"32float",2,le);case"rgba32uint":return void mr(P,Se,"32uint",4,le);case"rgba32sint":return void mr(P,Se,"32sint",4,le);case"rgba32float":return void mr(P,Se,"32float",4,le);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(A),e,t,r,o,v,a,d,this.format,c)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(He||(He={}));class Ze{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class ce{}et=ce,ce.none=new Ze("",He.reserved,""),ce.eof=new Ze("EOF",He.token,""),ce.reserved={asm:new Ze("asm",He.reserved,"asm"),bf16:new Ze("bf16",He.reserved,"bf16"),do:new Ze("do",He.reserved,"do"),enum:new Ze("enum",He.reserved,"enum"),f16:new Ze("f16",He.reserved,"f16"),f64:new Ze("f64",He.reserved,"f64"),handle:new Ze("handle",He.reserved,"handle"),i8:new Ze("i8",He.reserved,"i8"),i16:new Ze("i16",He.reserved,"i16"),i64:new Ze("i64",He.reserved,"i64"),mat:new Ze("mat",He.reserved,"mat"),premerge:new Ze("premerge",He.reserved,"premerge"),regardless:new Ze("regardless",He.reserved,"regardless"),typedef:new Ze("typedef",He.reserved,"typedef"),u8:new Ze("u8",He.reserved,"u8"),u16:new Ze("u16",He.reserved,"u16"),u64:new Ze("u64",He.reserved,"u64"),unless:new Ze("unless",He.reserved,"unless"),using:new Ze("using",He.reserved,"using"),vec:new Ze("vec",He.reserved,"vec"),void:new Ze("void",He.reserved,"void")},ce.keywords={array:new Ze("array",He.keyword,"array"),atomic:new Ze("atomic",He.keyword,"atomic"),bool:new Ze("bool",He.keyword,"bool"),f32:new Ze("f32",He.keyword,"f32"),i32:new Ze("i32",He.keyword,"i32"),mat2x2:new Ze("mat2x2",He.keyword,"mat2x2"),mat2x3:new Ze("mat2x3",He.keyword,"mat2x3"),mat2x4:new Ze("mat2x4",He.keyword,"mat2x4"),mat3x2:new Ze("mat3x2",He.keyword,"mat3x2"),mat3x3:new Ze("mat3x3",He.keyword,"mat3x3"),mat3x4:new Ze("mat3x4",He.keyword,"mat3x4"),mat4x2:new Ze("mat4x2",He.keyword,"mat4x2"),mat4x3:new Ze("mat4x3",He.keyword,"mat4x3"),mat4x4:new Ze("mat4x4",He.keyword,"mat4x4"),ptr:new Ze("ptr",He.keyword,"ptr"),sampler:new Ze("sampler",He.keyword,"sampler"),sampler_comparison:new Ze("sampler_comparison",He.keyword,"sampler_comparison"),struct:new Ze("struct",He.keyword,"struct"),texture_1d:new Ze("texture_1d",He.keyword,"texture_1d"),texture_2d:new Ze("texture_2d",He.keyword,"texture_2d"),texture_2d_array:new Ze("texture_2d_array",He.keyword,"texture_2d_array"),texture_3d:new Ze("texture_3d",He.keyword,"texture_3d"),texture_cube:new Ze("texture_cube",He.keyword,"texture_cube"),texture_cube_array:new Ze("texture_cube_array",He.keyword,"texture_cube_array"),texture_multisampled_2d:new Ze("texture_multisampled_2d",He.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ze("texture_storage_1d",He.keyword,"texture_storage_1d"),texture_storage_2d:new Ze("texture_storage_2d",He.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ze("texture_storage_2d_array",He.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ze("texture_storage_3d",He.keyword,"texture_storage_3d"),texture_depth_2d:new Ze("texture_depth_2d",He.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ze("texture_depth_2d_array",He.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ze("texture_depth_cube",He.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ze("texture_depth_cube_array",He.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ze("texture_depth_multisampled_2d",He.keyword,"texture_depth_multisampled_2d"),texture_external:new Ze("texture_external",He.keyword,"texture_external"),u32:new Ze("u32",He.keyword,"u32"),vec2:new Ze("vec2",He.keyword,"vec2"),vec3:new Ze("vec3",He.keyword,"vec3"),vec4:new Ze("vec4",He.keyword,"vec4"),bitcast:new Ze("bitcast",He.keyword,"bitcast"),block:new Ze("block",He.keyword,"block"),break:new Ze("break",He.keyword,"break"),case:new Ze("case",He.keyword,"case"),continue:new Ze("continue",He.keyword,"continue"),continuing:new Ze("continuing",He.keyword,"continuing"),default:new Ze("default",He.keyword,"default"),diagnostic:new Ze("diagnostic",He.keyword,"diagnostic"),discard:new Ze("discard",He.keyword,"discard"),else:new Ze("else",He.keyword,"else"),enable:new Ze("enable",He.keyword,"enable"),fallthrough:new Ze("fallthrough",He.keyword,"fallthrough"),false:new Ze("false",He.keyword,"false"),fn:new Ze("fn",He.keyword,"fn"),for:new Ze("for",He.keyword,"for"),function:new Ze("function",He.keyword,"function"),if:new Ze("if",He.keyword,"if"),let:new Ze("let",He.keyword,"let"),const:new Ze("const",He.keyword,"const"),loop:new Ze("loop",He.keyword,"loop"),while:new Ze("while",He.keyword,"while"),private:new Ze("private",He.keyword,"private"),read:new Ze("read",He.keyword,"read"),read_write:new Ze("read_write",He.keyword,"read_write"),return:new Ze("return",He.keyword,"return"),requires:new Ze("requires",He.keyword,"requires"),storage:new Ze("storage",He.keyword,"storage"),switch:new Ze("switch",He.keyword,"switch"),true:new Ze("true",He.keyword,"true"),alias:new Ze("alias",He.keyword,"alias"),type:new Ze("type",He.keyword,"type"),uniform:new Ze("uniform",He.keyword,"uniform"),var:new Ze("var",He.keyword,"var"),override:new Ze("override",He.keyword,"override"),workgroup:new Ze("workgroup",He.keyword,"workgroup"),write:new Ze("write",He.keyword,"write"),r8unorm:new Ze("r8unorm",He.keyword,"r8unorm"),r8snorm:new Ze("r8snorm",He.keyword,"r8snorm"),r8uint:new Ze("r8uint",He.keyword,"r8uint"),r8sint:new Ze("r8sint",He.keyword,"r8sint"),r16uint:new Ze("r16uint",He.keyword,"r16uint"),r16sint:new Ze("r16sint",He.keyword,"r16sint"),r16float:new Ze("r16float",He.keyword,"r16float"),rg8unorm:new Ze("rg8unorm",He.keyword,"rg8unorm"),rg8snorm:new Ze("rg8snorm",He.keyword,"rg8snorm"),rg8uint:new Ze("rg8uint",He.keyword,"rg8uint"),rg8sint:new Ze("rg8sint",He.keyword,"rg8sint"),r32uint:new Ze("r32uint",He.keyword,"r32uint"),r32sint:new Ze("r32sint",He.keyword,"r32sint"),r32float:new Ze("r32float",He.keyword,"r32float"),rg16uint:new Ze("rg16uint",He.keyword,"rg16uint"),rg16sint:new Ze("rg16sint",He.keyword,"rg16sint"),rg16float:new Ze("rg16float",He.keyword,"rg16float"),rgba8unorm:new Ze("rgba8unorm",He.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ze("rgba8unorm_srgb",He.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ze("rgba8snorm",He.keyword,"rgba8snorm"),rgba8uint:new Ze("rgba8uint",He.keyword,"rgba8uint"),rgba8sint:new Ze("rgba8sint",He.keyword,"rgba8sint"),bgra8unorm:new Ze("bgra8unorm",He.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ze("bgra8unorm_srgb",He.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ze("rgb10a2unorm",He.keyword,"rgb10a2unorm"),rg11b10float:new Ze("rg11b10float",He.keyword,"rg11b10float"),rg32uint:new Ze("rg32uint",He.keyword,"rg32uint"),rg32sint:new Ze("rg32sint",He.keyword,"rg32sint"),rg32float:new Ze("rg32float",He.keyword,"rg32float"),rgba16uint:new Ze("rgba16uint",He.keyword,"rgba16uint"),rgba16sint:new Ze("rgba16sint",He.keyword,"rgba16sint"),rgba16float:new Ze("rgba16float",He.keyword,"rgba16float"),rgba32uint:new Ze("rgba32uint",He.keyword,"rgba32uint"),rgba32sint:new Ze("rgba32sint",He.keyword,"rgba32sint"),rgba32float:new Ze("rgba32float",He.keyword,"rgba32float"),static_assert:new Ze("static_assert",He.keyword,"static_assert")},ce.tokens={decimal_float_literal:new Ze("decimal_float_literal",He.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Ze("hex_float_literal",He.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Ze("int_literal",He.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ze("uint_literal",He.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Ze("name",He.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Ze("ident",He.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ze("and",He.token,"&"),and_and:new Ze("and_and",He.token,"&&"),arrow:new Ze("arrow ",He.token,"->"),attr:new Ze("attr",He.token,"@"),forward_slash:new Ze("forward_slash",He.token,"/"),bang:new Ze("bang",He.token,"!"),bracket_left:new Ze("bracket_left",He.token,"["),bracket_right:new Ze("bracket_right",He.token,"]"),brace_left:new Ze("brace_left",He.token,"{"),brace_right:new Ze("brace_right",He.token,"}"),colon:new Ze("colon",He.token,":"),comma:new Ze("comma",He.token,","),equal:new Ze("equal",He.token,"="),equal_equal:new Ze("equal_equal",He.token,"=="),not_equal:new Ze("not_equal",He.token,"!="),greater_than:new Ze("greater_than",He.token,">"),greater_than_equal:new Ze("greater_than_equal",He.token,">="),shift_right:new Ze("shift_right",He.token,">>"),less_than:new Ze("less_than",He.token,"<"),less_than_equal:new Ze("less_than_equal",He.token,"<="),shift_left:new Ze("shift_left",He.token,"<<"),modulo:new Ze("modulo",He.token,"%"),minus:new Ze("minus",He.token,"-"),minus_minus:new Ze("minus_minus",He.token,"--"),period:new Ze("period",He.token,"."),plus:new Ze("plus",He.token,"+"),plus_plus:new Ze("plus_plus",He.token,"++"),or:new Ze("or",He.token,"|"),or_or:new Ze("or_or",He.token,"||"),paren_left:new Ze("paren_left",He.token,"("),paren_right:new Ze("paren_right",He.token,")"),semicolon:new Ze("semicolon",He.token,";"),star:new Ze("star",He.token,"*"),tilde:new Ze("tilde",He.token,"~"),underscore:new Ze("underscore",He.token,"_"),xor:new Ze("xor",He.token,"^"),plus_equal:new Ze("plus_equal",He.token,"+="),minus_equal:new Ze("minus_equal",He.token,"-="),times_equal:new Ze("times_equal",He.token,"*="),division_equal:new Ze("division_equal",He.token,"/="),modulo_equal:new Ze("modulo_equal",He.token,"%="),and_equal:new Ze("and_equal",He.token,"&="),or_equal:new Ze("or_equal",He.token,"|="),xor_equal:new Ze("xor_equal",He.token,"^="),shift_right_equal:new Ze("shift_right_equal",He.token,">>="),shift_left_equal:new Ze("shift_left_equal",He.token,"<<=")},ce.simpleTokens={"@":et.tokens.attr,"{":et.tokens.brace_left,"}":et.tokens.brace_right,":":et.tokens.colon,",":et.tokens.comma,"(":et.tokens.paren_left,")":et.tokens.paren_right,";":et.tokens.semicolon},ce.literalTokens={"&":et.tokens.and,"&&":et.tokens.and_and,"->":et.tokens.arrow,"/":et.tokens.forward_slash,"!":et.tokens.bang,"[":et.tokens.bracket_left,"]":et.tokens.bracket_right,"=":et.tokens.equal,"==":et.tokens.equal_equal,"!=":et.tokens.not_equal,">":et.tokens.greater_than,">=":et.tokens.greater_than_equal,">>":et.tokens.shift_right,"<":et.tokens.less_than,"<=":et.tokens.less_than_equal,"<<":et.tokens.shift_left,"%":et.tokens.modulo,"-":et.tokens.minus,"--":et.tokens.minus_minus,".":et.tokens.period,"+":et.tokens.plus,"++":et.tokens.plus_plus,"|":et.tokens.or,"||":et.tokens.or_or,"*":et.tokens.star,"~":et.tokens.tilde,_:et.tokens.underscore,"^":et.tokens.xor,"+=":et.tokens.plus_equal,"-=":et.tokens.minus_equal,"*=":et.tokens.times_equal,"/=":et.tokens.division_equal,"%=":et.tokens.modulo_equal,"&=":et.tokens.and_equal,"|=":et.tokens.or_equal,"^=":et.tokens.xor_equal,">>=":et.tokens.shift_right_equal,"<<=":et.tokens.shift_left_equal},ce.regexTokens={decimal_float_literal:et.tokens.decimal_float_literal,hex_float_literal:et.tokens.hex_float_literal,int_literal:et.tokens.int_literal,uint_literal:et.tokens.uint_literal,ident:et.tokens.ident},ce.storage_class=[et.keywords.function,et.keywords.private,et.keywords.workgroup,et.keywords.uniform,et.keywords.storage],ce.access_mode=[et.keywords.read,et.keywords.write,et.keywords.read_write],ce.sampler_type=[et.keywords.sampler,et.keywords.sampler_comparison],ce.sampled_texture_type=[et.keywords.texture_1d,et.keywords.texture_2d,et.keywords.texture_2d_array,et.keywords.texture_3d,et.keywords.texture_cube,et.keywords.texture_cube_array],ce.multisampled_texture_type=[et.keywords.texture_multisampled_2d],ce.storage_texture_type=[et.keywords.texture_storage_1d,et.keywords.texture_storage_2d,et.keywords.texture_storage_2d_array,et.keywords.texture_storage_3d],ce.depth_texture_type=[et.keywords.texture_depth_2d,et.keywords.texture_depth_2d_array,et.keywords.texture_depth_cube,et.keywords.texture_depth_cube_array,et.keywords.texture_depth_multisampled_2d],ce.texture_external_type=[et.keywords.texture_external],ce.any_texture_type=[...et.sampled_texture_type,...et.multisampled_texture_type,...et.storage_texture_type,...et.depth_texture_type,...et.texture_external_type],ce.texel_format=[et.keywords.r8unorm,et.keywords.r8snorm,et.keywords.r8uint,et.keywords.r8sint,et.keywords.r16uint,et.keywords.r16sint,et.keywords.r16float,et.keywords.rg8unorm,et.keywords.rg8snorm,et.keywords.rg8uint,et.keywords.rg8sint,et.keywords.r32uint,et.keywords.r32sint,et.keywords.r32float,et.keywords.rg16uint,et.keywords.rg16sint,et.keywords.rg16float,et.keywords.rgba8unorm,et.keywords.rgba8unorm_srgb,et.keywords.rgba8snorm,et.keywords.rgba8uint,et.keywords.rgba8sint,et.keywords.bgra8unorm,et.keywords.bgra8unorm_srgb,et.keywords.rgb10a2unorm,et.keywords.rg11b10float,et.keywords.rg32uint,et.keywords.rg32sint,et.keywords.rg32float,et.keywords.rgba16uint,et.keywords.rgba16sint,et.keywords.rgba16float,et.keywords.rgba32uint,et.keywords.rgba32sint,et.keywords.rgba32float],ce.const_literal=[et.tokens.int_literal,et.tokens.uint_literal,et.tokens.decimal_float_literal,et.tokens.hex_float_literal,et.keywords.true,et.keywords.false],ce.literal_or_ident=[et.tokens.ident,et.tokens.int_literal,et.tokens.uint_literal,et.tokens.decimal_float_literal,et.tokens.hex_float_literal,et.tokens.name],ce.element_count_expression=[et.tokens.int_literal,et.tokens.uint_literal,et.tokens.ident],ce.template_types=[et.keywords.vec2,et.keywords.vec3,et.keywords.vec4,et.keywords.mat2x2,et.keywords.mat2x3,et.keywords.mat2x4,et.keywords.mat3x2,et.keywords.mat3x3,et.keywords.mat3x4,et.keywords.mat4x2,et.keywords.mat4x3,et.keywords.mat4x4,et.keywords.atomic,et.keywords.bitcast,...et.any_texture_type],ce.attribute_name=[et.tokens.ident,et.keywords.block,et.keywords.diagnostic],ce.assignment_operators=[et.tokens.equal,et.tokens.plus_equal,et.tokens.minus_equal,et.tokens.times_equal,et.tokens.division_equal,et.tokens.modulo_equal,et.tokens.and_equal,et.tokens.or_equal,et.tokens.xor_equal,et.tokens.shift_right_equal,et.tokens.shift_left_equal],ce.increment_operators=[et.tokens.plus_plus,et.tokens.minus_minus];class m2{constructor(e,t,r,o,c){this.type=e,this.lexeme=t,this.line=r,this.start=o,this.end=c}toString(){return this.lexeme}isTemplateType(){return ce.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ce.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Nz{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new m2(ce.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let d=1;for(;d>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),d--,d==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),d++)}return!0}}const t=ce.simpleTokens[e];if(t)return this._addToken(t),!0;let r=ce.none;const o=this._isAlpha(e),c=e==="_";if(this._isAlphaNumeric(e)){let d=this._peekAhead();for(;this._isAlphaNumeric(d);)e+=this._advance(),d=this._peekAhead()}if(o){const d=ce.keywords[e];if(d)return this._addToken(d),!0}if(o||c)return this._addToken(ce.tokens.ident),!0;for(;;){let d=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(ce.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(ce.tokens.minus_minus),!0;const v=this._tokens.length-1;if((ce.literal_or_ident.indexOf(this._tokens[v].type)!=-1||this._tokens[v].type==ce.tokens.paren_right)&&a!=">")return this._addToken(d),!0}if(e==">"&&(a==">"||a=="=")){let v=!1,A=this._tokens.length-1;for(let P=0;P<5&&A>=0&&ce.assignment_operators.indexOf(this._tokens[A].type)===-1;++P,--A)if(this._tokens[A].type===ce.tokens.less_than){A>0&&this._tokens[A-1].isArrayOrTemplateType()&&(v=!0);break}if(v)return this._addToken(d),!0}if(d===ce.none){let v=e,A=0;const P=2;for(let k=0;k<P;++k)if(v+=this._peekAhead(k),d=this._findType(v),d!==ce.none){A=k;break}if(d===ce.none)return r!==ce.none&&(this._current--,this._addToken(r),!0);e=v,this._current+=A+1}if(r=d,this._isAtEnd())break;e+=this._advance()}return r!==ce.none&&(this._addToken(r),!0)}_findType(e){for(const r in ce.regexTokens){const o=ce.regexTokens[r];if(this._match(e,o.rule))return o}return ce.literalTokens[e]||ce.none}_match(e,t){const r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new m2(e,t,this._line,this._start,this._current))}}function $t(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const ty=new Float32Array(1),Bz=new Uint32Array(ty.buffer),zz=new Uint32Array(ty.buffer),ny=new Int32Array(1),Uz=new Float32Array(ny.buffer),Vz=new Uint32Array(ny.buffer),ry=new Uint32Array(1),jz=new Float32Array(ry.buffer),$z=new Int32Array(ry.buffer);function g2(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return ty[0]=n,Bz[0];if(t==="u32")return ty[0]=n,zz[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return ny[0]=n,Uz[0];if(t==="u32")return ny[0]=n,Vz[0]}else if(e==="u32"){if(t==="f32")return ry[0]=n,jz[0];if(t==="i32"||t==="x32")return ry[0]=n,$z[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class Wz{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class c_{constructor(e,t){this.align=e,this.size=t}}class Ac{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Pz,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof rg&&this._functions.set(t.name,new Wz(t));for(const t of e)if(t instanceof Tu){const r=this.getTypeInfo(t,null);r instanceof xh&&this.structs.push(r)}for(const t of e)if(t instanceof Ab)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Tb){const r=t,o=this._getAttributeNum(r.attributes,"id",0),c=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new Tz(r.name,c,r.attributes,o));continue}if(this._isUniformVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),c=this._getAttributeNum(r.attributes,"binding",0),d=this.getTypeInfo(r.type,r.attributes),a=new l_(r.name,d,o,c,r.attributes,_h.Uniform,r.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),c=this._getAttributeNum(r.attributes,"binding",0),d=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(d),v=new l_(r.name,d,o,c,r.attributes,a?_h.StorageTexture:_h.Storage,r.access);v.access||(v.access="read"),this.storage.push(v);continue}if(this._isTextureVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),c=this._getAttributeNum(r.attributes,"binding",0),d=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(d),v=new l_(r.name,d,o,c,r.attributes,a?_h.StorageTexture:_h.Texture,r.access);v.access||(v.access="read"),a?this.storage.push(v):this.textures.push(v);continue}if(this._isSamplerVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),c=this._getAttributeNum(r.attributes,"binding",0),d=this.getTypeInfo(r.type,r.attributes),a=new l_(r.name,d,o,c,r.attributes,_h.Sampler,r.access);this.samplers.push(a);continue}}for(const t of e)if(t instanceof rg){const r=this._getAttribute(t,"vertex"),o=this._getAttribute(t,"fragment"),c=this._getAttribute(t,"compute"),d=r||o||c,a=new Az(t.name,d?.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,d&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!d),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[d.name].push(a)),a.arguments=t.args.map(v=>new Sz(v.name,this.getTypeInfo(v.type,v.attributes),v.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(r=>{var o,c,d;if(r instanceof pC){if(r.value)if($t(r.value))for(const a of r.value)for(const v of this.overrides)a===v.name&&((o=t.info)===null||o===void 0||o.overrides.push(v));else for(const a of this.overrides)r.value===a.name&&((c=t.info)===null||c===void 0||c.overrides.push(a))}else if(r instanceof Qo)for(const a of this.overrides)r.name===a.name&&((d=t.info)===null||d===void 0||d.overrides.push(a))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(const o of e.calls){const c=(r=this._functions.get(o.name))===null||r===void 0?void 0:r.info;c&&t.add(c)}}findResource(e,t,r){if(r){for(const o of this.entry.compute)if(o.name===r){for(const c of o.resources)if(c.group==e&&c.binding==t)return c}for(const o of this.entry.vertex)if(o.name===r){for(const c of o.resources)if(c.group==e&&c.binding==t)return c}for(const o of this.entry.fragment)if(o.name===r){for(const c of o.resources)if(c.group==e&&c.binding==t)return c}}for(const o of this.uniforms)if(o.group==e&&o.binding==t)return o;for(const o of this.storage)if(o.group==e&&o.binding==t)return o;for(const o of this.textures)if(o.group==e&&o.binding==t)return o;for(const o of this.samplers)if(o.group==e&&o.binding==t)return o;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const r=[],o=this,c=[];return e.search(d=>{if(d instanceof Q_)c.push({});else if(d instanceof ey)c.pop();else if(d instanceof Au){const a=d;t&&a.type!==null&&this._markStructsFromAST(a.type),c.length>0&&(c[c.length-1][a.name]=a)}else if(d instanceof wc){const a=d;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(d instanceof $m){const a=d;t&&a.type!==null&&this._markStructsFromAST(a.type),c.length>0&&(c[c.length-1][a.name]=a)}else if(d instanceof Qo){const a=d;if(c.length>0&&c[c.length-1][a.name])return;const v=o._findResource(a.name);v&&r.push(v)}else if(d instanceof Pb){const a=d,v=o._functions.get(a.name);v&&(t&&(v.inUse=!0),e.calls.add(v.node),v.resources===null&&(v.resources=o._findResources(v.node,t)),r.push(...v.resources))}else if(d instanceof Sb){const a=d,v=o._functions.get(a.name);v&&(t&&(v.inUse=!0),e.calls.add(v.node),v.resources===null&&(v.resources=o._findResources(v.node,t)),r.push(...v.resources))}}),[...new Map(r.map(d=>[d.name,d])).values()]}getBindGroups(){const e=[];function t(r,o){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),o>=e[r].length&&(e[r].length=o+1)}for(const r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Tu)this._getStructOutputs(e,t);else{const r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(const r of e.members)if(r.type instanceof Tu)this._getStructOutputs(r.type,t);else{const o=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(o!==null){const c=this.getTypeInfo(r.type,r.type.attributes),d=this._parseInt(o.value),a=new u2(r.name,c,o.name,d);t.push(a)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this.getTypeInfo(e,e.attributes),o=this._parseInt(t.value);return new u2("",r,t.name,o)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const r of e)if(r.type instanceof Tu)this._getStructInputs(r.type,t);else{const o=this._getInputInfo(r);o!==null&&t.push(o)}return t}_getStructInputs(e,t){for(const r of e.members)if(r.type instanceof Tu)this._getStructInputs(r.type,t);else{const o=this._getInputInfo(r);o!==null&&t.push(o)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this._getAttribute(e,"interpolation"),o=this.getTypeInfo(e.type,e.attributes),c=this._parseInt(t.value),d=new wz(e.name,o,t.name,c);return r!==null&&(d.interpolation=this._parseString(r.value)),d}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new bz(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof R_){const o=e.type?this.getTypeInfo(e.type,e.attributes):null,c=new G0(e.name,o,t);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof Wm){const o=e,c=o.format?this.getTypeInfo(o.format,o.attributes):null,d=new Ah(o.name,t);return d.format=c,d.count=o.count,this._types.set(e,d),this._updateTypeInfo(d),d}if(e instanceof Tu){const o=e,c=new xh(o.name,t);c.startLine=o.startLine,c.endLine=o.endLine;for(const d of o.members){const a=this.getTypeInfo(d.type,d.attributes);c.members.push(new c2(d.name,a,d.attributes))}return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof Rm){const o=e,c=o.format instanceof _t,d=o.format?c?this.getTypeInfo(o.format,null):new Ra(o.format,null):null,a=new Vd(o.name,d,t,o.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Xe){const o=e,c=o.format?this.getTypeInfo(o.format,null):null,d=new Vd(o.name,c,t,o.access);return this._types.set(e,d),this._updateTypeInfo(d),d}const r=new Ra(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,o;const c=this._getTypeSize(e);if(e.size=(t=c?.size)!==null&&t!==void 0?t:0,e instanceof Ah&&e.format){const d=this._getTypeSize(e.format);e.stride=Math.max((r=d?.size)!==null&&r!==void 0?r:0,(o=d?.align)!==null&&o!==void 0?o:0),this._updateTypeInfo(e.format)}e instanceof G0&&this._updateTypeInfo(e.format),e instanceof xh&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,o=0,c=0,d=0;for(let a=0,v=e.members.length;a<v;++a){const A=e.members[a],P=this._getTypeSize(A);if(!P)continue;(t=this._getAlias(A.type.name))!==null&&t!==void 0||A.type;const k=P.align,L=P.size;r=this._roundUp(k,r+o),o=L,c=r,d=Math.max(d,k),A.offset=r,A.size=L,this._updateTypeInfo(A.type)}e.size=this._roundUp(d,c+o),e.align=d}_getTypeSize(e){var t,r;if(e==null)return null;const o=this._getAttributeNum(e.attributes,"size",0),c=this._getAttributeNum(e.attributes,"align",0);if(e instanceof c2&&(e=e.type),e instanceof Ra){const d=this._getAlias(e.name);d!==null&&(e=d)}{const d=Ac._typeInfo[e.name];if(d!==void 0){const a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new c_(Math.max(c,d.align/a),Math.max(o,d.size/a))}}{const d=Ac._typeInfo[e.name.substring(0,e.name.length-1)];if(d){const a=e.name[e.name.length-1]==="h"?2:1;return new c_(Math.max(c,d.align/a),Math.max(o,d.size/a))}}if(e instanceof Ah){let d=e,a=8,v=8;const A=this._getTypeSize(d.format);return A!==null&&(v=A.size,a=A.align),v=d.count*this._getAttributeNum((r=e?.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,v)),o&&(v=o),new c_(Math.max(c,a),Math.max(o,v))}if(e instanceof xh){let d=0,a=0,v=0,A=0,P=0;for(const k of e.members){const L=this._getTypeSize(k.type);L!==null&&(d=Math.max(L.align,d),v=this._roundUp(L.align,v+A),A=L.size,P=v)}return a=this._roundUp(d,P+A),new c_(Math.max(c,d),Math.max(o,a))}return null}_isUniformVar(e){return e instanceof Au&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Au&&e.storage=="storage"}_isTextureVar(e){return e instanceof Au&&e.type!==null&&Ac._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Au&&e.type!==null&&Ac._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const r=e;if(!r||!r.attributes)return null;const o=r.attributes;for(let c of o)if(c.name==t)return c;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let o of e)if(o.name==t){let c=o!==null&&o.value!==null?o.value:r;return c instanceof Array&&(c=c[0]),typeof c=="number"?c:typeof c=="string"?parseInt(c):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}Ac._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Ac._textureTypes=ce.any_texture_type.map(n=>n.name),Ac._samplerTypes=ce.sampler_type.map(n=>n.name);let Eb=0;class Cb{constructor(e,t,r){this.id=Eb++,this.name=e,this.value=t,this.node=r}clone(){return new Cb(this.name,this.value,this.node)}}class Ib{constructor(e){this.id=Eb++,this.name=e.name,this.node=e}clone(){return new Ib(this.node)}}class Mb{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Eb++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new Cb(e,t,r??null))}setVariable(e,t,r){const o=this.getVariable(e);o!==null?o.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;const r=this.getVariable(e);return(t=r?.value)!==null&&t!==void 0?t:null}clone(){return new Mb(this)}}class Hz{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class Zz{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const r=this.exec.evalExpression(e.args[0],t);let o=!0;if(r instanceof ge)return r.data.forEach(c=>{c||(o=!1)}),new We(o?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge){const o=r.data.some(c=>c);return new We(o?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof We))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.evalExpression(r,t);if(o instanceof oi&&o.typeInfo.size===0){const c=o.typeInfo,d=o.buffer.byteLength/c.stride;return new We(d,this.getTypeInfo("u32"))}return new We(o.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.abs(c)),r.typeInfo);const o=r;return new We(Math.abs(o.value),o.typeInfo)}Acos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.acos(c)),r.typeInfo);const o=r;return new We(Math.acos(o.value),r.typeInfo)}Acosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.acosh(c)),r.typeInfo);const o=r;return new We(Math.acosh(o.value),r.typeInfo)}Asin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.asin(c)),r.typeInfo);const o=r;return new We(Math.asin(o.value),r.typeInfo)}Asinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.asinh(c)),r.typeInfo);const o=r;return new We(Math.asinh(o.value),r.typeInfo)}Atan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.atan(c)),r.typeInfo);const o=r;return new We(Math.atan(o.value),r.typeInfo)}Atanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.atanh(c)),r.typeInfo);const o=r;return new We(Math.atanh(o.value),r.typeInfo)}Atan2(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ge&&o instanceof ge)return new ge(r.data.map((a,v)=>Math.atan2(a,o.data[v])),r.typeInfo);const c=r,d=o;return new We(Math.atan2(c.value,d.value),r.typeInfo)}Ceil(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.ceil(c)),r.typeInfo);const o=r;return new We(Math.ceil(o.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(r instanceof ge&&o instanceof ge&&c instanceof ge)return new ge(r.data.map((A,P)=>this._clamp(A,o.data[P],c.data[P])),r.typeInfo);const d=r,a=o,v=c;return new We(this._clamp(d.value,a.value,v.value),r.typeInfo)}Cos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.cos(c)),r.typeInfo);const o=r;return new We(Math.cos(o.value),r.typeInfo)}Cosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.cosh(c)),r.typeInfo);const o=r;return new We(Math.cos(o.value),r.typeInfo)}CountLeadingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.clz32(c)),r.typeInfo);const o=r;return new We(Math.clz32(o.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>this._countOneBits(c)),r.typeInfo);const o=r;return new We(this._countOneBits(o.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>this._countTrailingZeros(c)),r.typeInfo);const o=r;return new We(this._countTrailingZeros(o.value),r.typeInfo)}Cross(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ge&&o instanceof ge){if(r.data.length!==3||o.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const c=r.data,d=o.data;return new ge([c[1]*d[2]-d[1]*c[2],c[2]*d[0]-d[2]*c[0],c[0]*d[1]-d[0]*c[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const r=this.exec.evalExpression(e.args[0],t),o=180/Math.PI;return r instanceof ge?new ge(r.data.map(c=>c*o),r.typeInfo):new We(r.value*o,this.getTypeInfo("f32"))}Determinant(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof xn){const o=r.data,c=r.typeInfo.getTypeName(),d=c.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(c==="mat2x2"||c==="mat2x2f"||c==="mat2x2h")return new We(o[0]*o[3]-o[1]*o[2],d);if(c==="mat2x3"||c==="mat2x3f"||c==="mat2x3h")return new We(o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6]),d);if(c==="mat2x4"||c==="mat2x4f"||c==="mat2x4h")console.error(`TODO: Determinant for ${c}`);else if(c==="mat3x2"||c==="mat3x2f"||c==="mat3x2h")console.error(`TODO: Determinant for ${c}`);else{if(c==="mat3x3"||c==="mat3x3f"||c==="mat3x3h")return new We(o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6]),d);c==="mat3x4"||c==="mat3x4f"||c==="mat3x4h"||c==="mat4x2"||c==="mat4x2f"||c==="mat4x2h"||c==="mat4x3"||c==="mat4x3f"||c==="mat4x3h"?console.error(`TODO: Determinant for ${c}`):c!=="mat4x4"&&c!=="mat4x4f"&&c!=="mat4x4h"||console.error(`TODO: Determinant for ${c}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ge&&o instanceof ge){let a=0;for(let v=0;v<r.data.length;++v)a+=(r.data[v]-o.data[v])*(r.data[v]-o.data[v]);return new We(Math.sqrt(a),this.getTypeInfo("f32"))}const c=r,d=o;return new We(Math.abs(c.value-d.value),r.typeInfo)}_dot(e,t){let r=0;for(let o=0;o<e.length;++o)r+=t[o]*e[o];return r}Dot(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);return r instanceof ge&&o instanceof ge?new We(this._dot(r.data,o.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.exp(c)),r.typeInfo);const o=r;return new We(Math.exp(o.value),r.typeInfo)}Exp2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.pow(2,c)),r.typeInfo);const o=r;return new We(Math.pow(2,o.value),r.typeInfo)}ExtractBits(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const d=o.value,a=c.value;if(r instanceof ge)return new ge(r.data.map(A=>A>>d&(1<<a)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const v=r.value;return new We(v>>d&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(r instanceof ge&&o instanceof ge&&c instanceof ge){const d=this._dot(o.data,c.data);return new ge(d<0?Array.from(r.data):r.data.map(a=>-a),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>this._firstLeadingBit(c)),r.typeInfo);const o=r;return new We(this._firstLeadingBit(o.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>this._firstTrailingBit(c)),r.typeInfo);const o=r;return new We(this._firstTrailingBit(o.value),r.typeInfo)}Floor(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.floor(c)),r.typeInfo);const o=r;return new We(Math.floor(o.value),r.typeInfo)}Fma(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(r instanceof ge&&o instanceof ge&&c instanceof ge)return r.data.length!==o.data.length||r.data.length!==c.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new ge(r.data.map((A,P)=>A*o.data[P]+c.data[P]),r.typeInfo);const d=r,a=o,v=c;return new We(d.value*a.value+v.value,d.typeInfo)}Fract(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>c-Math.floor(c)),r.typeInfo);const o=r;return new We(o.value-Math.floor(o.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t),d=this.exec.evalExpression(e.args[3],t);if(c.typeInfo.name!=="u32"&&c.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=c.value,v=(1<<d.value)-1<<a,A=~v;if(r instanceof ge&&o instanceof ge)return new ge(r.data.map((L,z)=>L&A|o.data[z]<<a&v),r.typeInfo);const P=r.value,k=o.value;return new We(P&A|k<<a&v,r.typeInfo)}InverseSqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>1/Math.sqrt(c)),r.typeInfo);const o=r;return new We(1/Math.sqrt(o.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge){let c=0;return r.data.forEach(d=>{c+=d*d}),new We(Math.sqrt(c),this.getTypeInfo("f32"))}const o=r;return new We(Math.abs(o.value),r.typeInfo)}Log(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.log(c)),r.typeInfo);const o=r;return new We(Math.log(o.value),r.typeInfo)}Log2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.log2(c)),r.typeInfo);const o=r;return new We(Math.log2(o.value),r.typeInfo)}Max(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ge&&o instanceof ge)return new ge(r.data.map((a,v)=>Math.max(a,o.data[v])),r.typeInfo);const c=r,d=o;return new We(Math.max(c.value,d.value),r.typeInfo)}Min(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ge&&o instanceof ge)return new ge(r.data.map((a,v)=>Math.min(a,o.data[v])),r.typeInfo);const c=r,d=o;return new We(Math.min(c.value,d.value),r.typeInfo)}Mix(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(r instanceof ge&&o instanceof ge&&c instanceof ge)return new ge(r.data.map((v,A)=>r.data[A]*(1-c.data[A])+o.data[A]*c.data[A]),r.typeInfo);const d=o,a=c;return new We(r.value*(1-a.value)+d.value*a.value,r.typeInfo)}Modf(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ge&&o instanceof ge)return new ge(r.data.map((d,a)=>d%o.data[a]),r.typeInfo);const c=o;return new We(r.value%c.value,r.typeInfo)}Normalize(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge){const o=this.Length(e,t).value;return new ge(r.data.map(c=>c/o),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ge&&o instanceof ge)return new ge(r.data.map((a,v)=>Math.pow(a,o.data[v])),r.typeInfo);const c=r,d=o;return new We(Math.pow(c.value,d.value),r.typeInfo)}QuantizeToF16(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof ge?new ge(r.data.map(o=>o),r.typeInfo):new We(r.value,r.typeInfo)}Radians(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof ge?new ge(r.data.map(o=>o*Math.PI/180),r.typeInfo):new We(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ge&&o instanceof ge){const c=this._dot(r.data,o.data);return new ge(r.data.map((d,a)=>d-2*c*o.data[a]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(r instanceof ge&&o instanceof ge&&c instanceof We){const d=this._dot(o.data,r.data);return new ge(r.data.map((a,v)=>{const A=1-c.value*c.value*(1-d*d);if(A<0)return 0;const P=Math.sqrt(A);return c.value*a-(c.value*d+P)*o.data[v]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.round(c)),r.typeInfo);const o=r;return new We(Math.round(o.value),r.typeInfo)}Saturate(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.min(Math.max(c,0),1)),r.typeInfo);const o=r;return new We(Math.min(Math.max(o.value,0),1),r.typeInfo)}Sign(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.sign(c)),r.typeInfo);const o=r;return new We(Math.sign(o.value),r.typeInfo)}Sin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.sin(c)),r.typeInfo);const o=r;return new We(Math.sin(o.value),r.typeInfo)}Sinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.sinh(c)),r.typeInfo);const o=r;return new We(Math.sinh(o.value),r.typeInfo)}_smoothstep(e,t,r){const o=Math.min(Math.max((r-e)/(t-e),0),1);return o*o*(3-2*o)}SmoothStep(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),c=this.exec.evalExpression(e.args[2],t);if(c instanceof ge&&r instanceof ge&&o instanceof ge)return new ge(c.data.map((A,P)=>this._smoothstep(r.data[P],o.data[P],A)),c.typeInfo);const d=r,a=o,v=c;return new We(this._smoothstep(d.value,a.value,v.value),c.typeInfo)}Sqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.sqrt(c)),r.typeInfo);const o=r;return new We(Math.sqrt(o.value),r.typeInfo)}Step(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(o instanceof ge&&r instanceof ge)return new ge(o.data.map((d,a)=>d<r.data[a]?0:1),o.typeInfo);const c=r;return new We(o.value<c.value?0:1,c.typeInfo)}Tan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.tan(c)),r.typeInfo);const o=r;return new We(Math.tan(o.value),r.typeInfo)}Tanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.tanh(c)),r.typeInfo);const o=r;return new We(Math.tanh(o.value),r.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof xn))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const o=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const c=r.data;return new xn([c[0],c[2],c[1],c[3]],o)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const c=r.data;return new xn([c[0],c[3],c[6],c[1],c[4],c[7]],o)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const c=r.data;return new xn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13]],o)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const c=r.data;return new xn([c[0],c[3],c[1],c[4],c[2],c[5]],o)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const c=r.data;return new xn([c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]],o)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const c=r.data;return new xn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14]],o)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const c=r.data;return new xn([c[0],c[4],c[1],c[5],c[2],c[6]],o)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const c=r.data;return new xn([c[0],c[4],c[8],c[1],c[5],c[9],c[2],c[6],c[10]],o)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const c=r.data;return new xn([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14],c[3],c[7],c[11],c[15]],o)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ge)return new ge(r.data.map(c=>Math.trunc(c)),r.typeInfo);const o=r;return new We(Math.trunc(o.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const r=e.args[0],o=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof Qo){const c=r.name,d=t.getVariableValue(c);if(d instanceof Su){if(o<0||o>=d.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=d.getMipLevelSize(o),v=d.dimension;return v==="1d"?new We(a[0],this.getTypeInfo("u32")):v==="3d"?new ge(a,this.getTypeInfo("vec3u")):v==="2d"?new ge(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${v} not found. Line ${e.line}`),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const r=e.args[0],o=this.exec.evalExpression(e.args[1],t),c=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(o instanceof ge)||o.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Qo){const d=r.name,a=t.getVariableValue(d);if(a instanceof Su){const v=Math.floor(o.data[0]),A=Math.floor(o.data[1]);if(v<0||v>=a.width||A<0||A>=a.height)return console.error(`Texture ${d} out of bounds. Line ${e.line}`),null;const P=a.getPixel(v,A,0,c);return P===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new ge(P,this.getTypeInfo("vec4f"))}return console.error(`Texture ${d} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const r=e.args[0];if(r instanceof Qo){const o=r.name,c=t.getVariableValue(o);return c instanceof Su?new We(c.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const r=e.args[0];if(r instanceof Qo){const o=r.name,c=t.getVariableValue(o);return c instanceof Su?new We(c.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const r=e.args[0];if(r instanceof Qo){const o=r.name,c=t.getVariableValue(o);return c instanceof Su?new We(c.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const r=e.args[0],o=this.exec.evalExpression(e.args[1],t),c=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,d=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(d.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(o instanceof ge)||o.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Qo){const a=r.name,v=t.getVariableValue(a);if(v instanceof Su){const A=v.getMipLevelSize(0),P=Math.floor(o.data[0]),k=Math.floor(o.data[1]);return P<0||P>=A[0]||k<0||k>=A[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(v.setPixel(P,k,0,c,Array.from(d)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.getVariableName(r,t);return t.getVariable(o).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,r.postfix,t);return v instanceof We&&a instanceof We&&(v.value=a.value),c.value instanceof oi&&c.value.setDataValue(this.exec,v,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,r.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value+=a.value),c.value instanceof oi&&c.value.setDataValue(this.exec,v,r.postfix,t),A}AtomicSub(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,r.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value-=a.value),c.value instanceof oi&&c.value.setDataValue(this.exec,v,r.postfix,t),A}AtomicMax(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,r.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=Math.max(v.value,a.value)),c.value instanceof oi&&c.value.setDataValue(this.exec,v,r.postfix,t),A}AtomicMin(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,r.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=Math.min(v.value,a.value)),c.value instanceof oi&&c.value.setDataValue(this.exec,v,r.postfix,t),A}AtomicAnd(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,r.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=v.value&a.value),c.value instanceof oi&&c.value.setDataValue(this.exec,v,r.postfix,t),A}AtomicOr(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,r.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=v.value|a.value),c.value instanceof oi&&c.value.setDataValue(this.exec,v,r.postfix,t),A}AtomicXor(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,r.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=v.value^a.value),c.value instanceof oi&&c.value.setDataValue(this.exec,v,r.postfix,t),A}AtomicExchange(e,t){let r=e.args[0];r instanceof Ii&&(r=r.right);const o=this.exec.getVariableName(r,t),c=t.getVariable(o);let d=e.args[1];const a=this.exec.evalExpression(d,t),v=c.value.getSubData(this.exec,r.postfix,t),A=new We(v.value,v.typeInfo);return v instanceof We&&a instanceof We&&(v.value=a.value),c.value instanceof oi&&c.value.setDataValue(this.exec,v,r.postfix,t),A}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Xv={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},ro={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Ns extends Hz{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new Ac,this.reflection.updateAST(this.ast),this.context=(r=t?.clone())!==null&&r!==void 0?r:new Mb,this.builtins=new Zz(this),this.typeInfo={bool:this.getTypeInfo(_t.bool),i32:this.getTypeInfo(_t.i32),u32:this.getTypeInfo(_t.u32),f32:this.getTypeInfo(_t.f32),f16:this.getTypeInfo(_t.f16),vec2f:this.getTypeInfo(Xe.vec2f),vec2u:this.getTypeInfo(Xe.vec2u),vec2i:this.getTypeInfo(Xe.vec2i),vec2h:this.getTypeInfo(Xe.vec2h),vec3f:this.getTypeInfo(Xe.vec3f),vec3u:this.getTypeInfo(Xe.vec3u),vec3i:this.getTypeInfo(Xe.vec3i),vec3h:this.getTypeInfo(Xe.vec3h),vec4f:this.getTypeInfo(Xe.vec4f),vec4u:this.getTypeInfo(Xe.vec4u),vec4i:this.getTypeInfo(Xe.vec4i),vec4h:this.getTypeInfo(Xe.vec4h),mat2x2f:this.getTypeInfo(Xe.mat2x2f),mat2x3f:this.getTypeInfo(Xe.mat2x3f),mat2x4f:this.getTypeInfo(Xe.mat2x4f),mat3x2f:this.getTypeInfo(Xe.mat3x2f),mat3x3f:this.getTypeInfo(Xe.mat3x3f),mat3x4f:this.getTypeInfo(Xe.mat3x4f),mat4x2f:this.getTypeInfo(Xe.mat4x2f),mat4x3f:this.getTypeInfo(Xe.mat4x3f),mat4x4f:this.getTypeInfo(Xe.mat4x4f)}}getVariableValue(e){var t,r;const o=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;if(o===null)return null;if(o instanceof We)return o.value;if(o instanceof ge||o instanceof xn)return Array.from(o.data);if(o instanceof oi&&o.typeInfo instanceof Ah){if(o.typeInfo.format.name==="u32")return Array.from(new Uint32Array(o.buffer,o.offset,o.typeInfo.count));if(o.typeInfo.format.name==="i32")return Array.from(new Int32Array(o.buffer,o.offset,o.typeInfo.count));if(o.typeInfo.format.name==="f32")return Array.from(new Float32Array(o.buffer,o.offset,o.typeInfo.count))}return console.error(`Unsupported return variable type ${o.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,o){const c=this.context.clone();(o=o??{}).constants&&this._setOverrides(o.constants,c),this._execStatements(this.ast,c);const d=c.getFunction(e);if(!d)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const a=t[0],v=t[1],A=t[2],P=this.getTypeInfo("vec3u");c.setVariable("@num_workgroups",new ge(t,P));const k=this.reflection.getFunctionInfo(e);k===null&&console.error(`Function ${e} not found in reflection data`);for(const L in r)for(const z in r[L]){const G=r[L][z];c.variables.forEach(te=>{var re;const fe=te.node;if(fe?.attributes){let ve=null,le=null;for(const Se of fe.attributes)Se.name==="binding"?ve=Se.value:Se.name==="group"&&(le=Se.value);if(z==ve&&L==le){let Se=!1;for(const Ne of k.resources)if(Ne.name===te.name&&Ne.group===parseInt(L)&&Ne.binding===parseInt(z)){Se=!0;break}if(Se)if(G.texture!==void 0&&G.descriptor!==void 0){const Ne=new Su(G.texture,this.getTypeInfo(fe.type),G.descriptor,(re=G.texture.view)!==null&&re!==void 0?re:null);te.value=Ne}else G.uniform!==void 0?te.value=new oi(G.uniform,this.getTypeInfo(fe.type)):te.value=new oi(G,this.getTypeInfo(fe.type))}}})}for(let L=0;L<A;++L)for(let z=0;z<v;++z)for(let G=0;G<a;++G)c.setVariable("@workgroup_id",new ge([G,z,L],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(d,[G,z,L],c)}execStatement(e,t){if(e instanceof iC)return this.evalExpression(e.value,t);if(e instanceof oC){if(e.condition){const r=this.evalExpression(e.condition,t);if(!(r instanceof We))throw new Error("Invalid break-if condition");if(!r.value)return null}return Ns._breakObj}if(e instanceof aC)return Ns._continueObj;if(e instanceof $m)this._let(e,t);else if(e instanceof Au)this._var(e,t);else if(e instanceof M_)this._const(e,t);else if(e instanceof rg)this._function(e,t);else{if(e instanceof rC)return this._if(e,t);if(e instanceof nC)return this._switch(e,t);if(e instanceof JE)return this._for(e,t);if(e instanceof KE)return this._while(e,t);if(e instanceof tC)return this._loop(e,t);if(e instanceof Y0){const r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof eC)this._assign(e,t);else if(e instanceof QE)this._increment(e,t);else{if(e instanceof Tu)return null;if(e instanceof Tb){const r=e.name;t.getVariable(r)===null&&t.setVariable(r,new We(0,this.getTypeInfo("u32")))}else if(e instanceof Sb)this._call(e,t);else{if(e instanceof sC||e instanceof Ab)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Tl?this._evalBinaryOp(e,t):e instanceof Zi?this._evalLiteral(e,t):e instanceof Qo?this._evalVariable(e,t):e instanceof Pb?this._evalCall(e,t):e instanceof wc?this._evalCreate(e,t):e instanceof lC?this._evalConst(e,t):e instanceof cC?this._evalBitcast(e,t):e instanceof Ii?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof _t){const o=this.reflection.getTypeInfo(e);if(o!==null)return o}let r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(const r in e){const o=e[r],c=this.reflection.getOverrideInfo(r);c!==null?(c.type===null&&(c.type=this.getTypeInfo("u32")),c.type.name==="u32"||c.type.name==="i32"||c.type.name==="f32"||c.type.name==="f16"?t.setVariable(r,new We(o,c.type)):c.type.name==="bool"?t.setVariable(r,new We(o?1:0,c.type)):c.type.name==="vec2"||c.type.name==="vec3"||c.type.name==="vec4"||c.type.name==="vec2f"||c.type.name==="vec3f"||c.type.name==="vec4f"||c.type.name==="vec2i"||c.type.name==="vec3i"||c.type.name==="vec4i"||c.type.name==="vec2u"||c.type.name==="vec3u"||c.type.name==="vec4u"||c.type.name==="vec2h"||c.type.name==="vec3h"||c.type.name==="vec4h"?t.setVariable(r,new ge(o,c.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){const o=[1,1,1];for(const P of e.node.attributes)if(P.name==="workgroup_size"){if(P.value.length>0){const k=r.getVariableValue(P.value[0]);o[0]=k instanceof We?k.value:parseInt(P.value[0])}if(P.value.length>1){const k=r.getVariableValue(P.value[1]);o[1]=k instanceof We?k.value:parseInt(P.value[1])}if(P.value.length>2){const k=r.getVariableValue(P.value[2]);o[2]=k instanceof We?k.value:parseInt(P.value[2])}}const c=this.getTypeInfo("vec3u"),d=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new ge(o,c));const a=o[0],v=o[1],A=o[2];for(let P=0,k=0;P<A;++P)for(let L=0;L<v;++L)for(let z=0;z<a;++z,++k){const G=[z,L,P],te=[z+t[0]*o[0],L+t[1]*o[1],P+t[2]*o[2]];r.setVariable("@local_invocation_id",new ge(G,c)),r.setVariable("@global_invocation_id",new ge(te,c)),r.setVariable("@local_invocation_index",new We(k,d)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(const r of e.node.args)for(const o of r.attributes)if(o.name==="builtin"){const c=`@${o.value}`,d=t.getVariable(c);d!==void 0&&t.variables.set(r.name,d)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Ii;)e=e.right;return e instanceof Qo?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const r of e){if(r instanceof Array){const c=t.clone(),d=this._execStatements(r,c);if(d)return d;continue}const o=this.execStatement(r,t);if(o)return o}return null}_call(e,t){const r=t.clone();r.currentFunctionName=e.name;const o=t.getFunction(e.name);if(o){for(let c=0;c<o.node.args.length;++c){const d=o.node.args[c],a=this.evalExpression(e.args[c],r);r.setVariable(d.name,a,d)}this._execStatements(o.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const r=this.getVariableName(e.variable,t),o=t.getVariable(r);o?e.operator==="++"?o.value instanceof We?o.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?o.value instanceof We?o.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Qo){const r=this.getVariableName(e,t),o=t.getVariable(r);return o===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):o.value.getSubData(this,e.postfix,t)}if(e instanceof Ii){if(e.operator==="*"){const r=this._getVariableData(e.right,t);return r instanceof Gf?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,t);return new Gf(r)}}return null}_assign(e,t){let r=null,o="<var>",c=null;if(e.variable instanceof Ii){const v=this._getVariableData(e.variable,t),A=this.evalExpression(e.value,t),P=e.operator;if(P==="="){if(v instanceof We||v instanceof ge||v instanceof xn){if(A instanceof We||A instanceof ge||A instanceof xn&&v.data.length===A.data.length)return void v.data.set(A.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(v instanceof oi&&A instanceof oi&&v.buffer.byteLength-v.offset>=A.buffer.byteLength-A.offset)return void(v.buffer.byteLength%4==0?new Uint32Array(v.buffer,v.offset,v.typeInfo.size/4).set(new Uint32Array(A.buffer,A.offset,A.typeInfo.size/4)):new Uint8Array(v.buffer,v.offset,v.typeInfo.size).set(new Uint8Array(A.buffer,A.offset,A.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(P==="+=")return v instanceof We||v instanceof ge||v instanceof xn?A instanceof We||A instanceof ge||A instanceof xn?void v.data.set(A.data.map((k,L)=>v.data[L]+k)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(P==="-=")return(v instanceof We||v instanceof ge||v instanceof xn)&&(A instanceof We||A instanceof ge||A instanceof xn)?void v.data.set(A.data.map((k,L)=>v.data[L]-k)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Ii){if(e.variable.operator==="*"){o=this.getVariableName(e.variable.right,t);const v=t.getVariable(o);if(!(v&&v.value instanceof Gf))return void console.error(`Variable ${o} is not a pointer. Line ${e.line}`);r=v.value.reference;let A=e.variable.postfix;if(!A){let P=e.variable.right;for(;P instanceof Ii;){if(P.postfix){A=P.postfix;break}P=P.right}}A&&(r=r.getSubData(this,A,t))}}else{c=e.variable.postfix,o=this.getVariableName(e.variable,t);const v=t.getVariable(o);if(v===null)return void console.error(`Variable ${o} not found. Line ${e.line}`);r=v.value}if(r instanceof Gf&&(r=r.reference),r===null)return void console.error(`Variable ${o} not found. Line ${e.line}`);const d=this.evalExpression(e.value,t),a=e.operator;if(a!=="="){const v=r.getSubData(this,c,t);if(v instanceof ge&&d instanceof We){const A=v.data,P=d.value;if(a==="+=")for(let k=0;k<A.length;++k)A[k]+=P;else if(a==="-=")for(let k=0;k<A.length;++k)A[k]-=P;else if(a==="*=")for(let k=0;k<A.length;++k)A[k]*=P;else if(a==="/=")for(let k=0;k<A.length;++k)A[k]/=P;else if(a==="%=")for(let k=0;k<A.length;++k)A[k]%=P;else if(a==="&=")for(let k=0;k<A.length;++k)A[k]&=P;else if(a==="|=")for(let k=0;k<A.length;++k)A[k]|=P;else if(a==="^=")for(let k=0;k<A.length;++k)A[k]^=P;else if(a==="<<=")for(let k=0;k<A.length;++k)A[k]<<=P;else if(a===">>=")for(let k=0;k<A.length;++k)A[k]>>=P;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(v instanceof ge&&d instanceof ge){const A=v.data,P=d.data;if(A.length!==P.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let k=0;k<A.length;++k)A[k]+=P[k];else if(a==="-=")for(let k=0;k<A.length;++k)A[k]-=P[k];else if(a==="*=")for(let k=0;k<A.length;++k)A[k]*=P[k];else if(a==="/=")for(let k=0;k<A.length;++k)A[k]/=P[k];else if(a==="%=")for(let k=0;k<A.length;++k)A[k]%=P[k];else if(a==="&=")for(let k=0;k<A.length;++k)A[k]&=P[k];else if(a==="|=")for(let k=0;k<A.length;++k)A[k]|=P[k];else if(a==="^=")for(let k=0;k<A.length;++k)A[k]^=P[k];else if(a==="<<=")for(let k=0;k<A.length;++k)A[k]<<=P[k];else if(a===">>=")for(let k=0;k<A.length;++k)A[k]>>=P[k];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(v instanceof We&&d instanceof We))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?v.value+=d.value:a==="-="?v.value-=d.value:a==="*="?v.value*=d.value:a==="/="?v.value/=d.value:a==="%="?v.value%=d.value:a==="&="?v.value&=d.value:a==="|="?v.value|=d.value:a==="^="?v.value^=d.value:a==="<<="?v.value<<=d.value:a===">>="?v.value>>=d.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(r instanceof oi&&r.setDataValue(this,v,c,t))}if(r instanceof oi)r.setDataValue(this,d,c,t);else if(c){if(!(r instanceof ge||r instanceof xn))return void console.error(`Variable ${o} is not a vector or matrix. Line ${e.line}`);if(c instanceof yp){const v=this.evalExpression(c.index,t).value;if(r instanceof ge){if(!(d instanceof We))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[v]=d.value}else{if(!(r instanceof xn))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);{const A=this.evalExpression(c.index,t).value;if(A<0)return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(!(d instanceof ge))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);{const P=r.typeInfo.getTypeName();if(P==="mat2x2"||P==="mat2x2f"||P==="mat2x2h"){if(!(A<2&&d.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[2*A]=d.data[0],r.data[2*A+1]=d.data[1]}else if(P==="mat2x3"||P==="mat2x3f"||P==="mat2x3h"){if(!(A<2&&d.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[3*A]=d.data[0],r.data[3*A+1]=d.data[1],r.data[3*A+2]=d.data[2]}else if(P==="mat2x4"||P==="mat2x4f"||P==="mat2x4h"){if(!(A<2&&d.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[4*A]=d.data[0],r.data[4*A+1]=d.data[1],r.data[4*A+2]=d.data[2],r.data[4*A+3]=d.data[3]}else if(P==="mat3x2"||P==="mat3x2f"||P==="mat3x2h"){if(!(A<3&&d.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[2*A]=d.data[0],r.data[2*A+1]=d.data[1]}else if(P==="mat3x3"||P==="mat3x3f"||P==="mat3x3h"){if(!(A<3&&d.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[3*A]=d.data[0],r.data[3*A+1]=d.data[1],r.data[3*A+2]=d.data[2]}else if(P==="mat3x4"||P==="mat3x4f"||P==="mat3x4h"){if(!(A<3&&d.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[4*A]=d.data[0],r.data[4*A+1]=d.data[1],r.data[4*A+2]=d.data[2],r.data[4*A+3]=d.data[3]}else if(P==="mat4x2"||P==="mat4x2f"||P==="mat4x2h"){if(!(A<4&&d.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[2*A]=d.data[0],r.data[2*A+1]=d.data[1]}else if(P==="mat4x3"||P==="mat4x3f"||P==="mat4x3h"){if(!(A<4&&d.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[3*A]=d.data[0],r.data[3*A+1]=d.data[1],r.data[3*A+2]=d.data[2]}else{if(P!=="mat4x4"&&P!=="mat4x4f"&&P!=="mat4x4h")return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(!(A<4&&d.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[4*A]=d.data[0],r.data[4*A+1]=d.data[1],r.data[4*A+2]=d.data[2],r.data[4*A+3]=d.data[3]}}}}}else if(c instanceof jd){const v=c.value;if(!(r instanceof ge))return void console.error(`Invalid assignment to ${v}. Variable ${o} is not a vector. Line ${e.line}`);if(d instanceof We){if(v.length>1)return void console.error(`Invalid assignment to ${v} for variable ${o}. Line ${e.line}`);if(v==="x")r.data[0]=d.value;else if(v==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${v} for variable ${o}. Line ${e.line}`);r.data[1]=d.value}else if(v==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${v} for variable ${o}. Line ${e.line}`);r.data[2]=d.value}else if(v==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${v} for variable ${o}. Line ${e.line}`);r.data[3]=d.value}}else{if(!(d instanceof ge))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(v.length!==d.data.length)return void console.error(`Invalid assignment to ${v} for variable ${o}. Line ${e.line}`);for(let A=0;A<v.length;++A){const P=v[A];if(P==="x"||P==="r")r.data[0]=d.data[A];else if(P==="y"||P==="g"){if(d.data.length<2)return void console.error(`Invalid assignment to ${P} for variable ${o}. Line ${e.line}`);r.data[1]=d.data[A]}else if(P==="z"||P==="b"){if(d.data.length<3)return void console.error(`Invalid assignment to ${P} for variable ${o}. Line ${e.line}`);r.data[2]=d.data[A]}else{if(P!=="w"&&P!=="a")return void console.error(`Invalid assignment to ${P} for variable ${o}. Line ${e.line}`);if(d.data.length<4)return void console.error(`Invalid assignment to ${P} for variable ${o}. Line ${e.line}`);r.data[3]=d.data[A]}}}}}else r instanceof We&&d instanceof We?r.value=d.value:r instanceof ge&&d instanceof ge||r instanceof xn&&d instanceof xn?r.data.set(d.data):console.error(`Invalid assignment to ${o}. Line ${e.line}`)}_function(e,t){const r=new Ib(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!==null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Ii||(r=r.clone())}else{const o=e.type.name;if(o==="f32"||o==="i32"||o==="u32"||o==="bool"||o==="f16"||o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2b"||o==="vec3b"||o==="vec4b"||o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"||o==="array"){const c=new wc(e.type,[]);r=this._evalCreate(c,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Ii||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const o=e.type.name;if(o==="f32"||o==="i32"||o==="u32"||o==="bool"||o==="f16"||o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2b"||o==="vec3b"||o==="vec4b"||o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"||e.type instanceof Wm||e.type instanceof Tu||e.type instanceof Xe){const c=new wc(e.type,[]);r=this._evalCreate(c,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof We))return console.error(`Invalid if condition. Line ${e.line}`),null;let o=null;for(const c of e.cases)if(c instanceof dC)for(const d of c.selectors){if(d instanceof k_){o=c;continue}const a=this.evalExpression(d,t);if(!(a instanceof We))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(c.body,t)}else c instanceof fC&&(o=c);return o?this._execStatements(o.body,t):null}_if(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof We))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(const o of e.elseif){const c=this.evalExpression(o.condition,t);if(!(c instanceof We))return console.error(`Invalid if condition. Line ${e.line}`),null;if(c.value)return this._execStatements(o.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof We?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===Ns._breakObj)break;if(r!==null&&r!==Ns._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const r=this._execStatements(e.body,t);if(r===Ns._breakObj)break;if(r===Ns._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Ns._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===Ns._breakObj)break;if(r!==Ns._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){const r=this.evalExpression(e.value,t),o=e.type;if(r instanceof We){const c=g2(r.value,r.typeInfo.name,o.name);return new We(c,this.getTypeInfo(o))}if(r instanceof ge){const c=r.typeInfo.getTypeName();let d="";if(c.endsWith("f"))d="f32";else if(c.endsWith("i"))d="i32";else if(c.endsWith("u"))d="u32";else if(c.endsWith("b"))d="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${c}. Line ${e.line}`),null;d="f16"}const a=o.getTypeName();let v="";if(a.endsWith("f"))v="f32";else if(a.endsWith("i"))v="i32";else if(a.endsWith("u"))v="u32";else if(a.endsWith("b"))v="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${v}. Line ${e.line}`),null;v="f16"}const A=(function(P,k,L){if(k===L)return P;const z=new Array(P.length);for(let G=0;G<P.length;G++)z[G]=g2(P[G],k,L);return z})(Array.from(r.data),d,v);return new ge(A,this.getTypeInfo(o))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof wc){if(e.type===null)return K0.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const o=e instanceof wc?e.type.name:e.name,c=e instanceof wc?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(c===null)return console.error(`Unknown type ${o}. Line ${e.line}`),null;if(c.size===0)return null;const d=new oi(new ArrayBuffer(c.size),c,0);if(c instanceof xh){if(e.args)for(let a=0;a<e.args.length;++a){const v=c.members[a],A=e.args[a],P=this.evalExpression(A,t);d.setData(this,P,v.type,v.offset,t)}}else if(c instanceof Ah){let a=0;if(e.args)for(let v=0;v<e.args.length;++v){const A=e.args[v],P=this.evalExpression(A,t);c.format===null&&(((r=P.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?c.format=this.getTypeInfo("i32"):c.format=P.typeInfo),d.setData(this,P,c.format,a,t),a+=c.stride}}else console.error(`Unknown type "${o}". Line ${e.line}`);return e instanceof wc?d.getSubData(this,e.postfix,t):d}_evalLiteral(e,t){const r=this.getTypeInfo(e.type),o=r.name;return o==="x32"||o==="u32"||o==="f32"||o==="f16"||o==="i32"||o==="bool"?new We(e.scalarValue,r):o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"?this._callConstructorVec(e,t):o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const r=t.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const o=Ns._priority.get(t.name);Ns._priority.get(e[r].name)<o&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const r=this.evalExpression(e.right,t);if(e.operator==="&")return new Gf(r);if(e.operator==="*")return r instanceof Gf?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const o=r instanceof We?r.value:r instanceof ge?Array.from(r.data):null;switch(e.operator){case"+":{if($t(o)){const a=o.map((v,A)=>+v);return new ge(a,r.typeInfo)}const c=o,d=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new We(+c,d)}case"-":{if($t(o)){const a=o.map((v,A)=>-v);return new ge(a,r.typeInfo)}const c=o,d=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new We(-c,d)}case"!":{if($t(o)){const a=o.map((v,A)=>v?0:1);return new ge(a,r.typeInfo)}const c=o,d=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new We(c?0:1,d)}case"~":{if($t(o)){const a=o.map((v,A)=>~v);return new ge(a,r.typeInfo)}const c=o,d=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new We(~c,d)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const r=this.evalExpression(e.left,t),o=this.evalExpression(e.right,t),c=r instanceof We?r.value:r instanceof ge||r instanceof xn?Array.from(r.data):null,d=o instanceof We?o.value:o instanceof ge||o instanceof xn?Array.from(o.data):null;switch(e.operator){case"+":{if($t(c)&&$t(d)){const P=c,k=d;if(P.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=P.map((z,G)=>z+k[G]);return new ge(L,r.typeInfo)}if($t(c)){const P=d,k=c.map((L,z)=>L+P);return new ge(k,r.typeInfo)}if($t(d)){const P=c,k=d.map((L,z)=>P+L);return new ge(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new We(a+v,A)}case"-":{if($t(c)&&$t(d)){const P=c,k=d;if(P.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=P.map((z,G)=>z-k[G]);return new ge(L,r.typeInfo)}if($t(c)){const P=d,k=c.map((L,z)=>L-P);return new ge(k,r.typeInfo)}if($t(d)){const P=c,k=d.map((L,z)=>P-L);return new ge(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new We(a-v,A)}case"*":{if($t(c)&&$t(d)){const P=c,k=d;if(r instanceof xn&&o instanceof xn){const L=(function(re,fe,ve,le){if(ro[fe.name]===void 0||ro[le.name]===void 0)return null;const Se=ro[fe.name][0],Ne=ro[fe.name][1],nt=ro[le.name][0];if(Se!==ro[le.name][1])return null;const pt=new Array(nt*Ne);for(let mt=0;mt<Ne;mt++)for(let Tt=0;Tt<nt;Tt++){let Mt=0;for(let Zt=0;Zt<Se;Zt++)Mt+=re[Zt*Ne+mt]*ve[Tt*Se+Zt];pt[mt*nt+Tt]=Mt}return pt})(P,r.typeInfo,k,o.typeInfo);if(L===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const z=ro[o.typeInfo.name][0],G=ro[r.typeInfo.name][1],te=this.getTypeInfo(`mat${z}x${G}f`);return new xn(L,te)}if(r instanceof xn&&o instanceof ge){const L=(function(z,G,te,re){if(ro[G.name]===void 0||Xv[re.name]===void 0)return null;const fe=ro[G.name][0],ve=ro[G.name][1];if(fe!==te.length)return null;const le=new Array(ve);for(let Se=0;Se<ve;Se++){let Ne=0;for(let nt=0;nt<fe;nt++)Ne+=z[nt*ve+Se]*te[nt];le[Se]=Ne}return le})(P,r.typeInfo,k,o.typeInfo);return L===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ge(L,o.typeInfo)}if(r instanceof ge&&o instanceof xn){const L=(function(z,G,te,re){if(Xv[G.name]===void 0||ro[re.name]===void 0)return null;const fe=ro[re.name][0],ve=ro[re.name][1];if(ve!==z.length)return null;const le=[];for(let Se=0;Se<fe;Se++){let Ne=0;for(let nt=0;nt<ve;nt++)Ne+=z[nt]*te[nt*fe+Se];le[Se]=Ne}return le})(P,r.typeInfo,k,o.typeInfo);return L===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ge(L,r.typeInfo)}{if(P.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=P.map((z,G)=>z*k[G]);return new ge(L,r.typeInfo)}}if($t(c)){const P=d,k=c.map((L,z)=>L*P);return r instanceof xn?new xn(k,r.typeInfo):new ge(k,r.typeInfo)}if($t(d)){const P=c,k=d.map((L,z)=>P*L);return o instanceof xn?new xn(k,o.typeInfo):new ge(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new We(a*v,A)}case"%":{if($t(c)&&$t(d)){const P=c,k=d;if(P.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=P.map((z,G)=>z%k[G]);return new ge(L,r.typeInfo)}if($t(c)){const P=d,k=c.map((L,z)=>L%P);return new ge(k,r.typeInfo)}if($t(d)){const P=c,k=d.map((L,z)=>P%L);return new ge(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new We(a%v,A)}case"/":{if($t(c)&&$t(d)){const P=c,k=d;if(P.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=P.map((z,G)=>z/k[G]);return new ge(L,r.typeInfo)}if($t(c)){const P=d,k=c.map((L,z)=>L/P);return new ge(k,r.typeInfo)}if($t(d)){const P=c,k=d.map((L,z)=>P/L);return new ge(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new We(a/v,A)}case"&":{if($t(c)&&$t(d)){const P=c,k=d;if(P.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=P.map((z,G)=>z&k[G]);return new ge(L,r.typeInfo)}if($t(c)){const P=d,k=c.map((L,z)=>L&P);return new ge(k,r.typeInfo)}if($t(d)){const P=c,k=d.map((L,z)=>P&L);return new ge(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new We(a&v,A)}case"|":{if($t(c)&&$t(d)){const P=c,k=d;if(P.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=P.map((z,G)=>z|k[G]);return new ge(L,r.typeInfo)}if($t(c)){const P=d,k=c.map((L,z)=>L|P);return new ge(k,r.typeInfo)}if($t(d)){const P=c,k=d.map((L,z)=>P|L);return new ge(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new We(a|v,A)}case"^":{if($t(c)&&$t(d)){const P=c,k=d;if(P.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=P.map((z,G)=>z^k[G]);return new ge(L,r.typeInfo)}if($t(c)){const P=d,k=c.map((L,z)=>L^P);return new ge(k,r.typeInfo)}if($t(d)){const P=c,k=d.map((L,z)=>P^L);return new ge(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new We(a^v,A)}case"<<":{if($t(c)&&$t(d)){const P=c,k=d;if(P.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=P.map((z,G)=>z<<k[G]);return new ge(L,r.typeInfo)}if($t(c)){const P=d,k=c.map((L,z)=>L<<P);return new ge(k,r.typeInfo)}if($t(d)){const P=c,k=d.map((L,z)=>P<<L);return new ge(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new We(a<<v,A)}case">>":{if($t(c)&&$t(d)){const P=c,k=d;if(P.length!==k.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const L=P.map((z,G)=>z>>k[G]);return new ge(L,r.typeInfo)}if($t(c)){const P=d,k=c.map((L,z)=>L>>P);return new ge(k,r.typeInfo)}if($t(d)){const P=c,k=d.map((L,z)=>P>>L);return new ge(k,o.typeInfo)}const a=c,v=d,A=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new We(a>>v,A)}case">":if($t(c)&&$t(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((P,k)=>P>v[k]?1:0);return new ge(A,r.typeInfo)}if($t(c)){const a=d,v=c.map((A,P)=>A>a?1:0);return new ge(v,r.typeInfo)}if($t(d)){const a=c,v=d.map((A,P)=>a>A?1:0);return new ge(v,o.typeInfo)}return new We(c>d?1:0,this.getTypeInfo("bool"));case"<":if($t(c)&&$t(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((P,k)=>P<v[k]?1:0);return new ge(A,r.typeInfo)}if($t(c)){const a=d,v=c.map((A,P)=>A<a?1:0);return new ge(v,r.typeInfo)}if($t(d)){const a=c,v=d.map((A,P)=>a<A?1:0);return new ge(v,o.typeInfo)}return new We(c<d?1:0,this.getTypeInfo("bool"));case"==":if($t(c)&&$t(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((P,k)=>P===v[k]?1:0);return new ge(A,r.typeInfo)}if($t(c)){const a=d,v=c.map((A,P)=>A==a?1:0);return new ge(v,r.typeInfo)}if($t(d)){const a=c,v=d.map((A,P)=>a==A?1:0);return new ge(v,o.typeInfo)}return new We(c===d?1:0,this.getTypeInfo("bool"));case"!=":if($t(c)&&$t(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((P,k)=>P!==v[k]?1:0);return new ge(A,r.typeInfo)}if($t(c)){const a=d,v=c.map((A,P)=>A!==a?1:0);return new ge(v,r.typeInfo)}if($t(d)){const a=c,v=d.map((A,P)=>a!==A?1:0);return new ge(v,o.typeInfo)}return new We(c!==d?1:0,this.getTypeInfo("bool"));case">=":if($t(c)&&$t(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((P,k)=>P>=v[k]?1:0);return new ge(A,r.typeInfo)}if($t(c)){const a=d,v=c.map((A,P)=>A>=a?1:0);return new ge(v,r.typeInfo)}if($t(d)){const a=c,v=d.map((A,P)=>a>=A?1:0);return new ge(v,o.typeInfo)}return new We(c>=d?1:0,this.getTypeInfo("bool"));case"<=":if($t(c)&&$t(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((P,k)=>P<=v[k]?1:0);return new ge(A,r.typeInfo)}if($t(c)){const a=d,v=c.map((A,P)=>A<=a?1:0);return new ge(v,r.typeInfo)}if($t(d)){const a=c,v=d.map((A,P)=>a<=A?1:0);return new ge(v,o.typeInfo)}return new We(c<=d?1:0,this.getTypeInfo("bool"));case"&&":if($t(c)&&$t(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((P,k)=>P&&v[k]?1:0);return new ge(A,r.typeInfo)}if($t(c)){const a=d,v=c.map((A,P)=>A&&a?1:0);return new ge(v,r.typeInfo)}if($t(d)){const a=c,v=d.map((A,P)=>a&&A?1:0);return new ge(v,o.typeInfo)}return new We(c&&d?1:0,this.getTypeInfo("bool"));case"||":if($t(c)&&$t(d)){const a=c,v=d;if(a.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const A=a.map((P,k)=>P||v[k]?1:0);return new ge(A,r.typeInfo)}if($t(c)){const a=d,v=c.map((A,P)=>A||a?1:0);return new ge(v,r.typeInfo)}if($t(d)){const a=c,v=d.map((A,P)=>a||A?1:0);return new ge(v,o.typeInfo)}return new We(c||d?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=t.clone();r.currentFunctionName=e.name;const o=t.getFunction(e.name);if(!o)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let c=0;c<o.node.args.length;++c){const d=o.node.args[c],a=this.evalExpression(e.args[c],r);r.createVariable(d.name,a,d)}return this._execStatements(o.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const r=t.getFunction(e.name);if(r){const o=t.clone();for(let c=0;c<r.node.args.length;++c){const d=r.node.args[c],a=this.evalExpression(e.args[c],o);o.setVariable(d.name,a,d)}return this._execStatements(r.node.body,o)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new We(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const r=this.getTypeInfo(e.type),o=e.type.getTypeName(),c=Xv[o];if(c===void 0)return console.error(`Invalid vec constructor ${o}. Line ${e.line}`),null;const d=[];if(e instanceof Zi)if(e.isVector){const a=e.vectorValue;for(const v of a)d.push(v)}else d.push(e.scalarValue);else if(e.args)for(const a of e.args){const v=this.evalExpression(a,t);if(v instanceof ge){const A=v.data;for(let P=0;P<A.length;++P){let k=A[P];d.push(k)}}else if(v instanceof We){let A=v.value;d.push(A)}}if(e.type instanceof Xe&&e.type.format===null&&(e.type.format=Xe.f32),d.length===0){const a=new Array(c).fill(0);return new ge(a,r).getSubData(this,e.postfix,t)}if(d.length===1)for(;d.length<c;)d.push(d[0]);return d.length<c?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new ge(d.length>c?d.slice(0,c):d,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const r=this.getTypeInfo(e.type),o=e.type.getTypeName(),c=ro[o];if(c===void 0)return console.error(`Invalid matrix constructor ${o}. Line ${e.line}`),null;const d=[];if(e instanceof Zi)if(e.isVector){const a=e.vectorValue;for(const v of a)d.push(v)}else d.push(e.scalarValue);else if(e.args)for(const a of e.args){const v=this.evalExpression(a,t);v instanceof ge?d.push(...v.data):v instanceof We?d.push(v.value):v instanceof xn&&d.push(...v.data)}if(r instanceof Vd&&r.format===null&&(r.format=this.getTypeInfo("f32")),d.length===0){const a=new Array(c[2]).fill(0);return new xn(a,r).getSubData(this,e.postfix,t)}return d.length!==c[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new xn(d,r).getSubData(this,e.postfix,t)}}Ns._breakObj=new Fa(new Ra("BREAK",null),null),Ns._continueObj=new Fa(new Ra("CONTINUE",null),null),Ns._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Xz{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class qz{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Xz,this._exec=new Ns,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const o=r.arrayType,c=r.countNode;if(c instanceof Qo){const d=c.name,a=this._context.constants.get(d);if(a)try{const v=a.constEvaluate(this._exec);o.count=v}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of t)r.search(o=>{o instanceof p2||o instanceof R_?o.type=this._forwardType(o.type):o instanceof Wm?o.format=this._forwardType(o.format):o instanceof Au||o instanceof $m||o instanceof M_?o.type=this._forwardType(o.type):o instanceof rg?o.returnType=this._forwardType(o.returnType):o instanceof f2&&(o.type=this._forwardType(o.type))});return t}_forwardType(e){if(e instanceof d2){const t=this._getType(e.name);if(t)return t}else e instanceof R_?e.type=this._forwardType(e.type):e instanceof Wm&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new Nz(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ce.eof}_match(e){if(e instanceof Ze)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){const o=e[t];if(this._check(o))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const r=t.type;let o=!1;for(const c of e){if(r===c)return!0;c===ce.tokens.name&&(o=!0)}if(o){const c=ce.tokens.name.rule.exec(t.lexeme);if(c&&c.index==0&&c[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===ce.tokens.name){const r=ce.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ce.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ce.keywords.alias)){const t=this._type_alias();return this._consume(ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ce.keywords.diagnostic)){const t=this._diagnostic();return this._consume(ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ce.keywords.requires)){const t=this._requires_directive();return this._consume(ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(ce.keywords.enable)){const t=this._enable_directive();return this._consume(ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(ce.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ce.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ce.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ce.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(ce.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(ce.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(ce.keywords.fn))return null;const e=this._currentLine,t=this._consume(ce.tokens.ident,"Expected function name.").toString();this._consume(ce.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(ce.tokens.paren_right))do{if(this._check(ce.tokens.paren_right))break;const a=this._attribute(),v=this._consume(ce.tokens.name,"Expected argument name.").toString();this._consume(ce.tokens.colon,"Expected ':' for argument type.");const A=this._attribute(),P=this._type_decl();P!=null&&(P.attributes=A,r.push(this._updateNode(new f2(v,P,a))))}while(this._match(ce.tokens.comma));this._consume(ce.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(ce.tokens.arrow)){const a=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=a)}const c=this._compound_statement(),d=this._currentLine;return this._updateNode(new rg(t,r,o,c,e,d),e)}_compound_statement(){const e=[];for(this._consume(ce.tokens.brace_left,"Expected '{' for block.");!this._check(ce.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(ce.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ce.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ce.tokens.attr)&&this._attribute(),this._check(ce.keywords.if))return this._if_statement();if(this._check(ce.keywords.switch))return this._switch_statement();if(this._check(ce.keywords.loop))return this._loop_statement();if(this._check(ce.keywords.for))return this._for_statement();if(this._check(ce.keywords.while))return this._while_statement();if(this._check(ce.keywords.continuing))return this._continuing_statement();if(this._check(ce.keywords.static_assert))return this._static_assert_statement();if(this._check(ce.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(ce.keywords.return))e=this._return_statement();else if(this._check([ce.keywords.var,ce.keywords.let,ce.keywords.const]))e=this._variable_statement();else if(this._match(ce.keywords.discard))e=this._updateNode(new Oz);else if(this._match(ce.keywords.break)){const t=this._updateNode(new oC);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(ce.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(ce.keywords.continue)){const t=this._updateNode(new aC);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(ce.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ce.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new Rz(t),e)}_while_statement(){if(!this._match(ce.keywords.while))return null;const e=this._updateNode(new KE(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ce.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(ce.keywords.continuing))return null;const t=this._currentLine,r=this._compound_statement();return this._updateNode(new Y0(r,e),t)}_for_statement(){if(!this._match(ce.keywords.for))return null;this._consume(ce.tokens.paren_left,"Expected '('.");const e=this._updateNode(new JE(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(ce.tokens.semicolon)?null:this._for_init(),this._consume(ce.tokens.semicolon,"Expected ';'."),e.condition=this._check(ce.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(ce.tokens.semicolon,"Expected ';'."),e.increment=this._check(ce.tokens.paren_right)?null:this._for_increment(),this._consume(ce.tokens.paren_right,"Expected ')'."),this._check(ce.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ce.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(ce.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Au(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(ce.keywords.let)){const e=this._currentLine,t=this._consume(ce.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(ce.tokens.colon)){const c=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=c)}this._consume(ce.tokens.equal,"Expected '=' for let.");const o=this._short_circuit_or_expression();return this._updateNode(new $m(t,r,null,null,o),e)}if(this._match(ce.keywords.const)){const e=this._currentLine,t=this._consume(ce.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(ce.tokens.colon)){const c=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=c)}this._consume(ce.tokens.equal,"Expected '=' for const.");const o=this._short_circuit_or_expression();return r===null&&o instanceof Zi&&(r=o.type),this._updateNode(new M_(t,r,null,null,o),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(ce.increment_operators))return this._current=e,null;const r=this._consume(ce.increment_operators,"Expected increment operator");return this._updateNode(new QE(r.type===ce.tokens.plus_plus?sp.increment:sp.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(ce.tokens.brace_right))return null;let r=this._match(ce.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const o=this._consume(ce.assignment_operators,"Expected assignment operator."),c=this._short_circuit_or_expression();return this._updateNode(new eC(Mm.parse(o.lexeme),e,c),t)}_func_call_statement(){if(!this._check(ce.tokens.ident))return null;const e=this._currentLine,t=this._current,r=this._consume(ce.tokens.ident,"Expected function name."),o=this._argument_expression_list();return o===null?(this._current=t,null):this._updateNode(new Sb(r.lexeme,o),e)}_loop_statement(){if(!this._match(ce.keywords.loop))return null;this._check(ce.tokens.attr)&&this._attribute(),this._consume(ce.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new tC([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof Y0){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(ce.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(ce.keywords.switch))return null;const e=this._updateNode(new nC(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ce.tokens.attr)&&this._attribute(),this._consume(ce.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ce.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([ce.keywords.default,ce.keywords.case]);){if(this._match(ce.keywords.case)){const r=this._case_selectors();for(const c of r)if(c instanceof k_){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(ce.tokens.colon),this._check(ce.tokens.attr)&&this._attribute(),this._consume(ce.tokens.brace_left,"Exected '{' for switch case.");const o=this._case_body();this._consume(ce.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new dC(r,o)))}if(this._match(ce.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(ce.tokens.colon),this._check(ce.tokens.attr)&&this._attribute(),this._consume(ce.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(ce.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new fC(r)))}}return e}_case_selectors(){const e=[];for(this._match(ce.keywords.default)?e.push(this._updateNode(new k_)):e.push(this._shift_expression());this._match(ce.tokens.comma);)this._match(ce.keywords.default)?e.push(this._updateNode(new k_)):e.push(this._shift_expression());return e}_case_body(){if(this._match(ce.keywords.fallthrough))return this._consume(ce.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(ce.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(ce.tokens.attr)&&this._attribute();const r=this._compound_statement();let o=[];this._match_elseif()&&(this._check(ce.tokens.attr)&&this._attribute(),o=this._elseif_statement(o));let c=null;return this._match(ce.keywords.else)&&(this._check(ce.tokens.attr)&&this._attribute(),c=this._compound_statement()),this._updateNode(new rC(t,r,o,c),e)}_match_elseif(){return this._tokens[this._current].type===ce.keywords.else&&this._tokens[this._current+1].type===ce.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new Lz(t,r))),this._match_elseif()&&(this._check(ce.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ce.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new iC(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ce.tokens.or_or);)e=this._updateNode(new Tl(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ce.tokens.and_and);)e=this._updateNode(new Tl(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ce.tokens.or);)e=this._updateNode(new Tl(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ce.tokens.xor);)e=this._updateNode(new Tl(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(ce.tokens.and);)e=this._updateNode(new Tl(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([ce.tokens.equal_equal,ce.tokens.not_equal])?this._updateNode(new Tl(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ce.tokens.less_than,ce.tokens.greater_than,ce.tokens.less_than_equal,ce.tokens.greater_than_equal]);)e=this._updateNode(new Tl(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ce.tokens.shift_left,ce.tokens.shift_right]);)e=this._updateNode(new Tl(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ce.tokens.plus,ce.tokens.minus]);)e=this._updateNode(new Tl(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ce.tokens.star,ce.tokens.forward_slash,ce.tokens.modulo]);)e=this._updateNode(new Tl(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([ce.tokens.minus,ce.tokens.bang,ce.tokens.tilde,ce.tokens.star,ce.tokens.and])?this._updateNode(new Ii(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(ce.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ce.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new yp(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(ce.tokens.period)){const e=this._consume(ce.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new jd(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return _t.void;case"bool":return _t.bool;case"i32":return _t.i32;case"u32":return _t.u32;case"f32":return _t.f32;case"f16":return _t.f16;case"vec2f":return Xe.vec2f;case"vec3f":return Xe.vec3f;case"vec4f":return Xe.vec4f;case"vec2i":return Xe.vec2i;case"vec3i":return Xe.vec3i;case"vec4i":return Xe.vec4i;case"vec2u":return Xe.vec2u;case"vec3u":return Xe.vec3u;case"vec4u":return Xe.vec4u;case"vec2h":return Xe.vec2h;case"vec3h":return Xe.vec3h;case"vec4h":return Xe.vec4h;case"mat2x2f":return Xe.mat2x2f;case"mat2x3f":return Xe.mat2x3f;case"mat2x4f":return Xe.mat2x4f;case"mat3x2f":return Xe.mat3x2f;case"mat3x3f":return Xe.mat3x3f;case"mat3x4f":return Xe.mat3x4f;case"mat4x2f":return Xe.mat4x2f;case"mat4x3f":return Xe.mat4x3f;case"mat4x4f":return Xe.mat4x4f;case"mat2x2h":return Xe.mat2x2h;case"mat2x3h":return Xe.mat2x3h;case"mat2x4h":return Xe.mat2x4h;case"mat3x2h":return Xe.mat3x2h;case"mat3x3h":return Xe.mat3x3h;case"mat3x4h":return Xe.mat3x4h;case"mat4x2h":return Xe.mat4x2h;case"mat4x3h":return Xe.mat4x3h;case"mat4x4h":return Xe.mat4x4h;case"mat2x2i":return Xe.mat2x2i;case"mat2x3i":return Xe.mat2x3i;case"mat2x4i":return Xe.mat2x4i;case"mat3x2i":return Xe.mat3x2i;case"mat3x3i":return Xe.mat3x3i;case"mat3x4i":return Xe.mat3x4i;case"mat4x2i":return Xe.mat4x2i;case"mat4x3i":return Xe.mat4x3i;case"mat4x4i":return Xe.mat4x4i;case"mat2x2u":return Xe.mat2x2u;case"mat2x3u":return Xe.mat2x3u;case"mat2x4u":return Xe.mat2x4u;case"mat3x2u":return Xe.mat3x2u;case"mat3x3u":return Xe.mat3x3u;case"mat3x4u":return Xe.mat3x4u;case"mat4x2u":return Xe.mat4x2u;case"mat4x3u":return Xe.mat4x3u;case"mat4x4u":return Xe.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(ce.tokens.ident)){const r=this._previous().toString();if(this._check(ce.tokens.paren_left)){const o=this._argument_expression_list(),c=this._getType(r);return c!==null?this._updateNode(new wc(c,o)):this._updateNode(new Pb(r,o))}if(this._context.constants.has(r)){const o=this._context.constants.get(r);return this._updateNode(new lC(r,o.value))}return this._updateNode(new Qo(r))}if(this._match(ce.tokens.int_literal)){const r=this._previous().toString();let o=r.endsWith("i")||r.endsWith("i")?_t.i32:r.endsWith("u")||r.endsWith("U")?_t.u32:_t.x32;const c=parseInt(r);return this._validateTypeRange(c,o),this._updateNode(new Zi(new We(c,this._exec.getTypeInfo(o)),o))}if(this._match(ce.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,_t.u32),this._updateNode(new Zi(new We(r,this._exec.getTypeInfo(_t.u32)),_t.u32))}if(this._match([ce.tokens.decimal_float_literal,ce.tokens.hex_float_literal])){let r=this._previous().toString(),o=r.endsWith("h");o&&(r=r.substring(0,r.length-1));const c=parseFloat(r);this._validateTypeRange(c,o?_t.f16:_t.f32);const d=o?_t.f16:_t.f32;return this._updateNode(new Zi(new We(c,this._exec.getTypeInfo(d)),d))}if(this._match([ce.keywords.true,ce.keywords.false])){let r=this._previous().toString()===ce.keywords.true.rule;return this._updateNode(new Zi(new We(r?1:0,this._exec.getTypeInfo(_t.bool)),_t.bool))}if(this._check(ce.tokens.paren_left))return this._paren_expression();if(this._match(ce.keywords.bitcast)){this._consume(ce.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(ce.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return this._updateNode(new cC(r,o))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new wc(e,t))}_argument_expression_list(){if(!this._match(ce.tokens.paren_left))return null;const e=[];do{if(this._check(ce.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(ce.tokens.comma));return this._consume(ce.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ce.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ce.tokens.paren_right),e}_paren_expression(){this._consume(ce.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ce.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(ce.keywords.struct))return null;const e=this._currentLine,t=this._consume(ce.tokens.ident,"Expected name for struct.").toString();this._consume(ce.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(ce.tokens.brace_right);){const d=this._attribute(),a=this._consume(ce.tokens.name,"Expected variable name.").toString();this._consume(ce.tokens.colon,"Expected ':' for struct member type.");const v=this._attribute(),A=this._type_decl();A!=null&&(A.attributes=v),this._check(ce.tokens.brace_right)?this._match(ce.tokens.comma):this._consume(ce.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new p2(a,A,d)))}this._consume(ce.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,c=this._updateNode(new Tu(t,r,e,o),e);return this._context.structs.set(t,c),c}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(ce.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Zi){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Zi&&(e.type=e.value.type.name==="x32"?_t.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ce.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(ce.keywords.const))return null;const t=this._consume(ce.tokens.name,"Expected variable name"),r=this._currentLine;let o=null;if(this._match(ce.tokens.colon)){const v=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=v)}let c=null;this._consume(ce.tokens.equal,"const declarations require an assignment");const d=this._short_circuit_or_expression();try{let v=[_t.f32],A=d.constEvaluate(this._exec,v);A instanceof We&&this._validateTypeRange(A.value,v[0]),v[0]instanceof Xe&&v[0].format===null&&A.typeInfo instanceof Vd&&A.typeInfo.format!==null&&(A.typeInfo.format.name==="f16"?v[0].format=_t.f16:A.typeInfo.format.name==="f32"?v[0].format=_t.f32:A.typeInfo.format.name==="i32"?v[0].format=_t.i32:A.typeInfo.format.name==="u32"?v[0].format=_t.u32:A.typeInfo.format.name==="bool"?v[0].format=_t.bool:console.error(`TODO: impelement template format type ${A.typeInfo.format.name}`)),c=this._updateNode(new Zi(A,v[0])),this._exec.context.setVariable(t.toString(),A)}catch{c=d}if(o!==null&&c instanceof Zi){if(c.type.name!=="x32"&&o.getTypeName()!==c.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${c.type.name} to ${o.name}. Line:${this._currentLine}`);c.type=o,c.isScalar&&this._validateTypeRange(c.scalarValue,c.type)}else o===null&&c instanceof Zi&&(o=(e=c?.type)!==null&&e!==void 0?e:_t.f32,o===_t.x32&&(o=_t.i32));const a=this._updateNode(new M_(t.toString(),o,"","",c),r);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(ce.keywords.let))return null;const e=this._currentLine,t=this._consume(ce.tokens.name,"Expected variable name");let r=null;if(this._match(ce.tokens.colon)){const c=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=c)}let o=null;if(this._match(ce.tokens.equal)&&(o=this._const_expression()),r!==null&&o instanceof Zi){if(o.type.name!=="x32"&&r.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${r.name}. Line:${this._currentLine}`);o.type=r}else r===null&&o instanceof Zi&&(r=o.type.name==="x32"?_t.i32:o.type);return o instanceof Zi&&o.isScalar&&this._validateTypeRange(o.scalarValue,r),this._updateNode(new $m(t.toString(),r,"","",o),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ce.keywords.var))return null;const e=this._currentLine;let t="",r="";this._match(ce.tokens.less_than)&&(t=this._consume(ce.storage_class,"Expected storage_class.").toString(),this._match(ce.tokens.comma)&&(r=this._consume(ce.access_mode,"Expected access_mode.").toString()),this._consume(ce.tokens.greater_than,"Expected '>'."));const o=this._consume(ce.tokens.name,"Expected variable name");let c=null;if(this._match(ce.tokens.colon)){const d=this._attribute();c=this._type_decl(),c!=null&&(c.attributes=d)}return this._updateNode(new Au(o.toString(),c,t,r,null),e)}_override_decl(){if(!this._match(ce.keywords.override))return null;const e=this._consume(ce.tokens.name,"Expected variable name");let t=null;if(this._match(ce.tokens.colon)){const r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new Tb(e.toString(),t,null))}_diagnostic(){this._consume(ce.tokens.paren_left,"Expected '('");const e=this._consume(ce.tokens.ident,"Expected severity control name.");this._consume(ce.tokens.comma,"Expected ','");let t=this._consume(ce.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(ce.tokens.period)&&(t+=`.${this._consume(ce.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(ce.tokens.paren_right,"Expected ')'"),this._updateNode(new sC(e.toString(),t))}_enable_directive(){const e=this._consume(ce.tokens.ident,"identity expected.");return this._updateNode(new kz(e.toString()))}_requires_directive(){const e=[this._consume(ce.tokens.ident,"identity expected.").toString()];for(;this._match(ce.tokens.comma);){const t=this._consume(ce.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new Dz(e))}_type_alias(){const e=this._consume(ce.tokens.ident,"identity expected.");this._consume(ce.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const r=this._updateNode(new Ab(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([ce.tokens.ident,...ce.texel_format,ce.keywords.bool,ce.keywords.f32,ce.keywords.i32,ce.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const o=this._updateNode(new d2(r));return this._forwardTypeCount++,o}return this._updateNode(new _t(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(ce.template_types)){let r=this._advance().toString(),o=null,c=null;return this._match(ce.tokens.less_than)&&(o=this._type_decl(),c=null,this._match(ce.tokens.comma)&&(c=this._consume(ce.access_mode,"Expected access_mode for pointer").toString()),this._consume(ce.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Xe(r,o,c))}if(this._match(ce.keywords.ptr)){let r=this._previous().toString();this._consume(ce.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(ce.storage_class,"Expected storage_class for pointer");this._consume(ce.tokens.comma,"Expected ',' for pointer.");const c=this._type_decl();let d=null;return this._match(ce.tokens.comma)&&(d=this._consume(ce.access_mode,"Expected access_mode for pointer").toString()),this._consume(ce.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new R_(r,o.toString(),c,d))}const t=this._attribute();if(this._match(ce.keywords.array)){let r=null,o=-1;const c=this._previous();let d=null;if(this._match(ce.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let v="";if(this._match(ce.tokens.comma)){d=this._shift_expression();try{v=d.constEvaluate(this._exec).toString(),d=null}catch{v="1"}}this._consume(ce.tokens.greater_than,"Expected '>' for array."),o=v?parseInt(v):0}const a=this._updateNode(new Wm(c.toString(),t,r,o));return d&&this._deferArrayCountEval.push({arrayType:a,countNode:d}),a}return null}_texture_sampler_types(){if(this._match(ce.sampler_type))return this._updateNode(new Rm(this._previous().toString(),null,null));if(this._match(ce.depth_texture_type))return this._updateNode(new Rm(this._previous().toString(),null,null));if(this._match(ce.sampled_texture_type)||this._match(ce.multisampled_texture_type)){const e=this._previous();this._consume(ce.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(ce.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Rm(e.toString(),t,null))}if(this._match(ce.storage_texture_type)){const e=this._previous();this._consume(ce.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(ce.texel_format,"Invalid texel format.").toString();this._consume(ce.tokens.comma,"Expected ',' after texel format.");const r=this._consume(ce.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ce.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Rm(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(ce.tokens.attr);){const t=this._consume(ce.attribute_name,"Expected attribute name"),r=this._updateNode(new pC(t.toString(),null));if(this._match(ce.tokens.paren_left)){if(r.value=this._consume(ce.literal_or_ident,"Expected attribute value").toString(),this._check(ce.tokens.comma)){this._advance();do{const o=this._consume(ce.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(o)}while(this._match(ce.tokens.comma))}this._consume(ce.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class Gz extends Ac{constructor(e){super(),e&&this.update(e)}update(e){const t=new qz().parse(e);this.updateAST(t)}}function Yz(n){const e={attributes:[],bindings:[]};let t;try{t=Kz(n)}catch(c){return Lt.error(c.message)(),e}for(const c of t.uniforms){const d=[];for(const a of c.type?.members||[])d.push({name:a.name,type:_2(a.type)});e.bindings.push({type:"uniform",name:c.name,group:c.group,location:c.binding,members:d})}for(const c of t.textures)e.bindings.push({type:"texture",name:c.name,group:c.group,location:c.binding});for(const c of t.samplers)e.bindings.push({type:"sampler",name:c.name,group:c.group,location:c.binding});const r=t.entry.vertex[0],o=r?.inputs.length||0;for(let c=0;c<o;c++){const d=r.inputs[c];if(d.locationType==="location"){const a=_2(d.type);e.attributes.push({name:d.name,location:Number(d.location),type:a})}}return e}function _2(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function Kz(n){try{return new Gz(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const Jz={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Jz}};const ka=globalThis.mathgl.config;function Qz(n,{precision:e=ka.precision}={}){return n=e6(n),`${parseFloat(n.toPrecision(e))}`}function vp(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function bh(n,e,t){return n6(n,r=>Math.max(e,Math.min(t,r)))}function ig(n,e,t){return vp(n)?n.map((r,o)=>ig(r,e[o],t)):t*e+(1-t)*n}function sg(n,e,t){const r=ka.EPSILON;try{if(n===e)return!0;if(vp(n)&&vp(e)){if(n.length!==e.length)return!1;for(let o=0;o<n.length;++o)if(!sg(n[o],e[o]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=ka.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{ka.EPSILON=r}}function e6(n){return Math.round(n/ka.EPSILON)*ka.EPSILON}function t6(n){return n.clone?n.clone():new Array(n.length)}function n6(n,e,t){if(vp(n)){const r=n;t=t||t6(r);for(let o=0;o<t.length&&o<r.length;++o){const c=typeof n=="number"?n:n[o];t[o]=e(c,o,t)}return t}return e(n)}class mC extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:vp(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ka)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+Qz(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!sg(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let o=0;o<this.ELEMENTS;++o){const c=e[o],d=typeof t=="number"?t:t[o];this[o]=c+r*(d-c)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ka.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function r6(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Jo(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function qv(n,e,t=""){if(ka.debug&&!r6(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function y2(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class i6 extends mC{get x(){return this[0]}set x(e){this[0]=Jo(e)}get y(){return this[1]}set y(e){this[1]=Jo(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const o=this[r]-e[r];t+=o*o}return Jo(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return Jo(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return y2(e>=0&&e<this.ELEMENTS,"index is out of range"),Jo(this[e])}setComponent(e,t){return y2(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const D_=1e-6;let xp=typeof Float32Array<"u"?Float32Array:Array;function s6(){const n=new xp(2);return xp!=Float32Array&&(n[0]=0,n[1]=0),n}function J0(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function o6(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function a6(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function l6(n){const e=n[0],t=n[1];return Math.sqrt(e*e+t*t)}function c6(n,e){return n[0]=-e[0],n[1]=-e[1],n}function gC(n,e,t,r){const o=e[0],c=e[1];return n[0]=o+r*(t[0]-o),n[1]=c+r*(t[1]-c),n}function u6(n,e,t){const r=e[0],o=e[1];return n[0]=t[0]*r+t[4]*o+t[12],n[1]=t[1]*r+t[5]*o+t[13],n}const h6=o6;(function(){const n=s6();return function(e,t,r,o,c,d){let a,v;for(t||(t=2),r||(r=0),o?v=Math.min(o*t+r,e.length):v=e.length,a=r;a<v;a+=t)n[0]=e[a],n[1]=e[a+1],c(n,n,d),e[a]=n[0],e[a+1]=n[1];return e}})();function d6(n,e,t){const r=e[0],o=e[1],c=t[3]*r+t[7]*o||1;return n[0]=(t[0]*r+t[4]*o)/c,n[1]=(t[1]*r+t[5]*o)/c,n}function _C(n,e,t){const r=e[0],o=e[1],c=e[2],d=t[3]*r+t[7]*o+t[11]*c||1;return n[0]=(t[0]*r+t[4]*o+t[8]*c)/d,n[1]=(t[1]*r+t[5]*o+t[9]*c)/d,n[2]=(t[2]*r+t[6]*o+t[10]*c)/d,n}function f6(n,e,t){const r=e[0],o=e[1];return n[0]=t[0]*r+t[2]*o,n[1]=t[1]*r+t[3]*o,n[2]=e[2],n}function p6(){const n=new xp(3);return xp!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function m6(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function g6(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function _6(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function y6(n,e,t){const r=e[0],o=e[1],c=e[2],d=t[0],a=t[1],v=t[2];return n[0]=o*v-c*a,n[1]=c*d-r*v,n[2]=r*a-o*d,n}function yC(n,e,t){const r=e[0],o=e[1],c=e[2];let d=t[3]*r+t[7]*o+t[11]*c+t[15];return d=d||1,n[0]=(t[0]*r+t[4]*o+t[8]*c+t[12])/d,n[1]=(t[1]*r+t[5]*o+t[9]*c+t[13])/d,n[2]=(t[2]*r+t[6]*o+t[10]*c+t[14])/d,n}function v6(n,e,t){const r=e[0],o=e[1],c=e[2];return n[0]=r*t[0]+o*t[3]+c*t[6],n[1]=r*t[1]+o*t[4]+c*t[7],n[2]=r*t[2]+o*t[5]+c*t[8],n}function x6(n,e,t){const r=t[0],o=t[1],c=t[2],d=t[3],a=e[0],v=e[1],A=e[2];let P=o*A-c*v,k=c*a-r*A,L=r*v-o*a,z=o*L-c*k,G=c*P-r*L,te=r*k-o*P;const re=d*2;return P*=re,k*=re,L*=re,z*=2,G*=2,te*=2,n[0]=a+P+z,n[1]=v+k+G,n[2]=A+L+te,n}function b6(n,e,t,r){const o=[],c=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],c[0]=o[0],c[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),c[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),n[0]=c[0]+t[0],n[1]=c[1]+t[1],n[2]=c[2]+t[2],n}function w6(n,e,t,r){const o=[],c=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],c[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),c[1]=o[1],c[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),n[0]=c[0]+t[0],n[1]=c[1]+t[1],n[2]=c[2]+t[2],n}function T6(n,e,t,r){const o=[],c=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],c[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),c[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),c[2]=o[2],n[0]=c[0]+t[0],n[1]=c[1]+t[1],n[2]=c[2]+t[2],n}function S6(n,e){const t=n[0],r=n[1],o=n[2],c=e[0],d=e[1],a=e[2],v=Math.sqrt((t*t+r*r+o*o)*(c*c+d*d+a*a)),A=v&&_6(n,e)/v;return Math.acos(Math.min(Math.max(A,-1),1))}const A6=m6;(function(){const n=p6();return function(e,t,r,o,c,d){let a,v;for(t||(t=3),r||(r=0),o?v=Math.min(o*t+r,e.length):v=e.length,a=r;a<v;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],c(n,n,d),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}})();const Gv=[0,0,0];let u_;class Cc extends i6{static get ZERO(){return u_||(u_=new Cc(0,0,0),Object.freeze(u_)),u_}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&vp(e)?this.copy(e):(ka.debug&&(Jo(e),Jo(t),Jo(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ka.debug&&(Jo(e.x),Jo(e.y),Jo(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Jo(e)}angle(e){return S6(this,e)}cross(e){return y6(this,this,e),this.check()}rotateX({radians:e,origin:t=Gv}){return b6(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Gv}){return w6(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Gv}){return T6(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return yC(this,this,e),this.check()}transformAsVector(e){return _C(this,this,e),this.check()}transformByMatrix3(e){return v6(this,this,e),this.check()}transformByMatrix2(e){return f6(this,this,e),this.check()}transformByQuaternion(e){return x6(this,this,e),this.check()}}class P6 extends mC{toString(){let e="[";if(ka.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=Jo(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)t[o]=this[r+o];return t}setColumn(e,t){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)this[r+o]=t[o];return this}}function E6(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function C6(n,e){if(n===e){const t=e[1],r=e[2],o=e[3],c=e[6],d=e[7],a=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=c,n[11]=e[14],n[12]=o,n[13]=d,n[14]=a}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function Q0(n,e){const t=e[0],r=e[1],o=e[2],c=e[3],d=e[4],a=e[5],v=e[6],A=e[7],P=e[8],k=e[9],L=e[10],z=e[11],G=e[12],te=e[13],re=e[14],fe=e[15],ve=t*a-r*d,le=t*v-o*d,Se=t*A-c*d,Ne=r*v-o*a,nt=r*A-c*a,pt=o*A-c*v,mt=P*te-k*G,Tt=P*re-L*G,Mt=P*fe-z*G,Zt=k*re-L*te,hn=k*fe-z*te,on=L*fe-z*re;let nn=ve*on-le*hn+Se*Zt+Ne*Mt-nt*Tt+pt*mt;return nn?(nn=1/nn,n[0]=(a*on-v*hn+A*Zt)*nn,n[1]=(o*hn-r*on-c*Zt)*nn,n[2]=(te*pt-re*nt+fe*Ne)*nn,n[3]=(L*nt-k*pt-z*Ne)*nn,n[4]=(v*Mt-d*on-A*Tt)*nn,n[5]=(t*on-o*Mt+c*Tt)*nn,n[6]=(re*Se-G*pt-fe*le)*nn,n[7]=(P*pt-L*Se+z*le)*nn,n[8]=(d*hn-a*Mt+A*mt)*nn,n[9]=(r*Mt-t*hn-c*mt)*nn,n[10]=(G*nt-te*Se+fe*ve)*nn,n[11]=(k*Se-P*nt-z*ve)*nn,n[12]=(a*Tt-d*Zt-v*mt)*nn,n[13]=(t*Zt-r*Tt+o*mt)*nn,n[14]=(te*le-G*Ne-re*ve)*nn,n[15]=(P*Ne-k*le+L*ve)*nn,n):null}function I6(n){const e=n[0],t=n[1],r=n[2],o=n[3],c=n[4],d=n[5],a=n[6],v=n[7],A=n[8],P=n[9],k=n[10],L=n[11],z=n[12],G=n[13],te=n[14],re=n[15],fe=e*d-t*c,ve=e*a-r*c,le=t*a-r*d,Se=A*G-P*z,Ne=A*te-k*z,nt=P*te-k*G,pt=e*nt-t*Ne+r*Se,mt=c*nt-d*Ne+a*Se,Tt=A*le-P*ve+k*fe,Mt=z*le-G*ve+te*fe;return v*pt-o*mt+re*Tt-L*Mt}function Bd(n,e,t){const r=e[0],o=e[1],c=e[2],d=e[3],a=e[4],v=e[5],A=e[6],P=e[7],k=e[8],L=e[9],z=e[10],G=e[11],te=e[12],re=e[13],fe=e[14],ve=e[15];let le=t[0],Se=t[1],Ne=t[2],nt=t[3];return n[0]=le*r+Se*a+Ne*k+nt*te,n[1]=le*o+Se*v+Ne*L+nt*re,n[2]=le*c+Se*A+Ne*z+nt*fe,n[3]=le*d+Se*P+Ne*G+nt*ve,le=t[4],Se=t[5],Ne=t[6],nt=t[7],n[4]=le*r+Se*a+Ne*k+nt*te,n[5]=le*o+Se*v+Ne*L+nt*re,n[6]=le*c+Se*A+Ne*z+nt*fe,n[7]=le*d+Se*P+Ne*G+nt*ve,le=t[8],Se=t[9],Ne=t[10],nt=t[11],n[8]=le*r+Se*a+Ne*k+nt*te,n[9]=le*o+Se*v+Ne*L+nt*re,n[10]=le*c+Se*A+Ne*z+nt*fe,n[11]=le*d+Se*P+Ne*G+nt*ve,le=t[12],Se=t[13],Ne=t[14],nt=t[15],n[12]=le*r+Se*a+Ne*k+nt*te,n[13]=le*o+Se*v+Ne*L+nt*re,n[14]=le*c+Se*A+Ne*z+nt*fe,n[15]=le*d+Se*P+Ne*G+nt*ve,n}function iy(n,e,t){const r=t[0],o=t[1],c=t[2];let d,a,v,A,P,k,L,z,G,te,re,fe;return e===n?(n[12]=e[0]*r+e[4]*o+e[8]*c+e[12],n[13]=e[1]*r+e[5]*o+e[9]*c+e[13],n[14]=e[2]*r+e[6]*o+e[10]*c+e[14],n[15]=e[3]*r+e[7]*o+e[11]*c+e[15]):(d=e[0],a=e[1],v=e[2],A=e[3],P=e[4],k=e[5],L=e[6],z=e[7],G=e[8],te=e[9],re=e[10],fe=e[11],n[0]=d,n[1]=a,n[2]=v,n[3]=A,n[4]=P,n[5]=k,n[6]=L,n[7]=z,n[8]=G,n[9]=te,n[10]=re,n[11]=fe,n[12]=d*r+P*o+G*c+e[12],n[13]=a*r+k*o+te*c+e[13],n[14]=v*r+L*o+re*c+e[14],n[15]=A*r+z*o+fe*c+e[15]),n}function Rb(n,e,t){const r=t[0],o=t[1],c=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*o,n[5]=e[5]*o,n[6]=e[6]*o,n[7]=e[7]*o,n[8]=e[8]*c,n[9]=e[9]*c,n[10]=e[10]*c,n[11]=e[11]*c,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function M6(n,e,t,r){let o=r[0],c=r[1],d=r[2],a=Math.sqrt(o*o+c*c+d*d),v,A,P,k,L,z,G,te,re,fe,ve,le,Se,Ne,nt,pt,mt,Tt,Mt,Zt,hn,on,nn,Rn;return a<D_?null:(a=1/a,o*=a,c*=a,d*=a,A=Math.sin(t),v=Math.cos(t),P=1-v,k=e[0],L=e[1],z=e[2],G=e[3],te=e[4],re=e[5],fe=e[6],ve=e[7],le=e[8],Se=e[9],Ne=e[10],nt=e[11],pt=o*o*P+v,mt=c*o*P+d*A,Tt=d*o*P-c*A,Mt=o*c*P-d*A,Zt=c*c*P+v,hn=d*c*P+o*A,on=o*d*P+c*A,nn=c*d*P-o*A,Rn=d*d*P+v,n[0]=k*pt+te*mt+le*Tt,n[1]=L*pt+re*mt+Se*Tt,n[2]=z*pt+fe*mt+Ne*Tt,n[3]=G*pt+ve*mt+nt*Tt,n[4]=k*Mt+te*Zt+le*hn,n[5]=L*Mt+re*Zt+Se*hn,n[6]=z*Mt+fe*Zt+Ne*hn,n[7]=G*Mt+ve*Zt+nt*hn,n[8]=k*on+te*nn+le*Rn,n[9]=L*on+re*nn+Se*Rn,n[10]=z*on+fe*nn+Ne*Rn,n[11]=G*on+ve*nn+nt*Rn,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function vC(n,e,t){const r=Math.sin(t),o=Math.cos(t),c=e[4],d=e[5],a=e[6],v=e[7],A=e[8],P=e[9],k=e[10],L=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=c*o+A*r,n[5]=d*o+P*r,n[6]=a*o+k*r,n[7]=v*o+L*r,n[8]=A*o-c*r,n[9]=P*o-d*r,n[10]=k*o-a*r,n[11]=L*o-v*r,n}function R6(n,e,t){const r=Math.sin(t),o=Math.cos(t),c=e[0],d=e[1],a=e[2],v=e[3],A=e[8],P=e[9],k=e[10],L=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=c*o-A*r,n[1]=d*o-P*r,n[2]=a*o-k*r,n[3]=v*o-L*r,n[8]=c*r+A*o,n[9]=d*r+P*o,n[10]=a*r+k*o,n[11]=v*r+L*o,n}function xC(n,e,t){const r=Math.sin(t),o=Math.cos(t),c=e[0],d=e[1],a=e[2],v=e[3],A=e[4],P=e[5],k=e[6],L=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=c*o+A*r,n[1]=d*o+P*r,n[2]=a*o+k*r,n[3]=v*o+L*r,n[4]=A*o-c*r,n[5]=P*o-d*r,n[6]=k*o-a*r,n[7]=L*o-v*r,n}function k6(n,e){const t=e[0],r=e[1],o=e[2],c=e[3],d=t+t,a=r+r,v=o+o,A=t*d,P=r*d,k=r*a,L=o*d,z=o*a,G=o*v,te=c*d,re=c*a,fe=c*v;return n[0]=1-k-G,n[1]=P+fe,n[2]=L-re,n[3]=0,n[4]=P-fe,n[5]=1-A-G,n[6]=z+te,n[7]=0,n[8]=L+re,n[9]=z-te,n[10]=1-A-k,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function D6(n,e,t,r,o,c,d){const a=1/(t-e),v=1/(o-r),A=1/(c-d);return n[0]=c*2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c*2*v,n[6]=0,n[7]=0,n[8]=(t+e)*a,n[9]=(o+r)*v,n[10]=(d+c)*A,n[11]=-1,n[12]=0,n[13]=0,n[14]=d*c*2*A,n[15]=0,n}function O6(n,e,t,r,o){const c=1/Math.tan(e/2);if(n[0]=c/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,o!=null&&o!==1/0){const d=1/(r-o);n[10]=(o+r)*d,n[14]=2*o*r*d}else n[10]=-1,n[14]=-2*r;return n}const L6=O6;function F6(n,e,t,r,o,c,d){const a=1/(e-t),v=1/(r-o),A=1/(c-d);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*A,n[11]=0,n[12]=(e+t)*a,n[13]=(o+r)*v,n[14]=(d+c)*A,n[15]=1,n}const N6=F6;function B6(n,e,t,r){let o,c,d,a,v,A,P,k,L,z;const G=e[0],te=e[1],re=e[2],fe=r[0],ve=r[1],le=r[2],Se=t[0],Ne=t[1],nt=t[2];return Math.abs(G-Se)<D_&&Math.abs(te-Ne)<D_&&Math.abs(re-nt)<D_?E6(n):(k=G-Se,L=te-Ne,z=re-nt,o=1/Math.sqrt(k*k+L*L+z*z),k*=o,L*=o,z*=o,c=ve*z-le*L,d=le*k-fe*z,a=fe*L-ve*k,o=Math.sqrt(c*c+d*d+a*a),o?(o=1/o,c*=o,d*=o,a*=o):(c=0,d=0,a=0),v=L*a-z*d,A=z*c-k*a,P=k*d-L*c,o=Math.sqrt(v*v+A*A+P*P),o?(o=1/o,v*=o,A*=o,P*=o):(v=0,A=0,P=0),n[0]=c,n[1]=v,n[2]=k,n[3]=0,n[4]=d,n[5]=A,n[6]=L,n[7]=0,n[8]=a,n[9]=P,n[10]=z,n[11]=0,n[12]=-(c*G+d*te+a*re),n[13]=-(v*G+A*te+P*re),n[14]=-(k*G+L*te+z*re),n[15]=1,n)}function z6(){const n=new xp(4);return xp!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function U6(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function _g(n,e,t){const r=e[0],o=e[1],c=e[2],d=e[3];return n[0]=t[0]*r+t[4]*o+t[8]*c+t[12]*d,n[1]=t[1]*r+t[5]*o+t[9]*c+t[13]*d,n[2]=t[2]*r+t[6]*o+t[10]*c+t[14]*d,n[3]=t[3]*r+t[7]*o+t[11]*c+t[15]*d,n}(function(){const n=z6();return function(e,t,r,o,c,d){let a,v;for(t||(t=4),r||(r=0),o?v=Math.min(o*t+r,e.length):v=e.length,a=r;a<v;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],n[3]=e[a+3],c(n,n,d),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2],e[a+3]=n[3];return e}})();var ex;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(ex||(ex={}));const V6=45*Math.PI/180,j6=1,Yv=.1,Kv=500,$6=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ic extends P6{static get IDENTITY(){return H6()}static get ZERO(){return W6()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return ex}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,o,c,d,a,v,A,P,k,L,z,G,te,re){return this[0]=e,this[1]=t,this[2]=r,this[3]=o,this[4]=c,this[5]=d,this[6]=a,this[7]=v,this[8]=A,this[9]=P,this[10]=k,this[11]=L,this[12]=z,this[13]=G,this[14]=te,this[15]=re,this.check()}setRowMajor(e,t,r,o,c,d,a,v,A,P,k,L,z,G,te,re){return this[0]=e,this[1]=c,this[2]=A,this[3]=z,this[4]=t,this[5]=d,this[6]=P,this[7]=G,this[8]=r,this[9]=a,this[10]=k,this[11]=te,this[12]=o,this[13]=v,this[14]=L,this[15]=re,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy($6)}fromObject(e){return this.check()}fromQuaternion(e){return k6(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:o,top:c,near:d=Yv,far:a=Kv}=e;return a===1/0?Z6(this,t,r,o,c,d):D6(this,t,r,o,c,d,a),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:o=[0,1,0]}=e;return B6(this,t,r,o),this.check()}ortho(e){const{left:t,right:r,bottom:o,top:c,near:d=Yv,far:a=Kv}=e;return N6(this,t,r,o,c,d,a),this.check()}orthographic(e){const{fovy:t=V6,aspect:r=j6,focalDistance:o=1,near:c=Yv,far:d=Kv}=e;v2(t);const a=t/2,v=o*Math.tan(a),A=v*r;return this.ortho({left:-A,right:A,bottom:-v,top:v,near:c,far:d})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:o=.1,far:c=500}=e;return v2(t),L6(this,t,r,o,c),this.check()}determinant(){return I6(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),o=1/r[0],c=1/r[1],d=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*c,e[6]=this[6]*d,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*c,e[10]=this[10]*d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),o=1/r[0],c=1/r[1],d=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=this[4]*o,e[4]=this[5]*c,e[5]=this[6]*d,e[6]=this[8]*o,e[7]=this[9]*c,e[8]=this[10]*d,e}transpose(){return C6(this,this),this.check()}invert(){return Q0(this,this),this.check()}multiplyLeft(e){return Bd(this,e,this),this.check()}multiplyRight(e){return Bd(this,this,e),this.check()}rotateX(e){return vC(this,this,e),this.check()}rotateY(e){return R6(this,this,e),this.check()}rotateZ(e){return xC(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return M6(this,this,e,t),this.check()}scale(e){return Rb(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return iy(this,this,e),this.check()}transform(e,t){return e.length===4?(t=_g(t||[-0,-0,-0,-0],e,this),qv(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let o;switch(r){case 2:o=u6(t||[-0,-0],e,this);break;case 3:o=yC(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return qv(o,e.length),o}transformAsVector(e,t){let r;switch(e.length){case 2:r=d6(t||[-0,-0],e,this);break;case 3:r=_C(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return qv(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let h_,d_;function W6(){return h_||(h_=new Ic([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(h_)),h_}function H6(){return d_||(d_=new Ic,Object.freeze(d_)),d_}function v2(n){if(n>Math.PI*2)throw Error("expected radians")}function Z6(n,e,t,r,o,c){const d=2*c/(t-e),a=2*c/(o-r),v=(t+e)/(t-e),A=(o+r)/(o-r),P=-1,k=-1,L=-2*c;return n[0]=d,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=v,n[9]=A,n[10]=P,n[11]=k,n[12]=0,n[13]=0,n[14]=L,n[15]=0,n}function bC(n,e=[],t=0){const r=Math.fround(n),o=n-r;return e[t]=r,e[t+1]=o,e}function X6(n){return n-Math.fround(n)}function q6(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let r=0;r<4;++r){const o=t*4+r;bC(n[r*4+t],e,o*2)}return e}const G6=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Y6={name:"fp32",vs:G6},K6=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,J6={ONE:1},Q6={name:"fp64arithmetic",vs:K6,defaultUniforms:J6,uniformTypes:{ONE:"f32"},fp64ify:bC,fp64LowPart:X6,fp64ifyMatrix4:q6},e5=[0,1,1,1],t5=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,n5=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,x2={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:e5},vs:t5,fs:n5,getUniforms:r5};function r5(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const r=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=r}if(n.highlightColor){const r=Array.from(n.highlightColor,o=>o/255);Number.isFinite(r[3])||(r[3]=1),t.highlightColor=r}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const b2=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,i5=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,wC=3,s5=255;var og;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(og||(og={}));const O_={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:wC},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:og.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:i5,vs:b2,fs:b2,getUniforms:o5};function o5(n,e={}){if(n=n&&{...n},!n)return{...O_.defaultUniforms};n.lights&&(n={...n,...l5(n.lights),lights:void 0});const{ambientLight:t,pointLights:r,directionalLights:o}=n||{};if(!(t||r&&r.length>0||o&&o.length>0))return{...O_.defaultUniforms,enabled:0};const d={...O_.defaultUniforms,...e,...a5({ambientLight:t,pointLights:r,directionalLights:o})};return n.enabled!==void 0&&(d.enabled=n.enabled?1:0),d}function a5({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const r={};r.ambientLightColor=Jv(n);let o=0;for(const c of e){r.lightType=og.POINT;const d=o;r[`lightColor${d}`]=Jv(c),r[`lightPosition${d}`]=c.position,r[`lightAttenuation${d}`]=c.attenuation||[1,0,0],o++}for(const c of t){r.lightType=og.DIRECTIONAL;const d=o;r[`lightColor${d}`]=Jv(c),r[`lightDirection${d}`]=c.direction,o++}return o>wC&&Lt.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=t.length,r.pointLightCount=e.length,r}function l5(n){const e={pointLights:[],directionalLights:[]};for(const t of n||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break}return e}function Jv(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(r=>r*t/s5)}const c5=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,u5=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,h5=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,TC={props:{},name:"gouraudMaterial",vs:u5.replace("phongMaterial","gouraudMaterial"),fs:c5.replace("phongMaterial","gouraudMaterial"),source:h5.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[O_],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...TC.defaultUniforms,...e}}},w2=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,d5={name:"layer",vs:w2,fs:w2,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},f5=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,SC="#define SMOOTH_EDGE_RADIUS 0.5",p5=`${SC}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,m5=`${SC}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,AC={name:"geometry",source:f5,vs:p5,fs:m5},g5=25;var Ri;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(Ri||(Ri={}));var Xi;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Xi||(Xi={}));var On;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(On||(On={}));const _5="compute",y5="auto",tx="manipulation",L_="none",nx="pan-x",rx="pan-y";function v5(n){if(n.includes(L_))return L_;const e=n.includes(nx),t=n.includes(rx);return e&&t?L_:e||t?e?nx:rx:n.includes(tx)?tx:y5}class x5{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===_5&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return v5(e.join(" "))}}function sy(n){return n.trim().split(/\s+/g)}function Qv(n,e,t){if(n)for(const r of sy(e))n.addEventListener(r,t,!1)}function e0(n,e,t){if(n)for(const r of sy(e))n.removeEventListener(r,t,!1)}function T2(n){return(n.ownerDocument||n).defaultView}function b5(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function PC(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,r=0,o=0;for(;o<e;)t+=n[o].clientX,r+=n[o].clientY,o++;return{x:Math.round(t/e),y:Math.round(r/e)}}function S2(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:PC(e),deltaX:n.deltaX,deltaY:n.deltaY}}function EC(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)}function A2(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.sqrt(t*t+r*r)}function w5(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.atan2(r,t)*180/Math.PI}function P2(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.atan2(r,t)*180/Math.PI}function CC(n,e){return n===e?Xi.None:Math.abs(n)>=Math.abs(e)?n<0?Xi.Left:Xi.Right:e<0?Xi.Up:Xi.Down}function T5(n,e){const t=e.center;let r=n.offsetDelta,o=n.prevDelta;const c=n.prevInput;return(e.eventType===Ri.Start||c?.eventType===Ri.End)&&(o=n.prevDelta={x:c?.deltaX||0,y:c?.deltaY||0},r=n.offsetDelta={x:t.x,y:t.y}),{deltaX:o.x+(t.x-r.x),deltaY:o.y+(t.y-r.y)}}function IC(n,e,t){return{x:e/n||0,y:t/n||0}}function S5(n,e){return A2(e[0],e[1])/A2(n[0],n[1])}function A5(n,e){return P2(e[1],e[0])-P2(n[1],n[0])}function P5(n,e){const t=n.lastInterval||e,r=e.timeStamp-t.timeStamp;let o,c,d,a;if(e.eventType!==Ri.Cancel&&(r>g5||t.velocity===void 0)){const v=e.deltaX-t.deltaX,A=e.deltaY-t.deltaY,P=IC(r,v,A);c=P.x,d=P.y,o=Math.abs(P.x)>Math.abs(P.y)?P.x:P.y,a=CC(v,A),n.lastInterval=e}else o=t.velocity,c=t.velocityX,d=t.velocityY,a=t.direction;e.velocity=o,e.velocityX=c,e.velocityY=d,e.direction=a}function E5(n,e){const{session:t}=n,{pointers:r}=e,{length:o}=r;t.firstInput||(t.firstInput=S2(e)),o>1&&!t.firstMultiple?t.firstMultiple=S2(e):o===1&&(t.firstMultiple=!1);const{firstInput:c,firstMultiple:d}=t,a=d?d.center:c.center,v=e.center=PC(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-c.timeStamp,e.angle=w5(a,v),e.distance=EC(a,v);const{deltaX:A,deltaY:P}=T5(t,e);e.deltaX=A,e.deltaY=P,e.offsetDirection=CC(e.deltaX,e.deltaY);const k=IC(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=k.x,e.overallVelocityY=k.y,e.overallVelocity=Math.abs(k.x)>Math.abs(k.y)?k.x:k.y,e.scale=d?S5(d.pointers,r):1,e.rotation=d?A5(d.pointers,r):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let L=n.element;return b5(e.srcEvent.target,L)&&(L=e.srcEvent.target),e.target=L,P5(t,e),e}function C5(n,e,t){const r=t.pointers.length,o=t.changedPointers.length,c=e&Ri.Start&&r-o===0,d=e&(Ri.End|Ri.Cancel)&&r-o===0;t.isFirst=!!c,t.isFinal=!!d,c&&(n.session={}),t.eventType=e;const a=E5(n,t);n.emit("hammer.input",a),n.recognize(a),n.session.prevInput=a}let I5=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){C5(this.manager,e,t)}init(){Qv(this.element,this.evEl,this.domHandler),Qv(this.target,this.evTarget,this.domHandler),Qv(T2(this.element),this.evWin,this.domHandler)}destroy(){e0(this.element,this.evEl,this.domHandler),e0(this.target,this.evTarget,this.domHandler),e0(T2(this.element),this.evWin,this.domHandler)}};const M5={pointerdown:Ri.Start,pointermove:Ri.Move,pointerup:Ri.End,pointercancel:Ri.Cancel,pointerout:Ri.Cancel},R5="pointerdown",k5="pointermove pointerup pointercancel";class D5 extends I5{constructor(e){super(e),this.evEl=R5,this.evWin=k5,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let r=!1;const o=M5[e.type],c=e.pointerType,d=c==="touch";let a=t.findIndex(v=>v.pointerId===e.pointerId);o&Ri.Start&&(e.buttons||d)?a<0&&(t.push(e),a=t.length-1):o&(Ri.End|Ri.Cancel)&&(r=!0),!(a<0)&&(t[a]=e,this.callback(o,{pointers:t,changedPointers:[e],eventType:o,pointerType:c,srcEvent:e}),r&&t.splice(a,1))}}const O5=["","webkit","Moz","MS","ms","o"];function L5(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const r of O5){const o=r?r+t:e;if(o in n)return o}}const F5=1,E2=2,C2={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class N5{constructor(e,t){this.options={...C2,...t,cssProps:{...C2.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new D5(this),this.touchAction=new x5(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?E2:F5}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:o}=this;let{curRecognizer:c}=t;(!c||c&&c.state&On.Recognized)&&(c=t.curRecognizer=null);let d=0;for(;d<o.length;)r=o[d],t.stopped!==E2&&(!c||r===c||r.canRecognizeWith(c))?r.recognize(e):r.reset(),!c&&r.state&(On.Began|On.Changed|On.Ended)&&(c=t.curRecognizer=r),d++}get(e){const{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:r}=this,o=r.indexOf(t);o!==-1&&(r.splice(o,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:r}=this;for(const o of sy(e))r[o]=r[o]||[],r[o].push(t)}off(e,t){if(!e)return;const{handlers:r}=this;for(const o of sy(e))t?r[o]&&r[o].splice(r[o].indexOf(t),1):delete r[o]}emit(e,t){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const o=t;o.type=e,o.preventDefault=function(){t.srcEvent.preventDefault()};let c=0;for(;c<r.length;)r[c](o),c++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[r,o]of Object.entries(this.options.cssProps)){const c=L5(t.style,r);e?(this.oldCssProps[c]=t.style[c],t.style[c]=o):t.style[c]=this.oldCssProps[c]||""}e||(this.oldCssProps={})}}}let B5=1;function z5(){return B5++}function I2(n){return n&On.Cancelled?"cancel":n&On.Ended?"end":n&On.Changed?"move":n&On.Began?"start":""}class MC{constructor(e){this.options=e,this.id=z5(),this.state=On.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const o of e)this.recognizeWith(o);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const o of e)this.requireFailure(o);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:r}=this;return r.indexOf(t)===-1&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const r=this.requireFail.indexOf(t);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<On.Ended&&this.manager.emit(this.options.event+I2(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=On.Ended&&this.manager.emit(this.options.event+I2(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=On.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(On.Failed|On.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=On.Failed;return}this.state&(On.Recognized|On.Cancelled|On.Failed)&&(this.state=On.Possible),this.state=this.process(t),this.state&(On.Began|On.Changed|On.Ended|On.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class RC extends MC{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:r}=e,o=t&(On.Began|On.Changed),c=this.attrTest(e);return o&&(r&Ri.Cancel||!c)?t|On.Cancelled:o||c?r&Ri.End?t|On.Ended:t&On.Began?t|On.Changed:On.Began:On.Failed}}class M2 extends MC{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[tx]}process(e){const{options:t}=this,r=e.pointers.length===t.pointers,o=e.distance<t.threshold,c=e.deltaTime<t.time;if(this.reset(),e.eventType&Ri.Start&&this.count===0)return this.failTimeout();if(o&&c&&r){if(e.eventType!==Ri.End)return this.failTimeout();const d=this.pTime?e.timeStamp-this.pTime<t.interval:!0,a=!this.pCenter||EC(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!d?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=On.Recognized,this.tryEmit(this._input)},t.interval),On.Began):On.Recognized}return On.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=On.Failed},this.options.interval),On.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===On.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const U5=["","start","move","end","cancel","up","down","left","right"];class R2 extends RC{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Xi.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Xi.Horizontal&&t.push(rx),e&Xi.Vertical&&t.push(nx),t}getEventNames(){return U5.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let r=!0,{distance:o}=e,{direction:c}=e;const d=e.deltaX,a=e.deltaY;return c&t.direction||(t.direction&Xi.Horizontal?(c=d===0?Xi.None:d<0?Xi.Left:Xi.Right,r=d!==this.pX,o=Math.abs(e.deltaX)):(c=a===0?Xi.None:a<0?Xi.Up:Xi.Down,r=a!==this.pY,o=Math.abs(e.deltaY))),e.direction=c,r&&o>t.threshold&&!!(c&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&On.Began)||!(this.state&On.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Xi[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const V5=["","start","move","end","cancel","in","out"];class j5 extends RC{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[L_]}getEventNames(){return V5.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&On.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Ry{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}const $5=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",W5=$5.indexOf("firefox")!==-1,k2=4.000244140625,H5=40,Z5=.25;class X5 extends Ry{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=o=>{if(!this.options.enable)return;let c=o.deltaY;globalThis.WheelEvent&&(W5&&o.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(c/=globalThis.devicePixelRatio),o.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(c*=H5)),c!==0&&c%k2===0&&(c=Math.floor(c/k2)),o.shiftKey&&c&&(c=c*Z5),this.callback({type:"wheel",center:{x:o.clientX,y:o.clientY},delta:-c,srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const D2=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class q5 extends Ry{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=c=>{this.handleOverEvent(c),this.handleOutEvent(c),this.handleEnterEvent(c),this.handleLeaveEvent(c),this.handleMoveEvent(c)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,D2.forEach(c=>e.addEventListener(c,this.handleEvent))}destroy(){D2.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const O2=["keydown","keyup"];class G5 extends Ry{constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=o=>{const c=o.target||o.srcElement;c.tagName==="INPUT"&&c.type==="text"||c.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:"keydown",srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:"keyup",srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",O2.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){O2.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class Y5 extends Ry{constructor(e,t,r){super(e,t,r),this.handleEvent=o=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const L2=1,ix=2,F2=4,K5={pointerdown:L2,pointermove:ix,pointerup:F2,mousedown:L2,mousemove:ix,mouseup:F2},J5=0,Q5=1,eU=2,tU=1,nU=2,rU=4;function iU(n){const e=K5[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=n.srcEvent;let o=!1,c=!1,d=!1;return e===ix?(o=!!(t&tU),c=!!(t&rU),d=!!(t&nU)):(o=r===J5,c=r===Q5,d=r===eU),{leftButton:o,middleButton:c,rightButton:d}}function sU(n,e){const t=n.center;if(!t)return null;const r=e.getBoundingClientRect(),o=r.width/e.offsetWidth||1,c=r.height/e.offsetHeight||1,d={x:(t.x-r.left-e.clientLeft)/o,y:(t.y-r.top-e.clientTop)/c};return{center:t,offsetCenter:d}}const oU={srcElement:"root",priority:0};class aU{constructor(e,t){this.handleEvent=r=>{if(this.isEmpty())return;const o=this._normalizeEvent(r);let c=r.srcEvent.target;for(;c&&c!==o.rootElement;){if(this._emit(o,c),o.handled)return;c=c.parentNode}this._emit(o,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,o=!1,c=!1){const{handlers:d,handlersByElement:a}=this,v={...oU,...r};let A=a.get(v.srcElement);A||(A=[],a.set(v.srcElement,A));const P={type:e,handler:t,srcElement:v.srcElement,priority:v.priority};o&&(P.once=!0),c&&(P.passive=!0),d.push(P),this._active=this._active||!P.passive;let k=A.length-1;for(;k>=0&&!(A[k].priority>=P.priority);)k--;A.splice(k+1,0,P)}remove(e,t){const{handlers:r,handlersByElement:o}=this;for(let c=r.length-1;c>=0;c--){const d=r[c];if(d.type===e&&d.handler===t){r.splice(c,1);const a=o.get(d.srcElement);a.splice(a.indexOf(d),1),a.length===0&&o.delete(d.srcElement)}}this._active=r.some(c=>!c.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let o=!1;const c=()=>{e.handled=!0},d=()=>{e.handled=!0,o=!0},a=[];for(let v=0;v<r.length;v++){const{type:A,handler:P,once:k}=r[v];if(P({...e,type:A,stopPropagation:c,stopImmediatePropagation:d}),k&&a.push(r[v]),o)break}for(let v=0;v<a.length;v++){const{type:A,handler:P}=a[v];this.remove(A,P)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...iU(e),...sU(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function lU(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const r=t.shift(),o=t.shift()||{};e=new r(o)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class cU{constructor(e=null,t={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new N5(e,this.options);for(const r of this.options.recognizers){const{recognizer:o,recognizeWith:c,requireFailure:d}=lU(r);this.manager.add(o),c&&o.recognizeWith(c),d&&o.requireFailure(d)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new X5(e,this._onOtherEvent,{enable:!1}),this.moveInput=new q5(e,this._onOtherEvent,{enable:!1}),this.keyInput=new G5(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Y5(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const o=r.get(e);o&&(o.set({enable:t}),r.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,r,o,c){if(typeof e!="string"){r=t;for(const[A,P]of Object.entries(e))this._addEventHandler(A,P,r,o,c);return}const{manager:d,events:a}=this;if(!d)return;let v=a.get(e);if(!v){const A=this._getRecognizerName(e)||e;v=new aU(this,A),a.set(e,v),d&&d.on(e,v.handleEvent)}v.add(e,t,r,o,c),v.isEmpty()||this._toggleRecognizer(v.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[c,d]of Object.entries(e))this._removeEventHandler(c,d);return}const{events:r}=this,o=r.get(e);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:c}=o;let d=!1;for(const a of r.values())if(a.recognizerName===c&&!a.isEmpty()){d=!0;break}d||this._toggleRecognizer(c,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const Vn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Vn,"IDENTITY",{get:()=>(_r.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ia={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Mh={common:0,meters:1,pixels:2},sx={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},N2={multipan:[R2,{threshold:10,direction:Xi.Vertical,pointers:2}],pinch:[j5,{},null,["multipan"]],pan:[R2,{threshold:1},["pinch"],["multipan"]],dblclick:[M2,{event:"dblclick",taps:2}],click:[M2,{event:"click"},null,["dblclick"]]};function uU(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}function yg(n){let e={},t;return r=>{for(const o in r)if(!uU(r[o],e[o])){t=n(r),e=r;break}return t}}const B2=[0,0,0,0],hU=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],kC=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dU=[0,0,0],DC=[0,0,0],fU=yg(gU);function OC(n,e,t=DC){t.length<3&&(t=[t[0],t[1],0]);let r=t,o,c=!0;switch(e===Vn.LNGLAT_OFFSETS||e===Vn.METER_OFFSETS?o=t:o=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case Ia.WEB_MERCATOR:(e===Vn.LNGLAT||e===Vn.CARTESIAN)&&(o=[0,0,0],c=!1);break;case Ia.WEB_MERCATOR_AUTO_OFFSET:e===Vn.LNGLAT?r=o:e===Vn.CARTESIAN&&(r=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],o=n.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Ia.IDENTITY:r=n.position.map(Math.fround),r[2]=r[2]||0;break;case Ia.GLOBE:c=!1,o=null;break;default:c=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:r,offsetMode:c}}function pU(n,e,t){const{viewMatrixUncentered:r,projectionMatrix:o}=n;let{viewMatrix:c,viewProjectionMatrix:d}=n,a=B2,v=B2,A=n.cameraPosition;const{geospatialOrigin:P,shaderCoordinateOrigin:k,offsetMode:L}=OC(n,e,t);return L&&(v=n.projectPosition(P||k),A=[A[0]-v[0],A[1]-v[1],A[2]-v[2]],v[3]=1,a=_g([],v,d),c=r||c,d=Bd([],o,c),d=Bd([],d,hU)),{viewMatrix:c,viewProjectionMatrix:d,projectionCenter:a,originCommon:v,cameraPosCommon:A,shaderCoordinateOrigin:k,geospatialOrigin:P}}function mU({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=Vn.DEFAULT,coordinateOrigin:o=DC,autoWrapLongitude:c=!1}){r===Vn.DEFAULT&&(r=n.isGeospatial?Vn.LNGLAT:Vn.CARTESIAN);const d=fU({viewport:n,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:o});return d.wrapLongitude=c,d.modelMatrix=t||kC,d}function gU({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:o,viewProjectionMatrix:c,originCommon:d,cameraPosCommon:a,shaderCoordinateOrigin:v,geospatialOrigin:A}=pU(n,t,r),P=n.getDistanceScales(),k=[n.width*e,n.height*e],L=_g([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,z={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:v,commonOrigin:d.slice(0,3),center:o,pseudoMeters:!!n._pseudoMeters,viewportSize:k,devicePixelRatio:e,focalDistance:L,commonUnitsPerMeter:P.unitsPerMeter,commonUnitsPerWorldUnit:P.unitsPerMeter,commonUnitsPerWorldUnit2:dU,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:c,modelMatrix:kC,cameraPosition:a};if(A){const G=n.getDistanceScales(A);switch(t){case Vn.METER_OFFSETS:z.commonUnitsPerWorldUnit=G.unitsPerMeter,z.commonUnitsPerWorldUnit2=G.unitsPerMeter2;break;case Vn.LNGLAT:case Vn.LNGLAT_OFFSETS:n._pseudoMeters||(z.commonUnitsPerMeter=G.unitsPerMeter),z.commonUnitsPerWorldUnit=G.unitsPerDegree,z.commonUnitsPerWorldUnit2=G.unitsPerDegree2;break;case Vn.CARTESIAN:z.commonUnitsPerWorldUnit=[1,1,G.unitsPerMeter[2]],z.commonUnitsPerWorldUnit2=[0,0,G.unitsPerMeter2[2]];break}}return z}const _U=Object.keys(Vn).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${Vn[n]};`).join(""),yU=Object.keys(Ia).map(n=>`const PROJECTION_MODE_${n}: i32 = ${Ia[n]};`).join(""),vU=Object.keys(Mh).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Mh[n]};`).join(""),xU=`${_U}
${yU}
${vU}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,bU=`${xU}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,wU=Object.keys(Vn).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Vn[n]};`).join(""),TU=Object.keys(Ia).map(n=>`const int PROJECTION_MODE_${n} = ${Ia[n]};`).join(""),SU=Object.keys(Mh).map(n=>`const int UNIT_${n.toUpperCase()} = ${Mh[n]};`).join(""),AU=`${wU}
${TU}
${SU}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,PU={};function EU(n=PU){return"viewport"in n?mU(n):{}}const kb={name:"project",dependencies:[Y6,AC],source:bU,vs:AU,getUniforms:EU,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},CU=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,IU=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Dp={name:"project32",dependencies:[kb],source:CU,vs:IU};function MU(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function dp(n,e){const t=_g([],e,n);return U6(t,t,1/t[3]),t}function z2(n,e){const t=n%e;return t<0?e+t:t}function RU(n,e,t){return t*e+(1-t)*n}function ox(n,e,t){return n<e?e:n>t?t:n}function kU(n){return Math.log(n)*Math.LOG2E}const Db=Math.log2||kU;function Cu(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Al=Math.PI,LC=Al/4,Da=Al/180,ax=180/Al,bp=512,oy=4003e4,f_=85.051129,DU=1.5;function U2(n){return Math.pow(2,n)}function FC(n){return Db(n)}function wp(n){const[e,t]=n;Cu(Number.isFinite(e)),Cu(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*Da,o=t*Da,c=bp*(r+Al)/(2*Al),d=bp*(Al+Math.log(Math.tan(LC+o*.5)))/(2*Al);return[c,d]}function $d(n){const[e,t]=n,r=e/bp*(2*Al)-Al,o=2*(Math.atan(Math.exp(t/bp*(2*Al)-Al))-LC);return[r*ax,o*ax]}function OU(n){const{latitude:e}=n;Cu(Number.isFinite(e));const t=Math.cos(e*Da);return FC(oy*t)-9}function t0(n){const e=Math.cos(n*Da);return bp/oy/e}function lx(n){const{latitude:e,longitude:t,highPrecision:r=!1}=n;Cu(Number.isFinite(e)&&Number.isFinite(t));const o=bp,c=Math.cos(e*Da),d=o/360,a=d/c,v=o/oy/c,A={unitsPerMeter:[v,v,v],metersPerUnit:[1/v,1/v,1/v],unitsPerDegree:[d,a,v],degreesPerUnit:[1/d,1/a,1/v]};if(r){const P=Da*Math.tan(e*Da)/c,k=d*P/2,L=o/oy*P,z=L/a*v;A.unitsPerDegree2=[0,k,L],A.unitsPerMeter2=[z,0,z]}return A}function NC(n,e){const[t,r,o]=n,[c,d,a]=e,{unitsPerMeter:v,unitsPerMeter2:A}=lx({longitude:t,latitude:r,highPrecision:!0}),P=wp(n);P[0]+=c*(v[0]+A[0]*d),P[1]+=d*(v[1]+A[1]*d);const k=$d(P),L=(o||0)+(a||0);return Number.isFinite(o)||Number.isFinite(a)?[k[0],k[1],L]:k}function LU(n){const{height:e,pitch:t,bearing:r,altitude:o,scale:c,center:d}=n,a=MU();iy(a,a,[0,0,-o]),vC(a,a,-t*Da),xC(a,a,r*Da);const v=c/e;return Rb(a,a,[v,v,v]),d&&iy(a,a,g6([],d)),a}function FU(n){const{width:e,height:t,altitude:r,pitch:o=0,offset:c,center:d,scale:a,nearZMultiplier:v=1,farZMultiplier:A=1}=n;let{fovy:P=ay(DU)}=n;r!==void 0&&(P=ay(r));const k=P*Da,L=o*Da,z=BC(P);let G=z;d&&(G+=d[2]*a/Math.cos(L)/t);const te=k*(.5+(c?c[1]:0)/t),re=Math.sin(te)*G/Math.sin(ox(Math.PI/2-L-te,.01,Math.PI-.01)),fe=Math.sin(L)*re+G,ve=G*10,le=Math.min(fe*A,ve);return{fov:k,aspect:e/t,focalDistance:z,near:v,far:le}}function ay(n){return 2*Math.atan(.5/n)*ax}function BC(n){return .5/Math.tan(.5*n*Da)}function zC(n,e){const[t,r,o=0]=n;return Cu(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(o)),dp(e,[t,r,o,1])}function Ob(n,e,t=0){const[r,o,c]=n;if(Cu(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(c))return dp(e,[r,o,c,1]);const d=dp(e,[r,o,0,1]),a=dp(e,[r,o,1,1]),v=d[2],A=a[2],P=v===A?0:((t||0)-v)/(A-v);return gC([],d,a,P)}function NU(n){const{width:e,height:t,bounds:r,minExtent:o=0,maxZoom:c=24,offset:d=[0,0]}=n,[[a,v],[A,P]]=r,k=BU(n.padding),L=wp([a,ox(P,-f_,f_)]),z=wp([A,ox(v,-f_,f_)]),G=[Math.max(Math.abs(z[0]-L[0]),o),Math.max(Math.abs(z[1]-L[1]),o)],te=[e-k.left-k.right-Math.abs(d[0])*2,t-k.top-k.bottom-Math.abs(d[1])*2];Cu(te[0]>0&&te[1]>0);const re=te[0]/G[0],fe=te[1]/G[1],ve=(k.right-k.left)/2/re,le=(k.top-k.bottom)/2/fe,Se=[(z[0]+L[0])/2+ve,(z[1]+L[1])/2+le],Ne=$d(Se),nt=Math.min(c,Db(Math.abs(Math.min(re,fe))));return Cu(Number.isFinite(nt)),{longitude:Ne[0],latitude:Ne[1],zoom:nt}}function BU(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(Cu(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const V2=Math.PI/180;function zU(n,e=0){const{width:t,height:r,unproject:o}=n,c={targetZ:e},d=o([0,r],c),a=o([t,r],c);let v,A;const P=n.fovy?.5*n.fovy*V2:Math.atan(.5/n.altitude),k=(90-n.pitch)*V2;return P>k-.01?(v=j2(n,0,e),A=j2(n,t,e)):(v=o([0,0],c),A=o([t,0],c)),[d,a,A,v]}function j2(n,e,t){const{pixelUnprojectionMatrix:r}=n,o=dp(r,[e,0,1,1]),c=dp(r,[e,n.height,1,1]),a=(t*n.distanceScales.unitsPerMeter[2]-o[2])/(c[2]-o[2]),v=gC([],o,c,a),A=$d(v);return A.push(t),A}const $2=512;function UU(n){const{width:e,height:t,pitch:r=0}=n;let{longitude:o,latitude:c,zoom:d,bearing:a=0}=n;(o<-180||o>180)&&(o=z2(o+180,360)-180),(a<-180||a>180)&&(a=z2(a+180,360)-180);const v=Db(t/$2);if(d<=v)d=v,c=0;else{const A=t/2/Math.pow(2,d),P=$d([0,A])[1];if(c<P)c=P;else{const k=$d([0,$2-A])[1];c>k&&(c=k)}}return{width:e,height:t,longitude:o,latitude:c,zoom:d,pitch:r,bearing:a}}const UC=.01,VU=["longitude","latitude","zoom"],VC={curve:1.414,speed:1.2};function jU(n,e,t,r){const{startZoom:o,startCenterXY:c,uDelta:d,w0:a,u1:v,S:A,rho:P,rho2:k,r0:L}=jC(n,e,r);if(v<UC){const Se={};for(const Ne of VU){const nt=n[Ne],pt=e[Ne];Se[Ne]=RU(nt,pt,t)}return Se}const z=t*A,G=Math.cosh(L)/Math.cosh(L+P*z),te=a*((Math.cosh(L)*Math.tanh(L+P*z)-Math.sinh(L))/k)/v,re=1/G,fe=o+FC(re),ve=a6([],d,te);J0(ve,ve,c);const le=$d(ve);return{longitude:le[0],latitude:le[1],zoom:fe}}function $U(n,e,t){const r={...VC,...t},{screenSpeed:o,speed:c,maxDuration:d}=r,{S:a,rho:v}=jC(n,e,r),A=1e3*a;let P;return Number.isFinite(o)?P=A/(o/v):P=A/c,Number.isFinite(d)&&P>d?0:P}function jC(n,e,t){t=Object.assign({},VC,t);const r=t.curve,o=n.zoom,c=[n.longitude,n.latitude],d=U2(o),a=e.zoom,v=[e.longitude,e.latitude],A=U2(a-o),P=wp(c),k=wp(v),L=h6([],k,P),z=Math.max(n.width,n.height),G=z/A,te=l6(L)*d,re=Math.max(te,UC),fe=r*r,ve=(G*G-z*z+fe*fe*re*re)/(2*z*fe*re),le=(G*G-z*z-fe*fe*re*re)/(2*G*fe*re),Se=Math.log(Math.sqrt(ve*ve+1)-ve),Ne=Math.log(Math.sqrt(le*le+1)-le),nt=(Ne-Se)/r;return{startZoom:o,startCenterXY:P,uDelta:L,w0:z,u1:te,S:nt,rho:r,rho2:fe,r0:Se,r1:Ne}}const $C=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,WU=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,HU=`
${$C}
${WU}
`,ZU=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,XU=`
${$C}
${ZU}
`,qU=yg(QU),GU=yg(e8),YU=[0,0,0,1],KU=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function JU(n,e){const[t,r,o]=n,c=Ob([t,r,o],e);return Number.isFinite(o)?c:[c[0],c[1],0]}function QU({viewport:n,center:e}){return new Ic(n.viewProjectionMatrix).invert().transform(e)}function e8({viewport:n,shadowMatrices:e}){const t=[],r=n.pixelUnprojectionMatrix,o=n.isGeospatial?void 0:1,c=[[0,0,o],[n.width,0,o],[0,n.height,o],[n.width,n.height,o],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(d=>JU(d,r));for(const d of e){const a=d.clone().translate(new Cc(n.center).negate()),v=c.map(P=>a.transform(P)),A=new Ic().ortho({left:Math.min(...v.map(P=>P[0])),right:Math.max(...v.map(P=>P[0])),bottom:Math.min(...v.map(P=>P[1])),top:Math.max(...v.map(P=>P[1])),near:Math.min(...v.map(P=>-P[2])),far:Math.max(...v.map(P=>-P[2]))});t.push(A.multiplyRight(d))}return t}function t8(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const r=kb.getUniforms(t),o=qU({viewport:t.viewport,center:r.center}),c=[],d=GU({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let v=0;v<n.shadowMatrices.length;v++){const A=d[v],P=A.clone().translate(new Cc(t.viewport.center).negate());r.coordinateSystem===Vn.LNGLAT&&r.projectionMode===Ia.WEB_MERCATOR?(d[v]=P,c[v]=o):(d[v]=A.clone().multiplyRight(KU),c[v]=P.transform(o))}const a={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||YU,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let v=0;v<d.length;v++)a[`viewProjectionMatrix${v}`]=d[v],a[`projectCenter${v}`]=c[v];for(let v=0;v<2;v++)a[`shadow_uShadowMap${v}`]=n.shadowMaps&&n.shadowMaps[v]||n.dummyShadowMap;return a}const W2={name:"shadow",dependencies:[kb],vs:HU,fs:XU,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:t8,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},ky={...x2,defaultUniforms:{...x2.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},n8=[AC],r8=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],i8=[];function s8(n){const e=Rd.getDefaultShaderAssembler();for(const r of n8)e.addDefaultModule(r);const t=n==="glsl"?r8:i8;for(const r of t)e.addShaderHook(r);return e}const o8=[255,255,255],a8=1;let l8=0;class c8{constructor(e={}){this.type="ambient";const{color:t=o8}=e,{intensity:r=a8}=e;this.id=e.id||`ambient-${l8++}`,this.color=t,this.intensity=r}}const u8=[255,255,255],h8=1,d8=[0,0,-1];let f8=0;class H2{constructor(e={}){this.type="directional";const{color:t=u8}=e,{intensity:r=h8}=e,{direction:o=d8}=e,{_shadow:c=!1}=e;this.id=e.id||`directional-${f8++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new Cc(o).normalize().toArray(),this.shadow=c}getProjectedLight(e){return this}}class p8{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Lb extends p8{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,r]=this.device.canvasContext.getDrawingBufferSize(),o=e.clearCanvas??!0,c=e.clearColor??(o?[0,0,0,0]:!1),d=o?1:!1,a=o?0:!1,v=e.colorMask??15,A={viewport:[0,0,t,r]};e.colorMask&&(A.colorMask=v),e.scissorRect&&(A.scissorRect=e.scissorRect);const P=this.device.beginRenderPass({framebuffer:e.target,parameters:A,clearColor:c,clearDepth:d,clearStencil:a});try{return this._drawLayers(P,e)}finally{P.end(),this.device.submit()}}_drawLayers(e,t){const{target:r,shaderModuleProps:o,viewports:c,views:d,onViewportActive:a,clearStack:v=!0}=t;t.pass=t.pass||"unknown",v&&(this._lastRenderIndex=-1);const A=[];for(const P of c){const k=d&&d[P.id];a?.(P);const L=this._getDrawLayerParams(P,t),z=P.subViewports||[P];for(const G of z){const te=this._drawLayersInViewport(e,{target:r,shaderModuleProps:o,viewport:G,view:k,pass:t.pass,layers:t.layers},L);A.push(te)}}return A}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:o=!1,layerFilter:c,cullRect:d,effects:a,shaderModuleProps:v},A=!1){const P=[],k=WC(this._lastRenderIndex+1),L={layer:t[0],viewport:e,isPicking:o,renderPass:r,cullRect:d},z={};for(let G=0;G<t.length;G++){const te=t[G],re=this._shouldDrawLayer(te,L,c,z),fe={shouldDrawLayer:re};re&&!A&&(fe.shouldDrawLayer=!0,fe.layerRenderIndex=k(te,re),fe.shaderModuleProps=this._getShaderModuleProps(te,a,r,v),fe.layerParameters={...te.context.deck?.props.parameters,...this.getLayerParameters(te,G,e)}),P[G]=fe}return P}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:o,target:c,viewport:d,view:a},v){const A=m8(this.device,{shaderModuleProps:r,target:c,viewport:d});if(a&&a.props.clear){const k=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:c,parameters:{viewport:A,scissorRect:A},clearColor:k.color?[0,0,0,0]:!1,clearDepth:k.depth?1:!1}).end()}const P={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:A});for(let k=0;k<t.length;k++){const L=t[k],z=v[k],{shouldDrawLayer:G}=z;if(G&&L.props.pickable&&P.pickableCount++,L.isComposite&&P.compositeCount++,L.isDrawable&&z.shouldDrawLayer){const{layerRenderIndex:te,shaderModuleProps:re,layerParameters:fe}=z;P.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,te),re.project&&(re.project.viewport=d),L.context.renderPass=e;try{L._drawLayer({renderPass:e,shaderModuleProps:re,uniforms:{layerIndex:te},parameters:fe})}catch(ve){L.raiseError(ve,`drawing ${L} to ${o}`)}}}return P}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let d=e.parent;for(;d;){if(!d.props.visible||!d.filterSubLayer(t))return!1;t.layer=d,d=d.parent}if(r){const a=t.layer.id;if(a in o||(o[a]=r(t)),!o[a])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,o){const c=this.device.canvasContext.cssToDeviceRatio(),d=e.internalState?.propsInTransition||e.props,a={layer:d,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:c,modelMatrix:d.modelMatrix,coordinateSystem:d.coordinateSystem,coordinateOrigin:d.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const v of t)Z2(a,v.getShaderModuleProps?.(e,a));return Z2(a,this.getShaderModuleProps(e,t,a),o)}}function WC(n=0,e={}){const t={},r=(o,c)=>{const d=o.props._offset,a=o.id,v=o.parent&&o.parent.id;let A;if(v&&!(v in e)&&r(o.parent,!1),v in t){const P=t[v]=t[v]||WC(e[v],e);A=P(o,c),t[a]=P}else Number.isFinite(d)?(A=d+(e[v]||0),t[a]=null):A=n;return c&&A>=n&&(n=A+1),e[a]=A,A};return r}function m8(n,{shaderModuleProps:e,target:t,viewport:r}){const o=e?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,c]=n.canvasContext.getDrawingBufferSize(),d=t?t.height:c,a=r;return[a.x*o,d-(a.y+a.height)*o,a.width*o,a.height*o]}function Z2(n,...e){for(const t of e)if(t)for(const r in t)n[r]?Object.assign(n[r],t[r]):n[r]=t[r];return n}class g8 extends Lb{constructor(e,t){super(e,t);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),o=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:o})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),o=e.viewports[0],c=o.width*r,d=o.height*r,a=[1,1,1,1];(c!==t.width||d!==t.height)&&t.resize({width:c,height:d}),super.render({...e,clearColor:a,target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const _8={color:[255,255,255],intensity:1},X2=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],y8=[0,0,0,200/255];class HC{constructor(e={}){this.id="lighting-effect",this.shadowColor=y8,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(W2),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:o,views:c}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let d=0;d<this.shadowPasses.length;d++)this.shadowPasses[d].render({layers:e,layerFilter:t,viewports:r,onViewportActive:o,views:c,shaderModuleProps:{shadow:{shadowLightId:d,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(d=>d.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},o={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(d=>d.getProjectedLight({layer:e})),pointLights:this.pointLights.map(d=>d.getProjectedLight({layer:e}))},c=e.props.material;return{shadow:r,lighting:o,phongMaterial:c,gouraudMaterial:c}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(W2))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new Ic().lookAt({eye:new Cc(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new g8(e);this.shadowPasses[t]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new c8(_8),this.directionalLights.push(new H2(X2[0]),new H2(X2[1])))}}class v8{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:o,padding:c=0,copy:d=!1,initialize:a=!1,maxCount:v}){const A=o||e&&e.constructor||Float32Array,P=t*r+c;if(ArrayBuffer.isView(e)){if(P<=e.length)return e;if(P*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new A(e.buffer,0,P)}let k=1/0;v&&(k=v*r+c);const L=this._allocate(A,P,a,k);return e&&d?L.set(e):a||L.fill(0,0,4),this._release(e),L}release(e){this._release(e)}_allocate(e,t,r,o){let c=Math.max(Math.ceil(t*this.opts.overAlloc),1);c>o&&(c=o);const d=this._pool,a=e.BYTES_PER_ELEMENT*c,v=d.findIndex(A=>A.byteLength>=a);if(v>=0){const A=new e(d.splice(v,1)[0],0,c);return r&&A.fill(0),A}return new e(c)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:o}=r,c=t.findIndex(d=>d.byteLength>=o);c<0?t.push(r):(c>0||t.length<this.opts.poolSize)&&t.splice(c,0,r),t.length>this.opts.poolSize&&t.shift()}}const Tp=new v8;function km(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function x8(n){return[n[12],n[13],n[14]]}function b8(n){return{left:Yf(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Yf(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Yf(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Yf(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Yf(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Yf(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const q2=new Cc;function Yf(n,e,t,r){q2.set(n,e,t);const o=q2.len();return{distance:r/o,normal:new Cc(-n/o,-e/o,-t/o)}}function w8(n){return n-Math.fround(n)}let Pm;function n0(n,e){const{size:t=1,startIndex:r=0}=e,o=e.endIndex!==void 0?e.endIndex:n.length,c=(o-r)/t;Pm=Tp.allocate(Pm,c,{type:Float32Array,size:t*2});let d=r,a=0;for(;d<o;){for(let v=0;v<t;v++){const A=n[d++];Pm[a+v]=A,Pm[a+v+t]=w8(A)}a+=t*2}return Pm.subarray(0,c*t*2)}function T8(n){let e=null,t=!1;for(const r of n)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const S8=Math.PI/180,A8=km(),G2=[0,0,0],P8={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function E8({width:n,height:e,orthographic:t,fovyRadians:r,focalDistance:o,padding:c,near:d,far:a}){const v=n/e,A=t?new Ic().orthographic({fovy:r,aspect:v,focalDistance:o,near:d,far:a}):new Ic().perspective({fovy:r,aspect:v,near:d,far:a});if(c){const{left:P=0,right:k=0,top:L=0,bottom:z=0}=c,G=bh((P+n-k)/2,0,n)-n/2,te=bh((L+e-z)/2,0,e)-e/2;A[8]-=G*2/n,A[9]+=te*2/e}return A}class vg{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||P8,this.focalDistance=e.focalDistance||1,this.position=e.position||G2,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ia.WEB_MERCATOR:Ia.WEB_MERCATOR_AUTO_OFFSET:Ia.IDENTITY}equals(e){return e instanceof vg?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&sg(e.projectionMatrix,this.projectionMatrix)&&sg(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),o=zC(r,this.pixelProjectionMatrix),[c,d]=o,a=t?d:this.height-d;return e.length===2?[c,a]:[c,a,o[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[o,c,d]=e,a=t?c:this.height-c,v=r&&r*this.distanceScales.unitsPerMeter[2],A=Ob([o,a,d],this.pixelUnprojectionMatrix,v),[P,k,L]=this.unprojectPosition(A);return Number.isFinite(d)?[P,k,L]:Number.isFinite(r)?[P,k,r]:[P,k]}projectPosition(e){const[t,r]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,o]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,o]}projectFlat(e){if(this.isGeospatial){const t=wp(e);return t[1]=bh(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?$d(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),o=this.unproject([this.width,0],t),c=this.unproject([0,this.height],t),d=this.unproject([this.width,this.height],t);return[Math.min(r[0],o[0],c[0],d[0]),Math.min(r[1],o[1],c[1],d[1]),Math.max(r[0],o[0],c[0],d[0]),Math.max(r[1],o[1],c[1],d[1])]}getDistanceScales(e){return e&&this.isGeospatial?lx({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:o=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,b8(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=OU({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||lx({latitude:r,longitude:t}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:c,modelMatrix:d}=e;let a=G2;if(c&&(a=d?new Ic(d).transformAsVector(c,[]):c),this.isGeospatial){const v=this.projectPosition([t,r,0]);this.center=new Cc(a).scale(this.distanceScales.unitsPerMeter).add(v)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:t=A8,projectionMatrix:r=null,orthographic:o=!1,fovyRadians:c,fovy:d=75,near:a=.1,far:v=1e3,padding:A=null,focalDistance:P=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Ic().multiplyRight(t).translate(new Cc(this.center).negate()),this.projectionMatrix=r||E8({width:this.width,height:this.height,orthographic:o,fovyRadians:c||d*S8,focalDistance:P,padding:A,near:a,far:v});const k=km();Bd(k,k,this.projectionMatrix),Bd(k,k,this.viewMatrix),this.viewProjectionMatrix=k,this.viewMatrixInverse=Q0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=x8(this.viewMatrixInverse);const L=km(),z=km();Rb(L,L,[this.width/2,-this.height/2,1]),iy(L,L,[1,-1,0]),Bd(z,L,this.viewProjectionMatrix),this.pixelProjectionMatrix=z,this.pixelUnprojectionMatrix=Q0(km(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||_r.warn("Pixel project matrix not invertible")()}}vg.displayName="Viewport";class Sp extends vg{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:o=0,pitch:c=0,bearing:d=0,nearZMultiplier:a=.1,farZMultiplier:v=1.01,nearZ:A,farZ:P,orthographic:k=!1,projectionMatrix:L,repeat:z=!1,worldOffset:G=0,position:te,padding:re,legacyMeterSizes:fe=!1}=e;let{width:ve,height:le,altitude:Se=1.5}=e;const Ne=Math.pow(2,o);ve=ve||1,le=le||1;let nt,pt=null;if(L)Se=L[5]/2,nt=ay(Se);else{e.fovy?(nt=e.fovy,Se=BC(nt)):nt=ay(Se);let Tt;if(re){const{top:Mt=0,bottom:Zt=0}=re;Tt=[0,bh((Mt+le-Zt)/2,0,le)-le/2]}pt=FU({width:ve,height:le,scale:Ne,center:te&&[0,0,te[2]*t0(t)],offset:Tt,pitch:c,fovy:nt,nearZMultiplier:a,farZMultiplier:v}),Number.isFinite(A)&&(pt.near=A),Number.isFinite(P)&&(pt.far=P)}let mt=LU({height:le,pitch:c,bearing:d,scale:Ne,altitude:Se});G&&(mt=new Ic().translate([512*G,0,0]).multiplyLeft(mt)),super({...e,width:ve,height:le,viewMatrix:mt,longitude:r,latitude:t,zoom:o,...pt,fovy:nt,focalDistance:Se}),this.latitude=t,this.longitude=r,this.zoom=o,this.pitch=c,this.bearing=d,this.altitude=Se,this.fovy=nt,this.orthographic=k,this._subViewports=z?[]:null,this._pseudoMeters=fe,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let o=t;o<=r;o++){const c=o?new Sp({...this,worldOffset:o}):this;this._subViewports.push(c)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),o=(e[2]||0)*t0(e[1]);return[t,r,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),o=(e[2]||0)/t0(r);return[t,r,o]}addMetersToLngLat(e,t){return NC(e,t)}panByPosition(e,t){const r=Ob(t,this.pixelUnprojectionMatrix),o=this.projectFlat(e),c=J0([],o,c6([],r)),d=J0([],this.center,c),[a,v]=this.unprojectFlat(d);return{longitude:a,latitude:v}}getBounds(e={}){const t=zU(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:o}=this,{longitude:c,latitude:d,zoom:a}=NU({width:r,height:o,bounds:e,...t});return new Sp({width:r,height:o,longitude:c,latitude:d,zoom:a})}}Sp.displayName="WebMercatorViewport";const Y2=[0,0,0];function r0(n,e,t=!1){const r=e.projectPosition(n);if(t&&e instanceof Sp){const[o,c,d=0]=n,a=e.getDistanceScales([o,c]);r[2]=d*a.unitsPerMeter[2]}return r}function C8(n){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=n;let{coordinateSystem:o,fromCoordinateSystem:c,fromCoordinateOrigin:d}=n;return o===Vn.DEFAULT&&(o=e.isGeospatial?Vn.LNGLAT:Vn.CARTESIAN),c===void 0&&(c=o),d===void 0&&(d=r),{viewport:e,coordinateSystem:o,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:c,fromCoordinateOrigin:d}}function ZC(n,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:o,offsetMode:c}){let[d,a,v=0]=n;switch(t&&([d,a,v]=_g([],[d,a,v,1],t)),r){case Vn.LNGLAT:return r0([d,a,v],e,c);case Vn.LNGLAT_OFFSETS:return r0([d+o[0],a+o[1],v+(o[2]||0)],e,c);case Vn.METER_OFFSETS:return r0(NC(o,[d,a,v]),e,c);case Vn.CARTESIAN:default:return e.isGeospatial?[d+o[0],a+o[1],v+o[2]]:e.projectPosition([d,a,v])}}function I8(n,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:o,modelMatrix:c,fromCoordinateSystem:d,fromCoordinateOrigin:a}=C8(e),{autoOffset:v=!0}=e,{geospatialOrigin:A=Y2,shaderCoordinateOrigin:P=Y2,offsetMode:k=!1}=v?OC(t,r,o):{},L=ZC(n,{viewport:t,modelMatrix:c,coordinateSystem:d,coordinateOrigin:a,offsetMode:k});if(k){const z=t.projectPosition(A||P);A6(L,L,z)}return L}let M8=1,R8=1;class XC{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:o=1,repeat:c=1}=e,d=M8++,a={time:0,delay:t,duration:r,rate:o,repeat:c};return this._setChannelTime(a,this.time),this.channels.set(d,a),d}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const o of t)this._setChannelTime(o,this.time);const r=this.animations.values();for(const o of r){const{animation:c,channel:d}=o;c.setTime(this.getTime(d))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=R8++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,o=e.duration*e.repeat;r>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function k8(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function D8(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let O8=0;const L8={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:q0.stats.get(`animation-loop-${O8++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class F8{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...L8,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Ay({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const r=document.createElement("h1");r.innerHTML=e.message,r.style.position="absolute",r.style.top="20%",r.style.left="10px",r.style.color="black",r.style.backgroundColor="red",document.body.appendChild(r)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=k8(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(D8(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1];let r=1;const o=this.device?.canvasContext?.canvas;return o&&o.clientHeight?r=o.clientWidth/o.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const i0={};function Dy(n="id"){i0[n]=i0[n]||1;const e=i0[n]++;return`${n}-${e}`}class K2{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Dy("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ar.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function N8(n,e){if(e instanceof K2)return e;const t=B8(n,e),{attributes:r,bufferLayout:o}=z8(n,e);return new K2({topology:e.topology||"triangle-list",bufferLayout:o,vertexCount:e.vertexCount,indices:t,attributes:r})}function B8(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:Ar.INDEX,data:t})}function z8(n,e){const t=[],r={};for(const[c,d]of Object.entries(e.attributes)){let a=c;switch(c){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(d){r[a]=n.createBuffer({data:d.value,id:`${c}-buffer`});const{value:v,size:A,normalized:P}=d;t.push({name:a,format:vz(v,A,P)})}}const o=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:t,vertexCount:o}}class Fb{static defaultProps={..._p.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Fb(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const t={..._p.defaultProps,...e},r=this._hashRenderPipeline(t);if(!this._renderPipelineCache[r]){const o=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});o.hash=r,this._renderPipelineCache[r]={pipeline:o,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const t={...K_.defaultProps,...e},r=this._hashComputePipeline(t);if(!this._computePipelineCache[r]){const o=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});o.hash=r,this._computePipelineCache[r]={pipeline:o,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const t=e.hash,r=e instanceof K_?this._computePipelineCache:this._renderPipelineCache;r[t].useCount--,r[t].useCount===0&&this.destroyPolicy==="unused"&&(r[t].pipeline.destroy(),delete r[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,o="-",c=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${r}V${o}BL${c}`;default:const d=this._getHash(JSON.stringify(e.parameters));return`${t}/${r}V${o}T${e.topology}P${d}BL${c}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class Nb{static defaultProps={...Iy.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Nb(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const t=this._hashShader(e);let r=this._cache[t];if(!r){const o=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:o,useCount:0}}return r.useCount++,r.shader}release(e){const t=this._hashShader(e),r=this._cache[t];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function U8(n,e){const t={},r="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[r]:"N/A"}};for(const o of n.attributes)if(o){const c=`${o.location} ${o.name}: ${o.type}`;t[`in ${c}`]={[r]:o.stepMode||"vertex"}}for(const o of n.varyings||[]){const c=`${o.location} ${o.name}`;t[`out ${c}`]={[r]:JSON.stringify(o)}}return t}let as=null,s0=null;function V8(n,{id:e,minimap:t,opaque:r,top:o="0",left:c="0",rgbaScale:d=1}){as||(as=document.createElement("canvas"),as.id=e,as.title=e,as.style.zIndex="100",as.style.position="absolute",as.style.top=o,as.style.left=c,as.style.border="blue 5px solid",as.style.transform="scaleY(-1)",document.body.appendChild(as),s0=as.getContext("2d")),(as.width!==n.width||as.height!==n.height)&&(as.width=n.width/2,as.height=n.height/2,as.style.width="400px",as.style.height="400px");const a=n.device.readPixelsToArrayWebGL(n),v=s0?.createImageData(n.width,n.height);if(v){for(let P=0;P<a.length;P+=4)v.data[0+P+0]=a[P+0]*d,v.data[0+P+1]=a[P+1]*d,v.data[0+P+2]=a[P+2]*d,v.data[0+P+3]=r?255:a[P+3]*d;s0?.putImageData(v,0,0)}}function cx(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!cx(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),o=Object.keys(e);if(r.length!==o.length)return!1;for(const c of r)if(!e.hasOwnProperty(c)||!cx(n[c],e[c],t-1))return!1;return!0}return!1}function j8(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function $8(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function qC(n){return j8(n)||$8(n)}function W8(n){return qC(n)||typeof n=="number"||typeof n=="boolean"}function GC(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];W8(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}class H8{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const r=pb(Object.values(e).filter(o=>o.dependencies));for(const o of r)e[o.name]=o;Lt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[o,c]of Object.entries(e))this._addModule(c),c.name&&o!==c.name&&!this.options.disableWarnings&&Lt.warn(`Module name: ${o} vs ${c.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const r=t,o=e[r]||{},c=this.modules[r];if(!c){this.options.disableWarnings||Lt.warn(`Module ${t} not found`)();continue}const d=this.moduleUniforms[r],a=this.moduleBindings[r],v=c.getUniforms?.(o,d)||o,{uniforms:A,bindings:P}=GC(v);this.moduleUniforms[r]={...d,...A},this.moduleBindings[r]={...a,...P}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,r]of Object.entries(this.moduleUniforms))for(const[o,c]of Object.entries(r))e[`${t}.${o}`]={type:this.modules[t].uniformTypes?.[o],value:String(c)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let Z8="";async function X8(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:Z8+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class o0{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e,this.id=t.id||Dy("async-texture"),typeof t?.data=="string"&&t.dimension==="2d"&&(t={...t,data:X8(t.data)}),this.ready=new Promise((r,o)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=o}),this.initAsync(t)}async initAsync(e){const t=e.data;let r;try{r=await YC(t)}catch(c){this.rejectReady(c)}if(this.destroyed)return;const o={...e,data:r};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function YC(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(YC));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),r=Object.keys(e),o={};for(let c=0;c<r.length;c++)o[r[c]]=t[c];return o}return n}const Ad=2,q8=1e4;class Oa{static defaultProps={..._p.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Rd.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...Oa.defaultProps,...t},t=this.props,this.id=t.id||Dy("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(this.props.modules?.map(v=>[v.name,v])||[]),o=t.shaderInputs||new H8(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(o);const c=Y8(e),d=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:v,getUniforms:A}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:c,...this.props,modules:d});this.source=v,this._getModuleUniforms=A,this.props.shaderLayout||=Yz(this.source)}else{const{vs:v,fs:A,getUniforms:P}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:c,...this.props,modules:d});this.vs=v,this.fs=A,this._getModuleUniforms=P}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Fb.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Nb.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return Lt.info(Ad,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const o=this._getBindings();this.pipeline.setBindings(o,{disableWarnings:this.props.disableWarnings}),ux(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:c}=this.vertexArray,d=c?c.byteLength/(c.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:d,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&N8(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const r=new Hv(this.bufferLayout);this.bufferLayout=r.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Hv(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){cx(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new yz(this.shaderInputs.modules);for(const[t,r]of Object.entries(this.shaderInputs.modules))if(G8(r)){const o=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=o}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const r=t?.disableWarnings??this.props.disableWarnings;e.indices&&Lt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=xz(this.pipeline.shaderLayout,this.bufferLayout);const o=new Hv(this.bufferLayout);for(const[c,d]of Object.entries(e)){const a=o.getBufferLayout(c);if(!a){r||Lt.warn(`Model(${this.id}): Missing layout for buffer "${c}".`)();continue}const v=o.getAttributeNamesForBuffer(a);let A=!1;for(const P of v){const k=this._attributeInfos[P];if(k){const L=this.device.type==="webgpu"?o.getBufferIndex(k.bufferName):k.location;this.vertexArray.setBuffer(L,d),A=!0}}!A&&!r&&Lt.warn(`Model(${this.id}): Ignoring buffer "${d.id}" for unknown attribute "${c}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[r,o]of Object.entries(e)){const c=this._attributeInfos[r];c?this.vertexArray.setConstantWebGL(c.location,o):(t?.disableWarnings??this.props.disableWarnings)||Lt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){ux(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:r}=GC(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof o0&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,r]of Object.entries(this.bindings))r instanceof o0?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Cy?e=Math.max(e,t.texture.updateTimestamp):t instanceof Ar||t instanceof br?e=Math.max(e,t.updateTimestamp):t instanceof o0?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof ng||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[r]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(o=>o.name===r)&&r!=="positions"&&delete t[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Lt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let o=null;this.source?o=r:this.fs&&(o=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:o}),this._attributeInfos=WE(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=Lt.level>3?0:q8;Lt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Lt.group(Ad,`>>> DRAWING MODEL ${this.id}`,{collapsed:Lt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=U8(this.pipeline.shaderLayout,this.id);Lt.table(Ad,e)();const t=this.shaderInputs.getDebugTable();for(const[o,c]of Object.entries(this.uniforms))t[o]={value:c};Lt.table(Ad,t)();const r=this._getAttributeDebugTable();Lt.table(Ad,this._attributeInfos)(),Lt.table(Ad,r)(),Lt.groupEnd(Ad)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const r=e.props.framebuffer;r&&V8(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,r]of Object.entries(this._attributeInfos)){const o=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:o?this._getBufferOrConstantValues(o,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,r=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){const r=XE(t);return(e instanceof Ar?new r(e.debugData):e).toString()}}function G8(n){return!!(n.uniformTypes&&!ux(n.uniformTypes))}function Y8(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function ux(n){for(const e in n)return!1;return!0}class Ap{device;model;transformFeedback;static defaultProps={...Oa.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=Ap.defaultProps){if(!Ap.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Oa(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||FE(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Ar)return t.readAsync();const{buffer:r,byteOffset:o=0,byteLength:c=r.byteLength}=t;return r.readAsync(o,c)}}const K8="transform_output";class J2{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,t){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Oa(this.device,{id:t.id||"texture-transform-model",fs:t.fs||FE({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:K8}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){this.model.destroy();for(const e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],r=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(r),r.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:r,targetTexture:o}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,t),o){e.targetTexture=o;const{width:c,height:d}=o;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:c,height:d,colorAttachments:[o]}),e.framebuffer.resize({width:c,height:d})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const r in t)t[r].sampler=this.sampler}}class ag{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:r=null,vertexCount:o=null}=e;this.id=e.id||Dy("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[c,d]of Object.entries(t)){const a=ArrayBuffer.isView(d)?{value:d}:d;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(c)}: must be typed array or object with value as typed array`);if((c==="POSITION"||c==="positions")&&!a.size&&(a.size=3),c==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[c]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const o of Object.values(e)){const{value:c,size:d,constant:a}=o;!a&&c&&d!==void 0&&d>=1&&(r=Math.min(r,c.length/d))}return r}}const J8={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class KC extends Lb{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:o,onViewportActive:c,pickingFBO:d,deviceRect:{x:a,y:v,width:A,height:P},cullRect:k,effects:L,pass:z="picking",pickZ:G,shaderModuleProps:te}){this.pickZ=G;const re=this._resetColorEncoder(G),fe=[a,v,A,P],ve=super.render({target:d,layers:e,layerFilter:t,views:r,viewports:o,onViewportActive:c,cullRect:k,effects:L?.filter(Se=>Se.useInPicking),pass:z,isPicking:!0,shaderModuleProps:te,clearColor:[0,0,0,0],colorMask:15,scissorRect:fe});return this._colorEncoderState=null,{decodePickingColor:re&&eV.bind(null,re),stats:ve}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){const o={...e.props.parameters},{pickable:c,operation:d}=e.props;return!this._colorEncoderState||d.includes("terrain")?o.blend=!1:c&&d.includes("draw")&&(Object.assign(o,J8),o.blend=!0,o.blendColor=Q8(this._colorEncoderState,e,r)),o}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Q8(n,e,t){const{byLayer:r,byAlpha:o}=n;let c,d=r.get(e);return d?(d.viewports.push(t),c=d.a):(c=r.size+1,c<=255?(d={a:c,layer:e,viewports:[t]},r.set(e,d),o[c]=d):(_r.warn("Too many pickable layers, only picking the first 255")(),c=0)),[0,0,0,c/255]}function eV(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Jf={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},ly=Symbol.for("component"),Ph=Symbol.for("propTypes"),a0=Symbol.for("deprecatedProps"),fp=Symbol.for("asyncPropDefaults"),Wd=Symbol.for("asyncPropOriginal"),wh=Symbol.for("asyncPropResolved");function Bb(n,e=()=>!0){return Array.isArray(n)?JC(n,e,[]):e(n)?[n]:[]}function JC(n,e,t){let r=-1;for(;++r<n.length;){const o=n[r];Array.isArray(o)?JC(o,e,t):e(o)&&t.push(o)}return t}function tV({target:n,source:e,start:t=0,count:r=1}){const o=e.length,c=r*o;let d=0;for(let a=t;d<o;d++)n[a++]=e[d];for(;d<c;)d<c-d?(n.copyWithin(t+d,t,t+d),d*=2):(n.copyWithin(t+d,t,t+c-d),d=c);return n}class nV{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let o=e;typeof e=="string"&&(o=q_(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(c=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=c)}).catch(c=>{this._loadCount===r&&(this.isLoaded=!0,this._error=c||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const c of this._subscribers)c.onChange(this.getData())}}class rV{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:o=!0}){let c=this._resources[e];c?c.setData(t,r):(c=new nV(e,t,this._context),this._resources[e]=c),c.persistent=o}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const o=t[r],c=this._resources[o.resourceId];c&&c.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:o="default"}){const{_resources:c,protocol:d}=this;e.startsWith(d)&&(e=e.replace(d,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=c[e];if(this._track(r,o,a,t),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,o){const c=this._consumers,d=c[e]=c[e]||{};let a=d[t];const v=a&&a.resourceId&&this._resources[a.resourceId];v&&(v.unsubscribe(a),this.prune()),r&&(a?(a.onChange=o,a.resourceId=r.id):a={onChange:o,resourceId:r.id},d[t]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const iV="layerManager.setLayers",sV="layerManager.activateViewport";class oV{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Bs(sV,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:o,viewport:c,timeline:d}=t||{};this.layers=[],this.resourceManager=new rV({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:r,shaderAssembler:s8(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[d5],renderPass:void 0,stats:o||new Ay({id:"deck.gl"}),viewport:c||new vg({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:d||new XC,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const o=r.getNeedsRedraw(e);t=t||o}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Bs(iV,this,t,e),this._lastRenderedLayers=e;const r=Bb(e,Boolean);for(const o of r)o.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(r=>r.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,r=t.findIndex(o=>o.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){const r={};for(const d of e)r[d.id]?_r.warn(`Multiple old layers with same id ${d.id}`)():r[d.id]=d;if(this._defaultShaderModulesChanged){for(const d of e)d.setNeedsUpdate(),d.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const o=[];this._updateSublayersRecursively(t,r,o),this._finalizeOldLayers(r);let c=!1;for(const d of o)if(d.hasUniformTransition()){c=`Uniform transition in ${d}`;break}this._needsUpdate=c,this.layers=o}_updateSublayersRecursively(e,t,r){for(const o of e){o.context=this.context;const c=t[o.id];c===null&&_r.warn(`Multiple new layers with same id ${o.id}`)(),t[o.id]=null;let d=null;try{this._debug&&c!==o&&o.validateProps(),c?(this._transferLayerState(c,o),this._updateLayer(o)):this._initializeLayer(o),r.push(o),d=o.isComposite?o.getSubLayers():null}catch(a){this._handleError("matching",a,o)}d&&this._updateSublayersRecursively(d,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Jf.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Jf.MATCHED,t!==e&&(e.lifecycle=Jf.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Jf.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Jf.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Pl(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Pl(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),o=Object.keys(e);if(r.length!==o.length)return!1;for(const c of r)if(!e.hasOwnProperty(c)||!Pl(n[c],e[c],t-1))return!1;return!0}return!1}class aV{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),o={x:e[0],y:e[1]};for(let c=r.length-1;c>=0;--c){const d=r[c];if(d.containsPixel(o)){const a=e.slice();return a[0]-=d.x,a[1]-=d.y,d.unproject(a,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Bb(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Pl(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):_r.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:c=>this.getView(e.id)?.makeViewport({viewState:c,width:this.width,height:this.height})})}_updateController(e,t,r,o){const c=e.controller;if(c&&r){const d={...t,...c,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!o||o.constructor!==c.type)&&(o=this._createController(e,d)),o&&o.setProps(d),o}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let o=e.length;o--;){const c=e[o],d=this.getViewState(c),a=c.makeViewport({viewState:d,width:this.width,height:this.height});let v=t[c.id];const A=!!c.controller;A&&!v&&(r=!0),(r||!A)&&v&&(v.finalize(),v=null),this.controllers[c.id]=this._updateController(c,d,a,v),a&&this._viewports.unshift(a)}for(const o in t){const c=t[o];c&&!this.controllers[o]&&c.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,o)=>!e[o].equals(t[o]))}}const lV=/([0-9]+\.?[0-9]*)(%|px)/;function fh(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=lV.exec(n);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function ph(n,e){return n.relative?Math.round(n.position*e):n.position}class Pp{constructor(e){const{id:t,x:r=0,y:o=0,width:c="100%",height:d="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=fh(r),this._y=fh(o),this._width=fh(c),this._height=fh(d),this._padding=a&&{left:fh(a.left||0),right:fh(a.right||0),top:fh(a.top||0),bottom:fh(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Pl(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);const o=this.getDimensions({width:e,height:t});if(!o.height||!o.width)return null;const c=this.getViewportType(r);return new c({...r,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:ph(this._x,e),y:ph(this._y,t),width:ph(this._width,e),height:ph(this._height,t)};return this._padding&&(r.padding={left:ph(this._padding.left,e),top:ph(this._padding.top,t),right:ph(this._padding.right,e),bottom:ph(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Oy{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Q2=()=>{},hx={BREAK:1,SNAP_TO_END:2,IGNORE:3},cV=n=>n,uV=hx.BREAK;class hV{constructor(e){this._onTransitionUpdate=t=>{const{time:r,settings:{interpolator:o,startProps:c,endProps:d,duration:a,easing:v}}=t,A=v(r/a),P=o.interpolateProps(c,d,A);this.propsInTransition=this.getControllerState({...this.props,...P}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Oy(e.timeline),this.onViewStateChange=e.onViewStateChange||Q2,this.onStateChange=e.onStateChange||Q2}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let o=r;if(this.transition.inProgress){const{interruption:c,endProps:d}=this.transition.settings;o={...r,...c===hx.SNAP_TO_END?d:this.propsInTransition||r}}this._triggerTransition(o,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===hx.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),o=this.getControllerState(t).shortestPathFrom(r),c=t.transitionInterpolator,d=c.getDuration?c.getDuration(e,t):t.transitionDuration;if(d===0)return;const a=c.initializeProps(e,o);this.propsInTransition={};const v={duration:d,easing:t.transitionEasing||cV,interpolator:c,interruption:t.transitionInterruption||uV,startProps:a.start,endProps:a.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(v),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function xs(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class QC{constructor(e){const{compare:t,extract:r,required:o}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=o}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!sg(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},o={};for(const c of this._propsToExtract)(c in e||c in t)&&(r[c]=e[c],o[c]=t[c]);return this._checkRequiredProps(r),this._checkRequiredProps(o),{start:r,end:o}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];xs(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}const dV=["longitude","latitude","zoom","bearing","pitch"],fV=["longitude","latitude","zoom"];class e3 extends QC{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:dV,required:fV},super(r.transitionProps),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:o,around:c}=this.opts;if(o&&c){const d=o(e),a=o(t),v=d.unproject(c);r.start.around=c,Object.assign(r.end,{around:a.project(v),aroundPosition:v,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const o={};for(const c of this._propsToExtract)o[c]=ig(e[c]||0,t[c]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const c=this.opts.makeViewport({...t,...o});Object.assign(o,c.panByPosition(t.aroundPosition,ig(e.around,t.around,r)))}return o}}const wu={transitionDuration:0},pV=300,p_=n=>1-(1-n)*(1-n),Kf={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Pd={};class mV{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new hV({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:o}=e;return[o.x-t,o.y-r]}isPointInBounds(e,t){const{width:r,height:o}=this.props;if(t&&t.handled)return!1;const c=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=o;return c&&t&&t.stopPropagation(),c}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?pV:0;const{scrollZoom:r=!0,dragPan:o=!0,dragRotate:c=!0,doubleClickZoom:d=!0,touchZoom:a=!0,touchRotate:v=!1,keyboard:A=!0}=e,P=!!this.onViewStateChange;this.toggleEvents(Kf.WHEEL,P&&r),this.toggleEvents(Kf.PAN,P),this.toggleEvents(Kf.PINCH,P&&(a||v)),this.toggleEvents(Kf.MULTI_PAN,P&&v),this.toggleEvents(Kf.DOUBLE_CLICK,P&&d),this.toggleEvents(Kf.KEYBOARD,P&&A),this.scrollZoom=r,this.dragPan=o,this.dragRotate=c,this.doubleClickZoom=d,this.touchZoom=a,this.touchRotate=v,this.keyboard=A}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const o={...e.getViewportProps(),...t},c=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),c){const d=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:d,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const o=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(o,wu,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,wu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),o=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],c=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:p_},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,wu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),o=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],c=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:p_},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:c}=e;let d=2/(1+Math.exp(-Math.abs(c*r)));c<0&&d!==0&&(d=1/d);const a=o?{...this._getTransitionProps({around:t}),transitionDuration:250}:wu,v=this.controllerState.zoom({pos:t,scale:d});return this.updateViewport(v,a,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,wu,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,wu,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),o=[r[0],r[1]+=e.velocityY*t/2],c=this.controllerState.rotate({pos:o});this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:p_},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Pd._startPinchRotation=e.rotation,Pd._lastPinchEvent=e,this.updateViewport(r,wu,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,o=this.getCenter(e);t=t.zoom({pos:o,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:Pd._startPinchRotation-r})}return this.updateViewport(t,wu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Pd._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=Pd;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const o=this.getCenter(e);let c=this.controllerState.rotateEnd();const d=Math.log2(e.scale),a=(d-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),v=Math.pow(2,d+a*t/2);c=c.zoom({pos:o,scale:v}).zoomEnd(),this.updateViewport(c,{...this._getTransitionProps({around:o}),transitionDuration:t,transitionEasing:p_},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Pd._startPinchRotation=null,Pd._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(o,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:o,rotateSpeedX:c,rotateSpeedY:d}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let v;const A={};switch(e.srcEvent.code){case"Minus":v=t?a.zoomOut(r).zoomOut(r):a.zoomOut(r),A.isZooming=!0;break;case"Equal":v=t?a.zoomIn(r).zoomIn(r):a.zoomIn(r),A.isZooming=!0;break;case"ArrowLeft":t?(v=a.rotateLeft(c),A.isRotating=!0):(v=a.moveLeft(o),A.isPanning=!0);break;case"ArrowRight":t?(v=a.rotateRight(c),A.isRotating=!0):(v=a.moveRight(o),A.isPanning=!0);break;case"ArrowUp":t?(v=a.rotateUp(d),A.isRotating=!0):(v=a.moveUp(o),A.isPanning=!0);break;case"ArrowDown":t?(v=a.rotateDown(d),A.isRotating=!0):(v=a.moveDown(o),A.isPanning=!0);break;default:return!1}return this.updateViewport(v,this._getTransitionProps(),A),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?wu:e?{...t,transitionInterpolator:new e3({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class gV{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const eS=5,_V=1.2;class yV extends gV{constructor(e){const{width:t,height:r,latitude:o,longitude:c,zoom:d,bearing:a=0,pitch:v=0,altitude:A=1.5,position:P=[0,0,0],maxZoom:k=20,minZoom:L=0,maxPitch:z=60,minPitch:G=0,startPanLngLat:te,startZoomLngLat:re,startRotatePos:fe,startBearing:ve,startPitch:le,startZoom:Se,normalize:Ne=!0}=e;xs(Number.isFinite(c)),xs(Number.isFinite(o)),xs(Number.isFinite(d)),super({width:t,height:r,latitude:o,longitude:c,zoom:d,bearing:a,pitch:v,altitude:A,maxZoom:k,minZoom:L,maxPitch:z,minPitch:G,normalize:Ne,position:P},{startPanLngLat:te,startZoomLngLat:re,startRotatePos:fe,startBearing:ve,startPitch:le,startZoom:Se}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const c=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(c)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:o,startBearing:c,startPitch:d}=this.getState();if(!o||c===void 0||d===void 0)return this;let a;return e?a=this._getNewRotation(e,o,d,c):a={bearing:c+t,pitch:d+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:o,startZoomLngLat:c}=this.getState();if(c||(o=this.getViewportProps().zoom,c=this._unproject(t)||this._unproject(e)),!c)return this;const{maxZoom:d,minZoom:a}=this.getViewportProps();let v=o+Math.log2(r);v=bh(v,a,d);const A=this.makeViewport({...this.getViewportProps(),zoom:v});return this._getUpdatedState({zoom:v,...A.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:o,longitude:c}=r;return Math.abs(o-t.bearing)>180&&(r.bearing=o<0?o+360:o-360),Math.abs(c-t.longitude)>180&&(r.longitude=c<0?c+360:c-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:o}=e;e.zoom=bh(o,r,t);const{maxPitch:c,minPitch:d,pitch:a}=e;e.pitch=bh(a,d,c);const{normalize:v=!0}=e;return v&&Object.assign(e,UU(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,o){const c=e[0]-t[0],d=e[1]-t[1],a=e[1],v=t[1],{width:A,height:P}=this.getViewportProps(),k=c/A;let L=0;d>0?Math.abs(P-v)>eS&&(L=d/(v-P)*_V):d<0&&v>eS&&(L=1-a/v),L=bh(L,-1,1);const{minPitch:z,maxPitch:G}=this.getViewportProps(),te=o+180*k;let re=r;return L>0?re=r+L*(G-r):L<0&&(re=r-L*(z-r)),{pitch:re,bearing:te}}}class vV extends mV{constructor(){super(...arguments),this.ControllerState=yV,this.transition={transitionDuration:300,transitionInterpolator:new e3({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class t3 extends Pp{constructor(e={}){super(e)}getViewportType(){return Sp}get ControllerType(){return vV}}t3.displayName="MapView";const xV=new HC;function bV(n,e){const t=n.order??1/0,r=e.order??1/0;return t-r}class wV{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(o=>bV(o,e)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Pl(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const o of this.effects)t[o.id]=o;const r=[];for(const o of e){const c=t[o.id];let d=o;c&&c!==o?c.setProps?(c.setProps(o.props),d=c):c.cleanup(this._context):c||o.setup(this._context),r.push(d),delete t[o.id]}for(const o in t)t[o].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(o=>o instanceof HC)||this._resolvedEffects.push(xV),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class TV extends Lb{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const SV="deckRenderer.renderLayers";class AV{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new TV(e),this.pickLayersPass=new KC(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const o=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const c=t.render({...r,target:o});r.effects&&this._postRender(r.effects,r),this.renderCount++,Bs(SV,this,c,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const o=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[o]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:r}=this,o={...t,inputBuffer:r[0],swapBuffer:r[1]};for(const c of e)if(c.postRender){o.target=c.id===this.lastPostProcessEffect?t.target:void 0;const d=c.postRender(o);o.inputBuffer=d,o.swapBuffer=d===r[0]?r[1]:r[0]}}}const PV={pickedColor:null,pickedObjectIndex:-1};function EV({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:o,deviceRect:c}){const{x:d,y:a,width:v,height:A}=c;let P=o*o,k=-1,L=0;for(let z=0;z<A;z++){const G=z+a-r,te=G*G;if(te>P)L+=4*v;else for(let re=0;re<v;re++){if(n[L+3]-1>=0){const ve=re+d-t,le=ve*ve+te;le<=P&&(P=le,k=L)}L+=4}}if(k>=0){const z=n.slice(k,k+4),G=e(z);if(G){const te=Math.floor(k/4/v),re=k/4-te*v;return{...G,pickedColor:z,pickedX:d+re,pickedY:a+te}}_r.error("Picked non-existent layer. Is picking buffer corrupt?")()}return PV}function CV({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let r=0;r<n.length;r+=4)if(n[r+3]-1>=0){const c=n.slice(r,r+4),d=c.join(",");if(!t.has(d)){const a=e(c);a?t.set(d,{...a,color:c}):_r.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function n3({pickInfo:n,viewports:e,pixelRatio:t,x:r,y:o,z:c}){let d=e[0];e.length>1&&(d=MV(n?.pickedViewports||e,{x:r,y:o}));let a;if(d){const v=[r-d.x,o-d.y];c!==void 0&&(v[2]=c),a=d.unproject(v)}return{color:null,layer:null,viewport:d,index:-1,picked:!1,x:r,y:o,pixel:[r,o],coordinate:a,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function IV(n){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:o}=n,{pickedColor:c,pickedLayer:d,pickedObjectIndex:a}=e,v=d?[d]:[];if(r==="hover"){const k=t.index,L=t.layerId,z=d?d.props.id:null;if(z!==L||a!==k){if(z!==L){const G=o.find(te=>te.props.id===L);G&&v.unshift(G)}t.layerId=z,t.index=a,t.info=null}}const A=n3(n),P=new Map;return P.set(null,A),v.forEach(k=>{let L={...A};k===d&&(L.color=c,L.index=a,L.picked=!0),L=r3({layer:k,info:L,mode:r});const z=L.layer;k===d&&r==="hover"&&(t.info=L),P.set(z.id,L),r==="hover"&&z.updateAutoHighlight(L)}),P}function r3({layer:n,info:e,mode:t}){for(;n&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:r}),n=n.parent}return e}function MV(n,e){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r.containsPixel(e))return r}return n[0]}class RV{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new KC(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:o},c=this.lastPickedInfo.info){const d=c&&c.layer&&c.layer.id,a=c&&c.viewport&&c.viewport.id,v=d?r.find(L=>L.id===d):null,A=a&&o.find(L=>L.id===a)||o[0],P=A&&A.unproject([e-A.x,t-A.y]);return{...c,...{x:e,y:t,viewport:A,coordinate:P,layer:v}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:o,y:c,radius:d=0,depth:a=1,mode:v="query",unproject3D:A,onViewportActive:P,effects:k}){const L=this.device.canvasContext.cssToDeviceRatio(),z=this._getPickable(e);if(!z||r.length===0)return{result:[],emptyInfo:n3({viewports:r,x:o,y:c,pixelRatio:L})};this._resizeBuffer();const G=this.device.canvasContext.cssToDevicePixels([o,c],!0),te=[G.x+Math.floor(G.width/2),G.y+Math.floor(G.height/2)],re=Math.round(d*L),{width:fe,height:ve}=this.pickingFBO,le=this._getPickingRect({deviceX:te[0],deviceY:te[1],deviceRadius:re,deviceWidth:fe,deviceHeight:ve}),Se={x:o-d,y:c-d,width:d*2+1,height:d*2+1};let Ne;const nt=[],pt=new Set;for(let mt=0;mt<a;mt++){let Tt;if(le){const Zt=this._drawAndSample({layers:z,views:t,viewports:r,onViewportActive:P,deviceRect:le,cullRect:Se,effects:k,pass:`picking:${v}`});Tt=EV({...Zt,deviceX:te[0],deviceY:te[1],deviceRadius:re,deviceRect:le})}else Tt={pickedColor:null,pickedObjectIndex:-1};let Mt;if(Tt.pickedLayer&&A&&this.depthFBO){const{pickedColors:Zt}=this._drawAndSample({layers:[Tt.pickedLayer],views:t,viewports:r,onViewportActive:P,deviceRect:{x:Tt.pickedX,y:Tt.pickedY,width:1,height:1},cullRect:Se,effects:k,pass:`picking:${v}:z`},!0);Zt[3]&&(Mt=Zt[0])}Tt.pickedLayer&&mt+1<a&&(pt.add(Tt.pickedLayer),Tt.pickedLayer.disablePickingIndex(Tt.pickedObjectIndex)),Ne=IV({pickInfo:Tt,lastPickedInfo:this.lastPickedInfo,mode:v,layers:z,viewports:r,x:o,y:c,z:Mt,pixelRatio:L});for(const Zt of Ne.values())Zt.layer&&nt.push(Zt);if(!Tt.pickedColor)break}for(const mt of pt)mt.restorePickingColors();return{result:nt,emptyInfo:Ne.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:o,y:c,width:d=1,height:a=1,mode:v="query",maxObjects:A=null,onViewportActive:P,effects:k}){const L=this._getPickable(e);if(!L||r.length===0)return[];this._resizeBuffer();const z=this.device.canvasContext.cssToDeviceRatio(),G=this.device.canvasContext.cssToDevicePixels([o,c],!0),te=G.x,re=G.y+G.height,fe=this.device.canvasContext.cssToDevicePixels([o+d,c+a],!0),ve=fe.x+fe.width,le=fe.y,Se={x:te,y:le,width:ve-te,height:re-le},Ne=this._drawAndSample({layers:L,views:t,viewports:r,onViewportActive:P,deviceRect:Se,cullRect:{x:o,y:c,width:d,height:a},effects:k,pass:`picking:${v}`}),nt=CV(Ne),pt=new Map,mt=[],Tt=Number.isFinite(A);for(let Mt=0;Mt<nt.length&&!(Tt&&mt.length>=A);Mt++){const Zt=nt[Mt];let hn={color:Zt.pickedColor,layer:null,index:Zt.pickedObjectIndex,picked:!0,x:o,y:c,pixelRatio:z};hn=r3({layer:Zt.pickedLayer,info:hn,mode:v});const on=hn.layer.id;pt.has(on)||pt.set(on,new Set);const nn=pt.get(on),Rn=hn.object??hn.index;nn.has(Rn)||(nn.add(Rn),mt.push(hn))}return mt}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:o,deviceRect:c,cullRect:d,effects:a,pass:v},A=!1){const P=A?this.depthFBO:this.pickingFBO,k={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:o,pickingFBO:P,deviceRect:c,cullRect:d,effects:a,pass:v,pickZ:A,preRenderStats:{},isPicking:!0};for(const ve of a)ve.useInPicking&&(k.preRenderStats[ve.id]=ve.preRender(k));const{decodePickingColor:L}=this.pickLayersPass.render(k),{x:z,y:G,width:te,height:re}=c,fe=new(A?Float32Array:Uint8Array)(te*re*4);return this.device.readPixelsToArrayWebGL(P,{sourceX:z,sourceY:G,sourceWidth:te,sourceHeight:re,target:fe}),{pickedColors:fe,decodePickingColor:L}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:o,deviceHeight:c}){const d=Math.max(0,e-r),a=Math.max(0,t-r),v=Math.min(o,e+r+1)-d,A=Math.min(c,t+r+1)-a;return v<=0||A<=0?null:{x:d,y:a,width:v,height:A}}}const kV={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},DV="top-left",tS="__root";class OV{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Pl(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const r of this.resolvedWidgets)t[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)t[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const o=t[r.id];o?o.viewId!==r.viewId||o.placement!==r.placement?(this._remove(o),this._add(r)):r!==o&&(o.setProps(r.props),r=o):this._add(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(const r in t){const o=t[r];o&&this._remove(o)}this.widgets=e}_add(e){const{viewId:t=null,placement:r=DV}=e,o=e.onAdd({deck:this.deck,viewId:t});o&&this._getContainer(t,r).append(o),e._element=o}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const r=e||tS;let o=this.containers[r];o||(o=document.createElement("div"),o.style.pointerEvents="none",o.style.position="absolute",o.style.overflow="hidden",this.parentElement?.append(o),this.containers[r]=o);let c=o.querySelector(`.${t}`);return c||(c=document.createElement("div"),c.className=t,c.style.position="absolute",c.style.zIndex="2",Object.assign(c.style,kV[t]),o.append(c)),c}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const r in this.containers){const o=this.lastViewports[r]||null,c=r===tS||o,d=this.containers[r];c?(d.style.display="block",d.style.left=`${o?o.x:0}px`,d.style.top=`${o?o.y:0}px`,d.style.width=`${o?o.width:e}px`,d.style.height=`${o?o.height:t}px`):d.style.display="none"}}onRedraw({viewports:e,layers:t}){const r=e.reduce((o,c)=>(o[c.id]=c,o),{});for(const o of this.getWidgets()){const{viewId:c}=o;if(c){const d=r[c];d&&(o.onViewportChange&&o.onViewportChange(d),o.onRedraw?.({viewports:[d],layers:t}))}else{if(o.onViewportChange)for(const d of e)o.onViewportChange(d);o.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){for(const r of this.getWidgets()){const{viewId:o}=r;(!o||o===e.viewport?.id)&&r.onHover?.(e,t)}}onEvent(e,t){const r=sx[t.type];if(r)for(const o of this.getWidgets()){const{viewId:c}=o;(!c||c===e.viewport?.id)&&o[r]?.(e,t)}}}const LV={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class FV{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,LV),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;const o=r(e);this.lastViewport=e.viewport,this.setTooltip(o,e.x,e.y)}setTooltip(e,t,r){const o=this.element;if(o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform=`translate(${t}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(o.style,e.style)}}}var op;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(op||(op={}));const zb={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ci=(n,e,t)=>e?n.enable(t):n.disable(t),nS=(n,e,t)=>n.hint(t,e),Yo=(n,e,t)=>n.pixelStorei(t,e),rS=(n,e,t)=>{const r=t===36006?36009:36008;return n.bindFramebuffer(r,e)},Em=(n,e,t)=>{const o={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(o,e)};function l0(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const NV={3042:Ci,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:Ci,2885:(n,e)=>n.cullFace(e),2929:Ci,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:Ci,35723:nS,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>n.bindTransformFeedback?.(36386,e),34229:(n,e)=>n.bindVertexArray(e),36006:rS,36010:rS,34964:Em,36662:Em,36663:Em,35053:Em,35055:Em,2886:(n,e)=>n.frontFace(e),33170:nS,2849:(n,e)=>n.lineWidth(e),32823:Ci,32824:"polygonOffset",10752:"polygonOffset",35977:Ci,32926:Ci,32928:Ci,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ci,3088:(n,e)=>n.scissor(...e),2960:Ci,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:Ci,10754:Ci,12288:Ci,12289:Ci,12290:Ci,12291:Ci,12292:Ci,12293:Ci,12294:Ci,12295:Ci,3333:Yo,3317:Yo,37440:Yo,37441:Yo,37443:Yo,3330:Yo,3332:Yo,3331:Yo,3314:Yo,32878:Yo,3316:Yo,3315:Yo,32877:Yo,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=e?.length===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=l0(e)?e:[e,e];const[t,r]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,r)},stencilFunc:(n,e)=>{e=l0(e)&&e.length===3?[...e,...e]:e;const[t,r,o,c,d,a]=e;n.stencilFuncSeparate(1028,t,r,o),n.stencilFuncSeparate(1029,c,d,a)},stencilOp:(n,e)=>{e=l0(e)&&e.length===3?[...e,...e]:e;const[t,r,o,c,d,a]=e;n.stencilOpSeparate(1028,t,r,o),n.stencilOpSeparate(1029,c,d,a)},viewport:(n,e)=>n.viewport(...e)};function ii(n,e,t){return e[n]!==void 0?e[n]:t[n]}const BV={blendEquation:(n,e,t)=>n.blendEquationSeparate(ii(32777,e,t),ii(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(ii(32969,e,t),ii(32968,e,t),ii(32971,e,t),ii(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(ii(32824,e,t),ii(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(ii(32938,e,t),ii(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,ii(2962,e,t),ii(2967,e,t),ii(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,ii(34816,e,t),ii(36003,e,t),ii(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,ii(2964,e,t),ii(2965,e,t),ii(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,ii(34817,e,t),ii(34818,e,t),ii(34819,e,t))},iS={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?n({[r]:t}):{valueChanged:!0}},blendColor:(n,e,t,r,o)=>n({32773:new Float32Array([e,t,r,o])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,r,o)=>n({32969:e,32968:t,32971:r,32970:o}),clearColor:(n,e,t,r,o)=>n({3106:new Float32Array([e,t,r,o])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,r,o)=>n({3107:[e,t,r,o]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,r,o)=>n({3088:new Int32Array([e,t,r,o])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,r)=>n({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(n,e,t,r,o)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:o}),stencilOp:(n,e,t,r)=>n({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(n,e,t,r,o)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:o}),viewport:(n,e,t,r,o)=>n({2978:[e,t,r,o]})},bc=(n,e)=>n.isEnabled(e),sS={3042:bc,2884:bc,2929:bc,3024:bc,32823:bc,32926:bc,32928:bc,3089:bc,2960:bc,35977:bc},zV=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Op(n,e){if(VV(e))return;const t={};for(const o in e){const c=Number(o),d=NV[o];d&&(typeof d=="string"?t[d]=!0:d(n,e[o],c))}const r=n.state&&n.state.cache;if(r)for(const o in t){const c=BV[o];c(n,e,r)}}function i3(n,e=zb){if(typeof e=="number"){const o=e,c=sS[o];return c?c(n,o):n.getParameter(o)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const o of t){const c=sS[o];r[o]=c?c(n,Number(o)):n.getParameter(Number(o))}return r}function UV(n){Op(n,zb)}function VV(n){for(const e in n)return!1;return!0}function jV(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&n.length===e.length){for(let o=0;o<n.length;++o)if(n[o]!==e[o])return!1;return!0}return!1}class zd{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Op(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?i3(e):Object.assign({},zb),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,WV(e);for(const r in iS){const o=iS[r];$V(e,r,o)}oS(e,"getParameter"),oS(e,"isEnabled")}_updateCache(e){let t=!1,r;const o=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const c in e){const d=e[c],a=this.cache[c];jV(d,a)||(t=!0,r=a,o&&!(c in o)&&(o[c]=a),this.cache[c]=d)}return{valueChanged:t,oldValue:r}}}function oS(n,e){const t=n[e].bind(n);n[e]=function(o){if(o===void 0||zV.has(o))return t(o);const c=zd.get(n);return o in c.cache||(c.cache[o]=t(o)),c.enable?c.cache[o]:t(o)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function $V(n,e,t){if(!n[e])return;const r=n[e].bind(n);n[e]=function(...c){const d=zd.get(n),{valueChanged:a,oldValue:v}=t(d._updateCache,...c);return a&&r(...c),v},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function WV(n){const e=n.useProgram.bind(n);n.useProgram=function(r){const o=zd.get(n);o.program!==r&&(e(r),o.program=r)}}function HV(n,e,t){let r="";const o={preserveDrawingBuffer:!0,...t};let c=null;if(c||=n.getContext("webgl2",o),o.failIfMajorPerformanceCaveat&&(r||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!c&&!t.failIfMajorPerformanceCaveat&&(o.failIfMajorPerformanceCaveat=!1,c=n.getContext("webgl2",o),c.luma||={},c.luma.softwareRenderer=!0),c||(c=n.getContext("webgl",{}),c&&(c=null,r||="Your browser only supports WebGL1")),!c)throw r||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:d,onContextRestored:a}=e;return n.addEventListener("webglcontextlost",v=>d(v),!1),n.addEventListener("webglcontextrestored",v=>a(v),!1),c.luma||={},c}function Ep(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function ZV(n,e){const t=n.getParameter(7936),r=n.getParameter(7937);Ep(n,"WEBGL_debug_renderer_info",e);const o=e.WEBGL_debug_renderer_info,c=n.getParameter(o?o.UNMASKED_VENDOR_WEBGL:7936),d=n.getParameter(o?o.UNMASKED_RENDERER_WEBGL:7937),a=c||t,v=d||r,A=n.getParameter(7938),P=s3(a,v),k=XV(a,v),L=qV(a,v);return{type:"webgl",gpu:P,gpuType:L,gpuBackend:k,vendor:a,renderer:v,version:A,shadingLanguage:"glsl",shadingLanguageVersion:300}}function s3(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function XV(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function qV(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(s3(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function o3(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Dm="WEBGL_compressed_texture_s3tc",Om="WEBGL_compressed_texture_s3tc_srgb",ap="EXT_texture_compression_rgtc",lp="EXT_texture_compression_bptc",GV="WEBGL_compressed_texture_etc",YV="WEBGL_compressed_texture_astc",KV="WEBGL_compressed_texture_etc1",JV="WEBGL_compressed_texture_pvrtc",QV="WEBGL_compressed_texture_atc",aS="EXT_texture_norm16",lS="EXT_render_snorm",ej="EXT_color_buffer_float",Ub={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[lS],"norm16-renderable-webgl":[aS],"snorm16-renderable-webgl":[aS,lS],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Dm,Om,ap,lp],"texture-compression-bc5-webgl":[ap],"texture-compression-bc7-webgl":[lp],"texture-compression-etc2":[GV],"texture-compression-astc":[YV],"texture-compression-etc1-webgl":[KV],"texture-compression-pvrtc-webgl":[JV],"texture-compression-atc-webgl":[QV]};function tj(n){return n in Ub}function nj(n,e,t){return(Ub[e]||[]).every(o=>Ep(n,o,t))}const Vb={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:ej,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Dm},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Om},"bc1-rgba-unorm":{gl:33777,x:Dm},"bc1-rgba-unorm-srgb":{gl:35916,x:Om},"bc2-rgba-unorm":{gl:33778,x:Dm},"bc2-rgba-unorm-srgb":{gl:35918,x:Om},"bc3-rgba-unorm":{gl:33779,x:Dm},"bc3-rgba-unorm-srgb":{gl:35919,x:Om},"bc4-r-unorm":{gl:36283,x:ap},"bc4-r-snorm":{gl:36284,x:ap},"bc5-rg-unorm":{gl:36285,x:ap},"bc5-rg-snorm":{gl:36286,x:ap},"bc6h-rgb-ufloat":{gl:36495,x:lp},"bc6h-rgb-float":{gl:36494,x:lp},"bc7-rgba-unorm":{gl:36492,x:lp},"bc7-rgba-unorm-srgb":{gl:36493,x:lp},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function rj(n,e,t){let r=e.create;const o=Vb[e.format];return o?.gl===void 0&&(r=!1),o?.x&&(r=r&&!!Ep(n,o.x,t)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function a3(n){const e=Vb[n],t=oj(n),r=mb(n);return{internalFormat:t,format:e?.dataFormat||sj(r.channels,r.integer,r.normalized,t),type:r.dataType?o3(r.dataType):e?.types?.[0]||5121,compressed:r.compressed||!1}}function ij(n){switch(mb(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function sj(n,e,t,r){if(r===6408||r===6407)return r;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function oj(n){const t=Vb[n]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const cS={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class aj extends NB{gl;extensions;testedFeatures=new Set;constructor(e,t,r){super([],r),this.gl=e,this.extensions=t,Ep(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),tj(e)&&nj(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(cS),...Object.keys(Ub)]}getWebGLFeature(e){const t=cS[e];return typeof t=="string"?!!Ep(this.gl,t,this.extensions):!!t}}class lj extends FB{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Hm extends My{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const r=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),r||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const r=this.colorAttachments[t];if(r){const o=36064+t;this._attachTextureView(o,r)}}if(this.depthStencilAttachment){const t=ij(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${uj(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:r}=this.device,{texture:o}=t,c=t.props.baseMipLevel,d=t.props.baseArrayLayer;switch(r.bindTexture(o.glTarget,o.handle),o.glTarget){case 35866:case 32879:r.framebufferTextureLayer(36160,e,o.handle,c,d);break;case 34067:const a=cj(d);r.framebufferTexture2D(36160,e,a,o.handle,c);break;case 3553:r.framebufferTexture2D(36160,e,3553,o.handle,c);break;default:throw new Error("Illegal texture type")}r.bindTexture(o.glTarget,null)}}function cj(n){return n<34069?n+34069:n}function uj(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class hj extends gb{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Hm(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e);return}}commit(){}}async function l3(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",n),new Promise((o,c)=>{r.onload=o,r.onerror=d=>c(new Error(`Unable to load script '${n}': ${d}`)),t.appendChild(r)})}const dj=1;let Ko=null,uS=!1;const jb={debugSpectorJS:Lt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function fj(n){if(!globalThis.SPECTOR)try{await l3(n.debugSpectorJSUrl||jb.debugSpectorJSUrl)}catch(e){Lt.warn(String(e))}}function pj(n){if(n={...jb,...n},!n.debugSpectorJS)return null;if(!Ko&&globalThis.SPECTOR&&!globalThis.luma?.spector){Lt.probe(dj,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;Ko=new e,globalThis.luma&&(globalThis.luma.spector=Ko)}if(!Ko)return null;if(uS||(uS=!0,Ko.spyCanvases(),Ko?.onCaptureStarted.add(e=>Lt.info("Spector capture started:",e)()),Ko?.onCapture.add(e=>{Lt.info("Spector capture complete:",e)(),Ko?.getResultUI(),Ko?.resultView.display(),Ko?.resultView.addCapture(e)})),n.gl){const e=n.gl,t=e.device;Ko?.startCapture(n.gl,500),e.device=t,new Promise(r=>setTimeout(r,2e3)).then(r=>{Lt.info("Spector capture stopped after 2 seconds")(),Ko?.stopCapture()})}return Ko}const mj="https://unpkg.com/webgl-debug@2.0.1/index.js";function c3(n){return n.luma=n.luma||{},n.luma}async function gj(){Zd()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await l3(mj))}function _j(n,e={}){return e.debugWebGL||e.traceWebGL?vj(n,e):yj(n)}function yj(n){const e=c3(n);return e.realContext?e.realContext:n}function vj(n,e){if(!globalThis.WebGLDebugUtils)return Lt.warn("webgl-debug not loaded")(),n;const t=c3(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...op,...n});const r=globalThis.WebGLDebugUtils.makeDebugContext(n,xj.bind(null,e),bj.bind(null,e));for(const d in op)!(d in r)&&typeof op[d]=="number"&&(r[d]=op[d]);class o{}Object.setPrototypeOf(r,Object.getPrototypeOf(n)),Object.setPrototypeOf(o,r);const c=Object.create(o);return t.realContext=n,t.debugContext=c,c.debug=!0,c}function hS(n,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function xj(n,e,t,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const o=globalThis.WebGLDebugUtils.glEnumToString(e),c=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,r),d=`${o} in gl.${t}(${c})`;Lt.error(d)();debugger}function bj(n,e,t){let r="";Lt.level>=1&&(r=hS(e,t),n.traceWebGL&&Lt.log(1,r)());for(const o of t)if(o===void 0){r=r||hS(e,t);debugger}}const c0={};function wj(n="id"){c0[n]=c0[n]||1;const e=c0[n]++;return`${n}-${e}`}class Zm extends Ar{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const r=typeof t=="object"?t.handle:void 0;this.handle=r||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Tj(this.props.usage),this.glUsage=Sj(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,r=e.byteLength+t){const o=this.glTarget;this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,r,this.glUsage),this.gl.bufferSubData(o,t,e),this.gl.bindBuffer(o,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(e,t,r),this.trackAllocatedMemory(r)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,t,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,t,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const r=new Uint8Array(t),o=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,r,o,t),this.gl.bindBuffer(36662,null),this._setDebugData(r,e,t),r}}function Tj(n){return n&Ar.INDEX?34963:n&Ar.VERTEX?34962:n&Ar.UNIFORM?35345:34962}function Sj(n){return n&Ar.INDEX||n&Ar.VERTEX?35044:n&Ar.UNIFORM?35048:35044}function Aj(n){const e=n.split(/\r?\n/),t=[];for(const r of e){if(r.length<=1)continue;const o=r.split(":");if(o.length===2){const[k,L]=o;t.push({message:L.trim(),type:dS(k),lineNum:0,linePos:0});continue}const[c,d,a,...v]=o;let A=parseInt(a,10);isNaN(A)&&(A=0);let P=parseInt(d,10);isNaN(P)&&(P=0),t.push({message:v.join(":").trim(),type:dS(c),lineNum:A,linePos:P})}return t}function dS(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class Pj extends Iy{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?Aj(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Lt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Lt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async o=>await new Promise(c=>setTimeout(c,o));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Ej(n,e,t,r){if(Rj(e))return r(n);const o=n;o.pushState();try{return Cj(n,e),Op(o.gl,t),r(n)}finally{o.popState()}}function Cj(n,e){const t=n,{gl:r}=t;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(Ud("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const c=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,d=Ud("provokingVertex",e.provokingVertex,{first:36429,last:36430});c?.provokingVertexWEBGL(d)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const c=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,d=Ud("polygonMode",e.polygonMode,{fill:6914,line:6913});c?.polygonModeWEBGL(1028,d),c?.polygonModeWEBGL(1029,d)}e.polygonOffsetLine&&r.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(Mj("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(dx("depthCompare",e.depthCompare))),e.stencilWriteMask){const o=e.stencilWriteMask;r.stencilMaskSeparate(1028,o),r.stencilMaskSeparate(1029,o)}if(e.stencilReadMask&&Lt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const o=e.stencilReadMask||4294967295,c=dx("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,c,0,o),r.stencilFuncSeparate(1029,c,0,o)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const o=u0("stencilPassOperation",e.stencilPassOperation),c=u0("stencilFailOperation",e.stencilFailOperation),d=u0("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,c,d,o),r.stencilOpSeparate(1029,c,d,o)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const o=fS("blendColorOperation",e.blendColorOperation||"add"),c=fS("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(o,c);const d=m_("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=m_("blendColorDstFactor",e.blendColorDstFactor||"zero"),v=m_("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),A=m_("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(d,a,v,A)}}function dx(n,e){return Ud(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function u0(n,e){return Ud(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function fS(n,e){return Ud(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function m_(n,e){return Ud(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Ij(n,e){return`Illegal parameter ${e} for ${n}`}function Ud(n,e,t){if(!(e in t))throw new Error(Ij(n,e));return t[e]}function Mj(n,e){return e}function Rj(n){let e=!0;for(const t in n){e=!1;break}return e}function u3(n){const e={};return n.addressModeU&&(e[10242]=h0(n.addressModeU)),n.addressModeV&&(e[10243]=h0(n.addressModeV)),n.addressModeW&&(e[32882]=h0(n.addressModeW)),n.magFilter&&(e[10240]=fx(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=kj(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=dx("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function h0(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function fx(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function kj(n,e="none"){if(!e)return fx(n);switch(e){case"none":return fx(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class px extends ng{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=u3(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,r]of Object.entries(e)){const o=Number(t);switch(o){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,o,r);break;default:this.device.gl.samplerParameteri(this.handle,o,r);break}}}}class cp extends Cy{device;gl;handle;texture;constructor(e,t){super(e,{...br.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}const Dj="Failed to deduce GL constant from typed array";function Oj(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Dj)}}function Lj(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function h3(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function Fj(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function cy(n,e,t){if(Nj(e))return t(n);const{nocatch:r=!0}=e,o=zd.get(n);o.push(),Op(n,e);let c;if(r)c=t(n),o.pop();else try{c=t(n)}finally{o.pop()}return c}function Nj(n){for(const e in n)return!1;return!0}function Bj(n,e,t){const{dimension:r,width:o,height:c,depth:d=0}=t,{glInternalFormat:a}=t,v=t.glTarget;switch(r){case"2d-array":case"3d":n.texStorage3D(v,e,a,o,c,d);break;default:n.texStorage2D(v,e,a,o,c)}}function pS(n,e,t,r){const{width:o,height:c}=r,{dimension:d,depth:a=0,mipLevel:v=0}=r,{x:A=0,y:P=0,z:k=0}=r,{glFormat:L,glType:z}=r,G=d3(r.glTarget,d,a),te=r.flipY?{37440:!0}:{};cy(n,te,()=>{switch(d){case"2d-array":case"3d":n.bindTexture(G,e),n.texSubImage3D(G,v,A,P,k,o,c,a,L,z,t),n.bindTexture(G,null);break;case"2d":case"cube":n.bindTexture(G,e),n.texSubImage2D(G,v,A,P,o,c,L,z,t),n.bindTexture(G,null);break;default:throw new Error(d)}})}function mS(n,e,t){const{dimension:r,width:o,height:c,depth:d=0,mipLevel:a=0,byteOffset:v=0}=t,{x:A=0,y:P=0,z:k=0}=t,{glFormat:L,glType:z,compressed:G}=t,te=d3(t.glTarget,r,d);switch(r){case"2d-array":case"3d":G?n.compressedTexSubImage3D(te,a,A,P,k,o,c,d,L,e,v):n.texSubImage3D(te,a,A,P,k,o,c,d,L,z,e,v);break;case"2d":case"cube":G?n.compressedTexSubImage2D(te,a,A,P,o,c,L,e,v):n.texSubImage2D(te,a,A,P,o,c,L,z,e,v);break;default:throw new Error(r)}}function zj(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function d3(n,e,t){return e==="cube"?34069+t:n}function Uj(n,e){const{sourceX:t=0,sourceY:r=0,sourceAttachment:o=0}=e||{};let{target:c=null,sourceWidth:d,sourceHeight:a,sourceDepth:v,sourceFormat:A,sourceType:P}=e||{};const{framebuffer:k,deleteFramebuffer:L}=f3(n),{gl:z,handle:G}=k;d||=k.width,a||=k.height;const te=k.colorAttachments[o]?.texture;if(!te)throw new Error(`Invalid framebuffer attachment ${o}`);v=te?.depth||1,A||=te?.glFormat||6408,P||=te?.glType||5121,c=$j(c,P,A,d,a),P=P||Oj(c);const re=z.bindFramebuffer(36160,G);return z.readBuffer(36064+o),z.readPixels(t,r,d,a,A,P,c),z.readBuffer(36064),z.bindFramebuffer(36160,re||null),L&&k.destroy(),c}function Vj(n,e){const{target:t,sourceX:r=0,sourceY:o=0,sourceFormat:c=6408,targetByteOffset:d=0}=e||{};let{sourceWidth:a,sourceHeight:v,sourceType:A}=e||{};const{framebuffer:P,deleteFramebuffer:k}=f3(n);a=a||P.width,v=v||P.height;const L=P;A=A||5121;let z=t;if(!z){const te=h3(c),re=Fj(A),fe=d+a*v*te*re;z=L.device.createBuffer({byteLength:fe})}const G=n.device.createCommandEncoder();return G.copyTextureToBuffer({sourceTexture:n,width:a,height:v,origin:[r,o],destinationBuffer:z,byteOffset:d}),G.destroy(),k&&P.destroy(),z}function f3(n){return n instanceof My?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:jj(n),deleteFramebuffer:!0}}function jj(n,e){const{device:t,width:r,height:o,id:c}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${c}`,width:r,height:o,colorAttachments:[n]})}function $j(n,e,t,r,o,c){if(n)return n;e||=5121;const d=Lj(e,{clamped:!1}),a=h3(t);return new d(r*o*a)}class Xm extends br{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,t){super(e,t);const r={...this.props};r.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=zj(this.props.dimension);const o=a3(this.props.format);this.glInternalFormat=o.internalFormat,this.glFormat=o.format,this.glType=o.type,this.compressed=o.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(r),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:t,height:r}=e;if(!t||!r){const o=br.getTextureDataSize(e.data);t=o?.width||1,r=o?.height||1}if(this.width=t,this.height=r,this.depth=e.depth,this.setSampler(e.sampler),this.view=new cp(this.device,{...this.props,texture:this}),this.bind(),Bj(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new cp(this.device,{...e,texture:this})}setSampler(e={}){let t;e instanceof px?(this.sampler=e,t=e.props):(this.sampler=new px(this.device,e),t=e);const r=u3(t);this._setSamplerParameters(r)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Lt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(r){Lt.warn(`Error generating mipmap for ${this}: ${r.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const t=br.getExternalImageSize(e.image),r={...br.defaultCopyExternalImageOptions,...t,...e},{image:o,depth:c,mipLevel:d,x:a,y:v,z:A,flipY:P}=r;let{width:k,height:L}=r;const{dimension:z,glTarget:G,glFormat:te,glInternalFormat:re,glType:fe}=this;if(k=Math.min(k,this.width-a),L=Math.min(L,this.height-v),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return pS(this.device.gl,this.handle,o,{dimension:z,mipLevel:d,x:a,y:v,z:A,width:k,height:L,depth:c,glFormat:te,glType:fe,glTarget:G,flipY:P}),{width:r.width,height:r.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,t=0){this.bind();const r=br.normalizeTextureData(e,this);r.length>1&&this.props.mipmaps!==!1&&Lt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let o=0;o<r.length;o++){const c=r[o];this._setMipLevel(t,o,c)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),mS(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,t=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const r of br.CubeFaces)this.setTextureCubeFaceData(e[r],r)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t,r=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&Lt.warn(`${this.id} has mipmap and multiple LODs.`)();const o=br.CubeFaces.indexOf(t);this.setTexture2DData(e,o)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:t,width:r,height:o,pixels:c,data:d,format:a=6408,type:v=5121}=e,{gl:A}=this,P=c||d;this.bind(),P instanceof Promise?P.then(k=>this.setImageDataForFace(Object.assign({},e,{face:t,data:k,pixels:k}))):this.width||this.height?A.texImage2D(t,0,a,r,o,0,a,v,P):A.texImage2D(t,0,a,a,v,P)}_getImageDataMap(e){for(let t=0;t<br.CubeFaces.length;++t){const r=br.CubeFaces[t];e[r]&&(e[34069+t]=e[r],delete e[r])}return e}_setSamplerParameters(e){Lt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,r]of Object.entries(e)){const o=Number(t),c=r;switch(o){case 33082:case 33083:this.gl.texParameterf(this.glTarget,o,c);break;case 10241:this.gl.texParameteri(this.glTarget,o,c);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,o,c);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,o,c);break;default:this.gl.texParameteri(this.glTarget,o,c);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,r,o=this.glTarget){if(br.isExternalImage(r)){pS(this.device.gl,this.handle,r,{...this,depth:e,mipLevel:t,glTarget:o,flipY:this.props.flipY});return}if(br.isTextureLevelData(r)){mS(this.device.gl,r.data,{...this,depth:e,mipLevel:t,glTarget:o});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}const Wj=[1,2,4,8];class Hj extends Cd{device;glParameters;constructor(e,t){super(e,t),this.device=e;let r;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:c,height:d}=t.framebuffer;r=[0,0,c,d]}else{const[c,d]=e.getCanvasContext().getDrawingBufferSize();r=[0,0,c,d]}if(this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const c=this.props.framebuffer.colorAttachments.map((d,a)=>36064+a);this.device.gl.drawBuffers(c)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=Wj.map(r=>!!(r&e.colorMask))),this.glParameters=t,Op(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((r,o)=>{r&&this.clearColorBuffer(o,r)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&cy(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){cy(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function Zj(n){return Xj.includes(n)}const Xj=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],p3={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function m3(n){const e=p3[n];if(!e)throw new Error("uniform");const[t,r,,o]=e;return{format:o,components:r,glType:t}}function qj(n){const e=p3[n];if(!e)throw new Error("attribute");const[,t,,r,o]=e;return{attributeType:r,vertexFormat:o,components:t}}function Gj(n,e){const t={attributes:[],bindings:[]};t.attributes=Yj(n,e);const r=Qj(n,e);for(const a of r){const v=a.uniforms.map(A=>({name:A.name,format:A.format,byteOffset:A.byteOffset,byteStride:A.byteStride,arrayLength:A.arrayLength}));t.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:v})}const o=Jj(n,e);let c=0;for(const a of o)if(Zj(a.type)){const{viewDimension:v,sampleType:A}=t$(a.type);t.bindings.push({type:"texture",name:a.name,group:0,location:c,viewDimension:v,sampleType:A}),a.textureUnit=c,c+=1}o.length&&(t.uniforms=o);const d=Kj(n,e);return d?.length&&(t.varyings=d),t}function Yj(n,e){const t=[],r=n.getProgramParameter(e,35721);for(let o=0;o<r;o++){const c=n.getActiveAttrib(e,o);if(!c)throw new Error("activeInfo");const{name:d,type:a}=c,v=n.getAttribLocation(e,d);if(v>=0){const{attributeType:A}=qj(a),P=/instance/i.test(d)?"instance":"vertex";t.push({name:d,location:v,stepMode:P,type:A})}}return t.sort((o,c)=>o.location-c.location),t}function Kj(n,e){const t=[],r=n.getProgramParameter(e,35971);for(let o=0;o<r;o++){const c=n.getTransformFeedbackVarying(e,o);if(!c)throw new Error("activeInfo");const{name:d,type:a,size:v}=c,{glType:A,components:P}=m3(a),k={location:o,name:d,type:A,size:v*P};t.push(k)}return t.sort((o,c)=>o.location-c.location),t}function Jj(n,e){const t=[],r=n.getProgramParameter(e,35718);for(let o=0;o<r;o++){const c=n.getActiveUniform(e,o);if(!c)throw new Error("activeInfo");const{name:d,size:a,type:v}=c,{name:A,isArray:P}=n$(d);let k=n.getUniformLocation(e,A);const L={location:k,name:A,size:a,type:v,isArray:P};if(t.push(L),L.size>1)for(let z=0;z<L.size;z++){const G=`${A}[${z}]`;k=n.getUniformLocation(e,G);const te={...L,name:G,location:k};t.push(te)}}return t}function Qj(n,e){const t=(c,d)=>n.getActiveUniformBlockParameter(e,c,d),r=[],o=n.getProgramParameter(e,35382);for(let c=0;c<o;c++){const d={name:n.getActiveUniformBlockName(e,c)||"",location:t(c,35391),byteLength:t(c,35392),vertex:t(c,35396),fragment:t(c,35398),uniformCount:t(c,35394),uniforms:[]},a=t(c,35395)||[],v=n.getActiveUniforms(e,a,35383),A=n.getActiveUniforms(e,a,35384),P=n.getActiveUniforms(e,a,35387),k=n.getActiveUniforms(e,a,35388);for(let L=0;L<d.uniformCount;++L){const z=n.getActiveUniform(e,a[L]);if(!z)throw new Error("activeInfo");d.uniforms.push({name:z.name,format:m3(v[L]).format,type:v[L],arrayLength:A[L],byteOffset:P[L],byteStride:k[L]})}r.push(d)}return r.sort((c,d)=>c.location-d.location),r}const e$={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function t$(n){const e=e$[n];if(!e)throw new Error("sampler");const[t,r]=e;return{viewDimension:t,sampleType:r}}function n$(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function r$(n,e,t,r){const o=n;let c=r;c===!0&&(c=1),c===!1&&(c=0);const d=typeof c=="number"?[c]:c;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,r);case 5126:return n.uniform1fv(e,d);case 35664:return n.uniform2fv(e,d);case 35665:return n.uniform3fv(e,d);case 35666:return n.uniform4fv(e,d);case 5124:return n.uniform1iv(e,d);case 35667:return n.uniform2iv(e,d);case 35668:return n.uniform3iv(e,d);case 35669:return n.uniform4iv(e,d);case 35670:return n.uniform1iv(e,d);case 35671:return n.uniform2iv(e,d);case 35672:return n.uniform3iv(e,d);case 35673:return n.uniform4iv(e,d);case 5125:return o.uniform1uiv(e,d,1);case 36294:return o.uniform2uiv(e,d,2);case 36295:return o.uniform3uiv(e,d,3);case 36296:return o.uniform4uiv(e,d,4);case 35674:return n.uniformMatrix2fv(e,!1,d);case 35675:return n.uniformMatrix3fv(e,!1,d);case 35676:return n.uniformMatrix4fv(e,!1,d);case 35685:return o.uniformMatrix2x3fv(e,!1,d);case 35686:return o.uniformMatrix2x4fv(e,!1,d);case 35687:return o.uniformMatrix3x2fv(e,!1,d);case 35688:return o.uniformMatrix3x4fv(e,!1,d);case 35689:return o.uniformMatrix4x2fv(e,!1,d);case 35690:return o.uniformMatrix4x3fv(e,!1,d)}throw new Error("Illegal uniform")}function i$(n){return qC(n)!==null||typeof n=="number"||typeof n=="boolean"}function s$(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];i$(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}function o$(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function a$(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const gS=4;class l$ extends _p{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:r,bufferMode:o=35981}=t;r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,o)),this._linkShaders(),Lt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Gj(this.device.gl,this.handle),Lt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=c$(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(const[r,o]of Object.entries(e)){const c=this.shaderLayout.bindings.find(d=>d.name===r)||this.shaderLayout.bindings.find(d=>d.name===`${r}Uniforms`);if(!c){const d=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");t?.disableWarnings||Lt.warn(`No binding "${r}" in render pipeline "${this.id}", expected one of ${d}`,o)();continue}switch(o||Lt.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),c.type){case"uniform":if(!(o instanceof Zm)&&!(o.buffer instanceof Zm))throw new Error("buffer value");break;case"texture":if(!(o instanceof cp||o instanceof Xm||o instanceof Hm))throw new Error("texture value");break;case"sampler":Lt.warn(`Ignoring sampler ${r}`)();break;default:throw new Error(c.type)}this.bindings[r]=o}}draw(e){const{renderPass:t,parameters:r=this.props.parameters,topology:o=this.props.topology,vertexArray:c,vertexCount:d,instanceCount:a,isInstanced:v=!1,firstVertex:A=0,transformFeedback:P}=e,k=o$(o),L=!!c.indexBuffer,z=c.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Lt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Lt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),c.bindBeforeRender(t),P&&P.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const G=t;return Ej(this.device,r,G.glParameters,()=>{L&&v?this.device.gl.drawElementsInstanced(k,d||0,z,A,a||0):L?this.device.gl.drawElements(k,d||0,z,A):v?this.device.gl.drawArraysInstanced(k,A,d||0,a||0):this.device.gl.drawArrays(k,A,d||0),P&&P.end()}),c.unbindAfterRender(t),!0}setUniformsWebGL(e){const{bindings:t}=s$(e);Object.keys(t).forEach(r=>{Lt.warn(`Unsupported value "${JSON.stringify(t[r])}" used in setUniforms() for key ${r}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Lt.time(gS,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Lt.timeEnd(gS,`linkProgram for ${this.id}`)(),Lt.level,!this.device.features.has("compilation-status-async-webgl")){const r=this._getLinkStatus();this._reportLinkStatus(r);return}Lt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Lt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const t=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${t}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async o=>await new Promise(c=>setTimeout(c,o));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(Lt.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,r=0;for(const o of this.shaderLayout.bindings){const c=this.bindings[o.name]||this.bindings[o.name.replace(/Uniforms$/,"")];if(!c)throw new Error(`No value for binding ${o.name} in ${this.id}`);switch(o.type){case"uniform":const{name:d}=o,a=e.getUniformBlockIndex(this.handle,d);if(a===4294967295)throw new Error(`Invalid uniform block name ${d}`);e.uniformBlockBinding(this.handle,r,a),c instanceof Zm?e.bindBufferBase(35345,r,c.handle):e.bindBufferRange(35345,r,c.buffer.handle,c.offset||0,c.size||c.buffer.byteLength-c.offset),r+=1;break;case"texture":if(!(c instanceof cp||c instanceof Xm||c instanceof Hm))throw new Error("texture");let v;if(c instanceof cp)v=c.texture;else if(c instanceof Xm)v=c;else if(c instanceof Hm&&c.colorAttachments[0]instanceof cp)Lt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),v=c.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(v.glTarget,v.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${o.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:r,type:o,textureUnit:c}=e,d=this.uniforms[t]??c;d!==void 0&&r$(this.device.gl,r,o,d)}}}function c$(n,e){const t={...n,attributes:n.attributes.map(r=>({...r}))};for(const r of e?.attributes||[]){const o=t.attributes.find(c=>c.name===r.name);o?(o.type=r.type||o.type,o.stepMode=r.stepMode||o.stepMode):Lt.warn(`shader layout attribute ${r.name} not present in shader`)}return t}class u$ extends yb{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":h$(this.device,t.options);break;case"copy-buffer-to-texture":d$(this.device,t.options);break;case"copy-texture-to-buffer":f$(this.device,t.options);break;case"copy-texture-to-texture":p$(this.device,t.options);break;default:throw new Error(t.name)}}}function h$(n,e){const t=e.sourceBuffer,r=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,r.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function d$(n,e){throw new Error("Not implemented")}function f$(n,e){const{sourceTexture:t,mipLevel:r=0,aspect:o="all",width:c=e.sourceTexture.width,height:d=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:v=[0,0],destinationBuffer:A,byteOffset:P=0,bytesPerRow:k,rowsPerImage:L}=e;if(o!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||a!==0||k||L)throw new Error("not implemented");const{framebuffer:z,destroyFramebuffer:G}=g3(t);let te;try{const re=A,fe=c||z.width,ve=d||z.height,le=a3(z.colorAttachments[0].texture.props.format),Se=le.format,Ne=le.type;n.gl.bindBuffer(35051,re.handle),te=n.gl.bindFramebuffer(36160,z.handle),n.gl.readPixels(v[0],v[1],fe,ve,Se,Ne,P)}finally{n.gl.bindBuffer(35051,null),te!==void 0&&n.gl.bindFramebuffer(36160,te),G&&z.destroy()}}function p$(n,e){const{sourceTexture:t,destinationMipLevel:r=0,origin:o=[0,0],destinationOrigin:c=[0,0],destinationTexture:d}=e;let{width:a=e.destinationTexture.width,height:v=e.destinationTexture.height}=e;const{framebuffer:A,destroyFramebuffer:P}=g3(t),[k,L]=o,[z,G,te]=c,re=n.gl.bindFramebuffer(36160,A.handle);let fe=null,ve;if(d instanceof Xm)fe=d,a=Number.isFinite(a)?a:fe.width,v=Number.isFinite(v)?v:fe.height,fe.bind(0),ve=fe.glTarget;else throw new Error("invalid destination");switch(ve){case 3553:case 34067:n.gl.copyTexSubImage2D(ve,r,z,G,k,L,a,v);break;case 35866:case 32879:n.gl.copyTexSubImage3D(ve,r,z,G,te,k,L,a,v);break}fe&&fe.unbind(),n.gl.bindFramebuffer(36160,re),P&&A.destroy()}function g3(n){if(n instanceof br){const{width:e,height:t,id:r}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class m$ extends _b{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new u$(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,r){}}function g$(n){const{target:e,source:t,start:r=0,count:o=1}=n,c=t.length,d=o*c;let a=0;for(let v=r;a<c;a++)e[v++]=t[a];for(;a<d;)a<d-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+d-a),a=d);return n.target}class $b extends vb{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return EL()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const r=t;if(r.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:o,type:c,stride:d,offset:a,normalized:v,integer:A,divisor:P}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,r.handle),A?this.device.gl.vertexAttribIPointer(e,o,c,d,a):this.device.gl.vertexAttribPointer(e,o,c,v,d,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,P||0),this.attributes[e]=r,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const r=o3(t.bufferDataType);return{size:t.bufferComponents,type:r,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const o=$b.isConstantAttributeZeroSupported(this.device)||e!==0;(t||o)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const r=_$(t),o=r.byteLength*e,c=r.length*e;if(this.buffer&&o!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${o} !== ${this.buffer.byteLength}.`);let d=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:o}),d=d||!y$(r,this.bufferValue),d){const a=dz(t.constructor,c);g$({target:a,source:r,start:0,count:c}),this.buffer.write(a),this.bufferValue=t}return this.buffer}}function _$(n){return Array.isArray(n)?new Float32Array(n):n}function y$(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class v$ extends xb{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(a$(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:o,byteLength:c,byteOffset:d}=this._getBufferRange(t);if(r<0){this.unusedBuffers[e]=o,Lt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[r]={buffer:o,byteLength:c,byteOffset:d},this.bindOnUse||this._bindBuffer(r,o,d,c)}getBuffer(e){if(_S(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Zm)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:r=0,byteLength:o=e.buffer.byteLength}=e;return{buffer:t,byteOffset:r,byteLength:o}}_getVaryingIndex(e){if(_S(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:r,byteOffset:o}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,o,r)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,r=0,o){const c=t&&t.handle;!c||o===void 0?this.gl.bindBufferBase(35982,e,c):this.gl.bindBufferRange(35982,e,c,r,o)}}function _S(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class x$ extends bb{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,o)=>{const c=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(c)}),this._pollingPromise}}class up extends Sh{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||wj("webgl-device")});const t=Sh._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let r=t.canvas?.gl?.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);this.canvasContext=new hj(this,t),this.lost=new Promise(P=>{this._resolveContextLost=P});const o={...e.webgl};t.alphaMode==="premultiplied"&&(o.premultipliedAlpha=!0),e.powerPreference!==void 0&&(o.powerPreference=e.powerPreference);const d=this.props._handle||HV(this.canvasContext.canvas,{onContextLost:P=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:P=>console.log("WebGL context restored")},o);if(!d)throw new Error("WebGL context creation failed");if(r=d.device,r){if(e._reuseDevices)return Lt.log(1,`Not creating a new Device, instead returning a reference to Device ${r.id} already attached to WebGL context`,r)(),r._reused=!0,r;throw new Error(`WebGL context already attached to device ${r.id}`)}this.handle=d,this.gl=d,this.spectorJS=pj({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=ZV(this.gl,this._extensions),this.limits=new lj(this.gl),this.features=new aj(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),t.autoResize!==!1&&this.canvasContext.resize(),new zd(this.gl,{log:(...P)=>Lt.log(1,...P)()}).trackState(this.gl,{copyState:!1});const v=e.debugWebGL||e.debug,A=e.debugWebGL;v&&(this.gl=_j(this.gl,{debugWebGL:v,traceWebGL:A}),Lt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Lt.level=Math.max(Lt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Zm(this,t)}createTexture(e){return new Xm(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new px(this,e)}createShader(e){return new Pj(this,e)}createFramebuffer(e){return new Hm(this,e)}createVertexArray(e){return new $b(this,e)}createTransformFeedback(e){return new v$(this,e)}createQuerySet(e){return new x$(this,e)}createRenderPipeline(e){return new l$(this,e)}beginRenderPass(e){return new Hj(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new m$(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return Uj(e,t)}readPixelsToBufferWebGL(e,t){return Vj(e,t)}setParametersWebGL(e){Op(this.gl,e)}getParametersWebGL(e){return i3(this.gl,e)}withParametersWebGL(e,t){return cy(this.gl,e,t)}resetWebGL(){Lt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),UV(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return rj(this.gl,e,this._extensions)}loseDevice(){let e=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(e=!0,r.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){zd.get(this.gl).push()}popState(){zd.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){const r=Number(e);for(const o in this.gl)if(this.gl[o]===r)return`GL.${o}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((r,[o,c])=>(r[`${o}:${this.getGLKey(o,t)}`]=`${c}:${this.getGLKey(c,t)}`,r),{})}_constants;setConstantAttributeWebGL(e,t){const r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);const o=this._constants[e];switch(o&&S$(o,t)&&Lt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:b$(this,e,t);break;case Int32Array:w$(this,e,t);break;case Uint32Array:T$(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return Ep(this.gl,e,this._extensions),this._extensions}}function b$(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function w$(n,e,t){n.gl.vertexAttribI4iv(e,t)}function T$(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function S$(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const A$={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},P$=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),E$=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),C$=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function I$(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,r){if(t==="webgl"||t==="experimental-webgl"){const o=this.originalGetContext("webgl2",r);return o instanceof HTMLElement&&M$(o),o}return this.originalGetContext(t,r)}}function M$(n){n.getExtension("EXT_color_buffer_float");const e={...A$,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:P$(n),OES_vertex_array_object:E$(n),ANGLE_instanced_arrays:C$(n)},t=n.getExtension;n.getExtension=function(o){const c=t.call(n,o);return c||(o in e?e[o]:null)};const r=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(r.apply(n)||[])?.concat(Object.keys(e))}}const g_=1;class R$ extends jB{type="webgl";constructor(){super(),Sh.defaultProps={...Sh.defaultProps,...jb},up.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){I$(e)}async attach(e){if(e instanceof up)return e;if(e?.device instanceof Sh)return e.device;if(!k$(e))throw new Error("Invalid WebGL2RenderingContext");return new up({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){Lt.groupCollapsed(g_,"WebGLDevice created")();const t=[];(e.debugWebGL||e.debug)&&t.push(gj()),e.debugSpectorJS&&t.push(fj(e));const r=await Promise.allSettled(t);for(const d of r)d.status==="rejected"&&Lt.error(`Failed to initialize debug libraries ${d.reason}`)();const o=new up(e),c=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return Lt.probe(g_,c)(),Lt.table(g_,o.info)(),Lt.groupEnd(g_)(),o}}function k$(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const yS=new R$;function mh(){}const D$=({isDragging:n})=>n?"grabbing":"grab",_3={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:mh,onWebGLInitialized:mh,onResize:mh,onViewStateChange:mh,onInteractionStateChange:mh,onBeforeRender:mh,onAfterRender:mh,onLoad:mh,onError:n=>_r.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:D$,getTooltip:null,debug:!1,drawPickingColors:!1};class Wb{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Ay({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:o}=this;if(r.type==="pointerleave")o.x=-1,o.y=-1,o.radius=0;else{if(r.leftButton||r.rightButton)return;{const c=r.offsetCenter;if(!c)return;o.x=c.x,o.y=c.y,o.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:o.x,y:o.y}),o.event=r},this._onEvent=r=>{const o=sx[r.type],c=r.offsetCenter;if(!o||!c||!this.layerManager)return;const d=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:c.x,y:c.y,layers:d,viewports:this.getViewports(c)},this._lastPointerDownInfo),{layer:v}=a,A=v&&(v[o]||v.props[o]),P=this.props[o];let k=!1;A&&(k=A.call(v,a,r)),k||(P?.(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{if(this.device?.type==="webgpu")return;const o=r.offsetCenter,c=this._pick("pickObject","pickObject Time",{x:o.x,y:o.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=c.result[0]||c.emptyInfo},this.props={..._3,...e},e=this.props,e.viewState&&e.initialViewState&&_r.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&_r.error("WebGL1 context not supported.")(),t=yS.attach(e.gl)),t||(t=q0.createDevice({type:"best-available",_reuseDevices:!0,adapters:[yS],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Tp.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&_r.removed("onLayerHover","onHover")(),"onLayerClick"in e&&_r.removed("onLayerClick","onClick")(),e.initialViewState&&!Pl(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),c=this.effectManager.needsRedraw(e),d=this.deckRenderer.needsRedraw(e);return t=t||r||o||c||d,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return xs(this.viewManager),this.viewManager.views}getViewports(e){return xs(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,r){xs(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(t).timeStart();const c=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return o.get(t).timeEnd(),c}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),xs(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const o=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=o}if(r||r===0){const o=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.viewManager?.setProps({width:t,height:r}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){const{gl:r,onError:o,useDevicePixels:c}=t;return new F8({device:e,useDevicePixels:c,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:d=>this._setDevice(d.device),onRender:this._onRenderFrame.bind(this),onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new t3({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let o=r,c=!1;for(const d of t)o=d,c=d.layer?.onHover(d,e.event)||c;c||(this.props.onHover?.(o,e.event),this.widgetManager.onHover(o,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new XC;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new cU(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(N2).map(o=>{const[c,d,a,v]=N2[o],A=this.props.eventRecognizerOptions?.[o],P={...d,...A,event:o};return{recognizer:new c(P),recognizeWith:a,requestFailure:v}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in sx)this.eventManager.on(o,this._onEvent);this.viewManager=new aV({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new oV(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new wV({deck:this,device:this.device}),this.deckRenderer=new AV(this.device),this.deckPicker=new RV(this.device),this.widgetManager=new OV({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new FV),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:r,gl:o}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:o});const c={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(c),c.pass==="screen"&&this.widgetManager.onRedraw({viewports:c.viewports,layers:c.layers}),this.props.onAfterRender({device:r,gl:o})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),_r.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=q0.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}Wb.defaultProps=_3;Wb.VERSION=qN;function O$(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return XE(n)}}const L$=ZE;function __(n,e,t){const r=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function kd(n){return n.stride||n.size*n.bytesPerElement}function F$(n,e){return n.type===e.type&&n.size===e.size&&kd(n)===kd(e)&&(n.offset||0)===(e.offset||0)}function mx(n,e){e.offset&&_r.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=kd(n),r=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,o=e.elementOffset||0,c=r*t+o*n.bytesPerElement+(n.offset||0);return{...e,offset:c,stride:t}}function N$(n,e){const t=mx(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class B${constructor(e,t,r){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const o=t.logicalType||t.type,c=o==="float64";let{defaultValue:d}=t;d=Number.isFinite(d)?[d]:d||new Array(this.size).fill(0);let a;c?a="float32":!o&&t.isIndexed?a="uint32":a=o||"float32";let v=O$(o||a);this.doublePrecision=c,c&&t.fp64===!1&&(v=Float32Array),this.value=null,this.settings={...t,defaultType:v,defaultValue:d,logicalType:o,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:v.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*kd(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Tp.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const r={};if(this.state.constant){const o=this.value;if(t){const c=mx(this.getAccessor(),t),d=c.offset/o.BYTES_PER_ELEMENT,a=c.size||this.size;r[e]=o.subarray(d,d+a)}else r[e]=o}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){const r=this.getAccessor(),o=[],c={name:this.id,byteStride:kd(r),attributes:o};if(this.doublePrecision){const d=N$(r,t||{});o.push(__(e,{...r,...d.high},this.device.type),__(`${e}64Low`,{...r,...d.low},this.device.type))}else if(t){const d=mx(r,t);o.push(__(e,{...r,...d},this.device.type))}else o.push(__(e,r,this.device.type));return c}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:o}=this,c=r*o;if(t&&c&&t.length>=c){const d=new Array(o).fill(1/0),a=new Array(o).fill(-1/0);for(let v=0;v<c;)for(let A=0;A<o;A++){const P=t[v++];P<d[A]&&(d[A]=P),P>a[A]&&(a[A]=P)}e=[d,a]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Ar?r={buffer:e}:r=e;const o={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)o.type="float32";else{const d=L$(r.value);o.type=o.normalized?d.replace("int","norm"):d}o.bytesPerElement=r.value.BYTES_PER_ELEMENT,o.stride=kd(o)}if(t.bounds=null,r.constant){let c=r.value;if(c=this._normalizeValue(c,[],0),this.settings.normalized&&(c=this.normalizeConstant(c)),!(!t.constant||!this._areValuesEqual(c,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(c)?c:new Float32Array(c)}else if(r.buffer){const c=r.buffer;t.externalBuffer=c,t.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let c=r.value;t.externalBuffer=null,t.constant=!1,this.value=c;let{buffer:d}=this;const a=kd(o),v=(o.vertexOffset||0)*a;if(this.doublePrecision&&c instanceof Float64Array&&(c=n0(c,o)),this.settings.isIndexed){const P=this.settings.defaultType;c.constructor!==P&&(c=new P(c))}const A=c.byteLength+v+a*2;(!d||d.byteLength<A)&&(d=this._createBuffer(A)),d.write(c,v)}return this.setAccessor(o),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:o}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?n0(t,{size:this.size,startIndex:r,endIndex:o}):t.subarray(r,o),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:r}=this,o=r.allocatedValue,c=Tp.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=c;const{byteOffset:d}=this;let{buffer:a}=this;return(!a||a.byteLength<c.byteLength+d)&&(a=this._createBuffer(c.byteLength+d),t&&o&&a.write(o instanceof Float64Array?n0(o,this):o,d)),r.allocatedValue=c,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=t.BYTES_PER_ELEMENT<4),o)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&_r.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:o,size:c}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let d=c;for(;--d>=0;)t[r+d]=o[d];return t}switch(c){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let d=c;for(;--d>=0;)t[r+d]=Number.isFinite(e[d])?e[d]:o[d]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let o=0;o<r;o++)if(e[o]!==t[o])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?Ar.INDEX:Ar.VERTEX)|Ar.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}const vS=[],xS=[];function Ly(n,e=0,t=1/0){let r=vS;const o={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?r=n:n.length>0&&(xS.length=n.length,r=xS):r=vS,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),o.index=e-1),{iterable:r,objectInfo:o}}function y3(n){return n&&n[Symbol.asyncIterator]}function v3(n,e){const{size:t,stride:r,offset:o,startIndices:c,nested:d}=e,a=n.BYTES_PER_ELEMENT,v=r?r/a:t,A=o?o/a:0,P=Math.floor((n.length-A)/v);return(k,{index:L,target:z})=>{if(!c){const fe=L*v+A;for(let ve=0;ve<t;ve++)z[ve]=n[fe+ve];return z}const G=c[L],te=c[L+1]||P;let re;if(d){re=new Array(te-G);for(let fe=G;fe<te;fe++){const ve=fe*v+A;z=new Array(t);for(let le=0;le<t;le++)z[le]=n[ve+le];re[fe-G]=z}}else if(v===t)re=n.subarray(G*t+A,te*t+A);else{re=new n.constructor((te-G)*t);let fe=0;for(let ve=G;ve<te;ve++){const le=ve*v+A;for(let Se=0;Se<t;Se++)re[fe++]=n[le+Se]}}return re}}const z$=[],F_=[[0,1/0]];function U$(n,e){if(n===F_||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],r=n.length;let o=0;for(let c=0;c<r;c++){const d=n[c];d[1]<e[0]?(t.push(d),o=c+1):d[0]>e[1]?t.push(d):e=[Math.min(d[0],e[0]),Math.max(d[1],e[1])]}return t.splice(o,0,e),t}const V$={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function x3(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...V$[t],...e,...n,type:t}}class b3 extends B${constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:F_}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!F$(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,o=Array.isArray(t)?e[t.find(c=>e[c])]:e[t];return x3(o,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:o=1/0}=t;this.state.updateRanges=U$(this.state.updateRanges,[r,o])}else this.state.updateRanges=F_}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=z$}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==F_),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:d,noAlloc:a}}=this;let v=!0;if(d){for(const[A,P]of c)d.call(o,this,{data:t,startRow:A,endRow:P,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[A,P]of c){const k=Number.isFinite(A)?this.getVertexOffset(A):0,L=Number.isFinite(P)?this.getVertexOffset(P):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:k,endOffset:L})}this._checkAttributeArray()}else v=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),v}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:o}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),o.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const d=e;xs(ArrayBuffer.isView(d.value),`invalid ${o.accessor}`);const a=!!d.size&&d.size!==this.size;return r.binaryAccessor=v3(d.value,{size:d.size||this.size,stride:d.stride,offset:d.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:o}=this.settings;if(o==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=o??"vertex",!t)return r;for(const c in t){const d=super._getBufferLayout(c,t[c]);r.attributes.push(...d.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:o,props:c,numInstances:d}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:v,value:A,size:P,startIndices:k}=e,{accessor:L,transform:z}=a;let G=v.binaryAccessor||(typeof L=="function"?L:c[L]);typeof G!="function"&&(G=()=>G),xs(typeof G=="function",`accessor "${L}" is not a function`);let te=e.getVertexOffset(r);const{iterable:re,objectInfo:fe}=Ly(t,r,o);for(const ve of re){fe.index++;let le=G(ve,fe);if(z&&(le=z.call(this,le)),k){const Se=(fe.index<k.length-1?k[fe.index+1]:d)-k[fe.index];if(le&&Array.isArray(le[0])){let Ne=te;for(const nt of le)e._normalizeValue(nt,A,Ne),Ne+=P}else le&&le.length>P?A.set(le,te):(e._normalizeValue(le,fe.target,0),tV({target:A,source:fe.target,start:te,count:Se}));te+=Se*P}else e._normalizeValue(le,A,te),te+=P}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function d0(n){const{source:e,target:t,start:r=0,size:o,getData:c}=n,d=n.end||t.length,a=e.length,v=d-r;if(a>v){t.set(e.subarray(0,v),r);return}if(t.set(e,r),!c)return;let A=a;for(;A<v;){const P=c(A,e);for(let k=0;k<o;k++)t[r+A]=P[k]||0,A++}}function j$({source:n,target:e,size:t,getData:r,sourceStartIndices:o,targetStartIndices:c}){if(!o||!c)return d0({source:n,target:e,size:t,getData:r}),e;let d=0,a=0;const v=r&&((P,k)=>r(P+a,k)),A=Math.min(o.length,c.length);for(let P=1;P<A;P++){const k=o[P]*t,L=c[P]*t;d0({source:n.subarray(d,k),target:e,start:a,end:L,size:t,getData:v}),d=k,a=L}return a<e.length&&d0({source:[],target:e,start:a,size:t,getData:v}),e}function $$(n){const{device:e,settings:t,value:r}=n,o=new b3(e,t);return o.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),o}function w3(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function T3(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function S3(n){n.push(n.shift())}function W$(n,e){const{doublePrecision:t,settings:r,value:o,size:c}=n,d=t&&o instanceof Float64Array?2:1;let a=0;const{shaderAttributes:v}=n.settings;if(v)for(const A of Object.values(v))a=Math.max(a,A.vertexOffset??0);return(r.noAlloc?o.length:(e+a)*c)*d}function A3({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function P3({device:n,buffer:e,attribute:t,fromLength:r,toLength:o,fromStartIndices:c,getData:d=a=>a}){const a=t.doublePrecision&&t.value instanceof Float64Array?2:1,v=t.size*a,A=t.byteOffset,P=t.settings.bytesPerElement<4?A/t.settings.bytesPerElement*4:A,k=t.startIndices,L=c&&k,z=t.isConstant;if(!L&&e&&r>=o)return e;const G=t.value instanceof Float64Array?Float32Array:t.value.constructor,te=z?t.value:new G(t.getBuffer().readSyncWebGL(A,o*G.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!z){const le=d;d=(Se,Ne)=>t.normalizeConstant(le(Se,Ne))}const re=z?(le,Se)=>d(te,Se):(le,Se)=>d(te.subarray(le+A,le+A+v),Se),fe=e?new Float32Array(e.readSyncWebGL(P,r*4).buffer):new Float32Array(0),ve=new Float32Array(o);return j$({source:fe,target:ve,sourceStartIndices:c,targetStartIndices:k,size:v,getData:re}),(!e||e.byteLength<ve.byteLength+P)&&(e?.destroy(),e=n.createBuffer({byteLength:ve.byteLength+P,usage:35050})),e.write(ve,P),e}class E3{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Oy(r),this.attribute=t,this.attributeInTransition=$$(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=W$(this.attribute,t),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class H$ extends E3{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=G$(e,t)}start(e,t){const r=this.currentLength,o=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:c,attribute:d}=this;S3(c),c[0]=P3({device:this.device,buffer:c[0],attribute:d,fromLength:r,toLength:this.currentLength,fromStartIndices:o,getData:e.enter}),c[1]=A3({device:this.device,source:c[0],target:c[1]}),this.setBuffer(c[1]);const{transform:a}=this,v=a.model;let A=Math.floor(this.currentLength/d.size);C3(d)&&(A/=2),v.setVertexCount(A),d.isConstant?(v.setAttributes({aFrom:c[0]}),v.setConstantAttributes({aTo:d.value})):v.setAttributes({aFrom:c[0],aTo:d.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:c[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:r}=this.transition;let o=r/e;t&&(o=t(o));const{model:c}=this.transform,d={time:o};c.shaderInputs.setProps({interpolation:d}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Z$=`uniform interpolationUniforms {
  float time;
} interpolation;
`,bS={name:"interpolation",vs:Z$,uniformTypes:{time:"f32"}},X$=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,q$=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function C3(n){return n.doublePrecision&&n.value instanceof Float64Array}function G$(n,e){const t=e.size,r=w3(t),o=T3(t),c=e.getBufferLayout();return C3(e)?new Ap(n,{vs:q$,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:o,byteOffset:0},{attribute:"aFrom64Low",format:o,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:o,byteOffset:0},{attribute:"aTo64Low",format:o,byteOffset:4*t}]}],modules:[Q6,bS],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ap(n,{vs:X$,bufferLayout:[{name:"aFrom",format:o},{name:"aTo",format:c.attributes[0].format}],modules:[bS],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class Y$ extends E3{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=nW(e),this.framebuffer=rW(e,this.texture),this.transform=tW(e,t)}start(e,t){const r=this.currentLength,o=this.currentStartIndices;super.start(e,t);const{buffers:c,attribute:d}=this;for(let v=0;v<2;v++)c[v]=P3({device:this.device,buffer:c[v],attribute:d,fromLength:r,toLength:this.currentLength,fromStartIndices:o,getData:e.enter});c[2]=A3({device:this.device,source:c[0],target:c[2]}),this.setBuffer(c[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/d.size)),d.isConstant?a.setConstantAttributes({aTo:d.value}):a.setAttributes({aTo:d.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:r,transition:o}=this,c=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const d={stiffness:c.stiffness,damping:c.damping};t.model.shaderInputs.setProps({spring:d}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),S3(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||o.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const K$=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,J$={name:"spring",vs:K$,uniformTypes:{damping:"f32",stiffness:"f32"}},Q$=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,eW=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function tW(n,e){const t=w3(e.size),r=T3(e.size);return new Ap(n,{vs:Q$,fs:eW,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[J$],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function nW(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function rW(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const iW={interpolation:H$,spring:Y$};class sW{constructor(e,{id:t,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const o in e){const c=e[o],d=c.getTransitionSetting(t);d&&this._updateAttribute(o,c,d)}for(const o in this.transitions){const c=e[o];(!c||!c.getTransitionSetting(t))&&this._removeTransition(o)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){const o=this.transitions[e];let c=!o||o.type!==r.type;if(c){o&&this._removeTransition(e);const d=iW[r.type];d?this.transitions[e]=new d({attribute:t,timeline:this.timeline,device:this.device}):(_r.error(`unsupported transition type '${r.type}'`)(),c=!1)}(c||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const wS="attributeManager.invalidate",oW="attributeManager.updateStart",aW="attributeManager.updateEnd",lW="attribute.updateStart",cW="attribute.allocate",uW="attribute.updateEnd";class Hb{constructor(e,{id:t="attribute-manager",stats:r,timeline:o}={}){this.mergeBoundsMemoized=yg(T8),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new sW(e,{id:`${t}-transitions`,timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);Bs(wS,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Bs(wS,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:o,props:c={},buffers:d={},context:a={}}){let v=!1;Bs(oW,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const A in this.attributes){const P=this.attributes[A],k=P.settings.accessor;P.startIndices=r,P.numInstances=t,c[A]&&_r.removed(`props.${A}`,`data.attributes.${A}`)(),P.setExternalBuffer(d[A])||P.setBinaryValue(typeof k=="string"?d[k]:void 0,e.startIndices)||typeof k=="string"&&!d[k]&&P.setConstantValue(c[k])||P.needsUpdate()&&(v=!0,this._updateAttribute({attribute:P,numInstances:t,data:e,props:c,context:a})),this.needsRedraw=this.needsRedraw||P.needsRedraw()}v&&Bs(aW,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(r=>this.attributes[r]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,o={...r.getAttributes()};for(const c in t){const d=t[c];d.needsRedraw(e)&&!r.hasAttribute(c)&&(o[c]=d)}return o}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const r in e){const o=e[r],c={...o,id:r,size:o.isIndexed&&1||o.size||1,...t};this.attributes[r]=new b3(this.device,c)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:o}=this,c=o[e];return c&&c.forEach(d=>{const a=r[d];a&&a.setNeedsUpdate(a.id,t)}),c}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(Bs(lW,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&Bs(cW,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,Bs(uW,t,r))}}class hW extends Oy{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:o,easing:c}}=this,d=c(e/o);this._value=ig(t,r,d)}}const TS=1e-5;function SS(n,e,t,r,o){const c=e-n,a=(t-e)*o,v=-c*r;return a+v+c+e}function dW(n,e,t,r,o){if(Array.isArray(t)){const c=[];for(let d=0;d<t.length;d++)c[d]=SS(n[d],e[d],t[d],r,o);return c}return SS(n,e,t,r,o)}function AS(n,e){if(Array.isArray(n)){let t=0;for(let r=0;r<n.length;r++){const o=n[r]-e[r];t+=o*o}return Math.sqrt(t)}return Math.abs(n-e)}class fW extends Oy{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:o}=this.settings,{_prevValue:c=e,_currValue:d=e}=this;let a=dW(c,d,t,r,o);const v=AS(a,t),A=AS(a,d);v<TS&&A<TS&&(a=t,this.end()),this._prevValue=d,this._currValue=a}}const pW={interpolation:hW,spring:fW};class mW{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,o){const{transitions:c}=this;if(c.has(e)){const v=c.get(e),{value:A=v.settings.fromValue}=v;t=A,this.remove(e)}if(o=x3(o),!o)return;const d=pW[o.type];if(!d){_r.error(`unsupported transition type '${o.type}'`)();return}const a=new d(this.timeline);a.start({...o,fromValue:t,toValue:r}),c.set(e,a)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function gW(n){const e=n[Ph];for(const t in e){const r=e[t],{validate:o}=r;if(o&&!o(n[t],r))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function _W(n,e){const t=Zb({newProps:n,oldProps:e,propTypes:n[Ph],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=vW(n,e);let o=!1;return r||(o=xW(n,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:o,extensionsChanged:bW(n,e),transitionsChanged:yW(n,e)}}function yW(n,e){if(!n.transitions)return!1;const t={},r=n[Ph];let o=!1;for(const c in n.transitions){const d=r[c],a=d&&d.type;(a==="number"||a==="color"||a==="array")&&gx(n[c],e[c],d)&&(t[c]=!0,o=!0)}return o?t:!1}function Zb({newProps:n,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:o="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${o} changed shallowly`;if(typeof e!="object"||e===null)return`${o} changed shallowly`;for(const c of Object.keys(n))if(!(c in t)){if(!(c in e))return`${o}.${c} added`;const d=gx(n[c],e[c],r[c]);if(d)return`${o}.${c} ${d}`}for(const c of Object.keys(e))if(!(c in t)){if(!(c in n))return`${o}.${c} dropped`;if(!Object.hasOwnProperty.call(n,c)){const d=gx(n[c],e[c],r[c]);if(d)return`${o}.${c} ${d}`}}return!1}function gx(n,e,t){let r=t&&t.equal;return r&&!r(n,e,t)||!r&&(r=n&&e&&n.equals,r&&!r.call(n,e))?"changed deeply":!r&&e!==n?"changed shallowly":null}function vW(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:o}=n;return r?r(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&o&&(t=o(n.data,e.data)||t),t}function xW(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&PS(n,e,"all"))return{all:!0};const t={};let r=!1;for(const o in n.updateTriggers)o!=="all"&&PS(n,e,o)&&(t[o]=!0,r=!0);return r?t:!1}function bW(n,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=n;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let o=0;o<r.length;o++)if(!r[o].equals(t[o]))return!0;return!1}function PS(n,e,t){let r=n.updateTriggers[t];r=r??{};let o=e.updateTriggers[t];return o=o??{},Zb({oldProps:o,newProps:r,triggerName:t})}const wW="count(): argument not an object",TW="count(): argument not a container";function SW(n){if(!PW(n))throw new Error(wW);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(AW(n))return Object.keys(n).length;throw new Error(TW)}function AW(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function PW(n){return n!==null&&typeof n=="object"}function ES(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(o=>o.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const r={...n.inject};for(const o in e.inject)r[o]=(r[o]||"")+e.inject[o];t.inject=r}return t}const EW={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},_x={};function CW(n,e,t,r){if(t instanceof br)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let o=null;t.compressed&&(o={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const c=e.createTexture({...t,sampler:{...EW,...o,...r},mipmaps:!0});return _x[c.id]=n,c}function IW(n,e){!e||!(e instanceof br)||_x[e.id]===n&&(e.delete(),delete _x[e.id])}const MW={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||yx(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Pl(n,e,1)}},accessor:{validate(n,e){const t=uy(n);return t==="function"||t===uy(e.value)},equal(n,e,t){return typeof e=="function"?!0:Pl(n,e,1)}},array:{validate(n,e){return e.optional&&!n||yx(n)},equal(n,e,t){const{compare:r}=t,o=Number.isInteger(r)?r:r?1:0;return r?Pl(n,e,o):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:r}=t,o=Number.isInteger(r)?r:r?1:0;return r?Pl(n,e,o):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:r}=t.props;return r?r(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const r=t.context;return!r||!r.device?null:CW(t.id,r.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{IW(t.id,n)}}};function RW(n){const e={},t={},r={};for(const[o,c]of Object.entries(n)){const d=c?.deprecatedFor;if(d)r[o]=Array.isArray(d)?d:[d];else{const a=kW(o,c);e[o]=a,t[o]=a.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function kW(n,e){switch(uy(e)){case"object":return Cm(n,e);case"array":return Cm(n,{type:"array",value:e,compare:!1});case"boolean":return Cm(n,{type:"boolean",value:e});case"number":return Cm(n,{type:"number",value:e});case"function":return Cm(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Cm(n,e){return"type"in e?{name:n,...MW[e.type],...e}:"value"in e?{name:n,type:uy(e.value),...e}:{name:n,type:"object",value:e}}function yx(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function uy(n){return yx(n)?"array":n===null?"null":typeof n}function DW(n,e){let t;for(let c=e.length-1;c>=0;c--){const d=e[c];"extensions"in d&&(t=d.extensions)}const r=vx(n.constructor,t),o=Object.create(r);o[ly]=n,o[Wd]={},o[wh]={};for(let c=0;c<e.length;++c){const d=e[c];for(const a in d)o[a]=d[a]}return Object.freeze(o),o}const OW="_mergedDefaultProps";function vx(n,e){if(!(n instanceof Fy.constructor))return{};let t=OW;if(e)for(const o of e){const c=o.constructor;c&&(t+=`:${c.extensionName||c.name}`)}const r=I3(n,t);return r||(n[t]=LW(n,e||[]))}function LW(n,e){if(!n.prototype)return null;const r=Object.getPrototypeOf(n),o=vx(r),c=I3(n,"defaultProps")||{},d=RW(c),a=Object.assign(Object.create(null),o,d.defaultProps),v=Object.assign(Object.create(null),o?.[Ph],d.propTypes),A=Object.assign(Object.create(null),o?.[a0],d.deprecatedProps);for(const P of e){const k=vx(P.constructor);k&&(Object.assign(a,k),Object.assign(v,k[Ph]),Object.assign(A,k[a0]))}return FW(a,n),BW(a,v),NW(a,A),a[Ph]=v,a[a0]=A,e.length===0&&!Xb(n,"_propTypes")&&(n._propTypes=v),a}function FW(n,e){const t=UW(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function NW(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(r){const o=`${this.id}: ${t}`;for(const c of e[t])Xb(this,c)||(this[c]=r);_r.deprecated(o,e[t].join("/"))()}})}function BW(n,e){const t={},r={};for(const o in e){const c=e[o],{name:d,value:a}=c;c.async&&(t[d]=a,r[d]=zW(d))}n[fp]=t,n[Wd]={},Object.defineProperties(n,r)}function zW(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||y3(e)?this[Wd][n]=e:this[wh][n]=e},get(){if(this[wh]){if(n in this[wh])return this[wh][n]||this[fp][n];if(n in this[Wd]){const e=this[ly]&&this[ly].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[fp][n]}}return this[fp][n]}}}function Xb(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function I3(n,e){return Xb(n,e)&&n[e]}function UW(n){const e=n.componentName;return e||_r.warn(`${n.name}.componentName not specified`)(),e||n.name}let VW=0;class Fy{constructor(...e){this.props=DW(this,e),this.id=this.props.id,this.count=VW++}clone(e){const{props:t}=this,r={};for(const o in t[fp])o in t[wh]?r[o]=t[wh][o]:o in t[Wd]&&(r[o]=t[Wd][o]);return new this.constructor({...t,...r,...e})}}Fy.componentName="Component";Fy.defaultProps={};const jW=Object.freeze({});class $W{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||jW}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[ly]||this.component;const t=e[wh]||{},r=e[Wd]||e,o=e[fp]||{};for(const c in t){const d=t[c];this._createAsyncPropData(c,o[c]),this._updateAsyncProp(c,d),t[c]=this.getAsyncProp(c)}for(const c in r){const d=r[c];this._createAsyncPropData(c,o[c]),this._updateAsyncProp(c,d)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(y3(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const o=this.asyncProps[e];o&&r>=o.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=t,o.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const o=r.pendingLoadCount;t.then(c=>{this.component&&(c=this._postProcessValue(r,c),this._setAsyncPropValue(e,c,o),this._onResolve(e,c))}).catch(c=>{this._onError(e,c)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const o=r.pendingLoadCount;let c=[],d=0;for await(const a of t){if(!this.component)return;const{dataTransform:v}=this.component.props;v?c=v(a,c):c=c.concat(a),Object.defineProperty(c,"__diff",{enumerable:!1,value:[{startRow:d,endRow:c.length}]}),d=c.length,this._setAsyncPropValue(e,c,o)}this._onResolve(e,c)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const o=this.component&&this.component.props[Ph];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class WW extends $W{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,o=r?.props.fetch;return o?o(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const o=r.props.onDataLoad;e==="data"&&o&&o(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}const HW="layer.changeFlag",ZW="layer.initialize",XW="layer.update",qW="layer.finalize",GW="layer.matched",CS=2**24-1,YW=Object.freeze([]),KW=yg(({oldViewport:n,viewport:e})=>n.equals(e));let wl=new Uint8ClampedArray(0);const JW={data:{type:"data",value:YW,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:r,loadOptions:o,signal:c})=>{const{resourceManager:d}=t.context;o=o||t.getLoadOptions(),r=r||t.props.loaders,c&&(o={...o,fetch:{...o?.fetch,signal:c}});let a=d.contains(n);return!a&&!o&&(d.add({resourceId:n,data:q_(n,r),persistent:!1}),a=!0),a?d.subscribe({resourceId:n,onChange:v=>t.internalState?.reloadAsyncProp(e,v),consumerId:t.id,requestId:e}):q_(n,r,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Vn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ru extends Fy{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Jf.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){xs(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=ZC(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,c,d]=zC(r,t.pixelProjectionMatrix);return e.length===2?[o,c]:[o,c,d]}unproject(e){return xs(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){xs(this.internalState);const r=this.internalState.viewport||this.context.viewport;return I8(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Vn.DEFAULT||e===Vn.LNGLAT||e===Vn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){xs(e instanceof Uint8Array);const[t,r,o]=e;return t+r*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:SW(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=ES(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=ES(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const o of r)t.invalidateAll(o);else t.invalidateAll();if(t){const{props:o}=e,c=this.internalState.hasPickingBuffer,d=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(c!==d){this.internalState.hasPickingBuffer=d;const{pickingColors:a,instancePickingColors:v}=t.attributes,A=a||v;A&&(d&&A.constant&&(A.constant=!1,t.invalidate(A.id)),!A.value&&!d&&(A.constant=!0,A.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!KW({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const r in e)e[r].layoutChanged()&&(t=!0);for(const r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),o=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:o,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const c=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(c)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const o in t)Object.defineProperty(r,o,{value:t[o]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(wl.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>CS&&_r.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),wl=Tp.allocate(wl,t,{size:4,copy:!0,maxCount:Math.max(t,CS)});const o=Math.floor(wl.length/4),c=[0,0,0];for(let d=r;d<o;d++)this.encodePickingColor(d,c),wl[d*4+0]=c[0],wl[d*4+1]=c[1],wl[d*4+2]=c[2],wl[d*4+3]=0}e.value=wl.subarray(0,t*4)}_setModelAttributes(e,t,r=!1){if(!Object.keys(t).length)return;if(r){const a=this.getAttributeManager();e.setBufferLayout(a.getBufferLayouts(e)),t=a.getAttributes()}const o=e.userData?.excludeAttributes||{},c={},d={};for(const a in t){if(o[a])continue;const v=t[a].getValue();for(const A in v){const P=v[A];P instanceof Ar?t[a].settings.isIndexed?e.setIndexBuffer(P):c[A]=P:P&&(d[A]=P)}}e.setAttributes(c),e.setConstantAttributes(d)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:o}=this.getAttributeManager().attributes,c=r||o,d=c&&t.attributes&&t.attributes[c.id];if(d&&d.value){const a=d.value,v=this.encodePickingColor(e);for(let A=0;A<t.length;A++){const P=c.getVertexOffset(A);a[P]===v[0]&&a[P+1]===v[1]&&a[P+2]===v[2]&&this._disablePickingIndex(A)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,o=t||r;if(!o)return;const c=o.getVertexOffset(e),d=o.getVertexOffset(e+1);o.buffer.write(new Uint8Array(d-c),c)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==wl.buffer&&(r.value=wl.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){xs(!this.internalState),xs(Number.isFinite(this.props.coordinateSystem)),Bs(ZW,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new WW({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(_r.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new mW(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Bs(GW,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Bs(XW,this,e),!e)return;const t=this.props,r=this.context,o=this.internalState,c=r.viewport,d=this._updateUniformTransition();o.propsInTransition=d,r.viewport=o.viewport||c,this.props=d;try{const a=this._getUpdateParams(),v=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const P of this.props.extensions)P.updateState.call(this,a,P);this.setNeedsRedraw(),this._updateAttributes();const A=this.getModels()[0]!==v[0];this._postUpdate(a,A)}finally{r.viewport=c,this.props=t,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){Bs(qW,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:o={}}){this._updateAttributeTransition();const c=this.props,d=this.context;this.props=this.internalState.propsInTransition||c;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:a}=this.props,v=a&&a(r)||[0,0];d.device instanceof up&&d.device.setParametersWebGL({polygonOffset:v});for(const A of this.getModels())A.device.type==="webgpu"?A.setParameters({...A.parameters,...o}):A.setParameters(o);if(d.device instanceof up)d.device.withParametersWebGL(o,()=>{const A={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:o,context:d};for(const P of this.props.extensions)P.draw.call(this,A,P);this.draw(A)});else{const A={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:o,context:d};for(const P of this.props.extensions)P.draw.call(this,A,P);this.draw(A)}}finally{this.props=c}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const o in e)if(e[o]){let c=!1;switch(o){case"dataChanged":const d=e[o],a=t[o];d&&Array.isArray(a)&&(t.dataChanged=Array.isArray(d)?a.concat(d):d,c=!0);default:t[o]||(t[o]=e[o],c=!0)}c&&Bs(HW,this,o,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=_W(e,t);if(r.updateTriggersChanged)for(const o in r.updateTriggersChanged)r.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(r.transitionsChanged)for(const o in r.transitionsChanged)this.internalState.uniformTransitions.add(o,t[o],e[o],e.transitions?.[o]);return this.setChangeFlags(r)}validateProps(){gW(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Hb(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:o}=e,c=this.state.model;c?.isInstanced&&c.setInstanceCount(this.getNumInstances());const{autoHighlight:d,highlightedObjectIndex:a,highlightColor:v}=r;if(t||o.autoHighlight!==d||o.highlightedObjectIndex!==a||o.highlightColor!==v){const A={};Array.isArray(v)&&(A.highlightColor=v),(t||o.autoHighlight!==d||a!==o.highlightedObjectIndex)&&(A.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:A})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),o=r?r.getNeedsRedraw(e):!1;if(t=t||o,t)for(const c of this.props.extensions)c.onNeedsRedraw.call(this,c);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Ru.defaultProps=JW;Ru.layerName="Layer";const QW="compositeLayer.renderLayers";class qb extends Ru{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,o)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,o)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:r,visible:o,parameters:c,getPolygonOffset:d,highlightedObjectIndex:a,autoHighlight:v,highlightColor:A,coordinateSystem:P,coordinateOrigin:k,wrapLongitude:L,positionFormat:z,modelMatrix:G,extensions:te,fetch:re,operation:fe,_subLayerProps:ve}=this.props,le={id:"",updateTriggers:{},opacity:t,pickable:r,visible:o,parameters:c,getPolygonOffset:d,highlightedObjectIndex:a,autoHighlight:v,highlightColor:A,coordinateSystem:P,coordinateOrigin:k,wrapLongitude:L,positionFormat:z,modelMatrix:G,extensions:te,fetch:re,operation:fe},Se=ve&&e.id&&ve[e.id],Ne=Se&&Se.updateTriggers,nt=e.id||"sublayer";if(Se){const pt=this.props[Ph],mt=e.type?e.type._propTypes:{};for(const Tt in Se){const Mt=mt[Tt]||pt[Tt];Mt&&Mt.type==="accessor"&&(Se[Tt]=this.getSubLayerAccessor(Se[Tt]))}}Object.assign(le,e,Se),le.id=`${this.props.id}-${nt}`,le.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...Ne};for(const pt of te){const mt=pt.getSubLayerProps.call(this,pt);mt&&Object.assign(le,mt,{updateTriggers:Object.assign(le.updateTriggers,mt.updateTriggers)})}return le}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const o=!r||this.needsUpdate();if(o){const c=this.renderLayers();r=Bb(c,Boolean),this.internalState.subLayers=r}Bs(QW,this,o,r);for(const c of r)c.parent=this}}qb.layerName="CompositeLayer";const f0={bearing:0,pitch:0,position:[0,0,0]},e7={speed:1.2,curve:1.414};class y_ extends QC{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...e7,...e}}interpolateProps(e,t,r){const o=jU(e,t,r,this.opts);for(const c in f0)o[c]=ig(e[c]||f0[c],t[c]||f0[c],r);return o}getDuration(e,t){let{transitionDuration:r}=t;return r==="auto"&&(r=$U(e,t,this.opts)),r}}class M3{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=Tp,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:r={},getGeometry:o,geometryBuffer:c,positionFormat:d,dataChanged:a,normalize:v=!0}=this.opts;if(this.data=t,this.getGeometry=o,this.positionSize=c&&c.size||(d==="XY"?2:3),this.buffers=r,this.normalize=v,c&&(xs(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(c),v||(r.vertexPositions=c)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const A of a)this._rebuildGeometry(A);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?v3(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:r,buffers:o,_attributeDefs:c,typedArrayManager:d}=this;for(const a in c)if(a in o)d.release(r[a]),r[a]=null;else{const v=c[a];v.copy=t,r[a]=d.allocate(r[a],e,v)}}_forEachGeometry(e,t,r){const{data:o,getGeometry:c}=this,{iterable:d,objectInfo:a}=Ly(o,t,r);for(const v of d){a.index++;const A=c?c(v,a):null;e(A,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:r,instanceCount:o}=this;const{data:c,geometryBuffer:d}=this,{startRow:a=0,endRow:v=1/0}=e||{},A={};if(e||(t=[0],r=[0]),this.normalize||!d)this._forEachGeometry((k,L)=>{const z=k&&this.normalizeGeometry(k);A[L]=z,r[L+1]=r[L]+(z?this.getGeometrySize(z):0)},a,v),o=r[r.length-1];else if(r=c.startIndices,o=r[c.length]||0,ArrayBuffer.isView(d))o=o||d.length/this.positionSize;else if(d instanceof Ar){const k=this.positionSize*4;o=o||d.byteLength/k}else if(d.buffer){const k=d.stride||this.positionSize*4;o=o||d.buffer.byteLength/k}else if(d.value){const k=d.value,L=d.stride/k.BYTES_PER_ELEMENT||this.positionSize;o=o||k.length/L}this._allocate(o,!!e),this.indexStarts=t,this.vertexStarts=r,this.instanceCount=o;const P={};this._forEachGeometry((k,L)=>{const z=A[L]||k;P.vertexStart=r[L],P.indexStart=t[L];const G=L<r.length-1?r[L+1]:o;P.geometrySize=G-r[L],P.geometryIndex=L,this.updateGeometryAttributes(z,P)},a,v),this.vertexCount=t[t.length-1]}}const t7=typeof window<"u"?Ae.useLayoutEffect:Ae.useEffect;function hy(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const n7={position:"absolute",zIndex:-1};function R3(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>R3(t,e));if(Ny(n)){if(r7(n))return e.style=n7,Ae.cloneElement(n,e);if(i7(n))return Ae.cloneElement(n,e)}return n}function Ny(n){return n&&typeof n=="object"&&"type"in n||!1}function r7(n){return n.props?.mapStyle}function i7(n){const e=n.type;return e&&e.deckGLViewProps}function xx(n){if(typeof n=="function")return Ae.createElement(Pp,{},n);if(Array.isArray(n))return n.map(xx);if(Ny(n)){if(n.type===Ae.Fragment)return xx(n.props.children);if(hy(n.type,Pp))return n}return n}function s7({children:n,layers:e=[],views:t=null}){const r=[],o=[],c={};return Ae.Children.forEach(xx(n),d=>{if(Ny(d)){const a=d.type;if(hy(a,Ru)){const v=o7(a,d.props);o.push(v)}else r.push(d);if(hy(a,Pp)&&a!==Pp&&d.props.id){const v=new a(d.props);c[v.id]=v}}else d&&r.push(d)}),Object.keys(c).length>0&&(Array.isArray(t)?t.forEach(d=>{c[d.id]=d}):t&&(c[t.id]=t),t=Object.values(c)),e=o.length>0?[...o,...e]:e,{layers:e,children:r,views:t}}function o7(n,e){const t={},r=n.defaultProps||{};for(const o in e)r[o]!==e[o]&&(t[o]=e[o]);return new n(t)}const a7=Ae.createContext();function l7({children:n,deck:e,ContextProvider:t=a7.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const o={},c=r.views[0].id;for(const d of n){let a=c,v=d;Ny(d)&&hy(d.type,Pp)&&(a=d.props.id||c,v=d.props.children);const A=r.getViewport(a),P=r.getViewState(a);if(A){P.padding=A.padding;const{x:k,y:L,width:z,height:G}=A;v=R3(v,{x:k,y:L,width:z,height:G,viewport:A,viewState:P}),o[a]||(o[a]={viewport:A,children:[]}),o[a].children.push(v)}}return Object.keys(o).map(d=>{const{viewport:a,children:v}=o[d],{x:A,y:P,width:k,height:L}=a,z={position:"absolute",left:A,top:P,width:k,height:L},G=`view-${d}`,te=Ae.createElement("div",{key:G,id:G,style:z},...v),re={deck:e,viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:ve=>{ve.viewId=d,e._onViewStateChange(ve)},widgets:[]},fe=`view-${d}-context`;return Ae.createElement(t,{key:fe,value:re},te)})}const c7={mixBlendMode:null};function u7({width:n,height:e,style:t}){const r={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},o={left:0,top:0};if(t)for(const c in t)c in c7?o[c]=t[c]:r[c]=t[c];return{containerStyle:r,canvasStyle:o}}function h7(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function k3(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function d7(n,e,t){const r=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:o=>{n.redrawReason=o;const c=r.getViewports();n.lastRenderedViewports!==c?n.forceUpdate():k3(n)}});return r}function f7(n,e){const[t,r]=Ae.useState(0),c=Ae.useRef({control:null,version:t,forceUpdate:()=>r(Ne=>Ne+1)}).current,d=Ae.useRef(null),a=Ae.useRef(null),v=Ae.useMemo(()=>s7(n),[n.layers,n.views,n.children]);let A=!0;const P=Ne=>A&&n.viewState?(c.viewStateUpdateRequested=Ne,null):(c.viewStateUpdateRequested=null,n.onViewStateChange?.(Ne)),k=Ne=>{A?c.interactionStateUpdateRequested=Ne:(c.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(Ne))},L=Ae.useMemo(()=>{const Ne={widgets:[],...n,style:null,width:"100%",height:"100%",parent:d.current,canvas:a.current,layers:v.layers,views:v.views,onViewStateChange:P,onInteractionStateChange:k};return delete Ne._customRender,c.deck&&c.deck.setProps(Ne),Ne},[n]);Ae.useEffect(()=>{const Ne=n.Deck||Wb;return c.deck=d7(c,Ne,{...L,parent:d.current,canvas:a.current}),()=>c.deck?.finalize()},[]),t7(()=>{k3(c);const{viewStateUpdateRequested:Ne,interactionStateUpdateRequested:nt}=c;Ne&&P(Ne),nt&&k(nt)}),Ae.useImperativeHandle(e,()=>h7(c),[]);const z=c.deck&&c.deck.isInitialized?c.deck.getViewports():void 0,{ContextProvider:G,width:te="100%",height:re="100%",id:fe,style:ve}=n,{containerStyle:le,canvasStyle:Se}=Ae.useMemo(()=>u7({width:te,height:re,style:ve}),[te,re,ve]);if(!c.viewStateUpdateRequested&&c.lastRenderedViewports===z||c.version!==t){c.lastRenderedViewports=z,c.version=t;const Ne=l7({children:v.children,deck:c.deck,ContextProvider:G}),nt=Ae.createElement("canvas",{key:"canvas",id:fe||"deckgl-overlay",ref:a,style:Se});c.control=Ae.createElement("div",{id:`${fe||"deckgl"}-wrapper`,ref:d,style:le},[nt,Ne])}return A=!1,c.control}const p7=Ae.forwardRef(f7),m7=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function g7(n,e=!1,t=Float32Array){let r;if(Number.isFinite(n[0]))r=new t(n);else{r=new t(n.length*4);let o=0;for(let c=0;c<n.length;c++){const d=n[c];r[o++]=d[0],r[o++]=d[1],r[o++]=d[2],r[o++]=Number.isFinite(d[3])?d[3]:255}}if(e)for(let o=0;o<r.length;o++)r[o]/=255;return r}const IS=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,_7={name:"icon",vs:IS,fs:IS,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},y7=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,v7=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,x7=1024,b7=4,MS=()=>{},RS={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},w7={x:0,y:0,width:0,height:0};function T7(n){return Math.pow(2,Math.ceil(Math.log2(n)))}function S7(n,e,t,r){const o=Math.min(t/e.width,r/e.height),c=Math.floor(e.width*o),d=Math.floor(e.height*o);return o===1?{image:e,width:c,height:d}:(n.canvas.height=d,n.canvas.width=c,n.clearRect(0,0,c,d),n.drawImage(e,0,0,e.width,e.height,0,0,c,d),{image:n.canvas,width:c,height:d})}function lg(n){return n&&(n.id||n.url)}function A7(n,e,t,r){const{width:o,height:c,device:d}=n,a=d.createTexture({format:"rgba8unorm",width:e,height:t,sampler:r,mipmaps:!0}),v=d.createCommandEncoder();return v.copyTextureToTexture({sourceTexture:n,destinationTexture:a,width:o,height:c}),v.finish(),n.destroy(),a}function kS(n,e,t){for(let r=0;r<e.length;r++){const{icon:o,xOffset:c}=e[r],d=lg(o);n[d]={...o,x:c,y:t}}}function P7({icons:n,buffer:e,mapping:t={},xOffset:r=0,yOffset:o=0,rowHeight:c=0,canvasWidth:d}){let a=[];for(let v=0;v<n.length;v++){const A=n[v],P=lg(A);if(!t[P]){const{height:k,width:L}=A;r+L+e>d&&(kS(t,a,o),r=0,o=c+o+e,c=0,a=[]),a.push({icon:A,xOffset:r}),r=r+L+e,c=Math.max(c,k)}}return a.length>0&&kS(t,a,o),{mapping:t,rowHeight:c,xOffset:r,yOffset:o,canvasWidth:d,canvasHeight:T7(c+o+e)}}function E7(n,e,t){if(!n||!e)return null;t=t||{};const r={},{iterable:o,objectInfo:c}=Ly(n);for(const d of o){c.index++;const a=e(d,c),v=lg(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[v]&&(!t[v]||a.url!==t[v].url)&&(r[v]={...a,source:d,sourceIndex:c.index})}return r}class C7{constructor(e,{onUpdate:t=MS,onError:r=MS}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=b7,this._canvasWidth=x7,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=r}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?lg(e):e;return this._mapping[t]||w7}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:o,textureParameters:c}){e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),o&&(this._mapping=o),r&&(this._texture?.delete(),this._texture=null,this._externalTexture=r),c&&(this._samplerParameters=c)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(E7(e,t,this._mapping)||{});if(r.length>0){const{mapping:o,xOffset:c,yOffset:d,rowHeight:a,canvasHeight:v}=P7({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=o,this._xOffset=c,this._yOffset=d,this._canvasHeight=v,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||RS,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=A7(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||RS)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,q_(r.url,this._loadOptions).then(o=>{const c=lg(r),d=this._mapping[c],{x:a,y:v,width:A,height:P}=d,{image:k,width:L,height:z}=S7(t,o,A,P);this._texture?.copyExternalImage({image:k,x:a+(A-L)/2,y:v+(P-z)/2,width:L,height:z}),d.width=L,d.height=z,this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}}const D3=[0,0,0,255],I7={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:n=>n.position},getIcon:{type:"accessor",value:n=>n.icon},getColor:{type:"accessor",value:D3},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Gb extends Ru{getShaders(){return super.getShaders({vs:y7,fs:v7,modules:[Dp,ky,_7]})}initializeState(){this.state={iconManager:new C7(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:D3},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:o}=e,c=this.getAttributeManager(),{iconAtlas:d,iconMapping:a,data:v,getIcon:A,textureParameters:P}=t,{iconManager:k}=this.state;if(typeof d=="string")return;const L=d||this.internalState.isAsyncPropLoading("iconAtlas");k.setProps({loadOptions:t.loadOptions,autoPacking:!L,iconAtlas:d,iconMapping:L?a:null,textureParameters:P}),L?r.iconMapping!==t.iconMapping&&c.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&k.packIcons(v,A),o.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),c.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:r,sizeMaxPixels:o,sizeUnits:c,billboard:d,alphaCutoff:a}=this.props,{iconManager:v}=this.state,A=v.getTexture();if(A){const P=this.state.model,k={iconsTexture:A,iconsTextureDim:[A.width,A.height],sizeUnits:Mh[c],sizeScale:t,sizeMinPixels:r,sizeMaxPixels:o,billboard:d,alphaCutoff:a};P.shaderInputs.setProps({icon:k}),P.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Oa(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ag({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):_r.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:r,anchorX:o=t/2,anchorY:c=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-o,r/2-c]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:r,width:o,height:c}=this.state.iconManager.getIconMapping(e);return[t,r,o,c]}}Gb.defaultProps=I7;Gb.layerName="IconLayer";const DS=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,M7={name:"scatterplot",vs:DS,fs:DS,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},R7=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,k7=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,D7=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,OS=[0,0,0,255],O7={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:OS},getLineColor:{type:"accessor",value:OS},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class dy extends Ru{getShaders(){return super.getShaders({vs:R7,fs:k7,source:D7,modules:[Dp,ky,M7]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:o,radiusMaxPixels:c,stroked:d,filled:a,billboard:v,antialiasing:A,lineWidthUnits:P,lineWidthScale:k,lineWidthMinPixels:L,lineWidthMaxPixels:z}=this.props,G={stroked:d,filled:a,billboard:v,antialiasing:A,radiusUnits:Mh[t],radiusScale:r,radiusMinPixels:o,radiusMaxPixels:c,lineWidthUnits:Mh[P],lineWidthScale:k,lineWidthMinPixels:L,lineWidthMaxPixels:z},te=this.state.model;te.shaderInputs.setProps({scatterplot:G}),te.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Oa(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ag({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}dy.defaultProps=O7;dy.layerName="ScatterplotLayer";const O3={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function L3(n,e,t={}){return L7(n,t)!==e?(N7(n,t),!0):!1}function L7(n,e={}){return Math.sign(F7(n,e))}const LS={x:0,y:1,z:2};function F7(n,e={}){const{start:t=0,end:r=n.length,plane:o="xy"}=e,c=e.size||2;let d=0;const a=LS[o[0]],v=LS[o[1]];for(let A=t,P=r-c;A<r;A+=c)d+=(n[A+a]-n[P+a])*(n[A+v]+n[P+v]),P=A;return d/2}function N7(n,e){const{start:t=0,end:r=n.length,size:o=2}=e,c=(r-t)/o,d=Math.floor(c/2);for(let a=0;a<d;++a){const v=t+a*o,A=t+(c-1-a)*o;for(let P=0;P<o;++P){const k=n[v+P];n[v+P]=n[A+P],n[A+P]=k}}}function El(n,e){const t=e.length,r=n.length;if(r>0){let o=!0;for(let c=0;c<t;c++)if(n[r-t+c]!==e[c]){o=!1;break}if(o)return!1}for(let o=0;o<t;o++)n[r+o]=e[o];return!0}function bx(n,e){const t=e.length;for(let r=0;r<t;r++)n[r]=e[r]}function cg(n,e,t,r,o=[]){const c=r+e*t;for(let d=0;d<t;d++)o[d]=n[c+d];return o}function wx(n,e,t,r,o=[]){let c,d;if(t&8)c=(r[3]-n[1])/(e[1]-n[1]),d=3;else if(t&4)c=(r[1]-n[1])/(e[1]-n[1]),d=1;else if(t&2)c=(r[2]-n[0])/(e[0]-n[0]),d=2;else if(t&1)c=(r[0]-n[0])/(e[0]-n[0]),d=0;else return null;for(let a=0;a<n.length;a++)o[a]=(d&1)===a?r[d]:c*(e[a]-n[a])+n[a];return o}function N_(n,e){let t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}function F3(n,e){const{size:t=2,broken:r=!1,gridResolution:o=10,gridOffset:c=[0,0],startIndex:d=0,endIndex:a=n.length}=e||{},v=(a-d)/t;let A=[];const P=[A],k=cg(n,0,t,d);let L,z;const G=B3(k,o,c,[]),te=[];El(A,k);for(let re=1;re<v;re++){for(L=cg(n,re,t,d,L),z=N_(L,G);z;){wx(k,L,z,G,te);const fe=N_(te,G);fe&&(wx(k,te,fe,G,te),z=fe),El(A,te),bx(k,te),z7(G,o,z),r&&A.length>t&&(A=[],P.push(A),El(A,k)),z=N_(L,G)}El(A,L),bx(k,L)}return r?P:P[0]}const FS=0,B7=1;function N3(n,e=null,t){if(!n.length)return[];const{size:r=2,gridResolution:o=10,gridOffset:c=[0,0],edgeTypes:d=!1}=t||{},a=[],v=[{pos:n,types:d?new Array(n.length/r).fill(B7):null,holes:e||[]}],A=[[],[]];let P=[];for(;v.length;){const{pos:k,types:L,holes:z}=v.shift();U7(k,r,z[0]||k.length,A),P=B3(A[0],o,c,P);const G=N_(A[1],P);if(G){let te=NS(k,L,r,0,z[0]||k.length,P,G);const re={pos:te[0].pos,types:te[0].types,holes:[]},fe={pos:te[1].pos,types:te[1].types,holes:[]};v.push(re,fe);for(let ve=0;ve<z.length;ve++)te=NS(k,L,r,z[ve],z[ve+1]||k.length,P,G),te[0]&&(re.holes.push(re.pos.length),re.pos=v_(re.pos,te[0].pos),d&&(re.types=v_(re.types,te[0].types))),te[1]&&(fe.holes.push(fe.pos.length),fe.pos=v_(fe.pos,te[1].pos),d&&(fe.types=v_(fe.types,te[1].types)))}else{const te={positions:k};d&&(te.edgeTypes=L),z.length&&(te.holeIndices=z),a.push(te)}}return a}function NS(n,e,t,r,o,c,d){const a=(o-r)/t,v=[],A=[],P=[],k=[],L=[];let z,G,te;const re=cg(n,a-1,t,r);let fe=Math.sign(d&8?re[1]-c[3]:re[0]-c[2]),ve=e&&e[a-1],le=0,Se=0;for(let Ne=0;Ne<a;Ne++)z=cg(n,Ne,t,r,z),G=Math.sign(d&8?z[1]-c[3]:z[0]-c[2]),te=e&&e[r/t+Ne],G&&fe&&fe!==G&&(wx(re,z,d,c,L),El(v,L)&&P.push(ve),El(A,L)&&k.push(ve)),G<=0?(El(v,z)&&P.push(te),le-=G):P.length&&(P[P.length-1]=FS),G>=0?(El(A,z)&&k.push(te),Se+=G):k.length&&(k[k.length-1]=FS),bx(re,z),fe=G,ve=te;return[le?{pos:v,types:e&&P}:null,Se?{pos:A,types:e&&k}:null]}function B3(n,e,t,r){const o=Math.floor((n[0]-t[0])/e)*e+t[0],c=Math.floor((n[1]-t[1])/e)*e+t[1];return r[0]=o,r[1]=c,r[2]=o+e,r[3]=c+e,r}function z7(n,e,t){t&8?(n[1]+=e,n[3]+=e):t&4?(n[1]-=e,n[3]-=e):t&2?(n[0]+=e,n[2]+=e):t&1&&(n[0]-=e,n[2]-=e)}function U7(n,e,t,r){let o=1/0,c=-1/0,d=1/0,a=-1/0;for(let v=0;v<t;v+=e){const A=n[v],P=n[v+1];o=A<o?A:o,c=A>c?A:c,d=P<d?P:d,a=P>a?P:a}return r[0][0]=o,r[0][1]=d,r[1][0]=c,r[1][1]=a,r}function v_(n,e){for(let t=0;t<e.length;t++)n.push(e[t]);return n}const V7=85.051129;function j7(n,e){const{size:t=2,startIndex:r=0,endIndex:o=n.length,normalize:c=!0}=e||{},d=n.slice(r,o);z3(d,t,0,o-r);const a=F3(d,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(c)for(const v of a)U3(v,t);return a}function $7(n,e=null,t){const{size:r=2,normalize:o=!0,edgeTypes:c=!1}=t||{};e=e||[];const d=[],a=[];let v=0,A=0;for(let k=0;k<=e.length;k++){const L=e[k]||n.length,z=A,G=W7(n,r,v,L);for(let te=G;te<L;te++)d[A++]=n[te];for(let te=v;te<G;te++)d[A++]=n[te];z3(d,r,z,A),H7(d,r,z,A,t?.maxLatitude),v=L,a[k]=A}a.pop();const P=N3(d,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:c});if(o)for(const k of P)U3(k.positions,r);return P}function W7(n,e,t,r){let o=-1,c=-1;for(let d=t+1;d<r;d+=e){const a=Math.abs(n[d]);a>o&&(o=a,c=d-1)}return c}function H7(n,e,t,r,o=V7){const c=n[t],d=n[r-e];if(Math.abs(c-d)>180){const a=cg(n,0,e,t);a[0]+=Math.round((d-c)/360)*360,El(n,a),a[1]=Math.sign(a[1])*o,El(n,a),a[0]=c,El(n,a)}}function z3(n,e,t,r){let o=n[0],c;for(let d=t;d<r;d+=e){c=n[d];const a=c-o;(a>180||a<-180)&&(c-=Math.round(a/360)*360),n[d]=o=c}}function U3(n,e){let t;const r=n.length/e;for(let c=0;c<r&&(t=n[c*e],(t+180)%360===0);c++);const o=-Math.round(t/360)*360;if(o!==0)for(let c=0;c<r;c++)n[c*e]+=o}function Z7(n,e,t,r){let o;if(Array.isArray(n[0])){const c=n.length*e;o=new Array(c);for(let d=0;d<n.length;d++)for(let a=0;a<e;a++)o[d*e+a]=n[d][a]||0}else o=n;return t?F3(o,{size:e,gridResolution:t}):r?j7(o,{size:e}):o}const X7=1,q7=2,p0=4;class G7 extends M3{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Z7(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(BS(e)){let r=0;for(const o of e)r+=this.getGeometrySize(o);return r}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&BS(e))for(const r of e){const o=this.getGeometrySize(r);t.geometrySize=o,this.updateGeometryAttributes(r,t),t.vertexStart+=o}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const r=this.attributes.segmentTypes,o=e?this.isClosed(e):!1,{vertexStart:c,geometrySize:d}=t;r.fill(0,c,c+d),o?(r[c]=p0,r[c+d-2]=p0):(r[c]+=X7,r[c+d-2]+=q7),r[c+d-1]=p0}_updatePositions(e,t){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:o,geometrySize:c}=t,d=new Array(3);for(let a=o,v=0;v<c;a++,v++)this.getPointOnPath(e,v,d),r[a*3]=d[0],r[a*3+1]=d[1],r[a*3+2]=d[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,r=[]){const{positionSize:o}=this;t*o>=e.length&&(t+=1-e.length/o);const c=t*o;return r[0]=e[c],r[1]=e[c+1],r[2]=o===3&&e[c+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,r=e.length-t;return e[0]===e[r]&&e[1]===e[r+1]&&(t===2||e[2]===e[r+2])}}function BS(n){return Array.isArray(n[0])}const zS=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,Y7={name:"path",vs:zS,fs:zS,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},K7=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,J7=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,V3=[0,0,0,255],Q7={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:V3},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},m0={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class Yb extends Ru{getShaders(){return super.getShaders({vs:K7,fs:J7,modules:[Dp,ky,Y7]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:m0,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:m0,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:m0,defaultValue:V3},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:o,target:c})=>this.encodePickingColor(r&&r.__source?r.__source.index:o,c)}}),this.setState({pathTesselator:new G7({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:r}=e,o=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:d}=this.state,a=t.data.attributes||{};d.updateGeometry({data:t.data,geometryBuffer:a.getPath,buffers:a,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:d.instanceCount,startIndices:d.vertexStarts}),r.dataChanged||o.invalidateAll()}r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,o=this.props.data;return o[0]&&o[0].__source&&(t.object=o.find(c=>c.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:r,billboard:o,miterLimit:c,widthUnits:d,widthScale:a,widthMinPixels:v,widthMaxPixels:A}=this.props,P=this.state.model,k={jointType:Number(t),capType:Number(r),billboard:o,widthUnits:Mh[d],widthScale:a,miterLimit:c,widthMinPixels:v,widthMaxPixels:A};P.shaderInputs.setProps({path:k}),P.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Oa(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ag({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}Yb.defaultProps=Q7;Yb.layerName="PathLayer";var x_={exports:{}},US;function e9(){if(US)return x_.exports;US=1,x_.exports=n,x_.exports.default=n;function n(Ee,Oe,me){me=me||2;var ze=Oe&&Oe.length,$e=ze?Oe[0]*me:Ee.length,ue=e(Ee,0,$e,me,!0),De=[];if(!ue||ue.next===ue.prev)return De;var dt,Et,kt,ht,vt,ut,Bt;if(ze&&(ue=v(Ee,Oe,ue,me)),Ee.length>80*me){dt=kt=Ee[0],Et=ht=Ee[1];for(var Wt=me;Wt<$e;Wt+=me)vt=Ee[Wt],ut=Ee[Wt+1],vt<dt&&(dt=vt),ut<Et&&(Et=ut),vt>kt&&(kt=vt),ut>ht&&(ht=ut);Bt=Math.max(kt-dt,ht-Et),Bt=Bt!==0?32767/Bt:0}return r(ue,De,me,dt,Et,Bt,0),De}function e(Ee,Oe,me,ze,$e){var ue,De;if($e===Rn(Ee,Oe,me,ze)>0)for(ue=Oe;ue<me;ue+=ze)De=hn(ue,Ee[ue],Ee[ue+1],De);else for(ue=me-ze;ue>=Oe;ue-=ze)De=hn(ue,Ee[ue],Ee[ue+1],De);return De&&Se(De,De.next)&&(on(De),De=De.next),De}function t(Ee,Oe){if(!Ee)return Ee;Oe||(Oe=Ee);var me=Ee,ze;do if(ze=!1,!me.steiner&&(Se(me,me.next)||le(me.prev,me,me.next)===0)){if(on(me),me=Oe=me.prev,me===me.next)break;ze=!0}else me=me.next;while(ze||me!==Oe);return Oe}function r(Ee,Oe,me,ze,$e,ue,De){if(Ee){!De&&ue&&z(Ee,ze,$e,ue);for(var dt=Ee,Et,kt;Ee.prev!==Ee.next;){if(Et=Ee.prev,kt=Ee.next,ue?c(Ee,ze,$e,ue):o(Ee)){Oe.push(Et.i/me|0),Oe.push(Ee.i/me|0),Oe.push(kt.i/me|0),on(Ee),Ee=kt.next,dt=kt.next;continue}if(Ee=kt,Ee===dt){De?De===1?(Ee=d(t(Ee),Oe,me),r(Ee,Oe,me,ze,$e,ue,2)):De===2&&a(Ee,Oe,me,ze,$e,ue):r(t(Ee),Oe,me,ze,$e,ue,1);break}}}}function o(Ee){var Oe=Ee.prev,me=Ee,ze=Ee.next;if(le(Oe,me,ze)>=0)return!1;for(var $e=Oe.x,ue=me.x,De=ze.x,dt=Oe.y,Et=me.y,kt=ze.y,ht=$e<ue?$e<De?$e:De:ue<De?ue:De,vt=dt<Et?dt<kt?dt:kt:Et<kt?Et:kt,ut=$e>ue?$e>De?$e:De:ue>De?ue:De,Bt=dt>Et?dt>kt?dt:kt:Et>kt?Et:kt,Wt=ze.next;Wt!==Oe;){if(Wt.x>=ht&&Wt.x<=ut&&Wt.y>=vt&&Wt.y<=Bt&&fe($e,dt,ue,Et,De,kt,Wt.x,Wt.y)&&le(Wt.prev,Wt,Wt.next)>=0)return!1;Wt=Wt.next}return!0}function c(Ee,Oe,me,ze){var $e=Ee.prev,ue=Ee,De=Ee.next;if(le($e,ue,De)>=0)return!1;for(var dt=$e.x,Et=ue.x,kt=De.x,ht=$e.y,vt=ue.y,ut=De.y,Bt=dt<Et?dt<kt?dt:kt:Et<kt?Et:kt,Wt=ht<vt?ht<ut?ht:ut:vt<ut?vt:ut,jn=dt>Et?dt>kt?dt:kt:Et>kt?Et:kt,Wn=ht>vt?ht>ut?ht:ut:vt>ut?vt:ut,qn=te(Bt,Wt,Oe,me,ze),Jn=te(jn,Wn,Oe,me,ze),pn=Ee.prevZ,mn=Ee.nextZ;pn&&pn.z>=qn&&mn&&mn.z<=Jn;){if(pn.x>=Bt&&pn.x<=jn&&pn.y>=Wt&&pn.y<=Wn&&pn!==$e&&pn!==De&&fe(dt,ht,Et,vt,kt,ut,pn.x,pn.y)&&le(pn.prev,pn,pn.next)>=0||(pn=pn.prevZ,mn.x>=Bt&&mn.x<=jn&&mn.y>=Wt&&mn.y<=Wn&&mn!==$e&&mn!==De&&fe(dt,ht,Et,vt,kt,ut,mn.x,mn.y)&&le(mn.prev,mn,mn.next)>=0))return!1;mn=mn.nextZ}for(;pn&&pn.z>=qn;){if(pn.x>=Bt&&pn.x<=jn&&pn.y>=Wt&&pn.y<=Wn&&pn!==$e&&pn!==De&&fe(dt,ht,Et,vt,kt,ut,pn.x,pn.y)&&le(pn.prev,pn,pn.next)>=0)return!1;pn=pn.prevZ}for(;mn&&mn.z<=Jn;){if(mn.x>=Bt&&mn.x<=jn&&mn.y>=Wt&&mn.y<=Wn&&mn!==$e&&mn!==De&&fe(dt,ht,Et,vt,kt,ut,mn.x,mn.y)&&le(mn.prev,mn,mn.next)>=0)return!1;mn=mn.nextZ}return!0}function d(Ee,Oe,me){var ze=Ee;do{var $e=ze.prev,ue=ze.next.next;!Se($e,ue)&&Ne($e,ze,ze.next,ue)&&Tt($e,ue)&&Tt(ue,$e)&&(Oe.push($e.i/me|0),Oe.push(ze.i/me|0),Oe.push(ue.i/me|0),on(ze),on(ze.next),ze=Ee=ue),ze=ze.next}while(ze!==Ee);return t(ze)}function a(Ee,Oe,me,ze,$e,ue){var De=Ee;do{for(var dt=De.next.next;dt!==De.prev;){if(De.i!==dt.i&&ve(De,dt)){var Et=Zt(De,dt);De=t(De,De.next),Et=t(Et,Et.next),r(De,Oe,me,ze,$e,ue,0),r(Et,Oe,me,ze,$e,ue,0);return}dt=dt.next}De=De.next}while(De!==Ee)}function v(Ee,Oe,me,ze){var $e=[],ue,De,dt,Et,kt;for(ue=0,De=Oe.length;ue<De;ue++)dt=Oe[ue]*ze,Et=ue<De-1?Oe[ue+1]*ze:Ee.length,kt=e(Ee,dt,Et,ze,!1),kt===kt.next&&(kt.steiner=!0),$e.push(re(kt));for($e.sort(A),ue=0;ue<$e.length;ue++)me=P($e[ue],me);return me}function A(Ee,Oe){return Ee.x-Oe.x}function P(Ee,Oe){var me=k(Ee,Oe);if(!me)return Oe;var ze=Zt(me,Ee);return t(ze,ze.next),t(me,me.next)}function k(Ee,Oe){var me=Oe,ze=Ee.x,$e=Ee.y,ue=-1/0,De;do{if($e<=me.y&&$e>=me.next.y&&me.next.y!==me.y){var dt=me.x+($e-me.y)*(me.next.x-me.x)/(me.next.y-me.y);if(dt<=ze&&dt>ue&&(ue=dt,De=me.x<me.next.x?me:me.next,dt===ze))return De}me=me.next}while(me!==Oe);if(!De)return null;var Et=De,kt=De.x,ht=De.y,vt=1/0,ut;me=De;do ze>=me.x&&me.x>=kt&&ze!==me.x&&fe($e<ht?ze:ue,$e,kt,ht,$e<ht?ue:ze,$e,me.x,me.y)&&(ut=Math.abs($e-me.y)/(ze-me.x),Tt(me,Ee)&&(ut<vt||ut===vt&&(me.x>De.x||me.x===De.x&&L(De,me)))&&(De=me,vt=ut)),me=me.next;while(me!==Et);return De}function L(Ee,Oe){return le(Ee.prev,Ee,Oe.prev)<0&&le(Oe.next,Ee,Ee.next)<0}function z(Ee,Oe,me,ze){var $e=Ee;do $e.z===0&&($e.z=te($e.x,$e.y,Oe,me,ze)),$e.prevZ=$e.prev,$e.nextZ=$e.next,$e=$e.next;while($e!==Ee);$e.prevZ.nextZ=null,$e.prevZ=null,G($e)}function G(Ee){var Oe,me,ze,$e,ue,De,dt,Et,kt=1;do{for(me=Ee,Ee=null,ue=null,De=0;me;){for(De++,ze=me,dt=0,Oe=0;Oe<kt&&(dt++,ze=ze.nextZ,!!ze);Oe++);for(Et=kt;dt>0||Et>0&&ze;)dt!==0&&(Et===0||!ze||me.z<=ze.z)?($e=me,me=me.nextZ,dt--):($e=ze,ze=ze.nextZ,Et--),ue?ue.nextZ=$e:Ee=$e,$e.prevZ=ue,ue=$e;me=ze}ue.nextZ=null,kt*=2}while(De>1);return Ee}function te(Ee,Oe,me,ze,$e){return Ee=(Ee-me)*$e|0,Oe=(Oe-ze)*$e|0,Ee=(Ee|Ee<<8)&16711935,Ee=(Ee|Ee<<4)&252645135,Ee=(Ee|Ee<<2)&858993459,Ee=(Ee|Ee<<1)&1431655765,Oe=(Oe|Oe<<8)&16711935,Oe=(Oe|Oe<<4)&252645135,Oe=(Oe|Oe<<2)&858993459,Oe=(Oe|Oe<<1)&1431655765,Ee|Oe<<1}function re(Ee){var Oe=Ee,me=Ee;do(Oe.x<me.x||Oe.x===me.x&&Oe.y<me.y)&&(me=Oe),Oe=Oe.next;while(Oe!==Ee);return me}function fe(Ee,Oe,me,ze,$e,ue,De,dt){return($e-De)*(Oe-dt)>=(Ee-De)*(ue-dt)&&(Ee-De)*(ze-dt)>=(me-De)*(Oe-dt)&&(me-De)*(ue-dt)>=($e-De)*(ze-dt)}function ve(Ee,Oe){return Ee.next.i!==Oe.i&&Ee.prev.i!==Oe.i&&!mt(Ee,Oe)&&(Tt(Ee,Oe)&&Tt(Oe,Ee)&&Mt(Ee,Oe)&&(le(Ee.prev,Ee,Oe.prev)||le(Ee,Oe.prev,Oe))||Se(Ee,Oe)&&le(Ee.prev,Ee,Ee.next)>0&&le(Oe.prev,Oe,Oe.next)>0)}function le(Ee,Oe,me){return(Oe.y-Ee.y)*(me.x-Oe.x)-(Oe.x-Ee.x)*(me.y-Oe.y)}function Se(Ee,Oe){return Ee.x===Oe.x&&Ee.y===Oe.y}function Ne(Ee,Oe,me,ze){var $e=pt(le(Ee,Oe,me)),ue=pt(le(Ee,Oe,ze)),De=pt(le(me,ze,Ee)),dt=pt(le(me,ze,Oe));return!!($e!==ue&&De!==dt||$e===0&&nt(Ee,me,Oe)||ue===0&&nt(Ee,ze,Oe)||De===0&&nt(me,Ee,ze)||dt===0&&nt(me,Oe,ze))}function nt(Ee,Oe,me){return Oe.x<=Math.max(Ee.x,me.x)&&Oe.x>=Math.min(Ee.x,me.x)&&Oe.y<=Math.max(Ee.y,me.y)&&Oe.y>=Math.min(Ee.y,me.y)}function pt(Ee){return Ee>0?1:Ee<0?-1:0}function mt(Ee,Oe){var me=Ee;do{if(me.i!==Ee.i&&me.next.i!==Ee.i&&me.i!==Oe.i&&me.next.i!==Oe.i&&Ne(me,me.next,Ee,Oe))return!0;me=me.next}while(me!==Ee);return!1}function Tt(Ee,Oe){return le(Ee.prev,Ee,Ee.next)<0?le(Ee,Oe,Ee.next)>=0&&le(Ee,Ee.prev,Oe)>=0:le(Ee,Oe,Ee.prev)<0||le(Ee,Ee.next,Oe)<0}function Mt(Ee,Oe){var me=Ee,ze=!1,$e=(Ee.x+Oe.x)/2,ue=(Ee.y+Oe.y)/2;do me.y>ue!=me.next.y>ue&&me.next.y!==me.y&&$e<(me.next.x-me.x)*(ue-me.y)/(me.next.y-me.y)+me.x&&(ze=!ze),me=me.next;while(me!==Ee);return ze}function Zt(Ee,Oe){var me=new nn(Ee.i,Ee.x,Ee.y),ze=new nn(Oe.i,Oe.x,Oe.y),$e=Ee.next,ue=Oe.prev;return Ee.next=Oe,Oe.prev=Ee,me.next=$e,$e.prev=me,ze.next=me,me.prev=ze,ue.next=ze,ze.prev=ue,ze}function hn(Ee,Oe,me,ze){var $e=new nn(Ee,Oe,me);return ze?($e.next=ze.next,$e.prev=ze,ze.next.prev=$e,ze.next=$e):($e.prev=$e,$e.next=$e),$e}function on(Ee){Ee.next.prev=Ee.prev,Ee.prev.next=Ee.next,Ee.prevZ&&(Ee.prevZ.nextZ=Ee.nextZ),Ee.nextZ&&(Ee.nextZ.prevZ=Ee.prevZ)}function nn(Ee,Oe,me){this.i=Ee,this.x=Oe,this.y=me,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}n.deviation=function(Ee,Oe,me,ze){var $e=Oe&&Oe.length,ue=$e?Oe[0]*me:Ee.length,De=Math.abs(Rn(Ee,0,ue,me));if($e)for(var dt=0,Et=Oe.length;dt<Et;dt++){var kt=Oe[dt]*me,ht=dt<Et-1?Oe[dt+1]*me:Ee.length;De-=Math.abs(Rn(Ee,kt,ht,me))}var vt=0;for(dt=0;dt<ze.length;dt+=3){var ut=ze[dt]*me,Bt=ze[dt+1]*me,Wt=ze[dt+2]*me;vt+=Math.abs((Ee[ut]-Ee[Wt])*(Ee[Bt+1]-Ee[ut+1])-(Ee[ut]-Ee[Bt])*(Ee[Wt+1]-Ee[ut+1]))}return De===0&&vt===0?0:Math.abs((vt-De)/De)};function Rn(Ee,Oe,me,ze){for(var $e=0,ue=Oe,De=me-ze;ue<me;ue+=ze)$e+=(Ee[De]-Ee[ue])*(Ee[ue+1]+Ee[De+1]),De=ue;return $e}return n.flatten=function(Ee){for(var Oe=Ee[0][0].length,me={vertices:[],holes:[],dimensions:Oe},ze=0,$e=0;$e<Ee.length;$e++){for(var ue=0;ue<Ee[$e].length;ue++)for(var De=0;De<Oe;De++)me.vertices.push(Ee[$e][ue][De]);$e>0&&(ze+=Ee[$e-1].length,me.holes.push(ze))}return me},x_.exports}var t9=e9();const n9=Tx(t9),b_=O3.CLOCKWISE,VS=O3.COUNTER_CLOCKWISE,Th={};function r9(n){if(n=n&&n.positions||n,!Array.isArray(n)&&!ArrayBuffer.isView(n))throw new Error("invalid polygon")}function Lm(n){return"positions"in n?n.positions:n}function B_(n){return"holeIndices"in n?n.holeIndices:null}function i9(n){return Array.isArray(n[0])}function s9(n){return n.length>=1&&n[0].length>=2&&Number.isFinite(n[0][0])}function o9(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function a9(n,e,t,r){for(let o=0;o<e;o++)if(n[t+o]!==n[r-e+o])return!1;return!0}function jS(n,e,t,r,o){let c=e;const d=t.length;for(let a=0;a<d;a++)for(let v=0;v<r;v++)n[c++]=t[a][v]||0;if(!o9(t))for(let a=0;a<r;a++)n[c++]=t[0][a]||0;return Th.start=e,Th.end=c,Th.size=r,L3(n,o,Th),c}function $S(n,e,t,r,o=0,c,d){c=c||t.length;const a=c-o;if(a<=0)return e;let v=e;for(let A=0;A<a;A++)n[v++]=t[o+A];if(!a9(t,r,o,c))for(let A=0;A<r;A++)n[v++]=t[o+A];return Th.start=e,Th.end=v,Th.size=r,L3(n,d,Th),v}function j3(n,e){r9(n);const t=[],r=[];if("positions"in n){const{positions:o,holeIndices:c}=n;if(c){let d=0;for(let a=0;a<=c.length;a++)d=$S(t,d,o,e,c[a-1],c[a],a===0?b_:VS),r.push(d);return r.pop(),{positions:t,holeIndices:r}}n=o}if(!i9(n))return $S(t,0,n,e,0,t.length,b_),t;if(!s9(n)){let o=0;for(const[c,d]of n.entries())o=jS(t,o,d,e,c===0?b_:VS),r.push(o);return r.pop(),{positions:t,holeIndices:r}}return jS(t,0,n,e,b_),t}function g0(n,e,t){const r=n.length/3;let o=0;for(let c=0;c<r;c++){const d=(c+1)%r;o+=n[c*3+e]*n[d*3+t],o-=n[d*3+e]*n[c*3+t]}return Math.abs(o/2)}function WS(n,e,t,r){const o=n.length/3;for(let c=0;c<o;c++){const d=c*3,a=n[d+0],v=n[d+1],A=n[d+2];n[d+e]=a,n[d+t]=v,n[d+r]=A}}function l9(n,e,t,r){let o=B_(n);o&&(o=o.map(a=>a/e));let c=Lm(n);const d=r&&e===3;if(t){const a=c.length;c=c.slice();const v=[];for(let A=0;A<a;A+=e){v[0]=c[A],v[1]=c[A+1],d&&(v[2]=c[A+2]);const P=t(v);c[A]=P[0],c[A+1]=P[1],d&&(c[A+2]=P[2])}}if(d){const a=g0(c,0,1),v=g0(c,0,2),A=g0(c,1,2);if(!a&&!v&&!A)return[];a>v&&a>A||(v>A?(t||(c=c.slice()),WS(c,0,2,1)):(t||(c=c.slice()),WS(c,2,0,1)))}return n9(c,o,e)}class c9 extends M3{constructor(e){const{fp64:t,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=j3(e,this.positionSize);return this.opts.resolution?N3(Lm(t),B_(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?$7(Lm(t),B_(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(HS(e)){let t=0;for(const r of e)t+=this.getGeometrySize(r);return t}return Lm(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&HS(e))for(const r of e){const o=this.getGeometrySize(r);t.geometrySize=o,this.updateGeometryAttributes(r,t),t.vertexStart+=o,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const r=e;this._updateIndices(r,t),this._updatePositions(r,t),this._updateVertexValid(r,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:r,indexStart:o}){const{attributes:c,indexStarts:d,typedArrayManager:a}=this;let v=c.indices;if(!v||!e)return;let A=o;const P=l9(e,this.positionSize,this.opts.preproject,this.opts.full3d);v=a.allocate(v,o+P.length,{copy:!0});for(let k=0;k<P.length;k++)v[A++]=P[k]+r;d[t+1]=o+P.length,c.indices=v}_updatePositions(e,{vertexStart:t,geometrySize:r}){const{attributes:{positions:o},positionSize:c}=this;if(!o||!e)return;const d=Lm(e);for(let a=t,v=0;v<r;a++,v++){const A=d[v*c],P=d[v*c+1],k=c>2?d[v*c+2]:0;o[a*3]=A,o[a*3+1]=P,o[a*3+2]=k}}_updateVertexValid(e,{vertexStart:t,geometrySize:r}){const{positionSize:o}=this,c=this.attributes.vertexValid,d=e&&B_(e);if(e&&e.edgeTypes?c.set(e.edgeTypes,t):c.fill(1,t,t+r),d)for(let a=0;a<d.length;a++)c[t+d[a]/o-1]=0;c[t+r-1]=0}}function HS(n){return Array.isArray(n)&&n.length>0&&!Number.isFinite(n[0])}const ZS=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,u9={name:"solidPolygon",vs:ZS,fs:ZS,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},$3=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,h9=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${$3}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,d9=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${$3}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,f9=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,fy=[0,0,0,255],p9={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:n=>n.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:fy},getLineColor:{type:"accessor",value:fy},material:!0},w_={enter:(n,e)=>e.length?e.subarray(e.length-n.length):n};class Kb extends Ru{getShaders(e){return super.getShaders({vs:e==="top"?h9:d9,fs:f9,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Dp,TC,ky,u9]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&t===Vn.DEFAULT&&(t=Vn.LNGLAT);let o;t===Vn.LNGLAT&&(r?o=e.projectPosition.bind(e):o=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new c9({preproject:o,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const c=this.getAttributeManager(),d=!0;c.remove(["instancePickingColors"]),c.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:d},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:w_,accessor:"getPolygon",update:this.calculatePositions,noAlloc:d,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:d},elevations:{size:1,stepMode:"dynamic",transition:w_,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:w_,accessor:"getFillColor",defaultValue:fy},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:w_,accessor:"getLineColor",defaultValue:fy},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:v,target:A})=>this.encodePickingColor(a&&a.__source?a.__source.index:v,A)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,o=this.props.data;return o[0]&&o[0].__source&&(t.object=o.find(c=>c.__source.index===r)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:r,wireframe:o,elevationScale:c}=this.props,{topModel:d,sideModel:a,wireframeModel:v,polygonTesselator:A}=this.state,P={extruded:!!t,elevationScale:c,isWireframe:!1};v&&o&&(v.setInstanceCount(A.instanceCount-1),v.shaderInputs.setProps({solidPolygon:{...P,isWireframe:!0}}),v.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(A.instanceCount-1),a.shaderInputs.setProps({solidPolygon:P}),a.draw(this.context.renderPass)),d&&r&&(d.setVertexCount(A.vertexCount),d.shaderInputs.setProps({solidPolygon:P}),d.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:r,changeFlags:o}=e,c=this.getAttributeManager();(o.extensionsChanged||t.filled!==r.filled||t.extruded!==r.extruded)&&(this.state.models?.forEach(a=>a.destroy()),this.setState(this._getModels()),c.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:c}=this.state,d=e.data.attributes||{};c.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:d.getPolygon,buffers:d,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:r}=this.props;let o,c,d;if(t){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const v=this.getAttributeManager().getBufferLayouts({isInstanced:!1});o=new Oa(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",bufferLayout:v,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});c=new Oa(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,geometry:new ag({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),d=new Oa(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,geometry:new ag({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[c,d,o].filter(Boolean),topModel:o,sideModel:c,wireframeModel:d}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Kb.defaultProps=p9;Kb.layerName="SolidPolygonLayer";function m9({data:n,getIndex:e,dataRange:t,replace:r}){const{startRow:o=0,endRow:c=1/0}=t,d=n.length;let a=d,v=d;for(let L=0;L<d;L++){const z=e(n[L]);if(a>L&&z>=o&&(a=L),z>=c){v=L;break}}let A=a;const k=v-a!==r.length?n.slice(v):void 0;for(let L=0;L<r.length;L++)n[A++]=r[L];if(k){for(let L=0;L<k.length;L++)n[A++]=k[L];n.length=A}return{startRow:a,endRow:a+r.length}}const W3=[0,0,0,255],g9=[0,0,0,255],_9={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:n=>n.polygon},getFillColor:{type:"accessor",value:g9},getLineColor:{type:"accessor",value:W3},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Jb extends qb{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&_r.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const r=this.state.paths.slice(),o=e.dataChanged.map(c=>m9({data:r,getIndex:d=>d.__source.index,dataRange:c,replace:this._getPaths(c)}));this.setState({paths:r,pathsDiff:o})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:r,positionFormat:o,_normalize:c}=this.props,d=[],a=o==="XY"?2:3,{startRow:v,endRow:A}=e,{iterable:P,objectInfo:k}=Ly(t,v,A);for(const L of P){k.index++;let z=r(L,k);c&&(z=j3(z,a));const{holeIndices:G}=z,te=z.positions||z;if(G)for(let re=0;re<=G.length;re++){const fe=te.slice(G[re-1]||0,G[re]||te.length);d.push(this.getSubLayerRow({path:fe},L,k.index))}else d.push(this.getSubLayerRow({path:te},L,k.index))}return d}renderLayers(){const{data:e,_dataDiff:t,stroked:r,filled:o,extruded:c,wireframe:d,_normalize:a,_windingOrder:v,elevationScale:A,transitions:P,positionFormat:k}=this.props,{lineWidthUnits:L,lineWidthScale:z,lineWidthMinPixels:G,lineWidthMaxPixels:te,lineJointRounded:re,lineMiterLimit:fe,lineDashJustified:ve}=this.props,{getFillColor:le,getLineColor:Se,getLineWidth:Ne,getLineDashArray:nt,getElevation:pt,getPolygon:mt,updateTriggers:Tt,material:Mt}=this.props,{paths:Zt,pathsDiff:hn}=this.state,on=this.getSubLayerClass("fill",Kb),nn=this.getSubLayerClass("stroke",Yb),Rn=this.shouldRenderSubLayer("fill",Zt)&&new on({_dataDiff:t,extruded:c,elevationScale:A,filled:o,wireframe:d,_normalize:a,_windingOrder:v,getElevation:pt,getFillColor:le,getLineColor:c&&d?Se:W3,material:Mt,transitions:P},this.getSubLayerProps({id:"fill",updateTriggers:Tt&&{getPolygon:Tt.getPolygon,getElevation:Tt.getElevation,getFillColor:Tt.getFillColor,lineColors:c&&d,getLineColor:Tt.getLineColor}}),{data:e,positionFormat:k,getPolygon:mt}),Ee=!c&&r&&this.shouldRenderSubLayer("stroke",Zt)&&new nn({_dataDiff:hn&&(()=>hn),widthUnits:L,widthScale:z,widthMinPixels:G,widthMaxPixels:te,jointRounded:re,miterLimit:fe,dashJustified:ve,_pathType:"loop",transitions:P&&{getWidth:P.getLineWidth,getColor:P.getLineColor,getPath:P.getPolygon},getColor:this.getSubLayerAccessor(Se),getWidth:this.getSubLayerAccessor(Ne),getDashArray:this.getSubLayerAccessor(nt)},this.getSubLayerProps({id:"stroke",updateTriggers:Tt&&{getWidth:Tt.getLineWidth,getColor:Tt.getLineColor,getDashArray:Tt.getLineDashArray}}),{data:Zt,positionFormat:k,getPath:Oe=>Oe.path});return[!c&&Rn,Ee,c&&Rn]}}Jb.layerName="PolygonLayer";Jb.defaultProps=_9;function y9(n){const e=n.map(a=>a[0]),t=n.map(a=>a[1]),r=Math.min.apply(null,e),o=Math.max.apply(null,e),c=Math.min.apply(null,t),d=Math.max.apply(null,t);return[r,c,o,d]}function v9(n,e){return e[0]>=n[0]&&e[2]<=n[2]&&e[1]>=n[1]&&e[3]<=n[3]}const XS=new Float32Array(12);function qS(n,e=2){let t=0;for(const r of n)for(let o=0;o<e;o++)XS[t++]=r[o]||0;return XS}function x9(n,e,t){const[r,o,c,d]=n,a=c-r,v=d-o;let A=a,P=v;a/v<e/t?A=e/t*v:P=t/e*a,A<e&&(A=e,P=t);const k=(c+r)/2,L=(d+o)/2;return[k-A/2,L-P/2,k+A/2,L+P/2]}function b9(n,e){const[t,r,o,c]=e;return[(n[0]-t)/(o-t),(n[1]-r)/(c-r)]}const w9=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,T9=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,GS=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,S9={name:"triangle",vs:GS,fs:GS,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class H3 extends Ru{getShaders(){return super.getShaders({vs:w9,fs:T9,modules:[Dp,S9]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:r}=this.props;return new Oa(e,{...this.getShaders(),id:this.props.id,attributes:r.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:r,intensity:o,threshold:c,colorTexture:d,maxTexture:a,weightsTexture:v}=this.props,A={aggregationMode:t,colorDomain:r,intensity:o,threshold:c,colorTexture:d,maxTexture:a,weightsTexture:v};e.shaderInputs.setProps({triangle:A}),e.draw(this.context.renderPass)}}H3.layerName="TriangleLayer";function A9(n,e){const t={};for(const r in n)e.includes(r)||(t[r]=n[r]);return t}class Z3 extends qb{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:A9(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const r=this.getShaders({});r&&r.defines&&(r.defines.NON_INSTANCED_MODEL=1),this.updateShaders(r)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:r}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:r.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:r,oldProps:o,changeFlags:c}=e,{compareAll:d=!1,dimension:a}=t,{ignoreProps:v}=this.state,{props:A,accessors:P=[]}=a,{updateTriggersChanged:k}=c;if(c.dataChanged)return!0;if(k){if(k.all)return!0;for(const L of P)if(k[L])return!0}if(d)return c.extensionsChanged?!0:Zb({oldProps:o,newProps:r,ignoreProps:v,propTypes:this.constructor._propTypes});for(const L of A)if(r[L]!==o[L])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!P9(t)}_getAttributeManager(){return new Hb(this.context.device,{id:this.props.id,stats:this.context.stats})}}Z3.layerName="AggregationLayer";function P9(n){let e=!0;for(const t in n){e=!1;break}return e}const YS=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,KS=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,E9=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,C9=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,I9=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,M9={name:"weight",vs:I9,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},R9={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},k9=2,_0={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},JS=[0,0],D9={SUM:0,MEAN:1},O9={getPosition:{type:"accessor",value:n=>n.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:m7,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},L9=["float32-renderable-webgl","texture-blend-float-webgl"],F9={data:{props:["radiusPixels"]}};class Qb extends Z3{getShaders(e){let t=[Dp];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(F9),this.setState({colorDomain:JS}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:r}=e,o=this._getChangeFlags(e);(o.dataChanged||o.viewportChanged)&&(o.boundsChanged=this._updateBounds(o.dataChanged),this._updateTextureRenderingBounds()),o.dataChanged||o.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):o.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==r.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:r,maxWeightsTexture:o,colorTexture:c,colorDomain:d}=this.state,{updateTriggers:a,intensity:v,threshold:A,aggregation:P}=this.props,k=this.getSubLayerClass("triangle",H3);return new k(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:Vn.DEFAULT,data:{attributes:{positions:t,texCoords:r}},vertexCount:4,maxTexture:o,colorTexture:c,aggregationMode:D9[P]||0,weightsTexture:e,intensity:v,threshold:A,colorDomain:d})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:r,maxWeightTransform:o,maxWeightsTexture:c,triPositionBuffer:d,triTexCoordBuffer:a,colorTexture:v,updateTimer:A}=this.state;t?.destroy(),r?.destroy(),o?.destroy(),c?.destroy(),d?.destroy(),a?.destroy(),v?.destroy(),A&&clearTimeout(A)}_getAttributeManager(){return new Hb(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:r}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:r.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:o}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==o)&&(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({..._0,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({..._0,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,r=Math.min(t,e.limits.maxTextureDimension2D),o=L9.every(a=>e.features.has(a)),c=o?"rgba32float":"rgba8unorm",d=o?1:1/255;this.setState({textureSize:r,format:c,weightsScale:d}),o||_r.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:r}=this.state,o=this.getAttributeManager();t?.destroy(),t=new J2(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:o.getBufferLayouts(),vertexCount:1,targetTexture:r,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,M9]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:r,maxWeightsTexture:o}=this.state,c=this.getShaders({vs:YS,fs:KS});this._createWeightsTransform(c);const d=this.getShaders({vs:E9,fs:C9,modules:[R9]}),a=new J2(e,{id:`${this.id}-max-weights-transform`,targetTexture:o,...d,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),v={inTexture:r,textureSize:t};a.model.shaderInputs.setProps({maxWeight:v}),this.setState({weightsTexture:r,maxWeightsTexture:o,maxWeightTransform:a,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:YS,fs:KS,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,r=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(a=>a.map(Math.fround)),o=y9(r),c={visibleWorldBounds:o,viewportCorners:r};let d=!1;if(e||!this.state.worldBounds||!v9(this.state.worldBounds,o)){const a=this._worldToCommonBounds(o),v=this._commonToWorldBounds(a);this.props.coordinateSystem===Vn.LNGLAT&&(v[1]=Math.max(v[1],-85.051129),v[3]=Math.min(v[3],85.051129),v[0]=Math.max(v[0],-360),v[2]=Math.min(v[2],360));const A=this._worldToCommonBounds(v);c.worldBounds=v,c.normalizedCommonBounds=A,d=!0}return this.setState(c),d}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:r,viewportCorners:o}=this.state,{viewport:c}=this.context;e.write(qS(o,3));const d=o.map(a=>b9(c.projectPosition(a),r));t.write(qS(d,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:r}=this.state;const o=g7(t,!1,Uint8Array);r&&r?.width===t.length?r.setTexture2DData({data:o}):(r?.destroy(),r=this.context.device.createTexture({..._0,data:o,width:t.length,height:1})),this.setState({colorTexture:r})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:r}=this.props,{worldBounds:o,textureSize:c,weightsScale:d,weightsTexture:a}=this.state,v=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const A=this._worldToCommonBounds(o,{useLayerCoordinateSystem:!0});if(t&&r==="SUM"){const{viewport:le}=this.context,Se=le.distanceScales.metersPerUnit[2]*(A[2]-A[0])/c;this.state.colorDomain=t.map(Ne=>Ne*Se*d)}else this.state.colorDomain=t||JS;const k=this.getAttributeManager().getAttributes(),L=this.getModuleSettings();this._setModelAttributes(v.model,k),v.model.setVertexCount(this.getNumInstances());const z={radiusPixels:e,commonBounds:A,textureWidth:c,weightsScale:d,weightsTexture:a},{viewport:G,devicePixelRatio:te,coordinateSystem:re,coordinateOrigin:fe}=L,{modelMatrix:ve}=this.props;v.model.shaderInputs.setProps({project:{viewport:G,devicePixelRatio:te,modelMatrix:ve,coordinateSystem:re,coordinateOrigin:fe},weight:z}),v.run({parameters:{viewport:[0,0,c,c]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:r}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),r)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:r=!1}=t,[o,c,d,a]=e,{viewport:v}=this.context,{textureSize:A}=this.state,{coordinateSystem:P}=this.props,k=r&&(P===Vn.LNGLAT_OFFSETS||P===Vn.METER_OFFSETS),L=k?v.projectPosition(this.props.coordinateOrigin):[0,0],z=A*k9/v.scale;let G,te;return r&&!k?(G=this.projectPosition([o,c,0]),te=this.projectPosition([d,a,0])):(G=v.projectPosition([o,c,0]),te=v.projectPosition([d,a,0])),x9([G[0]-L[0],G[1]-L[1],te[0]-L[0],te[1]-L[1]],z,z)}_commonToWorldBounds(e){const[t,r,o,c]=e,{viewport:d}=this.context,a=d.unprojectPosition([t,r]),v=d.unprojectPosition([o,c]);return a.slice(0,2).concat(v.slice(0,2))}}Qb.layerName="HeatmapLayer";Qb.defaultProps=O9;function N9(){const[n,e]=Ae.useState(null),[t,r]=Ae.useState(!1),o=Ae.useCallback(()=>{e(null),r(!1)},[]),c=Ae.useCallback(v=>A=>{const P=A;if(P&&P.object){const k=P.object,L=v(k,A)||{},z=P.x??0,G=P.y??0;e({x:z,y:G,...L}),r(!0)}else e(null),r(!1);return!1},[]),d=Ae.useCallback(()=>v=>{const A=v;return A&&A.object?r(!0):r(!1),!1},[]);return{tooltip:n,makeHoverHandler:c,makeHoverHandlerSilent:d,clear:o,cursor:t||n?"pointer":"default"}}function B9(){const{selectedView:n}=by(),t={Temperature:"temperature",Salinity:"salinity","Ocean Topography":"topography","Ocean Currents":"currents",Biomass:"biomass",default:"default"}[n??"default"]??"default",r=W_[t]||W_.default,c=`linear-gradient(90deg, ${r.map((d,a)=>{const v=Math.round(a/(r.length-1)*100);return`rgb(${d[0]}, ${d[1]}, ${d[2]}) ${v}%`}).join(", ")})`;return Ae.useEffect(()=>{console.log(`Selected view changed to: ${n}`)},[n]),Pe.jsxs("div",{className:"ml-2 w-full",children:[Pe.jsx("div",{className:"h-4 rounded-sm",style:{backgroundImage:c}}),Pe.jsx("div",{className:"w-full font-medium flex flex-row justify-between h-fit",children:[0,50,100].map(d=>Pe.jsx("span",{className:"text-md",children:d},d))})]})}function z9({enabled:n,setEnabled:e}){return Pe.jsx("div",{className:"w-full absolute top-0 bg-zinc-300 text-black h-12 z-[1001]",children:Pe.jsxs("div",{className:"grid grid-cols-[minmax(220px,1fr)_1fr_auto] items-center gap-2 h-full",children:[Pe.jsx("div",{className:"flex items-center",children:Pe.jsx(B9,{})}),Pe.jsx("div",{className:"text-center",children:Pe.jsx("p",{className:"text-lg font-medium",style:{fontSize:"1.125rem"},children:"Probability of Sharks (%)"})}),Pe.jsx("div",{className:"flex items-center justify-end pr-4",children:Pe.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[Pe.jsx("input",{type:"checkbox",className:"sr-only peer",checked:n,onChange:()=>e(!n)}),Pe.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer-checked:bg-cyan-600 peer-checked:after:translate-x-5 peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all"}),Pe.jsx("span",{className:"ml-3 text-sm font-medium text-black",children:n?"Enabled":"Disabled"})]})})]})})}const U9=[[-73.935242,40.73061,{question:"Which shark species is commonly found off the coast of New York?",answer:"Sand tiger shark",options:["Great white shark","Sand tiger shark","Hammerhead shark","Tiger shark"],image:"https://defenders.org/blog/2024/10/de-horrifying-sharks"}],[151.2093,-33.8688,{question:"What is the primary diet of the reef shark?",answer:"Small fish and invertebrates",options:["Seals and sea lions","Plankton","Small fish and invertebrates","Sea birds"],image:"https://defenders.org/blog/2024/10/de-horrifying-sharks"}],[-157.8583,21.3069,{question:"Which behavior helps sharks detect prey at night?",answer:"Ampullae of Lorenzini electroreception",options:["Sonar clicks","Ampullae of Lorenzini electroreception","Bioluminescence","Infrared vision"],image:"https://defenders.org/blog/2024/10/de-horrifying-sharks"}],[18.4241,-33.9249,{question:"True or False: Most shark species are threatened by overfishing.",answer:"True",options:["True","False"],image:"https://defenders.org/blog/2024/10/de-horrifying-sharks"}],[115.8575,-31.9505,{question:"What adaptation helps fast pelagic sharks maintain high speeds?",answer:"Heterocercal tail (large upper lobe)",options:["Flattened body","Heterocercal tail (large upper lobe)","External gill slits","Suction cup fins"],image:"https://defenders.org/blog/2024/10/de-horrifying-sharks"}]],X3=64,q3=128,V9=[-180,-90,180,90],j9=(()=>{const n=X3,e=q3,t=Array.from({length:n},()=>Array(e).fill(0)),r=[{r:Math.floor(n*.18),c:Math.floor(e*.2),s:Math.min(n,e)*.18,v:.9},{r:Math.floor(n*.35),c:Math.floor(e*.7),s:Math.min(n,e)*.12,v:.7},{r:Math.floor(n*.7),c:Math.floor(e*.5),s:Math.min(n,e)*.14,v:.6},{r:Math.floor(n*.2),c:Math.floor(e*.85),s:Math.min(n,e)*.08,v:.5}];for(let o=0;o<n;o++)for(let c=0;c<e;c++){let d=0;for(const a of r){const v=(o-a.r)/a.s,A=(c-a.c)/a.s,P=Math.sqrt(v*v+A*A);P<1&&(d+=a.v*(1-P)*(1-P))}t[o][c]=Math.min(1,d*(.9+Math.random()*.2))}return t})(),QS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAADECAYAAAAyNhmLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiMAAC4jAXilP3YAAAz5SURBVHhe7Z1LjGRHVoa/P25mVbe759XurLJRw9gzLS9sPGIELEAjWoiHBAghMRok85DYjRAgkKVZgGC6jNjwkEVLA0xXd2uwJTb2ggUSSGzaC4TYzGZGHiQvZgESBnuYrq7qrspHZRwWEZF5MzNu1rvrBuKXqrsy7iPjz/OfE+dERN4ShcF7v+e9vwAgCTPDe7/7/vvvX3PzJ7cZZvYJYFUSkuqHulVVuaLIAB8zM19vqBMrh8xN3C//3U/9gjef67NdunRpnDvQSqw/y5f+7Tvf3HDOKVkjWUSSUYplerf5HOL39rYef8zM5g8DaFvbaj2Za3e4Isc9Ex/trw5lzJKJFnJCLSdzEzeE28B1QHhDzEQxCIQ61z56rWo1md41vmjw84CTgRsuhOQJ+v3+xdaSWd/kJeCPZKykNmcTh6+fCsDFixfbGQDW3+SSiTdlPI0QBhqLle5FXPSMeUJm+Zh97rA+fwZ8ZkIE0BgG+3sz580Ral8A6N3m8yZ+HaOTiGAgg7Hfx+Zic228sVaRefY23ydxS56QSBKJjIW86G672JJHa8i8+BYr+/A14NlJ/DXAhAw6e0IzWdksJF1uDZkPH/D7Ej+WPuDkDfLBX/ATHS1YJkmvFWSu3uaG4FUZlWpEEjSOhupAoLUIMxudO5lrd7jixD3B5RS9oPb5q/Z7+L+Kr+ZxzqH5Jm7ouSN4PkukDotya4Ck8y0Bes/yRXP8nIHLEiCQqHDIK8msEedGZu2rvIz4Y3lW5n0kRDGQFxh48yCwULYsnJ5wLmTW3+QSjjckPr6QBsf+ygIRhZfxWCMPOC8yvs/riJeb3j8YICL+bjJk7NaOzMDMnnwG0LvLFxC/hk2jUtZdotQmB4OhDNifT2kiniyZ9b/mOXn+QsaFBXlloGSl+NMZ6AJQaT5lDniCxdltur7ia4hn6kRyg+QEFv3ECD40bpbZEx1neo4vS3xuwU/qUsq0T/zHJjrKZgBPTGbrd/lxGb8DLB8pYiQjRbE5dPqigTqSzn5G83ve4GnzbAKX54/lULfETDtgFU8tWDbi7KPZW1SjIXdI6UoOc05TH0pk09cmcMPAaXrGDM7WMr2H/Abws6gxOVzoWrKMaUpk0tZhZ3rmLCSdnWXW7vAZjI367EoWc/YypaJ/pjEEANlg8YoAMzub0Nz7Cpcx3hRcaZRXDg1nmrNUZY7mjyUMBoMzktkqrwPffyQiDVAMzzLAMWyiPBgMTn925uomvwT8alPUmUG9W5kuptHfBG40mQPIjjOj0ahz8BseAeubPO/g1mHTFaL/N42bCfLCjUSknCVzqpOA12+xavA3iLXDEsliWrfMNnuQXAfozh9LODUyD5/iDxA/eqR7LvZ5EZZmaIRQd8lVpxOa1+7yE4Lfraf1h8Iy+xngg5/Ix9fSlfnTajh5AHjmHj3zbGJcOpG8ZhBuM7mZDy8UJJZ9j5P7zE3c2HNH4rljE8lcNe8yMuE7hu82KQykE66cXb3Gb2H8zJH8JIc6odjfDEd8J3R6vp1gmeP7zNW7fNbBRjT96aNmhMkcs2+2zLEDQO8rXJbxBpaZXTkjmAO/bOb8uPLQCrdkvHjqRDSrr3o5YB0DJ+Z3aCQcS2Zrm7xi4pWlaf0xkUQ0yZxTThZLZrnYmMGRA8DaPT4FvC4Li0GnimSVaI1Jl226LuPMYdaYzhzeMtdvsYo/hXRlGeLE2ORlFVJ/jYUbASOj6b2PZJnti2wAP3JcPzsUFFMXH3qsKC+3H9doQjTLkuGwHVu7zU8Cv3nkdOWwmDhLGCDla7lx8p/puVmZra6uHiyz9b9izVycXWkw8YmQBsmYg01+kuNrmqOZGWkH08wt4mztcjJvUfku9wSfPBMiESJ03I01sYi54PzUiMZOZy1zYABY2+K3MX76QNInQCIiH4gki2gcFeann6G5kFDWr6+hmczVu3wW8eUzS1eIEkudn4wpYW1GFtLkmUG/EmD9Wksd+Wj29F0+8iTTlcnCkg9r/kSOGsd1TDexShRdHlkylT+jdKWOZA2v2QWxWIhN5SbMWQjRJqT8PNzq6upiPbO2ya+Y8cqSJerlqHdk0uFphJKB2xfVUHT2HNVAVIMYjmvXuH3COX2FMWbSU2XJaL426H2VTzv4ZzfUOkKKFR5ByqBlXhYm69w4zqREMSjtrEjXKg7zJlxcCk/3nloLtB+IdB67yT0c4lt/ujeQtFp/X++9DYfDT026dv0Wq0684fa1JlCIIlOuScvThkXnTREpnZ+uSZaa+IUX1SjMhSUruVGwUGcvEOjshbbgN7W5gAbXoH5g5wKv4vVD8rj6RELaUUTqWJLDGNwYqpFwQ9HZFd3Horvr6DwSnV1HZy/8VP0oqySpWgddJOJGQX54hQzZh/OcF24/Ep/OnS3AzILrPXOPng31j/L8gBvhZFLaDeHGQvtRHek2cYYxvGn81JnmURCtZDESKTgwdTmNQ+dNsVYBfBXvvQ+dx26GpFUgxDf+8vFY0ow/e+9tZ2fnerBMn+e0z2U30LjTd6w8dNZ95Fjdqug8Fp2+oxpEZx1OP91qKBRlUg1E95Gju+Po7Dq6j+LrbcfKtgsW2w1WTPLSOPjNysOK7iPHhQfT66tBICIfpOeGkw9qQWYS+ubDr4cNp9VWd7Cyra3VLdfvbjtL2nWjuEjiwQ0J0qn9VHuiGztYDWt1xyhIM0nV7QcZdvYc3UeR3I4LstxxuCFU/fB+nb1wboh+QQqdPcfqw4rujmOqg1msX/jesEj4yZtcqKzzJTy/2HnkPi3ouH2tMsY7Ux/PRWezn8jkjgLz7BFUAGIFhd9Nhol9cyBsGxgFuerjuEyBZzWPqPnohe926O4IM/y//v32UNLF+mUpms06kyE2UDSlZwNDWK0dXovxyuqhLrYcHuJmuOr6d+k+vhLGNH8Zrf8XfOPf6f/gJ3Bff4C/8SJa+9YXDN7mP4yVf3nLf0fSU/Wbee9tMBg8n40MbYOZKaX+3vv/0dw0bSTz3IIztRFzNczRcrOWI7uXoN/vF0kmjmQLyJcAbYakbH11pNmZtiBlLfM4sGxuKbJ9fiJ7Z84A2XrmTJbOnwCyG4JLtUwuNBtN+ms5GvvceKDFyPa5yNA8P2+RmmliWSDK9JncnmYzK3bQXED83ll5PpMrAuNSR5HjzAIZCs7NsiXA/xmZJZRIJlvPlCqzBcQAUKTMmlAkmeF8Q0SRMsv2udRxZjDfQMEBYGESsJVfoT8kFifcA4oMANlxhiZnajlmZJYqglLHmZl0JhWepQaAmT7Xa7USySxEM0qRWWZueWYSMFmmCJltbGwsJZNQhGXmMd2hsIjiyJjZzOJsai510MzNNWvyT5tRX2kmrCz7+qym9x4z81tbWy+33jK53bI5FBcAYvTNkbOTf7PpycM1uUaJxdlCf51zuEhj4WCbYWaN+0YvXbp0/s9qOgokNe1pZmVlpf3pTB0xsuUCAKWWzY0okUw2mlEomWw9w1k/Q+OoOGlJcqKLzwlNfT7ZJ3GaMLMLChv2j4tW5WaND/s4JNpDZlkFeVi0hswpoD0+cwpoj8wOi4a9M1CizHLbTRKKI7Ms6pVIJiuzEucAqiYDmFlZZOJCU5PPFDehMW4iU5zMYvqfJVOczGLK05iMFkUmorHPjQdajGxobl2leRDiKlqTzIqLZp0GyxiFyiwHlZg1q2FN0xVXz0SfyY4zxQWAaIFcACjSZ1xDAIDSyEjaA2ae0lBHaWT8smd7FEUms/UkoTyfieszTWVzceMMS8iUZZmI3DhjJY4zLAnNZWUAB6AsMgctRi092EI8tURmxUWzqiEAUCKZvYZEU5QmM0nDJUuFyx2qMBQnM5Y84LAsmR2QaJZlmbffftstCc1lWebBgwdL+7v0YEvRNM78P5lWorj1mRdeeKHJKlbEtzQSloTlhHKKs83Nzc57772nJaG5nFWAJRJLKMcy77zzTkpjcumMzvSvaZ02NjY2kmVyZMpboI3ILWmUNQlY++5Z7hkarqhE86WXXmqKYhRnmV6vl8g0TZyXEwBqaOpzOTKrISu3onKzDz/80OLA2SSzRpO1GR+Zbygu0UyIS4ELKEpmB6HIDMDMcjKjqNyMGASayubiLBMHzmyiSaHRLGsZCiWTy5o59wxg2ZdIl6DxmnMlw+EmKiaIAaCdZD744IOZ5/sfhBgAcjJz5y6z9fX1R/Nth0BTADj/ceawDy94991303lNsjxfyxwTTeNME8n2wcx0//79jvd+z8zMe28J3vuR9/6HS7RMkyyLlNnOfENCMWRSoDCzb88fA0aSxsWQSfDe/7mZbc01f9vM/rM4MltbW/9kZn9rZrvR/0fAHUn/XRyZ+/fv7w4Ggz8B/gH4Q+BVSfcU/5hZMbh//34n5mf0ej3duHGjcs5NnqtZlGUSkfT7a6+9NrNf838BB4ck2ACxeS4AAAAASUVORK5CYII=",$9=({open:n,title:e,onClose:t,footer:r,options:o,correctAnswer:c,onAnswer:d,image:a})=>{Ae.useEffect(()=>{const z=G=>{G.key==="Escape"&&t()};return n&&document.addEventListener("keydown",z),()=>document.removeEventListener("keydown",z)},[n,t]);const[v,A]=Dd.useState(null),[P,k]=Dd.useState(null);if(Dd.useEffect(()=>{n&&(A(null),k(null))},[n]),!n)return null;const L=z=>{A(z);const G=z===c;k(G),d&&d(G,z)};return Pe.jsxs("div",{"aria-modal":!0,role:"dialog",className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[Pe.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>t()}),Pe.jsxs("div",{className:"relative z-10 w-full max-w-xl rounded-md bg-blue-800 shadow-lg",children:[Pe.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[Pe.jsx("div",{className:"text-lg font-semibold",children:e}),Pe.jsx(R4,{className:"w-5 h-5 cursor-pointer",onClick:t})]}),Pe.jsx("div",{className:"p-4",children:Pe.jsxs("div",{children:[a&&Pe.jsx("div",{className:"mb-3 flex justify-center",children:Pe.jsx("img",{src:a,alt:"dialog",className:"max-w-full max-h-48 object-contain rounded"})}),Pe.jsx("div",{className:"space-y-2",children:o?.map(z=>{const G=P===!0&&z===c,te=P===!1&&z===v;return Pe.jsx("button",{onClick:()=>L(z),className:`w-full text-left p-2 rounded ${G?"bg-green-600 text-white":te?"bg-red-600 text-white":"bg-white/10 text-white"}`,children:z},z)})}),P!==null&&Pe.jsx("div",{className:"mt-3",children:P?Pe.jsx("div",{className:"text-sm text-green-200",children:"Correct "}):Pe.jsx("div",{className:"text-sm text-red-200",children:"Incorrect "})})]})}),r&&Pe.jsx("div",{className:"border-t px-4 py-3",children:r})]})]})},G3=Ae.createContext(void 0),W9=({children:n})=>{const[o,c]=Ae.useState(null),[d,a]=Ae.useState(59),[v,A]=Ae.useState(1e3),{selectedView:P}=by(),k=Ae.useCallback(async L=>{try{const z=await rE(()=>import("./mockResearchByYear-BSG7_I-j.js"),[]),G=L?.year??2020+Math.floor(d/12),te=L?.month??d%12+1,re=(z.researchByYear||{})[G]||{},fe=L?.depth??v,ve=(re[te]||[]).filter(le=>(le[3]??0)<=fe);return c(ve),ve}catch(z){return console.error("fetchResearchData failed",z),c([]),[]}},[d]);return Ae.useEffect(()=>{const L=2020+Math.floor(d/12),z=d%12+1;k({year:L,month:z,depth:v})},[d,v,P,k]),Pe.jsx(G3.Provider,{value:{researchData:o,monthIndex:d,setMonthIndex:a,depth:v,setDepth:A,fetchResearchData:k},children:n})};function H9(){const n=Ae.useContext(G3);if(!n)throw new Error("useResearchData must be used within ResearchDataProvider");return n}const Z9="https://raw.githubusercontent.com/visgl/deck.gl-data/master/examples/screen-grid/uber-pickup-locations.json",X9={longitude:0,latitude:0,zoom:1.2,pitch:0,bearing:0},q9="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json";function G9({researchData:n=Z9,intensity:e=1,threshold:t=.03,radiusPixels:r=30,mapStyle:o=q9,quizData:c=U9,mapMode:d}){const[a,v]=Ae.useState(X9),[A,P]=Ae.useState(!1),k=d??"research",{researchData:L,monthIndex:z,setMonthIndex:G,depth:te,setDepth:re}=H9(),fe=2020,ve=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],le=60,{selectedView:Se}=by(),pt={Temperature:"temperature",Salinity:"salinity","Ocean Topography":"topography","Ocean Currents":"currents",Biomass:"biomass",default:"default"}[Se??"default"]??"default",mt=W_[pt]||W_.default,Tt=Ae.useMemo(()=>!L||typeof L=="string"?[]:L.map(ht=>({position:[ht[0],ht[1]],weight:ht[2]})),[L]),{tooltip:Mt,makeHoverHandler:Zt,makeHoverHandlerSilent:hn,cursor:on}=N9(),[nn,Rn]=Ae.useState(!1),[Ee,Oe]=Ae.useState(null),[me,ze]=Ae.useState(null),[$e,ue]=Ae.useState(0);Ae.useEffect(()=>{let ht=0,vt=null;const ut=1200,Bt=Wt=>{vt||(vt=Wt);const jn=(Math.sin((Wt-vt)/ut*Math.PI*2)+1)/2;ue(jn),ht=requestAnimationFrame(Bt)};return ht=requestAnimationFrame(Bt),()=>cancelAnimationFrame(ht)},[]);const De=Ae.useMemo(()=>{if(typeof window>"u")return[];const ht=q3,vt=X3,[ut,Bt,Wt,jn]=V9,Wn=(Wt-ut)/ht,qn=(jn-Bt)/vt,Jn=[];for(let pn=0;pn<vt;pn++)for(let mn=0;mn<ht;mn++){const Us=Math.max(0,Math.min(1,j9[pn]?.[mn]??0)),ki=ut+mn*Wn,Di=ki+Wn,Gi=jn-pn*qn,mi=Gi-qn,bs=[[ki,mi],[Di,mi],[Di,Gi],[ki,Gi]];Jn.push({polygon:bs,value:Us})}return Jn},[pt]);Ae.useEffect(()=>{const ht=new Image;ht.onload=()=>{const vt=ht.width||64,ut=ht.height||64;ze({flag:{x:0,y:0,width:vt,height:ut,anchorY:ut,anchorX:Math.floor(vt/2)}})},ht.onerror=()=>{ze({flag:{x:0,y:0,width:64,height:64,anchorY:64,anchorX:32}})},ht.src=QS},[]);const dt=Ae.useCallback(ht=>{if(!ht||!ht.coordinate||!Array.isArray(ht.coordinate))return;const vt=ht.coordinate;if(vt.length<2)return;const ut=vt[0],Bt=vt[1];v(Wt=>({...Wt,longitude:ut,latitude:Bt,zoom:Math.max(Wt.zoom??1,8),transitionDuration:1e3,transitionInterpolator:new y_}))},[]),Et=[(()=>{const ht=mt,vt=Array.isArray(ht)?ht.map(ut=>[ut[0],ut[1],ut[2],255]):[];return new Qb({data:L||[],id:"heatmap-layer",pickable:!0,getPosition:ut=>[ut[0],ut[1]],getWeight:ut=>ut[2],radiusPixels:r,intensity:e,threshold:t,onClick:ut=>{if(!ut||!ut.coordinate||!Array.isArray(ut.coordinate))return!0;const Bt=ut.coordinate;if(Bt.length<2)return!0;const Wt=Bt[0],jn=Bt[1];return v(Wn=>({...Wn,longitude:Wt,latitude:jn,zoom:Math.max(Wn.zoom??1,8),transitionDuration:1e3,transitionInterpolator:new y_})),!0},colorRange:vt,onHover:Zt((ut,Bt)=>{const Wt=Bt?.coordinate?.[0]??ut[0]??NaN,jn=Bt?.coordinate?.[1]??ut[1]??NaN;return{weight:ut[2],lon:Wt,lat:jn}})})})(),new dy({id:"heat-dots",data:Tt,pickable:!0,radiusUnits:"pixels",getPosition:ht=>ht.position,getRadius:ht=>4,getFillColor:ht=>{const vt=Math.max(0,Math.min(1,(ht.weight||0)/10)),[ut,Bt,Wt]=gT(mt,vt);return[ut,Bt,Wt,200]},onClick:dt,onHover:Zt((ht,vt)=>{const ut=(ht.position&&ht.position[0])??vt?.coordinate?.[0]??NaN,Bt=(ht.position&&ht.position[1])??vt?.coordinate?.[1]??NaN;return{weight:ht.weight,lon:ut,lat:Bt}})})];if(A&&De&&De.length&&Et.unshift(new Jb({id:"aerosol-polygons",data:De,pickable:!1,stroked:!0,filled:!0,getPolygon:ht=>ht.polygon,getFillColor:ht=>{const vt=Math.max(0,Math.min(1,ht.value||0)),[ut,Bt,Wt]=gT(mt,vt);return[255-Math.round(ut),255-Math.round(Bt),255-Math.round(Wt),100]},getLineColor:()=>[0,0,0,255],lineWidthMinPixels:1})),k==="student"){const ht=(typeof c=="string"?[]:c).map(vt=>({position:[vt[0],vt[1]],question:vt[2]}));Et.push(new dy({id:"quiz-halo",data:ht,pickable:!0,getPosition:vt=>vt.position,getRadius:vt=>{const ut=me?.flag?.width??64,Bt=Math.max(16,Math.floor(ut/.75)),Wt=Math.max(6,Math.floor(Bt*.4));return Math.round(Wt*(1+$e*.12))},radiusUnits:"pixels",getFillColor:()=>[255,200,0,40],opacity:1,onClick:vt=>{const ut=vt?.object;if(!ut)return;const Bt=vt.coordinate?.[0]??ut.position?.[0]??NaN,Wt=vt.coordinate?.[1]??ut.position?.[1]??NaN;v(Wn=>({...Wn,longitude:Bt,latitude:Wt,zoom:Math.max(Wn.zoom??1,6),transitionDuration:500,transitionInterpolator:new y_}));const jn=ut.question;Oe({questionText:jn.question,options:jn.options,answer:jn.answer}),Rn(!0)},onHover:hn()})),Et.push(new Gb({id:"quiz-flags",data:ht,pickable:!1,iconAtlas:QS,iconMapping:me||{flag:{x:0,y:0,width:64,height:64,anchorY:64,anchorX:32}},getIcon:vt=>"flag",sizeScale:1,getSize:vt=>{const ut=me?.flag?.width??64,Bt=Math.max(16,Math.floor(ut/.75)),Wt=.85+$e*.3;return Math.round(Bt*Wt)},getPosition:vt=>vt.position,onClick:vt=>{const ut=vt?.object;if(!ut)return;const Bt=vt.coordinate?.[0]??ut.position?.[0]??NaN,Wt=vt.coordinate?.[1]??ut.position?.[1]??NaN;v(Wn=>({...Wn,longitude:Bt,latitude:Wt,zoom:Math.max(Wn.zoom??1,6),transitionDuration:500,transitionInterpolator:new y_}));const jn=ut.question;Oe({questionText:jn.question,options:jn.options,answer:jn.answer}),Rn(!0)}}))}const kt=on;return Pe.jsxs("div",{style:{position:"relative",width:"100%",minHeight:"100vh",height:"100%",cursor:kt},children:[Pe.jsx(z9,{enabled:A,setEnabled:P}),Pe.jsx(p7,{style:{zIndex:"0"},viewState:a,controller:!0,onViewStateChange:ht=>v(ht.viewState),layers:Et,children:Pe.jsx(_L,{reuseMaps:!0,mapStyle:o,mapLib:nE,attributionControl:!1})}),Mt&&Pe.jsxs("div",{style:{position:"absolute",left:Mt.x+12,top:Mt.y+12,background:"rgba(0,0,0,0.75)",color:"white",padding:"6px 8px",borderRadius:4,pointerEvents:"none",fontSize:12},children:[Pe.jsxs("div",{children:[Pe.jsx("strong",{children:"Intensity:"})," ",String(Mt.weight)]}),Pe.jsxs("div",{style:{fontSize:11,opacity:.9},children:[Pe.jsx("strong",{children:"Lon:"})," ",typeof Mt.lon=="number"&&Number.isFinite(Mt.lon)?Mt.lon.toFixed(4):"n/a"," ",Pe.jsx("strong",{children:"Lat:"})," ",typeof Mt.lat=="number"&&Number.isFinite(Mt.lat)?Mt.lat.toFixed(4):"n/a"]})]}),Pe.jsxs("div",{className:"absolute bottom-[15%] rotate-[270deg] right-1 z-2003 flex items-center",children:[Pe.jsxs("div",{style:{writingMode:"vertical-rl",color:"white",fontSize:11,opacity:.9},children:[te," m"]}),Pe.jsx("input",{type:"range",min:0,max:3e3,step:10,value:te,onChange:ht=>re(Number(ht.target.value)),style:{height:140},"aria-label":"Depth (m)"})]}),Pe.jsxs("div",{className:"absolute left-12 right-12 bottom-2 z-2002 px-2 py-4 rounded-2xl bg-blue-900/60",children:[Pe.jsx("div",{className:"flex items-center gap-12 ",children:Pe.jsx("input",{type:"range",min:0,max:le-1,value:z,onChange:ht=>G(Number(ht.target.value)),style:{flex:1}})}),Pe.jsxs("div",{style:{position:"relative",height:36,marginTop:6},children:[Pe.jsx("div",{style:{position:"absolute",left:6,right:6,top:-35,height:18},children:Array.from({length:5}).map((ht,vt)=>{const ut=fe+vt,Bt=vt/4*100;return Pe.jsx("div",{style:{position:"absolute",left:`calc(${Bt}% )`,transform:"translateX(-50%)",top:0,color:"rgba(255,255,255,0.85)",fontSize:12,fontWeight:600},children:ut},ut)})}),Pe.jsx("div",{style:{position:"absolute",left:6,right:6,top:6,height:24},children:Array.from({length:12}).map((ht,vt)=>{const ut=vt/11*100,Bt=Math.round(vt/11*(le-1)),Wt=ve[Bt%12];return Pe.jsx("div",{style:{position:"absolute",left:`calc(${ut}% )`,transform:"translateX(-50%)",top:0,color:"rgba(255,255,255,0.7)",fontSize:12},children:Wt},vt)})})]})]}),Pe.jsx($9,{open:nn,onClose:()=>Rn(!1),title:Ee?.questionText||"Question",options:Ee?.options,correctAnswer:Ee?.answer,onAnswer:(ht,vt)=>{ht&&setTimeout(()=>Rn(!1),900),console.info("Answer selected:",vt,"correct:",ht)}})]})}const Y9=()=>(MM(),Pe.jsx(W9,{children:Pe.jsx(eL,{children:Pe.jsx(G9,{})})})),K9="/assets/logo-Cp-2yuvD.svg",J9=()=>Pe.jsxs("div",{className:"relative min-h-screen flex items-center justify-center overflow-hidden bg-black",children:[Pe.jsx(gn.div,{className:"absolute inset-0 bg-gradient-to-br from-[#00111F] via-[#003B5C] to-[#005C99]",animate:{backgroundPosition:["0% 0%","100% 100%","0% 0%"]},transition:{duration:20,repeat:1/0,ease:"linear"},style:{backgroundSize:"400% 400%"}}),Pe.jsx(gn.div,{className:"absolute inset-0 bg-[radial-gradient(circle_at_top_center,rgba(255,255,255,0.12)_0%,transparent_70%)]",animate:{opacity:[.4,.6,.4],rotate:[0,5,-5,0]},transition:{duration:12,repeat:1/0,ease:"easeInOut"}}),Pe.jsx(gn.div,{className:"absolute top-8 left-8 z-20",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:1,delay:.3},children:Pe.jsx("img",{src:K9,alt:"Developers Logo",className:"h-12 w-auto"})}),[...Array(30)].map((n,e)=>Pe.jsx(gn.div,{className:"absolute bg-blue-100 rounded-full opacity-20 blur-sm",style:{width:Math.random()*8+3,height:Math.random()*8+3,top:`${Math.random()*100}%`,left:`${Math.random()*100}%`},animate:{y:[0,-150,0],opacity:[.05,.3,.05]},transition:{duration:8+Math.random()*5,repeat:1/0,ease:"easeInOut"}},e)),Pe.jsx(gn.div,{className:"absolute top-1/3 left-[-20%] w-[200px] h-[80px] bg-[url('/shark-silhouette.png')] bg-no-repeat bg-contain opacity-20",animate:{x:["-20%","120%"],y:[0,10,-10,0],opacity:[.2,.25,.2]},transition:{duration:40,repeat:1/0,ease:"easeInOut"},style:{filter:"blur(2px)"}}),Pe.jsxs("div",{className:"relative z-10 text-center text-white px-6",children:[Pe.jsx(gn.h1,{className:"text-6xl md:text-8xl font-extrabold mb-8 bg-gradient-to-r from-blue-100 via-cyan-300 to-blue-200 bg-clip-text text-transparent drop-shadow-[0_0_25px_rgba(59,130,246,0.3)]",initial:{opacity:0,y:60,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:1.4,ease:"easeOut"},children:"Shark Explorer"}),Pe.jsx(gn.p,{className:"text-lg md:text-2xl text-blue-100/80 mb-10 max-w-2xl mx-auto leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.2,delay:.6},children:"Dive into the data that drives the oceans. Explore temperature, salinity, and shark migration like never before."}),Pe.jsxs(gn.button,{className:"relative px-10 py-4 text-xl font-semibold rounded-full overflow-hidden text-white bg-gradient-to-r from-blue-500 to-cyan-400 shadow-lg hover:shadow-2xl transition-all duration-300",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:1,delay:1},whileHover:{scale:1.08,boxShadow:"0 0 30px rgba(56,189,248,0.4)"},whileTap:{scale:.95},children:[Pe.jsx("span",{className:"relative z-10",children:"Start Exploring"}),Pe.jsx(gn.span,{className:"absolute inset-0 bg-gradient-to-r from-cyan-400 to-blue-500 opacity-0",whileHover:{opacity:.2},transition:{duration:.3}})]})]})]});function Q9(){return Pe.jsx(F4,{children:Pe.jsx(IM,{children:Pe.jsx(PM,{children:Pe.jsxs(T_,{path:"/",children:[Pe.jsx(T_,{index:!0,element:Pe.jsx(Y9,{})}),Pe.jsx(T_,{path:"cover",element:Pe.jsx(J9,{})})]})})})})}DI.createRoot(document.getElementById("root")).render(Pe.jsx(Ae.StrictMode,{children:Pe.jsx(D4,{children:Pe.jsx(Q9,{})})}));
